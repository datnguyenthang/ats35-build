webpackJsonp([106],{1799:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),s.d(t,"AddonMandatoryMyMandatoryPageModule",function(){return h});var r=s(0),o=s(4),i=s(1),n=s(931),c=s(16),a=s(15),u=s(66),d=s(1923),l=this&&this.__decorate||function(e,t,s,r){var o,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(n=(i<3?o(n):i>3?o(t,s,n):o(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},h=function(){function e(){}return e=l([Object(r.I)({declarations:[d.a],imports:[c.a,a.a,u.a,n.a,o.l.forChild(d.a),i.b.forChild()]})],e)}()},1923:function(e,t,s){"use strict";s.d(t,"a",function(){return g});var r=s(0),o=s(4),i=s(41),n=s(8),c=s(6),a=s(2),u=s(12),d=s(9),l=s(250),h=s(21),f=s(104),v=s(5),p=(s.n(v),s(135)),m=this&&this.__decorate||function(e,t,s,r){var o,i=arguments.length,n=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,s,r);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(n=(i<3?o(n):i>3?o(t,s,n):o(t,s))||n);return i>3&&n&&Object.defineProperty(t,s,n),n},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,s,r,o,i,n,c,a,u){this.domUtils=e,this.coursesProvider=t,this.utils=s,this.myOverviewProvider=r,this.sitesProvider=o,this.courseHelper=i,this.courseOptionsDelegate=n,this.eventsProvider=c,this.navCtrl=a,this.courses={selected:"inprogress",loaded:!1,filter:"",past:[],inprogress:[],future:[]},this.tabShown="courses",this.showFilter=!1,this.timeline={sort:"sortbydates",events:[],loaded:!1,canLoadMore:void 0},this.timelineCourses={courses:[],loaded:!1,canLoadMore:!1},this.prefetchCoursesData={inprogress:{},past:{},future:{}},this.prefetchIconsInitialized=!1,this.courseIds="",this.loadSiteName()}return e.prototype.ionViewDidLoad=function(){var e=this;this.searchEnabled=!this.coursesProvider.isSearchCoursesDisabledInSite(),this.downloadAllCoursesEnabled=!this.coursesProvider.isDownloadCoursesDisabledInSite(),this.updateSiteObserver=this.eventsProvider.on(u.a.SITE_UPDATED,function(){var t=e.downloadAllCoursesEnabled;e.searchEnabled=!e.coursesProvider.isSearchCoursesDisabledInSite(),e.downloadAllCoursesEnabled=!e.coursesProvider.isDownloadCoursesDisabledInSite(),!t&&e.downloadAllCoursesEnabled&&e.courses.loaded&&e.initPrefetchCoursesIcons(),e.loadSiteName()}),this.courses.loaded||this.fetchMyOverviewCourses().finally(function(){e.courses.loaded=!0})},e.prototype.fetchMyOverviewTimeline=function(e){var t=this;return this.myOverviewProvider.getActionEventsByTimesort(e).then(function(e){t.timeline.events=e.events,t.timeline.canLoadMore=e.canLoadMore}).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error getting my overview data.")})},e.prototype.openSearch=function(){this.navCtrl.push("CoreCoursesSearchPage")},e.prototype.fetchMyOverviewTimelineByCourses=function(){var e=this;return this.fetchUserCourses().then(function(t){var s,r=v().unix();if(t=t.filter(function(e){return e.startdate<=r&&(!e.enddate||e.enddate>=r)}),e.timelineCourses.courses=t,t.length>0)return s=t.map(function(e){return e.id}),e.myOverviewProvider.getActionEventsByCourses(s).then(function(t){e.timelineCourses.courses.forEach(function(e){e.events=t[e.id].events,e.canLoadMore=t[e.id].canLoadMore})})}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Error getting my overview data.")})},e.prototype.switchFilter=function(){var e=this;this.showFilter=!this.showFilter,this.courses.filter="",this.filteredCourses=this.courses[this.courses.selected],this.showFilter&&setTimeout(function(){e.searchbar.setFocus()})},e.prototype.fetchMyOverviewCourses=function(){var e=this;return this.fetchUserCourses().then(function(t){var s=v().unix(),r=[];e.courses.past=[],e.courses.inprogress=[],e.courses.future=[],t.forEach(function(t){t.startdate>s?e.courses.future.push(t):t.enddate&&t.enddate<s?e.courses.past.push(t):e.courses.inprogress.push(t),r.find(function(e){return e.id==t.category})||r.push({id:t.category,name:t.categoryname,courses:[]})}),r.forEach(function(e){t.forEach(function(t){e.id==t.category&&e.courses.push(t)})}),r.sort(function(e,t){return e.id-t.id}),e.filteredCategory=r,e.courses.filter="",e.showFilter=!1,e.filteredCourses=e.courses[e.courses.selected],e.initPrefetchCoursesIcons()}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Error getting my overview data.")})},e.prototype.fetchUserCourses=function(){var e=this;return this.coursesProvider.getUserCourses(null,null,1).then(function(t){var s=[],r=t.map(function(e){return e.id});return e.coursesProvider.canGetAdminAndNavOptions()&&s.push(e.coursesProvider.getCoursesAdminAndNavOptions(r).then(function(e){t.forEach(function(t){t.navOptions=e.navOptions[t.id],t.admOptions=e.admOptions[t.id]})})),e.courseIds=r.join(","),e.courseIds&&e.coursesProvider.isGetCoursesByFieldAvailable()&&s.push(e.coursesProvider.getCoursesByField("ids",e.courseIds).then(function(s){s=e.utils.arrayToObject(s,"id"),t.forEach(function(e){e.imageThumb=!!(s[e.id]&&s[e.id].overviewfiles&&s[e.id].overviewfiles[0])&&s[e.id].overviewfiles[0].fileurl})})),Promise.all(s).then(function(){return t.sort(function(e,t){var s=e.fullname.toLowerCase(),r=t.fullname.toLowerCase();return s.localeCompare(r)})})})},e.prototype.initPrefetchCoursesIcons=function(){var e=this;!this.prefetchIconsInitialized&&this.downloadAllCoursesEnabled&&(this.prefetchIconsInitialized=!0,Object.keys(this.prefetchCoursesData).forEach(function(t){!e.courses[t]||e.courses[t].length<2?e.prefetchCoursesData[t].icon="":e.courseHelper.determineCoursesStatus(e.courses[t]).then(function(s){var r=e.courseHelper.getCourseStatusIconAndTitleFromStatus(s).icon;"spinner"==r&&(r="cloud-download"),e.prefetchCoursesData[t].icon=r})}))},e.prototype.refreshMyOverview=function(e){var t=this,s=[];return"timeline"==this.tabShown&&(s.push(this.myOverviewProvider.invalidateActionEventsByTimesort()),s.push(this.myOverviewProvider.invalidateActionEventsByCourses())),s.push(this.coursesProvider.invalidateUserCourses()),s.push(this.courseOptionsDelegate.clearAndInvalidateCoursesOptions()),this.courseIds&&s.push(this.coursesProvider.invalidateCoursesByField("ids",this.courseIds)),Promise.all(s).finally(function(){switch(t.tabShown){case"timeline":switch(t.timeline.sort){case"sortbydates":return t.fetchMyOverviewTimeline();case"sortbycourses":return t.fetchMyOverviewTimelineByCourses()}break;case"courses":return t.prefetchIconsInitialized=!1,t.fetchMyOverviewCourses()}}).finally(function(){e.complete()})},e.prototype.loadSiteName=function(){this.siteName=this.sitesProvider.getCurrentSite().getInfo().sitename},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.updateSiteObserver&&this.updateSiteObserver.off()},m([Object(r._9)(p.a),y("design:type",p.a)],e.prototype,"tabsComponent",void 0),m([Object(r._9)("searchbar"),y("design:type",o.v)],e.prototype,"searchbar",void 0),e=m([Object(r.m)({selector:"page-addon-mandatory-my-mandatory",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="siteName"></core-format-text></ion-title>\n\n        <ion-buttons end>\n            <button *ngIf="searchEnabled" ion-button icon-only (click)="openSearch()" [attr.aria-label]="\'core.courses.searchcourses\' | translate">\n                <ion-icon name="search"></ion-icon>\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n   \n    <ion-refresher [enabled]="timeline.loaded || timelineCourses.loaded || courses.loaded" (ionRefresh)="refreshMyOverview($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="courses.loaded" class="core-loading-center">\n        <core-empty-box *ngIf="courses[courses.selected].length == 0 && courses.selected == \'inprogress\'" image="assets/img/icons/courses.svg" [message]="\'core.courses.nocoursesinprogress\' | translate"></core-empty-box>\n        <core-empty-box *ngIf="courses[courses.selected].length == 0 && courses.selected == \'future\'" image="assets/img/icons/courses.svg" [message]="\'core.courses.nocoursesfuture\' | translate"></core-empty-box>\n        <core-empty-box *ngIf="courses[courses.selected].length == 0 && courses.selected == \'past\'" image="assets/img/icons/courses.svg" [message]="\'core.courses.nocoursespast\' | translate"></core-empty-box>\n        <div>\n            <core-courses-course-list-slide [categories]="filteredCategory">\n            </core-courses-course-list-slide>\n        </div>\n    </core-loading>\n\n</ion-content>'}),y("design:paramtypes",[n.a,i.a,c.a,l.a,a.a,h.a,f.a,u.a,o.q,d.a])],e)}()}});