webpackJsonp([33],{1879:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"CoreLoginCredentialsPageModule",function(){return p});var n=i(0),o=i(4),r=i(2007),s=i(1),a=i(16),l=i(15),c=i(393),u=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s},p=function(){function e(){}return e=u([Object(n.I)({declarations:[r.a],imports:[a.a,l.a,c.a,o.l.forChild(r.a),s.b.forChild()]})],e)}()},2007:function(e,t,i){"use strict";i.d(t,"a",function(){return f});var n=i(0),o=i(4),r=i(1),s=i(2),a=i(8),l=i(11),c=i(6),u=i(118),p=i(71),m=i(20),g=i(119),d=this&&this.__decorate||function(e,t,i,n){var o,r=arguments.length,s=r<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,i):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,i,n);else for(var a=e.length-1;a>=0;a--)(o=e[a])&&(s=(r<3?o(s):r>3?o(t,i,s):o(t,i))||s);return r>3&&s&&Object.defineProperty(t,i,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,i,n,o,r,s,a,l,c,u){this.navCtrl=e,this.fb=i,this.wsProvider=n,this.sitesProvider=o,this.loginHelper=r,this.domUtils=s,this.translate=a,this.utils=l,this.textUtils=c,this.userProfileFieldDelegate=u,this.settingsLoaded=!1,this.captcha={recaptcharesponse:""},this.isMinor=!1,this.siteUrl=t.get("siteUrl"),this.ageVerificationForm=this.fb.group({age:["",m.h.required]}),this.countryControl=this.fb.control("",m.h.required),this.ageVerificationForm.addControl("country",this.countryControl),this.signupForm=this.fb.group({username:["",m.h.required],password:["",m.h.required],email:["",m.h.compose([m.h.required,m.h.email])],email2:["",m.h.compose([m.h.required,m.h.email])]}),this.usernameErrors=this.loginHelper.getErrorMessages("core.login.usernamerequired"),this.passwordErrors=this.loginHelper.getErrorMessages("core.login.passwordrequired"),this.emailErrors=this.loginHelper.getErrorMessages("core.login.missingemail"),this.email2Errors=this.loginHelper.getErrorMessages("core.login.missingemail",void 0,"core.login.emailnotmatch"),this.policyErrors=this.loginHelper.getErrorMessages("core.login.policyagree")}return e.prototype.ionViewDidLoad=function(){var e=this;this.fetchData().finally(function(){e.settingsLoaded=!0})},e.prototype.completeFormGroup=function(){this.signupForm.addControl("city",this.fb.control(this.settings.defaultcity||"")),this.signupForm.addControl("country",this.fb.control(this.settings.country||""));for(var e in this.settings.namefields)this.signupForm.addControl(this.settings.namefields[e],this.fb.control("",m.h.required));this.settings.sitepolicy&&this.signupForm.addControl("policyagreed",this.fb.control(!1,m.h.requiredTrue))},e.prototype.fetchData=function(){var e=this;return this.sitesProvider.getSitePublicConfig(this.siteUrl).then(function(t){if(e.siteConfig=t,e.treatSiteConfig(t))return void 0===e.ageDigitalConsentVerification?e.wsProvider.callAjax("core_auth_is_age_digital_consent_verification_enabled",{},{siteUrl:e.siteUrl}).then(function(t){e.ageDigitalConsentVerification=t.status}).catch(function(e){}).then(function(){return e.getSignupSettings()}):e.getSignupSettings()}).then(function(){e.completeFormGroup()}).catch(function(t){e.domUtils.showErrorModal(t)})},e.prototype.getSignupSettings=function(){var e=this;return this.wsProvider.callAjax("auth_email_get_signup_settings",{},{siteUrl:this.siteUrl}).then(function(t){return e.settings=t,e.categories=e.loginHelper.formatProfileFieldsForSignup(t.profilefields),e.settings.recaptchapublickey&&(e.captcha.recaptcharesponse=""),e.countryControl.value||e.countryControl.setValue(t.country||""),e.namefieldsErrors={},t.namefields&&t.namefields.forEach(function(t){e.namefieldsErrors[t]=e.loginHelper.getErrorMessages("core.login.missing"+t)}),e.utils.getCountryList().then(function(t){e.countries=t,e.countriesKeys=Object.keys(t)})})},e.prototype.treatSiteConfig=function(e){return e&&"email"==e.registerauth&&!this.loginHelper.isEmailSignupDisabled(e)?(this.siteName=e.sitename,this.authInstructions=e.authinstructions,this.ageDigitalConsentVerification=e.agedigitalconsentverification,this.supportName=e.supportname,this.supportEmail=e.supportemail,this.countryControl.setValue(e.country||""),!0):(this.domUtils.showErrorModal(this.translate.instant("core.login.signupplugindisabled",{$a:this.translate.instant("core.login.auth_email")})),this.navCtrl.pop(),!1)},e.prototype.refreshSettings=function(e){this.fetchData().finally(function(){e.complete()})},e.prototype.create=function(){var e=this;if(!this.signupForm.valid||this.settings.recaptchapublickey&&!this.captcha.recaptcharesponse)this.domUtils.scrollToInputError(this.content)||this.domUtils.showErrorModal("core.errorinvalidform",!0);else{var t={username:this.signupForm.value.username.trim().toLowerCase(),password:this.signupForm.value.password,firstname:this.textUtils.cleanTags(this.signupForm.value.firstname),lastname:this.textUtils.cleanTags(this.signupForm.value.lastname),email:this.signupForm.value.email.trim(),city:this.textUtils.cleanTags(this.signupForm.value.city),country:this.signupForm.value.country},i=this.domUtils.showModalLoading("core.sending",!0);if(this.siteConfig.launchurl){var n=this.sitesProvider.determineService(this.siteUrl);t.redirect=this.loginHelper.prepareForSSOLogin(this.siteUrl,n,this.siteConfig.launchurl)}this.settings.recaptchapublickey&&this.captcha.recaptcharesponse&&(t.recaptcharesponse=this.captcha.recaptcharesponse),this.userProfileFieldDelegate.getDataForFields(this.settings.profilefields,!0,"email",this.signupForm.value).then(function(i){t.customprofilefields=i,e.wsProvider.callAjax("auth_email_signup_user",t,{siteUrl:e.siteUrl}).then(function(i){if(i.success){var n=e.translate.instant("core.login.emailconfirmsent",{$a:t.email});e.domUtils.showAlert(e.translate.instant("core.success"),n),e.navCtrl.pop()}else if(i.warnings&&i.warnings.length){var o=i.warnings[0].message;"incorrect-captcha-sol"==o&&(o=e.translate.instant("core.login.recaptchaincorrect")),e.domUtils.showErrorModal(o)}else e.domUtils.showErrorModal("core.login.usernotaddederror",!0)})}).catch(function(t){e.domUtils.showErrorModalDefault(t&&t.error,"core.login.usernotaddederror",!0)}).finally(function(){i.dismiss()})}},e.prototype.showAuthInstructions=function(){this.textUtils.expandText(this.translate.instant("core.login.instructions"),this.authInstructions)},e.prototype.showContactOnSite=function(){this.utils.openInBrowser(this.siteUrl+"/login/verify_age_location.php")},e.prototype.verifyAge=function(){var e=this;if(this.ageVerificationForm.valid){var t=this.domUtils.showModalLoading("core.sending",!0),i=this.ageVerificationForm.value;i.age=parseInt(i.age,10),this.wsProvider.callAjax("core_auth_is_minor",i,{siteUrl:this.siteUrl}).then(function(t){t.status?e.isMinor=!0:e.ageDigitalConsentVerification=!1}).catch(function(){e.domUtils.showErrorModal("There was an error verifying your age, please try again using the browser.")}).finally(function(){t.dismiss()})}else this.domUtils.showErrorModal("core.errorinvalidform",!0)},d([Object(n._9)(o.f),h("design:type",o.f)],e.prototype,"content",void 0),e=d([Object(n.m)({selector:"page-core-login-email-signup",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.login.newaccount\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button ion-button icon-only *ngIf="authInstructions" (click)="showAuthInstructions()" [attr.aria-label]="\'core.login.instructions\' | translate">\n                <ion-icon name="help-circle"></ion-icon>\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <ion-refresher [enabled]="settingsLoaded && !isMinor" (ionRefresh)="refreshSettings($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="settingsLoaded" *ngIf="!isMinor">\n\n        \x3c!-- Age verification. --\x3e\n        <form ion-list *ngIf="settingsLoaded && settings && ageDigitalConsentVerification" [formGroup]="ageVerificationForm" (ngSubmit)="verifyAge()">\n            <ion-item-divider color="light" text-wrap>\n                <p class="item-heading">{{ \'core.agelocationverification\' | translate }}</p>\n            </ion-item-divider>\n\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.whatisyourage\' | translate }}</ion-label>\n                <ion-input type="number" name="age" placeholder="0" formControlName="age" autocapitalize="none" autocorrect="off"></ion-input>\n            </ion-item>\n\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.wheredoyoulive\' | translate }}</ion-label>\n                <ion-select name="country" formControlName="country">\n                    <ion-option value="">{{ \'core.login.selectacountry\' |Â translate }}</ion-option>\n                    <ion-option *ngFor="let key of countriesKeys" [value]="key">{{countries[key]}}</ion-option>\n                </ion-select>\n            </ion-item>\n\n            \x3c!-- Submit button. --\x3e\n            <ion-item padding>\n                <button ion-button block type="submit" [disabled]="!ageVerificationForm.valid">{{ \'core.proceed\' | translate }}</button>\n            </ion-item>\n\n            <ion-item text-wrap>\n                <p class="item-heading">{{ \'core.whyisthisrequired\' | translate }}</p>\n                <p>{{ \'core.explanationdigitalminor\' | translate }}</p>\n            </ion-item>\n        </form>\n\n        \x3c!-- Signup form. --\x3e\n        <form ion-list *ngIf="settingsLoaded && settings && !ageDigitalConsentVerification" [formGroup]="signupForm" (ngSubmit)="create()">\n            <ion-item text-wrap text-center>\n                \x3c!-- If no sitename show big siteurl. --\x3e\n                <p *ngIf="!siteName" padding class="item-heading">{{siteUrl}}</p>\n                \x3c!-- If sitename, show big sitename and small siteurl. --\x3e\n                <p *ngIf="siteName" padding class="item-heading"><core-format-text [text]="siteName"></core-format-text></p>\n                <p *ngIf="siteName">{{siteUrl}}</p>\n            </ion-item>\n\n            \x3c!-- Username and password. --\x3e\n            <ion-item-divider text-wrap color="light">\n                {{ \'core.login.createuserandpass\' | translate }}\n            </ion-item-divider>\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.login.username\' | translate }}</ion-label>\n                <ion-input type="text" name="username" placeholder="{{ \'core.login.username\' | translate }}" formControlName="username" autocapitalize="none" autocorrect="off"></ion-input>\n                <core-input-errors item-content [control]="signupForm.controls.username" [errorMessages]="usernameErrors"></core-input-errors>\n            </ion-item>\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.login.password\' | translate }}</ion-label>\n                <core-show-password item-content [name]="\'password\'">\n                    <ion-input type="password" name="password" placeholder="{{ \'core.login.password\' | translate }}" formControlName="password"></ion-input>\n                </core-show-password>\n                <p *ngIf="settings.passwordpolicy" item-content class="core-input-footnote">\n                    {{settings.passwordpolicy}}\n                </p>\n                <core-input-errors item-content [control]="signupForm.controls.password" [errorMessages]="passwordErrors"></core-input-errors>\n            </ion-item>\n\n            \x3c!-- More details. --\x3e\n            <ion-item-divider text-wrap color="light">\n                {{ \'core.login.supplyinfo\' | translate }}\n            </ion-item-divider>\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.user.email\' | translate }}</ion-label>\n                <ion-input type="email" name="email" placeholder="{{ \'core.user.email\' | translate }}" formControlName="email" autocapitalize="none" autocorrect="off"></ion-input>\n                <core-input-errors item-content [control]="signupForm.controls.email" [errorMessages]="emailErrors"></core-input-errors>\n            </ion-item>\n            <ion-item text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.user.emailagain\' | translate }}</ion-label>\n                <ion-input type="email" name="email2" placeholder="{{ \'core.user.emailagain\' | translate }}" formControlName="email2" autocapitalize="none" autocorrect="off" pattern="{{signupForm.controls.email.value}}"></ion-input>\n                <core-input-errors item-content [control]="signupForm.controls.email2" [errorMessages]="email2Errors"></core-input-errors>\n            </ion-item>\n            <ion-item *ngFor="let nameField of settings.namefields" text-wrap>\n                <ion-label stacked core-mark-required="true">{{ \'core.user.\' + nameField | translate }}</ion-label>\n                <ion-input type="text" name="nameField" placeholder="{{ \'core.user.\' + nameField | translate }}" formControlName="{{nameField}}" autocorrect="off"></ion-input>\n                <core-input-errors item-content [control]="signupForm.controls[nameField]" [errorMessages]="namefieldsErrors[nameField]"></core-input-errors>\n            </ion-item>\n            <ion-item text-wrap>\n                <ion-label stacked>{{ \'core.user.city\' | translate }}</ion-label>\n                <ion-input type="text" name="city" placeholder="{{ \'core.user.city\' | translate }}" formControlName="city" autocorrect="off"></ion-input>\n            </ion-item>\n            <ion-item text-wrap>\n                <ion-label stacked id="core-login-signup-country">{{ \'core.user.country\' | translate }}</ion-label>\n                <ion-select name="country" formControlName="country" aria-labelledby="core-login-signup-country">\n                    <ion-option value="">{{ \'core.login.selectacountry\' |Â translate }}</ion-option>\n                    <ion-option *ngFor="let key of countriesKeys" [value]="key">{{countries[key]}}</ion-option>\n                </ion-select>\n            </ion-item>\n\n            \x3c!-- Other categories. --\x3e\n            <ng-container *ngFor="let category of categories">\n                <ion-item-divider text-wrap color="light">{{ category.name }}</ion-item-divider>\n                <core-user-profile-field *ngFor="let field of category.fields" [field]="field" edit="true" signup="true" registerAuth="email" [form]="signupForm"></core-user-profile-field>\n            </ng-container>\n\n            \x3c!-- ReCAPTCHA --\x3e\n            <ng-container *ngIf="settings.recaptchapublickey">\n                <ion-item-divider text-wrap color="light">{{ \'core.login.security_question\' | translate }}</ion-item-divider>\n                <ion-item text-wrap>\n                    <core-recaptcha [publicKey]="settings.recaptchapublickey" [model]="captcha" [siteUrl]="siteUrl"></core-recaptcha>\n                </ion-item>\n            </ng-container>\n\n            \x3c!-- Site policy (if any). --\x3e\n            <ng-container *ngIf="settings.sitepolicy">\n                <ion-item-divider text-wrap color="light">{{ \'core.login.policyagreement\' | translate }}</ion-item-divider>\n                <ion-item text-wrap>\n                    <p><a [href]="settings.sitepolicy" core-link capture="false">{{ \'core.login.policyagreementclick\' | translate }}</a></p>\n                </ion-item>\n                <ion-item text-wrap>\n                    <ion-label>\n                        <span [core-mark-required]="true">{{ \'core.login.policyaccept\' | translate }}</span>\n                        <core-input-errors [control]="signupForm.controls.policyagreed" [errorMessages]="policyErrors"></core-input-errors>\n                    </ion-label>\n                    <ion-checkbox item-end name="policyagreed" formControlName="policyagreed"></ion-checkbox>\n                </ion-item>\n            </ng-container>\n\n            \x3c!-- Submit button. --\x3e\n            <ion-item padding>\n                <button ion-button block color="primary" type="submit">{{ \'core.login.createaccount\' | translate }}</button>\n            </ion-item>\n        </form>\n    </core-loading>\n\n    <ion-list *ngIf="isMinor">\n        <ion-item-divider color="light" text-wrap>\n            <p *ngIf="siteName" class="item-heading padding"><core-format-text [text]="siteName"></core-format-text></p>\n        </ion-item-divider>\n        <ion-item text-wrap>\n            <p class="item-heading">{{ \'core.considereddigitalminor\' | translate }}</p>\n            <p>{{ \'core.digitalminor_desc\' | translate }}</p>\n            <p *ngIf="supportName">{{ supportName }}</p>\n            <p *ngIf="supportEmail">{{ supportEmail }}</p>\n            <div padding *ngIf="!supportName && !supportEmail">\n                <button ion-button block (click)="showContactOnSite()">\n                    {{ \'core.openinbrowser\' | translate }}\n                </button>\n            </div>\n        </ion-item>\n    </ion-list>\n</ion-content>\n'}),h("design:paramtypes",[o.q,o.r,m.a,u.a,s.a,p.a,a.a,r.c,c.a,l.a,g.a])],e)}()}});