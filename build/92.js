webpackJsonp([92],{1814:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"AddonModDataEntryPageModule",function(){return p});var r=n(0),o=n(4),a=n(1),i=n(15),s=n(16),d=n(392),l=n(391),c=n(390),u=n(1938),f=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i},p=function(){function t(){}return t=f([Object(r.I)({declarations:[u.a],imports:[i.a,s.a,c.a,l.a,d.a,o.l.forChild(u.a),a.b.forChild()]})],t)}()},1938:function(t,e,n){"use strict";n.d(e,"a",function(){return I});var r=n(0),o=n(4),a=n(6),i=n(8),s=n(2),d=n(46),l=n(12),c=n(10),u=n(59),f=n(198),p=n(150),h=n(262),y=n(62),g=n(390),m=this&&this.__decorate||function(t,e,n,r){var o,a=arguments.length,i=a<3?e:null===r?r=Object.getOwnPropertyDescriptor(e,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(t,e,n,r);else for(var s=t.length-1;s>=0;s--)(o=t[s])&&(i=(a<3?o(i):a>3?o(e,n,i):o(e,n))||i);return a>3&&i&&Object.defineProperty(e,n,i),i},v=this&&this.__metadata||function(t,e){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,e)},I=function(){function t(t,e,n,r,o,a,i,s,d,l,c,f){this.utils=e,this.groupsProvider=n,this.domUtils=r,this.fieldsDelegate=o,this.courseProvider=a,this.dataProvider=i,this.dataOffline=s,this.dataHelper=d,this.navCtrl=c,this.eventsProvider=f,this.fields={},this.title="",this.moduleName="data",this.component=u.a.COMPONENT,this.entryLoaded=!1,this.selectedGroup=0,this.offlineActions=[],this.hasOffline=!1,this.cssTemplate="",this.entryRendered="",this.cssClass="",this.extraImports=[g.a],this.module=t.get("module")||{},this.entryId=t.get("entryId")||null,this.courseId=t.get("courseId"),this.selectedGroup=t.get("group")||0,this.page=t.get("page")||null,this.siteId=l.getCurrentSiteId(),this.title=this.module.name,this.moduleName=this.courseProvider.translateModuleName("data")}return t.prototype.ionViewDidLoad=function(){var t=this;this.fetchEntryData(),this.syncObserver=this.eventsProvider.on(h.a.AUTO_SYNCED,function(e){e.entryId!=t.entryId&&e.offlineEntryId!=t.entryId||t.data.id!=e.dataId||(e.deleted?t.navCtrl.pop():(t.entryId=e.entryid,t.entryLoaded=!1,t.fetchEntryData(!0)))},this.siteId),this.entryChangedObserver=this.eventsProvider.on(u.a.ENTRY_CHANGED,function(e){e.entryId==t.entryId&&t.data.id==e.dataId&&(e.deleted?t.navCtrl.pop():(t.entryLoaded=!1,t.fetchEntryData(!0)))},this.siteId)},t.prototype.fetchEntryData=function(t){var e,n=this;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(t){return n.title=t.name||n.title,n.data=t,n.cssClass="addon-data-entries-"+t.id,n.setEntryIdFromPage(t.id,n.page,n.selectedGroup).then(function(){return n.dataProvider.getDatabaseAccessInformation(t.id)})}).then(function(t){return n.access=t,n.groupsProvider.getActivityGroupInfo(n.data.coursemodule,t.canmanageentries).then(function(t){return n.groupInfo=t,t&&t.groups&&t.groups.length>0&&(t.groups.some(function(t){return n.selectedGroup==t.id})||(n.selectedGroup=t.groups[0].id)),n.dataOffline.getEntryActions(n.data.id,n.entryId)})}).then(function(t){return n.offlineActions=t,n.hasOffline=!!t.length,n.dataProvider.getFields(n.data.id).then(function(t){return n.fields=n.utils.arrayToObject(t,"id"),n.dataHelper.getEntry(n.data,n.entryId,n.offlineActions)})}).then(function(t){return t=t.entry,n.cssTemplate=n.dataHelper.prefixCSS(n.data.csstemplate,"."+n.cssClass),t.contents=n.utils.arrayToObject(t.contents,"fieldid"),e=n.utils.objectToArray(n.fields),n.dataHelper.applyOfflineActions(t,n.offlineActions,e)}).then(function(t){n.entry=t;var r=n.dataHelper.getActions(n.data,n.access,n.entry);n.entryRendered=n.dataHelper.displayShowFields(n.data.singletemplate,e,n.entry,"show",r),n.showComments=r.comments;var o={};return o[n.entryId]=n.entry,n.jsData={fields:n.fields,entries:o,data:n.data},n.dataHelper.getPageInfoByEntry(n.data.id,n.entryId,n.selectedGroup).then(function(t){n.previousId=t.previousId,n.nextId=t.nextId})}).catch(function(e){if(!t)return n.refreshAllData();n.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}).finally(function(){n.content&&n.content.scrollToTop(),n.entryLoaded=!0})},t.prototype.gotoEntry=function(t){return this.entryId=t,this.page=null,this.entryLoaded=!1,this.fetchEntryData()},t.prototype.refreshAllData=function(){var t=this,e=[];return e.push(this.dataProvider.invalidateDatabaseData(this.courseId)),this.data&&(e.push(this.dataProvider.invalidateEntryData(this.data.id,this.entryId)),e.push(this.groupsProvider.invalidateActivityGroupInfo(this.data.coursemodule)),e.push(this.dataProvider.invalidateEntriesData(this.data.id))),Promise.all(e).finally(function(){return t.fetchEntryData(!0)})},t.prototype.refreshDatabase=function(t){if(this.entryLoaded)return this.refreshAllData().finally(function(){t&&t.complete()})},t.prototype.setGroup=function(t){var e=this;return this.selectedGroup=t,this.entryLoaded=!1,this.setEntryIdFromPage(this.data.id,0,this.selectedGroup).then(function(){return e.fetchEntryData()})},t.prototype.setEntryIdFromPage=function(t,e,n){var r=this;return"number"==typeof e?this.dataHelper.getPageInfoByPage(t,e,n).then(function(t){r.entryId=t.entryId,r.page=null}):Promise.resolve()},t.prototype.ngOnDestroy=function(){this.syncObserver&&this.syncObserver.off(),this.entryChangedObserver&&this.entryChangedObserver.off()},m([Object(r._9)(o.f),v("design:type",o.f)],t.prototype,"content",void 0),t=m([Object(r.m)({selector:"page-addon-mod-data-entry",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <ion-refresher [enabled]="entryLoaded" (ionRefresh)="refreshDatabase($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="entryLoaded">\n        \x3c!-- Database entries found to be synchronized --\x3e\n        <div class="core-warning-card" icon-start *ngIf="hasOffline">\n            <ion-icon name="warning"></ion-icon>\n            {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n        </div>\n\n        <ion-item text-wrap *ngIf="groupInfo && (groupInfo.separateGroups || groupInfo.visibleGroups)">\n            <ion-label id="addon-data-groupslabel" *ngIf="groupInfo.separateGroups">{{ \'core.groupsseparate\' | translate }}</ion-label>\n            <ion-label id="addon-data-groupslabel" *ngIf="groupInfo.visibleGroups">{{ \'core.groupsvisible\' | translate }}</ion-label>\n            <ion-select [(ngModel)]="selectedGroup" (ionChange)="setGroup(selectedGroup)" aria-labelledby="addon-data-groupslabel" interface="popover">\n                <ion-option *ngFor="let groupOpt of groupInfo.groups" [value]="groupOpt.id">{{groupOpt.name}}</ion-option>\n            </ion-select>\n        </ion-item>\n\n        <div class="addon-data-contents {{cssClass}}">\n            <style *ngIf="cssTemplate">\n                {{ cssTemplate }}\n            </style>\n\n            <core-compile-html [text]="entryRendered" [jsData]="jsData" [extraImports]="extraImports"></core-compile-html>\n        </div>\n\n        <ion-item *ngIf="data && entry">\n            <core-comments contextLevel="module" [instanceId]="data.coursemodule" component="mod_data" [itemId]="entry.id" area="database_entry"></core-comments>\n        </ion-item>\n\n        <ion-grid *ngIf="previousId || nextId">\n            <ion-row align-items-center>\n                <ion-col *ngIf="previousId">\n                    <button ion-button block outline icon-start (click)="gotoEntry(previousId)">\n                        <ion-icon name="arrow-back"></ion-icon>\n                        {{ \'core.previous\' | translate }}\n                    </button>\n                </ion-col>\n                <ion-col *ngIf="nextId">\n                    <button ion-button block icon-end (click)="gotoEntry(nextId)">\n                        {{ \'core.next\' | translate }}\n                        <ion-icon name="arrow-forward"></ion-icon>\n                    </button>\n                </ion-col>\n            </ion-row>\n        </ion-grid>\n    </core-loading>\n</ion-content>\n'}),v("design:paramtypes",[o.r,a.a,d.a,i.a,y.a,c.a,u.a,p.a,f.a,s.a,o.q,l.a])],t)}()}});