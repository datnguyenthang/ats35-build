webpackJsonp([107],{1798:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),i.d(t,"AddonFilesListPageModule",function(){return d});var o=i(0),n=i(4),s=i(1),r=i(16),l=i(15),a=i(1922),f=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},d=function(){function e(){}return e=f([Object(o.I)({declarations:[a.a],imports:[r.a,l.a,n.l.forChild(a.a),s.b.forChild()]})],e)}()},1922:function(e,t,i){"use strict";i.d(t,"a",function(){return v});var o=i(0),n=i(4),s=i(1),r=i(9),l=i(12),a=i(2),f=i(8),d=i(11),h=i(254),c=i(949),u=this&&this.__decorate||function(e,t,i,o){var n,s=arguments.length,r=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,i):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(e,t,i,o);else for(var l=e.length-1;l>=0;l--)(n=e[l])&&(r=(s<3?n(r):s>3?n(t,i,r):n(t,i))||r);return s>3&&r&&Object.defineProperty(t,i,r),r},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(){function e(e,t,i,o,n,s,r,a,f){var d=this;this.sitesProvider=i,this.domUtils=o,this.translate=n,this.appProvider=s,this.filesProvider=r,this.filesHelper=a,this.textUtils=f,this.title=e.get("title")||this.translate.instant("addon.files.files"),this.root=e.get("root"),this.path=e.get("path"),this.updateSiteObserver=t.on(l.a.SITE_UPDATED,function(){d.setVisibility()},i.getCurrentSiteId())}return e.prototype.ionViewDidLoad=function(){this.setVisibility(),this.userQuota=this.sitesProvider.getCurrentSite().getInfo().userquota,this.root||(this.showPrivateFiles?this.root="my":this.showSiteFiles&&(this.root="site")),this.root?this.rootChanged():this.filesLoaded=!0},e.prototype.refreshData=function(e){this.refreshFiles().finally(function(){e.complete()})},e.prototype.rootChanged=function(){var e=this;this.filesLoaded=!1,this.component="my"==this.root?h.a.PRIVATE_FILES_COMPONENT:h.a.SITE_FILES_COMPONENT,this.fetchFiles().finally(function(){e.filesLoaded=!0})},e.prototype.uploadFile=function(){var e=this;this.filesProvider.versionCanUploadFiles().then(function(t){t?e.appProvider.isOnline()?e.filesHelper.uploadPrivateFile(e.filesInfo).then(function(){e.filesLoaded=!1,e.refreshFiles().finally(function(){e.filesLoaded=!0})}).catch(function(){}):e.domUtils.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0):e.domUtils.showAlertTranslated("core.notice","addon.files.erroruploadnotworking")})},e.prototype.setVisibility=function(){this.showPrivateFiles=this.filesProvider.canViewPrivateFiles(),this.showSiteFiles=this.filesProvider.canViewSiteFiles(),this.showUpload=this.filesProvider.canUploadFiles()},e.prototype.fetchFiles=function(){var e,t=this;return this.path?e=this.filesProvider.getFiles(this.path):"site"==this.root?(this.title=this.translate.instant("addon.files.sitefiles"),e=this.filesProvider.getSiteFiles()):"my"==this.root?(this.title=this.translate.instant("addon.files.files"),e=this.filesProvider.getPrivateFiles().then(function(e){return t.showUpload&&t.filesProvider.canGetPrivateFilesInfo()&&t.userQuota>0?t.filesProvider.getPrivateFilesInfo().then(function(i){return t.filesInfo=i,t.spaceUsed=t.textUtils.bytesToSize(i.filesizewithoutreferences,1),t.userQuotaReadable=t.textUtils.bytesToSize(t.userQuota,1),e}):(delete t.userQuota,e)})):e=Promise.reject(null),e.then(function(e){t.files=e}).catch(function(e){t.domUtils.showErrorModalDefault(e,"addon.files.couldnotloadfiles",!0)})},e.prototype.refreshFiles=function(){var e=this,t=[];return t.push(this.filesProvider.invalidateDirectory(this.root,this.path)),t.push(this.filesProvider.invalidatePrivateFilesInfoForUser()),Promise.all(t).finally(function(){return e.fetchFiles()})},e.prototype.ngOnDestroy=function(){this.updateSiteObserver&&this.updateSiteObserver.off()},e=u([Object(o.m)({selector:"page-addon-files-list",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n    </ion-navbar>\n</ion-header>\n<ion-content [class.has-fab]="showUpload && root != \'site\' && !path">\n    <ion-refresher [enabled]="filesLoaded && (showPrivateFiles || showSiteFiles)" (ionRefresh)="refreshData($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="filesLoaded" *ngIf="showPrivateFiles || showSiteFiles">\n        \x3c!-- Allow selecting the files to see: private or site. --\x3e\n        <div no-padding *ngIf="showPrivateFiles && showSiteFiles && !path">\n            <ion-select [(ngModel)]="root" (ngModelChange)="rootChanged()" interface="popover">\n                <ion-option value="my">{{ \'addon.files.privatefiles\' | translate }}</ion-option>\n                <ion-option value="site">{{ \'addon.files.sitefiles\' | translate }}</ion-option>\n            </ion-select>\n        </div>\n\n        \x3c!-- Display info about space used and space left. --\x3e\n        <p class="core-info-card" *ngIf="userQuota && filesInfo && filesInfo.filecount > 0">{{ \'core.quotausage\' | translate:{$a: {used: spaceUsed, total: userQuotaReadable} } }}</p>\n\n        \x3c!-- List of files. --\x3e\n        <ion-list *ngIf="files && files.length > 0">\n            <div *ngFor="let file of files">\n                <a *ngIf="file.isdir" ion-item class="item-media" [navPush]="\'AddonFilesListPage\'" [navParams]="{path: file.link, title: file.filename}">\n                    <img [src]="file.imgPath" alt="" role="presentation" item-start>\n                    <p>{{file.filename}}</p>\n                </a>\n                <core-file *ngIf="!file.isdir" [file]="file" [component]="component" [componentId]="file.contextid"></core-file>\n            </div>\n        </ion-list>\n\n        \x3c!-- Message telling there are no files. --\x3e\n        <core-empty-box *ngIf="!files || !files.length" icon="folder" [message]="\'addon.files.emptyfilelist\' | translate"></core-empty-box>\n    </core-loading>\n\n    \x3c!-- Upload a private file. --\x3e\n    <ion-fab bottom right *ngIf="showUpload && root != \'site\' && !path">\n        <button ion-fab (click)="uploadFile()" [attr.aria-label]="\'core.fileuploader.uploadafile\' | translate">\n            <ion-icon name="add"></ion-icon>\n        </button>\n    </ion-fab>\n</ion-content>'}),p("design:paramtypes",[n.r,l.a,a.a,f.a,s.c,r.a,h.a,c.a,d.a])],e)}()}});