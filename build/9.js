webpackJsonp([9],{1903:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"CoreUserProfilePageModule",function(){return d});var r=n(0),i=n(4),s=n(1),o=n(2031),a=n(15),c=n(16),l=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},d=function(){function e(){}return e=l([Object(r.I)({declarations:[o.a],imports:[a.a,c.a,i.l.forChild(o.a),s.b.forChild()]})],e)}()},2031:function(e,t,n){"use strict";n.d(t,"a",function(){return I});var r=n(0),i=n(4),s=n(26),o=n(937),a=n(8),c=n(1),l=n(41),d=n(12),u=n(2),h=n(77),f=n(107),p=n(57),m=n(133),g=this&&this.__decorate||function(e,t,n,r){var i,s=arguments.length,o=s<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(o=(s<3?i(o):s>3?i(t,n,o):i(t,n))||o);return s>3&&o&&Object.defineProperty(t,n,o),o},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},H=this&&this.__param||function(e,t){return function(n,r){t(n,r,e)}},I=function(){function e(e,t,n,r,i,o,a,c,l,d,u,h,f){var p=this;this.userProvider=t,this.userHelper=n,this.domUtils=r,this.translate=i,this.eventsProvider=o,this.coursesProvider=a,this.sitesProvider=c,this.mimetypeUtils=l,this.fileUploaderHelper=d,this.userDelegate=u,this.navCtrl=h,this.svComponent=f,this.userLoaded=!1,this.isLoadingHandlers=!1,this.isDeleted=!1,this.canChangeProfilePicture=!1,this.actionHandlers=[],this.newPageHandlers=[],this.communicationHandlers=[],this.userId=e.get("userId"),this.courseId=e.get("courseId"),this.site=this.sitesProvider.getCurrentSite(),this.canChangeProfilePicture=(!this.courseId||this.courseId==this.site.getSiteHomeId())&&this.userId==this.site.getUserId()&&this.site.canUploadFiles()&&this.site.wsAvailable("core_user_update_picture")&&!this.userProvider.isUpdatePictureDisabledInSite(this.site),this.obsProfileRefreshed=o.on(s.a.PROFILE_REFRESHED,function(e){p.user&&void 0!==e.user&&(p.user.email=e.user.email,p.user.address=p.userHelper.formatAddress("",e.user.city,e.user.country))},c.getCurrentSiteId())}return e.prototype.ionViewDidLoad=function(){var e=this;this.fetchUser().then(function(){return e.userProvider.logView(e.userId,e.courseId).catch(function(t){e.isDeleted="userdeleted"===t.errorcode})}).finally(function(){e.userLoaded=!0})},e.prototype.fetchUser=function(){var e=this;return this.userProvider.getProfile(this.userId,this.courseId).then(function(t){t.address=e.userHelper.formatAddress("",t.city,t.country),t.roles=e.userHelper.formatRoleList(t.roles),e.user=t,e.title=t.fullname,e.subscription=e.userDelegate.getProfileHandlersFor(t,e.courseId).subscribe(function(t){e.actionHandlers=[],e.newPageHandlers=[],e.communicationHandlers=[],t.forEach(function(t){switch(t.type){case p.a.TYPE_COMMUNICATION:e.communicationHandlers.push(t.data);break;case p.a.TYPE_ACTION:e.actionHandlers.push(t.data);break;case p.a.TYPE_NEW_PAGE:default:e.newPageHandlers.push(t.data)}}),e.isLoadingHandlers=!e.userDelegate.areHandlersLoaded()})}).catch(function(t){t&&e.domUtils.showErrorModal(t)})},e.prototype.changeProfilePicture=function(){var e=this,t=this.translate.instant("core.user.newpicture"),n=this.mimetypeUtils.getGroupMimeInfo("image","mimetypes");return this.fileUploaderHelper.selectAndUploadFile(-1,t,n).then(function(t){var n=e.domUtils.showModalLoading("core.sending",!0);return e.userProvider.changeProfilePicture(t.itemid,e.userId).then(function(t){e.eventsProvider.trigger(s.a.PROFILE_PICTURE_UPDATED,{userId:e.userId,picture:t}),e.sitesProvider.updateSiteInfo(e.site.getId()),e.refreshUser()}).finally(function(){n.dismiss()})}).catch(function(t){t&&e.domUtils.showErrorModal(t)})},e.prototype.refreshUser=function(e){var t=this,n=[];n.push(this.userProvider.invalidateUserCache(this.userId)),n.push(this.coursesProvider.invalidateUserNavigationOptions()),n.push(this.coursesProvider.invalidateUserAdministrationOptions()),Promise.all(n).finally(function(){t.fetchUser().finally(function(){t.eventsProvider.trigger(s.a.PROFILE_REFRESHED,{courseId:t.courseId,userId:t.userId,user:t.user},t.site.getId()),e&&e.complete()})})},e.prototype.openUserDetails=function(){(this.svComponent?this.svComponent.getMasterNav():this.navCtrl).push("CoreUserAboutPage",{courseId:this.courseId,userId:this.userId})},e.prototype.handlerClicked=function(e,t){var n=this.svComponent?this.svComponent.getMasterNav():this.navCtrl;t.action(e,n,this.user,this.courseId)},e.prototype.ngOnDestroy=function(){this.subscription&&this.subscription.unsubscribe(),this.obsProfileRefreshed&&this.obsProfileRefreshed.off(),this.userDelegate.clearUserHandlers()},e=g([Object(r.m)({selector:"page-core-user-profile",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <ion-refresher [enabled]="userLoaded" (ionRefresh)="refreshUser($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="userLoaded">\n        <ion-list *ngIf="user && !isDeleted">\n            <ion-item text-center>\n                <div class="item-avatar-center">\n                    <img class="avatar" [src]="user.profileimageurl" core-external-content alt="{{ \'core.pictureof\' | translate:{$a: user.fullname} }}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n                    <ion-icon name="create" class="core-icon-foreground" *ngIf="canChangeProfilePicture" (click)="changeProfilePicture()"></ion-icon>\n                </div>\n                <h2><core-format-text [text]="user.fullname"></core-format-text></h2>\n                <p><core-format-text *ngIf="user.address" [text]="user.address"></core-format-text></p>\n                <p *ngIf="user.roles">\n                    <strong>{{ \'core.user.roles\' | translate}}</strong>{{\'core.labelsep\' | translate}}\n                    <core-format-text [text]="user.roles"></core-format-text>\n                </p>\n            </ion-item>\n\n            <ion-grid class="core-user-communication-handlers" *ngIf="(communicationHandlers && communicationHandlers.length) || isLoadingHandlers">\n                <ion-row no-padding justify-content-between *ngIf="communicationHandlers && communicationHandlers.length">\n                    <ion-col align-self-center *ngFor="let comHandler of communicationHandlers" text-center>\n                        <a (click)="handlerClicked($event, comHandler)" [ngClass]="[\'core-user-profile-handler\', comHandler.class]" title="{{comHandler.title | translate}}" tappable>\n                            <core-icon [name]="comHandler.icon"></core-icon>\n                            <p>{{comHandler.title | translate}}</p>\n                        </a>\n                    </ion-col>\n                </ion-row>\n                <ion-row no-padding>\n                    <ion-col text-center class="core-loading-handlers" *ngIf="isLoadingHandlers">\n                        <ion-spinner></ion-spinner>\n                    </ion-col>\n                </ion-row>\n            </ion-grid>\n\n            <a ion-item text-wrap class="core-user-profile-handler" (click)="openUserDetails()" title="{{ \'core.user.details\' | translate }}">\n                <ion-icon name="person" item-start></ion-icon>\n                <h2>{{ \'core.user.details\' | translate }}</h2>\n            </a>\n            <ion-item text-center class="core-loading-handlers" *ngIf="isLoadingHandlers">\n                <ion-spinner></ion-spinner>\n            </ion-item>\n\n            <a *ngFor="let npHandler of newPageHandlers" ion-item text-wrap [ngClass]="[\'core-user-profile-handler\', npHandler.class]" (click)="handlerClicked($event, npHandler)" [hidden]="npHandler.hidden" title="{{ npHandler.title | translate }}">\n                <core-icon *ngIf="npHandler.icon" [name]="npHandler.icon" item-start></core-icon>\n                <h2>{{ npHandler.title | translate }}</h2>\n            </a>\n\n            <ion-item *ngIf="actionHandlers && actionHandlers.length">\n                <button *ngFor="let actHandler of actionHandlers" ion-button block outline [ngClass]="[\'core-user-profile-handler\', actHandler.class]" (click)="handlerClicked($event, actHandler)" [hidden]="actHandler.hidden" title="{{ actHandler.title | translate }}" icon-start [disabled]="actHandler.spinner">\n                    <core-icon *ngIf="actHandler.icon" [name]="actHandler.icon" start></core-icon>\n                    <span>{{ actHandler.title | translate }}</span>\n                    <ion-spinner *ngIf="actHandler.spinner"></ion-spinner>\n                </button>\n            </ion-item>\n        </ion-list>\n        <core-empty-box *ngIf="!user && !isDeleted" icon="person" [message]=" \'core.user.detailsnotavailable\' | translate"></core-empty-box>\n\n        <core-empty-box *ngIf="isDeleted" icon="person" [message]="\'core.userdeleted\' | translate"></core-empty-box>\n    </core-loading>\n</ion-content>'}),H(12,Object(r.N)()),v("design:paramtypes",[i.r,s.a,o.a,a.a,c.c,d.a,l.a,u.a,h.a,f.a,p.a,i.q,m.a])],e)}()}});