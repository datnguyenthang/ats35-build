webpackJsonp([74],{1847:function(n,i,t){"use strict";function e(n){return o._42(0,[(n()(),o._16(0,0,null,null,13,"ion-item",[["class","item-title item item-block"],["text-wrap",""]],null,null,null,M.b,M.a)),o._15(1,1097728,null,3,V.a,[K.a,W.a,o.p,o.K,[2,A.a]],null,null),o._37(335544320,2,{contentLabel:0}),o._37(603979776,3,{_buttons:1}),o._37(603979776,4,{_icons:1}),o._15(5,16384,null,0,N.a,[],null,null),(n()(),o._40(-1,2,["\n                "])),(n()(),o._16(7,0,null,3,5,"ion-input",[["name","title"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],null,null,B.b,B.a)),o._15(8,671744,null,0,d.f,[[3,d.b],[8,null],[8,null],[8,null]],{name:[0,"name"]},null),o._35(2048,null,d.m,null,[d.f]),o._15(10,16384,null,0,d.n,[d.m],null,null),o._15(11,5423104,null,0,R.a,[W.a,H.a,K.a,j.a,o.p,o.K,[2,$.a],[2,V.a],[2,d.m],G.a],{type:[0,"type"],placeholder:[1,"placeholder"]},null),o._32(131072,J.a,[q.a,o.i]),(n()(),o._40(-1,2,["\n            "]))],function(n,i){n(i,8,0,"title");n(i,11,0,"text",o._41(i,11,1,o._29(i,12).transform("addon.mod_wiki.newpagetitle")))},function(n,i){n(i,7,0,o._29(i,10).ngClassUntouched,o._29(i,10).ngClassTouched,o._29(i,10).ngClassPristine,o._29(i,10).ngClassDirty,o._29(i,10).ngClassValid,o._29(i,10).ngClassInvalid,o._29(i,10).ngClassPending)})}function l(n){return o._42(0,[(n()(),o._16(0,0,null,null,11,"ion-item",[["class","addon-mod_wiki-wrongversionlock item item-block"],["text-center",""]],null,null,null,M.b,M.a)),o._15(1,1097728,null,3,V.a,[K.a,W.a,o.p,o.K,[2,A.a]],null,null),o._37(335544320,8,{contentLabel:0}),o._37(603979776,9,{_buttons:1}),o._37(603979776,10,{_icons:1}),o._15(5,16384,null,0,N.a,[],null,null),(n()(),o._40(-1,2,["\n                "])),(n()(),o._16(7,0,null,2,3,"ion-badge",[["color","danger"],["padding",""]],null,null,null,null,null)),o._15(8,16384,null,0,z.a,[W.a,o.p,o.K],{color:[0,"color"]},null),(n()(),o._40(9,null,["",""])),o._32(131072,J.a,[q.a,o.i]),(n()(),o._40(-1,2,["\n            "]))],function(n,i){n(i,8,0,"danger")},function(n,i){n(i,9,0,o._41(i,9,0,o._29(i,10).transform("addon.mod_wiki.wrongversionlock")))})}function a(n){return o._42(0,[(n()(),o._16(0,0,null,null,22,"ion-header",[],null,null,null,null,null)),o._15(1,16384,null,0,Q.a,[W.a,o.p,o.K,[2,X.a]],null,null),(n()(),o._40(-1,null,["\n    "])),(n()(),o._16(3,0,null,null,18,"ion-navbar",[["class","toolbar"]],[[8,"hidden",0],[2,"statusbar-padding",null]],null,null,Y.b,Y.a)),o._15(4,49152,null,0,Z.a,[j.a,[2,X.a],[2,nn.a],W.a,o.p,o.K],null,null),(n()(),o._40(-1,3,["\n        "])),(n()(),o._16(6,0,null,3,3,"ion-title",[],null,null,null,tn.b,tn.a)),o._15(7,49152,null,0,en.a,[W.a,o.p,o.K,[2,ln.a],[2,Z.a]],null,null),(n()(),o._16(8,0,null,0,1,"core-format-text",[],null,null,null,null,null)),o._15(9,540672,null,0,an.a,[o.p,g.a,_.a,p.a,q.a,H.a,on.a,un.a,rn.a,sn.a,dn.a,cn.a,[2,nn.a],[2,$.a]],{text:[0,"text"]},null),(n()(),o._40(-1,3,["\n\n        "])),(n()(),o._16(11,0,null,2,9,"ion-buttons",[["end",""]],null,null,null,null,null)),o._15(12,16384,null,1,gn.a,[W.a,o.p,o.K,[2,ln.a],[2,Z.a]],null,null),o._37(603979776,1,{_buttons:1}),(n()(),o._40(-1,null,["\n            "])),(n()(),o._16(15,0,null,null,4,"button",[["clear",""],["ion-button",""]],[[1,"aria-label",0]],[[null,"click"]],function(n,i,t){var e=!0;if("click"===i){e=!1!==n.component.save()&&e}return e},hn.b,hn.a)),o._15(16,1097728,[[1,4]],0,_n.a,[[8,""],W.a,o.p,o.K],{clear:[0,"clear"]},null),o._32(131072,J.a,[q.a,o.i]),(n()(),o._40(18,0,["\n                ","\n            "])),o._32(131072,J.a,[q.a,o.i]),(n()(),o._40(-1,null,["\n        "])),(n()(),o._40(-1,3,["\n    "])),(n()(),o._40(-1,null,["\n"])),(n()(),o._40(-1,null,["\n"])),(n()(),o._16(24,0,null,null,31,"ion-content",[],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,pn.b,pn.a)),o._15(25,4374528,null,0,$.a,[W.a,H.a,G.a,o.p,o.K,j.a,fn.a,o.D,[2,X.a],[2,nn.a]],null,null),(n()(),o._40(-1,1,["\n    "])),(n()(),o._16(27,0,null,1,27,"core-loading",[],null,null,null,In.b,In.a)),o._15(28,638976,null,0,kn.a,[q.a,o.p],{hideUntil:[0,"hideUntil"]},null),(n()(),o._40(-1,0,["\n        "])),(n()(),o._16(30,0,null,0,23,"form",[["ion-list",""],["novalidate",""]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"submit"],[null,"reset"]],function(n,i,t){var e=!0;if("submit"===i){e=!1!==o._29(n,32).onSubmit(t)&&e}if("reset"===i){e=!1!==o._29(n,32).onReset()&&e}return e},null,null)),o._15(31,16384,null,0,d.w,[],null,null),o._15(32,540672,null,0,d.h,[[8,null],[8,null]],{form:[0,"form"]},null),o._35(2048,null,d.b,null,[d.h]),o._15(34,16384,null,0,d.o,[d.b],null,null),(n()(),o._40(-1,null,["\n            "])),(n()(),o._11(16777216,null,null,1,null,e)),o._15(37,16384,null,0,wn.k,[o.W,o.T],{ngIf:[0,"ngIf"]},null),(n()(),o._40(-1,null,["\n\n            "])),(n()(),o._16(39,0,null,null,10,"ion-item",[["class","item item-block"]],null,null,null,M.b,M.a)),o._15(40,1097728,null,3,V.a,[K.a,W.a,o.p,o.K,[2,A.a]],null,null),o._37(335544320,5,{contentLabel:0}),o._37(603979776,6,{_buttons:1}),o._37(603979776,7,{_icons:1}),o._15(44,16384,null,0,N.a,[],null,null),(n()(),o._40(-1,2,["\n                "])),(n()(),o._16(46,0,null,3,2,"core-rich-text-editor",[["item-content",""],["name","wiki_page_content"]],null,null,null,mn.b,mn.a)),o._15(47,1228800,null,0,vn.a,[_.a,bn.a,un.a,g.a,sn.a,[2,$.a],o.p,c.a,on.a],{placeholder:[0,"placeholder"],control:[1,"control"],name:[2,"name"],component:[3,"component"],componentId:[4,"componentId"]},null),o._32(131072,J.a,[q.a,o.i]),(n()(),o._40(-1,2,["\n            "])),(n()(),o._40(-1,null,["\n\n            "])),(n()(),o._11(16777216,null,null,1,null,l)),o._15(52,16384,null,0,wn.k,[o.W,o.T],{ngIf:[0,"ngIf"]},null),(n()(),o._40(-1,null,["\n        "])),(n()(),o._40(-1,0,["\n    "])),(n()(),o._40(-1,1,["\n"])),(n()(),o._40(-1,null,["\n"]))],function(n,i){var t=i.component;n(i,9,0,t.title);n(i,16,0,"");n(i,28,0,t.loaded);n(i,32,0,t.pageForm);n(i,37,0,t.canEditTitle);n(i,47,0,o._41(i,47,0,o._29(i,48).transform("core.content")),t.contentControl,"wiki_page_content",t.component,t.componentId);n(i,52,0,t.wrongVersionLock)},function(n,i){n(i,3,0,o._29(i,4)._hidden,o._29(i,4)._sbPadding);n(i,15,0,o._41(i,15,0,o._29(i,17).transform("core.save")));n(i,18,0,o._41(i,18,0,o._29(i,19).transform("core.save")));n(i,24,0,o._29(i,25).statusbarPadding,o._29(i,25)._hasRefresher);n(i,30,0,o._29(i,34).ngClassUntouched,o._29(i,34).ngClassTouched,o._29(i,34).ngClassPristine,o._29(i,34).ngClassDirty,o._29(i,34).ngClassValid,o._29(i,34).ngClassInvalid,o._29(i,34).ngClassPending)})}Object.defineProperty(i,"__esModule",{value:!0});var o=t(1),u=(t(0),t(10),t(6)),r=t(32),s=t(31),d=t(18),c=t(20),g=t(2),h=t(83),_=t(5),p=t(12),f=t(15),I=t(43),k=t(202),w=t(250),m=t(281),v=function(){function n(n,i,t,e,l,a,o,u,r,s,d,c,g,h){this.navCtrl=t,this.sitesProvider=e,this.syncProvider=l,this.domUtils=a,this.translate=o,this.courseProvider=u,this.eventsProvider=r,this.wikiProvider=s,this.wikiOffline=d,this.wikiSync=c,this.textUtils=g,this.courseHelper=h,this.component=k.a.COMPONENT,this.forceLeave=!1,this.isDestroyed=!1,this.module=n.get("module")||{},this.courseId=n.get("courseId"),this.subwikiId=n.get("subwikiId"),this.wikiId=n.get("wikiId"),this.pageId=n.get("pageId"),this.section=n.get("section"),this.groupId=n.get("groupId"),this.userId=n.get("userId");var _=n.get("pageTitle");_=_?_.replace(/\+/g," "):"",this.initialSubwikiId=this.subwikiId,this.componentId=this.module.id,this.canEditTitle=!_,this.title=_?this.translate.instant("addon.mod_wiki.editingpage",{$a:_}):this.translate.instant("addon.mod_wiki.newpagehdr"),this.blockId=this.wikiSync.getSubwikiBlockId(this.subwikiId,this.wikiId,this.userId,this.groupId),this.contentControl=i.control(""),this.pageForm=i.group({title:_}),this.pageForm.addControl("text",this.contentControl),this.syncProvider.blockOperation(this.component,this.blockId)}return n.prototype.ngOnInit=function(){var n=this;this.fetchWikiPageData().then(function(i){if(i&&n.blockId&&!n.isDestroyed){var t=n.wikiSync.getSubwikiBlockId(n.subwikiId,n.wikiId,n.userId,n.groupId);t!=n.blockId&&(n.syncProvider.unblockOperation(n.component,n.blockId),n.blockId=t,n.syncProvider.blockOperation(n.component,n.blockId))}}).finally(function(){n.loaded=!0})},n.prototype.fetchWikiPageData=function(){var n,i=this,t=!1;if(this.pageId)this.canEditTitle=!1,this.editing=!0,this.editOffline=!1,n=this.wikiProvider.getPageContents(this.pageId).then(function(n){return i.pageForm.controls.title.setValue(n.title),i.wikiId=n.wikiid,i.subwikiId=n.subwikiid,i.title=i.translate.instant("addon.mod_wiki.editingpage",{$a:n.title}),i.groupId=n.groupid,i.userId=n.userid,t=n.caneditpage,i.wikiSync.waitForSync(i.blockId)}).then(function(){return i.wikiProvider.getSubwikiFiles(i.wikiId,i.groupId,i.userId)}).then(function(n){return i.subwikiFiles=n,i.wikiProvider.getPageForEditing(i.pageId,i.section)}).then(function(n){var e=i.textUtils.replacePluginfileUrls(n.content,i.subwikiFiles);i.contentControl.setValue(e),i.originalContent=e,i.version=n.version,t&&(i.renewLockInterval=setInterval(function(){i.renewLock()},k.a.RENEW_LOCK_TIME))});else{var e=this.pageForm.controls.title.value;n=this.wikiSync.waitForSync(this.blockId),e?n=n.then(function(n){if(n){var t=n.created.find(function(n){return n.title==e});if(t&&t.pageId>0)return i.pageId=t.pageId,i.fetchWikiPageData()}return i.wikiOffline.getNewPage(e,i.subwikiId,i.wikiId,i.userId,i.groupId)}).then(function(n){i.contentControl.setValue(n.cachedcontent),i.originalContent=n.cachedcontent,i.editOffline=!0}).catch(function(){i.editOffline=!1}):this.editOffline=!1,n.then(function(){i.editing=!1,t=!!i.blockId})}return n.then(function(){return!0}).catch(function(n){return i.domUtils.showErrorModalDefault(n,"Error getting wiki data."),i.forceLeavePage(),!1}).finally(function(){t||(i.domUtils.showAlert(i.translate.instant("core.notice"),i.translate.instant("addon.mod_wiki.cannoteditpage")),i.forceLeavePage())})},n.prototype.forceLeavePage=function(){this.forceLeave=!0,this.navCtrl.pop()},n.prototype.goToNewOfflinePage=function(n){this.courseId&&(this.module.id||this.wikiId)?this.editOffline&&!this.previousViewPageIsDifferentOffline(n)||(this.pageParamsToLoad={module:this.module,courseId:this.courseId,pageId:null,pageTitle:n,wikiId:this.wikiId,subwikiId:this.subwikiId,userId:this.userId,groupId:this.groupId}):this.domUtils.showAlert(this.translate.instant("core.success"),this.translate.instant("core.datastoredoffline")),this.forceLeavePage()},n.prototype.gotoPage=function(n){var i=this;return this.retrieveModuleInfo(this.wikiId).then(function(){var t=!1;i.initialSubwikiId&&(!i.editing&&i.editOffline&&i.previousViewPageIsDifferentOffline(n)?t=!0:!i.editOffline&&i.previousViewIsDifferentPageOnline()&&(t=!0)),t&&(i.pageParamsToLoad={module:i.module,courseId:i.courseId,pageId:i.pageId,pageTitle:n,wikiId:i.wikiId,subwikiId:i.subwikiId,userId:i.userId,groupId:i.groupId}),i.forceLeavePage()}).catch(function(){i.forceLeavePage()})},n.prototype.hasDataChanged=function(){var n=this.pageForm.value;return!(this.originalContent==n.text||!this.editing&&!n.text&&!n.title)},n.prototype.ionViewCanLeave=function(){return!!this.forceLeave||(!this.hasDataChanged()||this.domUtils.showConfirm(this.translate.instant("core.confirmcanceledit")))},n.prototype.ionViewDidLeave=function(){this.pageParamsToLoad&&this.navCtrl.push("AddonModWikiIndexPage",this.pageParamsToLoad)},n.prototype.previousViewIsDifferentPageOnline=function(){var n=this.navCtrl.getPrevious();return!this.editing||"AddonModWikiIndexPage"!=n.component.name||n.data.module.id!=this.module.id||n.data.pageId!=this.pageId},n.prototype.previousViewPageIsDifferentOffline=function(n){var i=this.navCtrl.getPrevious();if("AddonModWikiIndexPage"!=i.component.name||i.data.module.id!=this.module.id||i.data.wikiId!=this.wikiId||i.data.pageTitle!=n)return!0;var t=parseInt(i.data.subwikiId,10)||0;if(t>0&&this.subwikiId>0)return t!=this.subwikiId;var e=parseInt(i.data.userId,10)||0,l=parseInt(i.data.groupId,10)||0;return this.userId!=e||this.groupId!=l},n.prototype.save=function(){var n,i=this,t=this.pageForm.value,e=t.title,l=this.domUtils.showModalLoading("core.sending",!0),a=t.text;if(a=this.textUtils.restorePluginfileUrls(a,this.subwikiFiles),a=this.textUtils.formatHtmlLines(a),this.editing)n=this.wikiProvider.editPage(this.pageId,a,this.section).then(function(){return i.wikiProvider.invalidatePage(i.pageId).then(function(){return i.gotoPage(e)})});else{if(!e)return this.domUtils.showAlert(this.translate.instant("core.notice"),this.translate.instant("addon.mod_wiki.titleshouldnotbeempty")),void l.dismiss();n=(n=this.editOffline?Promise.resolve():this.wikiOffline.getNewPage(e,this.subwikiId,this.wikiId,this.userId,this.groupId).then(function(){return Promise.reject(i.translate.instant("addon.mod_wiki.pageexists"))},function(){})).then(function(){var n=i.wikiId||i.module&&i.module.instance;return i.wikiProvider.newPage(e,a,i.subwikiId,n,i.userId,i.groupId).then(function(t){if(t>0)return i.pageId=t,i.wikiProvider.getPageContents(i.pageId).then(function(t){var l=[];return n=parseInt(t.wikiid,10),i.subwikiId||l.push(i.wikiProvider.invalidateSubwikis(n)),i.subwikiId=parseInt(t.subwikiid,10),i.userId=parseInt(t.userid,10),i.groupId=parseInt(t.groupid,10),l.push(i.wikiProvider.invalidateSubwikiPages(n)),Promise.all(l).then(function(){return i.gotoPage(e)})}).finally(function(){i.eventsProvider.trigger(k.a.PAGE_CREATED_EVENT,{pageId:i.pageId,subwikiId:i.subwikiId,pageTitle:e},i.sitesProvider.getCurrentSiteId())});i.goToNewOfflinePage(e)})})}return n.catch(function(n){i.domUtils.showErrorModalDefault(n,"Error saving wiki data.")}).finally(function(){l.dismiss()})},n.prototype.renewLock=function(){var n=this;this.wikiProvider.getPageForEditing(this.pageId,this.section,!0).then(function(i){i.version&&n.version!=i.version&&(n.wrongVersionLock=!0)})},n.prototype.retrieveModuleInfo=function(n){var i=this;if(this.module.id&&this.courseId)return Promise.resolve();return(this.module.id?Promise.resolve(this.module):this.courseProvider.getModuleBasicInfoByInstance(n,"wiki")).then(function(t){if(i.module=t,i.componentId=i.module.id,!i.courseId&&i.module.course)i.courseId=i.module.course;else if(!i.courseId)return i.courseHelper.getModuleCourseIdByInstance(n,"wiki").then(function(n){i.courseId=n})})},n.prototype.ngOnDestroy=function(){this.isDestroyed=!0,clearInterval(this.renewLockInterval),this.blockId&&this.syncProvider.unblockOperation(this.component,this.blockId)},n}(),b=function(){return function(){}}(),P=t(1290),y=t(1291),C=t(1292),O=t(1293),L=t(1294),x=t(1295),T=t(1296),D=t(1297),E=t(1298),U=t(1301),F=t(1302),S=t(1303),M=t(34),V=t(21),K=t(19),W=t(7),A=t(29),N=t(33),B=t(90),R=t(73),H=t(14),j=t(27),$=t(25),G=t(26),J=t(28),q=t(17),z=t(212),Q=t(419),X=t(35),Y=t(1299),Z=t(191),nn=t(22),tn=t(1300),en=t(326),ln=t(237),an=t(38),on=t(3),un=t(24),rn=t(4),sn=t(16),dn=t(11),cn=t(23),gn=t(420),hn=t(45),_n=t(39),pn=t(176),fn=t(97),In=t(55),kn=t(49),wn=t(9),mn=t(269),vn=t(213),bn=t(165),Pn=t(58),yn=o._14({encapsulation:2,styles:[],data:{}}),Cn=o._12("page-addon-mod-wiki-edit",v,function(n){return o._42(0,[(n()(),o._16(0,0,null,null,1,"page-addon-mod-wiki-edit",[],null,null,null,a,yn)),o._15(1,245760,null,0,v,[Pn.a,d.d,nn.a,g.a,h.a,_.a,q.a,f.a,c.a,k.a,w.a,m.a,p.a,I.a],null,null)],function(n,i){n(i,1,0)},null)},{},{},[]),On=t(322),Ln=t(323),xn=t(325),Tn=t(324),Dn=t(418),En=t(640),Un=t(107),Fn=t(238);t.d(i,"AddonModWikiEditPageModuleNgFactory",function(){return Sn});var Sn=o._13(b,[],function(n){return o._25([o._26(512,o.n,o._6,[[8,[P.a,y.a,C.a,O.a,L.a,x.a,T.a,D.a,E.a,U.a,F.a,S.a,Cn]],[3,o.n],o.B]),o._26(4608,wn.m,wn.l,[o.x,[2,wn.v]]),o._26(4608,d.x,d.x,[]),o._26(4608,d.d,d.d,[]),o._26(4608,On.b,On.a,[]),o._26(4608,Ln.a,Ln.b,[]),o._26(4608,xn.b,xn.a,[]),o._26(4608,Tn.b,Tn.a,[]),o._26(4608,q.a,q.a,[Dn.a,On.b,Ln.a,xn.b,Tn.b,q.b,q.c]),o._26(512,wn.b,wn.b,[]),o._26(512,d.v,d.v,[]),o._26(512,d.i,d.i,[]),o._26(512,d.s,d.s,[]),o._26(512,En.a,En.a,[]),o._26(512,u.a,u.a,[]),o._26(512,s.a,s.a,[]),o._26(512,Un.a,Un.a,[]),o._26(512,r.a,r.a,[]),o._26(512,En.b,En.b,[]),o._26(512,b,b,[]),o._26(256,q.c,void 0,[]),o._26(256,q.b,void 0,[]),o._26(256,Fn.a,v,[])])})}});