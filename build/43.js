webpackJsonp([43],{1869:function(e,o,s){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),s.d(o,"CoreCoursesMyCoursesPageModule",function(){return l});var r=s(0),t=s(4),n=s(1),i=s(1997),c=s(16),a=s(931),u=this&&this.__decorate||function(e,o,s,r){var t,n=arguments.length,i=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,s,r);else for(var c=e.length-1;c>=0;c--)(t=e[c])&&(i=(n<3?t(i):n>3?t(o,s,i):t(o,s))||i);return n>3&&i&&Object.defineProperty(o,s,i),i},l=function(){function e(){}return e=u([Object(r.I)({declarations:[i.a],imports:[c.a,a.a,t.l.forChild(i.a),n.b.forChild()]})],e)}()},1997:function(e,o,s){"use strict";s.d(o,"a",function(){return p});var r=s(0),t=s(4),n=s(12),i=s(2),c=s(8),a=s(6),u=s(41),l=s(21),d=s(105),h=this&&this.__decorate||function(e,o,s,r){var t,n=arguments.length,i=n<3?o:null===r?r=Object.getOwnPropertyDescriptor(o,s):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,o,s,r);else for(var c=e.length-1;c>=0;c--)(t=e[c])&&(i=(n<3?t(i):n>3?t(o,s,i):t(o,s))||i);return n>3&&i&&Object.defineProperty(o,s,i),i},f=this&&this.__metadata||function(e,o){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,o)},p=function(){function e(e,o,s,r,t,n,i,c){this.navCtrl=e,this.coursesProvider=o,this.domUtils=s,this.eventsProvider=r,this.sitesProvider=t,this.courseHelper=n,this.courseOptionsDelegate=i,this.utils=c,this.filter="",this.showFilter=!1,this.coursesLoaded=!1,this.prefetchCoursesData={},this.prefetchIconInitialized=!1,this.isDestroyed=!1,this.courseIds=""}return e.prototype.ionViewDidLoad=function(){var e=this;this.searchEnabled=!this.coursesProvider.isSearchCoursesDisabledInSite(),this.downloadAllCoursesEnabled=!this.coursesProvider.isDownloadCoursesDisabledInSite(),this.fetchCourses().finally(function(){e.coursesLoaded=!0}),this.myCoursesObserver=this.eventsProvider.on(u.a.EVENT_MY_COURSES_UPDATED,function(){e.fetchCourses()},this.sitesProvider.getCurrentSiteId()),this.siteUpdatedObserver=this.eventsProvider.on(n.a.SITE_UPDATED,function(){var o=e.downloadAllCoursesEnabled;e.searchEnabled=!e.coursesProvider.isSearchCoursesDisabledInSite(),e.downloadAllCoursesEnabled=!e.coursesProvider.isDownloadCoursesDisabledInSite(),!o&&e.downloadAllCoursesEnabled&&e.coursesLoaded&&e.initPrefetchCoursesIcon()},this.sitesProvider.getCurrentSiteId())},e.prototype.fetchCourses=function(){var e=this;return this.coursesProvider.getUserCourses().then(function(o){var s=[],r=o.map(function(e){return e.id});return e.courseIds=r.join(","),e.courseIds&&e.coursesProvider.isGetCoursesByFieldAvailable()&&s.push(e.coursesProvider.getCoursesByField("ids",e.courseIds).then(function(s){s=e.utils.arrayToObject(s,"id"),o.forEach(function(e){e.imageThumb=!!(s[e.id]&&s[e.id].overviewfiles&&s[e.id].overviewfiles[0])&&s[e.id].overviewfiles[0].fileurl})})),e.coursesProvider.canGetAdminAndNavOptions()&&s.push(e.coursesProvider.getCoursesAdminAndNavOptions(r).then(function(e){o.forEach(function(o){o.navOptions=e.navOptions[o.id],o.admOptions=e.admOptions[o.id]})})),Promise.all(s).then(function(){e.courses=o,e.filteredCourses=e.courses,e.filter="",e.initPrefetchCoursesIcon()})}).catch(function(o){e.domUtils.showErrorModalDefault(o,"core.courses.errorloadcourses",!0)})},e.prototype.refreshCourses=function(e){var o=this,s=[];s.push(this.coursesProvider.invalidateUserCourses()),s.push(this.courseOptionsDelegate.clearAndInvalidateCoursesOptions()),this.courseIds&&s.push(this.coursesProvider.invalidateCoursesByField("ids",this.courseIds)),Promise.all(s).finally(function(){o.prefetchIconInitialized=!1,o.fetchCourses().finally(function(){e.complete()})})},e.prototype.switchFilter=function(){var e=this;this.filter="",this.showFilter=!this.showFilter,this.filteredCourses=this.courses,this.showFilter&&setTimeout(function(){e.searchbar.setFocus()})},e.prototype.openSearch=function(){this.navCtrl.push("CoreCoursesSearchPage")},e.prototype.filterChanged=function(e){var o=e.target.value&&e.target.value.trim().toLowerCase();this.filteredCourses=o&&this.courses?this.courses.filter(function(e){return e.fullname.toLowerCase().indexOf(o)>-1}):this.courses},e.prototype.prefetchCourses=function(){var e=this,o=this.prefetchCoursesData.icon;return this.prefetchCoursesData.icon="spinner",this.prefetchCoursesData.badge="",this.courseHelper.confirmAndPrefetchCourses(this.courses,function(o){e.prefetchCoursesData.badge=o.count+" / "+o.total}).then(function(){e.prefetchCoursesData.icon="ion-android-refresh"}).catch(function(s){e.isDestroyed||(e.domUtils.showErrorModalDefault(s,"core.course.errordownloadingcourse",!0),e.prefetchCoursesData.icon=o)}).finally(function(){e.prefetchCoursesData.badge=""})},e.prototype.initPrefetchCoursesIcon=function(){var e=this;!this.prefetchIconInitialized&&this.downloadAllCoursesEnabled&&(this.prefetchIconInitialized=!0,!this.courses||this.courses.length<2?this.prefetchCoursesData.icon="":this.courseHelper.determineCoursesStatus(this.courses).then(function(o){var s=e.courseHelper.getCourseStatusIconAndTitleFromStatus(o).icon;"spinner"==s&&(s="cloud-download"),e.prefetchCoursesData.icon=s}))},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.myCoursesObserver&&this.myCoursesObserver.off(),this.siteUpdatedObserver&&this.siteUpdatedObserver.off()},h([Object(r._9)("searchbar"),f("design:type",t.v)],e.prototype,"searchbar",void 0),e=h([Object(r.m)({selector:"page-core-courses-my-courses",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.courses.mycourses\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button *ngIf="searchEnabled" ion-button icon-only (click)="openSearch()" [attr.aria-label]="\'core.courses.searchcourses\' | translate">\n                <ion-icon name="search"></ion-icon>\n            </button>\n            <core-context-menu>\n                <core-context-menu-item [hidden]="!downloadAllCoursesEnabled || !courses || courses.length < 2" [priority]="800" [content]="\'core.courses.downloadcourses\' | translate" (action)="prefetchCourses()" [iconAction]="prefetchCoursesData.icon" [closeOnClick]="false" [badge]="prefetchCoursesData.badge"></core-context-menu-item>\n                <core-context-menu-item [hidden]="!courses || courses.length <= 5" [priority]="700" [content]="\'core.courses.filtermycourses\' | translate" (action)="switchFilter()" [iconAction]="\'funnel\'"></core-context-menu-item>\n            </core-context-menu>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n\n    <ion-refresher [enabled]="coursesLoaded" (ionRefresh)="refreshCourses($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="coursesLoaded">\n        <ion-searchbar #searchbar *ngIf="showFilter" [(ngModel)]="filter" (ionInput)="filterChanged($event)" (ionCancel)="filterChanged()" [placeholder]="\'core.courses.filtermycourses\' | translate">\n        </ion-searchbar>\n        \n        <ion-grid no-padding>\n            <ion-row no-padding>\n                <ion-col *ngFor="let course of filteredCourses" no-padding col-12 col-sm-6 col-md-6 col-lg-4 col-xl-4 align-self-stretch>\n                    <core-courses-course-progress [course]="course" class="core-courseoverview"></core-courses-course-progress>\n                </ion-col>\n            </ion-row>\n        </ion-grid>\n        <core-empty-box *ngIf="!courses || !courses.length" icon="ionic" [message]="\'core.courses.nocourses\' | translate">\n            <p *ngIf="searchEnabled">{{ \'core.courses.searchcoursesadvice\' | translate }}</p>\n        </core-empty-box>\n    </core-loading>\n</ion-content>\n'}),f("design:paramtypes",[t.q,u.a,c.a,n.a,i.a,l.a,d.a,a.a])],e)}()}});