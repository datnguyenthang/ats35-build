webpackJsonp([121],[,,function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(154),i=n(1),s=n(9),a=n(12),c=n(7),u=n(712),d=n(11),l=n(47),f=n(30),p=n(72),h=n(109),m=(n.n(h),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(){function e(e,t,n,o,r,i,s,a){this.http=t,this.sitesFactory=n,this.appProvider=o,this.translate=r,this.urlUtils=i,this.eventsProvider=s,this.textUtils=a,this.SITES_TABLE="sites",this.CURRENT_SITE_TABLE="current_site",this.appTablesSchema=[{name:this.SITES_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"siteUrl",type:"TEXT",notNull:!0},{name:"token",type:"TEXT"},{name:"info",type:"TEXT"},{name:"privateToken",type:"TEXT"},{name:"config",type:"TEXT"},{name:"loggedOut",type:"INTEGER"}]},{name:this.CURRENT_SITE_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"siteId",type:"TEXT",notNull:!0,unique:!0}]}],this.VALID_VERSION=1,this.LEGACY_APP_VERSION=0,this.INVALID_VERSION=-1,this.services={},this.sessionRestored=!1,this.sites={},this.siteTablesSchemas=[],this.logger=e.getInstance("CoreSitesProvider"),this.appDB=o.getDB(),this.appDB.createTablesFromSchema(this.appTablesSchema)}return e.prototype.getDemoSiteData=function(e){var t=p.a.demo_sites;if(void 0!==t&&void 0!==t[e])return t[e]},e.prototype.checkSite=function(e,t){var n=this;return void 0===t&&(t="https://"),e=this.urlUtils.formatURL(e),this.urlUtils.isHttpURL(e)?this.appProvider.isOnline()?this.checkSiteWithProtocol(e,t).catch(function(o){return o.critical?Promise.reject(o.error):(t="https://"==t?"http://":"https://",n.checkSiteWithProtocol(e,t).catch(function(e){return e.error?Promise.reject(e.error):o.error?Promise.reject(o.error):Promise.reject(n.translate.instant("core.login.checksiteversion"))}))}):Promise.reject(this.translate.instant("core.networkerrormsg")):Promise.reject(this.translate.instant("core.login.invalidsite"))},e.prototype.checkSiteWithProtocol=function(e,t){function n(e,t){return Promise.reject({error:e,errorcode:t,critical:!0})}var o,r=this;return e=e.replace(/^http(s)?\:\/\//i,t),this.siteExists(e).catch(function(t){if(t.errorcode&&"enablewsdescription"==t.errorcode)return n(t.error,t.errorcode);var o=r.urlUtils.addOrRemoveWWW(e);return r.siteExists(o).then(function(){e=o}).catch(function(e){return e.errorcode&&"enablewsdescription"==e.errorcode?n(e.error,e.errorcode):(t=e||t,Promise.reject({error:"object"==typeof t?t.error:t}))})}).then(function(){var t=r.sitesFactory.makeSite(void 0,e);return t.checkLocalMobilePlugin().then(function(i){return i.service=i.service||p.a.wsservice,r.services[e]=i.service,i.coreSupported||i.code!=f.a.LOGIN_SSO_CODE&&i.code!=f.a.LOGIN_SSO_INAPP_CODE?t.getPublicConfig().then(function(e){if(o=e,!e.enablewebservices)return n(r.translate.instant("core.login.webservicesnotenabled"));if(!e.enablemobilewebservice)return n(r.translate.instant("core.login.mobileservicesnotenabled"));if(e.maintenanceenabled){var t=r.translate.instant("core.sitemaintenance");return e.maintenancemessage&&(t+=e.maintenancemessage),n(t)}return 0===i.code&&(i.code=e.typeoflogin),i},function(e){return 1===e.available?Promise.reject({error:e.error}):i}):i}).then(function(n){return e=t.getURL(),{siteUrl:e,code:n.code,warning:n.warning,service:n.service,config:o}})})},e.prototype.siteExists=function(e){var t={};this.appProvider.isMobile()||(t.username="a",t.password="b",t.service="c");return this.http.post(e+"/login/token.php",t).timeout(f.a.WS_TIMEOUT).toPromise().catch(function(e){return Promise.reject(e.message)}).then(function(e){return!e.errorcode||"enablewsdescription"!=e.errorcode&&"requirecorrectaccess"!=e.errorcode?e.error&&"Web services must be enabled in Advanced features."==e.error?Promise.reject({errorcode:"enablewsdescription",error:e.error}):void 0:Promise.reject({errorcode:e.errorcode,error:e.error})})},e.prototype.getUserToken=function(e,t,n,o,r){var i=this;if(!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.networkerrormsg"));o||(o=this.determineService(e));return this.http.post(e+"/login/token.php",{username:t,password:n,service:o}).timeout(f.a.WS_TIMEOUT).toPromise().then(function(s){return void 0===s?Promise.reject(i.translate.instant("core.cannotconnect")):void 0!==s.token?{token:s.token,siteUrl:e,privateToken:s.privatetoken}:void 0!==s.error?r||"requirecorrectaccess"!=s.errorcode?void 0!==s.errorcode?Promise.reject({error:s.error,errorcode:s.errorcode}):Promise.reject(s.error):(e=i.urlUtils.addOrRemoveWWW(e),i.getUserToken(e,t,n,o,!0)):Promise.reject(i.translate.instant("core.login.invalidaccount"))},function(){return Promise.reject(i.translate.instant("core.cannotconnect"))})},e.prototype.newSite=function(e,t,n){var o=this;void 0===n&&(n="");var r=this.sitesFactory.makeSite(void 0,e,t,void 0,n);return r.fetchSiteInfo().then(function(i){var s=o.isValidMoodleVersion(i);if(s==o.VALID_VERSION){var c=o.createSiteID(i.siteurl,i.username);return r.setId(c),r.setInfo(i),o.getSiteConfig(r).then(function(s){return r.setConfig(s),o.addSite(c,e,t,i,n,s),o.currentSite=r,o.sites[c]=r,o.login(c),o.eventsProvider.trigger(a.a.SITE_ADDED,{},c),o.siteTablesSchemas.length&&r.getDb().createTablesFromSchema(o.siteTablesSchemas),c})}return s==o.LEGACY_APP_VERSION?Promise.reject(o.translate.instant("core.login.legacymoodleversion")):Promise.reject(o.translate.instant("core.login.invalidmoodleversion"))})},e.prototype.createSiteID=function(e,t){return h.Md5.hashAsciiStr(e+t)},e.prototype.determineService=function(e){return e=e.replace("https://","http://"),this.services[e]?this.services[e]:(e=e.replace("http://","https://"),this.services[e]?this.services[e]:p.a.wsservice)},e.prototype.isValidMoodleVersion=function(e){if(!e)return this.INVALID_VERSION;if(e.version){var t=parseInt(e.version,10);if(!isNaN(t))return t>=2016052300?this.VALID_VERSION:t>=2012120300?this.LEGACY_APP_VERSION:this.INVALID_VERSION}if(e.release){var n=e.release.match(/^([\d|\.]*)/);if(n&&n.length>1)return n[1]>="3.1"?this.VALID_VERSION:n[1]>="2.4"?this.LEGACY_APP_VERSION:this.INVALID_VERSION}return this.INVALID_VERSION},e.prototype.validateSiteInfo=function(e){if(!e.firstname||!e.lastname){return{error:"core.requireduserdatamissing",params:{$a:'<a core-link href="'+e.siteurl+'">'+e.siteurl+"</a>"}}}return!0},e.prototype.addSite=function(e,t,n,o,r,i){void 0===r&&(r="");var s={id:e,siteUrl:t,token:n,info:o?JSON.stringify(o):o,privateToken:r,config:i?JSON.stringify(i):i,loggedOut:0};return this.appDB.insertRecord(this.SITES_TABLE,s)},e.prototype.loadSite=function(e){var t=this;return this.logger.debug("Load site "+e),this.getSite(e).then(function(n){if(t.currentSite=n,t.login(e),!n.isLoggedOut())return n.checkIfLocalMobileInstalledAndNotUsed().then(function(){t.eventsProvider.trigger(a.a.SESSION_EXPIRED,{},e)},function(){t.updateSiteInfo(e)})})},e.prototype.getCurrentSite=function(){return this.currentSite},e.prototype.getCurrentSiteHomeId=function(){return this.currentSite?this.currentSite.getSiteHomeId():1},e.prototype.getCurrentSiteId=function(){return this.currentSite?this.currentSite.getId():""},e.prototype.getCurrentSiteUserId=function(){return this.currentSite?this.currentSite.getUserId():0},e.prototype.isLoggedIn=function(){return void 0!==this.currentSite&&void 0!==this.currentSite.token&&""!=this.currentSite.token},e.prototype.deleteSite=function(e){var t=this;return this.logger.debug("Delete site "+e),void 0!==this.currentSite&&this.currentSite.id==e&&this.logout(),this.getSite(e).then(function(n){return n.deleteDB().then(function(){return delete t.sites[e],t.appDB.deleteRecords(t.SITES_TABLE,{id:e}).then(function(){return n.deleteFolder()},function(){return n.deleteFolder()}).then(function(){t.eventsProvider.trigger(a.a.SITE_DELETED,n,e)})})})},e.prototype.hasSites=function(){return this.appDB.countRecords(this.SITES_TABLE).then(function(e){return e>0})},e.prototype.getSite=function(e){var t=this;return e?this.currentSite&&this.currentSite.getId()==e?Promise.resolve(this.currentSite):void 0!==this.sites[e]?Promise.resolve(this.sites[e]):this.appDB.getRecord(this.SITES_TABLE,{id:e}).then(function(e){return t.makeSiteFromSiteListEntry(e)}):this.currentSite?Promise.resolve(this.currentSite):Promise.reject(null)},e.prototype.makeSiteFromSiteListEntry=function(e){var t,n=e.info,o=e.config;return n=n?this.textUtils.parseJSON(n):n,o=o?this.textUtils.parseJSON(o):o,t=this.sitesFactory.makeSite(e.id,e.siteUrl,e.token,n,e.privateToken,o,1==e.loggedOut),this.sites[e.id]=t,this.siteTablesSchemas.length&&t.getDb().createTablesFromSchema(this.siteTablesSchemas),t},e.prototype.isCurrentSite=function(e){if(!e||!this.currentSite)return!!this.currentSite;var t="object"==typeof e?e.getId():e;return this.currentSite.getId()===t},e.prototype.getSiteDb=function(e){return this.getSite(e).then(function(e){return e.getDb()})},e.prototype.getSiteHomeId=function(e){return this.getSite(e).then(function(e){return e.getSiteHomeId()})},e.prototype.getSites=function(e){var t=this;return this.appDB.getAllRecords(this.SITES_TABLE).then(function(n){var o=[];return n.forEach(function(n){if(!e||e.indexOf(n.id)>-1){var r=n.info?t.textUtils.parseJSON(n.info):n.info;o.push({id:n.id,siteUrl:n.siteUrl,fullName:r&&r.fullname,siteName:r&&r.sitename,avatar:r&&r.userpictureurl})}}),o})},e.prototype.getSortedSites=function(e){return this.getSites(e).then(function(e){return e.sort(function(e,t){var n=e.siteUrl.replace(/^https?:\/\//,"").toLowerCase(),o=t.siteUrl.replace(/^https?:\/\//,"").toLowerCase(),r=n.localeCompare(o);return 0!==r?r:(n=e.fullName.toLowerCase().trim(),o=t.fullName.toLowerCase().trim(),n.localeCompare(o))}),e})},e.prototype.getSitesIds=function(){return this.appDB.getAllRecords(this.SITES_TABLE).then(function(e){return e.map(function(e){return e.id})})},e.prototype.login=function(e){var t=this;return this.appDB.insertRecord(this.CURRENT_SITE_TABLE,{id:1,siteId:e}).then(function(){t.eventsProvider.trigger(a.a.LOGIN,{},e)})},e.prototype.logout=function(){var e=this;if(!this.currentSite)return Promise.resolve();var t=this.currentSite.getId(),n=this.currentSite.getStoredConfig(),o=[];return this.currentSite=void 0,n&&"1"==n.tool_mobile_forcelogout&&o.push(this.setSiteLoggedOut(t,!0)),o.push(this.appDB.deleteRecords(this.CURRENT_SITE_TABLE,{id:1})),Promise.all(o).finally(function(){e.eventsProvider.trigger(a.a.LOGOUT,{},t)})},e.prototype.restoreSession=function(){var e=this;return this.sessionRestored?Promise.reject(null):(this.sessionRestored=!0,this.appDB.getRecord(this.CURRENT_SITE_TABLE,{id:1}).then(function(t){var n=t.siteId;return e.logger.debug("Restore session in site "+n),e.loadSite(n)}).catch(function(){}))},e.prototype.setSiteLoggedOut=function(e,t){var n=this;return this.getSite(e).then(function(o){var r={token:"",loggedOut:t?1:0};return o.setLoggedOut(t),n.appDB.updateRecords(n.SITES_TABLE,r,{id:e})})},e.prototype.updateSiteToken=function(e,t,n,o){void 0===o&&(o="");var r=this.createSiteID(e,t);return this.updateSiteTokenBySiteId(r,n,o)},e.prototype.updateSiteTokenBySiteId=function(e,t,n){var o=this;return void 0===n&&(n=""),this.getSite(e).then(function(r){var i={token:t,privateToken:n,loggedOut:0};return r.token=t,r.privateToken=n,r.setLoggedOut(!1),o.appDB.updateRecords(o.SITES_TABLE,i,{id:e})})},e.prototype.updateSiteInfo=function(e){var t=this;return this.getSite(e).then(function(n){return n.fetchSiteInfo().then(function(o){return n.setInfo(o),t.isLegacyMoodleByInfo(o)?Promise.reject(t.translate.instant("core.login.legacymoodleversion")):t.getSiteConfig(n).catch(function(){}).then(function(r){var i={info:JSON.stringify(o),loggedOut:n.isLoggedOut()?1:0};return void 0!==r&&(n.setConfig(r),i.config=JSON.stringify(r)),t.appDB.updateRecords(t.SITES_TABLE,i,{id:e}).finally(function(){t.eventsProvider.trigger(a.a.SITE_UPDATED,{},e)})})})})},e.prototype.updateSiteInfoByUrl=function(e,t){var n=this.createSiteID(e,t);return this.updateSiteInfo(n)},e.prototype.getSiteIdsFromUrl=function(e,t,n){var o=this;return t&&this.currentSite&&this.currentSite.containsUrl(e)&&(!n||this.currentSite.getInfo().username==n)?Promise.resolve([this.currentSite.getId()]):e.match(/^https?:\/\//i)?this.appDB.getAllRecords(this.SITES_TABLE).then(function(t){var r=[];return t.forEach(function(t){o.sites[t.id]||o.makeSiteFromSiteListEntry(t),o.sites[t.id].containsUrl(e)&&(n&&o.sites[t.id].getInfo().username!=n||r.push(t.id))}),r}).catch(function(){return[]}):this.urlUtils.isAbsoluteURL(e)?Promise.resolve([]):this.currentSite?Promise.resolve([this.currentSite.getId()]):Promise.resolve([])},e.prototype.getStoredCurrentSiteId=function(){return this.appDB.getRecord(this.CURRENT_SITE_TABLE,{id:1}).then(function(e){return e.siteId})},e.prototype.getSitePublicConfig=function(e){return this.sitesFactory.makeSite(void 0,e).getPublicConfig()},e.prototype.getSiteConfig=function(e){return e.wsAvailable("tool_mobile_get_config")?e.getConfig(void 0,!0):Promise.resolve()},e.prototype.isFeatureDisabled=function(e,t){return this.getSite(t).then(function(t){return t.isFeatureDisabled(e)})},e.prototype.createTableFromSchema=function(e){this.createTablesFromSchema([e])},e.prototype.createTablesFromSchema=function(e){this.siteTablesSchemas=this.siteTablesSchemas.concat(e);for(var t in this.sites)this.sites[t].getDb().createTablesFromSchema(e)},e.prototype.wsAvailableInCurrentSite=function(e,t){void 0===t&&(t=!0);var n=this.getCurrentSite();return n&&n.wsAvailable(e,t)},e.prototype.isLegacyMoodleByInfo=function(e){return this.isValidMoodleVersion(e)==this.LEGACY_APP_VERSION},e=m([Object(o.A)(),g("design:paramtypes",[c.a,r.b,u.a,s.a,i.c,l.a,a.a,d.a])],e)}()},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(4),i=n(221),s=n(318),a=n(319),c=n(711),u=n(9),d=n(8),l=n(77),f=n(12),p=n(7),h=n(1),m=n(93),g=n(118),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p){this.iab=e,this.appProvider=t,this.clipboard=n,this.domUtils=o,this.translate=i,this.platform=s,this.langProvider=a,this.eventsProvider=c,this.fileOpener=u,this.mimetypeUtils=d,this.webIntent=l,this.wsProvider=f,this.zone=p,this.logger=r.getInstance("CoreUtilsProvider")}return e.prototype.allPromises=function(e){return e&&e.length?new Promise(function(t,n){var o,r=e.length,i=0;e.forEach(function(e){e.catch(function(e){o=e}).finally(function(){++i===r&&(o?n(o):t())})})}):Promise.resolve()},e.prototype.arrayToObject=function(e,t,n){return n=n||{},e.forEach(function(e){n[e[t]]=e}),n},e.prototype.basicLeftCompare=function(e,t,n,o,r){if(void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=!0),"function"==typeof e||"function"==typeof t)return!0;if("object"==typeof e&&"object"==typeof t){if(o>=n)return!0;var i=!0;for(var s in e){var a=e[s];if("$$hashKey"==s)return;this.basicLeftCompare(a,t[s],n,o+1)||(i=!1)}return i}if(r&&(void 0===e&&null===t||null===e&&void 0===t))return!0;var c=parseFloat(e),u=parseFloat(t);return isNaN(c)||isNaN(u)?e===t:c==u},e.prototype.blockLeaveView=function(){},e.prototype.closeInAppBrowser=function(e){this.iabInstance&&(this.iabInstance.close(),e&&this.appProvider.isDesktop()&&n(317).ipcRenderer.send("closeSecondaryWindows"))},e.prototype.clone=function(e){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t[n]=this.clone(e[n]);return t}if("object"==typeof e&&null!==e){var o={};for(var r in e)o[r]=this.clone(e[r]);return o}return e},e.prototype.copyProperties=function(e,t,n){void 0===n&&(n=!0);for(var o in e)t[o]=n?this.clone(e[o]):e[o]},e.prototype.copyToClipboard=function(e){var t=this;return this.clipboard.copy(e).then(function(){return t.domUtils.showToast("core.copiedtoclipboard",!0)}).catch(function(){})},e.prototype.createFakeWSError=function(e,t){return this.wsProvider.createFakeWSError(e,t)},e.prototype.emptyArray=function(e){e.length=0},e.prototype.emptyObject=function(e){for(var t in e)e.hasOwnProperty(t)&&delete e[t]},e.prototype.executeOrderedPromises=function(e){var t=this,n=[],o=Promise.resolve(),r=function(r){var i=e[r],s=void 0;s=o.finally(function(){var e;try{e=i.func.apply(i.context,i.params||[])}catch(e){return void t.logger.error(e.message)}return e}),n.push(s),i.blocking&&(o=s)};for(var i in e)r(i);return this.allPromises(n)},e.prototype.flattenObject=function(e){var t={};for(var n in e)if(e.hasOwnProperty(n)){var o=e[n];if("object"!=typeof o||Array.isArray(o))t[n]=o;else{var r=this.flattenObject(o);for(var i in r)r.hasOwnProperty(i)&&(t[n+"."+i]=r[i])}}return t},e.prototype.filterByRegexp=function(e,t){return e&&e.length?e.filter(function(e){var n=e.match(t);return n&&n.length}):[]},e.prototype.filterEnabledSites=function(e,t,n){for(var o=[],r=3;r<arguments.length;r++)o[r-3]=arguments[r];var i=[],s=[],a=function(r){var a=e[r];!n&&i.length||i.push(Promise.resolve(t.apply(t,[a].concat(o))).then(function(e){e&&s.push(a)}))};for(var c in e)a(c);return this.allPromises(i).catch(function(){}).then(function(){return n?s:s.length?e:[]})},e.prototype.formatFloat=function(e){if(void 0===e)return"";var t=this.translate.instant("core.decsep");return(e+="").replace(".",t)},e.prototype.formatTree=function(e,t,n,o,r){void 0===t&&(t="parent"),void 0===n&&(n="id"),void 0===o&&(o=0),void 0===r&&(r=5);var i,s,a={},c={},u=[];return e.forEach(function(d,l){if(s=d[n],i=d[t],d.children=[],a[s]=l,i!=o){var f=e[a[i]];if(f)if(c[i]==r){var p=f[t];p&&(e[a[p]].children.push(d),c[s]=c[i],d.parent=p)}else f.children.push(d),c[s]=c[i]+1}else u.push(d),c[s]=1}),u},e.prototype.getCountryName=function(e){var t="assets.countries."+e,n=this.translate.instant(t);return n!==t?n:e},e.prototype.getCountryList=function(){var e=this;return this.langProvider.getCurrentLanguage().then(function(t){return new Promise(function(n,o){var r=e.translate.getTranslation(t).subscribe(function(e){n(e),r.unsubscribe()},function(e){o(e),r.unsubscribe()})})}).then(function(e){var t={};for(var n in e)if(0===n.indexOf("assets.countries.")){t[n.replace("assets.countries.","")]=e[n]}return t})},e.prototype.getMimeTypeFromUrl=function(e){var t=this.mimetypeUtils.guessExtensionFromUrl(e),n=this.mimetypeUtils.getMimeType(t);return n?Promise.resolve(n):this.wsProvider.getRemoteFileMimeType(e).then(function(e){return e||""})},e.prototype.hasRepeatedFilenames=function(e){if(!e||!e.length)return!1;for(var t=[],n=0;n<e.length;n++){var o=e[n].filename||e[n].name;if(t.indexOf(o)>-1)return this.translate.instant("core.filenameexist",{$a:o});t.push(o)}return!1},e.prototype.indexOfRegexp=function(e,t){if(!e||!e.length)return-1;for(var n=0;n<e.length;n++){var o=e[n].match(t);if(o&&o.length)return n}return-1},e.prototype.isFalseOrZero=function(e){return void 0!==e&&(!1===e||"false"===e||0===parseInt(e,10))},e.prototype.isTrueOrOne=function(e){return void 0!==e&&(!0===e||"true"===e||1===parseInt(e,10))},e.prototype.isWebServiceError=function(e){return void 0!==e.warningcode||void 0!==e.errorcode&&"invalidtoken"!=e.errorcode&&"userdeleted"!=e.errorcode&&"upgraderunning"!=e.errorcode&&"forcepasswordchangenotice"!=e.errorcode&&"usernotfullysetup"!=e.errorcode&&"sitepolicynotagreed"!=e.errorcode&&"sitemaintenance"!=e.errorcode&&("accessexception"!=e.errorcode||-1==e.message.indexOf("Invalid token - token expired"))},e.prototype.makeMenuFromList=function(e,t,n,o){void 0===n&&(n=",");var r=e.split(n).map(function(e,t){return{label:e.trim(),value:t+1}});return t&&r.unshift({label:t,value:o||0}),r},e.prototype.mergeArraysWithoutDuplicates=function(e,t,n){return this.uniqueArray(e.concat(t),n)},e.prototype.openFile=function(e){var t=this,n=this.mimetypeUtils.getFileExtension(e),o=this.mimetypeUtils.getMimeType(n);try{e=decodeURIComponent(e)}catch(e){}return this.fileOpener.open(e,o).catch(function(r){return t.logger.error("Error opening file "+e+" with mimetype "+o),t.logger.error("Error: ",JSON.stringify(r)),r=!n||n.indexOf("/")>-1||n.indexOf("\\")>-1?t.translate.instant("core.erroropenfilenoextension"):t.translate.instant("core.erroropenfilenoapp"),Promise.reject(r)})},e.prototype.openInApp=function(e,t){var n=this;if(e){if((t=t||{}).enableViewPortScale||(t.enableViewPortScale="yes"),!t.location&&this.platform.is("ios")&&0===e.indexOf("file://")&&(t.location="no"),this.iabInstance=this.iab.create(e,"_blank",t),this.appProvider.isDesktop()||this.appProvider.isMobile()){var o,r=[],i=this.iabInstance.on("loadstart").subscribe(function(e){n.zone.run(function(){r.push(e.url),r.length>10&&r.shift(),n.eventsProvider.trigger(f.a.IAB_LOAD_START,e)})});this.platform.is("android")&&(o=this.iabInstance.on("loadstop").subscribe(function(e){n.zone.run(function(){-1==r.indexOf(e.url)&&n.eventsProvider.trigger(f.a.IAB_LOAD_START,e)})}));var s=this.iabInstance.on("exit").subscribe(function(e){n.zone.run(function(){i.unsubscribe(),o&&o.unsubscribe(),s.unsubscribe(),n.eventsProvider.trigger(f.a.IAB_EXIT,e)})})}return this.iabInstance}},e.prototype.openInBrowser=function(e){if(this.appProvider.isDesktop()){n(317).shell.openExternal(e)||window.open(e,"_system")}else window.open(e,"_system")},e.prototype.openOnlineFile=function(e){var t=this;return this.platform.is("android")?this.getMimeTypeFromUrl(e).catch(function(){}).then(function(n){if(!n)return Promise.reject(t.translate.instant("core.erroropenfilenoextension"));return t.webIntent.startActivity({action:t.webIntent.ACTION_VIEW,url:e,type:n}).catch(function(o){return t.logger.error("Error opening online file "+e+" with mimetype "+n),t.logger.error("Error: ",JSON.stringify(o)),Promise.reject(t.translate.instant("core.erroropenfilenoapp"))})}):(window.open(e,"_blank"),Promise.resolve())},e.prototype.objectToArray=function(e){return Object.keys(e).map(function(t){return e[t]})},e.prototype.objectToArrayOfObjects=function(e,t,n,o){var r=function(e,o){if("object"==typeof o){var i=[];return Object.keys(o).forEach(function(t){i=i.concat(r(e?e+"["+t+"]":t,o[t]))}),i}var s={};return s[t]=e,s[n]=o,s};if(!e)return[];var i=r("",e);return o?i.sort(function(e,t){return e.name>=t.name?1:-1}):i},e.prototype.objectToKeyValueMap=function(e,t,n,o){if(e){var r=o?o.length:0,i={};return e.forEach(function(e){var o=r>0?e[t].substr(r):e[t];i[o]=e[n]}),i}},e.prototype.promiseDefer=function(){var e={};return e.promise=new Promise(function(t,n){e.resolve=t,e.reject=n}),e},e.prototype.promiseFails=function(e){return e.then(function(){return!1}).catch(function(){return!0})},e.prototype.promiseWorks=function(e){return e.then(function(){return!0}).catch(function(){return!1})},e.prototype.sameAtKeyMissingIsBlank=function(e,t,n){var o=void 0!==e[n]?e[n]:"",r=void 0!==t[n]?t[n]:"";return"number"!=typeof o&&"boolean"!=typeof o||(o=""+o),"number"!=typeof r&&"boolean"!=typeof r||(r=""+r),o===r},e.prototype.sortAndStringify=function(e){return JSON.stringify(this.sortProperties(e))},e.prototype.sortProperties=function(e){var t=this;return"object"!=typeof e||Array.isArray(e)?e:Object.keys(e).sort().reduce(function(n,o){return n[o]=t.sortProperties(e[o]),n},{})},e.prototype.sumFileSizes=function(e){var t={size:0,total:!0};return e.forEach(function(e){void 0===e.filesize?t.total=!1:t.size+=e.filesize}),t},e.prototype.unformatFloat=function(e){if(void 0===e)return!1;if(null==e)return"";if(e+="",""==(e=e.trim()))return"";var t=this.translate.instant("core.decsep");return e=e.replace(" ",""),e=e.replace(t,"."),e=parseFloat(e),!isNaN(e)&&e},e.prototype.uniqueArray=function(e,t){for(var n=[],o=[],r=e.length,i=0;i<r;i++){var s=e[i],a=t?s[t]:s;-1==o.indexOf(a)&&(o.push(a),n.push(s))}return n},e=y([Object(o.A)(),v("design:paramtypes",[i.a,u.a,s.a,d.a,p.a,h.c,r.s,m.a,f.a,a.a,l.a,c.a,g.a,o.M])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(5),i=(n.n(r),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.enabled=!0}return e.prototype.getInstance=function(e){return e=e||"",{log:this.prepareLogFn(console.log.bind(console),e),info:this.prepareLogFn(console.info.bind(console),e),warn:this.prepareLogFn(console.warn.bind(console),e),debug:this.prepareLogFn(console.debug.bind(console),e),error:this.prepareLogFn(console.error.bind(console),e)}},e.prototype.prepareLogFn=function(e,t){var n=this;return function(){for(var o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];if(n.enabled){var s=r().format("l LTS");o[0]=s+" "+t+": "+o[0],e.apply(null,o)}}},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(82),s=n(1),a=n(11),c=n(9),u=n(105),d=n(47),l=n(30),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s,a,c,u,d){this.translate=e,this.loadingCtrl=t,this.toastCtrl=n,this.alertCtrl=o,this.textUtils=r,this.appProvider=i,this.platform=s,this.configProvider=a,this.urlUtils=c,this.modalCtrl=u,this.sanitizer=d,this.INPUT_SUPPORT_KEYBOARD=["date","datetime","datetime-local","email","month","number","password","search","tel","text","time","url","week"],this.INSTANCE_ID_ATTR_NAME="core-instance-id",this.element=document.createElement("div"),this.instances={},this.lastInstanceId=0}return e.prototype.closest=function(e,t){var n=this;if("function"==typeof e.closest)return e.closest(t);if(this.matchesFn||(["matches","webkitMatchesSelector","mozMatchesSelector","msMatchesSelector","oMatchesSelector"].some(function(e){return"function"==typeof document.body[e]&&(n.matchesFn=e,!0)}),this.matchesFn))for(;e;){if(e[this.matchesFn](t))return e;e=e.parentElement}},e.prototype.confirmDownloadSize=function(e,t,n,o,r,i){if(o=void 0===o?l.a.WIFI_DOWNLOAD_THRESHOLD:o,r=void 0===r?l.a.DOWNLOAD_THRESHOLD:r,e.size<0||0==e.size&&!e.total)return n=n||"core.course.confirmdownloadunknownsize",this.showConfirm(this.translate.instant(n));if(!e.total){var s=this.textUtils.bytesToSize(e.size,2);return this.showConfirm(this.translate.instant("core.course.confirmpartialdownloadsize",{size:s}))}if(e.size>=o||this.appProvider.isNetworkAccessLimited()&&e.size>=r){t=t||"core.course.confirmdownload";s=this.textUtils.bytesToSize(e.size,2);return this.showConfirm(this.translate.instant(t,{size:s}))}return i?this.showConfirm(this.translate.instant("core.areyousure")):Promise.resolve()},e.prototype.createCanceledError=function(){return{coreCanceled:!0}},e.prototype.createChangesFromKeyValueDiff=function(e){var t={};return e.forEachAddedItem(function(e){t[e.key]=new o._2(e.previousValue,e.currentValue,!0)}),e.forEachChangedItem(function(e){t[e.key]=new o._2(e.previousValue,e.currentValue,!1)}),e.forEachRemovedItem(function(e){t[e.key]=new o._2(e.previousValue,e.currentValue,!0)}),t},e.prototype.extractDownloadableFilesFromHtml=function(e){var t,n=[];this.element.innerHTML=e,t=this.element.querySelectorAll("a, img, audio, video, source, track");for(var o=0;o<t.length;o++){var r=t[o],i="A"===r.tagName?r.href:r.src;i&&this.urlUtils.isDownloadableUrl(i)&&-1==n.indexOf(i)&&n.push(i),"VIDEO"==r.tagName&&r.getAttribute("poster")&&(i=r.getAttribute("poster"))&&this.urlUtils.isDownloadableUrl(i)&&-1==n.indexOf(i)&&n.push(i)}return n},e.prototype.extractDownloadableFilesFromHtmlAsFakeFileObjects=function(e){return this.extractDownloadableFilesFromHtml(e).map(function(e){return{fileurl:e}})},e.prototype.extractUrlsFromCSS=function(e){var t=[],n=e.match(/url\(\s*["']?(?!data:)([^)]+)\)/gim);return n?(n.forEach(function(e){var n=e.match(/url\(\s*['"]?([^'"]*)['"]?\s*\)/im);n&&n[1]&&t.push(n[1])}),t):t},e.prototype.focusElement=function(e){e&&e.focus&&(e.focus(),this.platform.is("android")&&this.supportsInputKeyboard(e)&&this.appProvider.openKeyboard())},e.prototype.formatPixelsSize=function(e){return"string"==typeof e&&(e.indexOf("px")>-1||e.indexOf("%")>-1)?e:(e=parseInt(e,10),isNaN(e)?"":e+"px")},e.prototype.getContentsOfElement=function(e,t){if(e){var n=e.querySelector(t);if(n)return n.innerHTML}},e.prototype.getDataFromForm=function(e){if(!e||!e.elements)return{};for(var t={},n=0;n<e.elements.length;n++){var o=e.elements[n],r=o.name||"";r&&"submit"!=o.type&&"BUTTON"!=o.tagName&&("checkbox"==o.type?t[r]=!!o.checked:"radio"==o.type?o.checked&&(t[r]=o.value):t[r]=o.value)}return t},e.prototype.getElementHeight=function(e,t,n,o,r){return this.getElementMeasure(e,!1,t,n,o,r)},e.prototype.getElementMeasure=function(e,t,n,o,r,i){var s=t?"offsetWidth":"offsetHeight",a=t?"width":"height",c=t?"clientWidth":"clientHeight",u=t?"Left":"Top",d=t?"Right":"Bottom",l=e[s]||e[a]||e[c]||0;if(l<=0){var f=getComputedStyle(e);f&&""==f.display&&(e.style.display="inline-block",l=e[s]||e[a]||e[c]||0,e.style.display="")}if(n||o||r){var p=getComputedStyle(e),h=0;n&&(h+=this.getComputedStyleMeasure(p,"padding"+u)+this.getComputedStyleMeasure(p,"padding"+d)),o&&(h+=this.getComputedStyleMeasure(p,"margin"+u)+this.getComputedStyleMeasure(p,"margin"+d)),r&&(h+=this.getComputedStyleMeasure(p,"border"+u+"Width")+this.getComputedStyleMeasure(p,"border"+d+"Width")),i?l=l>h?l-h:0:l+=h}return l},e.prototype.getComputedStyleMeasure=function(e,t){return parseInt(e[t],10)||0},e.prototype.getElementWidth=function(e,t,n,o,r){return this.getElementMeasure(e,!0,t,n,o,r)},e.prototype.getElementXY=function(e,t,n){var o,r=t?e.querySelector(t):e,i=0,s=0;if(n||(n="scroll-content"),!r)return null;for(;r;){for(s+=r.offsetLeft-r.scrollLeft+r.clientLeft,i+=r.offsetTop-r.scrollTop+r.clientTop,o=r.offsetParent,r=r.parentElement;o!=r&&r;)r=-1!=r.className.indexOf(n)?null:r.parentElement;r&&-1!=r.className.indexOf(n)&&(r=null)}return[s,i]},e.prototype.getErrorTitle=function(e){return e==this.translate.instant("core.networkerrormsg")||e==this.translate.instant("core.fileuploader.errormustbeonlinetoupload")?this.sanitizer.bypassSecurityTrustHtml('<div text-center><span class="core-icon-with-badge"><ion-icon role="img" class="icon fa fa-wifi" aria-label="wifi"></ion-icon><ion-icon class="icon fa fa-exclamation-triangle core-icon-badge"></ion-icon></span></div>'):this.textUtils.decodeHTML(this.translate.instant("core.error"))},e.prototype.getInstanceByElement=function(e){var t=e.getAttribute(this.INSTANCE_ID_ATTR_NAME);return this.instances[t]},e.prototype.isElementOutsideOfScreen=function(e,t){var n,o,r=t.getBoundingClientRect(),i=0;return!!r&&(n=Math.round((r.bottom+r.top)/2),o=e.getBoundingClientRect(),i=o&&o.top||0,n>window.innerHeight||n<i)},e.prototype.isRichTextEditorEnabled=function(){return this.isRichTextEditorSupported()?this.configProvider.get(l.a.SETTINGS_RICH_TEXT_EDITOR,!0).then(function(e){return!!e}):Promise.resolve(!1)},e.prototype.isRichTextEditorSupported=function(){return!0},e.prototype.moveChildren=function(e,t){for(var n=[];e.childNodes.length>0;){var o=e.childNodes[0];n.push(o),t.appendChild(o)}return n},e.prototype.removeElement=function(e,t){if(e){var n=e.querySelector(t);n&&n.remove()}},e.prototype.removeElementFromHtml=function(e,t,n){var o;if(this.element.innerHTML=e,n){o=this.element.querySelectorAll(t);for(var r=0;r<o.length;r++)o[r].remove()}else(o=this.element.querySelector(t))&&o.remove();return this.element.innerHTML},e.prototype.removeInstanceByElement=function(e){var t=e.getAttribute(this.INSTANCE_ID_ATTR_NAME);delete this.instances[t]},e.prototype.removeInstanceById=function(e){delete this.instances[e]},e.prototype.replaceClassesInElement=function(e,t){for(var n in t)for(var o=e.querySelectorAll("."+n),r=0;r<o.length;r++){var i=o[r];i.className=i.className.replace(n,t[n])}},e.prototype.restoreSourcesInHtml=function(e,t,n){var o=this;return this.element.innerHTML=e,this.element.querySelectorAll("img, video, audio, source, track").forEach(function(e){var n=t[o.textUtils.decodeURIComponent(e.getAttribute("src"))];void 0!==n&&e.setAttribute("src",n),"VIDEO"==e.tagName&&e.getAttribute("poster")&&void 0!==(n=t[o.textUtils.decodeURIComponent(e.getAttribute("poster"))])&&e.setAttribute("poster",n)}),this.element.querySelectorAll("a").forEach(function(e){var r=o.textUtils.decodeURIComponent(e.getAttribute("href")),i=t[r];void 0!==i&&(e.setAttribute("href",i),"function"==typeof n&&n(e,r))}),this.element.innerHTML},e.prototype.scrollToElement=function(e,t,n){var o=this.getElementXY(t,void 0,n);return!!o&&(e.scrollTo(o[0],o[1]),!0)},e.prototype.scrollToElementBySelector=function(e,t,n){var o=this.getElementXY(e.getScrollElement(),t,n);return!!o&&(e.scrollTo(o[0],o[1]),!0)},e.prototype.scrollToInputError=function(e,t){return!!e&&this.scrollToElementBySelector(e,".core-input-error",t)},e.prototype.showAlert=function(e,t,n,o){var r=this,i=this.textUtils.hasHTMLTags(t);return(i?this.textUtils.formatText(t):Promise.resolve(t)).then(function(t){var s=r.alertCtrl.create({title:e,message:t,buttons:[n||r.translate.instant("core.ok")]});return s.present().then(function(){if(i){var e=s.pageRef().nativeElement.querySelector(".alert-message");r.treatAnchors(e)}}),o>0&&setTimeout(function(){s.dismiss()},o),s})},e.prototype.showAlertTranslated=function(e,t,n,o){return e=e?this.translate.instant(e):e,t=t?this.translate.instant(t):t,n=n?this.translate.instant(n):n,this.showAlert(e,t,n,o)},e.prototype.showConfirm=function(e,t,n,o,r){var i=this;return new Promise(function(s,a){var c=i.textUtils.hasHTMLTags(e);(c?i.textUtils.formatText(e):Promise.resolve(e)).then(function(e){(r=r||{}).message=e,r.title=t,t||(r.cssClass="core-nohead"),r.buttons=[{text:o||i.translate.instant("core.cancel"),role:"cancel",handler:function(){a(i.createCanceledError())}},{text:n||i.translate.instant("core.ok"),handler:function(){s()}}];var u=i.alertCtrl.create(r);u.present().then(function(){if(c){var e=u.pageRef().nativeElement.querySelector(".alert-message");i.treatAnchors(e)}})})})},e.prototype.showErrorModal=function(e,t,n){if("object"==typeof e){if(e.coreCanceled)return;var o=(e=void 0!==e.content?e.content:void 0!==e.body?e.body:void 0!==e.message?e.message:void 0!==e.error?e.error:JSON.stringify(e)).match(/token"?[=|:]"?(\w*)/,"");o&&o[1]&&(e=e.replace(new RegExp(o[1],"g"),"secret"))}if(e!=l.a.DONT_SHOW_ERROR){var r=this.textUtils.decodeHTML(t?this.translate.instant(e):e);return this.showAlert(this.getErrorTitle(r),r,void 0,n)}},e.prototype.showErrorModalDefault=function(e,t,n,o){if(!e||!e.coreCanceled)return e&&"string"!=typeof e&&(e=e.message||e.error||e.content||e.body),e="string"==typeof e?e:t,this.showErrorModal(e,n,o)},e.prototype.showErrorModalFirstWarning=function(e,t,n,o){return this.showErrorModalDefault(e&&e.length&&e[0].message,t,n,o)},e.prototype.showModalLoading=function(e,t){e?t&&(e=this.translate.instant(e)):e=this.translate.instant("core.loading");var n=this.loadingCtrl.create({content:e});return n.present(),n},e.prototype.showPrompt=function(e,t,n,o){var r=this;return void 0===o&&(o="password"),new Promise(function(i,s){var a=r.textUtils.hasHTMLTags(e);(a?r.textUtils.formatText(e):Promise.resolve(e)).then(function(e){var c=r.alertCtrl.create({message:e,title:t,inputs:[{name:"promptinput",placeholder:n||r.translate.instant("core.login.password"),type:o}],buttons:[{text:r.translate.instant("core.cancel"),role:"cancel",handler:function(){s()}},{text:r.translate.instant("core.ok"),handler:function(e){i(e.promptinput)}}]});c.present().then(function(){if(a){var e=c.pageRef().nativeElement.querySelector(".alert-message");r.treatAnchors(e)}})})})},e.prototype.showToast=function(e,t,n,o){void 0===n&&(n=2e3),void 0===o&&(o=""),t&&(e=this.translate.instant(e));var r=this.toastCtrl.create({message:e,duration:n,position:"bottom",cssClass:o,dismissOnPageChange:!0});return r.present(),r},e.prototype.storeInstanceByElement=function(e,t){var n=String(this.lastInstanceId++);return e.setAttribute(this.INSTANCE_ID_ATTR_NAME,n),this.instances[n]=t,n},e.prototype.supportsInputKeyboard=function(e){return e&&!e.disabled&&("textarea"==e.tagName.toLowerCase()||"input"==e.tagName.toLowerCase()&&-1!=this.INPUT_SUPPORT_KEYBOARD.indexOf(e.type))},e.prototype.toDom=function(e){var t=document.createElement("div");return t.innerHTML=e,t.children},e.prototype.treatAnchors=function(e){var t=this;Array.from(e.querySelectorAll("a")).forEach(function(e){e.addEventListener("click",function(o){if(!o.defaultPrevented){var r=e.getAttribute("href");if(r)if(o.preventDefault(),o.stopPropagation(),t.appProvider.isDesktop()){n(317).shell.openExternal(r)||window.open(r,"_system")}else window.open(r,"_system")}})})},e.prototype.viewImage=function(e,t,n,o){if(e){this.modalCtrl.create("CoreViewerImagePage",{title:t,image:e,component:n,componentId:o}).present()}},e.prototype.wrapElement=function(e,t){e.parentNode.insertBefore(t,e),t.appendChild(e)},e=f([Object(o.A)(),p("design:paramtypes",[s.c,r.n,r.A,r.b,a.a,c.a,r.s,u.a,d.a,r.o,i.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(305),s=n(134),a=n(306),c=n(7),u=n(12),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i,s,a){var c=this;this.platform=t,this.keyboard=n,this.appCtrl=o,this.network=r,this.DBNAME="MoodleMobile",this.isKeyboardShown=!1,this.logger=i.getInstance("CoreAppProvider"),this.db=e.getDB(this.DBNAME),this.keyboard.onKeyboardShow().subscribe(function(e){a.run(function(){document.body.classList.add("keyboard-is-open"),c.isKeyboardShown=!0,s.trigger(u.a.KEYBOARD_CHANGE,c.isKeyboardShown)})}),this.keyboard.onKeyboardHide().subscribe(function(e){a.run(function(){document.body.classList.remove("keyboard-is-open"),c.isKeyboardShown=!1,s.trigger(u.a.KEYBOARD_CHANGE,c.isKeyboardShown)})})}return e.prototype.canGetUserMedia=function(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)},e.prototype.canRecordMedia=function(){return!!window.MediaRecorder},e.prototype.closeKeyboard=function(){this.isMobile()&&this.keyboard.close()},e.prototype.getDB=function(){return this.db},e.prototype.getRootNavController=function(){return this.appCtrl.getRootNavs()[0]},e.prototype.isDesktop=function(){var e=window.process;return!(!e||!e.versions||void 0===e.versions.electron)},e.prototype.isKeyboardVisible=function(){return this.isKeyboardShown},e.prototype.isLinux=function(){if(!this.isDesktop())return!1;try{return 0===n(316).platform().indexOf("linux")}catch(e){return!1}},e.prototype.isMac=function(){if(!this.isDesktop())return!1;try{return 0===n(316).platform().indexOf("darwin")}catch(e){return!1}},e.prototype.isMobile=function(){return this.platform.is("cordova")},e.prototype.isWide=function(){return this.platform.width()>768},e.prototype.isOnline=function(){var e=null!==this.network.type&&this.network.type!=Connection.NONE&&this.network.type!=Connection.UNKNOWN;return!e&&navigator.onLine&&(e=!0),e},e.prototype.isNetworkAccessLimited=function(){var e=this.network.type;if(null===e)return!1;return[Connection.CELL_2G,Connection.CELL_3G,Connection.CELL_4G,Connection.CELL].indexOf(e)>-1},e.prototype.isWindows=function(){if(!this.isDesktop())return!1;try{return 0===n(316).platform().indexOf("win")}catch(e){return!1}},e.prototype.openKeyboard=function(){this.isMobile()&&!this.platform.is("ios")&&this.keyboard.show()},e.prototype.startSSOAuthentication=function(){var e,t,n=this;this.ssoAuthenticationPromise=new Promise(function(o,r){t=o,e=setTimeout(function(){n.finishSSOAuthentication()},1e4)}),this.ssoAuthenticationPromise.resolve=t,this.ssoAuthenticationPromise.then(function(){clearTimeout(e)})},e.prototype.finishSSOAuthentication=function(){this.ssoAuthenticationPromise&&(this.ssoAuthenticationPromise.resolve&&this.ssoAuthenticationPromise.resolve(),this.ssoAuthenticationPromise=void 0)},e.prototype.isSSOAuthenticationOngoing=function(){return!!this.ssoAuthenticationPromise},e.prototype.waitForSSOAuthentication=function(){return this.ssoAuthenticationPromise||Promise.resolve()},e.prototype.getRedirect=function(){if(localStorage&&localStorage.getItem)try{var e={siteId:localStorage.getItem("CoreRedirectSiteId"),page:localStorage.getItem("CoreRedirectState"),params:localStorage.getItem("CoreRedirectParams"),timemodified:parseInt(localStorage.getItem("CoreRedirectTime"),10)};return e.params&&(e.params=JSON.parse(e.params)),e}catch(e){this.logger.error("Error loading redirect data:",e)}return{}},e.prototype.storeRedirect=function(e,t,n){if(localStorage&&localStorage.setItem)try{localStorage.setItem("CoreRedirectSiteId",e),localStorage.setItem("CoreRedirectState",t),localStorage.setItem("CoreRedirectParams",JSON.stringify(n)),localStorage.setItem("CoreRedirectTime",String(Date.now()))}catch(e){}},e=d([Object(o.A)(),l("design:paramtypes",[a.a,r.s,i.a,r.c,s.a,c.a,u.a,o.M])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(12),s=n(7),a=n(2),c=n(22),u=n(6),d=n(30),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i){this.sitesProvider=t,this.eventsProvider=n,this.utils=o,this.timeUtils=r,this.translate=i,this.ROOT_CACHE_KEY="mmCourse:",this.COURSE_STATUS_TABLE="course_status",this.courseStatusTableSchema={name:this.COURSE_STATUS_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"status",type:"TEXT",notNull:!0},{name:"previous",type:"TEXT"},{name:"updated",type:"INTEGER"},{name:"downloadTime",type:"INTEGER"},{name:"previousDownloadTime",type:"INTEGER"}]},this.CORE_MODULES=["assign","assignment","book","chat","choice","data","database","date","external-tool","feedback","file","folder","forum","glossary","ims","imscp","label","lesson","lti","page","quiz","resource","scorm","survey","url","wiki","workshop"],this.logger=e.getInstance("CoreCourseProvider"),this.sitesProvider.createTableFromSchema(this.courseStatusTableSchema)}return e.prototype.checkModuleCompletion=function(e,t){var n=this;t&&2===t.tracking&&0===t.state&&this.invalidateSections(e).finally(function(){n.eventsProvider.trigger(i.a.COMPLETION_MODULE_VIEWED,{courseId:e})})},e.prototype.clearAllCoursesStatus=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.logger.debug("Clear all course status for site "+e.id),e.getDb().deleteRecords(t.COURSE_STATUS_TABLE).then(function(){t.triggerCourseStatusChanged(-1,d.a.NOT_DOWNLOADED,e.id)})})},e.prototype.getActivitiesCompletionStatus=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){n=n||t.getUserId(),o.logger.debug("Getting completion status for user "+n+" in course "+e);var r={courseid:e,userid:n},i={cacheKey:o.getActivitiesCompletionCacheKey(e,n)};return t.read("core_completion_get_activities_completion_status",r,i).then(function(e){return e&&e.statuses?o.utils.arrayToObject(e.statuses,"cmid"):Promise.reject(null)})})},e.prototype.getActivitiesCompletionCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"activitiescompletion:"+e+":"+t},e.prototype.getCourseStatusData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.getDb().getRecord(n.COURSE_STATUS_TABLE,{id:e}).then(function(e){return e||Promise.reject(null)})})},e.prototype.getCourseStatus=function(e,t){return this.getCourseStatusData(e,t).then(function(e){return e.status||d.a.NOT_DOWNLOADED}).catch(function(){return d.a.NOT_DOWNLOADED})},e.prototype.getModule=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteId();return(t?Promise.resolve(t):this.getModuleBasicInfo(e,i).then(function(e){return e.course})).then(function(e){return t=e,s.sitesProvider.getSite(i)}).then(function(a){s.logger.debug("Getting module "+e+" in course "+t);var c={courseid:t,options:[{name:"cmid",value:e}]},u={cacheKey:s.getModuleCacheKey(e),omitExpires:o};return!o&&r&&(u.getFromCache=0,u.emergencyCache=0),n&&c.options.push({name:"sectionid",value:n}),a.read("core_course_get_contents",c,u).catch(function(){return s.getSections(t,!1,!1,u,i)}).then(function(n){for(var o=0;o<n.length;o++)for(var r=n[o],i=0;i<r.modules.length;i++){var s=r.modules[i];if(s.id==e)return s.course=t,s}return Promise.reject(null)})})},e.prototype.getModuleBasicInfo=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={cmid:e},r={cacheKey:n.getModuleCacheKey(e)};return t.read("core_course_get_course_module",o,r).then(function(e){return e.warnings&&e.warnings.length?Promise.reject(e.warnings[0]):e.cm?e.cm:Promise.reject(null)})})},e.prototype.getModuleBasicGradeInfo=function(e,t){return this.getModuleBasicInfo(e,t).then(function(e){var t={advancedgrading:e.advancedgrading||!1,grade:e.grade||!1,gradecat:e.gradecat||!1,gradepass:e.gradepass||!1,outcomes:e.outcomes||!1,scale:e.scale||!1};return(!1!==t.grade||!1!==t.advancedgrading||!1!==t.outcomes)&&t})},e.prototype.getModuleBasicInfoByInstance=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={instance:e,module:t},i={cacheKey:o.getModuleBasicInfoByInstanceCacheKey(e,t)};return n.read("core_course_get_course_module_by_instance",r,i).then(function(e){return e.warnings&&e.warnings.length?Promise.reject(e.warnings[0]):e.cm?e.cm:Promise.reject(null)})})},e.prototype.getModuleBasicInfoByInstanceCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"moduleByInstance:"+t+":"+e},e.prototype.getModuleCacheKey=function(e){return this.ROOT_CACHE_KEY+"module:"+e},e.prototype.getModuleIconSrc=function(e){return this.CORE_MODULES.indexOf(e)<0&&(e="external-tool"),"assets/img/mod/"+e+".svg"},e.prototype.getModuleSectionId=function(e,t){return this.getModuleBasicInfo(e,t).then(function(e){return e.section})},e.prototype.getSection=function(e,t,n,o,r){return t<0?Promise.reject("Invalid section ID"):this.getSections(e,n,o,void 0,r).then(function(e){for(var n=0;n<e.length;n++)if(e[n].id==t)return e[n];return Promise.reject("Unkown section")})},e.prototype.getSections=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){(o=o||{}).cacheKey=i.getSectionsCacheKey(e),o.getCacheUsingCacheKey=!0;return r.read("core_course_get_contents",{courseid:e,options:[{name:"excludemodules",value:t?1:0},{name:"excludecontents",value:n?1:0}]},o).then(function(t){var n=r.getSiteHomeId(),o=!0;return e==n&&(o=r.getStoredConfig("numsections")),void 0!==o&&!o&&t.length>0&&t.pop(),t})})},e.prototype.getSectionsCacheKey=function(e){return this.ROOT_CACHE_KEY+"sections:"+e},e.prototype.getSectionsModules=function(e){if(!e||!e.length)return[];var t=[];return e.forEach(function(e){e.modules&&(t=t.concat(e.modules))}),t},e.prototype.invalidateModule=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getModuleCacheKey(e))})},e.prototype.invalidateModuleByInstance=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getModuleBasicInfoByInstanceCacheKey(e,t))})},e.prototype.invalidateSections=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){var r=[],i=t.getSiteHomeId();return n=n||t.getUserId(),r.push(t.invalidateWsCacheForKey(o.getSectionsCacheKey(e))),r.push(t.invalidateWsCacheForKey(o.getActivitiesCompletionCacheKey(e,n))),e==i&&r.push(t.invalidateConfig()),Promise.all(r)})},e.prototype.loadModuleContents=function(e,t,n,o,r,i){return!r&&e.contents&&e.contents.length?Promise.resolve():this.getModule(e.id,t,n,o,r,i).then(function(t){e.contents=t.contents})},e.prototype.logView=function(e,t,n){var o={courseid:e};return void 0!==t&&(o.sectionnumber=t),this.sitesProvider.getSite(n).then(function(e){return e.write("core_course_view_course",o).then(function(e){if(!e.status)return Promise.reject(null)})})},e.prototype.setCoursePreviousStatus=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.logger.debug("Set previous status for course "+e+" in site "+t),this.sitesProvider.getSite(t).then(function(o){var r=o.getDb(),i={};return n.getCourseStatusData(e,t).then(function(o){return n.logger.debug("Set previous status '"+o.status+"' for course "+e),i.status=o.previous||d.a.NOT_DOWNLOADED,i.updated=Date.now(),o.status==d.a.DOWNLOADING&&(i.downloadTime=o.previousDownloadTime),r.updateRecords(n.COURSE_STATUS_TABLE,i,{id:e}).then(function(){return n.triggerCourseStatusChanged(e,i.status,t),i.status})})})},e.prototype.setCourseStatus=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.logger.debug("Set status '"+t+"' for course "+e+" in site "+n),this.sitesProvider.getSite(n).then(function(r){var i,s;return t==d.a.DOWNLOADING&&(i=o.timeUtils.timestamp()),o.getCourseStatusData(e,n).then(function(e){return void 0===i?(i=e.downloadTime,s=e.previousDownloadTime):s=e.downloadTime,e.status}).catch(function(){}).then(function(n){if(n!=t){var a={id:e,status:t,previous:n,updated:(new Date).getTime(),downloadTime:i,previousDownloadTime:s};return r.getDb().insertRecord(o.COURSE_STATUS_TABLE,a)}}).then(function(){o.triggerCourseStatusChanged(e,t,n)})})},e.prototype.translateModuleName=function(e){this.CORE_MODULES.indexOf(e)<0&&(e="external-tool");var t="core.mod_"+e,n=this.translate.instant(t);return n!==t?n:e},e.prototype.triggerCourseStatusChanged=function(e,t,n){this.eventsProvider.trigger(i.a.COURSE_STATUS_CHANGED,{courseId:e,status:t},n)},e.ALL_SECTIONS_ID=-1,e.ACCESS_GUEST="courses_access_guest",e.ACCESS_DEFAULT="courses_access_default",e=l([Object(o.A)(),f("design:paramtypes",[s.a,a.a,i.a,u.a,c.a,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(4),i=n(1),s=n(93),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.translate=e,this.langProvider=t,this.modalCtrl=n,this.DISABLED_FEATURES_COMPAT_REGEXPS=[{old:/\$mmLoginEmailSignup/g,new:"CoreLoginEmailSignup"},{old:/\$mmSideMenuDelegate/g,new:"CoreMainMenuDelegate"},{old:/\$mmCoursesDelegate/g,new:"CoreCourseOptionsDelegate"},{old:/\$mmUserDelegate/g,new:"CoreUserDelegate"},{old:/\$mmCourseDelegate/g,new:"CoreCourseModuleDelegate"},{old:/_mmCourses/g,new:"_CoreCourses"},{old:/_mmaFrontpage/g,new:"_CoreSiteHome"},{old:/_mmaGrades/g,new:"_CoreGrades"},{old:/_mmaCompetency/g,new:"_AddonCompetency"},{old:/_mmaNotifications/g,new:"_AddonNotifications"},{old:/_mmaMessages/g,new:"_AddonMessages"},{old:/_mmaCalendar/g,new:"_AddonCalendar"},{old:/_mmaFiles/g,new:"_AddonFiles"},{old:/_mmaParticipants/g,new:"_CoreUserParticipants"},{old:/_mmaCourseCompletion/g,new:"_AddonCourseCompletion"},{old:/_mmaNotes/g,new:"_AddonNotes"},{old:/_mmaBadges/g,new:"_AddonBadges"},{old:/files_privatefiles/g,new:"AddonFilesPrivateFiles"},{old:/files_sitefiles/g,new:"AddonFilesSiteFiles"},{old:/files_upload/g,new:"AddonFilesUpload"},{old:/_mmaModAssign/g,new:"_AddonModAssign"},{old:/_mmaModBook/g,new:"_AddonModBook"},{old:/_mmaModChat/g,new:"_AddonModChat"},{old:/_mmaModChoice/g,new:"_AddonModChoice"},{old:/_mmaModData/g,new:"_AddonModData"},{old:/_mmaModFeedback/g,new:"_AddonModFeedback"},{old:/_mmaModFolder/g,new:"_AddonModFolder"},{old:/_mmaModForum/g,new:"_AddonModForum"},{old:/_mmaModGlossary/g,new:"_AddonModGlossary"},{old:/_mmaModImscp/g,new:"_AddonModImscp"},{old:/_mmaModLabel/g,new:"_AddonModLabel"},{old:/_mmaModLesson/g,new:"_AddonModLesson"},{old:/_mmaModLti/g,new:"_AddonModLti"},{old:/_mmaModPage/g,new:"_AddonModPage"},{old:/_mmaModQuiz/g,new:"_AddonModQuiz"},{old:/_mmaModResource/g,new:"_AddonModResource"},{old:/_mmaModScorm/g,new:"_AddonModScorm"},{old:/_mmaModSurvey/g,new:"_AddonModSurvey"},{old:/_mmaModUrl/g,new:"_AddonModUrl"},{old:/_mmaModWiki/g,new:"_AddonModWiki"},{old:/_mmaModWorkshop/g,new:"_AddonModWorkshop"}],this.element=document.createElement("div")}return e.prototype.buildMessage=function(e){var t="";return e.forEach(function(e){e&&(t+="<p>"+e+"</p>")}),t},e.prototype.bytesToSize=function(e,t){if(void 0===t&&(t=2),void 0===e||e<0)return this.translate.instant("core.notapplicable");t<0&&(t=2);var n=["core.sizeb","core.sizekb","core.sizemb","core.sizegb","core.sizetb"],o=this.translate.instant(n),r=0;if(e>=1024){for(;e>=1024;)r++,e/=1024;e=Number(Math.round(parseFloat(e+"e+"+t))+"e-"+t)}return this.translate.instant("core.humanreadablesize",{size:e,unit:o[n[r]]})},e.prototype.cleanTags=function(e,t){return"number"==typeof e?e:e?(e=e.replace(/(<([^>]+)>)/gi,""),this.element.innerHTML=e,e=this.element.textContent,e=this.replaceNewLines(e,t?" ":"<br>")):""},e.prototype.concatenatePaths=function(e,t){if(!e)return t;if(!t)return e;var n=e.slice(-1),o=t.charAt(0);return"/"===n&&"/"===o?e+t.substr(1):"/"!==n&&"/"!==o?e+"/"+t:e+t},e.prototype.countWords=function(e){return e=e.replace(/<script[^>]*>([\S\s]*?)<\/script>/gim,""),e=e.replace(/<\/?(?!\!)[^>]*>/gi,""),e=this.decodeHTMLEntities(e),(e=e.replace(/_/gi," ")).match(/\S+/gi).length},e.prototype.decodeHTML=function(e){return void 0===e||null===e||"number"==typeof e&&isNaN(e)?"":"string"!=typeof e?""+e:e.replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"").replace(/&nbsp;/g," ")},e.prototype.decodeHTMLEntities=function(e){return e&&(this.element.innerHTML=e,e=this.element.textContent,this.element.textContent=""),e},e.prototype.decodeURI=function(e){try{return decodeURI(e)}catch(e){}return e},e.prototype.decodeURIComponent=function(e){try{return decodeURIComponent(e)}catch(e){}return e},e.prototype.escapeForRegex=function(e){return e?e.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"):""},e.prototype.escapeHTML=function(e){return void 0===e||null===e||"number"==typeof e&&isNaN(e)?"":"string"!=typeof e?""+e:e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},e.prototype.expandText=function(e,t,n,o,r){if(t.length>0){var i={title:e,content:t,component:n,componentId:o,files:r};i.isModal=!0;this.modalCtrl.create("CoreViewerTextPage",i).present()}},e.prototype.formatHtmlLines=function(e){var t=this.hasHTMLTags(e);return-1==e.indexOf("<p>")&&(e="<p>"+e+"</p>"),t?e:this.replaceNewLines(e,"<br>")},e.prototype.formatText=function(e,t,n,o){var r=this;return this.treatMultilangTags(e).then(function(e){return t&&(e=r.cleanTags(e,n)),o>0&&(e=r.shortenText(e,o)),e})},e.prototype.getTextPluginfileUrl=function(e){if(e&&e.length){var t=e[0].url||e[0].fileurl;return t.substr(0,Math.max(t.lastIndexOf("/"),t.lastIndexOf("%2F")))}},e.prototype.hasHTMLTags=function(e){return/<[a-z][\s\S]*>/i.test(e)},e.prototype.hasUnicode=function(e){for(var t=0;t<e.length;t++)if(e.charCodeAt(t)>55295)return!0;return!1},e.prototype.hasUnicodeData=function(e){for(var t in e)if("object"==typeof e[t]){if(this.hasUnicodeData(e[t]))return!0}else if("string"==typeof e[t]&&this.hasUnicode(e[t]))return!0;return!1},e.prototype.parseJSON=function(e,t,n){try{return JSON.parse(e)}catch(e){n&&n(e)}return void 0!==t?t:e},e.prototype.removeSpecialCharactersForFiles=function(e){return e.replace(/[#:\/\?\\]+/g,"_")},e.prototype.replaceNewLines=function(e,t){return e.replace(/(?:\r\n|\r|\n)/g,t)},e.prototype.replacePluginfileUrls=function(e,t){if(e){var n=this.getTextPluginfileUrl(t);if(n)return e.replace(/@@PLUGINFILE@@/g,n)}return e},e.prototype.restorePluginfileUrls=function(e,t){if(e){var n=this.getTextPluginfileUrl(t);if(n)return e.replace(new RegExp(this.escapeForRegex(n),"g"),"@@PLUGINFILE@@")}return e},e.prototype.roundToDecimals=function(e,t){void 0===t&&(t=2);var n=Math.pow(10,t);return Math.round(e*n)/n},e.prototype.s=function(e){return e?this.escapeHTML(e).replace(/&amp;#(\d+|x[0-9a-f]+);/i,"&#$1;"):""},e.prototype.shortenText=function(e,t){if(e.length>t){var n=(e=e.substr(0,t)).lastIndexOf(" ");n>0&&(e=e.substr(0,n)),e+="&hellip;"}return e},e.prototype.stripUnicode=function(e){for(var t="",n=0;n<e.length;n++)e.charCodeAt(n)<=55295&&(t+=e.charAt(n));return t},e.prototype.treatDisabledFeatures=function(e){if(!e)return"";for(var t=0;t<this.DISABLED_FEATURES_COMPAT_REGEXPS.length;t++){var n=this.DISABLED_FEATURES_COMPAT_REGEXPS[t];e=e.replace(n.old,n.new)}return e},e.prototype.treatMultilangTags=function(e){return e?this.langProvider.getCurrentLanguage().then(function(t){var n=/<(?:lang|span)[^>]+lang="[a-zA-Z0-9_-]+"[^>]*>(.*?)<\/(?:lang|span)>/g,o=new RegExp('<(?:lang|span)[^>]+lang="'+t+'"[^>]*>(.*?)</(?:lang|span)>',"g");if(!e.match(o)){var r=e.match(n);if(!r||!r[0])return e;t=r[0].match(/lang="([a-zA-Z0-9_-]+)"/)[1],o=new RegExp('<(?:lang|span)[^>]+lang="'+t+'"[^>]*>(.*?)</(?:lang|span)>',"g")}return e=e.replace(o,"$1"),e=e.replace(n,"")}):Promise.resolve("")},e.prototype.twoDigits=function(e){return e<10?"0"+e:""+e},e.prototype.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},e=a([Object(o.A)(),c("design:paramtypes",[i.c,s.a,r.o])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(96),i=(n.n(r),n(7)),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.observables={},this.uniqueEvents={},this.logger=e.getInstance("CoreEventsProvider")}return e.prototype.on=function(e,t,n){var o=this;if(this.uniqueEvents[e])return t(this.uniqueEvents[e].data),{off:function(){}};this.logger.debug("New observer listening to event '"+e+"'"),void 0===this.observables[e]&&(this.observables[e]=new r.Subject);var i=this.observables[e].subscribe(function(e){n&&e.siteId!=n||t(e)});return{off:function(){o.logger.debug("Stop listening to event '"+e+"'"),i.unsubscribe()}}},e.prototype.trigger=function(e,t,n){this.logger.debug("Event '"+e+"' triggered."),this.observables[e]&&(n&&(t||(t={}),t.siteId=n),this.observables[e].next(t))},e.prototype.triggerUnique=function(e,t,n){this.uniqueEvents[e]?this.logger.debug("Unique event '"+e+"' ignored because it was already triggered."):(this.logger.debug("Unique event '"+e+"' triggered."),n&&(t||(t={}),t.siteId=n),this.uniqueEvents[e]={data:t},this.observables[e]&&this.observables[e].next(t))},e.SESSION_EXPIRED="session_expired",e.PASSWORD_CHANGE_FORCED="password_change_forced",e.USER_NOT_FULLY_SETUP="user_not_fully_setup",e.SITE_POLICY_NOT_AGREED="site_policy_not_agreed",e.LOGIN="login",e.LOGOUT="logout",e.LANGUAGE_CHANGED="language_changed",e.NOTIFICATION_SOUND_CHANGED="notification_sound_changed",e.SITE_ADDED="site_added",e.SITE_UPDATED="site_updated",e.SITE_DELETED="site_deleted",e.COMPLETION_MODULE_VIEWED="completion_module_viewed",e.USER_DELETED="user_deleted",e.PACKAGE_STATUS_CHANGED="package_status_changed",e.COURSE_STATUS_CHANGED="course_status_changed",e.SECTION_STATUS_CHANGED="section_status_changed",e.SITE_PLUGINS_LOADED="site_plugins_loaded",e.LOGIN_SITE_CHECKED="login_site_checked",e.LOGIN_SITE_UNCHECKED="login_site_unchecked",e.IAB_LOAD_START="inappbrowser_load_start",e.IAB_EXIT="inappbrowser_exit",e.APP_LAUNCHED_URL="app_launched_url",e.FILE_SHARED="file_shared",e.KEYBOARD_CHANGE="keyboard_change",e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(1002),i=n(1275),s=n(713),a=n(1277),c=n(714),u=n(1278),d=n(1279),l=n(1280),f=n(1281),p=n(1283),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=function(){function e(){}return e=h([Object(o.I)({declarations:[r.a,i.a,s.a,a.a,u.a,c.a,d.a,l.a,f.a,p.a],imports:[],exports:[r.a,i.a,s.a,a.a,u.a,c.a,d.a,l.a,f.a,p.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return H});var o=n(0),r=n(4),i=n(1),s=n(15),a=n(66),c=n(1339),u=n(1340),d=n(1341),l=n(1342),f=n(133),p=n(1343),h=n(1344),m=n(1345),g=n(1346),y=n(1347),v=n(1348),b=n(720),_=n(1349),P=n(721),O=n(945),w=n(1350),S=n(1351),R=n(1352),E=n(135),C=n(722),I=n(946),A=n(1353),D=n(156),j=n(1354),x=n(1355),T=n(1356),k=n(723),M=n(1357),N=n(1358),U=n(724),F=n(1359),L=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},H=function(){function e(){}return e=L([Object(o.I)({declarations:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a,_.a,P.a,O.a,w.a,S.a,R.a,E.a,C.a,I.a,A.a,D.a,j.a,x.a,T.a,k.a,M.a,N.a,U.a,F.a],entryComponents:[P.a,O.a,k.a],imports:[r.k,i.b.forChild(),s.a,a.a],exports:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a,_.a,w.a,S.a,R.a,E.a,C.a,I.a,A.a,D.a,j.a,x.a,T.a,M.a,N.a,U.a,F.a]})],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return w});var o=n(0),r=n(134),i=n(9),s=n(12),a=n(27),c=n(79),u=n(7),d=n(155),l=n(2),f=n(118),p=n(8),h=n(77),m=n(11),g=n(22),y=n(47),v=n(6),b=n(30),_=n(109),P=(n.n(_),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),O=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},w=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p,h,m){var g=this;this.appProvider=t,this.fileProvider=n,this.sitesProvider=o,this.wsProvider=r,this.textUtils=i,this.utils=s,this.mimeUtils=a,this.urlUtils=c,this.timeUtils=u,this.eventsProvider=d,this.pluginFileDelegate=p,this.domUtils=h,this.QUEUE_PROCESS_INTERVAL=0,this.FOLDER="filepool",this.WIFI_DOWNLOAD_THRESHOLD=20971520,this.DOWNLOAD_THRESHOLD=2097152,this.QUEUE_RUNNING="CoreFilepool:QUEUE_RUNNING",this.QUEUE_PAUSED="CoreFilepool:QUEUE_PAUSED",this.ERR_QUEUE_IS_EMPTY="CoreFilepoolError:ERR_QUEUE_IS_EMPTY",this.ERR_FS_OR_NETWORK_UNAVAILABLE="CoreFilepoolError:ERR_FS_OR_NETWORK_UNAVAILABLE",this.ERR_QUEUE_ON_PAUSE="CoreFilepoolError:ERR_QUEUE_ON_PAUSE",this.QUEUE_TABLE="filepool_files_queue",this.FILES_TABLE="filepool_files",this.LINKS_TABLE="filepool_files_links",this.PACKAGES_TABLE="filepool_packages",this.appTablesSchema=[{name:this.QUEUE_TABLE,columns:[{name:"siteId",type:"TEXT"},{name:"fileId",type:"TEXT"},{name:"added",type:"INTEGER"},{name:"priority",type:"INTEGER"},{name:"url",type:"TEXT"},{name:"revision",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"isexternalfile",type:"INTEGER"},{name:"repositorytype",type:"TEXT"},{name:"path",type:"TEXT"},{name:"links",type:"TEXT"}],primaryKeys:["siteId","fileId"]}],this.sitesTablesSchema=[{name:this.FILES_TABLE,columns:[{name:"fileId",type:"TEXT",primaryKey:!0},{name:"url",type:"TEXT",notNull:!0},{name:"revision",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"stale",type:"INTEGER"},{name:"downloadTime",type:"INTEGER"},{name:"isexternalfile",type:"INTEGER"},{name:"repositorytype",type:"TEXT"},{name:"path",type:"TEXT"},{name:"extension",type:"TEXT"}]},{name:this.LINKS_TABLE,columns:[{name:"fileId",type:"TEXT"},{name:"component",type:"TEXT"},{name:"componentId",type:"TEXT"}],primaryKeys:["fileId","component","componentId"]},{name:this.PACKAGES_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"component",type:"TEXT"},{name:"componentId",type:"TEXT"},{name:"status",type:"TEXT"},{name:"previous",type:"TEXT"},{name:"updated",type:"INTEGER"},{name:"downloadTime",type:"INTEGER"},{name:"previousDownloadTime",type:"INTEGER"},{name:"extra",type:"TEXT"}]}],this.tokenRegex=new RegExp("(\\?|&)token=([A-Za-z0-9]+)"),this.urlAttributes=[this.tokenRegex,new RegExp("(\\?|&)forcedownload=[0-1]"),new RegExp("(\\?|&)preview=[A-Za-z0-9]+"),new RegExp("(\\?|&)offline=[0-1]","g")],this.queueDeferreds={},this.sizeCache={},this.packagesPromises={},this.filePromises={},this.logger=e.getInstance("CoreFilepoolProvider"),this.appDB=this.appProvider.getDB(),this.appDB.createTablesFromSchema(this.appTablesSchema),this.sitesProvider.createTablesFromSchema(this.sitesTablesSchema),l.ready().then(function(){g.checkQueueProcessing(),f.onConnect().subscribe(function(){m.run(function(){g.checkQueueProcessing()})})})}return e.prototype.addFileLink=function(e,t,n,o){var r=this;return n?(o=this.fixComponentId(o),this.sitesProvider.getSiteDb(e).then(function(e){return e.insertRecord(r.LINKS_TABLE,{fileId:t,component:n,componentId:o||""})})):Promise.reject(null)},e.prototype.addFileLinkByUrl=function(e,t,n,o){var r=this;return this.fixPluginfileURL(e,t).then(function(t){var i=r.getFileIdByUrl(t);return r.addFileLink(e,i,n,o)})},e.prototype.addFileLinks=function(e,t,n){var o=this,r=[];return n.forEach(function(n){r.push(o.addFileLink(e,t,n.component,n.componentId))}),Promise.all(r)},e.prototype.addFilesToQueue=function(e,t,n,o){return this.downloadOrPrefetchFiles(e,t,!0,!1,n,o)},e.prototype.addFileToPool=function(e,t,n){var o=this,r=Object.assign({},n);return r.fileId=t,this.sitesProvider.getSiteDb(e).then(function(e){return e.insertRecord(o.FILES_TABLE,r)})},e.prototype.addHashToFilename=function(e,t){var n=t.match(/_[a-f0-9]{32}/g);if(n&&n.length){var o=n[n.length-1],r=e.replace(o,"");if("_"+_.Md5.hashAsciiStr("url:"+r)==o)return t}return t+"_"+_.Md5.hashAsciiStr("url:"+e)},e.prototype.addToQueue=function(e,t,n,o,r,i,s,a,c,u){var d=this;return void 0===c&&(c={}),this.logger.debug("Adding "+t+" to the queue"),this.appDB.insertRecord(this.QUEUE_TABLE,{siteId:e,fileId:t,url:n,priority:o,revision:r,timemodified:i,path:s,isexternalfile:c.isexternalfile?1:0,repositorytype:c.repositorytype,links:JSON.stringify(u?[u]:[]),added:Date.now()}).then(function(){return d.checkQueueProcessing(),d.notifyFileDownloading(e,t),d.getQueuePromise(e,t,!0,a)})},e.prototype.addToQueueByUrl=function(e,t,n,o,r,i,s,a,c,u){var d=this;void 0===r&&(r=0),void 0===a&&(a=0),void 0===c&&(c={});var l,f,p;return this.fileProvider.isAvailable()?this.sitesProvider.getSite(e).then(function(h){return h.canDownloadFiles()?d.fixPluginfileURL(e,t).then(function(t){var h={siteId:e,fileId:l};return u=u||d.getRevisionFromUrl(t),l=d.getFileIdByUrl(t),void 0!==n&&(f={component:n,componentId:d.fixComponentId(o)}),p=d.getQueueDeferred(e,l,!1,s),d.hasFileInQueue(e,l).then(function(n){var o={},m=!1;if(n){if(n.priority<a&&(o.priority=a),u&&n.revision!==u&&(o.revision=u),r&&n.timemodified!==r&&(o.timemodified=r),i&&n.path!==i&&(o.path=i),n.isexternalfile!==c.isexternalfile&&(n.isexternalfile||c.isexternalfile)&&(o.isexternalfile=c.isexternalfile),n.repositorytype!==c.repositorytype&&(n.repositorytype||c.repositorytype)&&(o.repositorytype=c.repositorytype),f){if(n.links&&n.links.length)for(var g in n.links){var y=n.links[g];if(y.component==f.component&&y.componentId==f.componentId){m=!0;break}}m||(o.links=n.links||[],o.links.push(f),o.links=JSON.stringify(n.links))}return Object.keys(o).length?(d.logger.debug("Updating file "+l+" which is already in queue"),d.appDB.updateRecords(d.QUEUE_TABLE,o,h).then(function(){return d.getQueuePromise(e,l,!0,s)})):(d.logger.debug("File "+l+" already in queue and does not require update"),p?p.promise:d.getQueuePromise(e,l,!0,s))}return d.addToQueue(e,l,t,a,u,r,i,s,c,f)},function(){return d.addToQueue(e,l,t,a,u,r,i,s,c,f)})}):Promise.reject(null)}):Promise.reject(null)},e.prototype.addToQueueIfNeeded=function(e,t,n,o,r,i,s,a,c){var u=this;void 0===r&&(r=0),void 0===i&&(i=!0),void 0===a&&(a={});var d;if(i){if(void 0!==this.sizeCache[t])d=Promise.resolve(this.sizeCache[t]);else{if(!this.appProvider.isOnline())return Promise.reject(null);d=this.wsProvider.getRemoteFileSize(t)}return d.then(function(i){var d=!u.appProvider.isNetworkAccessLimited(),l=i<=0;if(l||(u.sizeCache[t]=i),l){if(s&&d)return u.addToQueueByUrl(e,t,n,o,r,void 0,void 0,0,a,c)}else if(i<=u.DOWNLOAD_THRESHOLD||d&&i<=u.WIFI_DOWNLOAD_THRESHOLD)return u.addToQueueByUrl(e,t,n,o,r,void 0,void 0,0,a,c)})}return this.addToQueueByUrl(e,t,n,o,r,void 0,void 0,0,a,c)},e.prototype.checkQueueProcessing=function(){this.fileProvider.isAvailable()&&this.appProvider.isOnline()?this.queueState!==this.QUEUE_RUNNING&&(this.queueState=this.QUEUE_RUNNING,this.processQueue()):this.queueState=this.QUEUE_PAUSED},e.prototype.clearAllPackagesStatus=function(e){var t=this;return this.logger.debug("Clear all packages status for site "+e),this.sitesProvider.getSite(e).then(function(n){return n.getDb().getAllRecords(t.PACKAGES_TABLE).then(function(o){return n.getDb().deleteRecords(t.PACKAGES_TABLE).then(function(){o.forEach(function(n){t.triggerPackageStatusChanged(e,b.a.NOT_DOWNLOADED,n.component,n.componentId)})})})})},e.prototype.clearFilepool=function(e){var t=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.deleteRecords(t.FILES_TABLE)})},e.prototype.componentHasFiles=function(e,t,n){var o=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.countRecords(o.LINKS_TABLE,{component:t,componentId:n||""}).then(function(e){if(e<=0)return Promise.reject(null)})})},e.prototype.determinePackagesStatus=function(e,t){return e||(e=b.a.NOT_DOWNLOADABLE),t===b.a.NOT_DOWNLOADED?b.a.NOT_DOWNLOADED:t===b.a.DOWNLOADED&&e===b.a.NOT_DOWNLOADABLE?b.a.DOWNLOADED:t!==b.a.DOWNLOADING||e!==b.a.NOT_DOWNLOADABLE&&e!==b.a.DOWNLOADED?t===b.a.OUTDATED&&e!==b.a.NOT_DOWNLOADED?b.a.OUTDATED:e:b.a.DOWNLOADING},e.prototype.downloadForPoolByUrl=function(e,t,n,o,r,i){var s=this;void 0===n&&(n={});var a=this.getFileIdByUrl(t),c=this.mimeUtils.guessExtensionFromUrl(t),u=void 0===o,d=o||this.getFilePath(e,a,c);return Promise.resolve(d).then(function(o){if(i&&i.fileId!==a)return s.logger.error("Invalid object to update passed"),Promise.reject(null);var c=s.getFileDownloadId(t,o);return s.filePromises[e]&&s.filePromises[e][c]?s.filePromises[e][c]:(s.filePromises[e]||(s.filePromises[e]={}),s.filePromises[e][c]=s.sitesProvider.getSite(e).then(function(c){return c.canDownloadFiles()?s.wsProvider.downloadFile(t,o,u,r).then(function(o){var r=i||{};return r.downloadTime=Date.now(),r.stale=0,r.url=t,r.revision=n.revision,r.timemodified=n.timemodified,r.isexternalfile=n.isexternalfile?1:0,r.repositorytype=n.repositorytype,r.path=o.path,r.extension=o.extension,s.addFileToPool(e,a,r).then(function(){return o.toURL()})}):Promise.reject(null)}).finally(function(){delete s.filePromises[e][c]}),s.filePromises[e][c])})},e.prototype.downloadOrPrefetchFiles=function(e,t,n,o,r,i,s){var a=this,c=[];return t.forEach(function(t){var u,d=t.url||t.fileurl,l=t.timemodified,f={isexternalfile:t.isexternalfile,repositorytype:t.repositorytype};s&&(u=t.filename,"/"!==t.filepath&&(u=t.filepath.substr(1)+u),u=a.textUtils.concatenatePaths(s,u)),c.push(n?a.addToQueueByUrl(e,d,r,i,l,u,void 0,0,f):a.downloadUrl(e,d,o,r,i,l,u,void 0,f))}),this.utils.allPromises(c)},e.prototype.downloadOrPrefetchPackage=function(e,t,n,o,r,i,s,a){var c,u=this,d=this.getPackageId(o,r);return this.packagesPromises[e]&&this.packagesPromises[e][d]?this.packagesPromises[e][d]:(this.packagesPromises[e]||(this.packagesPromises[e]={}),c=this.storePackageStatus(e,b.a.DOWNLOADING,o,r).then(function(){var c=[],d=0;return t.forEach(function(t){var i,l,f,p=t.url||t.fileurl,h={isexternalfile:t.isexternalfile,repositorytype:t.repositorytype},m=0;a&&(f=function(e){e&&e.loaded&&(d+=e.loaded-m,m=e.loaded,a({packageDownload:!0,loaded:d,fileProgress:e}))}),s&&(i=t.filename,"/"!==t.filepath&&(i=t.filepath.substr(1)+i),i=u.textUtils.concatenatePaths(s,i)),l=n?u.addToQueueByUrl(e,p,o,r,t.timemodified,i,void 0,0,h):u.downloadUrl(e,p,!1,o,r,t.timemodified,f,i,h),c.push(l)}),Promise.all(c).then(function(){return u.storePackageStatus(e,b.a.DOWNLOADED,o,r,i)}).catch(function(){return u.setPackagePreviousStatus(e,o,r).then(function(){return Promise.reject(null)})})}).finally(function(){delete u.packagesPromises[e][d]}),this.packagesPromises[e][d]=c,c)},e.prototype.downloadPackage=function(e,t,n,o,r,i,s){return this.downloadOrPrefetchPackage(e,t,!1,n,o,r,i,s)},e.prototype.downloadUrl=function(e,t,n,o,r,i,s,a,c,u){var d=this;void 0===i&&(i=0),void 0===c&&(c={});var l;return this.fileProvider.isAvailable()?this.fixPluginfileURL(e,t).then(function(f){return t=f,c=Object.assign({},c),c.timemodified=i||0,c.revision=u||d.getRevisionFromUrl(t),l=d.getFileIdByUrl(t),d.hasFileInPool(e,l).then(function(o){return void 0===o?(d.notifyFileDownloading(e,l),d.downloadForPoolByUrl(e,t,c,a,s)):d.isFileOutdated(o,c.revision,c.timemodified)&&d.appProvider.isOnline()&&!n?(d.notifyFileDownloading(e,l),d.downloadForPoolByUrl(e,t,c,a,s,o)):(a?d.getInternalUrlByPath(a):d.getInternalUrlById(e,l)).then(function(e){return e},function(){return d.notifyFileDownloading(e,l),d.downloadForPoolByUrl(e,t,c,a,s,o)})},function(){return d.notifyFileDownloading(e,l),d.downloadForPoolByUrl(e,t,c,a,s)}).then(function(t){return void 0!==o&&d.addFileLink(e,l,o,r).catch(function(){}),d.notifyFileDownloaded(e,l),t},function(t){return d.notifyFileDownloadError(e,l),Promise.reject(t)})}):Promise.reject(null)},e.prototype.fillExtensionInFile=function(e,t){var n=this;return void 0!==e.extension?Promise.resolve():this.sitesProvider.getSiteDb(t).then(function(t){var o=n.mimeUtils.getFileExtension(e.path);if(!o)return n.logger.debug("Staled file with no extension "+e.fileId),t.updateRecords(n.FILES_TABLE,{stale:1},{fileId:e.fileId});var r=e.fileId;return e.fileId=n.mimeUtils.removeExtension(r),e.extension=o,t.updateRecords(n.FILES_TABLE,e,{fileId:r}).then(function(){if(e.fileId!=r)return t.updateRecords(n.LINKS_TABLE,{fileId:e.fileId},{fileId:r});n.logger.debug("Removed extesion "+o+" from file "+e.fileId)})})},e.prototype.fillMissingExtensionInFiles=function(e){var t=this;return this.logger.debug("Fill missing extensions in files of "+e),this.sitesProvider.getSiteDb(e).then(function(n){return n.getAllRecords(t.FILES_TABLE).then(function(n){var o=[];return n.forEach(function(n){o.push(t.fillExtensionInFile(n,e))}),Promise.all(o)})})},e.prototype.fixComponentId=function(e){if("number"==typeof e)return e;var t=parseInt(e,10);return isNaN(t)?void 0===e||null===e?-1:e:t},e.prototype.fixPluginfileURL=function(e,t){return this.sitesProvider.getSite(e).then(function(e){return e.fixPluginfileURL(t)})},e.prototype.getComponentFiles=function(e,t,n){return e.getRecords(this.LINKS_TABLE,{component:t,componentId:n||""})},e.prototype.getDirectoryUrlByUrl=function(e,t){var n=this;return this.fileProvider.isAvailable()?this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t),r=n.getFilePath(e,o,"");return n.fileProvider.getDir(r).then(function(e){return e.toURL()})}):Promise.reject(null)},e.prototype.getFileDownloadId=function(e,t){return _.Md5.hashAsciiStr(e+"###"+t)},e.prototype.getFileEventName=function(e,t){return"CoreFilepoolFile:"+e+":"+t},e.prototype.getFileEventNameByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.getFileEventName(e,o)})},e.prototype.getFileIdByUrl=function(e){var t,n=this.removeRevisionFromUrl(e);return-1!==(n=this.textUtils.decodeHTML(this.textUtils.decodeURIComponent(n))).indexOf("/webservice/pluginfile")&&this.urlAttributes.forEach(function(e){n=n.replace(e,"")}),t=this.guessFilenameFromUrl(n),this.addHashToFilename(n,t)},e.prototype.getFileLinks=function(e,t){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getRecords(n.LINKS_TABLE,{fileId:t})})},e.prototype.getFilePath=function(e,t,n){var o=this.getFilepoolFolderPath(e)+"/"+t;return void 0===n?this.hasFileInPool(e,t).then(function(e){return e.extension&&(o+="."+e.extension),o}).catch(function(){return o}):(n&&(o+="."+n),o)},e.prototype.getFilePathByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.getFilePath(e,o)})},e.prototype.getFilepoolFolderPath=function(e){return this.fileProvider.getSiteFolder(e)+"/"+this.FOLDER},e.prototype.getFilesByComponent=function(e,t,n){var o=this;return this.sitesProvider.getSiteDb(e).then(function(e){return o.getComponentFiles(e,t,n).then(function(t){var n=[],r=[];return t.forEach(function(t){n.push(e.getRecord(o.FILES_TABLE,{fileId:t.fileId}).then(function(e){e&&r.push({url:e.url,path:e.path,extension:e.extension,revision:e.revision,timemodified:e.timemodified})}).catch(function(){}))}),Promise.all(n).then(function(){return r})})})},e.prototype.getFilesSizeByComponent=function(e,t,n){var o=this;return this.getFilesByComponent(e,t,n).then(function(e){var t=[],n=0;return e.forEach(function(e){t.push(o.fileProvider.getFileSize(e.path).then(function(e){n+=e}).catch(function(){}))}),Promise.all(t).then(function(){return n})})},e.prototype.getFileStateByUrl=function(e,t,n,o,r){var i=this;void 0===n&&(n=0);var s;return this.fixPluginfileURL(e,t).then(function(a){return t=a,r=r||i.getRevisionFromUrl(t),s=i.getFileIdByUrl(t),i.hasFileInQueue(e,s).then(function(){return b.a.DOWNLOADING}).catch(function(){var a=i.mimeUtils.guessExtensionFromUrl(t),c=o||i.getFilePath(e,s,a);return Promise.resolve(c).then(function(o){var a=i.getFileDownloadId(t,o);return i.filePromises[e]&&i.filePromises[e][a]?b.a.DOWNLOADING:i.hasFileInPool(e,s).then(function(e){return i.isFileOutdated(e,r,n)?b.a.OUTDATED:b.a.DOWNLOADED}).catch(function(){return b.a.NOT_DOWNLOADED})})})})},e.prototype.getFileUrlByUrl=function(e,t,n,o,r,i,s,a,c,u){var d=this;void 0===r&&(r="url"),void 0===i&&(i=0),void 0===s&&(s=!0),void 0===c&&(c={});var l,f=function(t){d.addToQueueIfNeeded(e,t,n,o,i,s,a,c,u).catch(function(){})};return this.fixPluginfileURL(e,t).then(function(n){return t=n,u=u||d.getRevisionFromUrl(t),l=d.getFileIdByUrl(t),d.hasFileInPool(e,l).then(function(n){var o;return void 0===n?(f(t),o=t):d.isFileOutdated(n,u,i)&&d.appProvider.isOnline()?(f(t),o=t):o=(o="src"===r?d.getInternalSrcById(e,l):d.getInternalUrlById(e,l)).then(function(e){return e}).catch(function(){return d.logger.debug("File "+l+" not found on disk"),d.removeFileById(e,l),f(t),d.appProvider.isOnline()?t:Promise.reject(null)}),o},function(){return f(t),t})})},e.prototype.getInternalSrcById=function(e,t){var n=this;return this.fileProvider.isAvailable()?Promise.resolve(this.getFilePath(e,t)).then(function(e){return n.fileProvider.getFile(e).then(function(e){return n.fileProvider.getInternalURL(e)})}):Promise.reject(null)},e.prototype.getInternalUrlById=function(e,t){var n=this;return this.fileProvider.isAvailable()?Promise.resolve(this.getFilePath(e,t)).then(function(e){return n.fileProvider.getFile(e).then(function(e){return e.toURL()})}):Promise.reject(null)},e.prototype.getInternalUrlByPath=function(e){return this.fileProvider.isAvailable()?this.fileProvider.getFile(e).then(function(e){return e.toURL()}):Promise.reject(null)},e.prototype.getInternalUrlByUrl=function(e,t){var n=this;return this.fileProvider.isAvailable()?this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.getInternalUrlById(e,o)}):Promise.reject(null)},e.prototype.getPackageData=function(e,t,n){var o=this;return n=this.fixComponentId(n),this.sitesProvider.getSite(e).then(function(e){var r=o.getPackageId(t,n);return e.getDb().getRecord(o.PACKAGES_TABLE,{id:r})})},e.prototype.getPackageDirNameByUrl=function(e){var t,n="";return-1!==(e=this.removeRevisionFromUrl(e)).indexOf("/webservice/pluginfile")&&(this.urlAttributes.forEach(function(t){e=e.replace(t,"")}),(t=this.mimeUtils.guessExtensionFromUrl(e))&&"php"!==t&&(n="."+t)),_.Md5.hashAsciiStr("url:"+e)+n},e.prototype.getPackageDirPathByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getPackageDirNameByUrl(t);return n.getFilePath(e,o,"")})},e.prototype.getPackageDirUrlByUrl=function(e,t){var n=this;return this.fileProvider.isAvailable()?this.fixPluginfileURL(e,t).then(function(t){var o=n.getPackageDirNameByUrl(t),r=n.getFilePath(e,o,"");return n.fileProvider.getDir(r).then(function(e){return e.toURL()})}):Promise.reject(null)},e.prototype.getPackageDownloadPromise=function(e,t,n){var o=this.getPackageId(t,n);if(this.packagesPromises[e]&&this.packagesPromises[e][o])return this.packagesPromises[e][o]},e.prototype.getPackageExtra=function(e,t,n){return this.getPackageData(e,t,n).then(function(e){return e.extra})},e.prototype.getPackageId=function(e,t){return _.Md5.hashAsciiStr(e+"#"+this.fixComponentId(t))},e.prototype.getPackagePreviousStatus=function(e,t,n){return this.getPackageData(e,t,n).then(function(e){return e.previous||b.a.NOT_DOWNLOADED}).catch(function(){return b.a.NOT_DOWNLOADED})},e.prototype.getPackageStatus=function(e,t,n){return this.getPackageData(e,t,n).then(function(e){return e.status||b.a.NOT_DOWNLOADED}).catch(function(){return b.a.NOT_DOWNLOADED})},e.prototype.getPluginFileArgs=function(e){if(this.urlUtils.isPluginFileUrl(e)){var t=e.substr(e.indexOf("/pluginfile.php")+16).split("/");if(!(t.length<3))return t}},e.prototype.getQueueDeferred=function(e,t,n,o){if(void 0===n&&(n=!0),!this.queueDeferreds[e]){if(!n)return;this.queueDeferreds[e]={}}if(!this.queueDeferreds[e][t]){if(!n)return;this.queueDeferreds[e][t]=this.utils.promiseDefer()}return o&&(this.queueDeferreds[e][t].onProgress=o),this.queueDeferreds[e][t]},e.prototype.getQueueOnProgress=function(e,t){var n=this.getQueueDeferred(e,t,!1);if(n)return n.onProgress},e.prototype.getQueuePromise=function(e,t,n,o){return void 0===n&&(n=!0),this.getQueueDeferred(e,t,n,o).promise},e.prototype.getRevisionFromFileList=function(e){var t=this,n=0;return e.forEach(function(e){if(e.url||e.fileurl){var o=t.getRevisionFromUrl(e.url||e.fileurl);o>n&&(n=o)}}),n},e.prototype.getRevisionFromUrl=function(e){var t=this.getPluginFileArgs(e);if(!t)return 0;var n=this.pluginFileDelegate.getComponentRevisionRegExp(t);if(!n)return 0;var o=e.match(n);return o&&void 0!==o[1]?parseInt(o[1],10):0},e.prototype.getSrcByUrl=function(e,t,n,o,r,i,s,a,c){return void 0===r&&(r=0),void 0===i&&(i=!0),void 0===a&&(a={}),this.getFileUrlByUrl(e,t,n,o,"src",r,i,s,a,c)},e.prototype.getTimemodifiedFromFileList=function(e){var t=0;return e.forEach(function(e){e.timemodified>t&&(t=e.timemodified)}),t},e.prototype.getUrlByUrl=function(e,t,n,o,r,i,s,a,c){return void 0===r&&(r=0),void 0===i&&(i=!0),void 0===a&&(a={}),this.getFileUrlByUrl(e,t,n,o,"url",r,i,s,a,c)},e.prototype.guessFilenameFromUrl=function(e){var t="";if(-1!==e.indexOf("/webservice/pluginfile")){var n=this.urlUtils.extractUrlParams(e);t=n.file?n.file.substr(n.file.lastIndexOf("/")+1):this.urlUtils.getLastFileWithoutParams(e)}else if(this.urlUtils.isGravatarUrl(e))t="gravatar_"+this.urlUtils.getLastFileWithoutParams(e);else if(this.urlUtils.isThemeImageUrl(e)){var o=e.match(/\/core\/([^\/]*)\//);o&&o[1]&&(t=o[1]),t="default_"+t+"_"+this.urlUtils.getLastFileWithoutParams(e)}else t=this.urlUtils.getLastFileWithoutParams(e);return t=this.mimeUtils.removeExtension(t),this.textUtils.removeSpecialCharactersForFiles(t)},e.prototype.hasFileInPool=function(e,t){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getRecord(n.FILES_TABLE,{fileId:t}).then(function(e){return void 0===e?Promise.reject(null):e})})},e.prototype.hasFileInQueue=function(e,t){var n=this;return this.appDB.getRecord(this.QUEUE_TABLE,{siteId:e,fileId:t}).then(function(e){return void 0===e?Promise.reject(null):(e.links=n.textUtils.parseJSON(e.links,[]),e)})},e.prototype.invalidateAllFiles=function(e,t){var n=this;return void 0===t&&(t=!0),this.sitesProvider.getSiteDb(e).then(function(e){var o,r;return t&&(o="isexternalfile = ? OR (revision < ? AND timemodified = ?)",r=[0,1,0]),e.updateRecordsWhere(n.FILES_TABLE,{stale:1},o,r)})},e.prototype.invalidateFileByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.sitesProvider.getSiteDb(e).then(function(e){return e.updateRecords(n.FILES_TABLE,{stale:1},{fileId:o})})})},e.prototype.invalidateFilesByComponent=function(e,t,n,o){var r=this;return void 0===o&&(o=!0),this.sitesProvider.getSiteDb(e).then(function(e){return r.getComponentFiles(e,t,n).then(function(t){var n=t.map(function(e){return e.fileId}),i=e.getInOrEqual(n);return i[0]="fileId "+i[0],o&&(i[0]+=" AND (isexternalfile = ? OR (revision < ? AND timemodified = ?))",i[1]=i[1].concat([0,1,0])),e.updateRecordsWhere(r.FILES_TABLE,{stale:1},i[0],i[1])})})},e.prototype.isFileDownloadingByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.hasFileInQueue(e,o)})},e.prototype.isFileOutdated=function(e,t,n){return!!e.stale||t>e.revision||n>e.timemodified},e.prototype.isFileUpdateUnknown=function(e){return!!e.isexternalfile||e.revision<1&&!e.timemodified},e.prototype.notifyFileDeleted=function(e,t){this.eventsProvider.trigger(this.getFileEventName(e,t),{action:"deleted"})},e.prototype.notifyFileDownloaded=function(e,t){this.eventsProvider.trigger(this.getFileEventName(e,t),{action:"download",success:!0})},e.prototype.notifyFileDownloadError=function(e,t){this.eventsProvider.trigger(this.getFileEventName(e,t),{action:"download",success:!1})},e.prototype.notifyFileDownloading=function(e,t){this.eventsProvider.trigger(this.getFileEventName(e,t),{action:"downloading"})},e.prototype.notifyFileOutdated=function(e,t){this.eventsProvider.trigger(this.getFileEventName(e,t),{action:"outdated"})},e.prototype.prefetchPackage=function(e,t,n,o,r,i,s){return this.downloadOrPrefetchPackage(e,t,!0,n,o,r,i,s)},e.prototype.processQueue=function(){var e=this;(this.queueState!==this.QUEUE_RUNNING?Promise.reject(this.ERR_QUEUE_ON_PAUSE):this.fileProvider.isAvailable()&&this.appProvider.isOnline()?this.processImportantQueueItem():Promise.reject(this.ERR_FS_OR_NETWORK_UNAVAILABLE)).then(function(){setTimeout(function(){e.processQueue()},e.QUEUE_PROCESS_INTERVAL)},function(t){t===e.ERR_FS_OR_NETWORK_UNAVAILABLE?e.logger.debug("Filesysem or network unavailable, pausing queue processing."):t===e.ERR_QUEUE_IS_EMPTY&&e.logger.debug("Queue is empty, pausing queue processing."),e.queueState=e.QUEUE_PAUSED})},e.prototype.processImportantQueueItem=function(){var e=this;return this.appDB.getRecords(this.QUEUE_TABLE,void 0,"priority DESC, added ASC",void 0,0,1).then(function(t){var n=t.pop();return n?(n.links=e.textUtils.parseJSON(n.links,[]),e.processQueueItem(n)):Promise.reject(e.ERR_QUEUE_IS_EMPTY)},function(){return Promise.reject(e.ERR_QUEUE_IS_EMPTY)})},e.prototype.processQueueItem=function(e){var t=this,n=e.siteId,o=e.fileId,r=e.url,i={revision:e.revision||void 0,timemodified:e.timemodified||void 0,isexternalfile:e.isexternalfile||void 0,repositorytype:e.repositorytype||void 0},s=e.path||void 0,a=e.links||[];return this.logger.debug("Processing queue item: "+n+", "+o),this.hasFileInPool(n,o).catch(function(){}).then(function(e){if(e&&!t.isFileOutdated(e,i.revision,i.timemodified))return t.logger.debug("Queued file already in store, ignoring..."),t.addFileLinks(n,o,a).catch(function(){}),t.removeFromQueue(n,o).catch(function(){}).finally(function(){t.treatQueueDeferred(n,o,!0)}),void t.notifyFileDownloaded(n,o);var c=t.getQueueOnProgress(n,o);return t.downloadForPoolByUrl(n,r,i,s,c,e).then(function(){return t.addFileLinks(n,o,a).catch(function(){}),t.treatQueueDeferred(n,o,!0),t.notifyFileDownloaded(n,o),t.removeFromQueue(n,o).catch(function(){})},function(e){var i=!1;return e&&e.source===r?1===e.code?i=!0:2===e.code?i=!0:3===e.code?i=!0:4===e.code||(i=!0):i=!0,i?(t.logger.debug("Item dropped from queue due to error: "+r,e),t.removeFromQueue(n,o).catch(function(){}).then(function(){t.treatQueueDeferred(n,o,!1),t.notifyFileDownloadError(n,o)})):(t.treatQueueDeferred(n,o,!1),t.notifyFileDownloadError(n,o),Promise.reject(e))})})},e.prototype.removeFromQueue=function(e,t){return this.appDB.deleteRecords(this.QUEUE_TABLE,{siteId:e,fileId:t})},e.prototype.removeFileById=function(e,t){var n=this;return this.sitesProvider.getSiteDb(e).then(function(o){return Promise.resolve(n.getFilePath(e,t)).then(function(r){var i=[];return i.push(o.deleteRecords(n.FILES_TABLE,{fileId:t})),i.push(o.deleteRecords(n.LINKS_TABLE,{fileId:t})),n.fileProvider.isAvailable()&&i.push(n.fileProvider.removeFile(r).catch(function(e){if(!e||1!=e.code)return Promise.reject(e)})),Promise.all(i).then(function(){n.notifyFileDeleted(e,t)})})})},e.prototype.removeFilesByComponent=function(e,t,n){var o=this;return this.sitesProvider.getSiteDb(e).then(function(e){return o.getComponentFiles(e,t,n)}).then(function(t){return Promise.all(t.map(function(t){return o.removeFileById(e,t.fileId)}))})},e.prototype.removeFileByUrl=function(e,t){var n=this;return this.fixPluginfileURL(e,t).then(function(t){var o=n.getFileIdByUrl(t);return n.removeFileById(e,o)})},e.prototype.removeRevisionFromUrl=function(e){var t=this.getPluginFileArgs(e);return t?this.pluginFileDelegate.removeRevisionFromUrl(e,t):e},e.prototype.setPackagePreviousStatus=function(e,t,n){var o=this;return n=this.fixComponentId(n),this.logger.debug("Set previous status for package "+t+" "+n),this.sitesProvider.getSite(e).then(function(e){var r=o.getPackageId(t,n);return e.getDb().getRecord(o.PACKAGES_TABLE,{id:r}).then(function(i){var s={};return i.status==b.a.DOWNLOADING&&(s.downloadTime=i.previousDownloadTime),s.status=i.previous||b.a.NOT_DOWNLOADED,s.updated=Date.now(),o.logger.debug("Set previous status '"+i.status+"' for package "+t+" "+n),e.getDb().updateRecords(o.PACKAGES_TABLE,s,{id:r}).then(function(){return o.triggerPackageStatusChanged(e.id,s.status,t,n),s.status})})})},e.prototype.shouldDownloadBeforeOpen=function(e,t){return t>=0&&t<=this.DOWNLOAD_THRESHOLD?Promise.resolve():this.appProvider.isDesktop()?Promise.resolve():this.utils.getMimeTypeFromUrl(e).then(function(e){if(-1!=e.indexOf("video")||-1!=e.indexOf("audio"))return Promise.reject(null)})},e.prototype.storePackageStatus=function(e,t,n,o,r){var i=this;return this.logger.debug("Set status '"+t+"' for package "+n+" "+o),o=this.fixComponentId(o),this.sitesProvider.getSite(e).then(function(s){var a,c,u=i.getPackageId(n,o);return t==b.a.DOWNLOADING&&(a=i.timeUtils.timestamp()),s.getDb().getRecord(i.PACKAGES_TABLE,{id:u}).then(function(e){return void 0!==r&&null!==r||(r=e.extra),void 0===a?(a=e.downloadTime,c=e.previousDownloadTime):c=e.downloadTime,e.status}).catch(function(){}).then(function(d){var l={id:u,component:n,componentId:o,status:t,previous:d,updated:Date.now(),downloadTime:a,previousDownloadTime:c,extra:r};return(d===t?Promise.resolve():s.getDb().insertRecord(i.PACKAGES_TABLE,l)).then(function(){i.triggerPackageStatusChanged(e,t,n,o)})})})},e.prototype.treatCSSCode=function(e,t,n,o,r,i){var s,a=this,c=this.domUtils.extractUrlsFromCSS(n),u=[],d=!1;return u.push(this.getFilePathByUrl(e,t).then(function(e){s=e})),c.forEach(function(t){0==t.indexOf("http")&&u.push(a.downloadUrl(e,t,!1,o,r,0,void 0,void 0,void 0,i).then(function(e){e!=t&&(n=n.replace(new RegExp(a.textUtils.escapeForRegex(t),"g"),e),d=!0)}).catch(function(e){a.logger.warn("Error treating file ",t,e)}))}),Promise.all(u).then(function(){if(d)return a.fileProvider.writeFile(s,n)}).then(function(){return n})},e.prototype.treatExtensionInQueue=function(){var e=this;return this.logger.debug("Treat extensions in queue"),this.appDB.getAllRecords(this.QUEUE_TABLE).then(function(t){var n=[];return t.forEach(function(t){var o=t.fileId;t.fileId=e.mimeUtils.removeExtension(o),o!=t.fileId&&n.push(e.appDB.updateRecords(e.QUEUE_TABLE,{fileId:t.fileId},{fileId:o}))}),Promise.all(n)})},e.prototype.treatQueueDeferred=function(e,t,n){this.queueDeferreds[e]&&this.queueDeferreds[e][t]&&(n?this.queueDeferreds[e][t].resolve():this.queueDeferreds[e][t].reject(),delete this.queueDeferreds[e][t])},e.prototype.triggerPackageStatusChanged=function(e,t,n,o){var r={component:n,componentId:this.fixComponentId(o),status:t};this.eventsProvider.trigger(s.a.PACKAGE_STATUS_CHANGED,r,e)},e.prototype.updatePackageDownloadTime=function(e,t,n){var o=this;return n=this.fixComponentId(n),this.sitesProvider.getSite(e).then(function(e){var r=o.getPackageId(t,n);return e.getDb().updateRecords(o.PACKAGES_TABLE,{downloadTime:o.timeUtils.timestamp()},{id:r})})},e=P([Object(o.A)(),O("design:paramtypes",[u.a,i.a,a.a,l.a,f.a,m.a,v.a,h.a,y.a,g.a,s.a,c.a,r.a,d.a,p.a,o.M])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return E});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(27),c=n(18),u=n(222),d=n(2),l=n(8),f=n(11),p=n(22),h=n(6),m=n(104),g=n(157),y=n(41),v=n(10),b=n(35),_=n(36),P=n(71),O=n(30),w=n(5),S=(n.n(w),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),R=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},E=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p,h,m,g,y,v){this.courseProvider=e,this.domUtils=t,this.moduleDelegate=n,this.prefetchDelegate=o,this.filepoolProvider=r,this.sitesProvider=i,this.textUtils=s,this.timeUtils=a,this.utils=c,this.translate=u,this.loginHelper=d,this.courseOptionsDelegate=l,this.siteHomeProvider=f,this.eventsProvider=p,this.fileHelper=h,this.appProvider=m,this.fileProvider=g,this.injector=y,this.coursesProvider=v,this.courseDwnPromises={}}return e.prototype.addHandlerDataForModules=function(e,t,n){var o=this,r=!1;return e.forEach(function(e){e&&o.sectionHasContent(e)&&e.modules&&(r=!0,e.modules.forEach(function(r){r.handlerData=o.moduleDelegate.getModuleDataFor(r.modname,r,t,e.id),n&&void 0!==n[r.id]&&(r.completionstatus=n[r.id],r.completionstatus.courseId=t)}))}),r},e.prototype.calculateSectionStatus=function(e,t,n){var o=this;return e.id==v.a.ALL_SECTIONS_ID?Promise.reject(null):this.prefetchDelegate.getModulesStatus(e.modules,t,e.id,n).then(function(t){var n=o.getSectionDownloadId(e);return o.prefetchDelegate.isBeingDownloaded(n)&&(t.status=O.a.DOWNLOADING),e.showDownload=t.status===O.a.NOT_DOWNLOADED,e.showRefresh=t.status===O.a.OUTDATED,t.status===O.a.DOWNLOADING&&o.prefetchDelegate.isBeingDownloaded(e.id)?(e.isDownloading=!0,o.prefetchDelegate.setOnProgress(n,function(t){e.count=t.count,e.total=t.total})):(e.isDownloading=!1,e.total=0),t})},e.prototype.calculateSectionsStatus=function(e,t,n){var o,r,i=this,s=[];return e.forEach(function(e){e.id===v.a.ALL_SECTIONS_ID?(o=e,e.isCalculating=!0):(e.isCalculating=!0,s.push(i.calculateSectionStatus(e,t,n).then(function(e){r=i.filepoolProvider.determinePackagesStatus(r,e.status)}).finally(function(){e.isCalculating=!1})))}),Promise.all(s).then(function(){o&&(o.showDownload=r===O.a.NOT_DOWNLOADED,o.showRefresh=r===O.a.OUTDATED,o.isDownloading=r===O.a.DOWNLOADING)}).finally(function(){o&&(o.isCalculating=!1)})},e.prototype.confirmAndPrefetchCourse=function(e,t,n,o){var r=this,i=e.prefetchCourseIcon,s=e.title,a=this.sitesProvider.getCurrentSiteId();return e.prefetchCourseIcon="spinner",e.title="core.downloading",(n?Promise.resolve(n):this.courseProvider.getSections(t.id,!1,!0)).then(function(n){return r.confirmDownloadSizeSection(t.id,void 0,n,!0).then(function(){return(o?Promise.resolve(o):r.courseOptionsDelegate.getHandlersToDisplay(r.injector,t)).then(function(e){return r.prefetchCourse(t,n,e,a)}).then(function(){return!0})},function(t){return e.prefetchCourseIcon=i,e.title=s,Promise.reject(t)})})},e.prototype.confirmAndPrefetchCourses=function(e,t){var n=this,o=this.sitesProvider.getCurrentSiteId();return this.domUtils.showConfirm(this.translate.instant("core.areyousure")).then(function(){var r=[],i=e.length,s=0;return e.forEach(function(e){var a,c,u=[],d=!0;u.push(n.courseProvider.getSections(e.id,!1,!0).then(function(e){a=e})),u.push(n.courseOptionsDelegate.getHandlersToDisplay(n.injector,e).then(function(e){c=e})),r.push(Promise.all(u).then(function(){return n.prefetchCourse(e,a,c,o)}).catch(function(e){return d=!1,Promise.reject(e)}).finally(function(){s++,t&&t({count:s,total:i,courseId:e.id,success:d})}))}),t&&t({count:0,total:i,success:!0}),n.utils.allPromises(r)})},e.prototype.confirmAndRemoveFiles=function(e,t){var n=this;return this.domUtils.showConfirm(this.translate.instant("core.course.confirmdeletemodulefiles")).then(function(){return n.prefetchDelegate.removeModuleFiles(e,t)}).catch(function(e){e&&n.domUtils.showErrorModal(e)})},e.prototype.confirmDownloadSizeSection=function(e,t,n,o){var r,i=this;if(t&&t.id!=v.a.ALL_SECTIONS_ID)r=this.prefetchDelegate.getDownloadSize(t.modules,e);else{var s=[],a={size:0,total:!0};n.forEach(function(t){t.id!=v.a.ALL_SECTIONS_ID&&s.push(i.prefetchDelegate.getDownloadSize(t.modules,e).then(function(e){a.total=a.total&&e.total,a.size+=e.size}))}),r=Promise.all(s).then(function(){return a})}return r.then(function(e){return i.domUtils.confirmDownloadSize(e,void 0,void 0,void 0,void 0,o)})},e.prototype.contextMenuPrefetch=function(e,t,n){var o=this,r=e.prefetchStatusIcon;return e.prefetchStatusIcon="spinner",this.prefetchDelegate.getModuleDownloadSize(t,n,!0).then(function(e){return o.domUtils.confirmDownloadSize(e).then(function(){return o.prefetchDelegate.prefetchModule(t,n,!0)})}).catch(function(t){e.prefetchStatusIcon=r,e.isDestroyed||o.domUtils.showErrorModalDefault(t,"core.errordownloading",!0)})},e.prototype.determineCoursesStatus=function(e){var t=this,n=[],o=this.sitesProvider.getCurrentSiteId();return e.forEach(function(e){n.push(t.courseProvider.getCourseStatus(e.id,o))}),Promise.all(n).then(function(e){for(var n=e[0],o=1;o<e.length;o++)n=t.filepoolProvider.determinePackagesStatus(n,e[o]);return n})},e.prototype.downloadModuleAndOpenFile=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteId();return(r?Promise.resolve(r):this.courseProvider.loadModuleContents(e,t).then(function(){r=e.contents})).then(function(){return r&&r.length?s.sitesProvider.getSite(i):Promise.reject(null)}).then(function(a){var c=r[0],u=s.fileHelper.getFileUrl(c);if(s.fileHelper.shouldOpenInBrowser(c)){if(s.appProvider.isOnline()){var d=a.fixPluginfileURL(u).replace("&offline=1","");return d=d.replace(/forcedownload=\d+&/,""),d=d.replace(/[\?|\&]forcedownload=\d+/,""),s.utils.openInBrowser(d),void(s.fileProvider.isAvailable()&&s.downloadModule(e,t,n,o,r,i))}return s.filepoolProvider.getInternalUrlByUrl(i,u).then(function(e){return s.utils.openFile(e)}).catch(function(e){return Promise.reject(s.translate.instant("core.networkerrormsg"))})}return s.downloadModuleWithMainFileIfNeeded(e,t,n,o,r,i).then(function(a){return 0===a.path.indexOf("http")?s.utils.openOnlineFile(a.path).catch(function(c){if(!s.fileProvider.isAvailable())return Promise.reject(c);if(a.status===O.a.DOWNLOADING)return Promise.reject(s.translate.instant("core.erroropenfiledownloading"));return(a.status===O.a.NOT_DOWNLOADED?s.downloadModule(e,t,n,o,r,i).then(function(){return s.filepoolProvider.getInternalUrlByUrl(i,u)}):s.filepoolProvider.getInternalUrlByUrl(i,u)).then(function(e){return s.utils.openFile(e)})}):s.utils.openFile(a.path)})})},e.prototype.downloadModuleWithMainFileIfNeeded=function(e,t,n,o,r,i){var s=this;if(i=i||this.sitesProvider.getCurrentSiteId(),!r||!r.length)return Promise.reject(null);var a=r[0],c=this.fileHelper.getFileUrl(a),u=this.fileHelper.getFileTimemodified(a),d={fixedUrl:void 0,path:void 0,status:void 0};return this.sitesProvider.getSite(i).then(function(l){var f=l.fixPluginfileURL(c);return d.fixedUrl=f,s.fileProvider.isAvailable()?s.filepoolProvider.getPackageStatus(i,n,o).then(function(l){d.status=l;var p=!s.appProvider.isNetworkAccessLimited(),h=s.appProvider.isOnline();return l===O.a.DOWNLOADED?s.filepoolProvider.getInternalUrlByUrl(i,c).catch(function(e){return s.filepoolProvider.storePackageStatus(i,O.a.NOT_DOWNLOADED,n,o).then(function(){return Promise.reject(e)})}):l!==O.a.DOWNLOADING||s.appProvider.isDesktop()?h||l!==O.a.NOT_DOWNLOADED?s.filepoolProvider.shouldDownloadBeforeOpen(f,a.filesize).then(function(){return s.downloadModule(e,t,n,o,r,i).then(function(){return s.filepoolProvider.getInternalUrlByUrl(i,c)})},function(){return p&&h&&s.downloadModule(e,t,n,o,r,i),!s.fileHelper.isStateDownloaded(l)||h?f:s.filepoolProvider.getUrlByUrl(i,c,n,o,u,!1,!1,a)}):Promise.reject(s.translate.instant("core.networkerrormsg")):f}).then(function(e){return d.path=e,d}):(d.path=f,d)})},e.prototype.downloadModule=function(e,t,n,o,r,i){var s=this.prefetchDelegate.getPrefetchHandlerFor(e);return s?s.download?s.download(e,t):s.prefetch(e,t,!0):(r=r||e.contents,this.filepoolProvider.downloadOrPrefetchFiles(i,r,!1,!1,n,o))},e.prototype.fillContextMenu=function(e,t,n,o,r){var i=this;return this.getModulePrefetchInfo(t,n,o,r).then(function(o){e.size=o.size>0?o.sizeReadable:0,e.prefetchStatusIcon=o.statusIcon,o.status!=O.a.NOT_DOWNLOADABLE&&(e.prefetchText=o.downloadTime>0?i.translate.instant("core.lastdownloaded")+": "+o.downloadTimeReadable:i.translate.instant("core.download")),void 0===e.statusObserver&&r&&(e.statusObserver=i.eventsProvider.on(s.a.PACKAGE_STATUS_CHANGED,function(o){o.componentId==t.id&&o.component==r&&i.fillContextMenu(e,t,n,!1,r)},i.sitesProvider.getCurrentSiteId()))})},e.prototype.getCourseDownloadPromise=function(e,t){return t=t||this.sitesProvider.getCurrentSiteId(),this.courseDwnPromises[t]&&this.courseDwnPromises[t][e]},e.prototype.getCourseStatusIconAndTitle=function(e,t){var n=this;return this.courseProvider.getCourseStatus(e,t).then(function(e){return n.getCourseStatusIconAndTitleFromStatus(e)})},e.prototype.getCourseStatusIconAndTitleFromStatus=function(e){return e==O.a.DOWNLOADED?{icon:"refresh",title:"core.course.refreshcourse"}:e==O.a.DOWNLOADING?{icon:"spinner",title:"core.downloading"}:{icon:"cloud-download",title:"core.course.downloadcourse"}},e.prototype.getModuleCourseIdByInstance=function(e,t,n){var o=this;return this.courseProvider.getModuleBasicInfoByInstance(e,t,n).then(function(e){return e.course}).catch(function(e){return o.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0),Promise.reject(null)})},e.prototype.getModulePrefetchInfo=function(e,t,n,o){var r=this,i={},s=this.sitesProvider.getCurrentSiteId(),a=[];return n&&this.prefetchDelegate.invalidateModuleStatusCache(e),a.push(this.prefetchDelegate.getModuleDownloadedSize(e,t).then(function(e){i.size=e,i.sizeReadable=r.textUtils.bytesToSize(e,2)})),a.push(this.prefetchDelegate.getModuleStatus(e,t).then(function(e){switch(i.status=e,e){case O.a.NOT_DOWNLOADED:i.statusIcon="cloud-download";break;case O.a.DOWNLOADING:i.statusIcon="spinner";break;case O.a.OUTDATED:i.statusIcon="refresh";break;case O.a.DOWNLOADED:if(!r.prefetchDelegate.canCheckUpdates()){i.statusIcon="refresh";break}default:i.statusIcon=""}})),a.push(this.filepoolProvider.getPackageData(s,o,e.id).then(function(e){if(e&&e.downloadTime&&(e.status==O.a.OUTDATED||e.status==O.a.DOWNLOADED)){var t=r.timeUtils.timestamp();i.downloadTime=e.downloadTime,i.downloadTimeReadable=t-e.downloadTime<604800?w(1e3*e.downloadTime).fromNow():w(1e3*e.downloadTime).calendar()}}).catch(function(){i.downloadTime=0})),Promise.all(a).then(function(){return i})},e.prototype.getSectionDownloadId=function(e){return"Section-"+e.id},e.prototype.navigateToModule=function(e,t,n,o){var r=this;t=t||this.sitesProvider.getCurrentSiteId();var i,s=this.domUtils.showModalLoading();return(n&&o?Promise.resolve():n?this.courseProvider.getModuleSectionId(e,t).then(function(e){o=e}):this.courseProvider.getModuleBasicInfo(e,t).then(function(e){n=e.course,o=e.section})).then(function(){return n=Number(n),o=Number(o),r.sitesProvider.getSite(t)}).then(function(s){return i=s,r.courseProvider.getModule(e,n,o,!1,!1,t)}).then(function(e){var s={course:{id:n},module:e,sectionId:o};if(e.handlerData=r.moduleDelegate.getModuleDataFor(e.modname,e,n,o),n==i.getSiteHomeId())return r.siteHomeProvider.isAvailable().then(function(){r.loginHelper.redirect("CoreSiteHomeIndexPage",s,t)});r.loginHelper.redirect("CoreCourseSectionPage",s,t)}).catch(function(e){r.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}).finally(function(){s.dismiss()})},e.prototype.openModule=function(e,t,n,o){return t.handlerData||(t.handlerData=this.moduleDelegate.getModuleDataFor(t.modname,t,n,o)),!(!t.handlerData||!t.handlerData.action)&&(t.handlerData.action(new Event("click"),e,t,n,{animate:!1}),!0)},e.prototype.prefetchCourse=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.courseDwnPromises[o]&&this.courseDwnPromises[o][e.id]?this.courseDwnPromises[o][e.id]:(this.courseDwnPromises[o]||(this.courseDwnPromises[o]={}),this.courseDwnPromises[o][e.id]=this.courseProvider.setCourseStatus(e.id,O.a.DOWNLOADING,o).then(function(){var o=[],i=t[0];return t[0].id!=v.a.ALL_SECTIONS_ID&&(i={id:v.a.ALL_SECTIONS_ID}),o.push(r.prefetchSection(i,e.id,t)),n.forEach(function(t){t.prefetch&&o.push(t.prefetch(e))}),r.coursesProvider.isGetCoursesByFieldAvailable()&&o.push(r.coursesProvider.getCoursesByField("id",e.id)),o.push(r.courseProvider.getActivitiesCompletionStatus(e.id)),r.utils.allPromises(o)}).then(function(){return r.courseProvider.setCourseStatus(e.id,O.a.DOWNLOADED,o)}).catch(function(t){return r.courseProvider.setCoursePreviousStatus(e.id,o).then(function(){return Promise.reject(t)})}).finally(function(){delete r.courseDwnPromises[o][e.id]}),this.courseDwnPromises[o][e.id])},e.prototype.prefetchModule=function(e,t,n,o,r){return this.domUtils.confirmDownloadSize(n).then(function(){return(r?e.invalidateContent(t.id,o):Promise.resolve()).catch(function(){}).then(function(){return e.prefetch(t,o,!0)})})},e.prototype.prefetchSection=function(e,t,n){var o=this;if(e.id!=v.a.ALL_SECTIONS_ID)return this.prefetchSingleSectionIfNeeded(e,t).then(function(){return o.calculateSectionStatus(e,t)});var r,i=[];return e.isDownloading=!0,n.forEach(function(e){e.id!=v.a.ALL_SECTIONS_ID&&i.push(o.prefetchSingleSectionIfNeeded(e,t).then(function(){return o.calculateSectionStatus(e,t).then(function(e){r=o.filepoolProvider.determinePackagesStatus(r,e.status)})}))}),this.utils.allPromises(i).then(function(){e.showDownload=r===O.a.NOT_DOWNLOADED,e.showRefresh=r===O.a.OUTDATED,e.isDownloading=r===O.a.DOWNLOADING}).finally(function(){e.isDownloading=!1})},e.prototype.prefetchSingleSectionIfNeeded=function(e,t){var n=this;return e.id==v.a.ALL_SECTIONS_ID?Promise.resolve():(e.isDownloading=!0,this.prefetchDelegate.getModulesStatus(e.modules,t,e.id).then(function(o){if(o.status!=O.a.DOWNLOADED&&o.status!=O.a.NOT_DOWNLOADABLE)return n.prefetchSingleSection(e,o,t)},function(t){return e.isDownloading=!1,Promise.reject(t)}))},e.prototype.prefetchSingleSection=function(e,t,n){if(e.id==v.a.ALL_SECTIONS_ID)return Promise.resolve();if(e.total>0)return Promise.resolve();var o=t[O.a.OUTDATED].concat(t[O.a.NOT_DOWNLOADED]).concat(t[O.a.DOWNLOADING]),r=this.getSectionDownloadId(e);return e.isDownloading=!0,this.prefetchDelegate.prefetchModules(r,o,n,function(t){e.count=t.count,e.total=t.total})},e.prototype.sectionHasContent=function(e){return!e.hiddenbynumsections&&(void 0!==e.availabilityinfo&&""!=e.availabilityinfo||""!=e.summary||e.modules&&e.modules.length>0)},e=S([Object(o.A)(),R("design:paramtypes",[v.a,l.a,b.a,_.a,c.a,d.a,f.a,p.a,h.a,r.c,P.a,m.a,g.a,s.a,u.a,i.a,a.a,o.C,y.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(5),s=(n.n(i),n(30)),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.translate=e}return e.prototype.formatTime=function(e){var t,n,o,r,i,a,c;c=(t=Math.abs(e))-(n=Math.floor(t/s.a.SECONDS_YEAR))*s.a.SECONDS_YEAR,c=t-(o=Math.floor(c/s.a.SECONDS_DAY))*s.a.SECONDS_DAY,c-=(r=Math.floor(c/s.a.SECONDS_HOUR))*s.a.SECONDS_HOUR,i=Math.floor(c/s.a.SECONDS_MINUTE);var u=this.translate.instant("core."+(1==(a=c-i*s.a.SECONDS_MINUTE)?"sec":"secs")),d=this.translate.instant("core."+(1==i?"min":"mins")),l=this.translate.instant("core."+(1==r?"hour":"hours")),f=this.translate.instant("core."+(1==o?"day":"days")),p=this.translate.instant("core."+(1==n?"year":"years")),h="",m="",g="",y="",v="";return n&&(h=n+" "+p),o&&(m=o+" "+f),r&&(g=r+" "+l),i&&(y=i+" "+d),a&&(v=a+" "+u),n?h+" "+m:o?m+" "+g:r?g+" "+y:i?y+" "+v:a?v:this.translate.instant("core.now")},e.prototype.formatDuration=function(e,t){t=t||5;var n=i.duration(e,"seconds"),o="";return t&&n.years()>0&&(o+=" "+i.duration(n.years(),"years").humanize(),t--),t&&n.months()>0&&(o+=" "+i.duration(n.months(),"months").humanize(),t--),t&&n.days()>0&&(o+=" "+i.duration(n.days(),"days").humanize(),t--),t&&n.hours()>0&&(o+=" "+i.duration(n.hours(),"hours").humanize(),t--),t&&n.minutes()>0&&(o+=" "+i.duration(n.minutes(),"minutes").humanize(),t--),o.trim()},e.prototype.readableTimestamp=function(){return i(Date.now()).format("YYYYMMDDHHmmSS")},e.prototype.timestamp=function(){return Math.round(Date.now()/1e3)},e.prototype.getLocalizedDateFormat=function(e){return i.localeData().longDateFormat(e)},e=a([Object(o.A)(),c("design:paramtypes",[r.c])],e)}()},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(18),i=n(7),s=n(2),a=n(6),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.utils=n,this.filepoolProvider=o,this.ROOT_CACHE_KEY="mmUser:",this.USERS_TABLE="users",this.tablesSchema=[{name:this.USERS_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"fullname",type:"TEXT"},{name:"profileimageurl",type:"TEXT"}]}],this.logger=e.getInstance("CoreUserProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.changeProfilePicture=function(e,t){var n={draftitemid:e,delete:0,userid:t};return this.sitesProvider.getCurrentSite().write("core_user_update_picture",n).then(function(e){return e.success?e.profileimageurl:Promise.reject(null)})},e.prototype.deleteStoredUser=function(e,t){var n=this;if(isNaN(e))return Promise.reject(null);var o=[];return t=t||this.sitesProvider.getCurrentSiteId(),o.push(this.invalidateUserCache(e,t)),o.push(this.sitesProvider.getSite(t).then(function(t){return t.getDb().deleteRecords(n.USERS_TABLE,{id:e})})),Promise.all(o)},e.prototype.getParticipants=function(e,n,o,r){var i=this;return void 0===n&&(n=0),void 0===o&&(o=t.PARTICIPANTS_LIST_LIMIT),this.sitesProvider.getSite(r).then(function(t){i.logger.debug("Get participants for course '"+e+"' starting at '"+n+"'");var s={courseid:e,options:[{name:"limitfrom",value:n},{name:"limitnumber",value:o},{name:"sortby",value:"siteorder"}]},a={cacheKey:i.getParticipantsListCacheKey(e)};return t.read("core_enrol_get_enrolled_users",s,a).then(function(e){var t=e.length>=o;return i.storeUsers(e,r),{participants:e,canLoadMore:t}})})},e.prototype.getParticipantsListCacheKey=function(e){return this.ROOT_CACHE_KEY+"list:"+e},e.prototype.getProfile=function(e,t,n,o){var r=this;return void 0===n&&(n=!1),o=o||this.sitesProvider.getCurrentSiteId(),n?this.getUserFromLocalDb(e,o).catch(function(){return r.getUserFromWS(e,t,o)}):this.getUserFromWS(e,t,o).catch(function(){return r.getUserFromLocalDb(e,o)})},e.prototype.getUserCacheKey=function(e){return this.ROOT_CACHE_KEY+"data:"+e},e.prototype.getUserFromLocalDb=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.getDb().getRecord(n.USERS_TABLE,{id:e})})},e.prototype.getUserFromWS=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r,i,s={cacheKey:o.getUserCacheKey(e)};return t&&t!=n.getSiteHomeId()?(o.logger.debug("Get participant with ID '"+e+"' in course '"+t),r="core_user_get_course_user_profiles",i={userlist:[{userid:e,courseid:t}]}):(o.logger.debug("Get user with ID '"+e+"'"),r="core_user_get_users_by_field",i={field:"id","values[0]":e}),n.read(r,i,s).then(function(e){if(0==e.length)return Promise.reject("Cannot retrieve user info.");var t=e.shift();return t.country&&(t.country=o.utils.getCountryName(t.country)),o.storeUser(t.id,t.fullname,t.profileimageurl),t})})},e.prototype.invalidateUserCache=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getUserCacheKey(e))})},e.prototype.invalidateParticipantsList=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getParticipantsListCacheKey(e))})},e.prototype.isParticipantsDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isParticipantsDisabledInSite(e)})},e.prototype.isParticipantsDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreCourseOptionsDelegate_CoreUserParticipants")},e.prototype.isPluginEnabledForCourse=function(e,t){return e?this.utils.promiseWorks(this.getParticipants(e,0,1,t)):Promise.reject(null)},e.prototype.isUpdatePictureDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreUserDelegate_picture")},e.prototype.logView=function(e,t){var n={userid:e};return t&&(n.courseid=t),this.sitesProvider.getCurrentSite().write("core_user_view_user_profile",n)},e.prototype.logParticipantsView=function(e){return this.sitesProvider.getCurrentSite().write("core_user_view_user_list",{courseid:e})},e.prototype.prefetchProfiles=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r={},i=[];return e.forEach(function(e){e=Number(e),isNaN(e)||r[e]||(r[e]=!0,i.push(o.getProfile(e,t,!1,n).then(function(e){e.profileimageurl&&o.filepoolProvider.addToQueueByUrl(n,e.profileimageurl)})))}),Promise.all(i)},e.prototype.storeUser=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={id:e,fullname:t,profileimageurl:n};return o.getDb().insertRecord(r.USERS_TABLE,i)})},e.prototype.storeUsers=function(e,t){var n=this,o=[];return e.forEach(function(e){void 0===e.id||isNaN(parseInt(e.id,10))||o.push(n.storeUser(parseInt(e.id,10),e.fullname,e.profileimageurl,t))}),Promise.all(o)},e.prototype.updateUserPreference=function(e,t,n,o){return this.updateUserPreferences([{type:e,value:t}],void 0,n,o)},e.prototype.updateUserPreferences=function(e,t,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={userid:n=n||o.getUserId(),preferences:e};return void 0!==t&&(r.emailstop=t?1:0),o.write("core_user_update_user_preferences",r,{responseExpected:!1})})},e.PARTICIPANTS_LIST_LIMIT=50,e.PROFILE_REFRESHED="CoreUserProfileRefreshed",e.PROFILE_PICTURE_UPDATED="CoreUserProfilePictureUpdated",e=t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a,a.a,r.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(183),s=n(9),a=n(7),c=n(77),u=n(11),d=n(321),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.platform=t,this.file=n,this.appProvider=o,this.textUtils=r,this.zip=i,this.mimeUtils=s,this.initialized=!1,this.basePath="",this.isHTMLAPI=!1,this.logger=e.getInstance("CoreFileProvider")}return t=e,e.prototype.setHTMLBasePath=function(e){this.isHTMLAPI=!0,this.basePath=e},e.prototype.usesHTMLAPI=function(){return this.isHTMLAPI},e.prototype.init=function(){var e=this;return this.initialized?Promise.resolve():this.platform.ready().then(function(){if(e.platform.is("android"))e.basePath=e.file.externalApplicationStorageDirectory;else if(e.platform.is("ios"))e.basePath=e.file.documentsDirectory;else if(!e.isAvailable()||""===e.basePath)return e.logger.error("Error getting device OS."),Promise.reject(null);e.initialized=!0,e.logger.debug("FS initialized: "+e.basePath)})},e.prototype.isAvailable=function(){return void 0!==window.resolveLocalFileSystemURL},e.prototype.getFile=function(e){var t=this;return this.init().then(function(){return t.logger.debug("Get file: "+e),t.file.resolveLocalFilesystemUrl(t.addBasePathIfNeeded(e))}).then(function(e){return e})},e.prototype.getDir=function(e){var t=this;return this.init().then(function(){return t.logger.debug("Get directory: "+e),t.file.resolveDirectoryUrl(t.addBasePathIfNeeded(e))})},e.prototype.getSiteFolder=function(e){return t.SITESFOLDER+"/"+e},e.prototype.create=function(e,t,n,o){var r=this;return this.init().then(function(){if(t=r.removeStartingSlash(t.replace(r.basePath,"")),o=o||r.basePath,-1==t.indexOf("/"))return e?(r.logger.debug("Create dir "+t+" in "+o),r.file.createDir(o,t,!n)):(r.logger.debug("Create file "+t+" in "+o),r.file.createFile(o,t,!n));var i=t.substr(0,t.indexOf("/")),s=t.substr(t.indexOf("/")+1);return r.logger.debug("Create dir "+i+" in "+o),r.file.createDir(o,i,!0).then(function(t){return r.create(e,s,n,t.toURL())}).catch(function(e){return r.logger.error("Error creating directory "+i+" in "+o),Promise.reject(e)})})},e.prototype.createDir=function(e,t){return this.create(!0,e,t)},e.prototype.createFile=function(e,t){return this.create(!1,e,t)},e.prototype.removeDir=function(e){var t=this;return this.init().then(function(){return e=t.removeStartingSlash(e.replace(t.basePath,"")),t.logger.debug("Remove directory: "+e),t.file.removeRecursively(t.basePath,e)})},e.prototype.removeFile=function(e){var t=this;return this.init().then(function(){return e=t.removeStartingSlash(e.replace(t.basePath,"")),t.logger.debug("Remove file: "+e),t.file.removeFile(t.basePath,e)})},e.prototype.removeFileByFileEntry=function(e){return new Promise(function(t,n){e.remove(t,n)})},e.prototype.getDirectoryContents=function(e){var t=this;return this.init().then(function(){return e=t.removeStartingSlash(e.replace(t.basePath,"")),t.logger.debug("Get contents of dir: "+e),t.file.listDir(t.basePath,e)})},e.prototype.getSize=function(e){var t=this;return new Promise(function(n,o){if(e.isDirectory){e.createReader().readEntries(function(e){for(var r=[],i=0;i<e.length;i++)r.push(t.getSize(e[i]));Promise.all(r).then(function(e){for(var t=0,r=0;r<e.length;r++){var i=parseInt(e[r]);if(isNaN(i))return void o();t+=i}n(t)},o)},o)}else e.isFile&&e.file(function(e){n(e.size)},o)})},e.prototype.getDirectorySize=function(e){var t=this;return e=this.removeStartingSlash(e.replace(this.basePath,"")),this.logger.debug("Get size of dir: "+e),this.getDir(e).then(function(e){return t.getSize(e)})},e.prototype.getFileSize=function(e){var t=this;return e=this.removeStartingSlash(e.replace(this.basePath,"")),this.logger.debug("Get size of file: "+e),this.getFile(e).then(function(e){return t.getSize(e)})},e.prototype.getFileObjectFromFileEntry=function(e){var t=this;return new Promise(function(n,o){t.logger.debug("Get file object of: "+e.fullPath),e.file(n,o)})},e.prototype.calculateFreeSpace=function(){return this.file.getFreeDiskSpace().then(function(e){return e})},e.prototype.normalizeFileName=function(e){return e=this.textUtils.decodeURIComponent(e)},e.prototype.readFile=function(e,n){switch(void 0===n&&(n=t.FORMATTEXT),e=this.removeStartingSlash(e.replace(this.basePath,"")),this.logger.debug("Read file "+e+" with format "+n),n){case t.FORMATDATAURL:return this.file.readAsDataURL(this.basePath,e);case t.FORMATBINARYSTRING:return this.file.readAsBinaryString(this.basePath,e);case t.FORMATARRAYBUFFER:return this.file.readAsArrayBuffer(this.basePath,e);default:return this.file.readAsText(this.basePath,e)}},e.prototype.readFileData=function(e,n){return void 0===n&&(n=t.FORMATTEXT),n=n||t.FORMATTEXT,this.logger.debug("Read file from file data with format "+n),new Promise(function(o,r){var i=new FileReader;i.onloadend=function(e){var t=e.target;void 0!==t.result||null!==t.result?o(t.result):r(void 0!==t.error||null!==t.error?t.error:{code:null,message:"READER_ONLOADEND_ERR"})};var s=!1;switch(i.onloadstart=function(e){s=!0},setTimeout(function(){s||r()},3e3),n){case t.FORMATDATAURL:i.readAsDataURL(e);break;case t.FORMATBINARYSTRING:i.readAsBinaryString(e);break;case t.FORMATARRAYBUFFER:i.readAsArrayBuffer(e);break;default:i.readAsText(e)}})},e.prototype.writeFile=function(e,t){var n=this;return this.init().then(function(){return e=n.removeStartingSlash(e.replace(n.basePath,"")),n.logger.debug("Write file: "+e),n.createFile(e).then(function(o){if(n.isHTMLAPI&&!n.appProvider.isDesktop()&&("string"==typeof t||"[object ArrayBuffer]"==t.toString())){var r=n.mimeUtils.getMimeType(n.mimeUtils.getFileExtension(e));t=new Blob([t],{type:r||"text/plain"})}return n.file.writeFile(n.basePath,e,t,{replace:!0}).then(function(){return o})})})},e.prototype.getExternalFile=function(e){return this.file.resolveLocalFilesystemUrl(e).then(function(e){return e})},e.prototype.removeExternalFile=function(e){var t=e.substring(0,e.lastIndexOf("/")),n=e.substr(e.lastIndexOf("/")+1);return this.file.removeFile(t,n)},e.prototype.getBasePath=function(){var e=this;return this.init().then(function(){return"/"==e.basePath.slice(-1)?e.basePath:e.basePath+"/"})},e.prototype.getBasePathToDownload=function(){var e=this;return this.init().then(function(){return e.platform.is("ios")?e.file.resolveDirectoryUrl(e.basePath).then(function(e){return e.toInternalURL()}):e.basePath})},e.prototype.getBasePathInstant=function(){return this.basePath?"/"==this.basePath.slice(-1)?this.basePath:this.basePath+"/":this.basePath},e.prototype.moveFile=function(e,t){var n=this;return this.init().then(function(){if(e=n.removeStartingSlash(e.replace(n.basePath,"")),t=n.removeStartingSlash(t.replace(n.basePath,"")),n.isHTMLAPI){for(var o=e.split("/"),r=t.split("/"),i=n.basePath,s=0;s<o.length;s++){var a=o[s];if(r[s]!==a)break;i=n.textUtils.concatenatePaths(i,a+="/"),e=e.replace(a,""),t=t.replace(a,"")}return n.file.moveFile(i,e,i,t)}return n.file.moveFile(n.basePath,e,n.basePath,t).catch(function(o){var r=decodeURI(e),i=decodeURI(t);return r!=e||i!=t?n.file.moveFile(n.basePath,r,n.basePath,i):Promise.reject(o)})})},e.prototype.copyFile=function(e,t){var n,o,r=this;return this.init().then(function(){if(e=r.removeStartingSlash(e.replace(r.basePath,"")),t=r.removeStartingSlash(t.replace(r.basePath,"")),n=r.getFileAndDirectoryFromPath(e),(o=r.getFileAndDirectoryFromPath(t)).directory)return r.createDir(o.directory)}).then(function(){if(r.isHTMLAPI){var i=r.textUtils.concatenatePaths(r.basePath,n.directory),s=r.textUtils.concatenatePaths(r.basePath,o.directory);return r.file.copyFile(i,n.name,s,o.name)}return r.file.copyFile(r.basePath,e,r.basePath,t).catch(function(n){var o=decodeURI(e),i=decodeURI(t);return e!=o||t!=i?r.file.copyFile(r.basePath,o,r.basePath,i):Promise.reject(n)})})},e.prototype.getFileAndDirectoryFromPath=function(e){var t={directory:"",name:""};return t.directory=e.substring(0,e.lastIndexOf("/")),t.name=e.substr(e.lastIndexOf("/")+1),t},e.prototype.getInternalURL=function(e){return e.toInternalURL?e.toInternalURL():e.toURL()},e.prototype.addBasePathIfNeeded=function(e){return e.indexOf(this.basePath)>-1?e:this.textUtils.concatenatePaths(this.basePath,e)},e.prototype.removeBasePath=function(e){if(e.indexOf(this.basePath)>-1)return e.replace(this.basePath,"")},e.prototype.unzipFile=function(e,t,n){var o=this;return this.getFile(e).then(function(r){return t=o.addBasePathIfNeeded(t||o.mimeUtils.removeExtension(e)),o.zip.unzip(r.toURL(),t,n)}).then(function(e){if(-1==e)return Promise.reject(null)})},e.prototype.replaceInFile=function(e,t,n){var o=this;return this.readFile(e).then(function(r){return void 0!==r&&null!==r&&r.replace?r.match(t)?(r=r.replace(t,n),o.writeFile(e,r)):void 0:Promise.reject(null)})},e.prototype.getMetadata=function(e){return e&&e.getMetadata?new Promise(function(t,n){e.getMetadata(t,n)}):Promise.reject(null)},e.prototype.getMetadataFromPath=function(e,t){var n=this;return(t?this.getDir(e):this.getFile(e)).then(function(e){return n.getMetadata(e)})},e.prototype.removeStartingSlash=function(e){return"/"==e[0]?e.substr(1):e},e.prototype.copyOrMoveExternalFile=function(e,t,n){var o=this;return this.getExternalFile(e).then(function(e){var r=o.getFileAndDirectoryFromPath(t);return o.createDir(r.directory).then(function(t){return new Promise(function(o,i){n?e.copyTo(t,r.name,o,i):e.moveTo(t,r.name,o,i)})})})},e.prototype.copyExternalFile=function(e,t){return this.copyOrMoveExternalFile(e,t,!0)},e.prototype.moveExternalFile=function(e,t){return this.copyOrMoveExternalFile(e,t,!1)},e.prototype.getUniqueNameInFolder=function(e,t,n){var o=this;return this.getDirectoryContents(e).then(function(e){var r,i={},s=1,a=o.mimeUtils.removeExtension(t),c=o.mimeUtils.getFileExtension(t)||n;if(a=o.textUtils.removeSpecialCharactersForFiles(o.textUtils.decodeURIComponent(a)),e.forEach(function(e){i[e.name]=e}),c=c?"."+c:"",r=a+c,void 0===i[r])return r;do{r=a+"("+s+")"+c,s++}while(void 0!==i[r]);return r}).catch(function(){return o.textUtils.removeSpecialCharactersForFiles(o.textUtils.decodeURIComponent(t))})},e.prototype.clearTmpFolder=function(){return this.removeDir(t.TMPFOLDER).catch(function(){})},e.prototype.removeUnusedFiles=function(e,t){var n=this;return this.getDirectoryContents(e).then(function(e){if(e.length){var o={},r=[];return t.forEach(function(e){e.fullPath&&(o[e.fullPath]=e)}),e.forEach(function(e){o[e.fullPath]||r.push(n.removeFileByFileEntry(e))}),Promise.all(r)}}).catch(function(){})},e.prototype.isFileInAppFolder=function(e){return-1!=e.indexOf(this.basePath)},e.FORMATTEXT=0,e.FORMATDATAURL=1,e.FORMATBINARYSTRING=2,e.FORMATARRAYBUFFER=3,e.SITESFOLDER="sites",e.TMPFOLDER="tmp",e=t=l([Object(o.A)(),f("design:paramtypes",[a.a,r.s,i.a,s.a,u.a,d.a,c.a])],e);var t}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){}return e.SECONDS_YEAR=31536e3,e.SECONDS_WEEK=604800,e.SECONDS_DAY=86400,e.SECONDS_HOUR=3600,e.SECONDS_MINUTE=60,e.WIFI_DOWNLOAD_THRESHOLD=104857600,e.DOWNLOAD_THRESHOLD=10485760,e.DONT_SHOW_ERROR="CoreDontShowError",e.NO_SITE_ID="NoSite",e.SETTINGS_RICH_TEXT_EDITOR="CoreSettingsRichTextEditor",e.SETTINGS_NOTIFICATION_SOUND="CoreSettingsNotificationSound",e.SETTINGS_SYNC_ONLY_ON_WIFI="CoreSettingsSyncOnlyOnWifi",e.SETTINGS_REPORT_IN_BACKGROUND="CoreSettingsReportInBackground",e.WS_TIMEOUT=3e4,e.WS_PREFIX="local_mobile_",e.LOGIN_SSO_CODE=2,e.LOGIN_SSO_INAPP_CODE=3,e.LOGIN_LAUNCH_DATA="CoreLoginLaunchData",e.DOWNLOADED="downloaded",e.DOWNLOADING="downloading",e.NOT_DOWNLOADED="notdownloaded",e.OUTDATED="outdated",e.NOT_DOWNLOADABLE="notdownloadable",e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){this.name="CoreContentLinksHandlerBase",this.priority=0,this.checkAllUsers=!1,this.featureName=""}return e.prototype.getActions=function(e,t,n,o){return[]},e.prototype.handles=function(e){return this.pattern&&e.search(this.pattern)>=0},e.prototype.getSiteUrl=function(e){if(this.pattern){var t=e.search(this.pattern);if(t>-1)return e.substr(0,t)}},e.prototype.isEnabled=function(e,t,n,o){return!0},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(79),c=n(7),u=n(2),d=n(8),l=n(11),f=n(47),p=n(71),h=n(33),m=n(30),g=n(72),y=n(50),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(){function e(e,t,n,o,r,i,a,c,u,d,l,f){this.sitesProvider=t,this.loginHelper=n,this.contentLinksDelegate=o,this.appProvider=r,this.domUtils=i,this.urlUtils=a,this.translate=c,this.initDelegate=u,this.textUtils=l,this.sitePluginsProvider=f,this.logger=e.getInstance("CoreContentLinksHelperProvider"),d.on(s.a.APP_LAUNCHED_URL,this.handleCustomUrl.bind(this))}return e.prototype.getFirstValidAction=function(e){if(e)for(var t=0;t<e.length;t++){var n=e[t];if(n&&n.sites&&n.sites.length)return n}},e.prototype.goInSite=function(e,t,n,o){o=o||this.sitesProvider.getCurrentSiteId(),e&&o==this.sitesProvider.getCurrentSiteId()?e.push(t,n):this.loginHelper.redirect(t,n,o)},e.prototype.goToChooseSite=function(e){this.appProvider.getRootNavController().setRoot("CoreContentLinksChooseSitePage",{url:e})},e.prototype.handleCustomUrl=function(e){var t=this,n=g.a.customurlscheme+"://link";if(-1==e.indexOf(n))return!1;var o,r=this.domUtils.showModalLoading();return e=this.textUtils.decodeURIComponent(e),this.logger.debug("Treating custom URL scheme: "+e),e=e.replace(n+"=",""),(o=this.urlUtils.getUsernameFromUrl(e))&&(e=e.replace(o+"@","")),this.initDelegate.ready().then(function(){return t.sitesProvider.getSiteIdsFromUrl(e,!1,o)}).then(function(n){if(n.length)return r.dismiss(),t.handleLink(e,o).then(function(e){e||t.domUtils.showErrorModal("core.contentlinks.errornoactions",!0)});var i=t.contentLinksDelegate.getSiteUrl(e);return i?t.sitesProvider.checkSite(i).then(function(n){var i,s=t.loginHelper.isSSOLoginNeeded(n.code),a="CoreLoginCredentialsPage",c={siteUrl:n.siteUrl,username:o,urlToOpen:e,siteConfig:n.config},u=!1;if(r.dismiss(),t.sitesProvider.isLoggedIn()){var d=t.translate.instant("core.contentlinks.confirmurlothersite");i=t.domUtils.showConfirm(d).then(function(){if(!s)return(u=t.sitePluginsProvider.hasSitePluginsLoaded)&&t.appProvider.storeRedirect(m.a.NO_SITE_ID,a,c),t.sitesProvider.logout().catch(function(){})})}else i=Promise.resolve();return i.then(function(){s?t.loginHelper.confirmAndOpenBrowserForSSOLogin(n.siteUrl,n.code,n.service,n.config&&n.config.launchurl):u||t.appProvider.getRootNavController().setRoot(a,c)})}).catch(function(e){e&&t.domUtils.showErrorModal(e)}):void t.domUtils.showErrorModal("core.login.invalidsite",!0)}).finally(function(){r.dismiss()}),!0},e.prototype.handleLink=function(e,t,n){var o=this;return this.contentLinksDelegate.getActionsFor(e,void 0,t).then(function(t){var r=o.getFirstValidAction(t);return!!r&&(o.sitesProvider.isLoggedIn()?1==r.sites.length&&r.sites[0]==o.sitesProvider.getCurrentSiteId()?r.action(r.sites[0],n):o.domUtils.showConfirm(o.translate.instant("core.contentlinks.confirmurlothersite")).then(function(){1==r.sites.length?r.action(r.sites[0],n):o.goToChooseSite(e)}).catch(function(){}):1==r.sites.length?r.action(r.sites[0],n):o.goToChooseSite(e),!0)}).catch(function(){return!1})},e=v([Object(o.A)(),b("design:paramtypes",[c.a,u.a,p.a,h.a,i.a,d.a,f.a,r.c,a.a,s.a,l.a,y.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(47),a=n(6),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.urlUtils=n,this.utils=o,this.handlers={},this.logger=e.getInstance("CoreContentLinksDelegate")}return e.prototype.getActionsFor=function(e,t,n){var o=this;return e?this.sitesProvider.getSiteIdsFromUrl(e,!0,n).then(function(n){var r=[],i=[],s=o.urlUtils.extractUrlParams(e),a=function(a){var c=o.handlers[a],u=c.checkAllUsers,d=o.isHandlerEnabled.bind(o,c,e,s,t);if(!c.handles(e))return"continue";i.push(o.utils.filterEnabledSites(n,d,u).then(function(n){if(n.length)return Promise.resolve(c.getActions(n,e,s,t)).then(function(e){e&&e.length&&(e.forEach(function(e){e.message=e.message||"core.view",e.icon=e.icon||"eye",e.sites=e.sites||n}),r.push({priority:c.priority,actions:e}))})}))};for(var c in o.handlers)a(c);return o.utils.allPromises(i).catch(function(){}).then(function(){return o.sortActionsByPriority(r)})}):Promise.resolve([])},e.prototype.getSiteUrl=function(e){if(e)for(var t in this.handlers){var n=this.handlers[t].getSiteUrl(e);if(n)return n}},e.prototype.isHandlerEnabled=function(e,t,n,o,r){return(e.featureName?this.sitesProvider.isFeatureDisabled(e.featureName,r):Promise.resolve(!1)).then(function(i){return!i&&(!e.isEnabled||e.isEnabled(r,t,n,o))})},e.prototype.registerHandler=function(e){return void 0!==this.handlers[e.name]?(this.logger.log("Addon '"+e.name+"' already registered"),!1):(this.logger.log("Registered addon '"+e.name+"'"),this.handlers[e.name]=e,!0)},e.prototype.sortActionsByPriority=function(e){var t=[];return(e=e.sort(function(e,t){return e.priority<=t.priority?1:-1})).forEach(function(e){t=t.concat(e.actions)}),t},e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(12),i=n(7),s=n(2),a=n(10),c=n(728),u=n(58),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i){var s=e.call(this,"CoreCourseModuleDelegate",t,n,o)||this;return s.sitesProvider=n,s.courseProvider=r,s.defaultHandler=i,s.featurePrefix="CoreCourseModuleDelegate_",s.handlerNameProperty="modName",s}return d(t,e),t.prototype.getMainComponent=function(e,t,n){var o=this;return Promise.resolve(this.executeFunctionOnEnabled(n.modname,"getMainComponent",[e,t,n])).catch(function(e){o.logger.error("Error getting main component",e)})},t.prototype.getModuleDataFor=function(e,t,n,o){return this.executeFunctionOnEnabled(e,"getData",[t,n,o])},t.prototype.isModuleDisabled=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return n.isModuleDisabledInSite(e,t)})},t.prototype.isModuleDisabledInSite=function(e,t){var n=this.getHandler(e,!0);return!!n&&(t=t||this.sitesProvider.getCurrentSite(),this.isFeatureDisabled(n,t))},t.prototype.displayRefresherInSingleActivity=function(e){return this.executeFunctionOnEnabled(e,"displayRefresherInSingleActivity")},t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,r.a,a.a,c.a])],t)}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(12),i=n(27),s=n(18),a=n(7),c=n(2),u=n(22),d=n(6),l=n(10),f=n(729),p=n(30),h=n(109),m=(n.n(h),n(96)),g=(n.n(m),n(58)),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,i,s,a,c,u){var d=e.call(this,"CoreCourseModulePrefetchDelegate",t,n,u)||this;return d.sitesProvider=n,d.utils=o,d.courseProvider=i,d.filepoolProvider=s,d.timeUtils=a,d.fileProvider=c,d.eventsProvider=u,d.CHECK_UPDATES_TIMES_TABLE="check_updates_times",d.checkUpdatesTableSchema={name:d.CHECK_UPDATES_TIMES_TABLE,columns:[{name:"courseId",type:"INTEGER",primaryKey:!0},{name:"time",type:"INTEGER",notNull:!0}]},d.ROOT_CACHE_KEY="mmCourse:",d.statusCache=new f.a,d.handlerNameProperty="modName",d.courseUpdatesPromises={},d.prefetchData={},d.sitesProvider.createTableFromSchema(d.checkUpdatesTableSchema),u.on(r.a.LOGOUT,d.clearStatusCache.bind(d)),u.on(r.a.PACKAGE_STATUS_CHANGED,function(e){d.updateStatusCache(e.status,e.component,e.componentId)},d.sitesProvider.getCurrentSiteId()),d}return y(t,e),t.prototype.canCheckUpdates=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_course_check_updates")},t.prototype.canModuleUseCheckUpdates=function(e,t){var n=this.getPrefetchHandlerFor(e);return n?n.canUseCheckUpdates?Promise.resolve(n.canUseCheckUpdates(e,t)):Promise.resolve(!0):Promise.resolve(!1)},t.prototype.clearStatusCache=function(){this.statusCache.clear()},t.prototype.createToCheckList=function(e,t){var n=this,o={toCheck:[],cannotUse:[]},r=[];return e.forEach(function(e){r.push(n.getModuleStatusAndDownloadTime(e,t).then(function(r){if(r.status==p.a.DOWNLOADED)return n.canModuleUseCheckUpdates(e,t).then(function(t){t?o.toCheck.push({contextlevel:"module",id:e.id,since:r.downloadTime||0}):o.cannotUse.push(e)})}).catch(function(){}))}),Promise.all(r).then(function(){return o.toCheck.sort(function(e,t){return e.id>=t.id?1:-1}),o})},t.prototype.determineModuleStatus=function(e,t,n){var o=this.getPrefetchHandlerFor(e),r=this.sitesProvider.getCurrentSiteId();if(o)if(t==p.a.DOWNLOADING)this.filepoolProvider.getPackageDownloadPromise(r,o.component,e.id)||o.prefetch(e);else if(o.determineStatus)return o.determineStatus(e,t,n);return t},t.prototype.getCourseUpdates=function(e,t){var n=this;if(!this.canCheckUpdates())return Promise.reject(null);var o=h.Md5.hashAsciiStr(t+"#"+JSON.stringify(e)),r=this.sitesProvider.getCurrentSiteId();return this.courseUpdatesPromises[r]&&this.courseUpdatesPromises[r][o]?this.courseUpdatesPromises[r][o]:(this.courseUpdatesPromises[r]||(this.courseUpdatesPromises[r]={}),this.courseUpdatesPromises[r][o]=this.createToCheckList(e,t).then(function(e){var o={};return e.cannotUse.forEach(function(e){o[e.id]=!1}),e.toCheck.length?n.sitesProvider.getSite(r).then(function(r){var i={courseid:t,tocheck:e.toCheck},s={cacheKey:n.getCourseUpdatesCacheKey(t),emergencyCache:!1,uniqueCacheKey:!0};return r.read("core_course_check_updates",i,s).then(function(i){if(!i||void 0===i.instances)return Promise.reject(null);var s={courseId:t,time:n.timeUtils.timestamp()};return r.getDb().insertRecord(n.CHECK_UPDATES_TIMES_TABLE,s).catch(function(){}),n.treatCheckUpdatesResult(e.toCheck,i,o)}).catch(function(a){return r.getDb().getRecord(n.CHECK_UPDATES_TIMES_TABLE,{courseId:t}).then(function(t){return s.getCacheUsingCacheKey=!0,s.omitExpires=!0,r.read("core_course_check_updates",i,s).then(function(r){return r&&void 0!==r.instances?n.treatCheckUpdatesResult(e.toCheck,r,o,t.time):Promise.reject(a)})},function(){return o})})}):o}).finally(function(){delete n.courseUpdatesPromises[r][o]}),this.courseUpdatesPromises[r][o])},t.prototype.getCourseUpdatesByCourseId=function(e){var t=this;return this.canCheckUpdates()?this.courseProvider.getSections(e,!1,!0,{omitExpires:!0}).then(function(n){return t.getCourseUpdates(t.courseProvider.getSectionsModules(n),e)}):Promise.reject(null)},t.prototype.getCourseUpdatesCacheKey=function(e){return this.ROOT_CACHE_KEY+"courseUpdates:"+e},t.prototype.getDownloadSize=function(e,t){var n=this;return this.getModulesStatus(e,t).then(function(e){var o=[],r={size:0,total:!0};return e[p.a.NOT_DOWNLOADED].concat(e[p.a.OUTDATED]).forEach(function(e){o.push(n.getModuleDownloadSize(e,t).then(function(e){r.total=r.total&&e.total,r.size+=e.size}))}),Promise.all(o).then(function(){return r})})},t.prototype.getModuleDownloadSize=function(e,t,n){var o,r,i=this,s=this.getPrefetchHandlerFor(e);return s?this.isModuleDownloadable(e,t).then(function(a){return a?(r=i.filepoolProvider.getPackageId(s.component,e.id),void 0!==(o=i.statusCache.getValue(r,"downloadSize"))?o:Promise.resolve(s.getDownloadSize(e,t,n)).then(function(e){return i.statusCache.setValue(r,"downloadSize",e)}).catch(function(e){var t=i.statusCache.getValue(r,"downloadSize",!0);return t||Promise.reject(e)})):{size:0,total:!0}}):Promise.resolve({size:0,total:!1})},t.prototype.getModuleDownloadedSize=function(e,t){var n,o,r=this,i=this.getPrefetchHandlerFor(e);return i?this.isModuleDownloadable(e,t).then(function(s){return s?(o=r.filepoolProvider.getPackageId(i.component,e.id),void 0!==(n=r.statusCache.getValue(o,"downloadedSize"))?n:(i.getDownloadedSize?Promise.resolve(i.getDownloadedSize(e,t)):r.getModuleFiles(e,t).then(function(e){var t=r.sitesProvider.getCurrentSiteId(),n=[],o=0;return e.forEach(function(e){var i=e.url||e.fileurl;n.push(r.filepoolProvider.getFilePathByUrl(t,i).then(function(n){return r.fileProvider.getFileSize(n).catch(function(){return r.filepoolProvider.isFileDownloadingByUrl(t,i).then(function(){return e.filesize}).catch(function(){return 0})}).then(function(e){o+=e})}))}),Promise.all(n).then(function(){return o})})).then(function(e){return r.statusCache.setValue(o,"downloadedSize",e)}).catch(function(){return r.statusCache.getValue(o,"downloadedSize",!0)})):0}):Promise.resolve(0)},t.prototype.getModuleFiles=function(e,t){var n=this.getPrefetchHandlerFor(e);return n.getFiles?Promise.resolve(n.getFiles(e,t)):n.loadContents?n.loadContents(e,t).then(function(){return e.contents}):Promise.resolve(e.contents||[])},t.prototype.getModuleStatus=function(e,t,n,o,r){var i=this,s=this.getPrefetchHandlerFor(e),a=this.sitesProvider.getCurrentSiteId(),c=this.canCheckUpdates();if(s){var u,d=s.component,l=this.filepoolProvider.getPackageId(d,e.id),f=this.statusCache.getValue(l,"status"),h=!0;return o||void 0===f?this.isModuleDownloadable(e,t).then(function(o){return o?i.filepoolProvider.getPackageStatus(a,d,e.id).then(function(o){if((f=s.determineStatus?s.determineStatus(e,o,c):o)!=p.a.DOWNLOADED)return f;if(void 0===n)u=i.getCourseUpdatesByCourseId(t);else{if(!1===n)return Promise.resolve();u=Promise.resolve(n)}return u.then(function(n){return n&&!1!==n[e.id]?i.moduleHasUpdates(e,t,n).then(function(t){return t?(f=p.a.OUTDATED,i.filepoolProvider.storePackageStatus(a,f,d,e.id).catch(function(){}).then(function(){return f})):f}).catch(function(){var t=i.statusCache.getValue(l,"status",!0);return i.determineModuleStatus(e,t,c)}):p.a.OUTDATED},function(){return h=!1,i.storeCourseAndSection(l,t,r),o})}):p.a.NOT_DOWNLOADABLE}).then(function(n){return h&&i.updateStatusCache(n,d,e.id,t,r),i.determineModuleStatus(e,n,c)}):(this.storeCourseAndSection(l,t,r),Promise.resolve(this.determineModuleStatus(e,f,c)))}return Promise.resolve(p.a.NOT_DOWNLOADABLE)},t.prototype.getModulesStatus=function(e,t,n,o){var r=this,i=[],s={total:0},a=p.a.NOT_DOWNLOADABLE;return s[p.a.NOT_DOWNLOADED]=[],s[p.a.DOWNLOADED]=[],s[p.a.DOWNLOADING]=[],s[p.a.OUTDATED]=[],this.getCourseUpdatesByCourseId(t).catch(function(){return!1}).then(function(n){return e.forEach(function(e){var c=r.getPrefetchHandlerFor(e);if(c){var u=r.filepoolProvider.getPackageId(c.component,e.id);i.push(r.getModuleStatus(e,t,n,o).then(function(t){t!=p.a.NOT_DOWNLOADABLE&&(a=r.filepoolProvider.determinePackagesStatus(a,t),s[t].push(e),s.total++)}).catch(function(t){var n=r.statusCache.getValue(u,"status",!0);if(void 0===n)return Promise.reject(t);n!=p.a.NOT_DOWNLOADABLE&&(n=r.filepoolProvider.determinePackagesStatus(a,n),s[n].push(e),s.total++)}))}}),Promise.all(i).then(function(){return s.status=a,s})})},t.prototype.getModuleStatusAndDownloadTime=function(e,t){var n=this,o=this.getPrefetchHandlerFor(e),r=this.sitesProvider.getCurrentSiteId();if(o){var i=this.filepoolProvider.getPackageId(o.component,e.id),s=this.statusCache.getValue(i,"status");return void 0!==s&&s!=p.a.DOWNLOADED?Promise.resolve({status:s}):this.isModuleDownloadable(e,t).then(function(t){return t?n.filepoolProvider.getPackageData(r,o.component,e.id).then(function(e){return{status:e.status,downloadTime:e.downloadTime||0}}):{status:p.a.NOT_DOWNLOADABLE}})}return Promise.resolve({status:p.a.NOT_DOWNLOADABLE})},t.prototype.getPrefetchHandlerFor=function(e){return this.getHandler(e.modname,!0)},t.prototype.invalidateCourseUpdates=function(e){return this.sitesProvider.getCurrentSite().invalidateWsCacheForKey(this.getCourseUpdatesCacheKey(e))},t.prototype.invalidateModules=function(e,t){var n=this,o=[];return e.forEach(function(e){var r=n.getPrefetchHandlerFor(e);r&&(r.invalidateModule&&o.push(r.invalidateModule(e,t).catch(function(){})),n.invalidateModuleStatusCache(e))}),o.push(this.invalidateCourseUpdates(t)),Promise.all(o)},t.prototype.invalidateModuleStatusCache=function(e){var t=this.getPrefetchHandlerFor(e);t&&this.statusCache.invalidate(this.filepoolProvider.getPackageId(t.component,e.id))},t.prototype.isBeingDownloaded=function(e){var t=this.sitesProvider.getCurrentSiteId();return!(!this.prefetchData[t]||!this.prefetchData[t][e])},t.prototype.isModuleDownloadable=function(e,t){var n=this,o=this.getPrefetchHandlerFor(e);if(o){if("function"==typeof o.isDownloadable){var r=this.filepoolProvider.getPackageId(o.component,e.id),i=this.statusCache.getValue(r,"downloadable");return void 0!==i?Promise.resolve(i):Promise.resolve(o.isDownloadable(e,t)).then(function(e){return n.statusCache.setValue(r,"downloadable",e)}).catch(function(){return!1})}return Promise.resolve(!0)}return Promise.resolve(!1)},t.prototype.moduleHasUpdates=function(e,t,n){var o=this.getPrefetchHandlerFor(e),r=n[e.id];if(o&&o.hasUpdates)return Promise.resolve(o.hasUpdates(e,t,r));if(!(r&&r.updates&&r.updates.length))return Promise.resolve(!1);if(o&&o.updatesNames&&o.updatesNames.test){for(var i=0,s=r.updates.length;i<s;i++)if(o.updatesNames.test(r.updates[i].name))return Promise.resolve(!0);return Promise.resolve(!1)}return Promise.resolve(!0)},t.prototype.prefetchModule=function(e,t,n){var o=this.getPrefetchHandlerFor(e);return o?o.prefetch(e,t,n):Promise.resolve()},t.prototype.prefetchModules=function(e,t,n,o){var r=this,i=this.sitesProvider.getCurrentSiteId(),s=this.prefetchData[i]&&this.prefetchData[i][e];if(s)return o&&s.subscriptions.push(s.observable.subscribe(o)),s.promise;var a=0,c=[],u=t.length,d=t.map(function(e){return e.id}),l={observable:new m.BehaviorSubject({count:a,total:u}),promise:void 0,subscriptions:[]};return o&&l.observable.subscribe(o),t.forEach(function(t){var o=r.getPrefetchHandlerFor(t);o&&c.push(r.isModuleDownloadable(t,n).then(function(r){if(r)return o.prefetch(t,n).then(function(){var t=d.indexOf(e);t>-1&&(d.splice(t,1),l.observable.next({count:++a,total:u}))})}))}),l.promise=Promise.all(c).finally(function(){l.subscriptions.forEach(function(e){e.unsubscribe()}),delete r.prefetchData[i][e]}),this.prefetchData[i]||(this.prefetchData[i]={}),this.prefetchData[i][e]=l,l.promise},t.prototype.removeModuleFiles=function(e,t){var n=this,o=this.getPrefetchHandlerFor(e),r=this.sitesProvider.getCurrentSiteId();return(o&&o.removeFiles?o.removeFiles(e,t):this.getModuleFiles(e,t).then(function(e){var t=[];return e.forEach(function(e){t.push(n.filepoolProvider.removeFileByUrl(r,e.url||e.fileurl).catch(function(){}))}),Promise.all(t)})).then(function(){if(o){var t=n.filepoolProvider.getPackageId(o.component,e.id);return n.statusCache.setValue(t,"downloadedSize",0),n.filepoolProvider.storePackageStatus(r,p.a.NOT_DOWNLOADED,o.component,e.id)}})},t.prototype.setOnProgress=function(e,t){var n=this.sitesProvider.getCurrentSiteId(),o=this.prefetchData[n]&&this.prefetchData[n][e];o&&o.subscriptions.push(o.observable.subscribe(t))},t.prototype.storeCourseAndSection=function(e,t,n){t&&this.statusCache.setValue(e,"courseId",t),n&&n>0&&this.statusCache.setValue(e,"sectionId",n)},t.prototype.treatCheckUpdatesResult=function(e,t,n,o){return this.utils.arrayToObject(t.instances,"id",n),t.warnings.forEach(function(e){"missingcallback"==e.warningcode&&(n[e.itemid]=!1)}),o&&e.forEach(function(e){n[e.id]&&e.since>o&&delete n[e.id]}),n},t.prototype.updateStatusCache=function(e,t,n,o,i){var s,a=this.filepoolProvider.getPackageId(t,n),c=this.statusCache.getValue(a,"status",!0);s=void 0!==c&&c!==e,this.storeCourseAndSection(a,o,i),s?(o||(o=this.statusCache.getValue(a,"courseId",!0)),i||(i=this.statusCache.getValue(a,"sectionId",!0)),this.statusCache.invalidate(a),this.statusCache.setValue(a,"status",e),i&&this.eventsProvider.trigger(r.a.SECTION_STATUS_CHANGED,{sectionId:i,courseId:o},this.sitesProvider.getCurrentSiteId())):this.statusCache.setValue(a,"status",e)},t=v([Object(o.A)(),b("design:paramtypes",[a.a,c.a,d.a,l.a,s.a,u.a,i.a,r.a])],t)}(g.a)},,function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(58),c=n(753),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,"CoreQuestionDelegate",t,n,o)||this;return i.defaultHandler=r,i.handlerNameProperty="type",i}return u(t,e),t.prototype.getBehaviourForQuestion=function(e,t){var n=this.getTypeName(e);return this.executeFunctionOnEnabled(n,"getBehaviour",[e,t])||t},t.prototype.getComponentForQuestion=function(e,t){var n=this.getTypeName(t);return Promise.resolve(this.executeFunctionOnEnabled(n,"getComponent",[e,t]))},t.prototype.getPreventSubmitMessage=function(e){var t=this.getTypeName(e);return this.executeFunctionOnEnabled(t,"getPreventSubmitMessage",[e])},t.prototype.getFullTypeName=function(e){return"qtype_"+e},t.prototype.getTypeName=function(e){return this.getFullTypeName(e.type)},t.prototype.isCompleteResponse=function(e,t){var n=this.getTypeName(e);return this.executeFunctionOnEnabled(n,"isCompleteResponse",[e,t])},t.prototype.isGradableResponse=function(e,t){var n=this.getTypeName(e);return this.executeFunctionOnEnabled(n,"isGradableResponse",[e,t])},t.prototype.isSameResponse=function(e,t,n){var o=this.getTypeName(e);return this.executeFunctionOnEnabled(o,"isSameResponse",[e,t,n])},t.prototype.isQuestionSupported=function(e){return this.hasHandler(this.getFullTypeName(e),!0)},t.prototype.prepareAnswersForQuestion=function(e,t,n,o){var r=this.getTypeName(e);return Promise.resolve(this.executeFunctionOnEnabled(r,"prepareAnswers",[e,t,n,o]))},t.prototype.validateSequenceCheck=function(e,t){var n=this.getTypeName(e);return this.executeFunctionOnEnabled(n,"validateSequenceCheck",[e,t])},t=d([Object(o.A)(),l("design:paramtypes",[r.a,s.a,i.a,c.a])],t)}(a.a)},,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=t,this.ROOT_CACHE_KEY="mmCourses:",this.logger=e.getInstance("CoreCoursesProvider")}return t=e,e.prototype.canGetAdminAndNavOptions=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_course_get_user_navigation_options")&&this.sitesProvider.wsAvailableInCurrentSite("core_course_get_user_administration_options")},e.prototype.getCategories=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={criteria:[{key:0==e?"parent":"id",value:e}],addsubcategories:t?1:0},i={cacheKey:o.getCategoriesCacheKey(e,t)};return n.read("core_course_get_categories",r,i)})},e.prototype.getCategoriesCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"categories:"+e+":"+!!t},e.prototype.getCourseIdsForAdminAndNavOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(o){var r=o.getSiteHomeId();return 1==e.length?n.getUserCourses(!0,t).then(function(t){var n=e[0],o=!1;if(n==r)o=!0;else for(var i=0;i<t.length;i++)if(t[i].id==n){o=!0;break}return o&&(e=t.map(function(e){return e.id})).push(r),e}).catch(function(){return e}):(e.length>1&&-1==e.indexOf(r)&&e.push(r),e)})},e.prototype.isDownloadCourseDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isDownloadCoursesDisabledInSite(e)})},e.prototype.isDownloadCourseDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("NoDelegate_CoreCourseDownload")},e.prototype.isDownloadCoursesDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isDownloadCoursesDisabledInSite(e)})},e.prototype.isDownloadCoursesDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("NoDelegate_CoreCoursesDownload")},e.prototype.isMyCoursesDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isMyCoursesDisabledInSite(e)})},e.prototype.isMyCoursesDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_CoreCourses")},e.prototype.isSearchCoursesDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isSearchCoursesDisabledInSite(e)})},e.prototype.isSearchCoursesDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreCourseOptionsDelegate_search")},e.prototype.getCourse=function(e,t){return this.getCourses([e],t).then(function(e){return e&&e.length>0?e[0]:Promise.reject(null)})},e.prototype.getCourseEnrolmentMethods=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={courseid:e},r={cacheKey:n.getCourseEnrolmentMethodsCacheKey(e)};return t.read("core_enrol_get_course_enrolment_methods",o,r)})},e.prototype.getCourseEnrolmentMethodsCacheKey=function(e){return this.ROOT_CACHE_KEY+"enrolmentmethods:"+e},e.prototype.getCourseGuestEnrolmentInfo=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={instanceid:e},r={cacheKey:n.getCourseGuestEnrolmentInfoCacheKey(e)};return t.read("enrol_guest_get_instance_info",o,r).then(function(e){return e.instanceinfo})})},e.prototype.getCourseGuestEnrolmentInfoCacheKey=function(e){return this.ROOT_CACHE_KEY+"guestinfo:"+e},e.prototype.getCourses=function(e,t){var n=this;return Array.isArray(e)?0===e.length?Promise.resolve([]):this.sitesProvider.getSite(t).then(function(t){var o={options:{ids:e}},r={cacheKey:n.getCoursesCacheKey(e)};return t.read("core_course_get_courses",o,r)}):Promise.reject(null)},e.prototype.getCoursesCacheKey=function(e){return this.ROOT_CACHE_KEY+"course:"+JSON.stringify(e)},e.prototype.getCoursesByField=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={field:e||"",value:e?t:""},i={cacheKey:o.getCoursesByFieldCacheKey(e,t)};return n.read("core_course_get_courses_by_field",r,i).then(function(e){return e.courses?e.courses.sort(function(e,t){return void 0===e.sortorder&&void 0===t.sortorder?t.id-e.id:void 0===e.sortorder?1:void 0===t.sortorder?-1:e.sortorder-t.sortorder}):Promise.reject(null)})})},e.prototype.getCoursesByFieldCacheKey=function(e,t){return e=e||"",t=e?t:"",this.ROOT_CACHE_KEY+"coursesbyfield:"+e+":"+t},e.prototype.isGetCoursesByFieldAvailable=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_course_get_courses_by_field")},e.prototype.getCoursesAdminAndNavOptions=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.getCourseIdsForAdminAndNavOptions(e,t).then(function(e){var o,r,i=[];return i.push(n.getUserNavigationOptions(e,t).catch(function(){return{}}).then(function(e){o=e})),i.push(n.getUserAdministrationOptions(e,t).catch(function(){return{}}).then(function(e){r=e})),Promise.all(i).then(function(){return{navOptions:o,admOptions:r}})})},e.prototype.getUserAdministrationOptionsCommonCacheKey=function(){return this.ROOT_CACHE_KEY+"administrationOptions:"},e.prototype.getUserAdministrationOptionsCacheKey=function(e){return this.getUserAdministrationOptionsCommonCacheKey()+e.join(",")},e.prototype.getUserAdministrationOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={courseids:e},r={cacheKey:n.getUserAdministrationOptionsCacheKey(e)};return t.read("core_course_get_user_administration_options",o,r).then(function(e){return n.formatUserAdminOrNavOptions(e.courses)})})},e.prototype.getUserNavigationOptionsCommonCacheKey=function(){return this.ROOT_CACHE_KEY+"navigationOptions:"},e.prototype.getUserNavigationOptionsCacheKey=function(e){return this.getUserNavigationOptionsCommonCacheKey()+e.join(",")},e.prototype.getUserNavigationOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={courseids:e},r={cacheKey:n.getUserNavigationOptionsCacheKey(e)};return t.read("core_course_get_user_navigation_options",o,r).then(function(e){return n.formatUserAdminOrNavOptions(e.courses)})})},e.prototype.formatUserAdminOrNavOptions=function(e){var t={};return e.forEach(function(e){var n={};e.options&&e.options.forEach(function(e){n[e.name]=e.available}),t[e.id]=n}),t},e.prototype.getUserCourse=function(e,t,n){return e?this.getUserCourses(t,n).then(function(t){var n;for(var o in t)if(t[o].id==e){n=t[o];break}return n||Promise.reject(null)}):Promise.reject(null)},e.prototype.getUserCourses=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){var r={userid:t.getUserId(),type:n},i={cacheKey:o.getUserCoursesCacheKey(),omitExpires:!!e};return t.read("core_enrol_get_users_courses",r,i)})},e.prototype.getUserCoursesCacheKey=function(){return this.ROOT_CACHE_KEY+"usercourses"},e.prototype.invalidateCategories=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getCategoriesCacheKey(e,t))})},e.prototype.invalidateCourse=function(e,t){return this.invalidateCourses([e],t)},e.prototype.invalidateCourseEnrolmentMethods=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCourseEnrolmentMethodsCacheKey(e))})},e.prototype.invalidateCourseGuestEnrolmentInfo=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCourseGuestEnrolmentInfoCacheKey(e))})},e.prototype.invalidateCoursesAdminAndNavOptions=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.getCourseIdsForAdminAndNavOptions(e,t).then(function(e){var o=[];return o.push(n.invalidateUserAdministrationOptionsForCourses(e,t)),o.push(n.invalidateUserNavigationOptionsForCourses(e,t)),Promise.all(o)})},e.prototype.invalidateCourses=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCoursesCacheKey(e))})},e.prototype.invalidateCoursesByField=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getCoursesByFieldCacheKey(e,t))})},e.prototype.invalidateUserAdministrationOptions=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKeyStartingWith(t.getUserAdministrationOptionsCommonCacheKey())})},e.prototype.invalidateUserAdministrationOptionsForCourses=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getUserAdministrationOptionsCacheKey(e))})},e.prototype.invalidateUserCourses=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getUserCoursesCacheKey())})},e.prototype.invalidateUserNavigationOptions=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKeyStartingWith(t.getUserNavigationOptionsCommonCacheKey())})},e.prototype.invalidateUserNavigationOptionsForCourses=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getUserNavigationOptionsCacheKey(e))})},e.prototype.isGuestWSAvailable=function(){var e=this.sitesProvider.getCurrentSite();return e&&e.wsAvailable("enrol_guest_get_instance_info")},e.prototype.search=function(e,n,o,r){return void 0===n&&(n=0),o=o||t.SEARCH_PER_PAGE,this.sitesProvider.getSite(r).then(function(t){return t.read("core_course_search_courses",{criterianame:"search",criteriavalue:e,page:n,perpage:o},{getFromCache:!1}).then(function(e){return{total:e.total,courses:e.courses}})})},e.prototype.selfEnrol=function(e,n,o,r){return void 0===n&&(n=""),this.sitesProvider.getSite(r).then(function(r){var i={courseid:e,password:n};return o&&(i.instanceid=o),r.write("enrol_self_enrol_user",i).then(function(e){if(e){if(e.status)return!0;if(e.warnings&&e.warnings.length){var n;return e.warnings.forEach(function(e){"2"!=e.warningcode&&"3"!=e.warningcode&&"4"!=e.warningcode||(n=e.message)}),n?Promise.reject({code:t.ENROL_INVALID_KEY,message:n}):Promise.reject(e.warnings[0])}}return Promise.reject(null)})})},e.SEARCH_PER_PAGE=20,e.ENROL_INVALID_KEY="CoreCoursesEnrolInvalidKey",e.EVENT_MY_COURSES_UPDATED="courses_my_courses_updated",e.EVENT_MY_COURSES_REFRESHED="courses_my_courses_refreshed",e=t=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(735),d=n(1366),l=n(1367),f=n(1368),p=n(328),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=function(){function e(){}return e=h([Object(o.I)({declarations:[u.a,d.a,l.a,f.a,p.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[],exports:[u.a,d.a,l.a,f.a,p.a],entryComponents:[p.a]})],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(31),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o){var r=e.call(this)||this;return r.courseHelper=t,r.addon=n,r.modName=o,r.pattern=new RegExp("/mod/"+o+"/view.php.*([&?]id=\\d+)"),r.featureName="CoreCourseModuleDelegate_"+n,r}return r(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){r.courseHelper.navigateToModule(parseInt(n.id,10),e,o)}}]},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(12),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){var n=this;this.sitesProvider=t,this.SYNC_TABLE="sync",this.tableSchema={name:this.SYNC_TABLE,columns:[{name:"component",type:"TEXT",notNull:!0},{name:"id",type:"TEXT",notNull:!0},{name:"time",type:"INTEGER"},{name:"warnings",type:"TEXT"}],primaryKeys:["component","id"]},this.blockedItems={},this.sitesProvider.createTableFromSchema(this.tableSchema),e.on(r.a.LOGOUT,function(e){n.clearAllBlocks(e.siteId)})}return e.prototype.blockOperation=function(e,t,n,o){o=o||this.sitesProvider.getCurrentSiteId();var r=this.getUniqueSyncBlockId(e,t);this.blockedItems[o]||(this.blockedItems[o]={}),this.blockedItems[o][r]||(this.blockedItems[o][r]={}),this.blockedItems[o][r][n=n||"-"]=!0},e.prototype.clearAllBlocks=function(e){e?delete this.blockedItems[e]:this.blockedItems={}},e.prototype.clearBlocks=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId();var o=this.getUniqueSyncBlockId(e,t);this.blockedItems[n]&&delete this.blockedItems[n][o]},e.prototype.getSyncRecord=function(e,t,n){var o=this;return this.sitesProvider.getSiteDb(n).then(function(n){return n.getRecord(o.SYNC_TABLE,{component:e,id:t})})},e.prototype.insertOrUpdateSyncRecord=function(e,t,n,o){var r=this;return this.sitesProvider.getSiteDb(o).then(function(o){return n.component=e,n.id=t,o.insertRecord(r.SYNC_TABLE,n)})},e.prototype.getUniqueSyncBlockId=function(e,t){return e+"#"+t},e.prototype.isBlocked=function(e,t,n){if(n=n||this.sitesProvider.getCurrentSiteId(),!this.blockedItems[n])return!1;var o=this.getUniqueSyncBlockId(e,t);return!!this.blockedItems[n][o]&&Object.keys(this.blockedItems[n][o]).length>0},e.prototype.unblockOperation=function(e,t,n,o){n=n||"-",o=o||this.sitesProvider.getCurrentSiteId();var r=this.getUniqueSyncBlockId(e,t);this.blockedItems[o]&&this.blockedItems[o][r]&&delete this.blockedItems[o][r][n]},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=e,this.translate=t,this.ROOT_CACHE_KEY="mmGroups:"}return t=e,e.prototype.activityHasGroups=function(e,n){return this.getActivityGroupMode(e,n).then(function(e){return e===t.SEPARATEGROUPS||e===t.VISIBLEGROUPS}).catch(function(){return!1})},e.prototype.getActivityAllowedGroups=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){t=t||n.getUserId();var r={cmid:e,userid:t},i={cacheKey:o.getActivityAllowedGroupsCacheKey(e,t)};return n.read("core_group_get_activity_allowed_groups",r,i).then(function(e){return e&&e.groups?e.groups:Promise.reject(null)})})},e.prototype.getActivityAllowedGroupsCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"allowedgroups:"+e+":"+t},e.prototype.getActivityAllowedGroupsIfEnabled=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.activityHasGroups(e,n).then(function(r){return r?o.getActivityAllowedGroups(e,t,n):[]})},e.prototype.getActivityGroupInfo=function(e,n,o,r){var i=this;void 0===n&&(n=!0);var s={groups:[]};return this.getActivityGroupMode(e,r).then(function(n){return s.separateGroups=n===t.SEPARATEGROUPS,s.visibleGroups=n===t.VISIBLEGROUPS,s.separateGroups||s.visibleGroups?i.getActivityAllowedGroups(e,o,r):[]}).then(function(e){return e.length<=0?(s.separateGroups=!1,s.visibleGroups=!1):((n||s.visibleGroups)&&s.groups.push({id:0,name:i.translate.instant("core.allparticipants")}),s.groups=s.groups.concat(e)),s})},e.prototype.getActivityGroupMode=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={cmid:e},r={cacheKey:n.getActivityGroupModeCacheKey(e)};return t.read("core_group_get_activity_groupmode",o,r).then(function(e){return e&&void 0!==e.groupmode?e.groupmode:Promise.reject(null)})})},e.prototype.getActivityGroupModeCacheKey=function(e){return this.ROOT_CACHE_KEY+"groupmode:"+e},e.prototype.getUserGroups=function(e,t,n){var o=this,r=[],i=[];return e.forEach(function(e){r.push(o.getUserGroupsInCourse("object"==typeof e?e.id:e,t,n).then(function(e){i=i.concat(e)}))}),Promise.all(r).then(function(){return i})},e.prototype.getUserGroupsInCourse=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){var r={userid:n||t.getUserId(),courseid:e},i={cacheKey:o.getUserGroupsInCourseCacheKey(e,n)};return t.read("core_group_get_course_user_groups",r,i).then(function(e){return e&&e.groups?e.groups:Promise.reject(null)})})},e.prototype.getUserGroupsInCourseCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"courseGroups:"+e+":"+t},e.prototype.invalidateActivityAllowedGroups=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return t=t||n.getUserId(),n.invalidateWsCacheForKey(o.getActivityAllowedGroupsCacheKey(e,t))})},e.prototype.invalidateActivityGroupMode=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getActivityGroupModeCacheKey(e))})},e.prototype.invalidateActivityGroupInfo=function(e,t,n){var o=[];return o.push(this.invalidateActivityAllowedGroups(e,t,n)),o.push(this.invalidateActivityGroupMode(e,n)),Promise.all(o)},e.prototype.invalidateUserGroups=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){var r=[];return n=n||t.getUserId(),e.forEach(function(e){r.push(o.invalidateUserGroupsInCourse("object"==typeof e?e.id:e,t.id,n))}),Promise.all(r)})},e.prototype.invalidateUserGroupsInCourse=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getUserGroupsInCourseCacheKey(e,n))})},e.NOGROUPS=0,e.SEPARATEGROUPS=1,e.VISIBLEGROUPS=2,e=t=s([Object(o.A)(),a("design:paramtypes",[i.a,r.c])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(93),i=n(11),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.langProvider=e,this.textUtils=t}return e.prototype.addOrRemoveWWW=function(e){return e&&(e=e.match(/http(s)?:\/\/www\./)?e.replace("www.",""):(e=e.replace("https://","https://www.")).replace("http://","http://www.")),e},e.prototype.extractUrlParams=function(e){var t={};return e.replace(/[?&]+([^=&]+)=?([^&]*)?/gi,function(e,n,o){return t[n]=void 0!==o?o:"",e}),t},e.prototype.fixPluginfileURL=function(e,t,n){return e&&t?-1!=(e=e.replace(/&amp;/g,"&")).indexOf("token=")?e:this.isPluginFileUrl(e)?(e.match(/\?[^=]+=/)?e+="&":e+="?",0===(e+="token="+t+"&offline=1").indexOf(this.textUtils.concatenatePaths(n,"pluginfile.php"))&&(e=e.replace("/pluginfile","/webservice/pluginfile")),e):e:""},e.prototype.formatURL=function(e){return e=e.trim(),/^http(s)?\:\/\/.*/i.test(e)||(e="https://"+e),e=e.replace(/^http/i,"http"),e=e.replace(/^https/i,"https"),e=e.replace(/\/$/,"")},e.prototype.getDocsUrl=function(e,t){void 0===t&&(t="Mobile_app");var n="https://docs.moodle.org/en/"+t;if(void 0!==e){var o=e.substr(0,3).replace(".","");parseInt(o)>=24&&(n=n.replace("https://docs.moodle.org/","https://docs.moodle.org/"+o+"/"))}return this.langProvider.getCurrentLanguage().then(function(e){return n.replace("/en/","/"+e+"/")}).catch(function(){return n})},e.prototype.getLastFileWithoutParams=function(e){var t=e.substr(e.lastIndexOf("/")+1);return-1!=t.indexOf("?")&&(t=t.substr(0,t.indexOf("?"))),t},e.prototype.getUrlProtocol=function(e){if(e){var t=e.match(/^([^\/:\.\?]*):\/\//);return t&&t[1]?t[1]:void 0}},e.prototype.getUrlScheme=function(e){if(e){var t=e.match(/^([a-z][a-z0-9+\-.]*):/);return t&&t[1]?t[1]:void 0}},e.prototype.getUsernameFromUrl=function(e){if(e.indexOf("@")>-1){var t=e.replace(/.*?:\/\//,"").match(/[^@]*/);if(t&&t.length&&!t[0].match(/[\/|?]/))return t[0]}},e.prototype.isAbsoluteURL=function(e){return/^[^:]{2,}:\/\//i.test(e)||/^(tel:|mailto:|geo:)/.test(e)},e.prototype.isDownloadableUrl=function(e){return this.isPluginFileUrl(e)||this.isThemeImageUrl(e)||this.isGravatarUrl(e)},e.prototype.isGravatarUrl=function(e){return e&&-1!==e.indexOf("gravatar.com/avatar")},e.prototype.isHttpURL=function(e){return/^https?\:\/\/.+/i.test(e)},e.prototype.isPluginFileUrl=function(e){return e&&-1!==e.indexOf("/pluginfile.php")},e.prototype.isThemeImageUrl=function(e){return e&&-1!==e.indexOf("/theme/image.php")},e.prototype.removeProtocolAndWWW=function(e){return e=e.replace(/.*?:\/\//g,""),e=e.replace(/^www./,"")},e.prototype.removeUrlParams=function(e){var t=e.match(/^[^\?]+/);return t&&t[0]},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(9),s=n(18),a=n(93),c=n(7),u=n(2),d=n(11),l=n(6),f=n(72),p=n(41),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,r,i,s,a,c){this.sitesProvider=t,this.utils=n,this.langProvider=o,this.appProvider=r,this.platform=i,this.filepoolProvider=s,this.coursesProvider=a,this.textUtils=c,this.ROOT_CACHE_KEY="CoreSitePlugins:",this.sitePlugins={},this.hasSitePluginsLoaded=!1,this.logger=e.getInstance("CoreUserProvider")}return e.prototype.addDefaultArgs=function(e,t){var n=this;return e=e||{},t=t||this.sitesProvider.getCurrentSite(),this.langProvider.getCurrentLanguage().then(function(o){var r=n.utils.clone(e);return r.userid=e.userid||t.getUserId(),r.appid=f.a.app_id,r.appversioncode=f.a.versioncode,r.appversionname=f.a.versionname,r.applang=o,r.appcustomurlscheme=f.a.customurlscheme,r.appisdesktop=n.appProvider.isDesktop(),r.appismobile=n.appProvider.isMobile(),r.appiswide=n.appProvider.isWide(),r.appplatform=r.appisdevice?n.platform.is("ios")?"ios":"android":r.appisdesktop?n.appProvider.isMac()?"mac":n.appProvider.isLinux()?"linux":"windows":"browser",r})},e.prototype.callWS=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return n=n||{},n.cacheKey=n.cacheKey||r.getCallWSCacheKey(e,t),o.read(e,t,n)})},e.prototype.createDataForJS=function(e,t){var n=this.utils.clone(e.jsResult||{});return"boolean"==typeof n&&(n={}),n.INIT_TEMPLATES=this.utils.objectToKeyValueMap(e.templates,"id","html"),n.INIT_OTHERDATA=e.otherdata,t&&(n.CONTENT_TEMPLATES=this.utils.objectToKeyValueMap(t.templates,"id","html"),n.CONTENT_OTHERDATA=t.otherdata),n},e.prototype.getCallWSCacheKey=function(e,t){return this.getCallWSCommonCacheKey(e)+":"+this.utils.sortAndStringify(t)},e.prototype.getCallWSCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"ws:"+e},e.prototype.getContent=function(e,t,n,o,r){var i=this;return this.logger.debug("Get content for component '"+e+"' and method '"+t+"'"),this.sitesProvider.getSite(r).then(function(r){return i.addDefaultArgs(n,r).then(function(r){var s={component:e,method:t,args:i.utils.objectToArrayOfObjects(r,"name","value",!0)};return o=o||{},o.cacheKey=i.getContentCacheKey(e,t,n),i.sitesProvider.getCurrentSite().read("tool_mobile_get_content",s,o)}).then(function(e){if(e.otherdata){e.otherdata=i.utils.objectToKeyValueMap(e.otherdata,"name","value");for(var t in e.otherdata){var n=e.otherdata[t];"string"!=typeof n||"{"!=n[0]&&"["!=n[0]||(e.otherdata[t]=i.textUtils.parseJSON(n))}}else e.otherdata={};return e})})},e.prototype.getContentCacheKey=function(e,t,n){return this.ROOT_CACHE_KEY+"content:"+e+":"+t+":"+this.utils.sortAndStringify(n)},e.prototype.getDownloadParam=function(e,t,n,o){switch(t){case"courseids":return[n];case e+"id":return o&&o.instance}},e.prototype.getHandlerUniqueName=function(e,t){return e.addon+"_"+t},e.prototype.getSitePluginHandler=function(e){return this.sitePlugins[e]},e.prototype.invalidateAllCallWSForMethod=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getCallWSCommonCacheKey(e))})},e.prototype.invalidateCallWS=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(n.cacheKey||r.getCallWSCacheKey(e,t))})},e.prototype.invalidateContent=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(r.getContentCacheKey(e,t,n))})},e.prototype.isGetContentAvailable=function(e){return(e=e||this.sitesProvider.getCurrentSite()).wsAvailable("tool_mobile_get_content")},e.prototype.isHandlerEnabledForCourse=function(e,t,n){return(!n||!n.courses||-1!=n.courses.indexOf(e))&&(!t&&void 0!==t||this.coursesProvider.getUserCourse(e,!0).then(function(){return!0}).catch(function(){return!1}))},e.prototype.isHandlerEnabledForUser=function(e,t,n){return(!t||e==this.sitesProvider.getCurrentSite().getUserId())&&(!n||!n.users||-1!=n.users.indexOf(e))},e.prototype.loadOtherDataInArgs=function(e,t,n){if(e=e?this.utils.clone(e):{},t=t||{},void 0===n)return e;if(n)for(var o in n){var r=n[o];e[r]=t[r]}else for(var i in t)e[i]=t[i];return e},e.prototype.prefetchFunctions=function(e,t,n,o,r,i,s,a){var c=this;a=a||this.sitesProvider.getCurrentSite();var u=[];for(var d in n.offlinefunctions)if(a.wsAvailable(d)){var l=n.offlinefunctions[d],f=this.getCallWSCacheKey(d,t),p={};if(l.length)for(var h in l){var m=l[h];if(void 0!==t[m])p[m]=t[m];else{var g=this.getDownloadParam(e,m,o,r);void 0!==g&&(p[m]=g)}}else p=t;u.push(this.callWS(d,p,{cacheKey:f}))}else u.push(this.getContent(e,d,t).then(function(t){var n=[];return t.files&&t.files.length&&n.push(c.filepoolProvider.downloadOrPrefetchFiles(a.id,t.files,i,!1,e,r.id,s)),Promise.all(n)}));return Promise.all(u)},e.prototype.setSitePluginHandler=function(e,t){this.sitePlugins[e]=t},e.COMPONENT="CoreSitePlugins",e=h([Object(o.A)(),m("design:paramtypes",[c.a,u.a,l.a,a.a,i.a,r.s,s.a,p.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(9),i=n(105),s=n(18),a=n(79),c=n(78),u=n(7),d=n(2),l=n(6),f=n(72),p=n(249),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,r,i,s,c){this.configProvider=t,this.sitesProvider=n,this.filepoolProvider=o,this.notifProvider=r,this.utils=i,this.appProvider=s,this.calendarProvider=c,this.name="CoreUpdateManager",this.priority=a.a.MAX_RECOMMENDED_PRIORITY+300,this.blocking=!0,this.VERSION_APPLIED="version_applied",this.localNotificationsComponentsMigrate={},this.appDBTables=[{name:"config",newName:"core_config",fields:[{name:"value",type:"any"}]},{name:"cron"},{name:"current_site",fields:[{name:"siteid",newName:"siteId"}]},{name:"desktop_local_notifications",fields:[{name:"at",type:"date"},{name:"data",type:"object"},{name:"triggered",type:"boolean"}],filterFields:["id","title","text","at","data","triggered"]},{name:"files_queue",newName:"filepool_files_queue",fields:[{name:"isexternalfile",type:"boolean"},{name:"links",type:"object"},{name:"sortorder",delete:!0}]},{name:"notification_components"},{name:"notification_sites"},{name:"notifications_triggered"},{name:"shared_files"},{name:"sites",fields:[{name:"siteurl",newName:"siteUrl"},{name:"infos",newName:"info",type:"object"},{name:"privatetoken",newName:"privateToken"},{name:"config",type:"object"},{name:"loggedout",newName:"loggedOut"}]}],this.siteDBTables=[{name:"check_updates_times",fields:[{name:"courseid",newName:"courseId"}]},{name:"course_status",fields:[{name:"previous",newName:"previousStatus"},{name:"downloadtime",newName:"downloadTime"},{name:"previousdownloadtime",newName:"previousDownloadTime"}]},{name:"filepool",newName:"filepool_files",fields:[{name:"stale",type:"boolean"},{name:"downloaded",newName:"downloadTime"},{name:"isexternalfile",type:"boolean"}]},{name:"files_links",newName:"filepool_files_links",fields:[{name:"componentAndId",delete:!0}]},{name:"filepool_packages",fields:[{name:"downloadtime",newName:"downloadTime"},{name:"previousdownloadtime",newName:"previousDownloadTime"},{name:"revision",newName:"extra"},{name:"timemodified",delete:!0}]},{name:"mm_emulator_last_received_notification",newName:"core_emulator_last_received_notification",filterFields:["component","id","timecreated"]},{name:"questions",fields:[{name:"componentId",newName:"componentid"},{name:"componentAndAttempt",delete:!0},{name:"componentAndComponentId",delete:!0}]},{name:"question_answers",fields:[{name:"componentId",newName:"componentid"},{name:"componentAndAttempt",delete:!0},{name:"componentAndComponentId",delete:!0},{name:"componentAndAttemptAndQuestion",delete:!0}]},{name:"sync"},{name:"users"},{name:"wscache",fields:[{name:"data",type:"object"},{name:"expirationtime",newName:"expirationTime"}]}],this.logger=e.getInstance("CoreUpdateManagerProvider")}return e.prototype.load=function(){var e=this,t=[],n=f.a.versioncode;return this.configProvider.get(this.VERSION_APPLIED,0).then(function(t){return t||e.migrateAllDBs().then(function(){return e.migrateLocalNotificationsComponents()}).then(function(){return e.configProvider.get(e.VERSION_APPLIED,0)})}).then(function(o){return n>=2013&&o<2013&&o>0&&t.push(e.migrateFileExtensions()),n>=2017&&o<2017&&o>0&&(t.push(e.setCalendarDefaultNotifTime()),t.push(e.setSitesConfig())),n>=3500&&o<3500&&o>0&&t.push(e.logoutLegacySites()),Promise.all(t).then(function(){return e.configProvider.set(e.VERSION_APPLIED,n)}).catch(function(t){e.logger.error("Error applying update from "+o+" to "+n,t)})})},e.prototype.registerAppTablesMigration=function(e){var t=this;e.forEach(function(e){t.registerAppTableMigration(e)})},e.prototype.registerAppTableMigration=function(e){this.appDBTables.push(e)},e.prototype.registerSiteTablesMigration=function(e){var t=this;e.forEach(function(e){t.registerSiteTableMigration(e)})},e.prototype.registerSiteTableMigration=function(e){this.siteDBTables.push(e)},e.prototype.registerLocalNotifComponentMigration=function(e,t){this.localNotificationsComponentsMigrate[e]=t},e.prototype.migrateAllDBs=function(){var e=this;return window.ydn?this.migrateAppDB().then(function(){return e.sitesProvider.getSitesIds()}).then(function(t){var n=[];return t.forEach(function(t){n.push(e.migrateSiteDB(t))}),e.utils.allPromises(n)}):Promise.resolve()},e.prototype.migrateAppDB=function(){var e=new window.ydn.db.Storage("MoodleMobile"),t=this.appProvider.getDB();return this.migrateDB(e,t,this.appDBTables)},e.prototype.migrateSiteDB=function(e){var t=this;return this.sitesProvider.getSiteDb(e).then(function(n){var o=new window.ydn.db.Storage("Site-"+e);return t.migrateDB(o,n,t.siteDBTables)})},e.prototype.migrateDB=function(e,t,n){var o=this;if(!e||!t)return Promise.resolve();var r=[];return n.forEach(function(n){r.push(Promise.resolve(e.values(n.name,void 0,99999999)).then(function(e){for(var o=n.fields||[],r=n.filterFields||[],i=function(t){var n=e[t];o.forEach(function(e){var t=n[e.name];"object"==e.type||"any"==e.type&&"object"==typeof t?n[e.name]=JSON.stringify(t):"date"==e.type&&t?n[e.name]=t.getTime():("boolean"==e.type||"any"==e.type&&"boolean"==typeof t)&&(n[e.name]=t?1:0),e.newName&&(n[e.newName]=n[e.name],delete n[e.name]),e.delete&&delete n[e.name]});for(var i in n)0===i.indexOf("$")?delete n[i]:r.length&&-1==r.indexOf(i)&&delete n[i]},s=0;s<e.length;s++)i(s);return t.insertRecords(n.newName||n.name,e)}).catch(function(e){o.logger.error("Error migrating table "+n.name+" to "+(n.newName||n.name)+": ",e)}))}),this.utils.allPromises(r)},e.prototype.migrateFileExtensions=function(){var e=this;return this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.filepoolProvider.fillMissingExtensionInFiles(t))}),n.push(e.filepoolProvider.treatExtensionInQueue()),Promise.all(n)})},e.prototype.migrateLocalNotificationsComponents=function(){var e=this;if(!this.notifProvider.isAvailable())return Promise.resolve();var t=[],n=function(n){var r=o.localNotificationsComponentsMigrate[n];t.push(o.notifProvider.updateComponentName(n,r).catch(function(t){e.logger.error("Error migrating local notif component from "+n+" to "+r+": ",t)}))},o=this;for(var r in this.localNotificationsComponentsMigrate)n(r);return Promise.all(t)},e.prototype.setCalendarDefaultNotifTime=function(){var e=this;return this.notifProvider.isAvailable()?this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.calendarProvider.getAllEventsFromLocalDb(t).then(function(n){var o=[];return n.forEach(function(n){n.notificationtime==p.a.DEFAULT_NOTIFICATION_TIME&&(n.notificationtime=-1,o.push(e.calendarProvider.storeEventInLocalDb(n,t)))}),Promise.all(o)}))}),Promise.all(n)}):Promise.resolve()},e.prototype.setSitesConfig=function(){var e=this;return this.sitesProvider.getSitesIds().then(function(t){return e.sitesProvider.getStoredCurrentSiteId().catch(function(){}).then(function(n){var o;return o=n?e.setSiteConfig(n):Promise.resolve(),t.forEach(function(t){t!=n&&e.setSiteConfig(t)}),o})})},e.prototype.setSiteConfig=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){if(!e.getStoredConfig()&&e.wsAvailable("tool_mobile_get_config"))return e.getConfig().then(function(n){return t.sitesProvider.addSite(e.getId(),e.getURL(),e.getToken(),e.getInfo(),e.getPrivateToken(),n)}).catch(function(){})})},e.prototype.logoutLegacySites=function(){var e=this;return this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.sitesProvider.getSite(t).then(function(t){if(e.sitesProvider.isLegacyMoodleByInfo(t.getInfo()))return e.sitesProvider.setSiteLoggedOut(t.getId(),!0)}))}),e.utils.allPromises(n)})},e=h([Object(o.A)(),m("design:paramtypes",[u.a,i.a,d.a,s.a,c.a,l.a,r.a,p.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(9),i=n(18),s=n(7),a=n(2),c=n(11),u=n(22),d=n(6),l=n(139),f=n(26),p=n(94),h=n(102),m=n(80),g=n(322),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l){this.sitesProvider=t,this.textUtils=n,this.timeUtils=o,this.appProvider=r,this.utils=i,this.userProvider=s,this.submissionDelegate=a,this.gradesProvider=c,this.filepoolProvider=u,this.assignOffline=d,this.commentsProvider=l,this.ROOT_CACHE_KEY="mmaModAssign:",this.gradingOfflineEnabled={},this.logger=e.getInstance("AddonModAssignProvider")}return t=e,e.prototype.canSubmitOffline=function(e,n){if(!this.isSubmissionOpen(e,n))return!1;var o=n.lastattempt.submission,r=n.lastattempt.teamsubmission;if(r){if(r.status===t.SUBMISSION_STATUS_SUBMITTED)return!1;if(o&&o.status===t.SUBMISSION_STATUS_SUBMITTED)return!1;if(e.preventsubmissionnotingroup&&!n.lastattempt.submissiongroup)return!1}else{if(!o)return!1;if(o.status===t.SUBMISSION_STATUS_SUBMITTED)return!1}return e.submissiondrafts},e.prototype.getAssignment=function(e,t,n){return this.getAssignmentByField(e,"cmid",t,n)},e.prototype.getAssignmentByField=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getAssignmentCacheKey(e)};return o.read("mod_assign_get_assignments",i,s).then(function(e){if(e.courses&&e.courses.length)for(var o=e.courses[0].assignments,r=0;r<o.length;r++)if(o[r][t]==n)return o[r];return Promise.reject(null)})})},e.prototype.getAssignmentById=function(e,t,n){return this.getAssignmentByField(e,"id",t,n)},e.prototype.getAssignmentCacheKey=function(e){return this.ROOT_CACHE_KEY+"assignment:"+e},e.prototype.getAssignmentUserMappings=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={assignmentids:[e]},i={cacheKey:o.getAssignmentUserMappingsCacheKey(e)};return n.read("mod_assign_get_user_mappings",r,i).then(function(n){if(n.assignments&&n.assignments.length){if(!t||t<0)return-1;var o=n.assignments[0];if(o.assignmentid==e)for(var r=o.mappings,i=0;i<r.length;i++)if(r[i].userid==t)return r[i].id}else if(n.warnings&&n.warnings.length)return Promise.reject(n.warnings[0]);return Promise.reject(null)})})},e.prototype.getAssignmentUserMappingsCacheKey=function(e){return this.ROOT_CACHE_KEY+"usermappings:"+e},e.prototype.getParticipantFromUserId=function(e,t){if(e)for(var n in e)if(e[n].id==t){var o=e[n];return delete e[n],o}},e.prototype.getSubmissionGradingStatusColor=function(e){return e?e==t.GRADING_STATUS_GRADED||e==t.MARKING_WORKFLOW_STATE_RELEASED?"success":"danger":""},e.prototype.getSubmissionGradingStatusTranslationId=function(e){if(e)return e==t.GRADING_STATUS_GRADED||e==t.GRADING_STATUS_NOT_GRADED?"addon.mod_assign."+e:"addon.mod_assign.markingworkflowstate"+e},e.prototype.getSubmissionObjectFromAttempt=function(e,t){return e.teamsubmission?t.teamsubmission:t.submission},e.prototype.getSubmissionPluginAttachments=function(e){var t=[];return e.fileareas&&e.fileareas.forEach(function(e){e&&e.files&&e.files.forEach(function(e){var n;n=e.filename?e.filename:"/"==e.filepath[0]?e.filepath.substr(1):e.filepath,t.push({filename:n,fileurl:e.fileurl})})}),t},e.prototype.getSubmissionPluginText=function(e,t){var n="";return e.editorfields&&(e.editorfields.forEach(function(e){n+=e.text}),!t&&e.fileareas&&e.fileareas[0]&&(n=this.textUtils.replacePluginfileUrls(n,e.fileareas[0].files))),n},e.prototype.getSubmissions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={assignmentids:[e]},r={cacheKey:n.getSubmissionsCacheKey(e)};return t.read("mod_assign_get_submissions",o,r).then(function(e){return e.warnings.length>0&&1==e.warnings[0].warningcode?{canviewsubmissions:!1}:e.assignments&&e.assignments.length?{canviewsubmissions:!0,submissions:e.assignments[0].submissions}:Promise.reject(null)})})},e.prototype.getSubmissionsCacheKey=function(e){return this.ROOT_CACHE_KEY+"submissions:"+e},e.prototype.getSubmissionStatus=function(e,t,n,o,r,i){var s=this;return void 0===o&&(o=!0),t=t||0,this.sitesProvider.getSite(i).then(function(i){var a={assignid:e,userid:t},c={cacheKey:s.getSubmissionStatusCacheKey(e,t,n),getCacheUsingCacheKey:!0,filter:o,rewriteurls:o};return r&&(c.getFromCache=!1,c.emergencyCache=!1),o||(c.saveToCache=!1),i.read("mod_assign_get_submission_status",a,c)})},e.prototype.getSubmissionStatusCacheKey=function(e,t,n){return t||(n=!1,t=this.sitesProvider.getCurrentSiteUserId()),this.getSubmissionsCacheKey(e)+":"+t+":"+(n?1:0)},e.prototype.getSubmissionStatusColor=function(e){switch(e){case"submitted":return"success";case"draft":return"info";case"new":case"noattempt":case"noonlinesubmissions":case"nosubmission":return"danger";default:return"light"}},e.prototype.getSubmissionsUserData=function(e,n,o,r,i,s){var a=this,c=[],u=[],d=i&&i.length>0;return e.forEach(function(e){if(e.submitid=e.userid>0?e.userid:e.blindid,!(e.submitid<=0)){var t=a.getParticipantFromUserId(i,e.submitid);if(!d||t){t&&(r||(e.userfullname=t.fullname,e.userprofileimageurl=t.profileimageurl),e.manyGroups=!!t.groups&&t.groups.length>1,t.groupname&&(e.groupid=t.groupid,e.groupname=t.groupname));var l;e.userid>0&&(r?(delete e.userid,l=a.getAssignmentUserMappings(o,e.submitid,s).then(function(t){e.blindid=t})):t||(l=a.userProvider.getProfile(e.userid,n,!0).then(function(t){e.userfullname=t.fullname,e.userprofileimageurl=t.profileimageurl}).catch(function(){}))),l=l||Promise.resolve(),c.push(l.then(function(){(e.userfullname||e.blindid)&&u.push(e)}))}}}),Promise.all(c).then(function(){return d&&i.forEach(function(e){var n={submitid:e.id};r?n.blindid=e.id:(n.userid=e.id,n.userfullname=e.fullname,n.userprofileimageurl=e.profileimageurl),e.groupname&&(n.groupid=e.groupid,n.groupname=e.groupname),n.status=e.submitted?t.SUBMISSION_STATUS_SUBMITTED:t.SUBMISSION_STATUS_NEW,u.push(n)}),u})},e.prototype.getUnsupportedEditPlugins=function(e){var t=this,n=[],o=[];return e.forEach(function(e){o.push(t.submissionDelegate.isPluginSupportedForEdit(e.type).then(function(t){t||n.push(e.name)}))}),Promise.all(o).then(function(){return n})},e.prototype.listParticipants=function(e,t,n){var o=this;return t=t||0,this.sitesProvider.getSite(n).then(function(n){if(!n.wsAvailable("mod_assign_list_participants"))return Promise.reject(null);var r={assignid:e,groupid:t,filter:""},i={cacheKey:o.listParticipantsCacheKey(e,t)};return n.read("mod_assign_list_participants",r,i)})},e.prototype.listParticipantsCacheKey=function(e,t){return this.listParticipantsPrefixCacheKey(e)+":"+t},e.prototype.listParticipantsPrefixCacheKey=function(e){return this.ROOT_CACHE_KEY+"participants:"+e},e.prototype.invalidateAllSubmissionData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getSubmissionsCacheKey(e))})},e.prototype.invalidateAssignmentData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getAssignmentCacheKey(e))})},e.prototype.invalidateAssignmentUserMappingsData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getAssignmentUserMappingsCacheKey(e))})},e.prototype.invalidateContent=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getAssignment(t,e,n).then(function(e){var r=[];return r.push(o.invalidateAllSubmissionData(e.id,n)),r.push(o.invalidateAssignmentUserMappingsData(e.id,n)),r.push(o.invalidateListParticipantsData(e.id,n)),r.push(o.commentsProvider.invalidateCommentsByInstance("module",e.id,n)),r.push(o.invalidateAssignmentData(t,n)),r.push(o.gradesProvider.invalidateAllCourseGradesData(t)),Promise.all(r)})},e.prototype.invalidateFiles=function(e){return this.filepoolProvider.invalidateFilesByComponent(this.sitesProvider.getCurrentSiteId(),t.COMPONENT,e)},e.prototype.invalidateSubmissionData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getSubmissionsCacheKey(e))})},e.prototype.invalidateSubmissionStatusData=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(r.getSubmissionStatusCacheKey(e,t,n))})},e.prototype.invalidateListParticipantsData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.listParticipantsPrefixCacheKey(e))})},e.prototype.isGradingOfflineEnabled=function(e){var t=this;return void 0!==this.gradingOfflineEnabled[e]?Promise.resolve(this.gradingOfflineEnabled[e]):this.gradesProvider.isGradeItemsAvalaible(e).then(function(n){return t.gradingOfflineEnabled[e]=n,n})},e.prototype.isOutcomesEditEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("mod_assign_submit_grading_form")})},e.prototype.isPluginEnabled=function(e){return!0},e.prototype.isSubmissionOpen=function(e,n){if(!e||!n)return!1;var o,r=this.timeUtils.timestamp(),i=n.lastattempt,s=this.getSubmissionObjectFromAttempt(e,i);return e.cutoffdate&&(o=e.cutoffdate),(!i||!i.locked)&&(o&&i&&i.extensionduedate&&i.extensionduedate>o&&(o=i.extensionduedate),!!(o?e.allowsubmissionsfromdate<=r&&r<=o:e.allowsubmissionsfromdate<=r)&&(!s||!e.submissiondrafts||s.status!=t.SUBMISSION_STATUS_SUBMITTED))},e.prototype.logSubmissionView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_assign_view_submission_status",{assignid:e})})},e.prototype.logGradingView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_assign_view_grading_table",{assignid:e})})},e.prototype.logView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_assign_view_assign",{assignid:e})})},e.prototype.needsSubmissionToBeGraded=function(e,n){return e.gradingstatus?e.gradingstatus!=t.GRADING_STATUS_GRADED&&e.gradingstatus!=t.MARKING_WORKFLOW_STATE_RELEASED?Promise.resolve(!0):this.getSubmissionStatus(n,e.submitid,e.blindid).then(function(t){return!t.feedback||!t.feedback.gradeddate||t.feedback.gradeddate<e.timemodified}):Promise.resolve(!0)},e.prototype.saveSubmission=function(e,t,n,o,r,i,s,a){var c=this;a=a||this.sitesProvider.getCurrentSiteId();var u=function(){return c.assignOffline.saveSubmission(e,t,n,r,!i,s,a).then(function(){return!1})};return o&&!this.appProvider.isOnline()?u():this.assignOffline.deleteSubmission(e,s,a).then(function(){return c.saveSubmissionOnline(e,n,a).then(function(){return!0}).catch(function(e){return o&&e&&!c.utils.isWebServiceError(e)?u():Promise.reject(e)})})},e.prototype.saveSubmissionOnline=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_assign_save_submission",{assignmentid:e,plugindata:t}).then(function(e){if(e&&e.length)return Promise.reject(e[0])})})},e.prototype.submitForGrading=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteId();var a=function(){return s.assignOffline.markSubmitted(e,t,!0,n,o,void 0,i).then(function(){return!1})};return r||!this.appProvider.isOnline()?a():this.assignOffline.deleteSubmission(e,void 0,i).then(function(){return s.submitForGradingOnline(e,n,i).then(function(){return!0}).catch(function(e){return e&&!s.utils.isWebServiceError(e)?a():Promise.reject(e)})})},e.prototype.submitForGradingOnline=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_assign_submit_for_grading",{assignmentid:e,acceptsubmissionstatement:t?1:0}).then(function(e){if(e&&e.length)return Promise.reject(e[0])})})},e.prototype.submitGradingForm=function(e,t,n,o,r,i,s,a,c,u,d){var l=this;d=d||this.sitesProvider.getCurrentSiteId();var f=function(){return l.assignOffline.submitGradingForm(e,t,n,o,r,i,s,a,c,u,d).then(function(){return!1})};return this.isGradingOfflineEnabled(d).then(function(n){return n?l.appProvider.isOnline()?l.assignOffline.deleteSubmissionGrade(e,t,d).then(function(){return l.submitGradingFormOnline(e,t,o,r,i,s,a,c,u,d).then(function(){return!0}).catch(function(e){return e&&!l.utils.isWebServiceError(e)?f():Promise.reject(e)})}):f():l.submitGradingFormOnline(e,t,o,r,i,s,a,c,u,d)})},e.prototype.submitGradingFormOnline=function(e,t,n,o,r,i,s,a,c,u){return this.sitesProvider.getSite(u).then(function(u){if(t=t||u.getUserId(),u.wsAvailable("mod_assign_submit_grading_form")){var d={grade:n,attemptnumber:o,addattempt:r?1:0,workflowstate:i,applytoall:s?1:0};for(var l in a)d["outcome_"+l+"["+t+"]"]=a[l];for(var l in c)d[l]=c[l];var f=g.a.serialize(d,!0),p={assignmentid:e,userid:t,jsonformdata:JSON.stringify(f)};return u.write("mod_assign_submit_grading_form",p).then(function(e){if(e&&e.length)return Promise.reject(e[0])})}return u.write("mod_assign_save_grade",p={assignmentid:e,userid:t,grade:n,attemptnumber:o,addattempt:r?1:0,workflowstate:i,applytoall:s?1:0,plugindata:c},{responseExpected:!1})})},e.COMPONENT="mmaModAssign",e.SUBMISSION_COMPONENT="mmaModAssignSubmission",e.UNLIMITED_ATTEMPTS=-1,e.SUBMISSION_STATUS_NEW="new",e.SUBMISSION_STATUS_REOPENED="reopened",e.SUBMISSION_STATUS_DRAFT="draft",e.SUBMISSION_STATUS_SUBMITTED="submitted",e.ATTEMPT_REOPEN_METHOD_NONE="none",e.ATTEMPT_REOPEN_METHOD_MANUAL="manual",e.GRADING_STATUS_GRADED="graded",e.GRADING_STATUS_NOT_GRADED="notgraded",e.MARKING_WORKFLOW_STATE_RELEASED="released",e.NEED_GRADING="needgrading",e.SUBMISSION_SAVED_EVENT="addon_mod_assign_submission_saved",e.SUBMITTED_FOR_GRADING_EVENT="addon_mod_assign_submitted_for_grading",e.GRADED_EVENT="addon_mod_assign_graded",e=t=y([Object(o.A)(),v("design:paramtypes",[s.a,a.a,c.a,u.a,r.a,d.a,f.a,h.a,p.a,i.a,m.a,l.a])],e);var t}()},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(1),s=n(27),a=n(18),c=n(7),u=n(2),d=n(77),l=n(11),f=n(22),p=n(6),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,r,i,s,a,c,u){this.fileProvider=t,this.textUtils=n,this.utils=o,this.sitesProvider=r,this.timeUtils=i,this.mimeUtils=s,this.filepoolProvider=a,this.platform=c,this.translate=u,this.logger=e.getInstance("CoreFileUploaderProvider")}return e.prototype.addDot=function(e){return"."+e},e.prototype.areFileListDifferent=function(e,t){if(e=e||[],t=t||[],e.length!=t.length)return!0;for(var n=0;n<e.length;n++)if((e[n].name||e[n].filename)!=(t[n].name||t[n].filename))return!0;return!1},e.prototype.clearTmpFiles=function(e){e.forEach(function(e){!e.offline&&e.remove&&e.remove(function(){})})},e.prototype.getCameraUploadOptions=function(e,t){var n=this.mimeUtils.getExtension(e),o=this.mimeUtils.getMimeType(n),r=this.platform.is("ios"),i={deleteAfterUpload:!t,mimeType:o};return i.fileName=!r||"image/jpeg"!=o&&"image/png"!=o?this.fileProvider.getFileAndDirectoryFromPath(e).name:"image_"+this.timeUtils.readableTimestamp()+"."+n,t&&(i.deleteAfterUpload=this.fileProvider.isFileInAppFolder(e),this.platform.is("android")&&(i.fileName=i.fileName.replace(/(\.[^\.]*)\?[^\.]*$/,"$1"))),i},e.prototype.getFileUploadOptions=function(e,t,n,o,r,i){var s={};return s.fileName=t,s.mimeType=n||this.mimeUtils.getMimeType(this.mimeUtils.getFileExtension(s.fileName)),s.deleteAfterUpload=!!o,s.itemId=i||0,s.fileArea=r,s},e.prototype.getMediaUploadOptions=function(e){var t,n={},o=e.name;return t=o.split("."),t[0]+="_"+this.timeUtils.readableTimestamp(),o=t.join("."),n.fileName=o,n.deleteAfterUpload=!0,n.mimeType=e.type?e.type:this.mimeUtils.getMimeType(this.mimeUtils.getFileExtension(n.fileName)),n},e.prototype.getStoredFiles=function(e){var t=this;return this.fileProvider.getDirectoryContents(e).then(function(e){return t.markOfflineFiles(e)})},e.prototype.getStoredFilesFromOfflineFilesObject=function(e,t){var n=[];return e&&(e.online&&e.online.length>0&&(n=this.utils.clone(e.online)),e.offline>0)?this.getStoredFiles(t).then(function(e){return n.concat(e)}).catch(function(){return n}):Promise.resolve(n)},e.prototype.isInvalidMimetype=function(e,t,n){var o;if(e&&(n?o=this.mimeUtils.getExtension(n):(o=this.mimeUtils.getFileExtension(t),n=this.mimeUtils.getMimeType(o)),n&&-1==e.indexOf(n)))return o=o||this.translate.instant("core.unknown"),this.translate.instant("core.fileuploader.invalidfiletype",{$a:o})},e.prototype.markOfflineFiles=function(e){return e.forEach(function(e){e.offline=!0,e.filename=e.name}),e},e.prototype.prepareFiletypeList=function(e){var t=this,n={},o=[];return e.split(/[;, ]+/g).forEach(function(e){if(e=e.trim())if(-1!=e.indexOf("/"))o.push({name:t.mimeUtils.getMimetypeDescription(e),extlist:t.mimeUtils.getExtensions(e).map(t.addDot).join(" ")}),n[e]=!0;else if(0===e.indexOf(".")){var r=t.mimeUtils.getMimeType(e);o.push({name:!!r&&t.mimeUtils.getMimetypeDescription(r),extlist:e}),r&&(n[r]=!0)}else{var i=t.mimeUtils.getGroupMimeInfo(e,"extensions"),s=t.mimeUtils.getGroupMimeInfo(e,"mimetypes");if(i.length>0)o.push({name:t.mimeUtils.getTranslatedGroupName(e),extlist:i?i.map(t.addDot).join(" "):""}),s.forEach(function(e){e&&(n[e]=!0)});else{e=t.addDot(e);r=t.mimeUtils.getMimeType(e);o.push({name:!!r&&t.mimeUtils.getMimetypeDescription(r),extlist:e}),r&&(n[r]=!0)}}}),{info:o,mimetypes:Object.keys(n)}},e.prototype.storeFilesToUpload=function(e,t){var n=this,o={online:[],offline:0};return t&&t.length?this.fileProvider.removeUnusedFiles(e,t).then(function(){var r=[];return t.forEach(function(t){if(t.filename&&!t.name)o.online.push({filename:t.filename,fileurl:t.fileurl});else if(t.name)if(t.fullPath&&-1!=t.fullPath.indexOf(e))o.offline++;else{var i=n.textUtils.concatenatePaths(e,t.name);r.push(n.fileProvider.copyFile(t.toURL(),i)),o.offline++}else r.push(Promise.reject(null))}),Promise.all(r).then(function(){return o})}):Promise.resolve(o)},e.prototype.uploadFile=function(e,t,n,o){var r=this,i=(t=t||{}).deleteAfterUpload,s=this.utils.clone(t);return delete s.deleteAfterUpload,this.sitesProvider.getSite(o).then(function(t){return t.uploadFile(e,s,n)}).then(function(t){return i&&setTimeout(function(){r.fileProvider.removeExternalFile(e)},500),t})},e.prototype.uploadOrReuploadFile=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId();var s,a;return e.filename&&!e.name?(a=e.filename,s=this.filepoolProvider.downloadUrl(r,e.url||e.fileurl,!1,n,o,e.timemodified,void 0,void 0,e).then(function(e){return i.fileProvider.getExternalFile(e)})):(a=e.name,s=Promise.resolve(e)),s.then(function(e){var n=i.getFileUploadOptions(e.toURL(),a,e.type,!0,"draft",t);return i.uploadFile(e.toURL(),n,void 0,r).then(function(e){return e.itemid})})},e.prototype.uploadOrReuploadFiles=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),e&&e.length?this.uploadOrReuploadFile(e[0],0,t,n,o).then(function(i){for(var s=[],a=1;a<e.length;a++){s.push(r.uploadOrReuploadFile(e[a],i,t,n,o))}return Promise.all(s).then(function(){return i})}):Promise.resolve(1)},e.LIMITED_SIZE_WARNING=1048576,e.WIFI_SIZE_WARNING=10485760,e=h([Object(o.A)(),m("design:paramtypes",[c.a,s.a,l.a,p.a,u.a,f.a,d.a,a.a,r.s,i.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(58),i=n(41),s=n(7),a=n(2),c=n(12),u=n(96),d=(n.n(u),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,o,r,i){var s=e.call(this,"CoreUserDelegate",t,o,i)||this;return s.loggerProvider=t,s.sitesProvider=o,s.coursesProvider=r,s.eventsProvider=i,s.observableHandlers=new u.BehaviorSubject([]),s.userHandlers=[],s.featurePrefix="CoreUserDelegate_",s.loaded=!1,i.on(n.UPDATE_HANDLER_EVENT,function(e){if(e&&e.handler){var t=s.userHandlers.find(function(t){return t.name==e.handler});if(t){for(var n in e.data)t.data[n]=e.data[n];s.observableHandlers.next(s.userHandlers)}}}),s}return d(t,e),n=t,t.prototype.areHandlersLoaded=function(){return this.loaded},t.prototype.clearUserHandlers=function(){this.loaded=!1,this.userHandlers=[],this.observableHandlers.next(this.userHandlers)},t.prototype.getProfileHandlersFor=function(e,t){var o,r,i,s=this;return o=this.coursesProvider.canGetAdminAndNavOptions()?this.coursesProvider.getUserCourses(!0).then(function(e){var n=e.map(function(e){return e.id});return s.coursesProvider.getCoursesAdminAndNavOptions(n).then(function(e){var n=t||s.sitesProvider.getCurrentSiteHomeId();r=e.navOptions[n],i=e.admOptions[n]})}):Promise.resolve(),this.userHandlers=[],o.then(function(){var o=[],a=function(a){var c=s.handlers[a],u=c.isEnabledForUser(e,t,r,i),d=Promise.resolve(u).then(function(o){if(!o)return Promise.reject(null);s.userHandlers.push({name:a,data:c.getDisplayData(e,t),priority:c.priority,type:c.type||n.TYPE_NEW_PAGE})}).catch(function(){});o.push(d)};for(var c in s.enabledHandlers)a(c);return Promise.all(o).then(function(){s.userHandlers.sort(function(e,t){return t.priority-e.priority}),s.loaded=!0,s.observableHandlers.next(s.userHandlers)})}).catch(function(){s.loaded=!0,s.observableHandlers.next(s.userHandlers)}),this.observableHandlers},t.TYPE_COMMUNICATION="communication",t.TYPE_NEW_PAGE="newpage",t.TYPE_ACTION="action",t.UPDATE_HANDLER_EVENT="CoreUserDelegate_update_handler_event",t=n=l([Object(o.A)(),f("design:paramtypes",[s.a,a.a,i.a,c.a])],t);var n}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(12),r=function(){function e(e,t,n,r){this.loggerProvider=t,this.sitesProvider=n,this.eventsProvider=r,this.handlers={},this.enabledHandlers={},this.handlerNameProperty="name",this.updatePromises={},this.logger=this.loggerProvider.getInstance(e),r&&(r.on(o.a.LOGIN,this.updateHandlers.bind(this)),r.on(o.a.SITE_UPDATED,this.updateHandlers.bind(this)),r.on(o.a.SITE_PLUGINS_LOADED,this.updateHandlers.bind(this)))}return e.prototype.executeFunctionOnEnabled=function(e,t,n){return this.execute(this.enabledHandlers[e],t,n)},e.prototype.executeFunction=function(e,t,n){return this.execute(this.handlers[e],t,n)},e.prototype.execute=function(e,t,n){return e&&e[t]?e[t].apply(e,n):this.defaultHandler&&this.defaultHandler[t]?this.defaultHandler[t].apply(this.defaultHandler,n):void 0},e.prototype.getHandler=function(e,t){return void 0===t&&(t=!1),t?this.enabledHandlers[e]:this.handlers[e]},e.prototype.hasFunction=function(e,t,n){void 0===n&&(n=!0);var o=n?this.enabledHandlers[e]:this.handlers[e];return o&&o[t]},e.prototype.hasHandler=function(e,t){return void 0===t&&(t=!1),t?void 0!==this.enabledHandlers[e]:void 0!==this.handlers[e]},e.prototype.isLastUpdateCall=function(e){return!this.lastUpdateHandlersStart||e==this.lastUpdateHandlersStart},e.prototype.registerHandler=function(e){return void 0!==this.handlers[e[this.handlerNameProperty]]?(this.logger.log("Handler '"+e[this.handlerNameProperty]+"' already registered"),!1):(this.logger.log("Registered handler '"+e[this.handlerNameProperty]+"'"),this.handlers[e[this.handlerNameProperty]]=e,!0)},e.prototype.updateHandler=function(e,t){var n,o=this,r=this.sitesProvider.getCurrentSiteId(),i=this.sitesProvider.getCurrentSite();return this.updatePromises[r]&&this.updatePromises[r][e.name]?this.updatePromises[r][e.name]:(this.updatePromises[r]||(this.updatePromises[r]={}),n=this.sitesProvider.isLoggedIn()?this.isFeatureDisabled(e,i)?Promise.resolve(!1):Promise.resolve(e.isEnabled()):Promise.reject(null),this.updatePromises[r][e.name]=n.catch(function(){return!1}).then(function(n){o.isLastUpdateCall(t)&&o.sitesProvider.getCurrentSiteId()===r&&(n?o.enabledHandlers[e[o.handlerNameProperty]]=e:delete o.enabledHandlers[e[o.handlerNameProperty]])}).finally(function(){delete o.updatePromises[r][e.name]}),this.updatePromises[r][e.name])},e.prototype.isFeatureDisabled=function(e,t){return void 0!==this.featurePrefix&&t.isFeatureDisabled(this.featurePrefix+e.name)},e.prototype.updateHandlers=function(){var e=this,t=[],n=Date.now();this.logger.debug("Updating handlers for current site."),this.lastUpdateHandlersStart=n;for(var o in this.handlers)t.push(this.updateHandler(this.handlers[o],n));return Promise.all(t).then(function(){return!0},function(){return!0}).then(function(){e.isLastUpdateCall(n)&&e.updateData()})},e.prototype.updateData=function(){},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(7),s=n(2),a=n(6),c=n(18),u=n(150),d=n(62),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,n,o,r,i,s,a){this.sitesProvider=n,this.utils=o,this.filepoolProvider=r,this.dataOffline=i,this.appProvider=s,this.fieldsDelegate=a,this.ROOT_CACHE_KEY=t.COMPONENT+":",this.logger=e.getInstance("AddonModDataProvider")}return t=e,e.prototype.addEntry=function(e,t,n,o,r,i,s,a){var c=this;void 0===r&&(r=0),void 0===a&&(a=!1),s=s||this.sitesProvider.getCurrentSiteId();if(!this.appProvider.isOnline()||a){var u=this.checkFields(i,o);if(u)return Promise.resolve({fieldnotifications:u})}return this.addEntryOnline(e,o,r,s).catch(function(i){return c.utils.isWebServiceError(i)?Promise.reject(i):c.dataOffline.saveEntry(e,t,"add",n,r,o,void 0,s).then(function(e){return{newentryid:e}})})},e.prototype.addEntryOnline=function(e,t,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={databaseid:e,data:t};return void 0!==n&&(r.groupid=n),o.write("mod_data_add_entry",r)})},e.prototype.approveEntry=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId();var s=function(){return i.dataOffline.saveEntry(e,t,n?"approve":"disapprove",o,void 0,void 0,void 0,r)},a=n?"disapprove":"approve";return this.dataOffline.getEntry(e,t,a,r).then(function(){return i.dataOffline.deleteEntry(e,t,a,r)}).catch(function(){return i.appProvider.isOnline()?i.approveEntryOnline(t,n,r).catch(function(e){return i.utils.isWebServiceError(e)?Promise.reject(e):s()}):s()})},e.prototype.approveEntryOnline=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_data_approve_entry",{entryid:e,approve:t?1:0})})},e.prototype.checkFields=function(e,t){var n=this,o=[],r={};return t.forEach(function(e){void 0===r[e.fieldid]&&(r[e.fieldid]=[]),r[e.fieldid].push(e)}),Object.keys(e).forEach(function(t){var i=e[t],s=n.fieldsDelegate.getFieldsNotifications(i,r[i.id]);s&&o.push({fieldname:i.name,notification:s})}),!!o.length&&o},e.prototype.deleteEntry=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=function(){return r.dataOffline.saveEntry(e,t,"delete",n,void 0,void 0,void 0,o)},s=!1;return this.dataOffline.getEntryActions(e,t,o).then(function(n){if(n&&n.length){var i=n.map(function(n){return"add"==n.action&&(s=!0),r.dataOffline.deleteEntry(e,t,n.action,o)});return Promise.all(i)}}).then(function(){if(!s)return r.appProvider.isOnline()?r.deleteEntryOnline(t,o).catch(function(e){return r.utils.isWebServiceError(e)?Promise.reject(e):i()}):i()})},e.prototype.deleteEntryOnline=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_data_delete_entry",{entryid:e})})},e.prototype.editEntry=function(e,t,n,o,r,i,s){var a=this;void 0===s&&(s=!1),i=i||this.sitesProvider.getCurrentSiteId();var c,u=function(){return a.dataOffline.saveEntry(e,t,"edit",n,void 0,o,void 0,i).then(function(){return{updated:!0}})},d=!1;if(!this.appProvider.isOnline()||s){var l=this.checkFields(r,o);if(l)return Promise.resolve({fieldnotifications:l})}return this.dataOffline.getEntryActions(e,t,i).then(function(n){if(n&&n.length){var o=[];return n.forEach(function(n){"add"==n.action?(d=!0,c=n.groupid,o.push(a.dataOffline.deleteEntry(e,t,n.action,i))):"edit"==n.action&&o.push(a.dataOffline.deleteEntry(e,t,n.action,i))}),Promise.all(o)}}).then(function(){return d?a.addEntry(e,t,n,o,c,r,i,s).then(function(e){return e.updated=!0,e}):!a.appProvider.isOnline()||s?u():a.editEntryOnline(t,o,i).catch(function(e){return a.utils.isWebServiceError(e)?Promise.reject(e):u()})})},e.prototype.editEntryOnline=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_data_update_entry",{entryid:e,data:t})})},e.prototype.fetchAllEntries=function(e,n,o,r,i,s,a,c){return void 0===n&&(n=0),void 0===o&&(o="0"),void 0===r&&(r="DESC"),void 0===i&&(i=t.PER_PAGE),void 0===s&&(s=!1),void 0===a&&(a=!1),c=c||this.sitesProvider.getCurrentSiteId(),this.fetchEntriesRecursive(e,n,o,r,i,s,a,[],0,c)},e.prototype.fetchEntriesRecursive=function(e,t,n,o,r,i,s,a,c,u){var d=this;return this.getEntries(e,t,n,o,c,r,i,s,u).then(function(l){a=a.concat(l.entries);return r>0&&(c+1)*r<l.totalcount?d.fetchEntriesRecursive(e,t,n,o,r,i,s,a,c+1,u):a})},e.prototype.getDatabaseDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"data:"+e},e.prototype.getDatabaseDataPrefixCacheKey=function(e){return this.ROOT_CACHE_KEY+e},e.prototype.getDatabaseByKey=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),this.sitesProvider.getSite(o).then(function(o){var s={courseids:[e]},a={cacheKey:i.getDatabaseDataCacheKey(e)};return r&&(a.omitExpires=!0),o.read("mod_data_get_databases_by_courses",s,a).then(function(e){if(e&&e.databases){var o=e.databases.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getDatabase=function(e,t,n,o){return void 0===o&&(o=!1),this.getDatabaseByKey(e,"coursemodule",t,n,o)},e.prototype.getDatabaseById=function(e,t,n,o){return void 0===o&&(o=!1),this.getDatabaseByKey(e,"id",t,n,o)},e.prototype.getDatabaseAccessInformationDataPrefixCacheKey=function(e){return this.getDatabaseDataPrefixCacheKey(e)+":access:"},e.prototype.getDatabaseAccessInformationDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getDatabaseAccessInformationDataPrefixCacheKey(e)+t},e.prototype.getDatabaseAccessInformation=function(e,t,n,o,r){var i=this;return void 0===n&&(n=!1),void 0===o&&(o=!1),this.sitesProvider.getSite(r).then(function(r){var s={databaseid:e},a={cacheKey:i.getDatabaseAccessInformationDataCacheKey(e,t)};return void 0!==t&&(s.groupid=t),n?a.omitExpires=!0:o&&(a.getFromCache=!1,a.emergencyCache=!1),r.read("mod_data_get_data_access_information",s,a)})},e.prototype.getEntries=function(e,n,o,r,i,s,a,c,u){var d=this;return void 0===n&&(n=0),void 0===o&&(o="0"),void 0===r&&(r="DESC"),void 0===i&&(i=0),void 0===s&&(s=t.PER_PAGE),void 0===a&&(a=!1),void 0===c&&(c=!1),this.sitesProvider.getSite(u).then(function(t){var u={databaseid:e,returncontents:1,page:i,perpage:s,groupid:n,sort:o,order:r},l={cacheKey:d.getEntriesCacheKey(e,n)};return a?l.omitExpires=!0:c&&(l.getFromCache=!1,l.emergencyCache=!1),t.read("mod_data_get_entries",u,l)})},e.prototype.getEntriesCacheKey=function(e,t){return void 0===t&&(t=0),this.getEntriesPrefixCacheKey(e)+t},e.prototype.getEntriesPrefixCacheKey=function(e){return this.getDatabaseDataPrefixCacheKey(e)+":entries:"},e.prototype.getEntry=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={entryid:t,returncontents:1},i={cacheKey:o.getEntryCacheKey(e,t)};return n.read("mod_data_get_entry",r,i)})},e.prototype.getEntryCacheKey=function(e,t){return this.getDatabaseDataPrefixCacheKey(e)+":entry:"+t},e.prototype.getFields=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={databaseid:e},s={cacheKey:r.getFieldsCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_data_get_fields",i,s).then(function(e){return e&&e.fields?e.fields:Promise.reject(null)})})},e.prototype.getFieldsCacheKey=function(e){return this.getDatabaseDataPrefixCacheKey(e)+":fields"},e.prototype.invalidateContent=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=[];return r.push(this.getDatabase(t,e).then(function(e){var r=[];return r.push(o.invalidateDatabaseData(t,n)),r.push(o.invalidateDatabaseWSData(e.id,n)),Promise.all(r)})),r.push(this.invalidateFiles(e,n)),this.utils.allPromises(r)},e.prototype.invalidateDatabaseAccessInformationData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getDatabaseAccessInformationDataPrefixCacheKey(e))})},e.prototype.invalidateEntriesData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getEntriesPrefixCacheKey(e))})},e.prototype.invalidateFiles=function(e,n){return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.invalidateDatabaseData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getDatabaseDataCacheKey(e))})},e.prototype.invalidateDatabaseWSData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getDatabaseDataPrefixCacheKey(e))})},e.prototype.invalidateEntryData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getEntryCacheKey(e,t))})},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("mod_data_get_data_access_information")})},e.prototype.logView=function(e){var t={databaseid:e};return this.sitesProvider.getCurrentSite().write("mod_data_view_database",t)},e.prototype.searchEntries=function(e,n,o,r,i,s,a,c,u){return void 0===n&&(n=0),void 0===a&&(a=0),void 0===c&&(c=t.PER_PAGE),this.sitesProvider.getSite(u).then(function(t){var u={databaseid:e,groupid:n,returncontents:1,page:a,perpage:c};return void 0!==i&&(u.sort=i),void 0!==s&&(u.order=s),void 0!==o&&(u.search=o),void 0!==r&&(u.advsearch=r),t.read("mod_data_search_entries",u,{getFromCache:!1,saveToCache:!0,emergencyCache:!0})})},e.COMPONENT="mmaModData",e.PER_PAGE=25,e.ENTRY_CHANGED="addon_mod_data_entry_changed",e=t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,a.a,c.a,u.a,r.a,d.a])],e);var t}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(134),i=n(9),s=n(105),a=n(7),c=n(6),u=n(30),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){var s=this;this.appProvider=t,this.configProvider=n,this.utils=o,this.CRON_TABLE="cron",this.tableSchema={name:this.CRON_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"value",type:"INTEGER"}]},this.handlers={},this.queuePromise=Promise.resolve(),this.logger=e.getInstance("CoreCronDelegate"),this.appDB=this.appProvider.getDB(),this.appDB.createTableFromSchema(this.tableSchema),r.onConnect().subscribe(function(){i.run(function(){s.startNetworkHandlers()})})}return t=e,e.prototype.checkAndExecuteHandler=function(e,n,o){var r=this;if(!this.handlers[e]||!this.handlers[e].execute)return this.logger.debug("Cannot execute handler because is invalid: "+e),Promise.reject(null);var i=this.handlerUsesNetwork(e),s=!n&&this.isHandlerSync(e);return i&&!this.appProvider.isOnline()?(this.logger.debug("Cannot execute handler because device is offline: "+e),this.stopHandler(e),Promise.reject(null)):(s?this.configProvider.get(u.a.SETTINGS_SYNC_ONLY_ON_WIFI,!1).then(function(e){return!e||!r.appProvider.isNetworkAccessLimited()}):Promise.resolve(!0)).then(function(n){return n?(r.queuePromise=r.queuePromise.catch(function(){}).then(function(){return r.executeHandler(e,o).then(function(){return r.logger.debug("Execution of handler '"+e+"' was a success."),r.setHandlerLastExecutionTime(e,Date.now()).then(function(){r.scheduleNextExecution(e)})},function(n){return r.logger.error("Execution of handler '"+e+"' failed.",n),r.scheduleNextExecution(e,t.MIN_INTERVAL),Promise.reject(null)})}),r.queuePromise):(r.logger.debug("Cannot execute handler because device is using limited connection: "+e),r.scheduleNextExecution(e,t.MIN_INTERVAL),Promise.reject(null))})},e.prototype.executeHandler=function(e,n){var o=this;return new Promise(function(r,i){var s;o.logger.debug("Executing handler: "+e),Promise.resolve(o.handlers[e].execute(n)).then(r).catch(i).finally(function(){clearTimeout(s)}),s=setTimeout(function(){o.logger.debug("Resolving execution of handler '"+e+"' because it took too long."),r()},t.MAX_TIME_PROCESS)})},e.prototype.forceSyncExecution=function(e){var t=[];for(var n in this.handlers){var o=this.handlers[n];this.isHandlerManualSync(n)&&(o.running=!0,clearTimeout(o.timeout),delete o.timeout,t.push(this.checkAndExecuteHandler(n,!0,e)))}return this.utils.allPromises(t)},e.prototype.getHandlerInterval=function(e){if(!this.handlers[e]||!this.handlers[e].getInterval)return t.DEFAULT_INTERVAL;var n=this.appProvider.isDesktop()?t.DESKTOP_MIN_INTERVAL:t.MIN_INTERVAL,o=this.handlers[e].getInterval();return o?Math.max(n,o):t.DEFAULT_INTERVAL},e.prototype.getHandlerLastExecutionId=function(e){return"last_execution_"+e},e.prototype.getHandlerLastExecutionTime=function(e){var t=this.getHandlerLastExecutionId(e);return this.appDB.getRecord(this.CRON_TABLE,{id:t}).then(function(e){var t=parseInt(e.value,10);return isNaN(t)?0:t}).catch(function(){return 0})},e.prototype.handlerUsesNetwork=function(e){return!this.handlers[e]||!this.handlers[e].usesNetwork||this.handlers[e].usesNetwork()},e.prototype.hasManualSyncHandlers=function(){for(var e in this.handlers)if(this.isHandlerManualSync(e))return!0;return!1},e.prototype.hasSyncHandlers=function(){for(var e in this.handlers)if(this.isHandlerSync(e))return!0;return!1},e.prototype.isHandlerManualSync=function(e){return this.handlers[e]&&this.handlers[e].canManualSync?this.handlers[e].canManualSync():this.isHandlerSync(e)},e.prototype.isHandlerSync=function(e){return!this.handlers[e]||!this.handlers[e].isSync||this.handlers[e].isSync()},e.prototype.register=function(e){e&&e.name&&(void 0===this.handlers[e.name]?(this.logger.debug("Register handler '"+e.name+"' in cron."),e.running=!1,this.handlers[e.name]=e,this.startHandler(e.name)):this.logger.debug("The cron handler '"+e.name+"' is already registered."))},e.prototype.scheduleNextExecution=function(e,t){var n=this;if(this.handlers[e]&&!this.handlers[e].timeout){(t?Promise.resolve(t):this.getHandlerLastExecutionTime(e).then(function(t){return t+n.getHandlerInterval(e)-Date.now()})).then(function(t){n.logger.debug("Scheduling next execution of handler '"+e+"' in '"+t+"' ms"),t<0&&(t=0),n.handlers[e].timeout=setTimeout(function(){delete n.handlers[e].timeout,n.checkAndExecuteHandler(e).catch(function(){})},t)})}},e.prototype.setHandlerLastExecutionTime=function(e,t){var n=this.getHandlerLastExecutionId(e);return this.appDB.insertRecord(this.CRON_TABLE,{id:n,value:t})},e.prototype.startHandler=function(e){this.handlers[e]?this.handlers[e].running?this.logger.debug("Handler '"+e+"', is already running."):(this.handlers[e].running=!0,this.scheduleNextExecution(e)):this.logger.debug("Cannot start handler '"+e+"', is invalid.")},e.prototype.startNetworkHandlers=function(){for(var e in this.handlers)this.handlerUsesNetwork(e)&&this.startHandler(e)},e.prototype.stopHandler=function(e){this.handlers[e]?this.handlers[e].running?(this.handlers[e].running=!1,clearTimeout(this.handlers[e].timeout),delete this.handlers[e].timeout):this.logger.debug("Cannot stop handler '"+e+"', it's not running."):this.logger.debug("Cannot stop handler '"+e+"', is invalid.")},e.DEFAULT_INTERVAL=36e5,e.MIN_INTERVAL=3e5,e.DESKTOP_MIN_INTERVAL=6e4,e.MAX_TIME_PROCESS=12e4,e=t=d([Object(o.A)(),l("design:paramtypes",[a.a,i.a,s.a,c.a,r.a,o.M])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(6),c=n(58),u=n(848),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i){var s=e.call(this,"AddonModDataFieldsDelegate",t,n,o)||this;return s.utils=r,s.defaultHandler=i,s.handlerNameProperty="type",s}return d(t,e),t.prototype.getComponentForField=function(e,t){return Promise.resolve(this.executeFunctionOnEnabled(t.type,"getComponent",[e,t]))},t.prototype.getFieldSearchData=function(e,t){return this.executeFunctionOnEnabled(e.type,"getFieldSearchData",[e,t])},t.prototype.getFieldEditData=function(e,t,n){return this.executeFunctionOnEnabled(e.type,"getFieldEditData",[e,t,n])},t.prototype.getFieldEditFiles=function(e,t,n){return this.executeFunctionOnEnabled(e.type,"getFieldEditFiles",[e,t,n])},t.prototype.getFieldsNotifications=function(e,t){return this.executeFunctionOnEnabled(e.type,"getFieldsNotifications",[e,t])},t.prototype.hasFiles=function(e){return this.hasFunction(e.type,"getFieldEditFiles")},t.prototype.hasFieldDataChanged=function(e,t,n){return Promise.resolve(this.executeFunctionOnEnabled(e.type,"hasFieldDataChanged",[e,t,n])).then(function(e){return e?Promise.reject(null):Promise.resolve()})},t.prototype.isPluginSupported=function(e){return this.hasHandler(e,!0)},t.prototype.overrideData=function(e,t,n,o){return n?this.executeFunctionOnEnabled(e.type,"overrideData",[t||{},n,o]):t},t=l([Object(o.A)(),f("design:paramtypes",[r.a,s.a,i.a,a.a,u.a])],t)}(c.a)},,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(22),a=n(6),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.timeUtils=n,this.utils=o,this.QUESTION_TABLE="questions",this.QUESTION_ANSWERS_TABLE="question_answers",this.tablesSchema=[{name:this.QUESTION_TABLE,columns:[{name:"component",type:"TEXT",notNull:!0},{name:"attemptid",type:"INTEGER",notNull:!0},{name:"slot",type:"INTEGER",notNull:!0},{name:"componentid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"number",type:"INTEGER"},{name:"state",type:"TEXT"}],primaryKeys:["component","attemptid","slot"]},{name:this.QUESTION_ANSWERS_TABLE,columns:[{name:"component",type:"TEXT",notNull:!0},{name:"attemptid",type:"INTEGER",notNull:!0},{name:"name",type:"TEXT",notNull:!0},{name:"componentid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"questionslot",type:"INTEGER"},{name:"value",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["component","attemptid","name"]}],this.QUESTION_PREFIX_REGEX=/q\d+:(\d+)_/,this.STATES={todo:{name:"todo",class:"core-question-notyetanswered",status:"notyetanswered",active:!0,finished:!1},invalid:{name:"invalid",class:"core-question-invalidanswer",status:"invalidanswer",active:!0,finished:!1},complete:{name:"complete",class:"core-question-answersaved",status:"answersaved",active:!0,finished:!1},needsgrading:{name:"needsgrading",class:"core-question-requiresgrading",status:"requiresgrading",active:!1,finished:!0},finished:{name:"finished",class:"core-question-complete",status:"complete",active:!1,finished:!0},gaveup:{name:"gaveup",class:"core-question-notanswered",status:"notanswered",active:!1,finished:!0},gradedwrong:{name:"gradedwrong",class:"core-question-incorrect",status:"incorrect",active:!1,finished:!0},gradedpartial:{name:"gradedpartial",class:"core-question-partiallycorrect",status:"partiallycorrect",active:!1,finished:!0},gradedright:{name:"gradedright",class:"core-question-correct",status:"correct",active:!1,finished:!0},mangrwrong:{name:"mangrwrong",class:"core-question-incorrect",status:"incorrect",active:!1,finished:!0},mangrpartial:{name:"mangrpartial",class:"core-question-partiallycorrect",status:"partiallycorrect",active:!1,finished:!0},mangrright:{name:"mangrright",class:"core-question-correct",status:"correct",active:!1,finished:!0},unknown:{name:"unknown",class:"core-question-unknown",status:"unknown",active:!0,finished:!1}},this.logger=e.getInstance("CoreQuestionProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return e.prototype.compareAllAnswers=function(e,t){var n=this.utils.mergeArraysWithoutDuplicates(Object.keys(e),Object.keys(t));for(var o in n){var r=n[o];if(!this.isExtraAnswer(r[0])&&!this.utils.sameAtKeyMissingIsBlank(e,t,r))return!1}return!0},e.prototype.convertAnswersArrayToObject=function(e,t){var n=this,o={};return e.forEach(function(e){if(t){var r=n.removeQuestionPrefix(e.name);o[r]=e.value}else o[e.name]=e.value}),o},e.prototype.getAnswer=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().getRecord(r.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t,name:n})})},e.prototype.getAttemptAnswers=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(o.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t})})},e.prototype.getAttemptQuestions=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(o.QUESTION_TABLE,{component:e,attemptid:t})})},e.prototype.getBasicAnswers=function(e){var t={};for(var n in e)this.isExtraAnswer(n)||(t[n]=e[n]);return t},e.prototype.getBasicAnswersFromArray=function(e){var t=this,n=[];return e.forEach(function(e){t.isExtraAnswer(e.name)&&n.push(e)}),n},e.prototype.getQuestion=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().getRecord(r.QUESTION_TABLE,{component:e,attemptid:t,slot:n})})},e.prototype.getQuestionAnswers=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.getDb().getRecords(i.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t,questionslot:n}).then(function(e){return o?i.getBasicAnswersFromArray(e):e})})},e.prototype.getQuestionSlotFromName=function(e){if(e){var t=e.match(this.QUESTION_PREFIX_REGEX);if(t&&t[1])return parseInt(t[1],10)}return-1},e.prototype.getState=function(e){return this.STATES[e||"unknown"]},e.prototype.isExtraAnswer=function(e){return"-"==(e=this.removeQuestionPrefix(e))[0]||":"==e[0]},e.prototype.removeAttemptAnswers=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().deleteRecords(o.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t})})},e.prototype.removeAttemptQuestions=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().deleteRecords(o.QUESTION_TABLE,{component:e,attemptid:t})})},e.prototype.removeAnswer=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().deleteRecords(r.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t,name:n})})},e.prototype.removeQuestion=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().deleteRecords(r.QUESTION_TABLE,{component:e,attemptid:t,slot:n})})},e.prototype.removeQuestionAnswers=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().deleteRecords(r.QUESTION_ANSWERS_TABLE,{component:e,attemptid:t,questionslot:n})})},e.prototype.removeQuestionPrefix=function(e){return e?e.replace(this.QUESTION_PREFIX_REGEX,""):""},e.prototype.saveAnswers=function(e,t,n,o,r,i,s){var a=this;return i=i||this.timeUtils.timestamp(),this.sitesProvider.getSite(s).then(function(s){var c=s.getDb(),u=[];for(var d in r){var l=r[d],f={component:e,componentid:t,attemptid:n,userid:o,questionslot:a.getQuestionSlotFromName(d),name:d,value:l,timemodified:i};u.push(c.insertRecord(a.QUESTION_ANSWERS_TABLE,f))}return Promise.all(u)})},e.prototype.saveQuestion=function(e,t,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){var c={component:e,componentid:t,attemptid:n,userid:o,number:r.number,slot:r.slot,state:i};return s.getDb().insertRecord(a.QUESTION_TABLE,c)})},e.COMPONENT="mmQuestion",e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1330),i=n(1331),s=n(1332),a=n(1333),c=n(1334),u=n(1335),d=n(1336),l=n(1337),f=n(1338),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=function(){function e(){}return e=p([Object(o.I)({declarations:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a],imports:[],exports:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a]})],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(5),r=(n.n(o),function(){function e(e,t,n,o,r,i,s){this.sitesProvider=n,this.appProvider=o,this.syncProvider=r,this.textUtils=i,this.translate=s,this.component="core",this.syncInterval=3e5,this.syncPromises={},this.logger=t.getInstance(e),this.component=e}return e.prototype.addOngoingSync=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getUniqueSyncId(e);return this.syncPromises[n]||(this.syncPromises[n]={}),this.syncPromises[n][r]=t,t.finally(function(){delete o.syncPromises[n][r]})},e.prototype.getOngoingSync=function(e,t){if(t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncing(e,t)){var n=this.getUniqueSyncId(e);return this.syncPromises[t][n]}},e.prototype.getReadableSyncTime=function(e,t){var n=this;return this.getSyncTime(e,t).then(function(e){return n.getReadableTimeFromTimestamp(e)})},e.prototype.getReadableTimeFromTimestamp=function(e){return e?o(e).format("LLL"):this.translate.instant("core.never")},e.prototype.getSyncTime=function(e,t){return this.syncProvider.getSyncRecord(this.component,e,t).then(function(e){return e.time}).catch(function(){return 0})},e.prototype.getSyncWarnings=function(e,t){var n=this;return this.syncProvider.getSyncRecord(this.component,e,t).then(function(e){return n.textUtils.parseJSON(e.warnings,[])}).catch(function(){return[]})},e.prototype.getUniqueSyncId=function(e){return this.component+"#"+e},e.prototype.isSyncing=function(e,t){t=t||this.sitesProvider.getCurrentSiteId();var n=this.getUniqueSyncId(e);return!(!this.syncPromises[t]||!this.syncPromises[t][n])},e.prototype.isSyncNeeded=function(e,t){var n=this;return this.getSyncTime(e,t).then(function(e){return Date.now()-n.syncInterval>=e})},e.prototype.setSyncTime=function(e,t,n){return n=void 0!==n?n:Date.now(),this.syncProvider.insertOrUpdateSyncRecord(this.component,e,{time:n},t)},e.prototype.setSyncWarnings=function(e,t,n){var o=JSON.stringify(t||[]);return this.syncProvider.insertOrUpdateSyncRecord(this.component,e,{warnings:o},n)},e.prototype.syncOnSites=function(e,t,n,o){if(!this.appProvider.isOnline())return this.logger.debug("Cannot sync '"+e+"' because device is offline."),Promise.reject(null);var r;return o?(this.logger.debug("Try to sync '"+e+"' in site '"+o+"'."),r=Promise.resolve([o])):(this.logger.debug("Try to sync '"+e+"' in all sites."),r=this.sitesProvider.getSitesIds()),n=n||[],r.then(function(e){var o=[];return e.forEach(function(e){o.push(t.apply(t,[e].concat(n)))}),Promise.all(o)})},e.prototype.waitForSync=function(e,t){var n=this.getOngoingSync(e,t);return n?n.catch(function(){}):Promise.resolve()},e}())},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(58),c=n(38),u=n(755),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i){var s=e.call(this,"CoreQuestionBehaviourDelegate",t,n,o)||this;return s.questionDelegate=r,s.defaultHandler=i,s.handlerNameProperty="type",s}return d(t,e),t.prototype.determineNewState=function(e,t,n,o,r){return e=this.questionDelegate.getBehaviourForQuestion(o,e),Promise.resolve(this.executeFunctionOnEnabled(e,"determineNewState",[t,n,o,r]))},t.prototype.handleQuestion=function(e,t,n){return t=this.questionDelegate.getBehaviourForQuestion(n,t),Promise.resolve(this.executeFunctionOnEnabled(t,"handleQuestion",[e,n]))},t.prototype.isBehaviourSupported=function(e){return this.hasHandler(e,!0)},t=l([Object(o.A)(),f("design:paramtypes",[r.a,s.a,i.a,c.a,u.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(9),c=n(105),u=n(12),d=n(79),l=n(7),f=n(2),p=n(118),h=n(8),m=n(11),g=n(47),y=n(6),v=n(50),b=n(72),_=n(30),P=n(109),O=(n.n(P),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p,h){this.sitesProvider=t,this.domUtils=n,this.wsProvider=o,this.translate=r,this.textUtils=i,this.eventsProvider=s,this.appProvider=a,this.utils=c,this.urlUtils=u,this.configProvider=d,this.platform=l,this.initDelegate=f,this.sitePluginsProvider=p,this.location=h,this.isSSOConfirmShown=!1,this.isOpenEditAlertShown=!1,this.waitingForBrowser=!1,this.logger=e.getInstance("CoreLoginHelper")}return e.prototype.acceptSitePolicy=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.write("core_user_agree_site_policy",{}).then(function(e){if(!e.status){if(e.warnings&&e.warnings.length){for(var t in e.warnings){if("alreadyagreed"==e.warnings[t].warningcode)return}return Promise.reject(e.warnings[0])}return Promise.reject(null)}})})},e.prototype.appLaunchedByURL=function(e){var t=this,n=b.a.customurlscheme+"://token=";if(-1==e.indexOf(n))return!1;if(this.appProvider.isSSOAuthenticationOngoing())return!0;this.appProvider.isDesktop()&&this.utils.closeInAppBrowser(!0),this.appProvider.startSSOAuthentication(),this.logger.debug("App launched by URL with an SSO"),e=(e=e.replace(n,"")).replace(/\/?#?\/?$/,"");try{e=atob(e)}catch(e){return this.logger.error("Error decoding parameter received for login SSO"),!1}var o,r;return this.initDelegate.ready().then(function(){return r=t.domUtils.showModalLoading("core.login.authenticating",!0),t.validateBrowserSSOLogin(e)}).then(function(e){return o=e,t.handleSSOLoginAuthentication(o.siteUrl,o.token,o.privateToken)}).then(function(){o.pageName?t.appProvider.getRootNavController().push(o.pageName,o.pageParams):t.goToSiteInitialPage()}).catch(function(e){e&&(t.domUtils.showErrorModal(e),t.sitesProvider.logout())}).finally(function(){r.dismiss(),t.appProvider.finishSSOAuthentication()}),!0},e.prototype.canRequestPasswordReset=function(e){return this.requestPasswordReset(e).then(function(){return!0}).catch(function(e){return 1==e.available||"invalidrecord"!=e.errorcode})},e.prototype.checkLogout=function(){var e=this.appProvider.getRootNavController();!this.appProvider.isSSOAuthenticationOngoing()&&this.sitesProvider.isLoggedIn()&&this.sitesProvider.getCurrentSite().isLoggedOut()&&"CoreLoginReconnectPage"==e.getActive().name&&this.sitesProvider.logout()},e.prototype.confirmAndOpenBrowserForSSOLogin=function(e,t,n,o){var r=this;(this.shouldShowSSOConfirm(t)?this.domUtils.showConfirm(this.translate.instant("core.login.logininsiterequired")):Promise.resolve()).then(function(){r.openBrowserForSSOLogin(e,t,n,o)}).catch(function(){})},e.prototype.formatProfileFieldsForSignup=function(e){if(!e)return[];var t={};return e.forEach(function(e){e.signup&&(t[e.categoryid]||(t[e.categoryid]={id:e.categoryid,name:e.categoryname,fields:[]}),t[e.categoryid].fields.push(e))}),Object.keys(t).map(function(e){return t[e]})},e.prototype.getErrorMessages=function(e,t,n,o,r,i,s,a){var c={};return e&&(c.required=c.requiredTrue=this.translate.instant(e)),t&&(c.email=this.translate.instant(t)),n&&(c.pattern=this.translate.instant(n)),o&&(c.url=this.translate.instant(o)),r&&(c.minlength=this.translate.instant(r)),i&&(c.maxlength=this.translate.instant(i)),s&&(c.min=this.translate.instant(s)),a&&(c.max=this.translate.instant(a)),c},e.prototype.getSitePolicy=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n=e.getStoredConfig("sitepolicy");return void 0!==n?n||Promise.reject(null):t.wsProvider.callAjax("auth_email_get_signup_settings",{},{siteUrl:e.getURL()}).then(function(e){return e.sitepolicy?e.sitepolicy:Promise.reject(null)})})},e.prototype.getFixedSites=function(){return b.a.siteurl},e.prototype.getValidIdentityProviders=function(e){var t=[],n=this.textUtils.concatenatePaths(e.wwwroot,"auth/oauth2/"),o=this.textUtils.concatenatePaths(e.httpswwwroot,"auth/oauth2/");return e.identityproviders&&e.identityproviders.length&&e.identityproviders.forEach(function(e){!e.url||-1==e.url.indexOf(o)&&-1==e.url.indexOf(n)||t.push(e)}),t},e.prototype.goToAddSite=function(e,t){var n,o;if(this.isFixedUrlSet()){n="CoreLoginIntroductionPage",o={siteUrl:"string"==typeof b.a.siteurl?b.a.siteurl:b.a.siteurl[0].url}}else n="CoreLoginSitePage",o={showKeyboard:t};return e?this.appProvider.getRootNavController().setRoot(n,o,{animate:!1}):this.appProvider.getRootNavController().push(n,o)},e.prototype.goToSiteInitialPage=function(){return this.location.replaceState(""),this.appProvider.getRootNavController().setRoot("CoreMainMenuPage")},e.prototype.handleSSOLoginAuthentication=function(e,t,n){var o=this;if(this.sitesProvider.isLoggedIn()){var r=this.sitesProvider.getCurrentSite().getInfo();return void 0!==r&&void 0!==r.username?this.sitesProvider.updateSiteToken(r.siteurl,r.username,t,n).then(function(){return o.sitesProvider.updateSiteInfoByUrl(r.siteurl,r.username)},function(){return Promise.reject(o.translate.instant("core.login.errorupdatesite"))}):Promise.reject(this.translate.instant("core.login.errorupdatesite"))}return this.sitesProvider.newSite(e,t,n)},e.prototype.hasSeveralFixedSites=function(){return b.a.siteurl&&Array.isArray(b.a.siteurl)&&b.a.siteurl.length>1},e.prototype.inAppBrowserLoadStart=function(e){if(e=e.replace(/^https?:\/\//,""),this.appLaunchedByURL(e))this.utils.closeInAppBrowser(!1);else if(this.platform.is("android")){var t=this.urlUtils.getUrlProtocol(e);t&&"file"!==t&&"cdvfile"!==t?(this.utils.openInBrowser(e),this.lastInAppUrl?this.utils.openInApp(this.lastInAppUrl):this.utils.closeInAppBrowser(!1)):this.lastInAppUrl=e}},e.prototype.isEmailSignupDisabled=function(e){var t=e&&e.tool_mobile_disabledfeatures;if(!t)return!1;t=this.textUtils.treatDisabledFeatures(t);var n=new RegExp("(,|^)CoreLoginEmailSignup(,|$)","g");return!!t.match(n)},e.prototype.isFixedUrlSet=function(){return Array.isArray(b.a.siteurl)?1==b.a.siteurl.length:!!b.a.siteurl},e.prototype.isSiteLoggedOut=function(e,t){var n=this.sitesProvider.getCurrentSite();return!!n&&(!!n.isLoggedOut()&&(this.eventsProvider.trigger(u.a.SESSION_EXPIRED,{pageName:e,params:t},n.getId()),!0))},e.prototype.isSSOEmbeddedBrowser=function(e){return!!this.appProvider.isLinux()||e==_.a.LOGIN_SSO_INAPP_CODE},e.prototype.isSSOLoginNeeded=function(e){return e==_.a.LOGIN_SSO_CODE||e==_.a.LOGIN_SSO_INAPP_CODE},e.prototype.loadSiteAndPage=function(e,t,n){var o=this;if(n==_.a.NO_SITE_ID)this.appProvider.getRootNavController().setRoot(e,t);else{var r=this.domUtils.showModalLoading();this.sitesProvider.loadSite(n).then(function(){o.isSiteLoggedOut(e,t)||o.loadPageInMainMenu(e,t)}).catch(function(){o.appProvider.getRootNavController().setRoot("CoreLoginSitesPage")}).finally(function(){r.dismiss()})}},e.prototype.loadPageInMainMenu=function(e,t){this.location.replaceState(""),this.appProvider.getRootNavController().setRoot("CoreMainMenuPage",{redirectPage:e,redirectParams:t})},e.prototype.openBrowserForOAuthLogin=function(e,t,n,o,r){if(n=n||e+"/admin/tool/mobile/launch.php",!t||!t.url)return!1;var i=this.sitesProvider.determineService(e),s=this.urlUtils.extractUrlParams(t.url),a=this.prepareForSSOLogin(e,i,n,o,r);return!!s.id&&(a+="&oauthsso="+s.id,this.appProvider.isLinux()?this.utils.openInApp(a):(this.utils.openInBrowser(a),navigator.app&&navigator.app.exitApp()),!0)},e.prototype.openBrowserForSSOLogin=function(e,t,n,o,r,i){var s=this.prepareForSSOLogin(e,n,o,r,i);if(this.isSSOEmbeddedBrowser(t)){var a={clearsessioncache:"yes",closebuttoncaption:this.translate.instant("core.login.cancel")};this.utils.openInApp(s,a)}else this.utils.openInBrowser(s),navigator.app&&navigator.app.exitApp()},e.prototype.openChangePassword=function(e,t){var n=this;this.domUtils.showAlert(this.translate.instant("core.notice"),t,void 0,3e3).then(function(t){t.onDidDismiss(function(){n.utils.openInApp(e+"/login/change_password.php")})})},e.prototype.openForgottenPassword=function(e){this.utils.openInApp(e+"/login/forgot_password.php")},e.prototype.openInAppForEdit=function(e,t,n,o){var r=this;if(e&&e===this.sitesProvider.getCurrentSiteId()){var i=this.sitesProvider.getCurrentSite(),s=i&&i.getURL();i&&s&&(this.isOpenEditAlertShown||this.waitingForBrowser||(this.isOpenEditAlertShown=!0,o&&i.invalidateWsCache(),n=this.translate.instant(n)+"<br>"+this.translate.instant("core.redirectingtosite"),i.openInAppWithAutoLogin(s+t,void 0,n).then(function(){r.waitingForBrowser=!0}).finally(function(){r.isOpenEditAlertShown=!1})))}},e.prototype.prepareForSSOLogin=function(e,t,n,o,r){t=t||b.a.wsextservice,n=n||e+"/local/mobile/launch.php";var i=1e3*Math.random(),s=n+"?service="+t;return s+="&passport="+i,s+="&urlscheme="+b.a.customurlscheme,this.configProvider.set(_.a.LOGIN_LAUNCH_DATA,JSON.stringify({siteUrl:e,passport:i,pageName:o||"",pageParams:r||{}})),s},e.prototype.redirect=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.isLoggedIn()?n&&n!=this.sitesProvider.getCurrentSiteId()?this.sitePluginsProvider.hasSitePluginsLoaded?(this.appProvider.storeRedirect(n,e,t),this.sitesProvider.logout()):this.sitesProvider.logout().then(function(){o.loadSiteAndPage(e,t,n)}):this.loadPageInMainMenu(e,t):n?this.loadSiteAndPage(e,t,n):this.appProvider.getRootNavController().setRoot("CoreLoginSitesPage")},e.prototype.requestPasswordReset=function(e,t,n){var o={};return t&&(o.username=t),n&&(o.email=n),this.wsProvider.callAjax("core_auth_request_password_reset",o,{siteUrl:e})},e.prototype.sessionExpired=function(e){var t=this,n=e&&e.siteId,o=this.sitesProvider.getCurrentSite(),r=o&&o.getURL();o&&r&&(n&&n!==o.getId()||this.sitesProvider.checkSite(r).then(function(r){if(r.warning&&t.domUtils.showErrorModal(r.warning,!0,4e3),t.isSSOLoginNeeded(r.code))t.appProvider.isSSOAuthenticationOngoing()||t.isSSOConfirmShown||t.waitingForBrowser||(t.isSSOConfirmShown=!0,(t.shouldShowSSOConfirm(r.code)?t.domUtils.showConfirm(t.translate.instant("core.login."+(o.isLoggedOut()?"loggedoutssodescription":"reconnectssodescription"))):Promise.resolve()).then(function(){t.waitingForBrowser=!0,t.openBrowserForSSOLogin(r.siteUrl,r.code,r.service,r.config&&r.config.launchurl,e.pageName,e.params)}).catch(function(){t.sitesProvider.logout()}).finally(function(){t.isSSOConfirmShown=!1}));else{var i=o.getInfo();if(void 0!==i&&void 0!==i.username){var s=t.appProvider.getRootNavController(),a=s.getActive();if(a&&a.component&&"CoreLoginReconnectPage"==a.component.name)return;s.setRoot("CoreLoginReconnectPage",{infoSiteUrl:i.siteurl,siteUrl:r.siteUrl,siteId:n,pageName:e.pageName,pageParams:e.params,siteConfig:r.config})}}}).catch(function(e){o.isLoggedOut()&&(t.domUtils.showErrorModalDefault(e,"core.networkerrormsg",!0),t.sitesProvider.logout())}))},e.prototype.shouldShowSSOConfirm=function(e){return!(this.isSSOEmbeddedBrowser(e)||b.a.skipssoconfirmation&&"false"!==String(b.a.skipssoconfirmation))},e.prototype.sitePolicyNotAgreed=function(e){if((e=e||this.sitesProvider.getCurrentSiteId())&&e==this.sitesProvider.getCurrentSiteId()&&this.sitesProvider.wsAvailableInCurrentSite("core_user_agree_site_policy")){var t=this.appProvider.getRootNavController(),n=t.getActive();n&&n.component&&"CoreLoginSitePolicyPage"==n.component.name||t.setRoot("CoreLoginSitePolicyPage",{siteId:e})}},e.prototype.treatUserTokenError=function(e,t){"forcepasswordchangenotice"==t.errorcode?this.openChangePassword(e,t.error||t.message||t.body||t.content):this.domUtils.showErrorModal(t)},e.prototype.validateBrowserSSOLogin=function(e){var t=this,n=e.split(":::");return this.configProvider.get(_.a.LOGIN_LAUNCH_DATA).then(function(e){if(null===(e=t.textUtils.parseJSON(e,null)))return Promise.reject(null);var o=e.passport,r=e.siteUrl;t.configProvider.delete(_.a.LOGIN_LAUNCH_DATA);var i=P.Md5.hashAsciiStr(r+o);return i!=n[0]&&(r=-1!=r.indexOf("https://")?r.replace("https://","http://"):r.replace("http://","https://"),i=P.Md5.hashAsciiStr(r+o)),i==n[0]?(t.logger.debug("Signature validated"),{siteUrl:r,token:n[1],privateToken:n[2],pageName:e.pageName,pageParams:e.pageParams}):(t.logger.debug("Invalid signature in the URL request yours: "+n[0]+" mine: "+i+" for passport "+o),Promise.reject(t.translate.instant("core.unexpectederror")))})},e=O([Object(o.A)(),w("design:paramtypes",[l.a,f.a,h.a,p.a,s.c,m.a,u.a,a.a,y.a,g.a,c.a,i.s,d.a,v.a,r.e])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){}return e.app_id="com.moodle.moodlemobile",e.appname="FE ATS",e.desktopappname="Moodle Desktop",e.versioncode=3501,e.versionname="3.5.0",e.cache_expiration_time=3e5,e.default_lang="vi",e.languages={ar:"عربي",bg:"Български",ca:"Català",cs:"Čeština",da:"Dansk",de:"Deutsch","de-du":"Deutsch - Du",el:"Ελληνικά",en:"English",es:"Español","es-mx":"Español - México",eu:"Euskara",fa:"فارسی",fi:"Suomi",fr:"Français",he:"עברית",hu:"magyar",it:"Italiano",ja:"日本語",ko:"한국어",lt:"Lietuvių",mr:"मराठी",nl:"Nederlands",pl:"Polski","pt-br":"Português - Brasil",pt:"Português - Portugal",ro:"Română",ru:"Русский","sr-cr":"Српски","sr-lt":"Srpski",sv:"Svenska",tr:"Türkçe",uk:"Українська","zh-cn":"简体中文","zh-tw":"正體中文",vi:"tiếngViệt"},e.wsservice="moodle_mobile_app",e.wsextservice="local_mobile",e.demo_sites={student:{url:"https://school.demo.moodle.net",username:"student",password:"moodle"},teacher:{url:"https://school.demo.moodle.net",username:"teacher",password:"moodle"}},e.gcmpn="694767596569",e.customurlscheme="moodlemobile",e.siteurl="https://training.fecredit.com.vn/",e.multisitesdisplay="",e.skipssoconfirmation=!1,e.forcedefaultlanguage=!1,e.privacypolicy="https://moodle.org/mod/page/view.php?id=8148",e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(1),i=n(18),s=n(2),a=n(8),c=n(11),u=n(47),d=n(6),l=n(65),f=n(38),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,o,r,i,s,a,c){this.domUtils=e,this.textUtils=t,this.questionProvider=n,this.sitesProvider=o,this.translate=r,this.urlUtils=i,this.utils=s,this.filepoolProvider=a,this.questionDelegate=c,this.lastErrorShown=0,this.div=document.createElement("div")}return e.prototype.addBehaviourButton=function(e,t){t&&e&&(e.behaviourButtons||(e.behaviourButtons=[]),e.behaviourButtons.push({id:t.id,name:t.name,value:t.value,disabled:t.disabled}))},e.prototype.extractQbehaviourButtons=function(e,t){var n=this;t=t||'.im-controls input[type="submit"]',this.div.innerHTML=e.html;Array.from(this.div.querySelectorAll(t)).forEach(function(t){n.addBehaviourButton(e,t)}),e.html=this.div.innerHTML},e.prototype.extractQbehaviourCBM=function(e){var t=this;this.div.innerHTML=e.html;var n=Array.from(this.div.querySelectorAll('.im-controls .certaintychoices label[for*="certainty"]'));return e.behaviourCertaintyOptions=[],n.forEach(function(n){var o=n.querySelector('input[type="radio"]');o&&(e.behaviourCertaintyOptions.push({id:o.id,name:o.name,value:o.value,text:t.textUtils.cleanTags(n.innerHTML),disabled:o.disabled}),o.checked&&(e.behaviourCertaintySelected=o.value))}),e.localAnswers&&void 0!==e.localAnswers["-certainty"]&&(e.behaviourCertaintySelected=e.localAnswers["-certainty"]),n.length>0},e.prototype.extractQbehaviourRedoButton=function(e){var t='input[type="submit"][name*=redoslot], input[type="submit"][name*=tryagain]';if(!this.searchBehaviourButton(e,"html",".outcome "+t)){if(e.feedbackHtml&&this.searchBehaviourButton(e,"feedbackHtml",t))return;e.infoHtml&&this.searchBehaviourButton(e,"infoHtml",t)}},e.prototype.extractQbehaviourSeenInput=function(e){this.div.innerHTML=e.html;var t=this.div.querySelector('input[type="hidden"][name*=seen]');return!!t&&(e.behaviourSeenInput={name:t.name,value:t.value},t.parentElement.removeChild(t),e.html=this.div.innerHTML,!0)},e.prototype.extractQuestionComment=function(e){this.extractQuestionLastElementNotInContent(e,".comment","commentHtml")},e.prototype.extractQuestionFeedback=function(e){this.extractQuestionLastElementNotInContent(e,".outcome","feedbackHtml")},e.prototype.extractQuestionInfoBox=function(e,t){this.extractQuestionLastElementNotInContent(e,t,"infoHtml")},e.prototype.extractQuestionLastElementNotInContent=function(e,t,n){this.div.innerHTML=e.html;for(var o=Array.from(this.div.querySelectorAll(t)),r=o.pop();r;){if(!this.domUtils.closest(r,".formulation"))return e[n]=r.innerHTML,r.parentElement.removeChild(r),void(e.html=this.div.innerHTML);r=o.pop()}},e.prototype.extractQuestionScripts=function(e){var t=this;if(e.scriptsCode="",e.initObjects=[],e.html){var n=e.html.match(/<script[^>]*>[\s\S]*?<\/script>/gm);if(!n)return;n.forEach(function(n){e.scriptsCode+=n,e.html=e.html.replace(n,"");var o=n.match(new RegExp("M.qtype_"+e.type+".init_question\\(.*?}\\);","mg"));if(o){var r=o.pop();r=(r=r.replace("M.qtype_"+e.type+".init_question(","")).substr(0,r.length-2),e.initObjects=t.textUtils.parseJSON(r)}})}},e.prototype.getAllInputNamesFromHtml=function(e){var t=this,n=document.createElement("form"),o={};return n.innerHTML=e,Array.from(n.elements).forEach(function(e){var n=e.name||"";n&&!n.match(/_:flagged$/)&&"submit"!=e.type&&"BUTTON"!=e.tagName&&(o[t.questionProvider.removeQuestionPrefix(n)]=!0)}),o},e.prototype.getAnswersFromForm=function(e){if(!e||!e.elements)return{};var t={};return Array.from(e.elements).forEach(function(e){var n=e.name||e.getAttribute("ng-reflect-name")||"";n&&!n.match(/_:flagged$/)&&"submit"!=e.type&&"BUTTON"!=e.tagName&&("checkbox"==e.type?t[n]=!!e.checked:"radio"==e.type?e.checked&&(t[n]=e.value):t[n]=e.value)}),t},e.prototype.getQuestionAttachmentsFromHtml=function(e){var t=this;this.div.innerHTML=e,this.domUtils.removeElement(this.div,"div[id*=filemanager]");var n=[];return Array.from(this.div.querySelectorAll("a")).forEach(function(e){var o=e.innerHTML;e.href&&o&&(o=t.textUtils.cleanTags(o,!0).trim(),n.push({filename:o,fileurl:e.href}))}),n},e.prototype.getQuestionSequenceCheckFromHtml=function(e){if(e){this.div.innerHTML=e;var t=this.div.querySelector("input[name*=sequencecheck]");if(t&&void 0!==t.name&&void 0!==t.value)return{name:t.name,value:t.value}}},e.prototype.getQuestionStateClass=function(e){var t=this.questionProvider.getState(e);return t?t.class:""},e.prototype.getValidationErrorFromHtml=function(e){return this.div.innerHTML=e,this.domUtils.getContentsOfElement(this.div,".validationerror")},e.prototype.hasDraftFileUrls=function(e){var t=this.sitesProvider.getCurrentSite().getURL();return"/"!=t.slice(-1)&&(t=t+="/"),t+="draftfile.php",-1!=e.indexOf(t)},e.prototype.loadLocalAnswersInHtml=function(e){var t=this,n=document.createElement("form");n.innerHTML=e.html,Array.from(n.elements).forEach(function(n){var o=n.name||"";if(o&&!o.match(/_:flagged$/)&&"submit"!=n.type&&"BUTTON"!=n.tagName&&(o=t.questionProvider.removeQuestionPrefix(o),e.localAnswers&&void 0!==e.localAnswers[o]))if("TEXTAREA"==n.tagName)n.innerHTML=e.localAnswers[o];else if("SELECT"==n.tagName){var r=n.querySelector('option[value="'+e.localAnswers[o]+'"]');r&&r.setAttribute("selected","selected")}else"radio"==n.type||"checkbox"==n.type?n.value==e.localAnswers[o]&&n.setAttribute("checked","checked"):n.setAttribute("value",e.localAnswers[o])}),e.html=n.innerHTML},e.prototype.prefetchQuestionFiles=function(e,t,n,o){var r=this,i=this.domUtils.extractDownloadableFilesFromHtml(e.html);return t||(t=l.a.COMPONENT,n=e.id),this.sitesProvider.getSite(o).then(function(e){var s=[];return i.forEach(function(i){!e.canDownloadFiles()&&r.urlUtils.isPluginFileUrl(i)||i.indexOf("theme/image.php")>-1&&i.indexOf("flagged")>-1||s.push(r.filepoolProvider.addToQueueByUrl(o,i,t,n))}),Promise.all(s)})},e.prototype.prepareAnswers=function(e,t,n,o){var r=this,i=[];return e.forEach(function(e){i.push(r.questionDelegate.prepareAnswersForQuestion(e,t,n,o))}),this.utils.allPromises(i).then(function(){return t})},e.prototype.replaceCorrectnessClasses=function(e){this.domUtils.replaceClassesInElement(e,{correct:"core-question-answer-correct",incorrect:"core-question-answer-incorrect"})},e.prototype.replaceFeedbackClasses=function(e){this.domUtils.replaceClassesInElement(e,{outcome:"core-question-feedback-container core-question-feedback-padding",specificfeedback:"core-question-feedback-container core-question-feedback-inline"})},e.prototype.searchBehaviourButton=function(e,t,n){this.div.innerHTML=e[t];var o=this.div.querySelector(n);return!!o&&(this.addBehaviourButton(e,o),o.parentElement.removeChild(o),e[t]=this.div.innerHTML,!0)},e.prototype.showComponentError=function(e,t){var n=Date.now();n-this.lastErrorShown>500&&(this.lastErrorShown=n,this.domUtils.showErrorModalDefault(t,"addon.mod_quiz.errorparsequestions",!0)),e&&e.emit()},e.prototype.treatCorrectnessIcons=function(e){Array.from(e.querySelectorAll("img.icon, img.questioncorrectnessicon")).forEach(function(e){if(e.src){var t=document.createElement("i");if(e.src.indexOf("incorrect")>-1)t.className="icon fa fa-remove text-danger fa-fw questioncorrectnessicon";else{if(!(e.src.indexOf("correct")>-1))return;t.className="icon fa fa-check text-success fa-fw questioncorrectnessicon"}t.title=e.title,t.ariaLabel=e.title,e.parentNode.replaceChild(t,e)}});Array.from(e.querySelectorAll(".feedbackspan.accesshide")).forEach(function(e){var t=e.previousSibling;t&&(t.classList.contains("icon")||t.classList.contains("questioncorrectnessicon"))&&(t.classList.add("questioncorrectnessicon"),e.innerHTML&&t.setAttribute("tappable",""))})},e.prototype.treatCorrectnessIconsClicks=function(e,t,n){var o=this,r=Array.from(e.querySelectorAll("i.icon.questioncorrectnessicon[tappable]")),i=this.translate.instant("core.question.feedback");r.forEach(function(e){var r=e.parentElement.querySelector(".feedbackspan.accesshide");r&&e.addEventListener("click",function(e){o.textUtils.expandText(i,r.innerHTML,t,n)})})},e=p([Object(o.A)(),h("design:paramtypes",[a.a,c.a,l.a,s.a,r.c,u.a,d.a,i.a,f.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(6),c=n(58),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,"AddonModQuizAccessRulesDelegate",t,n,o)||this;return i.utils=r,i.handlerNameProperty="ruleName",i}return u(t,e),t.prototype.getAccessRuleHandler=function(e){return this.getHandler(e,!0)},t.prototype.getFixedPreflightData=function(e,t,n,o,r,i){var s=this,a=[];return(e=e||[]).forEach(function(e){a.push(Promise.resolve(s.executeFunctionOnEnabled(e,"getFixedPreflightData",[t,n,o,r,i])))}),this.utils.allPromises(a).catch(function(){})},t.prototype.getPreflightComponent=function(e,t){return Promise.resolve(this.executeFunctionOnEnabled(e,"getPreflightComponent",[t]))},t.prototype.isAccessRuleSupported=function(e){return this.hasHandler(e,!0)},t.prototype.isPreflightCheckRequired=function(e,t,n,o,r){var i=this,s=[],a=!1;return(e=e||[]).forEach(function(e){s.push(i.isPreflightCheckRequiredForRule(e,t,n,o,r).then(function(e){e&&(a=!0)}))}),this.utils.allPromises(s).then(function(){return a}).catch(function(){return a})},t.prototype.isPreflightCheckRequiredForRule=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(e,"isPreflightCheckRequired",[t,n,o,r]))},t.prototype.notifyPreflightCheckPassed=function(e,t,n,o,r,i){var s=this,a=[];return(e=e||[]).forEach(function(e){a.push(Promise.resolve(s.executeFunctionOnEnabled(e,"notifyPreflightCheckPassed",[t,n,o,r,i])))}),this.utils.allPromises(a).catch(function(){})},t.prototype.notifyPreflightCheckFailed=function(e,t,n,o,r,i){var s=this,a=[];return(e=e||[]).forEach(function(e){a.push(Promise.resolve(s.executeFunctionOnEnabled(e,"notifyPreflightCheckFailed",[t,n,o,r,i])))}),this.utils.allPromises(a).catch(function(){})},t.prototype.shouldShowTimeLeft=function(e,t,n,o){e=e||[];for(var r in e){if(this.executeFunctionOnEnabled(e[r],"shouldShowTimeLeft",[t,n,o]))return!0}return!1},t=d([Object(o.A)(),l("design:paramtypes",[r.a,s.a,i.a,a.a])],t)}(c.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(2),i=n(10),s=n(36),a=n(12),c=n(134),u=n(9),d=n(145),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n){var d=e.call(this,t)||this;d.content=n,d.sitesProvider=t.get(r.a),d.courseProvider=t.get(i.a),d.appProvider=t.get(u.a),d.eventsProvider=t.get(a.a),d.modulePrefetchDelegate=t.get(s.a);var l=t.get(c.a),f=t.get(o.M);return d.onlineObserver=l.onchange().subscribe(function(e){f.run(function(){d.isOnline=e})}),d}return l(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.hasOffline=!1,this.syncIcon="spinner",this.siteId=this.sitesProvider.getCurrentSiteId(),this.moduleName=this.courseProvider.translateModuleName(this.moduleName),this.syncEventName&&(this.syncObserver=this.eventsProvider.on(this.syncEventName,function(e){t.autoSyncEventReceived(e)},this.siteId))},t.prototype.isRefreshSyncNeeded=function(e){return!1},t.prototype.autoSyncEventReceived=function(e){this.isRefreshSyncNeeded(e)&&this.showLoadingAndRefresh(!1)},t.prototype.refreshContent=function(e,t){var n=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),this.refreshIcon="spinner",this.syncIcon="spinner",this.invalidateContent().catch(function(){}).then(function(){return n.loadContent(!0,e,t)}).finally(function(){n.refreshIcon="refresh",n.syncIcon="sync"})},t.prototype.showLoadingAndFetch=function(e,t){var n=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),this.refreshIcon="spinner",this.syncIcon="spinner",this.loaded=!1,this.content&&this.content.scrollToTop(),this.loadContent(!1,e,t).finally(function(){n.refreshIcon="refresh",n.syncIcon="sync"})},t.prototype.showLoadingAndRefresh=function(e,t){return void 0===e&&(e=!1),void 0===t&&(t=!1),this.refreshIcon="spinner",this.syncIcon="spinner",this.loaded=!1,this.content&&this.content.scrollToTop(),this.refreshContent(e,t)},t.prototype.fetchContent=function(e,t,n){return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),Promise.resolve()},t.prototype.loadContent=function(e,t,n){var o=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.isOnline=this.appProvider.isOnline(),this.fetchContent(e,t,n).catch(function(n){if(!e)return o.refreshContent(t);o.domUtils.showErrorModalDefault(n,o.fetchContentDefaultError,!0)}).finally(function(){o.loaded=!0,o.refreshIcon="refresh",o.syncIcon="sync"})},t.prototype.showStatus=function(e,t){},t.prototype.setStatusListener=function(){var e=this;void 0===this.statusObserver&&(this.statusObserver=this.eventsProvider.on(a.a.PACKAGE_STATUS_CHANGED,function(t){if(t.componentId===e.module.id&&t.component===e.component){var n=e.currentStatus;e.currentStatus=t.status,e.showStatus(e.currentStatus,n)}},this.siteId),this.modulePrefetchDelegate.getModuleStatus(this.module,this.courseId).then(function(t){e.currentStatus=t,e.showStatus(t)}))},t.prototype.sync=function(){return Promise.resolve(!0)},t.prototype.hasSyncSucceed=function(e){return!0},t.prototype.syncActivity=function(e){var t=this;return void 0===e&&(e=!1),this.sync().then(function(e){return e.warnings&&e.warnings.length&&t.domUtils.showErrorModal(e.warnings[0]),t.hasSyncSucceed(e)}).catch(function(n){return e&&t.domUtils.showErrorModalDefault(n,"core.errorsync",!0),!1})},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.onlineObserver&&this.onlineObserver.unsubscribe(),this.syncObserver&&this.syncObserver.off(),this.statusObserver&&this.statusObserver.off()},f([Object(o.D)(),p("design:type",Number)],t.prototype,"group",void 0),t}(d.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(30),r=n(740),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t.prototype.download=function(e,t,n){return this.prefetch(e,t,!1,n)},t.prototype.prefetch=function(e,t,n,o){return Promise.resolve()},t.prototype.prefetchPackage=function(e,t,n,o,r){for(var i=this,s=[],a=5;a<arguments.length;a++)s[a-5]=arguments[a];if(r=r||this.sitesProvider.getCurrentSiteId(),!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.networkerrormsg"));if(this.isDownloading(e.id,r))return this.getOngoingDownload(e.id,r);var c=this.setDownloading(e.id,r).then(function(){return o.apply(o,[e,t,n,r].concat(s))}).then(function(t){return"string"!=typeof t&&(t=""),i.setDownloaded(e.id,r,t)}).catch(function(t){return i.setPreviousStatusAndReject(e.id,t,r)});return this.addOngoingDownload(e.id,c,r)},t.prototype.setDownloaded=function(e,t,n){return t=t||this.sitesProvider.getCurrentSiteId(),this.filepoolProvider.storePackageStatus(t,o.a.DOWNLOADED,this.component,e,n)},t.prototype.setDownloading=function(e,t){return t=t||this.sitesProvider.getCurrentSiteId(),this.filepoolProvider.storePackageStatus(t,o.a.DOWNLOADING,this.component,e)},t.prototype.setPreviousStatusAndReject=function(e,t,n){return n=n||this.sitesProvider.getCurrentSiteId(),this.filepoolProvider.setPackagePreviousStatus(n,this.component,e).then(function(){return Promise.reject(t)})},t}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(154),i=n(7),s=n(1),a=n(11),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){var r=this;this.translate=n,this.textUtils=o,this.extToMime={},this.mimeToExt={},this.groupsMimeInfo={},this.extensionRegex=/^[a-z0-9]+$/,this.logger=t.getInstance("CoreMimetypeUtilsProvider"),e.get("assets/exttomime.json").subscribe(function(e){r.extToMime=e},function(e){}),e.get("assets/mimetoext.json").subscribe(function(e){r.mimeToExt=e},function(e){})}return e.prototype.canBeEmbedded=function(e){return this.isExtensionInGroup(e,["web_image","web_video","web_audio"])},e.prototype.cleanExtension=function(e){if(!e)return e;var t=e.indexOf("?");return t>-1&&(e=e.substr(0,t)),(e=e.replace(/_.{32}$/,""))&&"."==e[0]&&(e=e.substr(1)),e},e.prototype.fillGroupMimeInfo=function(e){var t={},n=[];for(var o in this.extToMime){var r=this.extToMime[o];r.type&&r.groups&&-1!=r.groups.indexOf(e)&&(t[r.type]=!0,n.push(o))}this.groupsMimeInfo[e]={mimetypes:Object.keys(t),extensions:n}},e.prototype.getExtension=function(e,t){if(e=e||"","application/x-forcedownload"==(e=e.split(";")[0])||"application/forcedownload"==e)return this.guessExtensionFromUrl(t);var n=this.mimeToExt[e];if(n&&n.length){if(n.length>1&&t){var o=this.guessExtensionFromUrl(t);if(-1!=n.indexOf(o))return o}return n[0]}},e.prototype.getExtensionType=function(e){if(e=this.cleanExtension(e),this.extToMime[e]&&this.extToMime[e].string)return this.extToMime[e].string},e.prototype.getExtensions=function(e){return e=e||"",e=e.split(";")[0],this.mimeToExt[e]||[]},e.prototype.getFileIcon=function(e){var t=this.getFileExtension(e),n="unknown";if(t&&this.extToMime[t])if(this.extToMime[t].icon)n=this.extToMime[t].icon;else{var o=this.extToMime[t].type.split("/")[0];"video"!=o&&"text"!=o&&"image"!=o&&"document"!=o&&"audio"!=o||(n=o)}return"assets/img/files/"+n+"-64.png"},e.prototype.getFolderIcon=function(){return"assets/img/files/folder-64.png"},e.prototype.guessExtensionFromUrl=function(e){var t,n,o,r=e.split(".");if(r.length>1&&((o=(t=r.pop().toLowerCase()).indexOf("?"))>-1&&(t=t.substr(0,o)),this.extensionRegex.test(t)&&(n=t)),!n||void 0!==this.getMimeType(n))return n;this.logger.warn("Guess file extension: Not valid extension "+n)},e.prototype.getFileExtension=function(e){var t,n=e.lastIndexOf(".");if(!(n>-1&&(t=e.substr(n+1).toLowerCase(),t=this.cleanExtension(t),void 0===this.getMimeType(t))))return t;this.logger.warn("Get file extension: Not valid extension "+t)},e.prototype.getGroupMimeInfo=function(e,t){return void 0===this.groupsMimeInfo[e]&&this.fillGroupMimeInfo(e),t?this.groupsMimeInfo[e][t]:this.groupsMimeInfo[e]},e.prototype.getMimeType=function(e){if(e=this.cleanExtension(e),this.extToMime[e]&&this.extToMime[e].type)return this.extToMime[e].type},e.prototype.getMimetypeDescription=function(e,t){var n="assets.mimetypes.",o="",r="",i="";if("object"==typeof e&&"function"==typeof e.file?o=e.name:"object"==typeof e?(o=e.filename||"",r=e.mimetype||""):r=e,o&&(i=this.getFileExtension(o),r||(r=this.getMimeType(i))),!r)return"";i||(i=this.getExtension(r));var s=this.getMimetypeType(r)||"",a=r.split("/"),c={mimetype:r,ext:i||"",mimetype1:a[0],mimetype2:a[1]||""},u={};for(var d in c){var l=c[d];u[d]=l,u[d.toUpperCase()]=l.toUpperCase(),u[this.textUtils.ucFirst(d)]=this.textUtils.ucFirst(l)}var f=r.replace(/\+/g,"_"),p=s.replace(/\+/g,"_"),h=this.translate.instant(n+f,{$a:u}),m=this.translate.instant(n+p,{$a:u}),g=this.translate.instant(n+"default",{$a:u}),y=r;return h!=n+f?y=h:m!=n+p?y=m:g!=n+"default"&&(y=g),t&&(y=this.textUtils.ucFirst(y)),y},e.prototype.getMimetypeType=function(e){e=e.split(";")[0];var t=this.mimeToExt[e];if(t)for(var n=0;n<t.length;n++){var o=t[n];if(this.extToMime[o]&&this.extToMime[o].string)return this.extToMime[o].string}},e.prototype.getTranslatedGroupName=function(e){var t="assets.mimetypes.group:"+e,n=this.translate.instant(t);return n!=t?n:e},e.prototype.isExtensionInGroup=function(e,t){if(e=this.cleanExtension(e),t&&t.length&&this.extToMime[e]&&this.extToMime[e].groups)for(var n=0;n<this.extToMime[e].groups.length;n++){if(-1!=t.indexOf(this.extToMime[e].groups[n]))return!0}return!1},e.prototype.removeExtension=function(e){var t,n=e.lastIndexOf(".");return n>-1&&(t=e.substr(n+1),void 0!==this.getMimeType(t))?e.substr(0,n):e},e=c([Object(o.A)(),u("design:paramtypes",[r.b,i.a,s.c,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(4),i=n(224),s=n(1),a=n(9),c=n(105),u=n(12),d=n(7),l=n(11),f=n(6),p=n(30),h=n(96),m=(n.n(h),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(){function e(e,t,n,o,r,i,s,a,c,d){var l=this;this.localNotifications=t,this.platform=n,this.appProvider=o,this.utils=r,this.configProvider=i,this.textUtils=s,this.translate=a,this.alertCtrl=c,this.SITES_TABLE="notification_sites",this.COMPONENTS_TABLE="notification_components",this.TRIGGERED_TABLE="notifications_triggered",this.tablesSchema=[{name:this.SITES_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"code",type:"INTEGER",notNull:!0}]},{name:this.COMPONENTS_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"code",type:"INTEGER",notNull:!0}]},{name:this.TRIGGERED_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"at",type:"INTEGER",notNull:!0}]}],this.codes={},this.codeRequestsQueue={},this.observables={},this.currentNotification={title:"",texts:[],ids:[],timeouts:[]},this.logger=e.getInstance("CoreLocalNotificationsProvider"),this.appDB=o.getDB(),this.appDB.createTablesFromSchema(this.tablesSchema),t.on("trigger",function(e,t){l.trigger(e)}),t.on("click",function(e,t){if(e&&e.data){l.logger.debug("Notification clicked: ",e.data);var n=s.parseJSON(e.data);l.notifyClick(n)}}),d.on(u.a.SITE_DELETED,function(e){e&&l.cancelSiteNotifications(e.id)})}return e.prototype.cancel=function(e,t,n){var o=this;return this.getUniqueNotificationId(e,t,n).then(function(e){return o.localNotifications.cancel(e)})},e.prototype.cancelSiteNotifications=function(e){var t=this;return this.isAvailable()?e?this.localNotifications.getAllScheduled().then(function(n){var o=[];return n.forEach(function(n){"string"==typeof n.data&&(n.data=t.textUtils.parseJSON(n.data)),"object"==typeof n.data&&n.data.siteId===e&&o.push(n.id)}),t.localNotifications.cancel(o)}):Promise.reject(null):Promise.resolve()},e.prototype.getCode=function(e,t){var n=this,o=e+"#"+t;return void 0!==this.codes[o]?Promise.resolve(this.codes[o]):this.appDB.getRecord(e,{id:t}).then(function(e){return n.codes[o]=e.code,e.code}).catch(function(){return n.appDB.getRecords(e,void 0,"code DESC").then(function(r){var i=0;return r.length>0&&(i=r[0].code+1),n.appDB.insertRecord(e,{id:t,code:i}).then(function(){return n.codes[o]=i,i})})})},e.prototype.getComponentCode=function(e){return this.requestCode(this.COMPONENTS_TABLE,e)},e.prototype.getSiteCode=function(e){return this.requestCode(this.SITES_TABLE,e)},e.prototype.getUniqueNotificationId=function(e,t,n){var o=this;return n&&t?this.getSiteCode(n).then(function(n){return o.getComponentCode(t).then(function(t){return(1e8*n+1e7*t+e)%2147483647})}):Promise.reject(null)},e.prototype.isAvailable=function(){var e=window;return this.appProvider.isDesktop()||!!(e.plugin&&e.plugin.notification&&e.plugin.notification.local)},e.prototype.isTriggered=function(e){return this.appDB.getRecord(this.TRIGGERED_TABLE,{id:e.id}).then(function(t){return t.at===e.at.getTime()/1e3}).catch(function(){return!1})},e.prototype.notifyClick=function(e){var t=e.component;t&&this.observables[t]&&this.observables[t].next(e)},e.prototype.processNextRequest=function(){var e,t=this,n=Object.keys(this.codeRequestsQueue)[0];void 0!==n&&("object"==typeof(e=this.codeRequestsQueue[n])&&void 0!==e.table&&void 0!==e.id?this.getCode(e.table,e.id).then(function(t){e.promises.forEach(function(e){e.resolve(t)})}).catch(function(t){e.promises.forEach(function(e){e.reject(t)})}):Promise.resolve()).finally(function(){delete t.codeRequestsQueue[n],t.processNextRequest()})},e.prototype.registerClick=function(e,t){var n=this;return this.logger.debug("Register observer '"+e+"' for notification click."),void 0===this.observables[e]&&(this.observables[e]=new h.Subject),this.observables[e].subscribe(t),{off:function(){n.observables[e].unsubscribe(t)}}},e.prototype.removeTriggered=function(e){return this.appDB.deleteRecords(this.TRIGGERED_TABLE,{id:e})},e.prototype.requestCode=function(e,t){var n=this.utils.promiseDefer(),o=e+"#"+t,r=0==Object.keys(this.codeRequestsQueue).length;return void 0!==this.codeRequestsQueue[o]?this.codeRequestsQueue[o].promises.push(n):this.codeRequestsQueue[o]={table:e,id:t,promises:[n]},r&&this.processNextRequest(),n.promise},e.prototype.rescheduleAll=function(){var e=this;return this.localNotifications.getAllScheduled().then(function(t){var n=[];return t.forEach(function(t){t.at=new Date(1e3*t.at),t.data=t.data?e.textUtils.parseJSON(t.data,{}):{},n.push(e.scheduleNotification(t))}),Promise.all(n)})},e.prototype.schedule=function(e,t,n){var o=this;return this.getUniqueNotificationId(e.id,t,n).then(function(r){return e.id=r,e.data=e.data||{},e.data.component=t,e.data.siteId=n,o.platform.is("android")&&(e.icon=e.icon||"res://icon",e.smallIcon=e.smallIcon||"res://icon",e.led=e.led||"FF9900",e.ledOnTime=e.ledOnTime||1e3,e.ledOffTime=e.ledOffTime||1e3),o.scheduleNotification(e)})},e.prototype.scheduleNotification=function(e){var t=this;return this.isTriggered(e).then(function(n){if(!n)return t.configProvider.get(p.a.SETTINGS_NOTIFICATION_SOUND,!0).then(function(n){n?delete e.sound:e.sound=null,t.removeTriggered(e.id),t.localNotifications.schedule(e)})})},e.prototype.showNotificationPopover=function(e){var t=this;if(e&&e.title&&e.text){var n=function(e){if(void 0===e&&(e=!1),!e&&t.alertNotification&&t.currentNotification.ids.length>1){t.currentNotification.texts.shift(),t.currentNotification.ids.shift(),clearTimeout(t.currentNotification.timeouts.shift());var n="<p>"+t.currentNotification.texts.join("</p><p>")+"</p>";t.alertNotification.setMessage(n)}else t.alertNotification&&!e&&t.alertNotification.dismiss(),t.alertNotification=null,t.currentNotification.title="",t.currentNotification.texts=[],t.currentNotification.ids=[],t.currentNotification.timeouts.forEach(function(e){clearTimeout(e)}),t.currentNotification.timeouts=[]};if(this.alertNotification&&this.currentNotification.title==e.title){if(-1!=this.currentNotification.ids.indexOf(e.id))return;this.currentNotification.texts.push(e.text),this.currentNotification.ids.push(e.id),this.currentNotification.texts.length>3&&(this.currentNotification.texts.shift(),this.currentNotification.ids.shift(),clearTimeout(this.currentNotification.timeouts.shift()))}else this.currentNotification.timeouts.forEach(function(e){clearTimeout(e)}),this.currentNotification.timeouts=[],this.currentNotification.title=e.title,this.currentNotification.texts=[e.text],this.currentNotification.ids=[e.id];var o="<p>"+this.currentNotification.texts.join("</p><p>")+"</p>";this.alertNotification?(this.alertNotification.setTitle(this.currentNotification.title),this.alertNotification.setMessage(o)):this.alertNotification=this.alertCtrl.create({title:this.currentNotification.title,message:o,cssClass:"core-inapp-notification",enableBackdropDismiss:!1,buttons:[{text:this.translate.instant("core.dismiss"),role:"cancel",handler:function(){n(!0)}}]}),this.alertNotification.present(),this.currentNotification.timeouts.push(setTimeout(function(){n()},4e3))}},e.prototype.trigger=function(e){this.platform.is("ios")&&this.platform.version().num>=10&&this.showNotificationPopover(e);var t={id:e.id,at:parseInt(e.at,10)};return this.appDB.insertRecord(this.TRIGGERED_TABLE,t)},e.prototype.updateComponentName=function(e,t){return this.appDB.updateRecords(this.COMPONENTS_TABLE,{id:this.COMPONENTS_TABLE+"#"+t},{id:this.COMPONENTS_TABLE+"#"+e})},e=m([Object(o.A)(),g("design:paramtypes",[d.a,i.a,r.s,a.a,f.a,c.a,l.a,s.c,r.b,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(4),i=n(7),s=n(6),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.utils=n,this.initProcesses={},this.logger=e.getInstance("CoreInitDelegate")}return t=e,e.prototype.executeInitProcesses=function(){var e=this,t=[];void 0===this.readiness&&this.initReadiness();for(var n in this.initProcesses)t.push(this.initProcesses[n]);t.sort(function(e,t){return t.priority-e.priority}),t=t.map(function(t){return{context:e,func:e.prepareProcess,params:[t],blocking:!!t.blocking}}),this.utils.executeOrderedPromises(t).finally(this.readiness.resolve)},e.prototype.initReadiness=function(){var e=this;this.readiness=this.utils.promiseDefer(),this.readiness.promise.then(function(){return e.readiness.resolved=!0})},e.prototype.isReady=function(){return this.readiness.resolved},e.prototype.prepareProcess=function(e){var t;this.logger.debug("Executing init process '"+e.name+"'");try{t=e.load()}catch(t){return void this.logger.error("Error while calling the init process '"+e.name+"'. "+t)}return t},e.prototype.ready=function(){return void 0===this.readiness&&this.initReadiness(),this.readiness.promise},e.prototype.registerProcess=function(e){void 0===e.priority&&(e.priority=t.DEFAULT_PRIORITY),void 0===this.initProcesses[e.name]?(this.logger.log("Registering process '"+e.name+"'."),this.initProcesses[e.name]=e):this.logger.log("Process '"+e.name+"' already registered.")},e.DEFAULT_PRIORITY=100,e.MAX_RECOMMENDED_PRIORITY=600,e=t=a([Object(o.A)(),c("design:paramtypes",[i.a,r.s,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(27),i=n(7),s=n(2),a=n(11),c=n(22),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,n,o,r,i){this.sitesProvider=n,this.textUtils=o,this.fileProvider=r,this.timeUtils=i,this.tablesSchema=[{name:t.SUBMISSIONS_TABLE,columns:[{name:"assignid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"plugindata",type:"TEXT"},{name:"onlinetimemodified",type:"INTEGER"},{name:"timecreated",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"submitted",type:"INTEGER"},{name:"submissionstatement",type:"INTEGER"}],primaryKeys:["assignid","userid"]},{name:t.SUBMISSIONS_GRADES_TABLE,columns:[{name:"assignid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"grade",type:"REAL"},{name:"attemptnumber",type:"INTEGER"},{name:"addattempt",type:"INTEGER"},{name:"workflowstate",type:"TEXT"},{name:"applytoall",type:"INTEGER"},{name:"outcomes",type:"TEXT"},{name:"plugindata",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["assignid","userid"]}],this.logger=e.getInstance("AddonModAssignOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteSubmission=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.getDb().deleteRecords(t.SUBMISSIONS_TABLE,{assignid:e,userid:n})})},e.prototype.deleteSubmissionGrade=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.getDb().deleteRecords(t.SUBMISSIONS_GRADES_TABLE,{assignid:e,userid:n})})},e.prototype.getAllAssigns=function(e){var t=[];return t.push(this.getAllSubmissions(e)),t.push(this.getAllSubmissionsGrade(e)),Promise.all(t).then(function(e){return e=[].concat.apply([],e),e=e.map(function(e){return e.assignid}),e=e.filter(function(t,n){return e.indexOf(t)==n})})},e.prototype.getAllSubmissions=function(e){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.SUBMISSIONS_TABLE)}).then(function(e){return e.forEach(function(e){e.plugindata=n.textUtils.parseJSON(e.plugindata,{})}),e})},e.prototype.getAllSubmissionsGrade=function(e){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.SUBMISSIONS_GRADES_TABLE)}).then(function(e){return e.forEach(function(e){e.outcomes=n.textUtils.parseJSON(e.outcomes,{}),e.plugindata=n.textUtils.parseJSON(e.plugindata,{})}),e})},e.prototype.getAssignSubmissions=function(e,n){var o=this;return this.sitesProvider.getSiteDb(n).then(function(n){return n.getRecords(t.SUBMISSIONS_TABLE,{assignid:e})}).then(function(e){return e.forEach(function(e){e.plugindata=o.textUtils.parseJSON(e.plugindata,{})}),e})},e.prototype.getAssignSubmissionsGrade=function(e,n){var o=this;return this.sitesProvider.getSiteDb(n).then(function(n){return n.getRecords(t.SUBMISSIONS_GRADES_TABLE,{assignid:e})}).then(function(e){return e.forEach(function(e){e.outcomes=o.textUtils.parseJSON(e.outcomes,{}),e.plugindata=o.textUtils.parseJSON(e.plugindata,{})}),e})},e.prototype.getSubmission=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.getDb().getRecord(t.SUBMISSIONS_TABLE,{assignid:e,userid:n})}).then(function(e){return e.plugindata=r.textUtils.parseJSON(e.plugindata,{}),e})},e.prototype.getSubmissionFolder=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){t=t||n.getUserId();var r=o.fileProvider.getSiteFolder(n.getId());return o.textUtils.concatenatePaths(r,"offlineassign/"+e+"/"+t)})},e.prototype.getSubmissionGrade=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.getDb().getRecord(t.SUBMISSIONS_GRADES_TABLE,{assignid:e,userid:n})}).then(function(e){return e.outcomes=r.textUtils.parseJSON(e.outcomes,{}),e.plugindata=r.textUtils.parseJSON(e.plugindata,{}),e})},e.prototype.getSubmissionPluginFolder=function(e,t,n,o){var r=this;return this.getSubmissionFolder(e,n,o).then(function(e){return r.textUtils.concatenatePaths(e,t)})},e.prototype.hasAssignOfflineData=function(e,t){var n=[];return n.push(this.getAssignSubmissions(e,t)),n.push(this.getAssignSubmissionsGrade(e,t)),Promise.all(n).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n&&n.length)return!0}return!1}).catch(function(){return!1})},e.prototype.markSubmitted=function(e,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){return s=s||a.getUserId(),c.getSubmission(e,s,a.getId()).catch(function(){var t=c.timeUtils.timestamp();return{assignid:e,courseid:n,userid:s,onlinetimemodified:i,timecreated:t,timemodified:t}}).then(function(e){return e.submitted=o?1:0,e.submissionstatement=r?1:0,e.plugindata=e.plugindata?JSON.stringify(e.plugindata):"{}",a.getDb().insertRecord(t.SUBMISSIONS_TABLE,e)})})},e.prototype.saveSubmission=function(e,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){s=s||a.getUserId();var u=c.timeUtils.timestamp(),d={assignid:e,courseid:n,plugindata:o?JSON.stringify(o):"{}",userid:s,submitted:i?1:0,timecreated:u,timemodified:u,onlinetimemodified:r};return a.getDb().insertRecord(t.SUBMISSIONS_TABLE,d)})},e.prototype.submitGradingForm=function(e,n,o,r,i,s,a,c,u,d,l){var f=this;return this.sitesProvider.getSite(l).then(function(l){var p=f.timeUtils.timestamp(),h={assignid:e,userid:n,courseid:o,grade:r,attemptnumber:i,addattempt:s?1:0,workflowstate:a,applytoall:c?1:0,outcomes:u?JSON.stringify(u):"{}",plugindata:d?JSON.stringify(d):"{}",timemodified:p};return l.getDb().insertRecord(t.SUBMISSIONS_GRADES_TABLE,h)})},e.SUBMISSIONS_TABLE="addon_mod_assign_submissions",e.SUBMISSIONS_GRADES_TABLE="addon_mod_assign_submissions_grading",e=t=u([Object(o.A)(),d("design:paramtypes",[i.a,s.a,a.a,r.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(12),i=n(58),s=n(7),a=n(2),c=n(96),u=(n.n(c),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o){var i=e.call(this,"CoreMainMenuDelegate",t,n,o)||this;return i.loggerProvider=t,i.sitesProvider=n,i.eventsProvider=o,i.loaded=!1,i.siteHandlers=new c.BehaviorSubject([]),i.featurePrefix="CoreMainMenuDelegate_",o.on(r.a.LOGOUT,i.clearSiteHandlers.bind(i)),i}return u(t,e),t.prototype.areHandlersLoaded=function(){return this.loaded},t.prototype.clearSiteHandlers=function(){this.loaded=!1,this.siteHandlers.next([])},t.prototype.getHandlers=function(){return this.siteHandlers},t.prototype.updateData=function(){var e=[];for(var t in this.enabledHandlers){var n=this.enabledHandlers[t],o=n.getDisplayData();e.push({name:t,data:o,priority:n.priority})}e.sort(function(e,t){return t.priority-e.priority});var r=e.map(function(e){return e.data.name=e.name,e.data.priority=e.priority,e.data});this.loaded=!0,this.siteHandlers.next(r)},t=d([Object(o.A)(),l("design:paramtypes",[s.a,a.a,r.a])],t)}(i.a)},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.fb=e,this.gotoEntry=new o.v}return e.prototype.addControl=function(e,t){this.form&&("search"==this.mode&&this.form.addControl(e,this.fb.control(this.search[e]||null)),"edit"==this.mode&&this.form.addControl(e,this.fb.control(t,this.field.required?r.h.required:null)))},e.prototype.ngOnInit=function(){this.init()},e.prototype.init=function(){},e.prototype.isShowOrListMode=function(){return"list"==this.mode||"show"==this.mode},e.prototype.ngOnChanges=function(e){this.isShowOrListMode()&&e.value&&this.updateValue(e.value.currentValue)},e.prototype.updateValue=function(e){this.value=e},i([Object(o.D)(),s("design:type",String)],e.prototype,"mode",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"field",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"value",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"database",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"error",void 0),i([Object(o.O)(),s("design:type",o.v)],e.prototype,"gotoEntry",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"search",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(18),c=n(9),u=n(236),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.sitesProvider=t,this.utils=n,this.filepoolProvider=o,this.feedbackOffline=r,this.appProvider=i,this.ROOT_CACHE_KEY=this.ROOT_CACHE_KEY+"",this.logger=e.getInstance("AddonModFeedbackProvider")}return t=e,e.prototype.checkDependencyItem=function(e,t){var n=e.find(function(e){return e.id==t.dependitem});if(!n)return!0;switch(n.typ){case"label":return!1;case"multichoice":case"multichoicerated":return this.compareDependItemMultichoice(n,t.dependvalue)}return t.dependvalue==n.rawValue},e.prototype.compareDependItemMultichoice=function(e,n){var o,r,i=e.presentation.split(t.MULTICHOICE_TYPE_SEP)||[],s=i.length>0&&i[0]?i[0]:"r";r=(r=(r=i[1]||"").split(t.MULTICHOICE_ADJUST_SEP)[0]||"").split(t.LINE_SEP)||[],"c"===s?void 0===e.rawValue?o=[""]:(e.rawValue=""+e.rawValue,o=e.rawValue.split(t.LINE_SEP)):o=[e.rawValue];for(var a=0;a<r.length;a++)for(var c in o)if(o[c]==a+1){var u=r[a];if("multichoicerated"==e.typ&&(u=u.split(t.MULTICHOICERATED_VALUE_SEP)[1]||""),u.trim()==n)return!0;if(1==o.length)return!1}return!1},e.prototype.fillValues=function(e,n,o,r,i){var s=this;return this.getCurrentValues(e,o,r,i).then(function(t){return 0==t.length?s.processPageOnline(e,0,{},void 0,i).then(function(){return s.getCurrentValues(e,o,r,i)}).catch(function(){}):t}).then(function(e){var t={};e.forEach(function(e){t[e.item]=e.value}),n.forEach(function(e){e.hasvalue&&void 0!==t[e.id]&&(e.rawValue=t[e.id])})}).catch(function(){}).then(function(){return s.feedbackOffline.getFeedbackResponses(e,i).then(function(e){var o={};return(e=e.reduce(function(e,t){var n=s.utils.objectToArrayOfObjects(t.responses,"id","value");return e.concat(n)},[]).map(function(e){var t=e.id.split("_");return e.typ=t[0],e.item=parseInt(t[1],0),e})).forEach(function(e){void 0===o[e.item]&&(o[e.item]=[]),o[e.item].push(e.value)}),n.forEach(function(e){e.hasvalue&&void 0!==o[e.id]&&("multichoice"==e.typ&&"c"==e.presentation.split(t.MULTICHOICE_TYPE_SEP)[0]?(o[e.id]=o[e.id].filter(function(e){return e>0}),e.rawValue=o[e.id].join(t.LINE_SEP)):e.rawValue=o[e.id][0])}),n})}).catch(function(){return n})},e.prototype.getAllNonRespondents=function(e,t,n,o){var r=this;return n=n||this.sitesProvider.getCurrentSiteId(),void 0===o&&(o={page:0,users:[]}),this.getNonRespondents(e,t,o.page,n).then(function(i){return o.users.length<i.total&&(o.users=o.users.concat(i.users)),o.users.length<i.total?(o.page++,r.getAllNonRespondents(e,t,n,o)):(o.total=i.total,o)})},e.prototype.getAllResponsesAnalysis=function(e,t,n,o){var r=this;return n=n||this.sitesProvider.getCurrentSiteId(),void 0===o&&(o={page:0,attempts:[],anonattempts:[]}),this.getResponsesAnalysis(e,t,o.page,n).then(function(i){return o.anonattempts.length<i.totalanonattempts&&(o.anonattempts=o.anonattempts.concat(i.anonattempts)),o.attempts.length<i.totalattempts&&(o.attempts=o.attempts.concat(i.attempts)),o.anonattempts.length<i.totalanonattempts||o.attempts.length<i.totalattempts?(o.page++,r.getAllResponsesAnalysis(e,t,n,o)):(o.totalattempts=i.totalattempts,o.totalanonattempts=i.totalanonattempts,o)})},e.prototype.getAnalysis=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={feedbackid:e},i={cacheKey:o.getAnalysisDataCacheKey(e,t)};return t&&(r.groupid=t),n.read("mod_feedback_get_analysis",r,i)})},e.prototype.getAnalysisDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getAnalysisDataPrefixCacheKey(e)+t},e.prototype.getAnalysisDataPrefixCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":analysis:"},e.prototype.getAttempt=function(e,t,n,o){var r=this;return n=n||this.sitesProvider.getCurrentSiteId(),void 0===o&&(o={page:0,attemptsLoaded:0,anonAttemptsLoaded:0}),this.getResponsesAnalysis(e,0,o.page,n).then(function(i){var s;return(s=i.attempts.find(function(e){return t==e.id}))?s:(s=i.anonattempts.find(function(e){return t==e.id}))?s:(o.anonAttemptsLoaded<i.totalanonattempts&&(o.anonAttemptsLoaded+=i.anonattempts.length),o.attemptsLoaded<i.totalattempts&&(o.attemptsLoaded+=i.attempts.length),o.anonAttemptsLoaded<i.totalanonattempts||o.attemptsLoaded<i.totalattempts?(o.page++,r.getAttempt(e,t,n,o)):Promise.reject(null))})},e.prototype.getCompletedDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":completed:"},e.prototype.getCurrentCompletedTimeModified=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={feedbackid:e},r={cacheKey:n.getCurrentCompletedTimeModifiedDataCacheKey(e)};return t.read("mod_feedback_get_current_completed_tmp",o,r).then(function(e){return e&&void 0!==e.feedback&&void 0!==e.feedback.timemodified?e.feedback.timemodified:0}).catch(function(){return 0})})},e.prototype.getCurrentCompletedTimeModifiedDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":completedtime:"},e.prototype.getCurrentValues=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={feedbackid:e},s={cacheKey:r.getCurrentValuesDataCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_feedback_get_unfinished_responses",i,s).then(function(e){return e&&void 0!==e.responses?e.responses:Promise.reject(null)})})},e.prototype.getCurrentValuesDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":currentvalues"},e.prototype.getFeedbackAccessInformation=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={feedbackid:e},s={cacheKey:r.getFeedbackAccessInformationDataCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_feedback_get_feedback_access_information",i,s)})},e.prototype.getFeedbackAccessInformationDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":access"},e.prototype.getFeedbackCacheKey=function(e){return this.ROOT_CACHE_KEY+"feedback:"+e},e.prototype.getFeedbackDataPrefixCacheKey=function(e){return this.ROOT_CACHE_KEY+e},e.prototype.getFeedbackDataByKey=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){var s={courseids:[e]},a={cacheKey:i.getFeedbackCacheKey(e)};return r&&(a.omitExpires=!0),o.read("mod_feedback_get_feedbacks_by_courses",s,a).then(function(e){if(e&&e.feedbacks){var o=e.feedbacks.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getFeedback=function(e,t,n,o){return this.getFeedbackDataByKey(e,"coursemodule",t,n,o)},e.prototype.getFeedbackById=function(e,t,n,o){return this.getFeedbackDataByKey(e,"id",t,n,o)},e.prototype.getItems=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={feedbackid:e},r={cacheKey:n.getItemsDataCacheKey(e)};return t.read("mod_feedback_get_items",o,r)})},e.prototype.getItemsDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":items"},e.prototype.getNonRespondents=function(e,t,n,o){var r=this;return void 0===t&&(t=0),void 0===n&&(n=0),this.sitesProvider.getSite(o).then(function(o){var i={feedbackid:e,groupid:t,page:n},s={cacheKey:r.getNonRespondentsDataCacheKey(e,t)};return o.read("mod_feedback_get_non_respondents",i,s)})},e.prototype.getNonRespondentsDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getNonRespondentsDataPrefixCacheKey(e)+t},e.prototype.getNonRespondentsDataPrefixCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":nonrespondents:"},e.prototype.getPageItems=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_feedback_get_page_items",{feedbackid:e,page:t})})},e.prototype.getPageItemsWithValues=function(e,t,n,o,r){var i=this;return void 0===n&&(n=!1),void 0===o&&(o=!1),r=r||this.sitesProvider.getCurrentSiteId(),this.getPageItems(e,t,r).then(function(t){return i.fillValues(e,t.items,n,o,r).then(function(e){return t.items=e,t})}).catch(function(){return i.getItems(e,r).then(function(s){return i.fillValues(e,s.items,n,o,r).then(function(e){var n=0,o=[],r=e.filter(function(e){return!(n>t)&&("pagebreak"==e.typ?(n++,!1):n<t?(o.push(e),!1):e&&e.dependitem>0&&o.length>0?i.checkDependencyItem(o,e):e)});return s.hasprevpage=t>0,s.hasnextpage=n>t,s.items=r,s})})})},e.prototype.getPageJumpTo=function(e,t,n,o){var r=this;return this.getPageItemsWithValues(e,t,!0,!1,o).then(function(i){return i.items.length>0?t:!!(1==n&&i.hasnextpage||-1==n&&i.hasprevpage)&&r.getPageJumpTo(e,t+n,n,o)})},e.prototype.getResponsesAnalysis=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={feedbackid:e,groupid:t||0,page:n||0},s={cacheKey:r.getResponsesAnalysisDataCacheKey(e,t)};return o.read("mod_feedback_get_responses_analysis",i,s)})},e.prototype.getResponsesAnalysisDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getResponsesAnalysisDataPrefixCacheKey(e)+t},e.prototype.getResponsesAnalysisDataPrefixCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":responsesanalysis:"},e.prototype.getResumePage=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={feedbackid:e},s={cacheKey:r.getResumePageDataCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_feedback_launch_feedback",i,s).then(function(e){return e&&void 0!==e.gopage?e.gopage>0?e.gopage:0:Promise.reject(null)})})},e.prototype.getResumePageDataCacheKey=function(e){return this.getFeedbackDataPrefixCacheKey(e)+":launch"},e.prototype.invalidateAllFeedbackData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getFeedbackDataPrefixCacheKey(e))})},e.prototype.invalidateAnalysisData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getAnalysisDataPrefixCacheKey(e))})},e.prototype.invalidateContent=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=[];return r.push(this.getFeedback(t,e,n).then(function(e){var r=[];return r.push(o.invalidateFeedbackData(t,n)),r.push(o.invalidateAllFeedbackData(e.id,n)),Promise.all(r)})),r.push(this.invalidateFiles(e,n)),this.utils.allPromises(r)},e.prototype.invalidateCurrentValuesData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCurrentValuesDataCacheKey(e))})},e.prototype.invalidateFeedbackAccessInformationData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getFeedbackAccessInformationDataCacheKey(e))})},e.prototype.invalidateFeedbackData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getFeedbackCacheKey(e))})},e.prototype.invalidateFiles=function(e,n){return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.invalidateNonRespondentsData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getNonRespondentsDataPrefixCacheKey(e))})},e.prototype.invalidateResponsesAnalysisData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getResponsesAnalysisDataPrefixCacheKey(e))})},e.prototype.invalidateResumePageData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getResumePageDataCacheKey(e))})},e.prototype.isCompleted=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={feedbackid:e},r={cacheKey:n.getCompletedDataCacheKey(e)};return n.utils.promiseWorks(t.read("mod_feedback_get_last_completed",o,r))})},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("mod_feedback_get_feedbacks_by_courses")&&e.wsAvailable("mod_feedback_get_feedback_access_information")})},e.prototype.logView=function(e,t){void 0===t&&(t=!1);var n={feedbackid:e,moduleviewed:t?1:0};return this.sitesProvider.getCurrentSite().write("mod_feedback_view_feedback",n)},e.prototype.processPage=function(e,t,n,o,r,i,s){var a=this;s=s||this.sitesProvider.getCurrentSiteId();var c=function(){return a.feedbackOffline.saveResponses(e,t,n,i,s).then(function(){var n={jumpto:t,completed:!1,offline:!0},i=0;return o?t>0&&(i=-1):r||(i=1),0===i?n:a.getPageItemsWithValues(e,t,!0,!1,s).then(function(o){return 1!=i||o.hasnextpage?a.getPageJumpTo(e,t+i,i,s).then(function(e){return!1===e?-1==i?n.jumpto=0:n.completed=!0:n.jumpto=e,n}):(n.completed=!0,n)})})};return this.appProvider.isOnline()?this.feedbackOffline.deleteFeedbackPageResponses(e,t,s).then(function(){return a.processPageOnline(e,t,n,o,s).catch(function(e){return a.utils.isWebServiceError(e)?Promise.reject(e):c()})}):c()},e.prototype.processPageOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={feedbackid:e,page:t,responses:i.utils.objectToArrayOfObjects(n,"name","value"),goprevious:o?1:0};return r.write("mod_feedback_process_page",s).catch(function(e){return Promise.reject(i.utils.createFakeWSError(e))}).then(function(t){return i.invalidateCurrentValuesData(e,r.getId()).then(function(){return i.getCurrentValues(e,!1,!1,r.getId())}).catch(function(){}).then(function(){return t})})})},e.COMPONENT="mmaModFeedback",e.FORM_SUBMITTED="addon_mod_feedback_form_submitted",e.LINE_SEP="|",e.MULTICHOICE_TYPE_SEP=">>>>>",e.MULTICHOICE_ADJUST_SEP="<<<<<",e.MULTICHOICE_HIDENOSELECT="h",e.MULTICHOICERATED_VALUE_SEP="####",e=t=d([Object(o.A)(),l("design:paramtypes",[r.a,i.a,s.a,a.a,u.a,c.a])],e);var t}()},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(8),i=n(11),s=n(73),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.injector=n,this.logger=e.getInstance(t),this.questionHelper=n.get(s.a),this.domUtils=n.get(r.a),this.textUtils=n.get(i.a)}return e.prototype.initCalculatedComponent=function(){var e=this.initInputTextComponent();if(e){var t={},n=e.querySelector("select[name*=unit]"),o=n&&Array.from(n.querySelectorAll("option"));if(n&&o&&o.length){t.id=n.id,t.name=n.name,t.disabled=n.disabled,t.options=[];for(var r in o){var i=o[r];if(void 0===i.value)return this.logger.warn("Aborting because couldn't find input.",this.question.name),this.questionHelper.showComponentError(this.onAbort);var s={value:i.value,label:i.innerHTML};i.selected&&(t.selected=s.value),t.options.push(s)}t.selected||(t.selected=t.options[0].value);var a=e.querySelector('label[for="'+n.id+'"]');t.accessibilityLabel=a&&a.innerHTML,this.question.select=t;var c=e.querySelector('input[type="text"][name*=answer]');return this.question.selectFirst=e.innerHTML.indexOf(c.outerHTML)>e.innerHTML.indexOf(n.outerHTML),e}var u=Array.from(e.querySelectorAll('input[type="radio"]'));if(!u.length)return e;this.question.options=[];for(var r in u){var d=u[r],l=e.querySelector('label[for="'+(s={id:d.id,name:d.name,value:d.value,checked:d.checked,disabled:d.disabled}).id+'"]');if(this.question.optionsName=s.name,!l||(s.text=l.innerText,void 0===s.name||void 0===s.value||void 0===s.text))return this.logger.warn("Aborting because of an error parsing options.",this.question.name,s.name),this.questionHelper.showComponentError(this.onAbort);d.checked&&(this.question.unit=s.value),this.question.options.push(s)}var f=e.querySelector('input[type="text"][name*=answer]');this.question.optionsFirst=e.innerHTML.indexOf(f.outerHTML)>e.innerHTML.indexOf(u[0].outerHTML)}},e.prototype.initComponent=function(){if(!this.question)return this.logger.warn("Aborting because of no question received."),this.questionHelper.showComponentError(this.onAbort);var e=document.createElement("div");return e.innerHTML=this.question.html,this.question.text=this.domUtils.getContentsOfElement(e,".qtext"),void 0===this.question.text?(this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort)):e},e.prototype.initEssayComponent=function(){var e=this.initComponent();if(e){var t=e.querySelector("textarea[name*=_answer]");if(this.question.allowsAttachments=!!e.querySelector("div[id*=filemanager]"),this.question.isMonospaced=!!e.querySelector(".qtype_essay_monospaced"),this.question.isPlainText=this.question.isMonospaced||!!e.querySelector(".qtype_essay_plain"),this.question.hasDraftFiles=this.questionHelper.hasDraftFileUrls(e.innerHTML),t){var n=e.querySelector('input[type="hidden"][name*=answerformat]'),o=t.innerHTML;this.question.textarea={id:t.id,name:t.name,text:o?this.textUtils.decodeHTML(o):""},n&&(this.question.formatInput={name:n.name,value:n.value})}else this.question.answer=this.domUtils.getContentsOfElement(e,".qtype_essay_response"),this.question.attachments=this.questionHelper.getQuestionAttachmentsFromHtml(this.domUtils.getContentsOfElement(e,".attachments"))}},e.prototype.initOriginalTextComponent=function(e){if(!this.question)return this.logger.warn("Aborting because of no question received."),this.questionHelper.showComponentError(this.onAbort);var t=document.createElement("div");t.innerHTML=this.question.html;var n=t.querySelector(e);if(!n)return this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.domUtils.removeElement(n,"input[name*=sequencecheck]"),this.domUtils.removeElement(n,".validationerror"),this.questionHelper.replaceCorrectnessClasses(t),this.questionHelper.replaceFeedbackClasses(t),this.questionHelper.treatCorrectnessIcons(t),this.question.text=n.innerHTML},e.prototype.initInputTextComponent=function(){var e=this.initComponent();if(e){var t=e.querySelector('input[type="text"][name*=answer]');if(!t)return this.logger.warn("Aborting because couldn't find input.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.question.input={id:t.id,name:t.name,value:t.value,readOnly:t.readOnly},t.classList.contains("incorrect")?this.question.input.correctClass="core-question-incorrect":t.classList.contains("correct")?this.question.input.correctClass="core-question-correct":t.classList.contains("partiallycorrect")&&(this.question.input.correctClass="core-question-partiallycorrect")}return e},e.prototype.initMatchComponent=function(){var e=this.initComponent();if(e){var t=Array.from(e.querySelectorAll("table.answer tr"));if(!t||!t.length)return this.logger.warn("Aborting because couldn't find any row.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.question.rows=[];for(var n in t){var o=t[n],r={},i=Array.from(o.querySelectorAll("td"));if(!i||i.length<2)return this.logger.warn("Aborting because couldn't the right columns.",this.question.name),this.questionHelper.showComponentError(this.onAbort);r.text=i[0].innerHTML;var s=i[1].querySelector("select"),a=Array.from(i[1].querySelectorAll("option"));if(!s||!a||!a.length)return this.logger.warn("Aborting because couldn't find select or options.",this.question.name),this.questionHelper.showComponentError(this.onAbort);r.id=s.id,r.name=s.name,r.disabled=s.disabled,r.selected=!1,r.options=[],i[1].className.indexOf("incorrect")>=0?r.isCorrect=0:i[1].className.indexOf("correct")>=0&&(r.isCorrect=1);for(var c in a){var u=a[c];if(void 0===u.value)return this.logger.warn("Aborting because couldn't find the value of an option.",this.question.name),this.questionHelper.showComponentError(this.onAbort);var d={value:u.value,label:u.innerHTML,selected:u.selected};d.selected&&(r.selected=d.value),r.options.push(d)}var l=i[1].querySelector("label.accesshide");r.accessibilityLabel=l&&l.innerHTML,this.question.rows.push(r)}this.question.loaded=!0}return e},e.prototype.initMultichoiceComponent=function(){var e=this.initComponent();if(e){this.question.prompt=this.domUtils.getContentsOfElement(e,".prompt");var t=Array.from(e.querySelectorAll('input[type="radio"]'));if(!(t&&t.length||(this.question.multi=!0,(t=Array.from(e.querySelectorAll('input[type="checkbox"]')))&&t.length)))return this.logger.warn("Aborting because of no radio and checkbox found.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.question.options=[];for(var n in t){var o=t[n],r={id:o.id,name:o.name,value:o.value,checked:o.checked,disabled:o.disabled},i=o.parentElement;this.question.optionsName=r.name;var s=e.querySelector('label[for="'+r.id+'"]');if(!s||(r.text=s.innerHTML,void 0===r.name||void 0===r.value||void 0===r.text))return this.logger.warn("Aborting because of an error parsing options.",this.question.name,r.name),this.questionHelper.showComponentError(this.onAbort);if(o.checked&&(this.question.multi||(this.question.singleChoiceModel=r.value),i)){i&&i.className.indexOf("incorrect")>=0?r.isCorrect=0:i&&i.className.indexOf("correct")>=0&&(r.isCorrect=1);var a=i.querySelector(".specificfeedback");a&&(r.feedback=a.innerHTML)}this.question.options.push(r)}this.question.multi||void 0!==this.question.singleChoiceModel||(this.question.singleChoiceModel=t[0].value)}return e},a([Object(o.D)(),c("design:type",Object)],e.prototype,"question",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"component",void 0),a([Object(o.D)(),c("design:type",Number)],e.prototype,"componentId",void 0),a([Object(o.D)(),c("design:type",Number)],e.prototype,"attemptId",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"offlineEnabled",void 0),a([Object(o.O)(),c("design:type",o.v)],e.prototype,"buttonClicked",void 0),a([Object(o.O)(),c("design:type",o.v)],e.prototype,"onAbort",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(1),i=n(18),s=n(7),a=n(2),c=n(11),u=n(22),d=n(6),l=n(115),f=n(38),p=n(74),h=n(190),m=n(5),g=(n.n(m),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(){function e(e,t,n,o,r,i,s,a,c,u,d){this.sitesProvider=t,this.utils=n,this.translate=o,this.textUtils=r,this.gradesHelper=i,this.questionDelegate=s,this.filepoolProvider=a,this.timeUtils=c,this.accessRulesDelegate=u,this.quizOfflineProvider=d,this.ROOT_CACHE_KEY="mmaModQuiz:",this.div=document.createElement("div"),this.logger=e.getInstance("AddonModQuizProvider")}return t=e,e.prototype.formatGrade=function(e,t){return void 0===e||-1==e||null===e?this.translate.instant("addon.mod_quiz.notyetgraded"):this.utils.formatFloat(this.textUtils.roundToDecimals(e,t))},e.prototype.getAllQuestionsData=function(e,t,n,o,r,i,s){var a=this,c=[],u={},d=this.isNavigationSequential(e);return o||(o=this.getPagesFromLayout(t.layout)),o.forEach(function(e){d&&e<t.currentpage||c.push(a.getAttemptData(t.id,e,n,r,i,s).then(function(e){e.questions.forEach(function(e){u[e.slot]=e})}))}),Promise.all(c).then(function(){return u})},e.prototype.getAttemptAccessInformationCacheKey=function(e,t){return this.getAttemptAccessInformationCommonCacheKey(e)+":"+t},e.prototype.getAttemptAccessInformationCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"attemptAccessInformation:"+e},e.prototype.getAttemptAccessInformation=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={quizid:e,attemptid:t},a={cacheKey:i.getAttemptAccessInformationCacheKey(e,t)};return n?a.omitExpires=!0:o&&(a.getFromCache=!1,a.emergencyCache=!1),r.read("mod_quiz_get_attempt_access_information",s,a)})},e.prototype.getAttemptDataCacheKey=function(e,t){return this.getAttemptDataCommonCacheKey(e)+":"+t},e.prototype.getAttemptDataCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"attemptData:"+e},e.prototype.getAttemptData=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={attemptid:e,page:t,preflightdata:s.utils.objectToArrayOfObjects(n,"name","value",!0)},c={cacheKey:s.getAttemptDataCacheKey(e,t)};return o?c.omitExpires=!0:r&&(c.getFromCache=!1,c.emergencyCache=!1),i.read("mod_quiz_get_attempt_data",a,c)})},e.prototype.getAttemptDueDate=function(e,n){var o=[];if(e.timelimit&&o.push(parseInt(n.timestart,10)+parseInt(e.timelimit,10)),e.timeclose&&o.push(parseInt(e.timeclose,10)),!o.length)return 0;var r=Math.min.apply(null,o);if(!r)return 0;switch(n.state){case t.ATTEMPT_IN_PROGRESS:return 1e3*r;case t.ATTEMPT_OVERDUE:return 1e3*(r+parseInt(e.graceperiod,10));default:return this.logger.warn("Unexpected state when getting due date: "+n.state),0}},e.prototype.getAttemptDueDateWarning=function(e,n){var o=this.getAttemptDueDate(e,n);return n.state===t.ATTEMPT_OVERDUE?this.translate.instant("addon.mod_quiz.overduemustbesubmittedby",{$a:m(o).format("LLL")}):o?this.translate.instant("addon.mod_quiz.mustbesubmittedby",{$a:m(o).format("LLL")}):void 0},e.prototype.getAttemptReadableState=function(e,n){if(n.finishedOffline)return[this.translate.instant("addon.mod_quiz.finishnotsynced")];switch(n.state){case t.ATTEMPT_IN_PROGRESS:return[this.translate.instant("addon.mod_quiz.stateinprogress")];case t.ATTEMPT_OVERDUE:var o=[],r=this.getAttemptDueDate(e,n);return o.push(this.translate.instant("addon.mod_quiz.stateoverdue")),r&&o.push(this.translate.instant("addon.mod_quiz.stateoverduedetails",{$a:m(r).format("LLL")})),o;case t.ATTEMPT_FINISHED:return[this.translate.instant("addon.mod_quiz.statefinished"),this.translate.instant("addon.mod_quiz.statefinisheddetails",{$a:m(1e3*n.timefinish).format("LLL")})];case t.ATTEMPT_ABANDONED:return[this.translate.instant("addon.mod_quiz.stateabandoned")];default:return[]}},e.prototype.getAttemptReadableStateName=function(e){switch(e){case t.ATTEMPT_IN_PROGRESS:return this.translate.instant("addon.mod_quiz.stateinprogress");case t.ATTEMPT_OVERDUE:return this.translate.instant("addon.mod_quiz.stateoverdue");case t.ATTEMPT_FINISHED:return this.translate.instant("addon.mod_quiz.statefinished");case t.ATTEMPT_ABANDONED:return this.translate.instant("addon.mod_quiz.stateabandoned");default:return""}},e.prototype.getAttemptReviewCacheKey=function(e,t){return this.getAttemptReviewCommonCacheKey(e)+":"+t},e.prototype.getAttemptReviewCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"attemptReview:"+e},e.prototype.getAttemptReview=function(e,t,n,o){var r=this;return void 0===t&&(t=-1),this.sitesProvider.getSite(o).then(function(o){var i={attemptid:e,page:t},s={cacheKey:r.getAttemptReviewCacheKey(e,t)};return n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_quiz_get_attempt_review",i,s)})},e.prototype.getAttemptSummaryCacheKey=function(e){return this.ROOT_CACHE_KEY+"attemptSummary:"+e},e.prototype.getAttemptSummary=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={attemptid:e,preflightdata:s.utils.objectToArrayOfObjects(t,"name","value",!0)},c={cacheKey:s.getAttemptSummaryCacheKey(e)};return n?c.omitExpires=!0:o&&(c.getFromCache=!1,c.emergencyCache=!1),i.read("mod_quiz_get_attempt_summary",a,c).then(function(t){return t&&t.questions?n&&r?s.quizOfflineProvider.loadQuestionsLocalStates(e,t.questions,i.getId()):t.questions:Promise.reject(null)})})},e.prototype.getCombinedReviewOptionsCacheKey=function(e,t){return this.getCombinedReviewOptionsCommonCacheKey(e)+":"+t},e.prototype.getCombinedReviewOptionsCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"combinedReviewOptions:"+e},e.prototype.getCombinedReviewOptions=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){o=o||n.getUserId();var i={quizid:e,userid:o},s={cacheKey:r.getCombinedReviewOptionsCacheKey(e,o)};return t&&(s.getFromCache=!1,s.emergencyCache=!1),n.read("mod_quiz_get_combined_review_options",i,s).then(function(e){return e&&e.someoptions&&e.alloptions?(e.someoptions=r.utils.objectToKeyValueMap(e.someoptions,"name","value"),e.alloptions=r.utils.objectToKeyValueMap(e.alloptions,"name","value"),e):Promise.reject(null)})})},e.prototype.getFeedbackForGradeCacheKey=function(e,t){return this.getFeedbackForGradeCommonCacheKey(e)+":"+t},e.prototype.getFeedbackForGradeCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"feedbackForGrade:"+e},e.prototype.getFeedbackForGrade=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={quizid:e,grade:t},s={cacheKey:r.getFeedbackForGradeCacheKey(e,t)};return n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_quiz_get_quiz_feedback_for_grade",i,s)})},e.prototype.getGradeDecimals=function(e){return void 0===e.questiondecimalpoints&&(e.questiondecimalpoints=-1),-1==e.questiondecimalpoints?e.decimalpoints:e.questiondecimalpoints},e.prototype.getGradeFromGradebook=function(e,t,n,o,r){return this.gradesHelper.getGradeModuleItems(e,t,r,null,o,n).then(function(e){return e.shift()})},e.prototype.getLastFinishedAttemptFromList=function(e){if(e&&e.length)for(var t=e.length-1;t>=0;t--){var n=e[t];if(this.isAttemptFinished(n.state))return n}},e.prototype.getPreventSubmitMessages=function(e){var t=this,n=[];return e.forEach(function(e){var o=t.questionDelegate.getPreventSubmitMessage(e);o&&(o=t.translate.instant(o),n.push(t.translate.instant("core.question.questionmessage",{$a:e.slot,$b:o})))}),n},e.prototype.getQuizDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"quiz:"+e},e.prototype.getQuizByField=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={courseids:[e]},a={cacheKey:i.getQuizDataCacheKey(e)};return o&&(a.omitExpires=!0),r.read("mod_quiz_get_quizzes_by_courses",s,a).then(function(e){if(e&&e.quizzes)for(var o in e.quizzes){var r=e.quizzes[o];if(r[t]==n)return r}return Promise.reject(null)})})},e.prototype.getQuiz=function(e,t,n,o){return this.getQuizByField(e,"coursemodule",t,n,o)},e.prototype.getQuizById=function(e,t,n,o){return this.getQuizByField(e,"id",t,n,o)},e.prototype.getQuizAccessInformationCacheKey=function(e){return this.ROOT_CACHE_KEY+"quizAccessInformation:"+e},e.prototype.getQuizAccessInformation=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={quizid:e},s={cacheKey:r.getQuizAccessInformationCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_quiz_get_quiz_access_information",i,s)})},e.prototype.getQuizGradeMethod=function(e){switch("string"==typeof e&&(e=parseInt(e,10)),e){case t.GRADEHIGHEST:return this.translate.instant("addon.mod_quiz.gradehighest");case t.GRADEAVERAGE:return this.translate.instant("addon.mod_quiz.gradeaverage");case t.ATTEMPTFIRST:return this.translate.instant("addon.mod_quiz.attemptfirst");case t.ATTEMPTLAST:return this.translate.instant("addon.mod_quiz.attemptlast");default:return""}},e.prototype.getQuizRequiredQtypesCacheKey=function(e){return this.ROOT_CACHE_KEY+"quizRequiredQtypes:"+e},e.prototype.getQuizRequiredQtypes=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={quizid:e},i={cacheKey:o.getQuizRequiredQtypesCacheKey(e)};return t&&(i.getFromCache=!1,i.emergencyCache=!1),n.read("mod_quiz_get_quiz_required_qtypes",r,i).then(function(e){return e&&e.questiontypes?e.questiontypes:Promise.reject(null)})})},e.prototype.getPagesFromLayout=function(e){for(var t=e.split(","),n=[],o=0,r=0;r<t.length;r++)"0"==t[r]&&(n.push(o),o++);return n},e.prototype.getPagesFromLayoutAndQuestions=function(e,t){for(var n=e.split(","),o=[],r=0,i=!1,s=0;s<n.length;s++){var a=Number(n[s]);0==a?(r++,i=!1):!i&&t[a]&&(o.push(r),i=!0)}return o},e.prototype.getUnsupportedQuestions=function(e){var t=this,n=[];return e.forEach(function(e){"random"==e||t.questionDelegate.isQuestionSupported(e)||n.push(e)}),n},e.prototype.getUnsupportedRules=function(e){var t=this,n=[];return e.forEach(function(e){t.accessRulesDelegate.isAccessRuleSupported(e)||n.push(e)}),n},e.prototype.getUserAttemptsCacheKey=function(e,t){return this.getUserAttemptsCommonCacheKey(e)+":"+t},e.prototype.getUserAttemptsCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"userAttempts:"+e},e.prototype.getUserAttempts=function(e,t,n,o,r,i,s){var a=this;return void 0===t&&(t="all"),void 0===n&&(n=!0),this.sitesProvider.getSite(i).then(function(i){s=s||i.getUserId();var c={quizid:e,userid:s,status:t,includepreviews:n?1:0},u={cacheKey:a.getUserAttemptsCacheKey(e,s)};return o?u.omitExpires=!0:r&&(u.getFromCache=!1,u.emergencyCache=!1),i.read("mod_quiz_get_user_attempts",c,u).then(function(e){return e&&e.attempts?e.attempts:Promise.reject(null)})})},e.prototype.getUserBestGradeCacheKey=function(e,t){return this.getUserBestGradeCommonCacheKey(e)+":"+t},e.prototype.getUserBestGradeCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"userBestGrade:"+e},e.prototype.getUserBestGrade=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){o=o||n.getUserId();var i={quizid:e,userid:o},s={cacheKey:r.getUserBestGradeCacheKey(e,o)};return t&&(s.getFromCache=!1,s.emergencyCache=!1),n.read("mod_quiz_get_user_best_grade",i,s)})},e.prototype.invalidateAllQuizData=function(e,t,n,o,r){o=o||this.sitesProvider.getCurrentSiteId();var i=[];return i.push(this.invalidateAttemptAccessInformation(e,o)),i.push(this.invalidateCombinedReviewOptionsForUser(e,o,r)),i.push(this.invalidateFeedback(e,o)),i.push(this.invalidateQuizAccessInformation(e,o)),i.push(this.invalidateQuizRequiredQtypes(e,o)),i.push(this.invalidateUserAttemptsForUser(e,o,r)),i.push(this.invalidateUserBestGradeForUser(e,o,r)),n&&(i.push(this.invalidateAttemptData(n,o)),i.push(this.invalidateAttemptReview(n,o)),i.push(this.invalidateAttemptSummary(n,o))),t&&i.push(this.invalidateGradeFromGradebook(t,o,r)),Promise.all(i)},e.prototype.invalidateAttemptAccessInformation=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getAttemptAccessInformationCommonCacheKey(e))})},e.prototype.invalidateAttemptAccessInformationForAttempt=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getAttemptAccessInformationCacheKey(e,t))})},e.prototype.invalidateAttemptData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getAttemptDataCommonCacheKey(e))})},e.prototype.invalidateAttemptDataForPage=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getAttemptDataCacheKey(e,t))})},e.prototype.invalidateAttemptReview=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getAttemptReviewCommonCacheKey(e))})},e.prototype.invalidateAttemptReviewForPage=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getAttemptReviewCacheKey(e,t))})},e.prototype.invalidateAttemptSummary=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getAttemptSummaryCacheKey(e))})},e.prototype.invalidateCombinedReviewOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getCombinedReviewOptionsCommonCacheKey(e))})},e.prototype.invalidateCombinedReviewOptionsForUser=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getCombinedReviewOptionsCacheKey(e,n))})},e.prototype.invalidateContent=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getQuiz(t,e,!1,n).then(function(e){return o.getUserAttempts(e.id,"all",!0,!1,!1,n).then(function(r){return o.invalidateAllQuizData(e.id,t,r.length?r[r.length-1].id:void 0,n)})})},e.prototype.invalidateFeedback=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getFeedbackForGradeCommonCacheKey(e))})},e.prototype.invalidateFeedbackForGrade=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getFeedbackForGradeCacheKey(e,t))})},e.prototype.invalidateFiles=function(e){return this.filepoolProvider.invalidateFilesByComponent(this.sitesProvider.getCurrentSiteId(),t.COMPONENT,e)},e.prototype.invalidateGradeFromGradebook=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(r){return n=n||r.getUserId(),o.gradesHelper.invalidateGradeModuleItems(e,n,null,t)})},e.prototype.invalidateQuizAccessInformation=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getQuizAccessInformationCacheKey(e))})},e.prototype.invalidateQuizRequiredQtypes=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getQuizRequiredQtypesCacheKey(e))})},e.prototype.invalidateUserAttempts=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getUserAttemptsCommonCacheKey(e))})},e.prototype.invalidateUserAttemptsForUser=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getUserAttemptsCacheKey(e,n))})},e.prototype.invalidateUserBestGrade=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getUserBestGradeCommonCacheKey(e))})},e.prototype.invalidateUserBestGradeForUser=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getUserBestGradeCacheKey(e,n))})},e.prototype.invalidateQuizData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getQuizDataCacheKey(e))})},e.prototype.isAttemptFinished=function(e){return e==t.ATTEMPT_FINISHED||e==t.ATTEMPT_ABANDONED},e.prototype.isAttemptFinishedOffline=function(e,t){return this.quizOfflineProvider.getAttemptById(e,t).then(function(e){return!!e.finished}).catch(function(){return!1})},e.prototype.isAttemptTimeNearlyOver=function(e,n){if(n.state!=t.ATTEMPT_IN_PROGRESS)return!0;var o=this.getAttemptDueDate(e,n),r=e.autosaveperiod||0;return o>0&&Date.now()+r>=o},e.prototype.isLastAttemptOfflineUnfinished=function(e,t,n){return this.quizOfflineProvider.getQuizAttempts(e.id,t,n).then(function(e){var t=e.pop();return t&&!t.finished}).catch(function(){return!1})},e.prototype.isNavigationSequential=function(e){return"sequential"==e.navmethod},e.prototype.isPluginEnabled=function(e){return!0},e.prototype.isQuestionBlocked=function(e){return this.div.innerHTML=e.html,!!this.div.querySelector(".mod_quiz-blocked_question_warning")},e.prototype.isQuizOffline=function(e){return!!e.allowofflineattempts&&!this.sitesProvider.getCurrentSite().isOfflineDisabled()},e.prototype.loadFinishedOfflineData=function(e,t){if(e.length){var n=e[e.length-1];return this.isAttemptFinishedOffline(n.id,t).then(function(e){n.finishedOffline=e})}return Promise.resolve()},e.prototype.logViewAttempt=function(e,t,n,o){void 0===t&&(t=0),void 0===n&&(n={});var r={attemptid:e,page:t,preflightdata:this.utils.objectToArrayOfObjects(n,"name","value",!0)},i=[];return i.push(this.sitesProvider.getCurrentSite().write("mod_quiz_view_attempt",r)),o&&i.push(this.quizOfflineProvider.setAttemptCurrentPage(e,t)),Promise.all(i)},e.prototype.logViewAttemptReview=function(e){var t={attemptid:e};return this.sitesProvider.getCurrentSite().write("mod_quiz_view_attempt_review",t)},e.prototype.logViewAttemptSummary=function(e,t){var n={attemptid:e,preflightdata:this.utils.objectToArrayOfObjects(t,"name","value",!0)};return this.sitesProvider.getCurrentSite().write("mod_quiz_view_attempt_summary",n)},e.prototype.logViewQuiz=function(e){var t={quizid:e};return this.sitesProvider.getCurrentSite().write("mod_quiz_view_quiz",t)},e.prototype.processAttempt=function(e,t,n,o,r,i,s,a){return s?this.processAttemptOffline(e,t,n,o,r,a):this.processAttemptOnline(t.id,n,o,r,i,a)},e.prototype.processAttemptOnline=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={attemptid:e,data:s.utils.objectToArrayOfObjects(t,"name","value"),finishattempt:o?1:0,timeup:r?1:0,preflightdata:s.utils.objectToArrayOfObjects(n,"name","value")};return i.write("mod_quiz_process_attempt",a).then(function(e){return e&&e.warnings&&e.warnings.length?Promise.reject(e.warnings[0]):e&&e.state?e.state:Promise.reject(null)})})},e.prototype.processAttemptOffline=function(e,t,n,o,r,i){var s=this;return this.getAttemptSummary(t.id,o,!0,!1,!0,i).then(function(o){var a=s.utils.arrayToObject(o,"slot");return s.quizOfflineProvider.processAttempt(e,t,a,n,r,i)})},e.prototype.quizHasGrades=function(e){return e.grade>=5e-6&&e.sumgrades>=5e-6},e.prototype.rescaleGrade=function(e,t,n){void 0===n&&(n=!0);var o,r=parseFloat(e);return isNaN(r)||(o=t.sumgrades>=5e-6?r*t.grade/t.sumgrades:0),"question"===n?this.formatGrade(o,this.getGradeDecimals(t)):n?this.formatGrade(o,t.decimalpoints):null===o?null:void 0!==o?String(o):void 0},e.prototype.saveAttempt=function(e,t,n,o,r,i){try{return r?this.processAttemptOffline(e,t,n,o,!1,i):this.saveAttemptOnline(t.id,n,o,i)}catch(e){return this.logger.error(e),Promise.reject(null)}},e.prototype.saveAttemptOnline=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={attemptid:e,data:r.utils.objectToArrayOfObjects(t,"name","value"),preflightdata:r.utils.objectToArrayOfObjects(n,"name","value")};return o.write("mod_quiz_save_attempt",i).then(function(e){return e&&e.warnings&&e.warnings.length?Promise.reject(e.warnings[0]):e&&e.status?void 0:Promise.reject(null)})})},e.prototype.shouldShowTimeLeft=function(e,n,o){var r=this.timeUtils.timestamp();return n.state==t.ATTEMPT_IN_PROGRESS&&this.accessRulesDelegate.shouldShowTimeLeft(e,n,o,r)},e.prototype.startAttempt=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={quizid:e,preflightdata:r.utils.objectToArrayOfObjects(t,"name","value",!0),forcenew:n?1:0};return o.write("mod_quiz_start_attempt",i).then(function(e){return e&&e.warnings&&e.warnings.length?Promise.reject(e.warnings[0]):e&&e.attempt?e.attempt:Promise.reject(null)})})},e.COMPONENT="mmaModQuiz",e.ATTEMPT_FINISHED_EVENT="addon_mod_quiz_attempt_finished",e.GRADEHIGHEST=1,e.GRADEAVERAGE=2,e.ATTEMPTFIRST=3,e.ATTEMPTLAST=4,e.QUESTION_OPTIONS_MAX_ONLY=1,e.QUESTION_OPTIONS_MARK_AND_MAX=2,e.ATTEMPT_IN_PROGRESS="inprogress",e.ATTEMPT_OVERDUE="overdue",e.ATTEMPT_FINISHED="finished",e.ATTEMPT_ABANDONED="abandoned",e.QUIZ_SHOW_TIME_BEFORE_DEADLINE=3600,e=t=g([Object(o.A)(),y("design:paramtypes",[s.a,a.a,d.a,r.c,c.a,l.a,f.a,i.a,u.a,p.a,h.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(5),s=(n.n(i),n(303)),a=n(4),c=n(105),u=n(72),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o){var r=this;this.translate=e,this.configProvider=t,this.globalization=o,this.fallbackLanguage=u.a.default_lang||"en",this.customStrings={},this.sitePluginsStrings={},e.setDefaultLang(this.fallbackLanguage),e.use(this.fallbackLanguage),n.ready().then(function(){r.getCurrentLanguage().then(function(t){e.use(t),i.locale(t)})})}return e.prototype.addSitePluginsStrings=function(e,t,n){this.sitePluginsStrings[e]||(this.sitePluginsStrings[e]={});for(var o in t){var r=n+o,i=t[o];this.customStrings[e]&&this.customStrings[e][r]||(i=(i=(i=i.replace(/\$a->/gm,"$a.")).replace(/{([^ ]+)}/gm,"{{$1}}")).replace(/{{{([^ ]+)}}}/gm,"{{$1}}"),this.loadString(this.sitePluginsStrings,e,r,i))}},e.prototype.changeCurrentLanguage=function(e){var t=this,n=[];return n.push(new Promise(function(n,o){var r=t.translate.use(e).subscribe(function(e){n(e),setTimeout(function(){r.unsubscribe()})},function(e){o(e),setTimeout(function(){r.unsubscribe()})})})),n.push(this.configProvider.set("current_language",e)),i.locale(e),this.currentLanguage=e,Promise.all(n).finally(function(){(t.loadLangStrings(t.customStrings,e)||t.loadLangStrings(t.sitePluginsStrings,e))&&t.translate.onLangChange.emit({lang:e,translations:t.translate.translations[e]})})},e.prototype.clearCustomStrings=function(){this.unloadStrings(this.customStrings),this.customStrings={},this.customStringsRaw=""},e.prototype.clearSitePluginsStrings=function(){this.unloadStrings(this.sitePluginsStrings),this.sitePluginsStrings={}},e.prototype.getAllCustomStrings=function(){return this.customStrings},e.prototype.getAllSitePluginsStrings=function(){return this.sitePluginsStrings},e.prototype.getCurrentLanguage=function(){var e=this;return void 0!==this.currentLanguage?Promise.resolve(this.currentLanguage):this.configProvider.get("current_language").then(function(e){return e}).catch(function(){if(u.a.default_lang&&!u.a.forcedefaultlanguage)return u.a.default_lang;try{return e.globalization.getPreferredLanguage().then(function(e){var t=e.value.toLowerCase();return t.indexOf("-")>-1&&u.a.languages&&void 0===u.a.languages[t]&&(t=t.substr(0,t.indexOf("-"))),t}).catch(function(){return e.fallbackLanguage})}catch(t){return Promise.resolve(e.fallbackLanguage)}}).then(function(t){return e.currentLanguage=t,t})},e.prototype.loadCustomStrings=function(e){var t=this;if(e!=this.customStringsRaw&&(this.clearCustomStrings(),e)){e.split(/(?:\r\n|\r|\n)/).forEach(function(e){var n,o=e.split("|");if(!(o.length<3)){t.customStrings[n=o[2]]||(t.customStrings[n]={});var r=o[0].replace(/^mm\.core/,"core").replace(/^mm\./,"core.").replace(/^mma\./,"addon.").replace(/^core\.sidemenu/,"core.mainmenu").replace(/^addon\.grades/,"core.grades").replace(/^addon\.participants/,"core.user");t.loadString(t.customStrings,n,r,o[1])}}),this.customStringsRaw=e}},e.prototype.loadLangStrings=function(e,t){var n=!1;if(e[t])for(var o in e[t]){var r=e[t][o];r.applied||(r.original=this.translate.translations[t][o],this.translate.translations[t][o]=r.value,r.applied=!0,n=!0)}return n},e.prototype.loadString=function(e,t,n,o){this.translate.translations[t]?(e[t][n]={original:this.translate.translations[t][n],value:o,applied:!0},this.translate.translations[t][n]=o):e[t][n]={value:o,applied:!1}},e.prototype.unloadStrings=function(e){for(var t in e)if(this.translate.translations[t]){var n=e[t];for(var o in n){var r=n[o];r.original?this.translate.translations[t][o]=r.original:delete this.translate.translations[t][o]}}},e=d([Object(o.A)(),l("design:paramtypes",[r.c,c.a,a.s,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(2),s=n(41),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.sitesProvider=t,this.coursesProvider=n,this.ROOT_CACHE_KEY="mmGrades:",this.logger=e.getInstance("CoreGradesProvider")}return e.prototype.getCourseGradesCacheKey=function(e,t){return this.getCourseGradesPrefixCacheKey(e)+t},e.prototype.getCourseGradesItemsCacheKey=function(e,t,n){return n=n||0,this.getCourseGradesPrefixCacheKey(e)+t+":"+n},e.prototype.getCourseGradesPrefixCacheKey=function(e){return this.ROOT_CACHE_KEY+"items:"+e+":"},e.prototype.getCoursesGradesCacheKey=function(){return this.ROOT_CACHE_KEY+"coursesgrades"},e.prototype.getGradeItems=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),o=o||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(o).then(function(s){return t=t||s.getUserId(),i.isGradeItemsAvalaible(o).then(function(s){return s?i.getCourseGradesItems(e,t,n,o,r).catch(function(){return i.getCourseGradesTable(e,t,o,r)}):i.getCourseGradesTable(e,t,o,r)})})},e.prototype.getCourseGradesItems=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),this.sitesProvider.getSite(o).then(function(o){t=t||o.getUserId(),n=n||0,i.logger.debug("Get grades for course '"+e+"' and user '"+t+"'");var s={courseid:e,userid:t,groupid:n},a={cacheKey:i.getCourseGradesItemsCacheKey(e,t,n)};return r&&(a.getFromCache=0,a.emergencyCache=0),o.read("gradereport_user_get_grade_items",s,a).then(function(e){return e&&e.usergrades&&e.usergrades[0]?e.usergrades[0].gradeitems:Promise.reject(null)})})},e.prototype.getCourseGradesTable=function(e,t,n,o){var r=this;return void 0===o&&(o=!1),this.sitesProvider.getSite(n).then(function(n){t=t||n.getUserId(),r.logger.debug("Get grades for course '"+e+"' and user '"+t+"'");var i={courseid:e,userid:t},s={cacheKey:r.getCourseGradesCacheKey(e,t)};return o&&(s.getFromCache=0,s.emergencyCache=0),n.read("gradereport_user_get_grades_table",i,s).then(function(e){return e&&e.tables&&e.tables[0]?e.tables[0]:Promise.reject(null)})})},e.prototype.getCoursesGrades=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){t.logger.debug("Get course grades");var n={cacheKey:t.getCoursesGradesCacheKey()};return e.read("gradereport_overview_get_course_grades",void 0,n).then(function(e){return e&&e.grades?e.grades:Promise.reject(null)})})},e.prototype.invalidateAllCourseGradesData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getCourseGradesPrefixCacheKey(e))})},e.prototype.invalidateCourseGradesData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return t=t||n.getUserId(),n.invalidateWsCacheForKey(o.getCourseGradesCacheKey(e,t))})},e.prototype.invalidateCoursesGradesData=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getCoursesGradesCacheKey())})},e.prototype.invalidateCourseGradesItemsData=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(r.getCourseGradesItemsCacheKey(e,t,n))})},e.prototype.isCourseGradesEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){if(!e.wsAvailable("gradereport_overview_get_course_grades"))return!1;return-1!==(e.getStoredConfig("mygradesurl")||"").indexOf("/grade/report/overview/")})},e.prototype.isPluginEnabledForCourse=function(e,t){return e?this.coursesProvider.getUserCourse(e,!0,t).then(function(e){return!(e&&void 0!==e.showgrades&&0==e.showgrades)}):Promise.reject(null)},e.prototype.isGradeItemsAvalaible=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("gradereport_user_get_grade_items")})},e.prototype.logCourseGradesView=function(e,t){return t=t||this.sitesProvider.getCurrentSiteUserId(),this.sitesProvider.getCurrentSite().write("gradereport_user_view_grade_report",{courseid:e,userid:t})},e.prototype.logCoursesGradesView=function(e){return e||(e=this.sitesProvider.getCurrentSiteHomeId()),this.sitesProvider.getCurrentSite().write("gradereport_overview_view_grade_report",{courseid:e})},e.TYPE_NONE=0,e.TYPE_VALUE=1,e.TYPE_SCALE=2,e.TYPE_TEXT=3,e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(7),s=n(2),a=n(11),c=n(6),u=n(94),d=n(200),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,n,o,r,i,s){this.sitesProvider=n,this.utils=o,this.translate=r,this.textUtils=i,this.lessonOfflineProvider=s,this.tablesSchema={name:t.PASSWORD_TABLE,columns:[{name:"lessonid",type:"INTEGER",primaryKey:!0},{name:"password",type:"TEXT"},{name:"timemodified",type:"INTEGER"}]},this.ROOT_CACHE_KEY="mmaModLesson:",this.div=document.createElement("div"),this.logger=e.getInstance("AddonModLessonProvider"),this.sitesProvider.createTableFromSchema(this.tablesSchema)}return t=e,e.prototype.addMessage=function(e,t,n){e.push({message:this.translate.instant(t,n)})},e.prototype.addResultValueEolPage=function(e,t,n,o){var r="";if(o){r=this.translate.instant("addon.mod_lesson."+t,"boolean"!=typeof n?{$a:n}:void 0)}e.data[t]={name:t,value:n,message:r}},e.prototype.answerPageIsContent=function(e){return e.qtype==this.translate.instant("addon.mod_lesson.branchtable")||!(!e.answerdata||this.answerPageIsQuestion(e)||!e.answerdata.answers||!e.answerdata.answers[0])&&(this.div.innerHTML=e.answerdata.answers[0][0],!!this.div.querySelector('input[type="button"]'))},e.prototype.answerPageIsQuestion=function(e){if(!e.answerdata)return!1;if(e.answerdata.score)return!0;if(e.answerdata.answers)for(var t=0;t<e.answerdata.answers.length;t++){if(e.answerdata.answers[t][1])return!0}return!1},e.prototype.calculateOfflineData=function(e,t,n,o,r,i){t=t||{};var s,a=o||t.reviewmode,c=[],u="";return t.canmanage||(e.ongoing&&!a&&c.push(this.getOngoingScoreMessage(e,t,n,o,r,i).then(function(e){u=e})),e.progressbar&&c.push(this.calculateProgress(e.id,t,n,o,r,i).then(function(e){s=e}))),Promise.all(c).then(function(){return{reviewMode:a,progress:s,ongoingScore:u}})},e.prototype.calculateProgress=function(e,t,n,o,r,i){var s=this;if(i=i||this.sitesProvider.getCurrentSiteId(),o)return Promise.resolve(100);var a,c=t.attemptscount;return(r?Promise.resolve():this.getPages(e,n,!0,!1,i).then(function(e){r=s.createPagesIndex(e)})).then(function(){return s.getPagesIdsWithQuestionAttempts(e,c,!1,i)}).then(function(t){return a=t,s.getContentPagesViewedIds(e,c,i)}).then(function(e){var n={},o=t.firstpageid;for(a=s.utils.mergeArraysWithoutDuplicates(a,e);o;)o=s.validPageAndView(r,r[o],n,a);return 100*s.textUtils.roundToDecimals(a.length/Object.keys(n).length,2)})},e.prototype.checkAnswer=function(e,n,o,r,i){var s={answerid:0,noanswer:!1,correctanswer:!1,isessayquestion:!1,response:"",newpageid:0,studentanswer:"",userresponse:null,feedback:"",nodefaultresponse:!1,inmediatejump:!1};switch(n.page.qtype){case t.LESSON_PAGE_BRANCHTABLE:s.inmediatejump=!0,s.newpageid=this.getNewPageId(n.page.id,o.jumpto,r);break;case t.LESSON_PAGE_ESSAY:this.checkAnswerEssay(n,o,s);break;case t.LESSON_PAGE_MATCHING:this.checkAnswerMatching(n,o,s);break;case t.LESSON_PAGE_MULTICHOICE:this.checkAnswerMultichoice(e,n,o,i,s);break;case t.LESSON_PAGE_NUMERICAL:this.checkAnswerNumerical(e,n,o,i,s);break;case t.LESSON_PAGE_SHORTANSWER:this.checkAnswerShort(e,n,o,i,s);break;case t.LESSON_PAGE_TRUEFALSE:this.checkAnswerTruefalse(e,n,o,i,s)}return s},e.prototype.checkAnswerEssay=function(e,t,n){var o;if(n.isessayquestion=!0,!t)return n.inmediatejump=!0,void(n.newpageid=e.page.id);(o=void 0!==t["answer[text]"]?t["answer[text]"]:"object"==typeof t.answer?t.answer.text:t.answer)&&""!==o.trim()?(e.answers.forEach(function(e){n.answerid=e.id,n.newpageid=e.jumpto}),n.userresponse={sent:0,graded:0,score:0,answer:o,answerformat:1,response:"",responseformat:1},n.studentanswerformat=1,n.studentanswer=o):n.noanswer=!0},e.prototype.checkAnswerMatching=function(e,t,n){if(!t)return n.inmediatejump=!0,void(n.newpageid=e.page.id);var o=this.getUserResponseMatching(t),r=this.utils.clone(e.answers),i=r.shift(),s=r.shift(),a={};r.forEach(function(e){""===e.answer&&""===e.response||(a[e.id]=e)});var c=[],u=0;n.studentanswer="",n.studentanswerformat=1;for(var d in o){var l=o[d];if(!l)return void(n.noanswer=!0);if(l=this.textUtils.decodeHTML(l),c.push(l),void 0!==a[d]){var f=a[d];n.studentanswer+="<br />"+f.answer+" = "+l,f.response&&f.response.trim()==l.trim()&&u++}}n.userresponse=c.join(","),u==Object.keys(a).length?(n.correctanswer=!0,n.response=i.answer,n.answerid=i.id,n.newpageid=i.jumpto):(n.correctanswer=!1,n.response=s.answer,n.answerid=s.id,n.newpageid=s.jumpto)},e.prototype.checkAnswerMultichoice=function(e,t,n,o,r){var i=this;if(!n)return r.inmediatejump=!0,void(r.newpageid=t.page.id);var s=this.getUsedAnswersMultichoice(t);if(t.page.qoption){var a=this.getUserResponseMultichoice(n);if(!a||!Array.isArray(a))return void(r.noanswer=!0);r.userresponse=a.join(",");var c,u,d=[],l=0,f=0,p=0,h=0;r.studentanswer="",r.studentanswerformat=1,s.forEach(function(e){for(var t in a){if(a[t]==e.id){r.studentanswer+="<br />"+e.answer,i.textUtils.cleanTags(e.response).trim()&&d.push(e.response);break}}}),s.forEach(function(n){var r=i.isAnswerCorrect(e,t.page.id,n,o);a.forEach(function(e){e==n.id&&(r?l++:(void 0===u&&(u=n.jumpto),h||(h=n.id)))}),r&&(f++,void 0===c&&(c=n.jumpto),p||(p=n.id))}),a.length==f&&l==f?(r.correctanswer=!0,r.response=d.join("<br />"),r.newpageid=c,r.answerid=p):(r.correctanswer=!1,r.response=d.join("<br />"),r.newpageid=u,r.answerid=h)}else{if(void 0===n.answerid||!n.answerid&&0!==Number(n.answerid))return void(r.noanswer=!0);r.answerid=n.answerid;for(var m in t.answers){var g=t.answers[m];if(g.id==n.answerid){r.correctanswer=this.isAnswerCorrect(e,t.page.id,g,o),r.newpageid=g.jumpto,r.response=g.response,r.userresponse=r.studentanswer=g.answer;break}}}},e.prototype.checkAnswerNumerical=function(e,t,n,o,r){var i=parseFloat(n.answer);if(r.response="",r.newpageid=0,n.answer&&!isNaN(i)){r.useranswer=i,r.studentanswer=r.userresponse=r.useranswer;for(var s in t.answers){var a=t.answers[s],c=void 0,u=void 0;if(a.answer&&-1!=a.answer.indexOf(":")){var d=a.answer.split(":");u=parseFloat(d[0]),c=parseFloat(d[1])}else c=u=parseFloat(a.answer);if(r.useranswer>=u&&r.useranswer<=c){r.newpageid=a.jumpto,r.response=a.response,r.correctanswer=this.isAnswerCorrect(e,t.page.id,a,o),r.answerid=a.id;break}}}else r.noanswer=!0},e.prototype.checkAnswerShort=function(e,t,n,o,r){var i=!(!n.answer||!n.answer.trim)&&n.answer.trim();if(i){for(var s in t.answers){var a=t.answers[s],c=t.page.qoption,u=a.answer,d=!1,l=void 0;if(c?(l="","/i"==u.substr(-2)&&(u=u.substr(0,u.length-2),l="i")):(u=u.replace("*","#####"),u=(u=this.textUtils.escapeForRegex(u)).replace("#####",".*")),this.isAnswerCorrect(e,t.page.id,a,o))c?i.match(new RegExp("^"+u+"$",l))&&(d=!0):i.match(new RegExp("^"+u+"$","i"))&&(d=!0),d&&(r.correctanswer=!0);else if(c){switch(u.substr(0,2)){case"--":u=u.substr(2),i.match(new RegExp("^"+u+"$",l))||(d=!0);break;case"++":u=u.substr(2);var f=i.match(new RegExp(u,"g"+l));if(f){d=!0;for(var p=f[0].length,h=[],m=[],g=0;g<p;g++)h.push(f[0][g]),m.push('<span class="incorrect matches">'+f[0][g]+"</span>");i=i.replace(h,m)}break;default:i.match(new RegExp("^"+u+"$",l))&&(d=!0)}r.correctanswer=!1}else i.match(new RegExp("^"+u+"$","i"))&&(d=!0);if(d){r.newpageid=a.jumpto,r.response=a.response,r.answerid=a.id;break}}r.userresponse=i,r.studentanswer=this.textUtils.s(i)}else r.noanswer=!0},e.prototype.checkAnswerTruefalse=function(e,t,n,o,r){if(n.answerid){r.answerid=n.answerid;for(var i in t.answers){var s=t.answers[i];if(s.id==n.answerid){r.correctanswer=this.isAnswerCorrect(e,t.page.id,s,o),r.newpageid=s.jumpto,r.response=s.response,r.studentanswer=r.userresponse=s.answer;break}}}else r.noanswer=!0},e.prototype.createPagesIndex=function(e){var t={};return e.forEach(function(e){t[e.page.id]=e.page}),t},e.prototype.finishRetake=function(e,t,n,o,r,i,s,a){var c=this;if(i){var d=s.attemptscount;return this.lessonOfflineProvider.finishRetake(e.id,t,d,!0,o,a).then(function(){return c.lessonGrade(e,d,n,r,void 0,a).catch(function(){return{}})}).then(function(t){var i,d={data:{},messages:[],warnings:[]},l=[],f=!0;return c.addResultValueEolPage(d,"offline",!0),c.addResultValueEolPage(d,"gradeinfo",t),e.custom&&!s.canmanage&&t.nquestions<e.minquestions&&(f=!1,c.addMessage(d.messages,"addon.mod_lesson.numberofpagesviewednotice",{$a:{nquestions:t.nquestions,minquestions:e.minquestions}})),s.canmanage?e.grade!=u.a.TYPE_NONE&&c.addResultValueEolPage(d,"displayofgrade",!0,!0):f&&(l.push(c.calculateProgress(e.id,s,n,r,void 0,a).then(function(e){c.addResultValueEolPage(d,"progresscompleted",e)})),t.attempts?(e.custom||(c.addResultValueEolPage(d,"numberofpagesviewed",t.nquestions,!0),e.minquestions&&t.nquestions<e.minquestions&&c.addResultValueEolPage(d,"youshouldview",e.minquestions,!0),c.addResultValueEolPage(d,"numberofcorrectanswers",t.earned,!0)),i={score:t.earned,grade:t.total},t.nmanual?(i.tempmaxgrade=t.total-t.manualpoints,i.essayquestions=t.nmanual,c.addResultValueEolPage(d,"displayscorewithessays",i,!0)):c.addResultValueEolPage(d,"displayscorewithoutessays",i,!0),e.grade!=u.a.TYPE_NONE&&(i={grade:c.textUtils.roundToDecimals(t.grade*e.grade/100,1),total:e.grade},c.addResultValueEolPage(d,"yourcurrentgradeisoutof",i,!0))):e.timelimit?o&&c.addResultValueEolPage(d,"eolstudentoutoftimenoanswers",!0,!0):c.addResultValueEolPage(d,"welldone",!0,!0)),e.modattempts&&s.canmanage&&c.addResultValueEolPage(d,"modattemptsnoteacher",!0,!0),f&&c.addResultValueEolPage(d,"gradelesson",1),d})}return this.finishRetakeOnline(e.id,n,o,r,a)},e.prototype.finishRetakeOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={lessonid:e,outoftime:n?1:0,review:o?1:0};return"string"==typeof t&&(s.password=t),r.write("mod_lesson_finish_attempt",s).then(function(e){var t={};return e.data.forEach(function(e){e.value&&"string"==typeof e.value&&"1"!==e.value&&(e.value=i.textUtils.parseJSON(e.value)),t[e.name]=e}),e.data=t,e})})},e.prototype.getAccessInformation=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={lessonid:e},s={cacheKey:r.getAccessInformationCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_lesson_get_lesson_access_information",i,s)})},e.prototype.getAccessInformationCacheKey=function(e){return this.ROOT_CACHE_KEY+"accessInfo:"+e},e.prototype.getContentPagesViewed=function(e,n,o){var r=[],i=t.TYPE_STRUCTURE,s={online:[],offline:[]};return r.push(this.getContentPagesViewedOnline(e,n,!1,!1,o).then(function(e){s.online=e})),r.push(this.lessonOfflineProvider.getRetakeAttemptsForType(e,n,i,o).catch(function(){return[]}).then(function(e){s.offline=e})),Promise.all(r).then(function(){return s})},e.prototype.getContentPagesViewedCacheKey=function(e,t){return this.getContentPagesViewedCommonCacheKey(e)+":"+t},e.prototype.getContentPagesViewedCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"contentPagesViewed:"+e},e.prototype.getContentPagesViewedIds=function(e,t,n){return this.getContentPagesViewed(e,t,n).then(function(e){var t={};return e.online.concat(e.offline).forEach(function(e){t[e.pageid]||(t[e.pageid]=!0)}),Object.keys(t).map(function(e){return Number(e)})})},e.prototype.getContentPagesViewedOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={lessonid:e,lessonattempt:t},a={cacheKey:i.getContentPagesViewedCacheKey(e,t)};return n?a.omitExpires=!0:o&&(a.getFromCache=!1,a.emergencyCache=!1),r.read("mod_lesson_get_content_pages_viewed",s,a).then(function(e){return e.pages})})},e.prototype.getLastContentPageViewed=function(e,t,n){return this.getContentPagesViewed(e,t,n).then(function(e){var t,n=0;return e.online.forEach(function(e){e.timeseen>n&&(t=e,n=e.timeseen)}),e.offline.forEach(function(e){e.timemodified>n&&(t=e,n=e.timemodified)}),t}).catch(function(){})},e.prototype.getLastPageSeen=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r;return this.lessonOfflineProvider.getLastQuestionPageAttempt(e,t,n).then(function(i){return i&&(r=i.newpageid),o.getLastContentPageViewed(e,t,n).then(function(e){return e&&(i?e.timemodified>i.timemodified&&(r=e.newpageid||e.pageid):r=e.newpageid||e.pageid),r})})},e.prototype.getLesson=function(e,t,n,o){return this.getLessonByField(e,"coursemodule",t,n,o)},e.prototype.getLessonByField=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={courseids:[e]},a={cacheKey:i.getLessonDataCacheKey(e)};return o&&(a.omitExpires=!0),r.read("mod_lesson_get_lessons_by_courses",s,a).then(function(e){if(e&&e.lessons){var o=e.lessons.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getLessonById=function(e,t,n,o){return this.getLessonByField(e,"id",t,n,o)},e.prototype.getLessonDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"lesson:"+e},e.prototype.getLessonWithPassword=function(e,t,n,o,r,i){var s=this;return void 0===n&&(n=!0),this.sitesProvider.getSite(i).then(function(i){var a={lessonid:e},c={cacheKey:s.getLessonWithPasswordCacheKey(e)};return"string"==typeof t&&(a.password=t),o?c.omitExpires=!0:r&&(c.getFromCache=!1,c.emergencyCache=!1),i.read("mod_lesson_get_lesson",a,c).then(function(t){return void 0===t.lesson.ongoing&&(s.removeStoredPassword(e,i.id),n)?s.invalidateLessonWithPassword(e,i.id).catch(function(){}).then(function(){return Promise.reject(s.translate.instant("addon.mod_lesson.loginfail"))}):t.lesson})})},e.prototype.getLessonWithPasswordCacheKey=function(e){return this.ROOT_CACHE_KEY+"lessonWithPswrd:"+e},e.prototype.getNewPageId=function(e,t,n){return n&&n[e]&&n[e][t]?n[e][t].calculatedjump:t||e},e.prototype.getOngoingScoreMessage=function(e,t,n,o,r,i){var s=this;if(t.canmanage)return Promise.resolve(this.translate.instant("addon.mod_lesson.teacherongoingwarning"));var a=t.attemptscount;return o&&a--,this.lessonGrade(e,a,n,o,r,i).then(function(t){var n={};return e.custom?(n.score=t.earned,n.currenthigh=t.total,s.translate.instant("addon.mod_lesson.ongoingcustom",{$a:n})):(n.correct=t.earned,n.viewed=t.attempts,s.translate.instant("addon.mod_lesson.ongoingnormal",{$a:n}))})},e.prototype.getPageAnswers=function(e,t,n,o,r){return this.getPageData(e,t,n,o,!0,!0,!1,void 0,void 0,r).then(function(e){return e.answers})},e.prototype.getPagesAnswers=function(e,t,n,o,r){var i=this,s={},a=[];return t.forEach(function(t){a.push(i.getPageAnswers(e,t,n,o,r).then(function(e){e.forEach(function(e){e.pageid=t,s[e.id]=e})}))}),Promise.all(a).then(function(){return s})},e.prototype.getPageData=function(e,t,n,o,r,i,s,a,c,u){var d=this;return this.sitesProvider.getSite(u).then(function(l){var f={lessonid:e.id,pageid:Number(t),review:o?1:0,returncontents:r?1:0},p={cacheKey:d.getPageDataCacheKey(e.id,t)};return"string"==typeof n&&(f.password=n),i?p.omitExpires=!0:s&&(p.getFromCache=!1,p.emergencyCache=!1),o&&(p.getFromCache=!1,p.saveToCache=!1,p.emergencyCache=!1),l.read("mod_lesson_get_page_data",f,p).then(function(t){return i&&a&&t.page?d.calculateOfflineData(e,a,n,o,void 0,u).then(function(r){return Object.assign(t,r),d.getPageViewMessages(e,a,t.page,o,c,n,u)}).then(function(e){return t.messages=e,t}):t})})},e.prototype.getPageDataCacheKey=function(e,t){return this.getPageDataCommonCacheKey(e)+":"+t},e.prototype.getPageDataCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"pageData:"+e},e.prototype.getPages=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={lessonid:e},a={cacheKey:i.getPagesCacheKey(e)};return"string"==typeof t&&(s.password=t),n?a.omitExpires=!0:o&&(a.getFromCache=!1,a.emergencyCache=!1),r.read("mod_lesson_get_pages",s,a).then(function(e){return e.pages})})},e.prototype.getPagesCacheKey=function(e){return this.ROOT_CACHE_KEY+"pages:"+e},e.prototype.getPagesPossibleJumps=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={lessonid:e},s={cacheKey:r.getPagesPossibleJumpsCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_lesson_get_pages_possible_jumps",i,s).then(function(e){if(e.jumps){var t={};return e.jumps.forEach(function(e){void 0===t[e.pageid]&&(t[e.pageid]={}),t[e.pageid][e.jumpto]=e}),t}return Promise.reject(null)})})},e.prototype.getPagesPossibleJumpsCacheKey=function(e){return this.ROOT_CACHE_KEY+"pagesJumps:"+e},e.prototype.getPageProcessMessages=function(e,t,n,o,r){var i=[];return t.canmanage&&(this.lessonDisplayTeacherWarning(r)&&this.addMessage(i,"addon.mod_lesson.teacherjumpwarning",{$a:{cluster:this.translate.instant("addon.mod_lesson.clusterjump"),unseen:this.translate.instant("addon.mod_lesson.unseenpageinbranch")}}),e.timelimit&&this.addMessage(i,"addon.mod_lesson.teachertimerwarning")),n.attemptsremaining>0&&e.review&&!o&&this.addMessage(i,"addon.mod_lesson.attemptsremaining",{$a:n.attemptsremaining}),i},e.prototype.getPagesIdsWithQuestionAttempts=function(e,t,n,o,r){return this.getQuestionsAttempts(e,t,n,void 0,o,r).then(function(e){var t={};return e.online.concat(e.offline).forEach(function(e){t[e.pageid]||(t[e.pageid]=!0)}),Object.keys(t).map(function(e){return Number(e)})})},e.prototype.getPageViewMessages=function(e,n,o,r,i,s,a){var c=this,d=[],l=Promise.resolve();if(n.canmanage)e.timelimit&&this.addMessage(d,"addon.mod_lesson.teachertimerwarning"),this.lessonDisplayTeacherWarning(i)&&this.addMessage(d,"addon.mod_lesson.teacherjumpwarning",{$a:{cluster:this.translate.instant("addon.mod_lesson.clusterjump"),unseen:this.translate.instant("addon.mod_lesson.unseenpageinbranch")}});else if(o.qtype==t.LESSON_PAGE_BRANCHTABLE&&e.minquestions){l=this.lessonGrade(e,n.attemptscount,s,r,void 0,a).then(function(t){t.attempts&&(t.nquestions<e.minquestions&&c.addMessage(d,"addon.mod_lesson.numberofpagesviewednotice",{$a:{nquestions:t.nquestions,minquestions:e.minquestions}}),r||e.retake||(c.addMessage(d,"addon.mod_lesson.numberofcorrectanswers",{$a:t.earned}),e.grade!=u.a.TYPE_NONE&&c.addMessage(d,"addon.mod_lesson.yourcurrentgradeisoutof",{$a:{grade:c.textUtils.roundToDecimals(t.grade*e.grade/100,1),total:e.grade}})))}).catch(function(){})}return l.then(function(){return d})},e.prototype.getQuestionsAttempts=function(e,t,n,o,r,i){var s=[],a={online:[],offline:[]};return s.push(this.getQuestionsAttemptsOnline(e,t,n,o,!1,!1,r,i).then(function(e){a.online=e})),s.push(this.lessonOfflineProvider.getQuestionsAttempts(e,t,n,o,r).catch(function(){return[]}).then(function(e){a.offline=e})),Promise.all(s).then(function(){return a})},e.prototype.getQuestionsAttemptsCacheKey=function(e,t,n){return this.getQuestionsAttemptsCommonCacheKey(e)+":"+n+":"+t},e.prototype.getQuestionsAttemptsCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"questionsAttempts:"+e},e.prototype.getQuestionsAttemptsOnline=function(e,t,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(s).then(function(s){a=a||s.getUserId();var u={lessonid:e,attempt:t,userid:a},d={cacheKey:c.getQuestionsAttemptsCacheKey(e,t,a)};return r?d.omitExpires=!0:i&&(d.getFromCache=!1,d.emergencyCache=!1),s.read("mod_lesson_get_questions_attempts",u,d).then(function(e){return o||n?e.attempts.filter(function(e){return!(n&&!e.correct)&&(!o||e.pageid==o)}):e.attempts})})},e.prototype.getRetakesOverview=function(e,t,n,o,r){var i=this;return t=t||0,this.sitesProvider.getSite(r).then(function(r){var s={lessonid:e,groupid:t},a={cacheKey:i.getRetakesOverviewCacheKey(e,t)};return n?a.omitExpires=!0:o&&(a.getFromCache=!1,a.emergencyCache=!1),r.read("mod_lesson_get_attempts_overview",s,a).then(function(e){return e.data})})},e.prototype.getRetakesOverviewCacheKey=function(e,t){return this.getRetakesOverviewCommonCacheKey(e)+":"+t},e.prototype.getRetakesOverviewCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"retakesOverview:"+e},e.prototype.getStoredPassword=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecord(t.PASSWORD_TABLE,{lessonid:e}).then(function(e){return e.password})})},e.prototype.getSubpagesOf=function(e,t,n){var o=[];for(t=e[t].nextpageid,n=n||[];t&&-1==n.indexOf(e[t].qtype);)o.push(e[t]),t=e[t].nextpageid;return o},e.prototype.getTimers=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){r=r||o.getUserId();var s={lessonid:e,userid:r},a={cacheKey:i.getTimersCacheKey(e,r)};return t?a.omitExpires=!0:n&&(a.getFromCache=!1,a.emergencyCache=!1),o.read("mod_lesson_get_user_timers",s,a).then(function(e){return e.timers})})},e.prototype.getTimersCacheKey=function(e,t){return this.getTimersCommonCacheKey(e)+":"+t},e.prototype.getTimersCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"timers:"+e},e.prototype.getUsedAnswersMultichoice=function(e){return this.utils.clone(e.answers).filter(function(e){return""!==e.answer})},e.prototype.getUserResponseMatching=function(e){if(e.response)return e.response;var t={};for(var n in e){var o=n.match(/^response\[(\d+)\]/);o&&o.length>1&&(t[o[1]]=e[n])}return t},e.prototype.getUserResponseMultichoice=function(e){if(e.answer)return Array.isArray(e.answer)?e.answer.map(function(e){return parseInt(e,10)}):e.answer;var t=[];for(var n in e){var o=n.match(/^answer\[(\d+)\]/);o&&o.length>1&&t.push(parseInt(o[1],10))}return t},e.prototype.getUserRetake=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){n=n||i.getUserId();var a={lessonid:e,userid:n,lessonattempt:t},c={cacheKey:s.getUserRetakeCacheKey(e,n,t)};return o?c.omitExpires=!0:r&&(c.getFromCache=!1,c.emergencyCache=!1),i.read("mod_lesson_get_user_attempt",a,c)})},e.prototype.getUserRetakeCacheKey=function(e,t,n){return this.getUserRetakeUserCacheKey(e,t)+":"+n},e.prototype.getUserRetakeUserCacheKey=function(e,t){return this.getUserRetakeLessonCacheKey(e)+":"+t},e.prototype.getUserRetakeLessonCacheKey=function(e){return this.ROOT_CACHE_KEY+"userRetake:"+e},e.prototype.jumptoIsCorrect=function(e,n,o){if(!n)return!1;if(n==t.LESSON_NEXTPAGE)return!0;if(n==t.LESSON_UNSEENBRANCHPAGE)return!0;if(n==t.LESSON_RANDOMPAGE)return!0;if(n==t.LESSON_CLUSTERJUMP)return!0;if(n==t.LESSON_EOL)return!0;for(var r=o[e].nextpageid;r;){if(n==r)return!0;r=o[r].nextpageid}return!1},e.prototype.invalidateAccessInformation=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getAccessInformationCacheKey(e))})},e.prototype.invalidateContentPagesViewed=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getContentPagesViewedCommonCacheKey(e))})},e.prototype.invalidateContentPagesViewedForRetake=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getContentPagesViewedCacheKey(e,t))})},e.prototype.invalidateLessonData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getLessonDataCacheKey(e))})},e.prototype.invalidateLessonWithPassword=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getLessonWithPasswordCacheKey(e))})},e.prototype.invalidatePageData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getPageDataCommonCacheKey(e))})},e.prototype.invalidatePageDataForPage=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getPageDataCacheKey(e,t))})},e.prototype.invalidatePages=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getPagesCacheKey(e))})},e.prototype.invalidatePagesPossibleJumps=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getPagesPossibleJumpsCacheKey(e))})},e.prototype.invalidateQuestionsAttempts=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getQuestionsAttemptsCommonCacheKey(e))})},e.prototype.invalidateQuestionsAttemptsForRetake=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.invalidateWsCacheForKey(r.getQuestionsAttemptsCacheKey(e,t,o))})},e.prototype.invalidateRetakesOverview=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getRetakesOverviewCommonCacheKey(e))})},e.prototype.invalidateRetakesOverviewForGroup=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getRetakesOverviewCacheKey(e,t))})},e.prototype.invalidateTimers=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getTimersCommonCacheKey(e))})},e.prototype.invalidateTimersForUser=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getTimersCacheKey(e,n))})},e.prototype.invalidateUserRetake=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.invalidateWsCacheForKey(r.getUserRetakeCacheKey(e,n,t))})},e.prototype.invalidateUserRetakesForLesson=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getUserRetakeLessonCacheKey(e))})},e.prototype.invalidateUserRetakesForUser=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return t=t||n.getUserId(),n.invalidateWsCacheForKeyStartingWith(o.getUserRetakeUserCacheKey(e,t))})},e.prototype.isAnswerCorrect=function(e,t,n,o){return e.custom?n.score>0:this.jumptoIsCorrect(t,n.jumpto,o)},e.prototype.isLessonOffline=function(e){return!!e.allowofflineattempts},e.prototype.isPasswordProtected=function(e){if(e&&e.preventaccessreasons)for(var t=0;t<e.preventaccessreasons.length;t++){if("passwordprotectedlesson"==e.preventaccessreasons[t].reason)return!0}return!1},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("mod_lesson_get_lesson_access_information")})},e.prototype.isQuestionPage=function(e){return e==t.TYPE_QUESTION},e.prototype.launchRetake=function(e,t,n,o,r){return this.sitesProvider.getSite(r).then(function(r){var i={lessonid:e,review:o?1:0};return"string"==typeof t&&(i.password=t),"number"==typeof n&&(i.pageid=n),r.write("mod_lesson_launch_attempt",i)})},e.prototype.leftDuringTimed=function(e){return e&&e.lastpageseen&&e.lastpageseen!=t.LESSON_EOL&&e.leftduringtimedsession},e.prototype.lessonDisplayTeacherWarning=function(e){if(!e)return!1;for(var n in e)for(var o in e[n]){var r=Number(o);if(r==t.LESSON_CLUSTERJUMP||r==t.LESSON_UNSEENBRANCHPAGE)return!0}return!1},e.prototype.lessonGrade=function(e,n,o,r,i,s,a){var c=this,u=0,d=0,l=0,f=0,p=0,h=0,m=0;return this.getQuestionsAttempts(e.id,n,!1,void 0,s,a).then(function(n){var a=n.online.concat(n.offline);if(a.length){var f={};return(i?Promise.resolve():c.getPages(e.id,o,!0,!1,s).then(function(e){i=c.createPagesIndex(e)})).then(function(){var t=[];a.forEach(function(e){f[e.pageid]||(f[e.pageid]=[],t.push(e.pageid)),f[e.pageid].push(e)});for(var n in f){var i=f[n].sort(function(e,t){return(e.timeseen||e.timemodified)-(t.timeseen||t.timemodified)});f[n]=i.slice(0,e.maxattempts)}return c.getPagesAnswers(e,t,o,r,s)}).then(function(n){p=Object.keys(f).length;for(var o in f){var r=f[o],s=r[r.length-1];e.custom?i[s.pageid].qtype==t.LESSON_PAGE_ESSAY?(s.useranswer&&void 0!==s.useranswer.score&&(m+=s.useranswer.score),d++,l+=n[s.answerid].score):s.answerid&&(m+=n[s.answerid].score):(r.forEach(function(e){m+=e.correct?1:0}),i[s.pageid].qtype==t.LESSON_PAGE_ESSAY&&(d++,l++)),u+=r.length}if(e.custom){var a={};for(var c in n){var g=n[c];void 0===a[g.pageid]?a[g.pageid]=g.score:a[g.pageid]<g.score&&(a[g.pageid]=g.score)}for(var o in a)h+=a[o]}else h=e.minquestions&&p<e.minquestions?u+(e.minquestions-p):u})}}).then(function(){return h&&(f=c.textUtils.roundToDecimals(100*m/h,5)),{nquestions:p,attempts:u,total:h,earned:m,grade:f,nmanual:d,manualpoints:l}})},e.prototype.logViewLesson=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){var o={lessonid:e};return"string"==typeof t&&(o.password=t),n.write("mod_lesson_view_lesson",o).then(function(e){return e.status?e:Promise.reject(null)})})},e.prototype.processPage=function(e,t,n,o,r,i,s,a,c,u){var d=this;u=u||this.sitesProvider.getCurrentSiteId();var l,f,p=n.page.id;return s?this.getPages(e.id,r,!0,!1,u).then(function(r){return f=d.createPagesIndex(r),n.answers.length?d.recordAttempt(e,t,n,o,i,a,c,f,u):{nodefaultresponse:!0,newpageid:o.newpageid}}).then(function(t){return l=t,l.newpageid=d.getNewPageId(n.page.id,l.newpageid,c),d.calculateOfflineData(e,a,r,i,f,u)}).then(function(t){return l.warnings=[],l.displaymenu=n.displaymenu,l.messages=d.getPageProcessMessages(e,a,l,i,c),Object.assign(l,t),l}):this.processPageOnline(e.id,p,o,r,i,u)},e.prototype.processPageOnline=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={lessonid:e,pageid:t,data:s.utils.objectToArrayOfObjects(n,"name","value",!0),review:r?1:0};return"string"==typeof o&&(a.password=o),i.write("mod_lesson_process_page",a)})},e.prototype.recordAttempt=function(e,n,o,r,i,s,a,c,u){var d=this,l=this.checkAnswer(e,o,r,a,c),f=s.attemptscount;if(l.inmediatejump)return o.page.qtype==t.LESSON_PAGE_BRANCHTABLE?this.lessonOfflineProvider.processPage(e.id,n,f,o.page,r,l.newpageid,l.answerid,!1,l.userresponse,u).then(function(){return l}):Promise.resolve(l);var p,h=Promise.resolve(),m=!1;return l.attemptsremaining=0,l.maxattemptsreached=!1,l.noanswer?(l.newpageid=o.page.id,l.feedback=this.translate.instant("addon.mod_lesson.noanswer")):(s.canmanage||(h=this.getQuestionsAttempts(e.id,f,!1,o.page.id,u).then(function(s){if((p=s.online.length+s.offline.length)>=e.maxattempts)return l.maxattemptsreached=!0,l.feedback=d.translate.instant("addon.mod_lesson.maximumnumberofattemptsreached"),l.newpageid=t.LESSON_NEXTPAGE,void(m=!0);var c;if(!i&&(e.retake||!e.retake&&!f)){var h=d.getNewPageId(o.page.id,l.newpageid,a);c=d.lessonOfflineProvider.processPage(e.id,n,f,o.page,r,h,l.answerid,l.correctanswer,l.userresponse,u),p++}return l.correctanswer||l.newpageid||(p>=e.maxattempts?(e.maxattempts>1&&(l.maxattemptsreached=!0),l.newpageid=t.LESSON_NEXTPAGE):e.maxattempts>1&&(l.attemptsremaining=e.maxattempts-p)),c})),h=h.then(function(){if(!m&&(l.response||(e.feedback||l.noanswer||e.review&&!l.correctanswer&&!l.isessayquestion?l.response=d.translate.instant(l.isessayquestion?"addon.mod_lesson.defaultessayresponse":l.correctanswer?"addon.mod_lesson.thatsthecorrectanswer":"addon.mod_lesson.thatsthewronganswer"):l.nodefaultresponse=!0),l.response)){var t=void 0;!e.review||l.correctanswer||l.isessayquestion?(l.feedback="",t=Promise.resolve()):(t=void 0===p?d.getQuestionsAttempts(e.id,f,!1,o.page.id,u).then(function(e){p=e.online.length+e.offline.length}):Promise.resolve()).then(function(){l.feedback='<div class="box feedback">'+d.translate.instant("addon.mod_lesson."+(1==p?"firstwrong":"secondpluswrong"))+"</div>"});var n="response";return l.correctanswer?n+=" correct":l.isessayquestion||(n+=" incorrect"),t.then(function(){l.feedback+='<div class="box generalbox boxaligncenter">'+o.page.contents+"</div>",l.feedback+='<div class="correctanswer generalbox"><em>'+d.translate.instant("addon.mod_lesson.youranswer")+"</em> : "+(l.studentanswerformat?l.studentanswer:d.textUtils.cleanTags(l.studentanswer))+'<div class="box '+n+'">'+l.response+"</div></div>"})}})),h.then(function(){return l})},e.prototype.removeStoredPassword=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().deleteRecords(t.PASSWORD_TABLE,{lessonid:e})})},e.prototype.storePassword=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={lessonid:e,password:n,timemodified:Date.now()};return o.getDb().insertRecord(t.PASSWORD_TABLE,r)})},e.prototype.validPageAndView=function(e,n,o,r){if(n.qtype!=t.LESSON_PAGE_ENDOFCLUSTER&&n.qtype!=t.LESSON_PAGE_ENDOFBRANCH&&(o[n.id]=1),n.qtype==t.LESSON_PAGE_CLUSTER){this.getSubpagesOf(e,n.id,[t.LESSON_PAGE_ENDOFCLUSTER]).forEach(function(e){var t=r.indexOf(e.id);-1!=t&&(delete r[t],-1==r.indexOf(n.id)&&r.push(n.id))})}return n.nextpageid},e.COMPONENT="mmaModLesson",e.LESSON_THISPAGE=0,e.LESSON_UNSEENPAGE=1,e.LESSON_UNANSWEREDPAGE=2,e.LESSON_NEXTPAGE=-1,e.LESSON_EOL=-9,e.LESSON_UNSEENBRANCHPAGE=-50,e.LESSON_RANDOMPAGE=-60,e.LESSON_RANDOMBRANCH=-70,e.LESSON_CLUSTERJUMP=-80,e.TYPE_QUESTION=0,e.TYPE_STRUCTURE=1,e.LESSON_PAGE_SHORTANSWER=1,e.LESSON_PAGE_TRUEFALSE=2,e.LESSON_PAGE_MULTICHOICE=3,e.LESSON_PAGE_MATCHING=5,e.LESSON_PAGE_NUMERICAL=8,e.LESSON_PAGE_ESSAY=10,e.LESSON_PAGE_BRANCHTABLE=20,e.LESSON_PAGE_ENDOFBRANCH=21,e.LESSON_PAGE_CLUSTER=30,e.LESSON_PAGE_ENDOFCLUSTER=31,e.PASSWORD_TABLE="addon_mod_lesson_password",e=t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,c.a,r.c,a.a,d.a])],e);var t}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(12),i=n(7),s=n(2),a=n(10),c=n(727),u=n(58),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r){var i=e.call(this,"CoreCoursesCourseFormatDelegate",t,n,o)||this;return i.sitesProvider=n,i.defaultHandler=r,i.featurePrefix="CoreCourseFormatDelegate_",i.handlerNameProperty="format",i}return d(t,e),t.prototype.canViewAllSections=function(e){return this.executeFunctionOnEnabled(e.format,"canViewAllSections",[e])},t.prototype.displayEnableDownload=function(e){return this.executeFunctionOnEnabled(e.format,"displayEnableDownload",[e])},t.prototype.displayRefresher=function(e,t){return this.executeFunctionOnEnabled(e.format,"displayRefresher",[e,t])},t.prototype.displaySectionSelector=function(e){return this.executeFunctionOnEnabled(e.format,"displaySectionSelector",[e])},t.prototype.getAllSectionsComponent=function(e,t){var n=this;return Promise.resolve(this.executeFunctionOnEnabled(t.format,"getAllSectionsComponent",[e,t])).catch(function(e){n.logger.error("Error getting all sections component",e)})},t.prototype.getCourseFormatComponent=function(e,t){var n=this;return Promise.resolve(this.executeFunctionOnEnabled(t.format,"getCourseFormatComponent",[e,t])).catch(function(e){n.logger.error("Error getting course format component",e)})},t.prototype.getCourseSummaryComponent=function(e,t){var n=this;return Promise.resolve(this.executeFunctionOnEnabled(t.format,"getCourseSummaryComponent",[e,t])).catch(function(e){n.logger.error("Error getting course summary component",e)})},t.prototype.getCourseTitle=function(e,t){return this.executeFunctionOnEnabled(e.format,"getCourseTitle",[e,t])},t.prototype.getCurrentSection=function(e,t){return Promise.resolve(this.executeFunctionOnEnabled(e.format,"getCurrentSection",[e,t])).catch(function(){return t[0].id!=a.a.ALL_SECTIONS_ID?t[0]:t[1]})},t.prototype.getSectionSelectorComponent=function(e,t){var n=this;return Promise.resolve(this.executeFunctionOnEnabled(t.format,"getSectionSelectorComponent",[e,t])).catch(function(e){n.logger.error("Error getting section selector component",e)})},t.prototype.getSingleSectionComponent=function(e,t){var n=this;return Promise.resolve(this.executeFunctionOnEnabled(t.format,"getSingleSectionComponent",[e,t])).catch(function(e){n.logger.error("Error getting single section component",e)})},t.prototype.invalidateData=function(e,t){return this.executeFunctionOnEnabled(e.format,"invalidateData",[e,t])},t.prototype.openCourse=function(e,t){return this.executeFunctionOnEnabled(t.format,"openCourse",[e,t])},t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,r.a,c.a])],t)}(u.a)},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(58),c=n(736),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,"AddonModAssignSubmissionDelegate",t,n,o)||this;return i.defaultHandler=r,i.handlerNameProperty="type",i}return u(t,e),t.prototype.canPluginEditOffline=function(e,t,n){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"canEditOffline",[e,t,n]))},t.prototype.clearTmpData=function(e,t,n,o){return this.executeFunctionOnEnabled(n.type,"clearTmpData",[e,t,n,o])},t.prototype.copyPluginSubmissionData=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(t.type,"copySubmissionData",[e,t,n,o,r]))},t.prototype.deletePluginOfflineData=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"deleteOfflineData",[e,t,n,o,r]))},t.prototype.getComponentForPlugin=function(e,t,n){return Promise.resolve(this.executeFunctionOnEnabled(t.type,"getComponent",[e,t,n]))},t.prototype.getPluginFiles=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"getPluginFiles",[e,t,n,o]))},t.prototype.getPluginName=function(e){return this.executeFunctionOnEnabled(e.type,"getPluginName",[e])},t.prototype.getPluginSizeForCopy=function(e,t){return Promise.resolve(this.executeFunctionOnEnabled(t.type,"getSizeForCopy",[e,t]))},t.prototype.getPluginSizeForEdit=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"getSizeForEdit",[e,t,n,o]))},t.prototype.hasPluginDataChanged=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"hasDataChanged",[e,t,n,o]))},t.prototype.isPluginSupported=function(e){return this.hasHandler(e,!0)},t.prototype.isPluginSupportedForEdit=function(e){return Promise.resolve(this.executeFunctionOnEnabled(e,"isEnabledForEdit"))},t.prototype.prefetch=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"prefetch",[e,t,n,o]))},t.prototype.preparePluginSubmissionData=function(e,t,n,o,r,i,s,a){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"prepareSubmissionData",[e,t,n,o,r,i,s,a]))},t.prototype.preparePluginSyncData=function(e,t,n,o,r,i){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"prepareSyncData",[e,t,n,o,r,i]))},t=d([Object(o.A)(),l("design:paramtypes",[r.a,s.a,i.a,c.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(7),i=n(2),s=n(9),a=n(26),c=n(327),u=n(6),d=n(22),l=n(186),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s,a){this.sitesProvider=t,this.appProvider=n,this.userProvider=o,this.messagesOffline=r,this.utils=i,this.timeUtils=s,this.emulatorHelper=a,this.ROOT_CACHE_KEY="mmaMessages:",this.LIMIT_MESSAGES=50,this.LIMIT_SEARCH_MESSAGES=50,this.logger=e.getInstance("AddonMessagesProvider")}return t=e,e.prototype.addContact=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.write("core_message_create_contacts",{userids:[e]}).then(function(){return n.invalidateAllContactsCache(t.getUserId(),t.getId())})})},e.prototype.blockContact=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.write("core_message_block_contacts",{userids:[e]}).then(function(){return n.invalidateAllContactsCache(t.getUserId(),t.getId())})})},e.prototype.deleteMessage=function(e){return e.id?this.deleteMessageOnline(e.id,e.read):this.messagesOffline.deleteMessage(e.touserid,e.smallmessage,e.timecreated)},e.prototype.deleteMessageOnline=function(e,t,n){var o=this,r={messageid:e,userid:n=n||this.sitesProvider.getCurrentSiteUserId(),read:t};return this.sitesProvider.getCurrentSite().write("core_message_delete_message",r).then(function(){return o.invalidateDiscussionCache(n)})},e.prototype.getCacheKeyForBlockedContacts=function(e){return this.ROOT_CACHE_KEY+"blockedContacts:"+e},e.prototype.getCacheKeyForContacts=function(){return this.ROOT_CACHE_KEY+"contacts"},e.prototype.getCacheKeyForDiscussion=function(e){return this.ROOT_CACHE_KEY+"discussion:"+e},e.prototype.getCacheKeyForMessageCount=function(e){return this.ROOT_CACHE_KEY+"count:"+e},e.prototype.getCacheKeyForDiscussions=function(){return this.ROOT_CACHE_KEY+"discussions"},e.prototype.getAllContacts=function(e){var t=this;return e=e||this.sitesProvider.getCurrentSiteId(),this.getContacts(e).then(function(n){return t.getBlockedContacts(e).then(function(e){return n.blocked=e.users,t.storeUsersFromAllContacts(n),n}).catch(function(){return n.blocked=[],t.storeUsersFromAllContacts(n),n})})},e.prototype.getBlockedContacts=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n=e.getUserId(),o={userid:n},r={cacheKey:t.getCacheKeyForBlockedContacts(n)};return e.read("core_message_get_blocked_users",o,r)})},e.prototype.getContacts=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n={cacheKey:t.getCacheKeyForContacts()};return e.read("core_message_get_contacts",void 0,n).then(function(e){var t={},n=function(n){t[n]||(t[n]=[]),e[n].forEach(function(e){e.id>0&&t[n].push(e)})};for(var o in e)n(o);return t})})},e.prototype.getDiscussion=function(e,t,n,o,r,i,s,a){var c=this;return void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===s&&(s=!0),this.sitesProvider.getSite(a).then(function(u){var d,l,f={},p={cacheKey:c.getCacheKeyForDiscussion(e)},h={useridto:u.getUserId(),useridfrom:e,limitnum:c.LIMIT_MESSAGES};return(n>0||o>0||r>0||i>0)&&(p.getFromCache=!1,p.saveToCache=!1,p.emergencyCache=!1),c.getRecentMessages(h,p,n,o,s,u.getId()).then(function(t){return f.messages=t,h.useridto=e,h.useridfrom=u.getUserId(),d=t.length>0,c.getRecentMessages(h,p,r,i,s,a)}).then(function(n){return f.messages=f.messages.concat(n),l=n.length>0,f.messages.length>c.LIMIT_MESSAGES?(f.canLoadMore=!0,f.messages=c.sortMessages(f.messages),f.messages=f.messages.slice(-c.LIMIT_MESSAGES)):f.canLoadMore=!(f.messages.length!=c.LIMIT_MESSAGES||d&&l),t?f:c.messagesOffline.getMessages(e).then(function(e){return e.forEach(function(e){e.pending=!0,e.text=e.smallmessage}),f.messages=f.messages.concat(e),f})})})},e.prototype.getDiscussions=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n={},o=e.getUserId(),r={useridto:o,useridfrom:0,limitnum:t.LIMIT_MESSAGES},i={cacheKey:t.getCacheKeyForDiscussions()},s=function(e,t,r){void 0===n[t]&&(n[t]={fullname:r,profileimageurl:""},e.timeread||e.pending||e.useridfrom==o||(n[t].unread=!0));var i=n[t].message;(void 0===i||!i.pending&&e.pending||i.pending==e.pending&&(i.timecreated<e.timecreated||i.timecreated==e.timecreated&&i.id<e.id))&&(n[t].message={id:e.id,user:t,message:e.text,timecreated:e.timecreated,pending:!!e.pending})};return t.getRecentMessages(r,i,void 0,void 0,void 0,e.getId()).then(function(e){return e.forEach(function(e){s(e,e.useridfrom,e.userfromfullname)}),r.useridfrom=r.useridto,r.useridto=0,t.getRecentMessages(r,i)}).then(function(n){return n.forEach(function(e){s(e,e.useridto,e.usertofullname)}),t.messagesOffline.getAllMessages(e.getId())}).then(function(o){return o.forEach(function(e){e.pending=!0,e.text=e.smallmessage,s(e,e.touserid,"")}),t.getDiscussionsUserImg(n,e.getId()).then(function(e){return t.storeUsersFromDiscussions(e),e})})})},e.prototype.getDiscussionsUserImg=function(e,t){var n=[],o=function(o){e[o].profileimageurl||n.push(r.userProvider.getProfile(e[o].message.user,0,!0,t).then(function(t){e[o].profileimageurl=t.profileimageurl}).catch(function(){}))},r=this;for(var i in e)o(i);return Promise.all(n).then(function(){return e})},e.prototype.getMessagePreferencesCacheKey=function(){return this.ROOT_CACHE_KEY+"messagePreferences"},e.prototype.getMessagePreferences=function(e){var t=this;return this.logger.debug("Get message preferences"),this.sitesProvider.getSite(e).then(function(e){var n={cacheKey:t.getMessagePreferencesCacheKey()};return e.read("core_message_get_user_message_preferences",{},n).then(function(e){return e.preferences?(e.preferences.blocknoncontacts=!!e.blocknoncontacts,e.preferences):Promise.reject(null)})})},e.prototype.getMessages=function(e,t,n,o){var r=this;return void 0===n&&(n=!0),e.type="conversations",e.newestfirst=1,this.sitesProvider.getSite(o).then(function(o){var i=o.getUserId();return o.read("core_message_get_messages",e,t).then(function(t){return t.messages.forEach(function(t){t.read=0==e.read?0:1,t.timecreated=t.timecreated?1e3*t.timecreated:0,t.timeread=t.timeread?1e3*t.timeread:0}),n&&r.appProvider.isDesktop()&&!e.read&&e.useridto==i&&0===e.limitfrom&&r.storeLastReceivedMessageIfNeeded(e.useridfrom,t.messages[0],o.getId()),t})})},e.prototype.getRecentMessages=function(e,t,n,o,r,i){var s=this;return void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=!0),n=n||0,o=o||0,e.read=0,e.limitfrom=n,this.getMessages(e,t,r,i).then(function(n){var a=n.messages;return a?a.length>=e.limitnum?a:(e.limitnum=e.limitnum-a.length,e.read=1,e.limitfrom=o,s.getMessages(e,t,r,i).then(function(e){return e.messages&&(a=a.concat(e.messages)),a}).catch(function(){return a})):Promise.reject(null)})},e.prototype.getUnreadConversationsCount=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(o){if(e=e||o.getUserId(),o.wsAvailable("core_message_get_unread_conversations_count")){var r={useridto:e},i={cacheKey:n.getCacheKeyForMessageCount(e),getFromCache:!1,emergencyCache:!0,saveToCache:!0,typeExpected:"number"};return o.read("core_message_get_unread_conversations_count",r,i).catch(function(){return 0})}return n.getMessages({read:0,limitfrom:0,limitnum:n.LIMIT_MESSAGES+1,useridto:e,useridfrom:0},void 0,!1,t).then(function(e){var t={};e.messages.forEach(function(e){t[e.useridto]=1});var o=Object.keys(t).length;return o>n.LIMIT_MESSAGES?o+"+":o}).catch(function(){return 0})})},e.prototype.getUnreadReceivedMessages=function(e,t,n,o){var r=this;return void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(i){var s={read:0,limitfrom:0,limitnum:r.LIMIT_MESSAGES,useridto:i.getUserId(),useridfrom:0},a={};return t?a.omitExpires=!0:n&&(a.getFromCache=!1,a.emergencyCache=!1),r.getMessages(s,a,e,o)})},e.prototype.invalidateAllContactsCache=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.invalidateContactsCache(t).then(function(){return n.invalidateBlockedContactsCache(e,t)})},e.prototype.invalidateBlockedContactsCache=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCacheKeyForBlockedContacts(e))})},e.prototype.invalidateContactsCache=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getCacheKeyForContacts())})},e.prototype.invalidateDiscussionCache=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCacheKeyForDiscussion(e))})},e.prototype.invalidateDiscussionsCache=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n=[];return n.push(e.invalidateWsCacheForKey(t.getCacheKeyForDiscussions())),n.push(t.invalidateContactsCache(e.getId())),Promise.all(n)})},e.prototype.invalidateMessagePreferences=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getMessagePreferencesCacheKey())})},e.prototype.isBlocked=function(e,t){return this.getBlockedContacts(t).then(function(t){return!(!t.users||t.users.length<1)&&t.users.some(function(t){return e==t.id})})},e.prototype.isContact=function(e,t){return this.getContacts(t).then(function(t){return["online","offline"].some(function(n){return!!(t[n]&&t[n].length>0)&&t[n].some(function(t){return e==t.id})})})},e.prototype.isMarkAllMessagesReadEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_message_mark_all_messages_as_read")},e.prototype.isMessageCountEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_message_get_unread_conversations_count")},e.prototype.isMessagePreferencesEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_message_get_user_message_preferences")},e.prototype.isMessagingEnabledForSite=function(e){return this.isPluginEnabled(e).then(function(e){if(!e)return Promise.reject(null)})},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canUseAdvancedFeature("messaging")})},e.prototype.isSearchMessagesEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_message_data_for_messagearea_search_messages")},e.prototype.markMessageRead=function(e){var t={messageid:e,timeread:this.timeUtils.timestamp()};return this.sitesProvider.getCurrentSite().write("core_message_mark_message_read",t)},e.prototype.markAllMessagesRead=function(e){var t={useridto:this.sitesProvider.getCurrentSiteUserId(),useridfrom:e};return this.sitesProvider.getCurrentSite().write("core_message_mark_all_messages_as_read",t,{typeExpected:"boolean"})},e.prototype.removeContact=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.write("core_message_delete_contacts",{userids:[e]},{responseExpected:!1}).then(function(){return n.invalidateContactsCache(t.getId())})})},e.prototype.searchContacts=function(e,t,n){var o=this;return void 0===t&&(t=100),this.sitesProvider.getSite(n).then(function(n){return n.read("core_message_search_contacts",{searchtext:e,onlymycourses:0},{getFromCache:!1}).then(function(e){return t&&e.length>t&&(e=e.splice(0,t)),o.userProvider.storeUsers(e),e})})},e.prototype.searchMessages=function(e,t,n,o,r){return void 0===n&&(n=0),void 0===o&&(o=this.LIMIT_SEARCH_MESSAGES),this.sitesProvider.getSite(r).then(function(r){var i={userid:t||r.getUserId(),search:e,limitfrom:n,limitnum:o};return r.read("core_message_data_for_messagearea_search_messages",i,{getFromCache:!1}).then(function(e){return e.contacts})})},e.prototype.sendMessage=function(e,t,n){var o=this,r=function(){return o.messagesOffline.saveMessage(e,t,n).then(function(e){return{sent:!1,message:e}})};return n=n||this.sitesProvider.getCurrentSiteId(),this.appProvider.isOnline()?this.messagesOffline.hasMessages(e,n).catch(function(){return!0}).then(function(n){return n?r():o.sendMessageOnline(e,t).then(function(){return{sent:!0}}).catch(function(e){return o.utils.isWebServiceError(e)?Promise.reject(e):r()})}):r()},e.prototype.sendMessageOnline=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();return this.sendMessagesOnline([{touserid:e,text:t,textformat:1}],n).then(function(t){return t&&t[0]&&-1===t[0].msgid?Promise.reject(o.utils.createFakeWSError(t[0].errormessage)):o.invalidateDiscussionCache(e,n).catch(function(){})})},e.prototype.sendMessagesOnline=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("core_message_send_instant_messages",{messages:e})})},e.prototype.sortMessages=function(e){return e.sort(function(e,t){if(e.pending&&!t.pending)return 1;if(!e.pending&&t.pending)return-1;var n=parseInt(e.timecreated,10),o=parseInt(t.timecreated,10);return n==o&&e.id?e.id>=t.id?1:-1:n>=o?1:-1})},e.prototype.storeLastReceivedMessageIfNeeded=function(e,n,o){var r=this,i=t.PUSH_SIMULATION_COMPONENT;return this.emulatorHelper.getLastReceivedNotification(i,o).then(function(t){if((!(e>0)||n&&t)&&!(n&&t&&n.timecreated<=t.timecreated))return r.emulatorHelper.storeLastReceivedNotification(i,n,o)})},e.prototype.storeUsersFromAllContacts=function(e){for(var t in e)this.userProvider.storeUsers(e[t])},e.prototype.storeUsersFromDiscussions=function(e,t){var n=[];for(var o in e)n.push({id:o,fullname:e[o].fullname,profileimageurl:e[o].profileimageurl});this.userProvider.storeUsers(n,t)},e.prototype.unblockContact=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.write("core_message_unblock_contacts",{userids:[e]},{responseExpected:!1}).then(function(){return n.invalidateAllContactsCache(t.getUserId(),t.getId())})})},e.NEW_MESSAGE_EVENT="addon_messages_new_message_event",e.READ_CHANGED_EVENT="addon_messages_read_changed_event",e.READ_CRON_EVENT="addon_messages_read_cron_event",e.SPLIT_VIEW_LOAD_EVENT="addon_messages_split_view_load_event",e.POLL_INTERVAL=1e4,e.PUSH_SIMULATION_COMPONENT="AddonMessagesPushSimulation",e=t=f([Object(o.A)(),p("design:paramtypes",[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(58),i=n(12),s=n(7),a=n(2),c=n(6),u=n(41),d=n(10),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,s){var a=e.call(this,"CoreCourseOptionsDelegate",t,n,r)||this;return a.sitesProvider=n,a.utils=o,a.eventsProvider=r,a.coursesProvider=s,a.loaded={},a.lastUpdateHandlersForCoursesStart={},a.coursesHandlers={},a.featurePrefix="CoreCourseOptionsDelegate_",r.on(i.a.LOGOUT,function(){a.clearCoursesHandlers()}),a}return l(t,e),t.prototype.areHandlersLoaded=function(e){return!!this.loaded[e]},t.prototype.clearCoursesHandlers=function(e){e?(this.loaded[e]=!1,delete this.coursesHandlers[e]):(this.loaded={},this.coursesHandlers={})},t.prototype.clearAndInvalidateCoursesOptions=function(e){var t=[];if(this.eventsProvider.trigger(u.a.EVENT_MY_COURSES_REFRESHED),e)t.push(this.coursesProvider.invalidateCoursesAdminAndNavOptions([e])),t.push(this.invalidateCourseHandlers(e));else{t.push(this.coursesProvider.invalidateUserNavigationOptions()),t.push(this.coursesProvider.invalidateUserAdministrationOptions());for(var n in this.coursesHandlers)t.push(this.invalidateCourseHandlers(parseInt(n,10)))}return this.clearCoursesHandlers(e),Promise.all(t)},t.prototype.getHandlersForAccess=function(e,t,n,o,r){var i=this;return this.loaded[e]||(t=!1),!t&&this.coursesHandlers[e]&&this.coursesHandlers[e].access.type==n.type||(this.coursesHandlers[e]||(this.coursesHandlers[e]={}),this.coursesHandlers[e].access=n,this.coursesHandlers[e].navOptions=o,this.coursesHandlers[e].admOptions=r,this.coursesHandlers[e].deferred=this.utils.promiseDefer(),this.updateHandlersForCourse(e,n,o,r)),this.coursesHandlers[e].deferred.promise.then(function(){return i.coursesHandlers[e].enabledHandlers})},t.prototype.getHandlersToDisplay=function(e,t,n,o,r,i){var s=this;t.id=parseInt(t.id,10);var a={type:o?d.a.ACCESS_GUEST:d.a.ACCESS_DEFAULT};return r&&(t.navOptions=r),i&&(t.admOptions=i),this.loadCourseOptions(t,n).then(function(){return s.getHandlersForAccess(t.id,n,a,t.navOptions,t.admOptions)}).then(function(){var n=[],o=[];return s.coursesHandlers[t.id].enabledHandlers.forEach(function(r){o.push(Promise.resolve(r.getDisplayData(e,t)).then(function(e){n.push({data:e,priority:r.priority,prefetch:r.prefetch})}).catch(function(e){s.logger.error("Error getting data for handler",r.name,e)}))}),n.sort(function(e,t){return t.priority-e.priority}),n})},t.prototype.hasHandlersForCourse=function(e,t){var n=this;return this.loadCourseOptions(e,t).then(function(){return n.hasHandlersForDefault(e.id,t,e.navOptions,e.admOptions)})},t.prototype.hasHandlersForDefault=function(e,t,n,o){return this.getHandlersForAccess(e,t,{type:d.a.ACCESS_DEFAULT},n,o).then(function(e){return!(!e||!e.length)})},t.prototype.hasHandlersForGuest=function(e,t,n,o){return this.getHandlersForAccess(e,t,{type:d.a.ACCESS_GUEST},n,o).then(function(e){return!(!e||!e.length)})},t.prototype.invalidateCourseHandlers=function(e){var t=[],n=this.coursesHandlers[e];return n?(n.enabledHandlers.forEach(function(o){o&&o.invalidateEnabledForCourse&&t.push(Promise.resolve(o.invalidateEnabledForCourse(e,n.navOptions,n.admOptions)))}),this.utils.allPromises(t)):Promise.resolve()},t.prototype.isLastUpdateCourseCall=function(e,t){return!this.lastUpdateHandlersForCoursesStart[e]||t==this.lastUpdateHandlersForCoursesStart[e]},t.prototype.loadCourseOptions=function(e,t){return this.coursesProvider.canGetAdminAndNavOptions()&&(void 0===e.navOptions||void 0===e.admOptions||t)?this.coursesProvider.getCoursesAdminAndNavOptions([e.id]).then(function(t){e.navOptions=t.navOptions[e.id],e.admOptions=t.admOptions[e.id]}):Promise.resolve()},t.prototype.updateData=function(e){if(this.sitesProvider.getCurrentSiteId()===e)for(var t in this.coursesHandlers){var n=this.coursesHandlers[t];this.updateHandlersForCourse(parseInt(t,10),n.access,n.navOptions,n.admOptions)}},t.prototype.updateHandlersForCourse=function(e,t,n,o){var r=this,i=[],s=[],a=this.sitesProvider.getCurrentSiteId(),c=Date.now();this.lastUpdateHandlersForCoursesStart[e]=c;var u=function(r){var a=d.enabledHandlers[r];i.push(Promise.resolve(a.isEnabledForCourse(e,t,n,o)).then(function(e){if(!e)return Promise.reject(null);s.push(a)}).catch(function(){}))},d=this;for(var l in this.enabledHandlers)u(l);return Promise.all(i).then(function(){return!0}).catch(function(){return!0}).finally(function(){r.isLastUpdateCourseCall(e,c)&&r.sitesProvider.getCurrentSiteId()===a&&(r.coursesHandlers[e].enabledHandlers=s,r.loaded[e]=!0,r.coursesHandlers[e].deferred.resolve())})},t=f([Object(o.A)(),p("design:paramtypes",[s.a,a.a,c.a,i.a,u.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(9),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.TABLE_NAME="core_config",this.tableSchema={name:this.TABLE_NAME,columns:[{name:"name",type:"TEXT",unique:!0,notNull:!0},{name:"value"}]},this.appDB=e.getDB(),this.appDB.createTableFromSchema(this.tableSchema)}return e.prototype.delete=function(e){return this.appDB.deleteRecords(this.TABLE_NAME,{name:e})},e.prototype.get=function(e,t){return this.appDB.getRecord(this.TABLE_NAME,{name:e}).then(function(e){return e.value}).catch(function(e){return void 0!==t?t:Promise.reject(e)})},e.prototype.set=function(e,t){return this.appDB.insertRecord(this.TABLE_NAME,{name:e,value:t})},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(9),i=n(18),s=n(2),a=n(6),c=n(116),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r){this.appProvider=e,this.filepoolProvider=t,this.sitesProvider=n,this.utils=o,this.workshopOffline=r,this.ROOT_CACHE_KEY="mmaModWorkshop:"}return t=e,e.prototype.getWorkshopDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"workshop:"+e},e.prototype.getWorkshopDataPrefixCacheKey=function(e){return this.ROOT_CACHE_KEY+e},e.prototype.getWorkshopAccessInformationDataCacheKey=function(e){return this.getWorkshopDataPrefixCacheKey(e)+":access"},e.prototype.getUserPlanDataCacheKey=function(e){return this.getWorkshopDataPrefixCacheKey(e)+":userplan"},e.prototype.getSubmissionsDataCacheKey=function(e,t,n){return void 0===t&&(t=0),void 0===n&&(n=0),this.getWorkshopDataPrefixCacheKey(e)+":submissions:"+t+":"+n},e.prototype.getSubmissionDataCacheKey=function(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":submission:"+t},e.prototype.getGradesDataCacheKey=function(e){return this.getWorkshopDataPrefixCacheKey(e)+":grades"},e.prototype.getGradesReportDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getWorkshopDataPrefixCacheKey(e)+":report:"+t},e.prototype.getSubmissionAssessmentsDataCacheKey=function(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":assessments:"+t},e.prototype.getReviewerAssessmentsDataCacheKey=function(e,t){return void 0===t&&(t=0),this.getWorkshopDataPrefixCacheKey(e)+":reviewerassessments:"+t},e.prototype.getAssessmentDataCacheKey=function(e,t){return this.getWorkshopDataPrefixCacheKey(e)+":assessment:"+t},e.prototype.getAssessmentFormDataCacheKey=function(e,t,n){return void 0===n&&(n="assessment"),this.getWorkshopDataPrefixCacheKey(e)+":assessmentsform:"+t+":"+n},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("mod_workshop_get_workshops_by_courses")&&e.wsAvailable("mod_workshop_get_workshop_access_information")})},e.prototype.getWorkshopByKey=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),this.sitesProvider.getSite(o).then(function(o){var s={courseids:[e]},a={cacheKey:i.getWorkshopDataCacheKey(e)};return r&&(a.omitExpires=!0),o.read("mod_workshop_get_workshops_by_courses",s,a).then(function(e){if(e&&e.workshops){var o=e.workshops.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getWorkshop=function(e,t,n,o){return void 0===o&&(o=!1),this.getWorkshopByKey(e,"coursemodule",t,n,o)},e.prototype.getWorkshopById=function(e,t,n,o){return void 0===o&&(o=!1),this.getWorkshopByKey(e,"id",t,n,o)},e.prototype.invalidateWorkshopData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getWorkshopDataCacheKey(e))})},e.prototype.invalidateWorkshopWSData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getWorkshopDataPrefixCacheKey(e))})},e.prototype.getWorkshopAccessInformation=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e},s={cacheKey:r.getWorkshopAccessInformationDataCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=0,s.emergencyCache=0),o.read("mod_workshop_get_workshop_access_information",i,s)})},e.prototype.invalidateWorkshopAccessInformationData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getWorkshopAccessInformationDataCacheKey(e))})},e.prototype.getUserPlanPhases=function(e,t,n,o){var r=this;return void 0===t&&(t=!1),void 0===n&&(n=!1),this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e},s={cacheKey:r.getUserPlanDataCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=0,s.emergencyCache=0),o.read("mod_workshop_get_user_plan",i,s).then(function(e){return e&&e.userplan&&e.userplan.phases?r.utils.arrayToObject(e.userplan.phases,"code"):Promise.reject(null)})})},e.prototype.invalidateUserPlanPhasesData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getUserPlanDataCacheKey(e))})},e.prototype.getSubmissions=function(e,t,n,o,r,i){var s=this;return void 0===t&&(t=0),void 0===n&&(n=0),void 0===o&&(o=!1),void 0===r&&(r=!1),this.sitesProvider.getSite(i).then(function(i){var a={workshopid:e,userid:t,groupid:n},c={cacheKey:s.getSubmissionsDataCacheKey(e,t,n)};return o?c.omitExpires=!0:r&&(c.getFromCache=0,c.emergencyCache=0),i.read("mod_workshop_get_submissions",a,c).then(function(e){return e&&e.submissions?e.submissions:Promise.reject(null)})})},e.prototype.invalidateSubmissionsData=function(e,t,n,o){var r=this;return void 0===t&&(t=0),void 0===n&&(n=0),this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(r.getSubmissionsDataCacheKey(e,t,n))})},e.prototype.getSubmission=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={submissionid:t},i={cacheKey:o.getSubmissionDataCacheKey(e,t)};return n.read("mod_workshop_get_submission",r,i).then(function(e){return e&&e.submission?e.submission:Promise.reject(null)})})},e.prototype.invalidateSubmissionData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getSubmissionDataCacheKey(e,t))})},e.prototype.getGrades=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={workshopid:e},r={cacheKey:n.getGradesDataCacheKey(e)};return t.read("mod_workshop_get_grades",o,r)})},e.prototype.invalidateGradesData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getGradesDataCacheKey(e))})},e.prototype.getGradesReport=function(e,n,o,r,i,s,a){var c=this;return void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=0),void 0===i&&(i=!1),void 0===s&&(s=!1),this.sitesProvider.getSite(a).then(function(a){var u={workshopid:e,groupid:n,page:o,perpage:r||t.PER_PAGE},d={cacheKey:c.getGradesReportDataCacheKey(e,n)};return i?d.omitExpires=!0:s&&(d.getFromCache=0,d.emergencyCache=0),a.read("mod_workshop_get_grades_report",u,d).then(function(e){return e&&e.report?e.report:Promise.reject(null)})})},e.prototype.fetchAllGradeReports=function(e,n,o,r,i,s){return void 0===n&&(n=0),void 0===o&&(o=0),void 0===r&&(r=!1),void 0===i&&(i=!1),s=s||this.sitesProvider.getCurrentSiteId(),o=o||t.PER_PAGE,this.fetchGradeReportsRecursive(e,n,o,r,i,[],0,s)},e.prototype.fetchGradeReportsRecursive=function(e,t,n,o,r,i,s,a){var c=this;return this.getGradesReport(e,t,s,n,o,r,a).then(function(u){Array.prototype.push.apply(i,u.grades);return(s+1)*n<u.totalcount?c.fetchGradeReportsRecursive(e,t,n,o,r,i,s+1,a):i})},e.prototype.invalidateGradeReportData=function(e,t,n){var o=this;return void 0===t&&(t=0),this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getGradesReportDataCacheKey(e,t))})},e.prototype.getSubmissionAssessments=function(e,t,n,o,r){var i=this;return void 0===n&&(n=!1),void 0===o&&(o=!1),this.sitesProvider.getSite(r).then(function(r){var s={submissionid:t},a={cacheKey:i.getSubmissionAssessmentsDataCacheKey(e,t)};return n?a.omitExpires=!0:o&&(a.getFromCache=0,a.emergencyCache=0),r.read("mod_workshop_get_submission_assessments",s,a).then(function(e){return e&&e.assessments?e.assessments:Promise.reject(null)})})},e.prototype.invalidateSubmissionAssesmentsData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getSubmissionAssessmentsDataCacheKey(e,t))})},e.prototype.addSubmission=function(e,t,n,o,r,i,s,a){var c=this;void 0===a&&(a=!1),i=i||this.sitesProvider.getCurrentSiteId();var u=function(){return c.workshopOffline.saveSubmission(e,t,n,o,{},s,"add",i).then(function(){return!1})};return(s?this.workshopOffline.deleteSubmissionAction(e,s,"add",i):Promise.resolve()).then(function(){return!c.appProvider.isOnline()&&a?u():c.addSubmissionOnline(e,n,o,r,i).catch(function(e){return a&&!c.utils.isWebServiceError(e)?u():Promise.reject(e)})})},e.prototype.addSubmissionOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.write("mod_workshop_add_submission",{workshopid:e,title:t,content:n,attachmentsid:o||0}).then(function(e){return e&&e.submissionid?e.submissionid:Promise.reject(i.utils.createFakeWSError(""))})})},e.prototype.updateSubmission=function(e,t,n,o,r,i,s,a){var c=this;void 0===a&&(a=!1),s=s||this.sitesProvider.getCurrentSiteId();var u=function(){return c.workshopOffline.saveSubmission(e,n,o,r,i,t,"update",s).then(function(){return!1})};return this.workshopOffline.deleteSubmissionAction(e,t,"update",s).then(function(){return!c.appProvider.isOnline()&&a?u():c.updateSubmissionOnline(t,o,r,i,s).catch(function(e){return a&&!c.utils.isWebServiceError(e)?u():Promise.reject(e)})})},e.prototype.updateSubmissionOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.write("mod_workshop_update_submission",{submissionid:e,title:t,content:n,attachmentsid:o||0}).then(function(t){return t&&t.status?Promise.resolve(e):Promise.reject(i.utils.createFakeWSError(""))})})},e.prototype.deleteSubmission=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=function(){return r.workshopOffline.saveSubmission(e,n,"","",0,t,"delete",o).then(function(){return!1})};return this.workshopOffline.deleteSubmissionAction(e,t,"delete",o).then(function(){return r.appProvider.isOnline()?r.deleteSubmissionOnline(t,o).catch(function(e){return r.utils.isWebServiceError(e)?Promise.reject(e):i()}):i()})},e.prototype.deleteSubmissionOnline=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_workshop_delete_submission",{submissionid:e}).then(function(t){return t&&t.status?Promise.resolve(e):Promise.reject(n.utils.createFakeWSError(""))})})},e.prototype.getReviewerAssessments=function(e,t,n,o,r){var i=this;return void 0===n&&(n=!1),void 0===o&&(o=!1),this.sitesProvider.getSite(r).then(function(r){var s={workshopid:e},a={cacheKey:i.getReviewerAssessmentsDataCacheKey(e,t)};return t&&(s.userid=t),n?a.omitExpires=!0:o&&(a.getFromCache=0,a.emergencyCache=0),r.read("mod_workshop_get_reviewer_assessments",s,a).then(function(e){return e&&e.assessments?e.assessments:Promise.reject(null)})})},e.prototype.invalidateReviewerAssesmentsData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getReviewerAssessmentsDataCacheKey(e,t))})},e.prototype.getAssessment=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={assessmentid:t},i={cacheKey:o.getAssessmentDataCacheKey(e,t)};return n.read("mod_workshop_get_assessment",r,i).then(function(e){return e&&e.assessment?e.assessment:Promise.reject(null)})})},e.prototype.invalidateAssessmentData=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getAssessmentDataCacheKey(e,t))})},e.prototype.getAssessmentForm=function(e,t,n,o,r,i){var s=this;return void 0===n&&(n="assessment"),void 0===o&&(o=!1),void 0===r&&(r=!1),this.sitesProvider.getSite(i).then(function(i){var a={assessmentid:t,mode:n||"assessment"},c={cacheKey:s.getAssessmentFormDataCacheKey(e,t,n)};return o?c.omitExpires=!0:r&&(c.getFromCache=0,c.emergencyCache=0),i.read("mod_workshop_get_assessment_form_definition",a,c).then(function(e){return e?(e.fields=s.parseFields(e.fields),e.options=s.utils.objectToKeyValueMap(e.options,"name","value"),e.current=s.parseFields(e.current),e):Promise.reject(null)})})},e.prototype.parseFields=function(e){var t=[];return e.forEach(function(e){var n=e.name.split("_"),o=n[0],r=n[3],i=n[6]||!1;parseInt(r,10)==r&&(t[r]||(t[r]={number:parseInt(r,10)+1}),i&&parseInt(i,10)==i?(t[r].fields||(t[r].fields=[]),t[r].fields[i]||(t[r].fields[i]={number:parseInt(i,10)+1}),t[r].fields[i][o]=e.value):t[r][o]=e.value)}),t},e.prototype.invalidateAssessmentFormData=function(e,t,n,o){var r=this;return void 0===n&&(n="assessment"),this.sitesProvider.getSite(o).then(function(o){return o.invalidateWsCacheForKey(r.getAssessmentFormDataCacheKey(e,t,n))})},e.prototype.updateAssessment=function(e,t,n,o,r,i){var s=this;void 0===i&&(i=!1),r=r||this.sitesProvider.getCurrentSiteId();var a=function(){return s.workshopOffline.saveAssessment(e,t,n,o,r).then(function(){return!1})};return this.workshopOffline.deleteAssessment(e,t,r).then(function(){return!s.appProvider.isOnline()&&i?a():s.updateAssessmentOnline(t,o,r).catch(function(e){return i&&!s.utils.isWebServiceError(e)?a():Promise.reject(e)})})},e.prototype.updateAssessmentOnline=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={assessmentid:e,data:o.utils.objectToArrayOfObjects(t,"name","value")};return n.write("mod_workshop_update_assessment",r).then(function(e){return e&&e.status?e.rawgrade:Promise.reject(o.utils.createFakeWSError(""))})})},e.prototype.evaluateSubmission=function(e,t,n,o,r,i,s){var a=this;s=s||this.sitesProvider.getCurrentSiteId();var c=function(){return a.workshopOffline.saveEvaluateSubmission(e,t,n,o,r,i,s).then(function(){return!1})};return this.workshopOffline.deleteEvaluateSubmission(e,t,s).then(function(){return a.appProvider.isOnline()?a.evaluateSubmissionOnline(t,o,r,i,s).catch(function(e){return a.utils.isWebServiceError(e)?Promise.reject(e):c()}):c()})},e.prototype.evaluateSubmissionOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.write("mod_workshop_evaluate_submission",{submissionid:e,feedbacktext:t||"",feedbackformat:1,published:n?1:0,gradeover:o}).then(function(e){return e&&e.status?Promise.resolve(!0):Promise.reject(i.utils.createFakeWSError(""))})})},e.prototype.evaluateAssessment=function(e,t,n,o,r,i,s){var a=this;s=s||this.sitesProvider.getCurrentSiteId();var c=function(){return a.workshopOffline.saveEvaluateAssessment(e,t,n,o,r,i,s).then(function(){return!1})};return this.workshopOffline.deleteEvaluateAssessment(e,t,s).then(function(){return a.appProvider.isOnline()?a.evaluateAssessmentOnline(t,o,r,i,s).catch(function(e){return a.utils.isWebServiceError(e)?Promise.reject(e):c()}):c()})},e.prototype.evaluateAssessmentOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.write("mod_workshop_evaluate_assessment",{assessmentid:e,feedbacktext:t||"",feedbackformat:1,weight:n,gradinggradeover:o}).then(function(e){return e&&e.status?Promise.resolve(!0):Promise.reject(i.utils.createFakeWSError(""))})})},e.prototype.invalidateContent=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getWorkshop(t,e,n,!0).then(function(e){return o.invalidateContentById(e.id,t,n)})},e.prototype.invalidateContentById=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId();var o=[this.invalidateWorkshopData(t,n),this.invalidateWorkshopWSData(e,n)];return Promise.all(o)},e.prototype.invalidateFiles=function(e,n){return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.logView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_workshop_view_workshop",{workshopid:e})})},e.prototype.logViewSubmission=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_workshop_view_submission",{submissionid:e})})},e.COMPONENT="mmaModWorkshop",e.PER_PAGE=10,e.PHASE_SETUP=10,e.PHASE_SUBMISSION=20,e.PHASE_ASSESSMENT=30,e.PHASE_EVALUATION=40,e.PHASE_CLOSED=50,e.SUBMISSION_CHANGED="addon_mod_workshop_submission_changed",e.ASSESSMENT_SAVED="addon_mod_workshop_assessment_saved",e.ASSESSMENT_INVALIDATED="addon_mod_workshop_assessment_invalidated",e=t=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,s.a,a.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(4),i=n(323),s=n(324),a=n(1),c=n(9),u=n(27),d=n(7),l=n(8),f=n(11),p=n(6),h=n(56),m=n(325),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f){this.appProvider=t,this.translate=n,this.fileUploaderProvider=o,this.domUtils=r,this.textUtils=i,this.fileProvider=s,this.utils=a,this.actionSheetCtrl=c,this.uploaderDelegate=u,this.mediaCapture=d,this.camera=l,this.platform=f,this.logger=e.getInstance("CoreFileUploaderProvider")}return e.prototype.confirmUploadFile=function(e,t,n,o,r){if(0==e)return Promise.resolve();if(!n&&!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.fileuploader.errormustbeonlinetoupload"));if(o=void 0===o?h.a.WIFI_SIZE_WARNING:o,r=void 0===r?h.a.LIMITED_SIZE_WARNING:r,e<0)return this.domUtils.showConfirm(this.translate.instant("core.fileuploader.confirmuploadunknownsize"));if(e>=o||this.appProvider.isNetworkAccessLimited()&&e>=r){var i=this.textUtils.bytesToSize(e,2);return this.domUtils.showConfirm(this.translate.instant("core.fileuploader.confirmuploadfile",{size:i}))}return t?this.domUtils.showConfirm(this.translate.instant("core.areyousure")):Promise.resolve()},e.prototype.copyAndUploadFile=function(e,t,n){var o=this;n=n||e.name;var r,i=this.domUtils.showModalLoading("core.fileuploader.readingfile",!0);return this.fileProvider.readFileData(e,u.a.FORMATARRAYBUFFER).then(function(e){return r=e,o.fileProvider.getUniqueNameInFolder(u.a.TMPFOLDER,n)}).then(function(e){var t=o.textUtils.concatenatePaths(u.a.TMPFOLDER,e);return o.fileProvider.writeFile(t,r)}).catch(function(e){return o.logger.error("Error reading file to upload.",e),i.dismiss(),Promise.reject(o.translate.instant("core.fileuploader.errorreadingfile"))}).then(function(r){return i.dismiss(),t?o.uploadGenericFile(r.toURL(),n,e.type,!0):r})},e.prototype.copyToTmpFolder=function(e,t,n,o){var r,i=this,s=this.fileProvider.getFileAndDirectoryFromPath(e).name;return(void 0!==n&&-1!=n?this.fileProvider.getExternalFile(e).then(function(e){return i.fileProvider.getFileObjectFromFileEntry(e).then(function(e){e.size>n&&(r=e)})}).catch(function(){}):Promise.resolve()).then(function(){return r?i.errorMaxBytes(n,r.name):(s=s.replace(/(\.[^\.]*)\?[^\.]*$/,"$1"),i.fileProvider.getUniqueNameInFolder(u.a.TMPFOLDER,s,o))}).then(function(n){var o=i.textUtils.concatenatePaths(u.a.TMPFOLDER,n);return t?i.fileProvider.moveExternalFile(e,o):i.fileProvider.copyExternalFile(e,o)})},e.prototype.errorMaxBytes=function(e,t){var n=this.translate.instant("core.fileuploader.maxbytesfile",{$a:{file:t,size:this.textUtils.bytesToSize(e,2)}});return this.domUtils.showErrorModal(n),Promise.reject(null)},e.prototype.filePickerClosed=function(){this.filePickerDeferred&&(this.filePickerDeferred.reject(this.domUtils.createCanceledError()),this.filePickerDeferred=void 0)},e.prototype.fileUploaded=function(e){this.filePickerDeferred&&(this.filePickerDeferred.resolve(e),this.filePickerDeferred=void 0),this.actionSheet&&this.actionSheet.dismiss()},e.prototype.selectAndUploadFile=function(e,t,n){return this.selectFileWithPicker(e,!1,t,n,!0)},e.prototype.selectFile=function(e,t,n,o){return this.selectFileWithPicker(e,t,n,o,!1)},e.prototype.selectFileWithPicker=function(e,t,n,o,r){var i=this,s=[{text:this.translate.instant("core.cancel"),role:"cancel",handler:function(){i.filePickerClosed()}}],a=this.uploaderDelegate.getHandlers(o);return this.filePickerDeferred=this.utils.promiseDefer(),a.sort(function(e,t){return e.priority<=t.priority?1:-1}),a.forEach(function(n){s.push({text:i.translate.instant(n.title),icon:n.icon,cssClass:n.class,handler:function(){return!!n.action&&(t||i.appProvider.isOnline()?(n.action(e,r,t,n.mimetypes).then(function(n){return n.treated?n.result:n.fileEntry?i.uploadFileEntry(n.fileEntry,n.delete,e,r,t):n.path?i.fileProvider.getFile(n.path).catch(function(){return i.fileProvider.getExternalFile(n.path)}).then(function(o){return i.uploadFileEntry(o,n.delete,e,r,t)}):Promise.reject("No file received")}).then(function(e){i.fileUploaded(e)}).catch(function(e){e&&i.domUtils.showErrorModal(e)}),!1):(i.domUtils.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0),!1))}})}),this.actionSheet=this.actionSheetCtrl.create({title:n||this.translate.instant("core.fileuploader."+(r?"uploadafile":"selectafile")),buttons:s}),this.actionSheet.present(),setTimeout(function(){a.forEach(function(n){n.afterRender&&n.afterRender(e,r,t,n.mimetypes)})},500),this.filePickerDeferred.promise},e.prototype.showConfirmAndUploadInSite=function(e,t,n){var o=this;return this.fileProvider.getFileObjectFromFileEntry(e).then(function(r){return o.confirmUploadFile(r.size).then(function(){return o.uploadGenericFile(e.toURL(),r.name,r.type,t,n).then(function(){o.domUtils.showToast("core.fileuploader.fileuploaded",!0,void 0,"core-toast-success")})}).catch(function(e){return e&&o.domUtils.showErrorModal(e),Promise.reject(null)})},function(){return o.domUtils.showErrorModal("core.fileuploader.errorreadingfile",!0),Promise.reject(null)})},e.prototype.treatCaptureError=function(e,t){if(e){if("string"==typeof e)return this.logger.error("Error while recording audio/video: "+e),e.indexOf("No Activity found")>-1?Promise.reject(this.translate.instant("core.fileuploader.errornoapp")):Promise.reject(this.translate.instant(t));if(3!=e.code)return this.logger.error("Error while recording audio/video",e),Promise.reject(this.translate.instant(t));this.logger.debug("Cancelled")}return Promise.reject(null)},e.prototype.treatImageError=function(e,t){if(e){if("string"!=typeof e)return Promise.reject(this.translate.instant(t));if(e.toLowerCase().indexOf("error")>-1||e.toLowerCase().indexOf("unable")>-1)return this.logger.error("Error getting image: "+e),Promise.reject(e);this.logger.debug("Cancelled")}return Promise.reject(null)},e.prototype.uploadAudioOrVideo=function(e,t,n,o){var r=this;this.logger.debug("Trying to record a video file");var i={limit:1,mimetypes:o};return(e?this.mediaCapture.captureAudio(i):this.mediaCapture.captureVideo(i)).then(function(e){var i=e[0],s=i.fullPath,a=r.fileUploaderProvider.isInvalidMimetype(o,s);return a?Promise.reject(a):n?r.uploadFile(s,t,!0,r.fileUploaderProvider.getMediaUploadOptions(i)):r.copyToTmpFolder(s,!0,t)},function(t){return r.treatCaptureError(t,e?"core.fileuploader.errorcapturingaudio":"core.fileuploader.errorcapturingvideo")})},e.prototype.uploadGenericFile=function(e,t,n,o,r){var i=this.fileUploaderProvider.getFileUploadOptions(e,t,n,o);return this.uploadFile(e,-1,!1,i,r)},e.prototype.uploadImage=function(e,t,n,o){var r=this;this.logger.debug("Trying to capture an image with camera");var i={quality:50,destinationType:this.camera.DestinationType.FILE_URI,correctOrientation:!0};if(e){var s=!o||this.utils.indexOfRegexp(o,/^image\//)>-1,a=!o||this.utils.indexOfRegexp(o,/^video\//)>-1;i.sourceType=this.camera.PictureSourceType.PHOTOLIBRARY,i.popoverOptions={x:10,y:10,width:this.platform.width()-200,height:this.platform.height()-200,arrowDir:this.camera.PopoverArrowDirection.ARROW_ANY},s&&!a?i.mediaType=this.camera.MediaType.PICTURE:!s&&a?i.mediaType=this.camera.MediaType.VIDEO:this.platform.is("ios")&&(i.mediaType=this.camera.MediaType.ALLMEDIA)}else o&&(o.indexOf("image/jpeg")>-1?i.encodingType=this.camera.EncodingType.JPEG:o.indexOf("image/png")>-1&&(i.encodingType=this.camera.EncodingType.PNG));return this.camera.getPicture(i).then(function(i){var s=r.fileUploaderProvider.isInvalidMimetype(o,i);return s?Promise.reject(s):n?r.uploadFile(i,t,!0,r.fileUploaderProvider.getCameraUploadOptions(i,e)):r.copyToTmpFolder(i,!e,t,"jpg")},function(t){return r.treatImageError(t,e?"core.fileuploader.errorgettingimagealbum":"core.fileuploader.errorcapturingimage")})},e.prototype.uploadFileEntry=function(e,t,n,o,r,i){var s=this;return this.fileProvider.getFileObjectFromFileEntry(e).then(function(a){return s.uploadFileObject(a,n,o,r,i).then(function(n){return t&&s.fileProvider.removeFileByFileEntry(e),n})})},e.prototype.uploadFileObject=function(e,t,n,o,r){var i=this;return-1!=t&&e.size>t?this.errorMaxBytes(t,e.name):this.confirmUploadFile(e.size,!1,o).then(function(){return i.copyAndUploadFile(e,n,r)})},e.prototype.uploadFile=function(e,t,n,o,r){var i,s=this,a=this.translate.instant("core.error"),c=this.translate.instant("core.retry"),u=this.translate.instant("core.fileuploader.uploading"),d=function(i){return s.domUtils.showConfirm(i,a,c).then(function(){return s.uploadFile(e,t,n,o,r)},function(){return o.deleteAfterUpload&&s.fileProvider.removeExternalFile(e),Promise.reject(null)})};return this.appProvider.isOnline()?(n?this.fileProvider.getExternalFile(e).then(function(e){return s.fileProvider.getFileObjectFromFileEntry(e).then(function(e){return(i=e).size})}).catch(function(){}):Promise.resolve(0)).then(function(e){return-1!=t&&e>t?s.errorMaxBytes(t,i.name):e>0?s.confirmUploadFile(e):void 0}).then(function(){var t=s.domUtils.showModalLoading(u);return s.fileUploaderProvider.uploadFile(e,o,function(e){if(e&&e.lengthComputable){var n=Math.min(e.loaded/e.total*100,100);n>=0&&(t.setContent(s.translate.instant("core.fileuploader.uploadingperc",{$a:n.toFixed(1)})),t._cmp&&t._cmp.changeDetectorRef&&t._cmp.changeDetectorRef.detectChanges())}},r).catch(function(e){return s.logger.error("Error uploading file.",e),t.dismiss(),"string"!=typeof e&&(e=s.translate.instant("core.fileuploader.errorwhileuploading")),d(e)}).finally(function(){t.dismiss()})}):d(this.translate.instant("core.fileuploader.errormustbeonlinetoupload"))},e=g([Object(o.A)(),y("design:paramtypes",[d.a,c.a,a.c,h.a,l.a,f.a,u.a,p.a,r.a,m.a,i.a,s.a,r.s])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(27),i=n(46),s=n(7),a=n(2),c=n(6),u=n(56),d=n(110),l=n(102),f=n(52),p=n(80),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,r,i,s,a,c,u){this.sitesProvider=t,this.fileProvider=n,this.assignProvider=o,this.utils=r,this.assignOffline=i,this.feedbackDelegate=s,this.submissionDelegate=a,this.fileUploaderProvider=c,this.groupsProvider=u,this.logger=e.getInstance("AddonModAssignHelperProvider")}return e.prototype.canEditSubmissionOffline=function(e,t){if(!t)return Promise.resolve(!1);if(t.status==f.a.SUBMISSION_STATUS_NEW||t.status==f.a.SUBMISSION_STATUS_REOPENED)return Promise.resolve(!0);for(var n=[],o=!0,r=0;r<t.plugins.length;r++){n.push(this.submissionDelegate.canPluginEditOffline(e,t,t.plugins[r]).then(function(e){e||(o=!1)}))}return Promise.all(n).then(function(){return o})},e.prototype.clearSubmissionPluginTmpData=function(e,t,n){var o=this;t.plugins.forEach(function(r){o.submissionDelegate.clearTmpData(e,t,r,n)})},e.prototype.copyPreviousAttempt=function(e,t){var n=this,o={},r=[];return t.plugins.forEach(function(t){r.push(n.submissionDelegate.copyPluginSubmissionData(e,t,o))}),Promise.all(r).then(function(){if(Object.keys(o).length)return n.assignProvider.saveSubmissionOnline(e.id,o)})},e.prototype.deleteStoredSubmissionFiles=function(e,t,n,o){var r=this;return this.assignOffline.getSubmissionPluginFolder(e,t,n,o).then(function(e){return r.fileProvider.removeDir(e)})},e.prototype.discardFeedbackPluginData=function(e,t,n,o){var r=this,i=[];return n.plugins.forEach(function(n){i.push(r.feedbackDelegate.discardPluginFeedbackData(e,t,n,o))}),Promise.all(i)},e.prototype.getParticipants=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.assignProvider.listParticipants(e.id,void 0,t).then(function(o){return o&&o.length>0?o:n.groupsProvider.getActivityAllowedGroupsIfEnabled(e.cmid,void 0,t).then(function(o){var r=[],i={};return o.forEach(function(o){r.push(n.assignProvider.listParticipants(e.id,o.id,t).then(function(e){e.forEach(function(e){i[e.id]=e})}))}),Promise.all(r).then(function(){return n.utils.objectToArray(i)})})})},e.prototype.getPluginConfig=function(e,t,n){var o={};return e.configs.forEach(function(e){e.subtype==t&&e.plugin==n&&(o[e.name]=e.value)}),o},e.prototype.getPluginsEnabled=function(e,t){var n=[];return e.configs.forEach(function(e){e.subtype==t&&"enabled"==e.name&&1===parseInt(e.value,10)&&n.push({type:e.plugin})}),n},e.prototype.getStoredSubmissionFiles=function(e,t,n,o){var r=this;return this.assignOffline.getSubmissionPluginFolder(e,t,n,o).then(function(e){return r.fileProvider.getDirectoryContents(e)})},e.prototype.getSubmissionSizeForCopy=function(e,t){var n=this,o=[],r=0;return t.plugins.forEach(function(t){o.push(n.submissionDelegate.getPluginSizeForCopy(e,t).then(function(e){r+=e}))}),Promise.all(o).then(function(){return r})},e.prototype.getSubmissionSizeForEdit=function(e,t,n){var o=this,r=[],i=0;return t.plugins.forEach(function(s){r.push(o.submissionDelegate.getPluginSizeForEdit(e,t,s,n).then(function(e){i+=e}))}),Promise.all(r).then(function(){return i})},e.prototype.hasFeedbackDataChanged=function(e,t,n){var o=this,r=[],i=!1;return n.plugins.forEach(function(s){r.push(o.prepareFeedbackPluginData(e.id,t,n).then(function(n){return o.feedbackDelegate.hasPluginDataChanged(e,t,s,n,t).then(function(e){e&&(i=!0)})}).catch(function(){}))}),this.utils.allPromises(r).then(function(){return i})},e.prototype.hasSubmissionDataChanged=function(e,t,n){var o=this,r=[],i=!1;return t.plugins.forEach(function(s){r.push(o.submissionDelegate.hasPluginDataChanged(e,t,s,n).then(function(e){e&&(i=!0)}).catch(function(){}))}),this.utils.allPromises(r).then(function(){return i})},e.prototype.prepareFeedbackPluginData=function(e,t,n,o){var r=this,i={},s=[];return n.plugins.forEach(function(n){s.push(r.feedbackDelegate.preparePluginFeedbackData(e,t,n,i,o))}),Promise.all(s).then(function(){return i})},e.prototype.prepareSubmissionPluginData=function(e,t,n,o){var r=this,i={},s=[];return t.plugins.forEach(function(a){s.push(r.submissionDelegate.preparePluginSubmissionData(e,t,a,n,i,o))}),Promise.all(s).then(function(){return i})},e.prototype.storeSubmissionFiles=function(e,t,n,o,r){var i=this;return this.assignOffline.getSubmissionPluginFolder(e,t,o,r).then(function(e){return i.fileUploaderProvider.storeFilesToUpload(e,n)})},e.prototype.uploadFile=function(e,t,n,o){return this.fileUploaderProvider.uploadOrReuploadFile(t,n,f.a.COMPONENT,e,o)},e.prototype.uploadFiles=function(e,t,n){return this.fileUploaderProvider.uploadOrReuploadFiles(t,f.a.COMPONENT,e,n)},e.prototype.uploadOrStoreFiles=function(e,t,n,o,r,i){return o?this.storeSubmissionFiles(e,t,n,r,i):this.uploadFiles(e,n,i)},e=h([Object(o.A)(),m("design:paramtypes",[s.a,a.a,r.a,f.a,c.a,p.a,d.a,l.a,u.a,i.a])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(12),s=n(2),a=n(58),c=n(733),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,"AddonModAssignFeedbackDelegate",t,n,o)||this;return i.defaultHandler=r,i.handlerNameProperty="type",i}return u(t,e),t.prototype.discardPluginFeedbackData=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"discardDraft",[e,t,o]))},t.prototype.getComponentForPlugin=function(e,t){return Promise.resolve(this.executeFunctionOnEnabled(t.type,"getComponent",[e,t]))},t.prototype.getPluginDraftData=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"getDraft",[e,t,o]))},t.prototype.getPluginFiles=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"getPluginFiles",[e,t,n,o]))},t.prototype.getPluginName=function(e){return this.executeFunctionOnEnabled(e.type,"getPluginName",[e])},t.prototype.hasPluginDataChanged=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"hasDataChanged",[e,t,n,o,r]))},t.prototype.hasPluginDraftData=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"hasDraftData",[e,t,o]))},t.prototype.isPluginSupported=function(e){return this.hasHandler(e,!0)},t.prototype.prefetch=function(e,t,n,o){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"prefetch",[e,t,n,o]))},t.prototype.preparePluginFeedbackData=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"prepareFeedbackData",[e,t,n,o,r]))},t.prototype.saveFeedbackDraft=function(e,t,n,o,r){return Promise.resolve(this.executeFunctionOnEnabled(n.type,"saveDraft",[e,t,n,o,r]))},t=d([Object(o.A)(),l("design:paramtypes",[r.a,s.a,i.a,c.a])],t)}(a.a)},,,,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(7),i=n(2),s=n(41),a=n(10),c=n(94),u=n(11),d=n(47),l=n(6),f=n(8),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,o,r,i,s,a,c){this.coursesProvider=t,this.gradesProvider=n,this.sitesProvider=o,this.textUtils=r,this.courseProvider=i,this.domUtils=s,this.urlUtils=a,this.utils=c,this.logger=e.getInstance("CoreGradesHelperProvider")}return e.prototype.formatGradeRow=function(e){var t={};for(var n in e)if(void 0!==e[n].content){var o=e[n].content;"itemname"==n?(this.setRowIcon(t,o),t.link=this.getModuleLink(o),t.rowclass+=e[n].class.indexOf("hidden")>=0?" hidden":"",t.rowclass+=e[n].class.indexOf("dimmed_text")>=0?" dimmed_text":"",o=o.replace(/<\/span>/gi,"\n"),o=this.textUtils.cleanTags(o)):o=this.textUtils.replaceNewLines(o,"<br>"),"&nbsp;"==o&&(o=""),t[n]=o.trim()}return t},e.prototype.formatGradeRowForTable=function(e){var t={};for(var n in e)if(void 0!==e[n].content){var o=e[n].content;"itemname"==n?(this.setRowIcon(t,o),t.rowclass=e[n].class.indexOf("leveleven")<0?"odd":"even",t.rowclass+=e[n].class.indexOf("hidden")>=0?" hidden":"",t.rowclass+=e[n].class.indexOf("dimmed_text")>=0?" dimmed_text":"",o=o.replace(/<\/span>/gi,"\n"),o=this.textUtils.cleanTags(o),t.id=parseInt(e[n].id.split("_")[1],10),t.colspan=e[n].colspan,t.rowspan=e.leader&&e.leader.rowspan||1,n="gradeitem"):o=this.textUtils.replaceNewLines(o,"<br>"),"&nbsp;"==o&&(o=""),t[n]=o.trim()}return t},e.prototype.formatGradeItem=function(e){for(var t in e){var n=t.indexOf("formatted");n>0&&(e[t.substr(0,n)]=e[t])}return e},e.prototype.formatGradesTable=function(e){var t=this,n=e.maxdepth,o={columns:[],rows:[]},r={gradeitem:!0,weight:!1,grade:!1,range:!1,percentage:!1,lettergrade:!1,rank:!1,average:!1,feedback:!1,contributiontocoursetotal:!1};o.rows=e.tabledata.map(function(e){return t.formatGradeRowForTable(e)}).filter(function(e){return void 0!==e.gradeitem});var i=o.rows.find(function(e){return"leader"!=e.itemtype&&(void 0!==e.grade||void 0!==e.percentage)});i&&void 0!==i.grade?r.grade=!0:i&&void 0!==i.percentage?r.percentage=!0:(i=o.rows.find(function(e){return"leader"!=e.itemtype}),r.grade=!0);for(var s in r)void 0!==i[s]&&o.columns.push({name:s,colspan:"gradeitem"==s?n:1,hiddenPhone:!r[s]});return o},e.prototype.getGradesCourseData=function(e){return this.coursesProvider.getUserCourses(!0).then(function(t){var n={};return t.forEach(function(e){n[e.id]=e}),e.forEach(function(e){void 0!==n[e.courseid]&&(e.courseFullName=n[e.courseid].fullname)}),e})},e.prototype.getGradeItem=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),this.gradesProvider.getCourseGradesTable(e,n,o,r).then(function(e){return e?i.getGradesTableRow(e,t):Promise.reject(null)})},e.prototype.getGradeLabelFromValue=function(e,t){if(t=Number(t),!e||!t||t<=0)return"";for(var n in e)if(e[n].value==t)return e[n].label;return""},e.prototype.getGradeModuleItems=function(e,t,n,o,r,i){var s=this;return void 0===i&&(i=!1),this.gradesProvider.getGradeItems(e,n,o,r,i).then(function(e){return e?void 0!==e.tabledata?s.getModuleGradesTableRows(e,t):e.filter(function(e){return e.cmid==t}).map(function(e){return s.formatGradeItem(e)}):Promise.reject(null)})},e.prototype.getGradeValueFromLabel=function(e,t){if(!e||!t)return 0;for(var n in e)if(e[n].label==t)return e[n].value<0?0:e[n].value;return 0},e.prototype.getModuleLink=function(e){var t=this.domUtils.toDom(e)[0],n=!!t.attributes.href&&t.attributes.href.value;return!(!n||n.indexOf("/mod/")<0)&&n},e.prototype.getGradesTableRow=function(e,t){if(e.tabledata){var n=e.tabledata.find(function(e){return e.itemname&&e.itemname.id&&"row"==e.itemname.id.substr(0,3)&&parseInt(e.itemname.id.split("_")[1],10)==t});if(n)return this.formatGradeRow(n)}return""},e.prototype.getModuleGradesTableRows=function(e,t){var n=this;if(e.tabledata){var o=/href="([^"]*\/mod\/[^"|^\/]*\/[^"|^\.]*\.php[^"]*)/;return e.tabledata.filter(function(e){if(e.itemname&&e.itemname.content){var r=e.itemname.content.match(o);if(r&&r.length){var i=n.urlUtils.extractUrlParams(r[1]);return i&&i.id==t}}return!1}).map(function(e){return n.formatGradeRow(e)})}return[]},e.prototype.invalidateGradeModuleItems=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(o).then(function(i){return t=t||i.getUserId(),r.gradesProvider.isGradeItemsAvalaible(o).then(function(i){return i?r.gradesProvider.invalidateCourseGradesItemsData(e,t,n,o):r.gradesProvider.invalidateCourseGradesData(e,t,o)})})},e.prototype.setRowIcon=function(e,t){if((t=t.replace("%2F","/").replace("%2f","/")).indexOf("/agg_mean")>-1)e.itemtype="agg_mean",e.image="assets/img/grades/agg_mean.png";else if(t.indexOf("/agg_sum")>-1)e.itemtype="agg_sum",e.image="assets/img/grades/agg_sum.png";else if(t.indexOf("/outcomes")>-1||t.indexOf("fa-tasks")>-1)e.itemtype="outcome",e.image="assets/img/grades/outcomes.png";else if(t.indexOf("i/folder")>-1||t.indexOf("fa-folder")>-1)e.itemtype="category",e.icon="folder";else if(t.indexOf("/manual_item")>-1||t.indexOf("fa-square-o")>-1)e.itemtype="manual",e.icon="square-outline";else if(t.indexOf("/mod/")>-1){var n=t.match(/mod\/([^\/]*)\//);void 0!==n[1]&&(e.itemtype="mod",e.itemmodule=n[1],e.image=this.courseProvider.getModuleIconSrc(n[1]))}else if(t.indexOf("src=")>-1){var o=t.match(/src="([^"]*)"/);e.image=o[1]}return e},e.prototype.makeGradesMenu=function(e,t,n,o,r){var i=this;if(void 0===n&&(n=""),void 0===o&&(o=""),e<0)return r?Promise.resolve(this.utils.makeMenuFromList(r,n,void 0,o)):this.courseProvider.getModuleBasicGradeInfo(t).then(function(e){return e.scale?i.utils.makeMenuFromList(e.scale,n,void 0,o):[]});if(e>0){var s=[];n&&s.push({label:n,value:o});for(var a=e;a>=0;a--)s.push({label:a+" / "+e,value:a});return Promise.resolve(s)}return Promise.resolve([])},e=p([Object(o.A)(),h("design:paramtypes",[r.a,s.a,c.a,i.a,u.a,a.a,f.a,d.a,l.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(27),i=n(2),s=n(11),a=n(22),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,n,o,r){this.fileProvider=e,this.sitesProvider=n,this.textUtils=o,this.timeUtils=r,this.tablesSchema=[{name:t.SUBMISSIONS_TABLE,columns:[{name:"workshopid",type:"INTEGER"},{name:"submissionid",type:"INTEGER"},{name:"action",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"title",type:"TEXT"},{name:"content",type:"TEXT"},{name:"attachmentsid",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["workshopid","submissionid","action"]},{name:t.ASSESSMENTS_TABLE,columns:[{name:"workshopid",type:"INTEGER"},{name:"assessmentid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"inputdata",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["workshopid","assessmentid"]},{name:t.EVALUATE_SUBMISSIONS_TABLE,columns:[{name:"workshopid",type:"INTEGER"},{name:"submissionid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"feedbacktext",type:"TEXT"},{name:"published",type:"INTEGER"},{name:"gradeover",type:"TEXT"}],primaryKeys:["workshopid","submissionid"]},{name:t.EVALUATE_ASSESSMENTS_TABLE,columns:[{name:"workshopid",type:"INTEGER"},{name:"assessmentid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"feedbacktext",type:"TEXT"},{name:"weight",type:"INTEGER"},{name:"gradinggradeover",type:"TEXT"}],primaryKeys:["workshopid","assessmentid"]}],this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.getAllWorkshops=function(e){var t=[this.getAllSubmissions(e),this.getAllAssessments(e),this.getAllEvaluateSubmissions(e),this.getAllEvaluateAssessments(e)];return Promise.all(t).then(function(e){var t={};return e.forEach(function(e){e.forEach(function(e){t[e.workshopid]=!0})}),Object.keys(t).map(function(e){return parseInt(e,10)})})},e.prototype.hasWorkshopOfflineData=function(e,t){var n=[this.getSubmissions(e,t),this.getAssessments(e,t),this.getEvaluateSubmissions(e,t),this.getEvaluateAssessments(e,t)];return Promise.all(n).then(function(e){return e.some(function(e){return e&&e.length})}).catch(function(){return!1})},e.prototype.deleteSubmissionAction=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){var i={workshopid:e,submissionid:n,action:o};return r.getDb().deleteRecords(t.SUBMISSIONS_TABLE,i)})},e.prototype.deleteAllSubmissionActions=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={workshopid:e,submissionid:n};return o.getDb().deleteRecords(t.SUBMISSIONS_TABLE,r)})},e.prototype.getAllSubmissions=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.SUBMISSIONS_TABLE).then(function(e){return e.forEach(n.parseSubmissionRecord.bind(n)),e})})},e.prototype.getSubmissions=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={workshopid:e};return n.getDb().getRecords(t.SUBMISSIONS_TABLE,r).then(function(e){return e.forEach(o.parseSubmissionRecord.bind(o)),e})})},e.prototype.getSubmissionActions=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e,submissionid:n};return o.getDb().getRecords(t.SUBMISSIONS_TABLE,i).then(function(e){return e.forEach(r.parseSubmissionRecord.bind(r)),e})})},e.prototype.getSubmissionAction=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={workshopid:e,submissionid:n,action:o};return r.getDb().getRecord(t.SUBMISSIONS_TABLE,s).then(function(e){return i.parseSubmissionRecord(e),e})})},e.prototype.saveSubmission=function(e,n,o,r,i,s,a,c){var u=this;return this.sitesProvider.getSite(c).then(function(c){var d=u.timeUtils.timestamp(),l={workshopid:e,courseid:n,title:o,content:r,attachmentsid:JSON.stringify(i),action:a,submissionid:s||-d,timemodified:d};return c.getDb().insertRecord(t.SUBMISSIONS_TABLE,l)})},e.prototype.parseSubmissionRecord=function(e){e.attachmentsid=this.textUtils.parseJSON(e.attachmentsid)},e.prototype.deleteAssessment=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={workshopid:e,assessmentid:n};return o.getDb().deleteRecords(t.ASSESSMENTS_TABLE,r)})},e.prototype.getAllAssessments=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.ASSESSMENTS_TABLE).then(function(e){return e.forEach(n.parseAssessmentRecord.bind(n)),e})})},e.prototype.getAssessments=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={workshopid:e};return n.getDb().getRecords(t.ASSESSMENTS_TABLE,r).then(function(e){return e.forEach(o.parseAssessmentRecord.bind(o)),e})})},e.prototype.getAssessment=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e,assessmentid:n};return o.getDb().getRecord(t.ASSESSMENTS_TABLE,i).then(function(e){return r.parseAssessmentRecord(e),e})})},e.prototype.saveAssessment=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={workshopid:e,courseid:o,inputdata:JSON.stringify(r),assessmentid:n,timemodified:s.timeUtils.timestamp()};return i.getDb().insertRecord(t.ASSESSMENTS_TABLE,a)})},e.prototype.parseAssessmentRecord=function(e){e.inputdata=this.textUtils.parseJSON(e.inputdata)},e.prototype.deleteEvaluateSubmission=function(e,n,o){var r={workshopid:e,submissionid:n};return this.sitesProvider.getSite(o).then(function(e){return e.getDb().deleteRecords(t.EVALUATE_SUBMISSIONS_TABLE,r)})},e.prototype.getAllEvaluateSubmissions=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.EVALUATE_SUBMISSIONS_TABLE).then(function(e){return e.forEach(n.parseEvaluateSubmissionRecord.bind(n)),e})})},e.prototype.getEvaluateSubmissions=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={workshopid:e};return n.getDb().getRecords(t.EVALUATE_SUBMISSIONS_TABLE,r).then(function(e){return e.forEach(o.parseEvaluateSubmissionRecord.bind(o)),e})})},e.prototype.getEvaluateSubmission=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e,submissionid:n};return o.getDb().getRecord(t.EVALUATE_SUBMISSIONS_TABLE,i).then(function(e){return r.parseEvaluateSubmissionRecord(e),e})})},e.prototype.saveEvaluateSubmission=function(e,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){var u={workshopid:e,courseid:o,submissionid:n,timemodified:c.timeUtils.timestamp(),feedbacktext:r,published:Number(i),gradeover:JSON.stringify(s)};return a.getDb().insertRecord(t.EVALUATE_SUBMISSIONS_TABLE,u)})},e.prototype.parseEvaluateSubmissionRecord=function(e){e.published=Boolean(e.published),e.gradeover=this.textUtils.parseJSON(e.gradeover)},e.prototype.deleteEvaluateAssessment=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={workshopid:e,assessmentid:n};return o.getDb().deleteRecords(t.EVALUATE_ASSESSMENTS_TABLE,r)})},e.prototype.getAllEvaluateAssessments=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.EVALUATE_ASSESSMENTS_TABLE).then(function(e){return e.forEach(n.parseEvaluateAssessmentRecord.bind(n)),e})})},e.prototype.getEvaluateAssessments=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r={workshopid:e};return n.getDb().getRecords(t.EVALUATE_ASSESSMENTS_TABLE,r).then(function(e){return e.forEach(o.parseEvaluateAssessmentRecord.bind(o)),e})})},e.prototype.getEvaluateAssessment=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={workshopid:e,assessmentid:n};return o.getDb().getRecord(t.EVALUATE_ASSESSMENTS_TABLE,i).then(function(e){return r.parseEvaluateAssessmentRecord(e),e})})},e.prototype.saveEvaluateAssessment=function(e,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){var u={workshopid:e,courseid:o,assessmentid:n,timemodified:c.timeUtils.timestamp(),feedbacktext:r,weight:i,gradinggradeover:JSON.stringify(s)};return a.getDb().insertRecord(t.EVALUATE_ASSESSMENTS_TABLE,u)})},e.prototype.parseEvaluateAssessmentRecord=function(e){e.gradinggradeover=this.textUtils.parseJSON(e.gradinggradeover)},e.prototype.getWorkshopFolder=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o=n.fileProvider.getSiteFolder(t.getId());return n.textUtils.concatenatePaths(o,"offlineworkshop/"+e+"/")})},e.prototype.getSubmissionFolder=function(e,t,n,o){var r=this;return this.getWorkshopFolder(e,o).then(function(e){return r.textUtils.concatenatePaths(e+="submission/",n?"update_"+t:"add")})},e.prototype.getAssessmentFolder=function(e,t,n){var o=this;return this.getWorkshopFolder(e,n).then(function(e){return e+="assessment/",o.textUtils.concatenatePaths(e,String(t))})},e.SUBMISSIONS_TABLE="addon_mod_workshop_submissions",e.ASSESSMENTS_TABLE="addon_mod_workshop_assessments",e.EVALUATE_SUBMISSIONS_TABLE="addon_mod_workshop_evaluate_submissions",e.EVALUATE_ASSESSMENTS_TABLE="addon_mod_workshop_evaluate_assessments",e=t=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(46),c=n(2),u=n(26),d=n(6),l=n(149),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s,a){this.appProvider=e,this.sitesProvider=t,this.groupsProvider=n,this.filepoolProvider=o,this.userProvider=r,this.translate=i,this.utils=s,this.forumOffline=a,this.ROOT_CACHE_KEY="mmaModForum:"}return t=e,e.prototype.getCanAddDiscussionCacheKey=function(e,t){return this.getCommonCanAddDiscussionCacheKey(e)+":"+t},e.prototype.getCommonCanAddDiscussionCacheKey=function(e){return this.ROOT_CACHE_KEY+"canadddiscussion:"+e},e.prototype.getForumDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"forum:"+e},e.prototype.getDiscussionPostsCacheKey=function(e){return this.ROOT_CACHE_KEY+"discussion:"+e},e.prototype.getDiscussionsListCacheKey=function(e){return this.ROOT_CACHE_KEY+"discussions:"+e},e.prototype.addNewDiscussion=function(e,t,n,o,r,i,s,a,c,u){var d=this;a=a||this.sitesProvider.getCurrentSiteId();var l=function(){return d.forumOffline.addNewDiscussion(e,t,n,o,r,i,s,c,a).then(function(){return!1})};return(c?this.forumOffline.deleteNewDiscussion(e,c,a):Promise.resolve()).then(function(){return!d.appProvider.isOnline()&&u?l():d.addNewDiscussionOnline(e,o,r,i,s,a).then(function(e){return e}).catch(function(e){return!u||d.utils.isWebServiceError(e)?Promise.reject(e):l()})})},e.prototype.addNewDiscussionOnline=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={forumid:e,subject:t,message:n,options:s.utils.objectToArrayOfObjects(o,"name","value")};return r&&(a.groupid=r),i.write("mod_forum_add_discussion",a).then(function(e){return e&&e.discussionid?e.discussionid:Promise.reject(s.utils.createFakeWSError(""))})})},e.prototype.canAddDiscussion=function(e,t,n){var o={forumid:e,groupid:t},r={cacheKey:this.getCanAddDiscussionCacheKey(e,t)};return this.sitesProvider.getSite(n).then(function(e){return e.read("mod_forum_can_add_discussion",o,r).then(function(e){return e?(void 0===e.canpindiscussions&&(e.canpindiscussions=!1),void 0===e.cancreateattachment&&(e.cancreateattachment=!0),e):Promise.reject(null)})})},e.prototype.canAddDiscussionToAll=function(e){return this.canAddDiscussion(e,-1)},e.prototype.extractStartingPost=function(e){for(var t=e.length-1;t>=0;t--)if(0==e[t].parent)return e.splice(t,1).pop()},e.prototype.isAllParticipantsFixed=function(){return this.sitesProvider.getCurrentSite().isVersionGreaterEqualThan(["3.1.5","3.2.2"])},e.prototype.formatDiscussionsGroups=function(e,t){var n=this;return t=this.utils.clone(t),this.groupsProvider.getActivityAllowedGroups(e).then(function(e){var o=n.translate.instant("core.allparticipants"),r={};return e.forEach(function(e){r[e.id]=e}),t.forEach(function(e){if(-1===e.groupid)e.groupname=o;else{var t=r[e.groupid];t&&(e.groupname=t.name)}}),t}).catch(function(){return t})},e.prototype.getCourseForums=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={courseids:[e]},r={cacheKey:n.getForumDataCacheKey(e)};return t.read("mod_forum_get_forums_by_courses",o,r)})},e.prototype.getForum=function(e,t,n){return this.getCourseForums(e,n).then(function(e){var n=e.find(function(e){return e.cmid==t});return n||Promise.reject(null)})},e.prototype.getForumById=function(e,t,n){return this.getCourseForums(e,n).then(function(e){var n=e.find(function(e){return e.id==t});return n||Promise.reject(null)})},e.prototype.getDiscussionPosts=function(e,t){var n=this,o={discussionid:e},r={cacheKey:this.getDiscussionPostsCacheKey(e)};return this.sitesProvider.getSite(t).then(function(e){return e.read("mod_forum_get_forum_discussion_posts",o,r).then(function(e){return e?(n.storeUserData(e.posts),e.posts):Promise.reject(null)})})},e.prototype.sortDiscussionPosts=function(e,t){e.sort(function(e,n){return e=parseInt(e.created,10),n=parseInt(n.created,10),"ASC"==t?e-n:n-e})},e.prototype.getDiscussions=function(e,n,o,r){var i=this;return void 0===n&&(n=0),this.sitesProvider.getSite(r).then(function(r){var s={forumid:e,sortby:"timemodified",sortdirection:"DESC",page:n,perpage:t.DISCUSSIONS_PER_PAGE},a={cacheKey:i.getDiscussionsListCacheKey(e)};return o&&(a.omitExpires=!0),r.read("mod_forum_get_forum_discussions_paginated",s,a).then(function(e){return e?(i.storeUserData(e.discussions),Promise.resolve({discussions:e.discussions,canLoadMore:e.discussions.length>=t.DISCUSSIONS_PER_PAGE})):Promise.reject(null)})})},e.prototype.getDiscussionsInPages=function(e,t,n,o,r){var i=this;void 0===n&&(n=-1),o=o||0;var s={discussions:[],error:!1};if(!n)return Promise.resolve(s);var a=function(o){return i.getDiscussions(e,o,t,r).then(function(e){return s.discussions=s.discussions.concat(e.discussions),n--,e.canLoadMore&&0!==n?a(o+1):s}).catch(function(){return s.error=!0,s})};return a(o)},e.prototype.invalidateCanAddDiscussion=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getCommonCanAddDiscussionCacheKey(e))})},e.prototype.invalidateContent=function(e,t){var n=this;return this.getForum(t,e).then(function(e){return n.getDiscussionsInPages(e.id,!0).then(function(o){var r=[];return r.push(n.invalidateForumData(t)),r.push(n.invalidateDiscussionsList(e.id)),r.push(n.invalidateCanAddDiscussion(e.id)),o.discussions.forEach(function(e){r.push(n.invalidateDiscussionPosts(e.discussion))}),n.utils.allPromises(r)})})},e.prototype.invalidateDiscussionPosts=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getDiscussionPostsCacheKey(e))})},e.prototype.invalidateDiscussionsList=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getDiscussionsListCacheKey(e))})},e.prototype.invalidateFiles=function(e){var n=this.sitesProvider.getCurrentSiteId();return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.invalidateForumData=function(e){return this.sitesProvider.getCurrentSite().invalidateWsCacheForKey(this.getForumDataCacheKey(e))},e.prototype.logView=function(e){var t={forumid:e};return this.sitesProvider.getCurrentSite().write("mod_forum_view_forum",t)},e.prototype.logDiscussionView=function(e){var t={discussionid:e};return this.sitesProvider.getCurrentSite().write("mod_forum_view_forum_discussion",t)},e.prototype.replyPost=function(e,t,n,o,r,i,s,a,c,u){var d=this;c=c||this.sitesProvider.getCurrentSiteId();var l=function(){return n?d.forumOffline.replyPost(e,t,n,o,r,i,s,a,c).then(function(){return!1}):Promise.reject(d.translate.instant("core.networkerrormsg"))};return!this.appProvider.isOnline()&&u?l():this.forumOffline.deleteReply(e,c).then(function(){return d.replyPostOnline(e,i,s,a,c).then(function(){return!0}).catch(function(e){return u&&!d.utils.isWebServiceError(e)?l():Promise.reject(e)})})},e.prototype.replyPostOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={postid:e,subject:t,message:n,options:i.utils.objectToArrayOfObjects(o,"name","value")};return r.write("mod_forum_add_discussion_post",s).then(function(e){return e&&e.postid?e.postid:Promise.reject(i.utils.createFakeWSError(""))})})},e.prototype.storeUserData=function(e){var t={};e.forEach(function(e){var n=parseInt(e.userid);isNaN(n)||t[n]||(t[n]={id:n,fullname:e.userfullname,profileimageurl:e.userpictureurl});var o=parseInt(e.usermodified);isNaN(o)||t[o]||(t[o]={id:o,fullname:e.usermodifiedfullname,profileimageurl:e.usermodifiedpictureurl})}),this.userProvider.storeUsers(this.utils.objectToArray(t))},e.COMPONENT="mmaModForum",e.DISCUSSIONS_PER_PAGE=10,e.NEW_DISCUSSION_EVENT="addon_mod_forum_new_discussion",e.REPLY_DISCUSSION_EVENT="addon_mod_forum_reply_discussion",e.VIEW_DISCUSSION_EVENT="addon_mod_forum_view_discussion",e=t=f([Object(o.A)(),p("design:paramtypes",[i.a,c.a,a.a,s.a,u.a,r.c,d.a,l.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(144),i=n(154),s=n(1),a=n(320),c=n(9),u=n(27),d=n(7),l=n(77),f=n(11),p=n(30),h=n(109),m=(n.n(h),n(322)),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(){function e(e,t,n,o,r,i,s,a,c){this.http=e,this.translate=t,this.appProvider=n,this.textUtils=o,this.fileProvider=i,this.fileTransfer=s,this.commonHttp=a,this.mimeUtils=c,this.mimeTypeCache={},this.ongoingCalls={},this.retryCalls=[],this.retryTimeout=0,this.logger=r.getInstance("CoreWSProvider")}return e.prototype.addToRetryQueue=function(e,t,n,o){var r={method:e,siteUrl:t,ajaxData:n,preSets:o,deferred:{}};return r.deferred.promise=new Promise(function(e,t){r.deferred.resolve=e,r.deferred.reject=t}),this.retryCalls.push(r),r.deferred.promise},e.prototype.call=function(e,t,n){var o;if(!n)return Promise.reject(this.createFakeWSError("core.unexpectederror",!0));if(!this.appProvider.isOnline())return Promise.reject(this.createFakeWSError("core.networkerrormsg",!0));n.typeExpected=n.typeExpected||"object",void 0===n.responseExpected&&(n.responseExpected=!0),(t=Object.assign({},t)).wsfunction=e,t.wstoken=n.wsToken,o=n.siteUrl+"/webservice/rest/server.php?moodlewsrestformat=json";var r=this.getPromiseHttp("post",n.siteUrl,t);return r||(this.retryCalls.length>0?(this.logger.warn("Calls locked, trying later..."),r=this.addToRetryQueue(e,o,t,n)):r=this.performPost(e,o,t,n)),r},e.prototype.callAjax=function(e,t,n){function o(e,t,n){return void 0===n&&(n=t?"invalidrecord"==t?-1:1:0),Promise.reject({error:e,errorcode:t,available:n})}var r,i=this;if(void 0===n.siteUrl)return o(this.translate.instant("core.unexpectederror"));if(!this.appProvider.isOnline())return o(this.translate.instant("core.networkerrormsg"));void 0===n.responseExpected&&(n.responseExpected=!0),r=[{index:0,methodname:e,args:this.convertValuesToString(t)}];return this.http.post(n.siteUrl+"/lib/ajax/service.php",JSON.stringify(r)).timeout(p.a.WS_TIMEOUT).toPromise().then(function(e){return e||n.responseExpected||(e=[{}]),e&&"object"==typeof e?e.error?o(e.error,e.errorcode):(e=e[0]).error?o(e.exception.message,e.exception.errorcode):e.data:o(i.translate.instant("core.serverconnection"))},function(e){var t=404==e.status?-1:0;return o(i.translate.instant("core.serverconnection"),"",t)})},e.prototype.convertValuesToString=function(e,t){var n;n=Array.isArray(e)||"object"!=typeof e?[]:{};for(var o in e)if("object"==typeof e[o])n[o]=this.convertValuesToString(e[o],t);else if("string"==typeof e[o]){if(n[o]=t?this.textUtils.stripUnicode(e[o]):e[o],t&&e[o]!=n[o]&&0==n[o].trim().length)throw new Error}else n[o]=e[o]+"";return n},e.prototype.createFakeWSError=function(e,t){return t&&(e=this.translate.instant(e)),{message:e}},e.prototype.downloadFile=function(e,t,n,o){var r=this;if(this.logger.debug("Downloading file",e,t,n),!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.networkerrormsg"));var i=t+".tmp";return this.fileProvider.createFile(i).then(function(s){var a=r.fileTransfer.create();return a.onProgress(o),a.download(e,s.toURL(),!0).then(function(){var o;if(n){var s=r.mimeUtils.getFileExtension(t);o=s&&"gdoc"!=s&&"gsheet"!=s&&"gslides"!=s&&"gdraw"!=s&&"php"!=s?Promise.resolve(s):r.getRemoteFileMimeType(e).then(function(n){if(n){var o=r.mimeUtils.getExtension(n,e);if(o&&(!s||"application/json"!=n))return s&&(t=r.mimeUtils.removeExtension(t)),t+="."+o,o}return s})}else o=Promise.resolve("");return o.then(function(n){return r.fileProvider.moveFile(i,t).then(function(o){return o.extension=n,o.path=t,r.logger.debug("Success downloading file "+e+" to "+t+" with extension "+n),o})})})}).catch(function(n){return r.logger.error("Error downloading "+e+" to "+t,n),Promise.reject(n)})},e.prototype.getPromiseHttp=function(e,t,n){var o=this.getQueueItemId(e,t,n);return void 0!==this.ongoingCalls[o]&&this.ongoingCalls[o]},e.prototype.getRemoteFileMimeType=function(e,t){var n=this;return this.mimeTypeCache[e]&&!t?Promise.resolve(this.mimeTypeCache[e]):this.performHead(e).then(function(t){var o=t.headers.get("Content-Type");return o&&(o=o.split(";")[0]),n.mimeTypeCache[e]=o,o||""}).catch(function(){return""})},e.prototype.getRemoteFileSize=function(e){return this.performHead(e).then(function(e){var t=parseInt(e.headers.get("Content-Length"),10);return t||-1}).catch(function(){return-1})},e.prototype.getQueueItemId=function(e,t,n){return n&&(t+="###"+m.a.serialize(n)),e+"#"+h.Md5.hashAsciiStr(t)},e.prototype.performHead=function(e){var t=this.getPromiseHttp("head",e);return t||(t=this.commonHttp.head(e).timeout(p.a.WS_TIMEOUT).toPromise(),t=this.setPromiseHttp(t,"head",e)),t},e.prototype.performPost=function(e,t,n,o){var r=this,i={};"number"!=o.typeExpected&&"boolean"!=o.typeExpected&&"string"!=o.typeExpected||(i.responseType="text");var s=this.http.post(t,n,i).timeout(p.a.WS_TIMEOUT).toPromise();return s=s.then(function(t){if(t||o.responseExpected||(t={}),!t)return Promise.reject(r.createFakeWSError("core.serverconnection",!0));if(typeof t!=o.typeExpected){if("string"!=typeof t)return r.logger.warn('Response of type "'+typeof t+'" received, expecting "'+o.typeExpected+'"'),Promise.reject(r.createFakeWSError("core.errorinvalidresponse",!0));if("number"==o.typeExpected){if(t=Number(t),isNaN(t))return r.logger.warn('Response expected type "'+o.typeExpected+'" cannot be parsed to number'),Promise.reject(r.createFakeWSError("core.errorinvalidresponse",!0))}else{if("boolean"!=o.typeExpected)return r.logger.warn('Response of type "'+typeof t+'" received, expecting "'+o.typeExpected+'"'),Promise.reject(r.createFakeWSError("core.errorinvalidresponse",!0));if("true"===t)t=!0;else{if("false"!==t)return r.logger.warn('Response expected type "'+o.typeExpected+'" is not true or false'),Promise.reject(r.createFakeWSError("core.errorinvalidresponse",!0));t=!1}}}return void 0!==t.exception?("tool_mobile_get_content"==e&&r.logger.error("Error calling WS",e,t),Promise.reject(t)):void 0!==t.debuginfo?Promise.reject(r.createFakeWSError("Error. "+t.message)):t},function(i){if(429==i.status){var s=r.addToRetryQueue(e,t,n,o);return 0==r.retryTimeout?(r.retryTimeout=parseInt(i.headers.get("Retry-After"),10)||5,r.logger.warn(i.statusText+". Retrying in "+r.retryTimeout+" seconds. "+r.retryCalls.length+" calls left."),setTimeout(function(){r.logger.warn("Retrying now with "+r.retryCalls.length+" calls to process."),r.retryTimeout=0,r.processRetryQueue()},1e3*r.retryTimeout)):r.logger.warn("Calls locked, trying later..."),s}return Promise.reject(r.createFakeWSError("core.serverconnection",!0))}),s=this.setPromiseHttp(s,"post",o.siteUrl,n)},e.prototype.processRetryQueue=function(){var e=this;if(this.retryCalls.length>0&&0==this.retryTimeout){var t=this.retryCalls.shift();setTimeout(function(){t.deferred.resolve(e.performPost(t.method,t.siteUrl,t.ajaxData,t.preSets)),e.processRetryQueue()},200)}else this.logger.warn("Retry queue has stopped with "+this.retryCalls.length+" calls and "+this.retryTimeout+" timeout secs.")},e.prototype.setPromiseHttp=function(e,t,n,o){var r,i=this,s=this.getQueueItemId(t,n,o);return this.ongoingCalls[s]=e,r=setTimeout(function(){delete i.ongoingCalls[s]},p.a.WS_TIMEOUT),e.finally(function(){delete i.ongoingCalls[s],clearTimeout(r)})},e.prototype.syncCall=function(e,t,n){var o,r,i={error:!0,message:""};if(!n)return i.message=this.translate.instant("core.unexpectederror"),i;if(!this.appProvider.isOnline())return i.message=this.translate.instant("core.networkerrormsg"),i;n.typeExpected=n.typeExpected||"object",void 0===n.responseExpected&&(n.responseExpected=!0);try{t=this.convertValuesToString(t,n.cleanUnicode)}catch(e){return i.message=this.translate.instant("core.unicodenotsupportedcleanerror"),i}t.wsfunction=e,t.wstoken=n.wsToken,o=n.siteUrl+"/webservice/rest/server.php?moodlewsrestformat=json",t=m.a.serialize(t),(r=new window.XMLHttpRequest).open("post",o,!1),r.setRequestHeader("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),r.send(t),t="response"in r?r.response:r.responseText;var s=Math.max(1223===r.status?204:r.status,0);return s<200||s>=300?(i.message=t,i):((t=this.textUtils.parseJSON(t))&&t.data||n.responseExpected||(t={}),t?typeof t!=n.typeExpected&&(this.logger.warn('Response of type "'+typeof t+'" received, expecting "'+n.typeExpected+'"'),i.message=this.translate.instant("core.errorinvalidresponse")):i.message=this.translate.instant("core.serverconnection"),void 0===t.exception&&void 0===t.debuginfo||(i.message=t.message),""!==i.message?i:t)},e.prototype.uploadFile=function(e,t,n,o){var r=this;if(this.logger.debug("Trying to upload file: "+e),!e||!t||!n)return Promise.reject(null);if(!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.networkerrormsg"));var i=n.siteUrl+"/webservice/upload.php",s=this.fileTransfer.create();return s.onProgress(o),t.httpMethod="POST",t.params={token:n.wsToken,filearea:t.fileArea||"draft",itemid:t.itemId||0},t.chunkedMode=!1,t.headers={Connection:"close"},s.upload(e,i,t,!0).then(function(t){var n=r.textUtils.parseJSON(t.response,null,r.logger.error.bind(r.logger,"Error parsing response from upload"));return null===n?Promise.reject(r.translate.instant("core.errorinvalidresponse")):n?"object"!=typeof n?(r.logger.warn('Upload file: Response of type "'+typeof n+'" received, expecting "object"'),Promise.reject(r.translate.instant("core.errorinvalidresponse"))):void 0!==n.exception?Promise.reject(n.message):n&&void 0!==n.error?Promise.reject(n.error):n[0]&&void 0!==n[0].error?Promise.reject(n[0].error):(r.logger.debug("Successfully uploaded file",e),n[0]):Promise.reject(r.translate.instant("core.serverconnection"))}).catch(function(t){return r.logger.error("Error while uploading file",e,t),Promise.reject(r.translate.instant("core.errorinvalidresponse"))})},e=g([Object(o.A)(),y("design:paramtypes",[i.b,s.c,c.a,f.a,d.a,u.a,a.a,r.a,l.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(58),i=n(7),s=n(2),a=n(12),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this,"CoreUserProfileFieldDelegate",t,n,o)||this;return r.loggerProvider=t,r.sitesProvider=n,r.eventsProvider=o,r.handlerNameProperty="type",r}return c(t,e),t.prototype.getComponent=function(e,t,n){var o,r=this,i=t.type||t.datatype;return o=n?this.executeFunction(i,"getComponent",[e]):this.executeFunctionOnEnabled(i,"getComponent",[e]),Promise.resolve(o).catch(function(e){r.logger.error("Error getting component for field",i,e)})},t.prototype.getDataForField=function(e,t,n,o){var r=e.type||e.datatype,i=this.getHandler(r,!t);if(i){var s="profile_field_"+e.shortname;if(i.getData)return Promise.resolve(i.getData(e,t,n,o));if(e.shortname&&void 0!==o[s])return Promise.resolve({type:r,name:s,value:o[s]})}return Promise.reject(null)},t.prototype.getDataForFields=function(e,t,n,o){var r=this;void 0===t&&(t=!1),void 0===n&&(n="");var i=[],s=[];return e?(e.forEach(function(e){s.push(r.getDataForField(e,t,n,o).then(function(e){e&&i.push(e)}).catch(function(){}))}),Promise.all(s).then(function(){return i})):Promise.resolve([])},t=u([Object(o.A)(),d("design:paramtypes",[i.a,s.a,a.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(8),s=n(50),a=n(96),c=(n.n(a),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},l=function(){function e(e,t,n,r){this.domUtils=e,this.sitePluginsProvider=t,this.navCtrl=n,this.onContentLoaded=new o.v,this.onLoadingContent=new o.v,this.invalidateObservable=new a.Subject,this.differ=r.find([]).create()}return e.prototype.ngOnInit=function(){this.fetchContent()},e.prototype.ngDoCheck=function(){if(this.data&&this.jsData){this.differ.diff(this.data)&&(this.jsData=Object.assign(this.jsData,this.data))}},e.prototype.fetchContent=function(e){var t=this;return this.onLoadingContent.emit(e),this.sitePluginsProvider.getContent(this.component,this.method,this.args).then(function(n){t.content=n.templates.length?n.templates[0].html:"",t.javascript=n.javascript,t.otherData=n.otherdata,t.data=t.data||{},t.jsData=Object.assign(t.data,t.sitePluginsProvider.createDataForJS(t.initResult,n)),t.jsData.openContent=t.openContent.bind(t),t.jsData.refreshContent=t.refreshContent.bind(t),t.jsData.updateContent=t.updateContent.bind(t),t.onContentLoaded.emit(e)}).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.errorloadingcontent",!0)}).finally(function(){t.dataLoaded=!0})},e.prototype.openContent=function(e,t,n,o){this.navCtrl.push("CoreSitePluginsPluginPage",{title:e,component:n||this.component,method:o||this.method,args:t,initResult:this.initResult})},e.prototype.refreshContent=function(e){var t=this;return void 0===e&&(e=!0),e&&(this.dataLoaded=!1),this.invalidateObservable.next(),this.sitePluginsProvider.invalidateContent(this.component,this.method,this.args).finally(function(){return t.fetchContent(!0)})},e.prototype.updateContent=function(e,t,n){this.component=t||this.component,this.method=n||this.method,this.args=e,this.dataLoaded=!1,this.fetchContent()},c([Object(o.D)(),u("design:type",String)],e.prototype,"component",void 0),c([Object(o.D)(),u("design:type",String)],e.prototype,"method",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"args",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"initResult",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"data",void 0),c([Object(o.O)(),u("design:type",o.v)],e.prototype,"onContentLoaded",void 0),c([Object(o.O)(),u("design:type",o.v)],e.prototype,"onLoadingContent",void 0),e=c([Object(o.m)({selector:"core-site-plugins-plugin-content",template:'<core-loading [hideUntil]="dataLoaded">\n    <core-compile-html [text]="content" [javascript]="javascript" [jsData]="jsData"></core-compile-html>\n</core-loading>\n'}),d(2,Object(o.N)()),u("design:paramtypes",[i.a,s.a,r.q,o.F])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(2),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.sitesProvider=e,this.files={}}return e.prototype.addFile=function(e,t,n,o){o=o||this.sitesProvider.getCurrentSiteId(),this.initFileArea(e,t,o),this.files[o][e][t].push(n)},e.prototype.clearFiles=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId(),this.files[n]&&this.files[n][e]&&this.files[n][e][t]&&(this.files[n][e][t]=[])},e.prototype.getFiles=function(e,t,n){return n=n||this.sitesProvider.getCurrentSiteId(),this.files[n]&&this.files[n][e]&&this.files[n][e][t]?this.files[n][e][t]:[]},e.prototype.initFileArea=function(e,t,n){this.files[n]||(this.files[n]={}),this.files[n][e]||(this.files[n][e]={}),this.files[n][e][t]||(this.files[n][e][t]=[])},e.prototype.removeFile=function(e,t,n,o){if(o=o||this.sitesProvider.getCurrentSiteId(),this.files[o]&&this.files[o][e]&&this.files[o][e][t]){var r=this.files[o][e][t].indexOf(n);-1!=r&&this.files[o][e][t].splice(r,1)}},e.prototype.removeFileByIndex=function(e,t,n,o){o=o||this.sitesProvider.getCurrentSiteId(),this.files[o]&&this.files[o][e]&&this.files[o][e][t]&&n>=0&&n<this.files[o][e][t].length&&this.files[o][e][t].splice(n,1)},e.prototype.setFiles=function(e,t,n,o){o=o||this.sitesProvider.getCurrentSiteId(),this.initFileArea(e,t,o),this.files[o][e][t]=n},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(58),i=n(12),s=n(7),a=n(2),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this,"AddonWorkshopAssessmentStrategyDelegate",t,n,o)||this;return r.loggerProvider=t,r.sitesProvider=n,r.eventsProvider=o,r.handlerNameProperty="strategyName",r}return c(t,e),t.prototype.isPluginSupported=function(e){return this.hasHandler(e,!0)},t.prototype.getComponentForPlugin=function(e,t){return this.executeFunctionOnEnabled(t,"getComponent",[e])},t.prototype.getOriginalValues=function(e,t,n){return Promise.resolve(this.executeFunctionOnEnabled(e,"getOriginalValues",[t,n])||[])},t.prototype.hasDataChanged=function(e,t,n){return this.executeFunctionOnEnabled(e.strategy,"hasDataChanged",[t,n])||!1},t.prototype.prepareAssessmentData=function(e,t,n){return Promise.resolve(this.executeFunctionOnEnabled(e,"prepareAssessmentData",[t,n]))},t=u([Object(o.A)(),d("design:paramtypes",[s.a,a.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e){this.name=e}return e.prototype.isEnabled=function(){return!0},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},c=function(){function e(e,t){this.masterNav=e,this.when="md",this.isEnabled=!1,this.masterPageName="",this.masterPageIndex=0,this.loadDetailPage=!1,this.detailPage=null,this.element=t.nativeElement}return e.prototype.ngOnInit=function(){this.masterPageName=this.masterNav.getActive().component.name,this.masterPageIndex=this.masterNav.indexOf(this.masterNav.getActive()),this.emptyDetails()},e.prototype.getDetailsNav=function(){return this.isEnabled?this.detailNav:this.masterNav},e.prototype.getMasterNav=function(){return this.masterNav},e.prototype.isOn=function(){return this.isEnabled},e.prototype.push=function(e,t){this.isEnabled?this.detailNav.setRoot(e,t):(this.loadDetailPage={component:e,data:t},this.masterNav.push(e,t))},e.prototype.emptyDetails=function(){this.loadDetailPage=!1,this.detailNav.setRoot("CoreSplitViewPlaceholderPage")},e.prototype.onSplitPaneChanged=function(e){this.isEnabled=e,this.masterNav&&this.detailNav&&(e?this.activateSplitView():this.deactivateSplitView())},e.prototype.activateSplitView=function(){var e=this.masterNav.getActive(),t=e.component.name;this.masterNav.getPrevious()&&this.masterNav.getPrevious().component.name==this.masterPageName&&(t!=this.masterPageName?(this.masterNav.pop(),this.detailNav.setRoot(e.component,e.data)):this.loadDetailPage&&this.detailNav.setRoot(this.loadDetailPage.component,this.loadDetailPage.data),this.loadDetailPage=!1)},e.prototype.deactivateSplitView=function(){var e=this.detailNav.getActive();"CoreSplitViewPlaceholderPage"!=e.component.name&&this.masterNav.insert(this.masterPageIndex+1,e.component,e.data)},i([Object(o._9)("detailNav"),s("design:type",r.p)],e.prototype,"detailNav",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"when",void 0),e=i([Object(o.m)({selector:"core-split-view",template:'<ion-split-pane (ionChange)="onSplitPaneChanged($event._visible);" [when]="when">\n    <ion-menu [content]="detailNav" type="push" class="core-avoid-header">\n        <ng-content></ng-content>\n    </ion-menu>\n    <ion-nav [root]="detailPage" #detailNav main class="core-avoid-header"></ion-nav>\n</ion-split-pane>'}),a(0,Object(o.N)()),s("design:paramtypes",[r.q,o.t])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=n(8),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.content=t,this.domUtils=n,this.selectedIndex=0,this.hideUntil=!0,this.parentScrollable=!1,this.ionChange=new o.v,this.tabs=[],this.maxSlides=3,this.slidesShown=this.maxSlides,this.numTabsShown=0,this.initialized=!1,this.afterViewInitTriggered=!1,this.tabsShown=!0,this.isDestroyed=!1,this.isCurrentView=!0,this.tabBarElement=e.nativeElement}return e.prototype.ngOnInit=function(){this.originalTabsContainer=this.originalTabsRef.nativeElement,this.topTabsElement=this.topTabs.nativeElement},e.prototype.ngAfterViewInit=function(){this.isDestroyed||(this.afterViewInitTriggered=!0,!this.initialized&&this.hideUntil&&this.initializeTabs(),this.resizeFunction=this.calculateSlides.bind(this),window.addEventListener("resize",this.resizeFunction))},e.prototype.ngOnChanges=function(e){var t=this;!this.initialized&&this.hideUntil&&this.afterViewInitTriggered&&setTimeout(function(){t.initializeTabs()})},e.prototype.ionViewDidEnter=function(){this.isCurrentView=!0,this.initialized&&this.calculateSlides()},e.prototype.ionViewDidLeave=function(){this.isCurrentView=!1},e.prototype.addTab=function(e){var t=this;-1==this.getIndex(e)&&(this.tabs.push(e),this.sortTabs(),this.calculateSlides(),this.initialized&&this.tabs.length>1&&0==this.tabBarHeight&&setTimeout(function(){t.calculateTabBarHeight()},50))},e.prototype.calculateSlides=function(){var e=this;this.isCurrentView&&this.tabsShown&&setTimeout(function(){e.calculateMaxSlides(),e.updateSlides()})},e.prototype.calculateTabBarHeight=function(){this.tabBarHeight=this.topTabsElement.offsetHeight,this.originalTabsContainer.style.paddingBottom=this.tabBarHeight+"px"},e.prototype.getIndex=function(e){for(var t=0;t<this.tabs.length;t++){var n=this.tabs[t];if(n===e||void 0!==n.id&&n.id===e.id)return t}return-1},e.prototype.getSelected=function(){return this.tabs[this.selected]},e.prototype.initializeTabs=function(){var e=this.selectedIndex||0,t=this.tabs[e];if(t&&t.enabled&&t.show||(t=this.tabs.find(function(t,n){return!(!t.enabled||!t.show)&&(e=n,!0)})),t&&this.selectTab(e),this.calculateTabBarHeight(),this.content)if(this.parentScrollable)this.originalTabsContainer.classList.add("no-scroll");else{var n=this.content.getScrollElement();n&&n.classList.add("no-scroll")}this.calculateSlides(),this.initialized=!0},e.prototype.slideChanged=function(){var e=this.slides.getActiveIndex();this.slidesShown>=this.numTabsShown?(this.showPrevButton=!1,this.showNextButton=!1):void 0!==e?(this.showPrevButton=e>0,this.showNextButton=e<this.numTabsShown-this.slidesShown):(this.showPrevButton=!1,this.showNextButton=this.numTabsShown>this.slidesShown)},e.prototype.updateSlides=function(){var e=this;this.numTabsShown=this.tabs.reduce(function(e,t){return t.show?e+1:e},0),this.slidesShown=Math.min(this.maxSlides,this.numTabsShown),this.slideChanged(),setTimeout(function(){e.slides.update(),e.slides.resize()})},e.prototype.calculateMaxSlides=function(){if(this.slides){var e=this.domUtils.getElementWidth(this.slides.getNativeElement())||this.slides.renderedWidth;if(e)return void(this.maxSlides=Math.floor(e/120))}this.maxSlides=3},e.prototype.slideNext=function(){this.showNextButton&&this.slides.slideNext()},e.prototype.slidePrev=function(){this.showPrevButton&&this.slides.slidePrev()},e.prototype.showHideTabs=function(e){this.tabBarHeight&&(this.tabsShown&&e.target.scrollTop-this.tabBarHeight>this.tabBarHeight?(this.tabBarElement.classList.add("tabs-hidden"),this.tabsShown=!1):!this.tabsShown&&e.target.scrollTop<this.tabBarHeight&&(this.tabBarElement.classList.remove("tabs-hidden"),this.tabsShown=!0,this.calculateSlides()))},e.prototype.removeTab=function(e){var t=this.getIndex(e);this.tabs.splice(t,1),this.calculateSlides()},e.prototype.selectTab=function(e){if(e!=this.selected){(e<0||e>=this.tabs.length)&&(e=0);var t=this.getSelected(),n=this.tabs[e];n.enabled&&n.show&&(t&&t.unselectTab(),this.selected&&this.slides.slideTo(e),this.selected=e,n.selectTab(),this.ionChange.emit(n))}},e.prototype.sortTabs=function(){var e=this;if(this.originalTabsContainer){var t=[];this.tabs.forEach(function(n,o){var r=Array.prototype.indexOf.call(e.originalTabsContainer.children,n.element);-1!=r&&(t[r]=n)}),this.tabs=t}},e.prototype.tabVisibilityChanged=function(){this.calculateSlides()},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.resizeFunction&&window.removeEventListener("resize",this.resizeFunction)},s([Object(o.D)(),a("design:type",Object)],e.prototype,"selectedIndex",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"hideUntil",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"parentScrollable",void 0),s([Object(o.O)(),a("design:type",o.v)],e.prototype,"ionChange",void 0),s([Object(o._9)("originalTabs"),a("design:type",o.t)],e.prototype,"originalTabsRef",void 0),s([Object(o._9)("topTabs"),a("design:type",o.t)],e.prototype,"topTabs",void 0),s([Object(o._9)(r.w),a("design:type",r.w)],e.prototype,"slides",void 0),e=s([Object(o.m)({selector:"core-tabs",template:'<core-loading [hideUntil]="hideUntil" class="core-loading-center">\n    <div class="core-tabs-bar" #topTabs [hidden]="!tabs || tabs.length < 2">\n        <ion-row>\n            <ion-col class="col-with-arrow" (click)="slidePrev()" no-padding col-1>\n                <ion-icon *ngIf="showPrevButton" name="arrow-back"></ion-icon>\n            </ion-col>\n            <ion-col no-padding col-10>\n                <ion-slides (ionSlideDidChange)="slideChanged()" [slidesPerView]="slidesShown">\n                    <ng-container *ngFor="let tab of tabs; let idx = index">\n                        <ion-slide *ngIf="tab.show">\n                            <a [attr.aria-selected]="selected == idx" (click)="selectTab(idx)" class="tab-slide">\n                                <core-icon *ngIf="tab.icon" [name]="tab.icon"></core-icon>\n                                <span *ngIf="tab.title">{{ tab.title }}</span>\n                                <ion-badge *ngIf="tab.badge" [color]="tab.badgeStyle" class="tab-badge">{{tab.badge}}</ion-badge>\n                            </a>\n                        </ion-slide>\n                    </ng-container>\n                </ion-slides>\n            </ion-col>\n            <ion-col class="col-with-arrow" (click)="slideNext()" no-padding col-1>\n                <ion-icon *ngIf="showNextButton" name="arrow-forward"></ion-icon>\n            </ion-col>\n        </ion-row>\n    </div>\n    <div class="core-tabs-content-container" #originalTabs>\n        <ng-content></ng-content>\n    </div>\n</core-loading>\n'}),a("design:paramtypes",[o.t,r.f,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(1),i=n(27),s=n(56),a=n(2),c=n(11),u=n(6),d=n(106),l=n(116),f=n(131),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,o,r,i,s,a,c){this.translate=e,this.fileProvider=t,this.uploaderProvider=n,this.sitesProvider=o,this.textUtils=r,this.utils=i,this.workshopProvider=s,this.workshopOffline=a,this.strategyDelegate=c}return e.prototype.getTask=function(e,t){for(var n in e)if(e[n].code==t)return e[n];return!1},e.prototype.isTaskDone=function(e,t){var n=this.getTask(e,t);return!n||n.completed},e.prototype.canSubmit=function(e,t,n){var o=e.useexamples&&e.examplesmode==d.a.EXAMPLES_BEFORE_SUBMISSION,r=t.canmanageexamples||e.examplesmode==d.a.EXAMPLES_VOLUNTARY||this.isTaskDone(n,"examples");return e.phase>d.a.PHASE_SETUP&&t.cansubmit&&(!o||r)},e.prototype.canAssess=function(e,t){return!(e.useexamples&&e.examplesmode==d.a.EXAMPLES_BEFORE_ASSESSMENT)||t.canmanageexamples},e.prototype.getUserSubmission=function(e,t){var n=this;return void 0===t&&(t=0),this.workshopProvider.getSubmissions(e).then(function(e){t=t||n.sitesProvider.getCurrentSiteUserId();for(var o in e)if(e[o].authorid==t)return e[o];return!1})},e.prototype.getSubmissionById=function(e,t,n){var o=this;return this.workshopProvider.getSubmission(e,t,n).catch(function(){return o.workshopProvider.getSubmissions(e,void 0,void 0,void 0,void 0,n).then(function(e){for(var n in e)if(e[n].id==t)return e[n];return!1})})},e.prototype.getReviewerAssessmentById=function(e,t,n,o){var r=this;return void 0===n&&(n=0),this.workshopProvider.getAssessment(e,t,o).catch(function(){return r.workshopProvider.getReviewerAssessments(e,n,void 0,void 0,o).then(function(e){for(var n in e)if(e[n].id==t)return e[n];return!1})}).then(function(n){return!!n&&r.workshopProvider.getAssessmentForm(e,t,void 0,void 0,void 0,o).then(function(e){return n.form=e,n})})},e.prototype.getReviewerAssessments=function(e,t,n,o,r){var i=this;return void 0===t&&(t=0),void 0===n&&(n=!1),void 0===o&&(o=!1),r=r||this.sitesProvider.getCurrentSiteId(),this.workshopProvider.getReviewerAssessments(e,t,n,o,r).then(function(t){var n=t.map(function(t){return i.getSubmissionById(e,t.submissionid,r).then(function(e){t.submission=e})});return Promise.all(n).then(function(){return t})})},e.prototype.deleteSubmissionStoredFiles=function(e,t,n,o){var r=this;return this.workshopOffline.getSubmissionFolder(e,t,n,o).then(function(e){return r.fileProvider.removeDir(e).catch(function(){})})},e.prototype.storeSubmissionFiles=function(e,t,n,o,r){var i=this;return this.workshopOffline.getSubmissionFolder(e,t,n,r).then(function(e){return i.uploaderProvider.storeFilesToUpload(e,o)})},e.prototype.uploadOrStoreSubmissionFiles=function(e,t,n,o,r,i){return r?this.storeSubmissionFiles(e,t,o,n,i):this.uploaderProvider.uploadOrReuploadFiles(n,d.a.COMPONENT,e,i)},e.prototype.getStoredSubmissionFiles=function(e,t,n,o){var r=this;return this.workshopOffline.getSubmissionFolder(e,t,n,o).then(function(e){return r.uploaderProvider.getStoredFiles(e).catch(function(){return[]})})},e.prototype.getSubmissionFilesFromOfflineFilesObject=function(e,t,n,o,r){var i=this;return this.workshopOffline.getSubmissionFolder(t,n,o,r).then(function(t){return i.uploaderProvider.getStoredFilesFromOfflineFilesObject(e,t)})},e.prototype.deleteAssessmentStoredFiles=function(e,t,n){var o=this;return this.workshopOffline.getAssessmentFolder(e,t,n).then(function(e){return o.fileProvider.removeDir(e).catch(function(){})})},e.prototype.storeAssessmentFiles=function(e,t,n,o){var r=this;return this.workshopOffline.getAssessmentFolder(e,t,o).then(function(e){return r.uploaderProvider.storeFilesToUpload(e,n)})},e.prototype.uploadOrStoreAssessmentFiles=function(e,t,n,o,r){return o?this.storeAssessmentFiles(e,t,n,r):this.uploaderProvider.uploadOrReuploadFiles(n,d.a.COMPONENT,e,r)},e.prototype.getStoredAssessmentFiles=function(e,t,n){var o=this;return this.workshopOffline.getAssessmentFolder(e,t,n).then(function(e){return o.uploaderProvider.getStoredFiles(e).catch(function(){return[]})})},e.prototype.getAssessmentFilesFromOfflineFilesObject=function(e,t,n,o){var r=this;return this.workshopOffline.getAssessmentFolder(t,n,o).then(function(t){return r.uploaderProvider.getStoredFilesFromOfflineFilesObject(e,t)})},e.prototype.filterSubmissionActions=function(e,t){return e.filter(function(e){return t?e.submissionid==t:e.submissionid<0})},e.prototype.applyOfflineData=function(e,t){t.length&&!e&&(e={});var n,o=!0,r=!1;if(t.forEach(function(t){switch(t.action){case"add":e.id=t.submissionid,o=!1;case"update":e.title=t.title,e.content=t.content,e.title=t.title,e.courseid=t.courseid,e.submissionmodified=parseInt(t.timemodified,10)/1e3,e.offline=!0,r=t.attachmentsid,n=t.workshopid;break;case"delete":e.deleted=!0,e.submissionmodified=parseInt(t.timemodified,10)/1e3}}),t.length){if(r)return this.getSubmissionFilesFromOfflineFilesObject(r,n,e.id,o).then(function(t){return e.attachmentfiles=t,e});e.attachmentfiles=[]}return Promise.resolve(e)},e.prototype.prepareAssessmentData=function(e,t,n,o,r,i){return 2!=e.overallfeedbackmode||n?this.strategyDelegate.prepareAssessmentData(e.strategy,t,r).then(function(e){return e.feedbackauthor=n,e.feedbackauthorattachmentsid=i||0,e.nodims=r.dimenssionscount,e}):Promise.reject({feedbackauthor:this.translate.instant("core.err_required")})},e.prototype.realGradeValueHelper=function(e,t,n){return null==e?null:0==t?"0":(e=this.textUtils.roundToDecimals(t*e/100,n),this.utils.formatFloat(e))},e.prototype.realGradeValue=function(e,t){return t.grade=this.realGradeValueHelper(t.grade,e.grade,e.gradedecimals),t.gradinggrade=this.realGradeValueHelper(t.gradinggrade,e.gradinggrade,e.gradedecimals),t.gradinggradeover=this.realGradeValueHelper(t.gradinggradeover,e.gradinggrade,e.gradedecimals),t},e.prototype.showGrade=function(e){return void 0!==e&&null!==e},e=p([Object(o.A)(),h("design:paramtypes",[r.c,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(11),u=n(6),d=n(163),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.appProvider=e,this.sitesProvider=t,this.filepoolProvider=n,this.translate=o,this.textUtils=r,this.utils=i,this.glossaryOffline=s,this.ROOT_CACHE_KEY="mmaModGlossary:"}return t=e,e.prototype.getCourseGlossariesCacheKey=function(e){return this.ROOT_CACHE_KEY+"courseGlossaries:"+e},e.prototype.getCourseGlossaries=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={courseids:[e]},r={cacheKey:n.getCourseGlossariesCacheKey(e)};return t.read("mod_glossary_get_glossaries_by_courses",o,r).then(function(e){return e.glossaries})})},e.prototype.invalidateCourseGlossaries=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o=n.getCourseGlossariesCacheKey(e);return t.invalidateWsCacheForKey(o)})},e.prototype.getEntriesByAuthorCacheKey=function(e,t,n,o){return this.ROOT_CACHE_KEY+"entriesByAuthor:"+e+":"+t+":"+n+":"+o},e.prototype.getEntriesByAuthor=function(e,t,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){var u={id:e,letter:t,field:n,sort:o,from:r,limit:i},d={cacheKey:c.getEntriesByAuthorCacheKey(e,t,n,o),omitExpires:s};return a.read("mod_glossary_get_entries_by_author",u,d)})},e.prototype.invalidateEntriesByAuthor=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s=i.getEntriesByAuthorCacheKey(e,t,n,o);return r.invalidateWsCacheForKey(s)})},e.prototype.getEntriesByCategory=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={id:e,categoryid:t,from:n,limit:o},c={cacheKey:s.getEntriesByCategoryCacheKey(e,t),omitExpires:r};return i.read("mod_glossary_get_entries_by_category",a,c)})},e.prototype.invalidateEntriesByCategory=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r=o.getEntriesByCategoryCacheKey(e,t);return n.invalidateWsCacheForKey(r)})},e.prototype.getEntriesByCategoryCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"entriesByCategory:"+e+":"+t},e.prototype.getEntriesByDateCacheKey=function(e,t,n){return this.ROOT_CACHE_KEY+"entriesByDate:"+e+":"+t+":"+n},e.prototype.getEntriesByDate=function(e,t,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){var c={id:e,order:t,sort:n,from:o,limit:r},u={cacheKey:a.getEntriesByDateCacheKey(e,t,n),omitExpires:i};return s.read("mod_glossary_get_entries_by_date",c,u)})},e.prototype.invalidateEntriesByDate=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i=r.getEntriesByDateCacheKey(e,t,n);return o.invalidateWsCacheForKey(i)})},e.prototype.getEntriesByLetterCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"entriesByLetter:"+e+":"+t},e.prototype.getEntriesByLetter=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={id:e,letter:t,from:n,limit:o},c={cacheKey:s.getEntriesByLetterCacheKey(e,t),omitExpires:r};return i.read("mod_glossary_get_entries_by_letter",a,c)})},e.prototype.invalidateEntriesByLetter=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r=o.getEntriesByLetterCacheKey(e,t);return n.invalidateWsCacheForKey(r)})},e.prototype.getEntriesBySearchCacheKey=function(e,t,n,o,r){return this.ROOT_CACHE_KEY+"entriesBySearch:"+e+":"+n+":"+o+":"+r+":"+t},e.prototype.getEntriesBySearch=function(e,t,n,o,r,i,s,a,c){var u=this;return this.sitesProvider.getSite(c).then(function(c){var d={id:e,query:t,fullsearch:n,order:o,sort:r,from:i,limit:s},l={cacheKey:u.getEntriesBySearchCacheKey(e,t,n,o,r),omitExpires:a};return c.read("mod_glossary_get_entries_by_search",d,l)})},e.prototype.invalidateEntriesBySearch=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a=s.getEntriesBySearchCacheKey(e,t,n,o,r);return i.invalidateWsCacheForKey(a)})},e.prototype.getCategoriesCacheKey=function(e){return this.ROOT_CACHE_KEY+"categories:"+e},e.prototype.getAllCategories=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return o.getCategories(e,0,t.LIMIT_CATEGORIES,[],n)})},e.prototype.getCategories=function(e,t,n,o,r){var i=this,s={id:e,from:t,limit:n},a={cacheKey:this.getCategoriesCacheKey(e)};return r.read("mod_glossary_get_categories",s,a).then(function(s){o=o.concat(s.categories);return t+n<s.count?(t+=n,i.getCategories(e,t,n,o,r)):o})},e.prototype.invalidateCategories=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getCategoriesCacheKey(e))})},e.prototype.getEntryCacheKey=function(e){return this.ROOT_CACHE_KEY+"getEntry:"+e},e.prototype.getEntry=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={id:e},r={cacheKey:n.getEntryCacheKey(e)};return t.read("mod_glossary_get_entry_by_id",o,r).then(function(e){return e&&e.entry?e.entry:Promise.reject(null)})})},e.prototype.fetchEntries=function(e,n,o,r,i,s){void 0===o&&(o=0),void 0===i&&(i=!1),r=r||t.LIMIT_ENTRIES,s=s||this.sitesProvider.getCurrentSiteId();var a=n.slice();return a.push(o),a.push(r),a.push(i),a.push(s),e.apply(this,a)},e.prototype.fetchAllEntries=function(e,n,o,r){var i=this;void 0===o&&(o=!1),r=r||this.sitesProvider.getCurrentSiteId();var s=[],a=t.LIMIT_ENTRIES,c=function(){return i.fetchEntries(e,n,s.length,a,o,r).then(function(e){return Array.prototype.push.apply(s,e.entries),s.length<e.count?c():s})};return c()},e.prototype.invalidateEntry=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getEntryCacheKey(e))})},e.prototype.invalidateEntries=function(e,t){var n=this,o=[];return e.forEach(function(e){o.push(n.getEntryCacheKey(e.id))}),this.sitesProvider.getSite(t).then(function(e){return e.invalidateMultipleWsCacheForKey(o)})},e.prototype.invalidateContent=function(e,t){var n=this;return this.getGlossary(t,e).then(function(e){return n.invalidateGlossaryEntries(e).finally(function(){return n.utils.allPromises([n.invalidateCourseGlossaries(t),n.invalidateCategories(e.id)])})})},e.prototype.invalidateGlossaryEntries=function(e,n){var o=this,r=[];return n||r.push(this.fetchAllEntries(this.getEntriesByLetter,[e.id,"ALL"],!0).then(function(e){return o.invalidateEntries(e)})),e.browsemodes.forEach(function(n){switch(n){case"letter":r.push(o.invalidateEntriesByLetter(e.id,"ALL"));break;case"cat":r.push(o.invalidateEntriesByCategory(e.id,t.SHOW_ALL_CATERGORIES));break;case"date":r.push(o.invalidateEntriesByDate(e.id,"CREATION","DESC")),r.push(o.invalidateEntriesByDate(e.id,"UPDATE","DESC"));break;case"author":r.push(o.invalidateEntriesByAuthor(e.id,"ALL","LASTNAME","ASC"))}}),this.utils.allPromises(r)},e.prototype.invalidateFiles=function(e,n){return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.getGlossary=function(e,t,n){return this.getCourseGlossaries(e,n).then(function(e){var n=e.find(function(e){return e.coursemodule==t});return n||Promise.reject(null)})},e.prototype.getGlossaryById=function(e,t,n){return this.getCourseGlossaries(e,n).then(function(e){var n=e.find(function(e){return e.id==t});return n||Promise.reject(null)})},e.prototype.addEntry=function(e,t,n,o,r,i,s,a,c,u,d){var l=this;a=a||this.sitesProvider.getCurrentSiteId();var f=function(){return(d?l.isConceptUsed(e,t,c&&c.timecreated,a):Promise.resolve(!1)).then(function(u){return u?Promise.reject(l.translate.instant("addon.mod_glossary.errconceptalreadyexists")):l.glossaryOffline.addNewEntry(e,t,n,o,i,r,s,a,void 0,c).then(function(){return!1})})};if(!this.appProvider.isOnline()&&u)return f();return(c?this.glossaryOffline.deleteNewEntry(e,c.concept,c.timecreated,a):Promise.resolve()).then(function(){return l.addEntryOnline(e,t,n,r,i,a).then(function(e){return e}).catch(function(e){return u&&!l.utils.isWebServiceError(e)?f():Promise.reject(e)})})},e.prototype.addEntryOnline=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={glossaryid:e,concept:t,definition:n,definitionformat:1,options:s.utils.objectToArrayOfObjects(o||{},"name","value")};return r&&a.options.push({name:"attachmentsid",value:r}),i.isVersionGreaterEqualThan("3.2.2")||(a.definition=s.textUtils.cleanTags(a.definition)),i.write("mod_glossary_add_entry",a).then(function(e){return e&&e.entryid?e.entryid:Promise.reject(s.utils.createFakeWSError(""))})})},e.prototype.isConceptUsed=function(e,t,n,o){var r=this;return this.glossaryOffline.isConceptUsed(e,t,n,o).then(function(n){return!!n||r.fetchAllEntries(r.getEntriesByLetter,[e,"ALL"],!0,o).then(function(e){return e.some(function(e){return e.concept==t})})}).catch(function(){return!1})},e.prototype.isPluginEnabledForEditing=function(){return this.sitesProvider.getCurrentSite().wsAvailable("mod_glossary_add_entry")},e.prototype.logView=function(e,t){var n={id:e,mode:t};return this.sitesProvider.getCurrentSite().write("mod_glossary_view_glossary",n)},e.prototype.logEntryView=function(e){var t={id:e};return this.sitesProvider.getCurrentSite().write("mod_glossary_view_entry",t)},e.COMPONENT="mmaModGlossary",e.LIMIT_ENTRIES=25,e.LIMIT_CATEGORIES=10,e.SHOW_ALL_CATERGORIES=0,e.SHOW_NOT_CATEGORISED=-1,e.ADD_ENTRY_EVENT="addon_mod_glossary_add_entry",e=t=l([Object(o.A)(),f("design:paramtypes",[i.a,a.a,s.a,r.c,c.a,u.a,d.a])],e);var t}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return AddonModScormProvider});var __WEBPACK_IMPORTED_MODULE_0__angular_core__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__ngx_translate_core__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_2__providers_filepool__=__webpack_require__(18),__WEBPACK_IMPORTED_MODULE_3__providers_logger__=__webpack_require__(7),__WEBPACK_IMPORTED_MODULE_4__providers_sites__=__webpack_require__(2),__WEBPACK_IMPORTED_MODULE_5__providers_sync__=__webpack_require__(45),__WEBPACK_IMPORTED_MODULE_6__providers_ws__=__webpack_require__(118),__WEBPACK_IMPORTED_MODULE_7__providers_utils_text__=__webpack_require__(11),__WEBPACK_IMPORTED_MODULE_8__providers_utils_time__=__webpack_require__(22),__WEBPACK_IMPORTED_MODULE_9__providers_utils_utils__=__webpack_require__(6),__WEBPACK_IMPORTED_MODULE_10__scorm_offline__=__webpack_require__(192),__WEBPACK_IMPORTED_MODULE_11__core_constants__=__webpack_require__(30),__decorate=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},AddonModScormProvider=function(){function AddonModScormProvider(e,t,n,o,r,i,s,a,c,u){this.translate=t,this.sitesProvider=n,this.wsProvider=o,this.textUtils=r,this.utils=i,this.filepoolProvider=s,this.scormOfflineProvider=a,this.timeUtils=c,this.syncProvider=u,this.VALID_STATUSES=["notattempted","passed","completed","failed","incomplete","browsed","suspend"],this.STATUSES={passed:"passed",completed:"completed",failed:"failed",incomplete:"incomplete",browsed:"browsed","not attempted":"notattempted",p:"passed",c:"completed",f:"failed",i:"incomplete",b:"browsed",n:"notattempted"},this.ROOT_CACHE_KEY="mmaModScorm:",this.logger=e.getInstance("AddonModScormProvider")}return AddonModScormProvider_1=AddonModScormProvider,AddonModScormProvider.prototype.calculateScormGrade=function(e,t){if(!t||!Object.keys(t).length)return-1;switch(e.whatgrade){case AddonModScormProvider_1.FIRSTATTEMPT:return t[1]?t[1].grade:-1;case AddonModScormProvider_1.LASTATTEMPT:var n=0;return Object.keys(t).forEach(function(e){n=Math.max(Number(e),n)}),n>0?t[n].grade:-1;case AddonModScormProvider_1.HIGHESTATTEMPT:var o=0;for(var r in t)o=Math.max(t[r].grade,o);return o;case AddonModScormProvider_1.AVERAGEATTEMPT:var i=0,s=0;for(var r in t)i+=t[r].grade,s++;return Math.round(i/s);default:return-1}},AddonModScormProvider.prototype.calculateScormSize=function(e){return e.packagesize?Promise.resolve(e.packagesize):this.wsProvider.getRemoteFileSize(this.getPackageUrl(e))},AddonModScormProvider.prototype.countAttemptsLeft=function(e,t){return 0==e.maxattempt?Number.MAX_VALUE:(t=Number(t),isNaN(t)?-1:e.maxattempt-t)},AddonModScormProvider.prototype.determineAttemptAndMode=function(e,t,n,o,r){if(t==AddonModScormProvider_1.MODEBROWSE){if(!e.hidebrowse)return 0==n&&(n=1,o=!0),{mode:t,attempt:n,newAttempt:o};t=AddonModScormProvider_1.MODENORMAL}return 0==n?o=!0:r?o=!1:e.forcenewattempt&&(o=!0),o&&(0==e.maxattempt||n<e.maxattempt)?(n++,t=AddonModScormProvider_1.MODENORMAL):t=r?AddonModScormProvider_1.MODENORMAL:AddonModScormProvider_1.MODEREVIEW,{mode:t,attempt:n,newAttempt:o}},AddonModScormProvider.prototype.displayTocInPlayer=function(e){return 3!==e.hidetoc},AddonModScormProvider.prototype.evalPrerequisites=function(prerequisites,trackData){var _this=this,stack=[];prerequisites=prerequisites.replace(/&amp;/gi,"&"),prerequisites=prerequisites.replace(/(&|\||\(|\)|\~)/gi,"\t$1\t"),prerequisites=prerequisites.replace(/&/gi,"&&"),prerequisites=prerequisites.replace(/\|/gi,"||");var elements=prerequisites.trim().split("\t");return elements.forEach(function(e){if(e=e.trim()){if(!e.match(/^(&&|\|\||\(|\))$/gi)){var t=/^(\d+)\*\{(.+)\}$/,n=/^(.+)(\=|\<\>)(.+)$/,o=void 0;if(t.test(e)){var r=(o=e.match(t))[1],i=0;o[2].split(",").forEach(function(e){e=e.trim(),void 0===trackData[e]||"completed"!=trackData[e].status&&"passed"!=trackData[e].status||i++}),e=i>=r?"true":"false"}else if("~"==e)e="!";else if(n.test(e))if(o=e.match(n),e=o[1].trim(),void 0!==trackData[e]){var s=o[3].trim().replace(/(\'|\")/gi);void 0!==_this.STATUSES[s]&&(s=_this.STATUSES[s]),e="('"+trackData[e].status+"' "+("<>"==o[2]?"!=":"==")+" '"+s+"')"}else e="false";else e=void 0===trackData[e]||"completed"!=trackData[e].status&&"passed"!=trackData[e].status?"false":"true"}stack.push(" "+e+" ")}}),eval(stack.join("")+";")},AddonModScormProvider.prototype.formatGrade=function(e,t){return void 0===t||-1==t?this.translate.instant("core.none"):e.grademethod!==AddonModScormProvider_1.GRADESCOES&&e.maxgrade>0?(t=t/e.maxgrade*100,this.translate.instant("core.percentagenumber",{$a:this.textUtils.roundToDecimals(t,2)})):String(t)},AddonModScormProvider.prototype.formatTocToArray=function(e,t){var n=this;if(void 0===t&&(t=0),!e||!e.length)return[];var o=[];return e.forEach(function(e){e.level=t,o.push(e),o=o.concat(n.formatTocToArray(e.children,t+1))}),o},AddonModScormProvider.prototype.getAttemptCount=function(e,t,n,o,r){var i=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(o).then(function(s){r=r||s.getUserId();var a={lastAttempt:{number:0,offline:!1}},c=[];return c.push(i.getAttemptCountOnline(e,t,n,o,r).then(function(e){a.online=[];for(var t=1;t<=e;t++)a.online.push(t);e>a.lastAttempt.number&&(a.lastAttempt.number=e,a.lastAttempt.offline=!1)})),c.push(i.scormOfflineProvider.getAttempts(e,o,r).then(function(e){a.offline=e.map(function(e){return e.attempt>=a.lastAttempt.number&&(a.lastAttempt.number=e.attempt,a.lastAttempt.offline=!0),e.attempt})})),Promise.all(c).then(function(){var e=a.online.length;return a.offline.forEach(function(t){-1==a.online.indexOf(t)&&e++}),a.total=e,a})})},AddonModScormProvider.prototype.getAttemptCountCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"attemptcount:"+e+":"+t},AddonModScormProvider.prototype.getAttemptCountOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){r=r||o.getUserId();var s={scormid:e,userid:r,ignoremissingcompletion:t?1:0},a={cacheKey:i.getAttemptCountCacheKey(e,r)};return n&&(a.getFromCache=!1,a.emergencyCache=!1),o.read("mod_scorm_get_scorm_attempt_count",s,a).then(function(e){return e&&void 0!==e.attemptscount?e.attemptscount:Promise.reject(null)})})},AddonModScormProvider.prototype.getAttemptGrade=function(e,t,n,o){var r={scos:0,values:0,max:0,sum:0};return this.getScormUserData(e.id,t,void 0,n,!1,o).then(function(t){for(var n in t){var o=t[n].userdata;if("completed"!=o.status&&"passed"!=o.status||r.scos++,o.score_raw||void 0!==e.scormtype&&"sco"==e.scormtype&&void 0!==o.score_raw){var i=parseFloat(o.score_raw);r.values++,r.sum+=i,r.max=Math.max(i,r.max)}}var s=0;switch(e.grademethod){case AddonModScormProvider_1.GRADEHIGHEST:s=r.max;break;case AddonModScormProvider_1.GRADEAVERAGE:s=r.values>0?r.sum/r.values:0;break;case AddonModScormProvider_1.GRADESUM:s=r.sum;break;case AddonModScormProvider_1.GRADESCOES:s=r.scos;break;default:s=r.max}return s})},AddonModScormProvider.prototype.getOrganizations=function(e,t){return this.getScos(e,void 0,!1,t).then(function(e){var t=[];return e.forEach(function(e){""==e.organization&&"/"==e.parent&&""==e.scormtype&&t.push({identifier:e.identifier,title:e.title,sortorder:e.sortorder})}),t})},AddonModScormProvider.prototype.getOrganizationToc=function(e,t,n,o,r){return this.getScosWithData(e,t,n,o,!1,r).then(function(e){var t={},o=[];return e.forEach(function(r,i){r.children=[],t[r.identifier]=i,"/"!==r.parent&&(r.parent==n?o.push(r):e[t[r.parent]].children.push(r))}),o})},AddonModScormProvider.prototype.getPackageUrl=function(e){return e.packageurl?e.packageurl:e.reference?e.reference:""},AddonModScormProvider.prototype.getScormUserData=function(e,t,n,o,r,i){var s=this;if(i=i||this.sitesProvider.getCurrentSiteId(),o){return(n?Promise.resolve(n):this.getScos(e,void 0,void 0,i)).then(function(n){return s.scormOfflineProvider.getScormUserData(e,t,n,i)})}return this.getScormUserDataOnline(e,t,r,i)},AddonModScormProvider.prototype.getScormUserDataCacheKey=function(e,t){return this.getScormUserDataCommonCacheKey(e)+":"+t},AddonModScormProvider.prototype.getScormUserDataCommonCacheKey=function(e){return this.ROOT_CACHE_KEY+"userdata:"+e},AddonModScormProvider.prototype.getScormUserDataOnline=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={scormid:e,attempt:t},s={cacheKey:r.getScormUserDataCacheKey(e,t)};return n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_scorm_get_scorm_user_data",i,s).then(function(e){if(e&&e.data){var t={};return e.data.forEach(function(e){e.defaultdata=r.utils.objectToKeyValueMap(e.defaultdata,"element","value"),e.userdata=r.utils.objectToKeyValueMap(e.userdata,"element","value"),t[e.scoid]=e}),t}return Promise.reject(null)})})},AddonModScormProvider.prototype.getScosCacheKey=function(e){return this.ROOT_CACHE_KEY+"scos:"+e},AddonModScormProvider.prototype.getScos=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(o).then(function(o){var i={scormid:e},s={cacheKey:r.getScosCacheKey(e)};return n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_scorm_get_scorm_scoes",i,s).then(function(e){return e&&e.scoes?t?e.scoes.filter(function(e){return e.organization==t}):e.scoes:Promise.reject(null)})})},AddonModScormProvider.prototype.getScosWithData=function(e,t,n,o,r,i){var s=this;return this.getScos(e,n,r,i).then(function(n){return s.getScormUserData(e,t,n,o,r,i).then(function(e){var t={};return n.forEach(function(n){t[n.identifier]=e[n.id].userdata}),n.forEach(function(n){var o=e[n.id].userdata;o&&(n.isvisible=void 0===o.isvisible||o.isvisible&&"false"!==o.isvisible,n.prereq=void 0===o.prerequisites||s.evalPrerequisites(o.prerequisites,t),n.status=void 0===o.status||""===o.status?"notattempted":o.status,n.exitvar=void 0===o.exitvar?"cmi.core.exit":o.exitvar,n.exitvalue=o[n.exitvar])}),n})})},AddonModScormProvider.prototype.getScoSrc=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r,i=t.launch;if(t.extradata&&t.extradata.length)for(var s=0;s<t.extradata.length;s++){var a=t.extradata[s];if("parameters"==a.element){r=a.value;break}}if(r){var c=i.indexOf("?")>-1?"&":"?";"?"==r.charAt(0)&&(r=r.substr(1)),i+=c+r}return this.isExternalLink(i)?Promise.resolve(i):this.filepoolProvider.getPackageDirUrlByUrl(n,e.moduleurl).then(function(e){return o.textUtils.concatenatePaths(e,i)})},AddonModScormProvider.prototype.getScormFolder=function(e,t){return t=t||this.sitesProvider.getCurrentSiteId(),this.filepoolProvider.getPackageDirPathByUrl(t,e)},AddonModScormProvider.prototype.getScormFileList=function(e){var t=[];return this.isScormUnsupported(e)||e.warningMessage||t.push({fileurl:this.getPackageUrl(e),filepath:"/",filename:e.reference,filesize:e.packagesize,type:"file",timemodified:0}),t},AddonModScormProvider.prototype.getScoStatusIcon=function(e,t){var n,o="",r="";return"sco"==e.scormtype?(this.VALID_STATUSES.indexOf(n=e.status)<0&&(n="notattempted"),t||(t=this.isStatusIncomplete(n)),t&&"suspend"==e.exitvalue?(o="suspend",r="suspended"):(o=e.status,r=e.status)):(o="asset",r=e.status&&"notattempted"!=e.status?"assetlaunched":"asset"),{url:"assets/img/scorm/"+o+".gif",description:this.translate.instant("addon.mod_scorm."+r)}},AddonModScormProvider.prototype.getScormDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"scorm:"+e},AddonModScormProvider.prototype.getScormByField=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={courseids:[e]},c={cacheKey:s.getScormDataCacheKey(e)};return r&&(c.omitExpires=!0),i.read("mod_scorm_get_scorms_by_courses",a,c).then(function(e){if(e&&e.scorms){var r=e.scorms.find(function(e){return e[t]==n});if(r){if(void 0===r.timeopen)for(var i in e.warnings){var s=e.warnings[i];if(s.itemid===r.id){r.warningMessage=s.message;break}}return r.moduleurl=o,r}}return Promise.reject(null)})})},AddonModScormProvider.prototype.getScorm=function(e,t,n,o,r){return this.getScormByField(e,"coursemodule",t,n,o,r)},AddonModScormProvider.prototype.getScormById=function(e,t,n,o,r){return this.getScormByField(e,"id",t,n,o,r)},AddonModScormProvider.prototype.getScormGradeMethod=function(e){if(1==e.maxattempt)switch(parseInt(e.grademethod,10)){case AddonModScormProvider_1.GRADEHIGHEST:return this.translate.instant("addon.mod_scorm.gradehighest");case AddonModScormProvider_1.GRADEAVERAGE:return this.translate.instant("addon.mod_scorm.gradeaverage");case AddonModScormProvider_1.GRADESUM:return this.translate.instant("addon.mod_scorm.gradesum");case AddonModScormProvider_1.GRADESCOES:return this.translate.instant("addon.mod_scorm.gradescoes");default:return""}else switch(parseInt(e.whatgrade,10)){case AddonModScormProvider_1.HIGHESTATTEMPT:return this.translate.instant("addon.mod_scorm.highestattempt");case AddonModScormProvider_1.AVERAGEATTEMPT:return this.translate.instant("addon.mod_scorm.averageattempt");case AddonModScormProvider_1.FIRSTATTEMPT:return this.translate.instant("addon.mod_scorm.firstattempt");case AddonModScormProvider_1.LASTATTEMPT:return this.translate.instant("addon.mod_scorm.lastattempt");default:return""}},AddonModScormProvider.prototype.invalidateAllScormData=function(e,t,n){var o=[];return o.push(this.invalidateAttemptCount(e,t,n)),o.push(this.invalidateScos(e,t)),o.push(this.invalidateScormUserData(e,t)),Promise.all(o)},AddonModScormProvider.prototype.invalidateAttemptCount=function(e,t,n){var o=this;return this.sitesProvider.getSite(t).then(function(t){return n=n||t.getUserId(),t.invalidateWsCacheForKey(o.getAttemptCountCacheKey(e,n))})},AddonModScormProvider.prototype.invalidateContent=function(e,t,n,o){var r=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getScorm(t,e,void 0,!1,n).then(function(t){var i=[];return i.push(r.invalidateAllScormData(t.id,n,o)),i.push(r.filepoolProvider.invalidateFilesByComponent(n,AddonModScormProvider_1.COMPONENT,e,!0)),Promise.all(i)})},AddonModScormProvider.prototype.invalidateScormData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getScormDataCacheKey(e))})},AddonModScormProvider.prototype.invalidateScormUserData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getScormUserDataCommonCacheKey(e))})},AddonModScormProvider.prototype.invalidateScos=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getScosCacheKey(e))})},AddonModScormProvider.prototype.isAttemptIncomplete=function(e,t,n,o,r){var i=this;return this.getScosWithData(e,t,void 0,n,o,r).then(function(e){for(var t in e){var n=e[t];if(n.isvisible&&n.launch&&i.isStatusIncomplete(n.status))return!0}return!1})},AddonModScormProvider.prototype.isExternalLink=function(e){return!!(e=e.toLowerCase()).match(/https?:\/\//)||"www."==e.substr(0,4)},AddonModScormProvider.prototype.isScormClosed=function(e){var t=this.timeUtils.timestamp();return e.timeclose>0&&t>e.timeclose},AddonModScormProvider.prototype.isScormDownloadable=function(e){return void 0!==e.protectpackagedownloads&&!1===e.protectpackagedownloads},AddonModScormProvider.prototype.isScormOpen=function(e){var t=this.timeUtils.timestamp();return!(e.timeopen>0&&e.timeopen>t)},AddonModScormProvider.prototype.isScormUnsupported=function(e){return this.isScormValidVersion(e)?this.isScormDownloadable(e)?this.isValidPackageUrl(this.getPackageUrl(e))?void 0:"addon.mod_scorm.errorpackagefile":"addon.mod_scorm.errornotdownloadable":"addon.mod_scorm.errorinvalidversion"},AddonModScormProvider.prototype.isScormValidVersion=function(e){return"SCORM_1.2"==e.version},AddonModScormProvider.prototype.isStatusIncomplete=function(e){return!e||"notattempted"==e||"incomplete"==e||"browsed"==e},AddonModScormProvider.prototype.isValidPackageUrl=function(e){return!!e&&!(e.indexOf("imsmanifest.xml")>-1)},AddonModScormProvider.prototype.logLaunchSco=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_scorm_launch_sco",{scormid:e,scoid:t}).then(function(e){if(!e||!e.status)return Promise.reject(null)})})},AddonModScormProvider.prototype.logView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_scorm_view_scorm",{scormid:e}).then(function(e){if(!e||!e.status)return Promise.reject(null)})})},AddonModScormProvider.prototype.saveTracks=function(e,t,n,o,r,i,s){var a=this;if(s=s||this.sitesProvider.getCurrentSiteId(),r){return(i?Promise.resolve(i):this.getScormUserData(o.id,t,void 0,r,!1,s)).then(function(r){return a.scormOfflineProvider.saveTracks(o,e,t,n,r,s)})}return this.saveTracksOnline(o.id,e,t,n,s).then(function(){a.updateUserDataAfterSave(o.id,t,n,s)})},AddonModScormProvider.prototype.saveTracksOnline=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){if(!o||!o.length)return Promise.resolve();var s={scoid:t,attempt:n,tracks:o};return i.syncProvider.blockOperation(AddonModScormProvider_1.COMPONENT,e,"saveTracksOnline",r.id),r.write("mod_scorm_insert_scorm_tracks",s).then(function(e){return e&&e.trackids?e.trackids:Promise.reject(null)}).finally(function(){i.syncProvider.unblockOperation(AddonModScormProvider_1.COMPONENT,e,"saveTracksOnline",r.id)})})},AddonModScormProvider.prototype.saveTracksSync=function(e,t,n,o,r,i){if(r)return this.scormOfflineProvider.saveTracksSync(o,e,t,n,i);var s=this.saveTracksSyncOnline(e,t,n);return s&&this.updateUserDataAfterSave(o.id,t,n),s},AddonModScormProvider.prototype.saveTracksSyncOnline=function(e,t,n){var o,r={scoid:e,attempt:t,tracks:n},i=this.sitesProvider.getCurrentSite(),s={siteUrl:i.getURL(),wsToken:i.getToken()},a="mod_scorm_insert_scorm_tracks";if(!n||!n.length)return!0;if(!i.wsAvailable(a,!1)){if(!i.wsAvailable(__WEBPACK_IMPORTED_MODULE_11__core_constants__.a.WS_PREFIX+a,!1))return this.logger.error('WS function "'+a+'" is not available, even in compatibility mode.'),!1;a=__WEBPACK_IMPORTED_MODULE_11__core_constants__.a.WS_PREFIX+a}return!(!(o=this.wsProvider.syncCall(a,r,s))||o.error||!o.trackids)},AddonModScormProvider.prototype.shouldDownloadMainFile=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId();var o=AddonModScormProvider_1.COMPONENT;return void 0===t?this.filepoolProvider.getPackageData(n,o,e.coursemodule).then(function(t){return!(t.status==__WEBPACK_IMPORTED_MODULE_11__core_constants__.a.OUTDATED||t.status==__WEBPACK_IMPORTED_MODULE_11__core_constants__.a.DOWNLOADING&&t.previous==__WEBPACK_IMPORTED_MODULE_11__core_constants__.a.OUTDATED)||t.extra!=e.sha1hash}).catch(function(){return!0}):t?this.filepoolProvider.getPackageExtra(n,o,e.coursemodule).then(function(t){return e.sha1hash!=t}).catch(function(){return!0}):Promise.resolve(!0)},AddonModScormProvider.prototype.updateUserDataAfterSave=function(e,t,n,o){if(!n||!n.length)return Promise.resolve();for(var r=!1,i=0,s=n.length;i<s;i++){var a=n[i];if(a.element&&a.element.indexOf(".")>-1){r=!0;break}}return r?this.getScormUserDataOnline(e,t,!0,o):Promise.resolve()},AddonModScormProvider.COMPONENT="mmaModScorm",AddonModScormProvider.GRADESCOES=0,AddonModScormProvider.GRADEHIGHEST=1,AddonModScormProvider.GRADEAVERAGE=2,AddonModScormProvider.GRADESUM=3,AddonModScormProvider.HIGHESTATTEMPT=0,AddonModScormProvider.AVERAGEATTEMPT=1,AddonModScormProvider.FIRSTATTEMPT=2,AddonModScormProvider.LASTATTEMPT=3,AddonModScormProvider.MODEBROWSE="browse",AddonModScormProvider.MODENORMAL="normal",AddonModScormProvider.MODEREVIEW="review",AddonModScormProvider.LAUNCH_NEXT_SCO_EVENT="addon_mod_scorm_launch_next_sco",AddonModScormProvider.LAUNCH_PREV_SCO_EVENT="addon_mod_scorm_launch_prev_sco",AddonModScormProvider.UPDATE_TOC_EVENT="addon_mod_scorm_update_toc",AddonModScormProvider.GO_OFFLINE_EVENT="addon_mod_scorm_go_offline",AddonModScormProvider=AddonModScormProvider_1=__decorate([Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__.A)(),__metadata("design:paramtypes",[__WEBPACK_IMPORTED_MODULE_3__providers_logger__.a,__WEBPACK_IMPORTED_MODULE_1__ngx_translate_core__.c,__WEBPACK_IMPORTED_MODULE_4__providers_sites__.a,__WEBPACK_IMPORTED_MODULE_6__providers_ws__.a,__WEBPACK_IMPORTED_MODULE_7__providers_utils_text__.a,__WEBPACK_IMPORTED_MODULE_9__providers_utils_utils__.a,__WEBPACK_IMPORTED_MODULE_2__providers_filepool__.a,__WEBPACK_IMPORTED_MODULE_10__scorm_offline__.a,__WEBPACK_IMPORTED_MODULE_8__providers_utils_time__.a,__WEBPACK_IMPORTED_MODULE_5__providers_sync__.a])],AddonModScormProvider);var AddonModScormProvider_1}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(2),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.sitesProvider=e,this.ROOT_CACHE_KEY="mmComments:"}return e.prototype.getCommentsCacheKey=function(e,t,n,o,r,i){return void 0===r&&(r=""),void 0===i&&(i=0),this.getCommentsPrefixCacheKey(e,t)+":"+n+":"+o+":"+r+":"+i},e.prototype.getCommentsPrefixCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"comments:"+e+":"+t},e.prototype.getComments=function(e,t,n,o,r,i,s){var a=this;return void 0===r&&(r=""),void 0===i&&(i=0),this.sitesProvider.getSite(s).then(function(s){var c={contextlevel:e,instanceid:t,component:n,itemid:o,area:r,page:i},u={cacheKey:a.getCommentsCacheKey(e,t,n,o,r,i)};return s.read("core_comment_get_comments",c,u).then(function(e){return e.comments?e.comments:Promise.reject(null)})})},e.prototype.invalidateCommentsData=function(e,t,n,o,r,i,s){var a=this;return void 0===r&&(r=""),void 0===i&&(i=0),this.sitesProvider.getSite(s).then(function(s){return s.invalidateWsCacheForKey(a.getCommentsCacheKey(e,t,n,o,r,i))})},e.prototype.invalidateCommentsByInstance=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKeyStartingWith(o.getCommentsPrefixCacheKey(e,t))})},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(8),s=n(11),a=n(21),c=n(35),u=n(950),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e){this.fetchContentDefaultError="core.course.errorgetmodule",this.textUtils=e.get(s.a),this.courseHelper=e.get(a.a),this.translate=e.get(r.c),this.domUtils=e.get(i.a),this.moduleDelegate=e.get(c.a),this.courseSectionPage=e.get(u.a,null),this.dataRetrieved=new o.v}return e.prototype.ngOnInit=function(){this.description=this.module.description,this.componentId=this.module.id,this.externalUrl=this.module.url,this.loaded=!1,this.refreshIcon="spinner"},e.prototype.doRefresh=function(e,t,n){var o=this;if(void 0===n&&(n=!1),this.loaded){return(this.courseSectionPage&&!this.moduleDelegate.displayRefresherInSingleActivity(this.module.modname)?this.courseSectionPage.doRefresh():Promise.resolve()).finally(function(){return o.refreshContent(!0,n).finally(function(){e&&e.complete(),t&&t()})})}return Promise.resolve()},e.prototype.refreshContent=function(e,t){var n=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),this.refreshIcon="spinner",this.invalidateContent().catch(function(){}).then(function(){return n.loadContent(!0)}).finally(function(){n.refreshIcon="refresh"})},e.prototype.invalidateContent=function(){return Promise.resolve()},e.prototype.fetchContent=function(e){return Promise.resolve()},e.prototype.loadContent=function(e){var t=this;return this.fetchContent(e).catch(function(e){t.domUtils.showErrorModalDefault(e,t.fetchContentDefaultError,!0)}).finally(function(){t.loaded=!0,t.refreshIcon="refresh"})},e.prototype.fillContextMenu=function(e){void 0===e&&(e=!1),this.courseHelper.fillContextMenu(this,this.module,this.courseId,e,this.component)},e.prototype.expandDescription=function(){this.textUtils.expandText(this.translate.instant("core.description"),this.description,this.component,this.module.id)},e.prototype.prefetch=function(){this.courseHelper.contextMenuPrefetch(this,this.module,this.courseId)},e.prototype.removeFiles=function(){this.courseHelper.confirmAndRemoveFiles(this.module,this.courseId)},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.statusObserver&&this.statusObserver.off()},e.prototype.ionViewDidEnter=function(){this.isCurrentView=!0},e.prototype.ionViewDidLeave=function(){this.isCurrentView=!1},d([Object(o.D)(),l("design:type",Object)],e.prototype,"module",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"courseId",void 0),d([Object(o.O)(),l("design:type",o.v)],e.prototype,"dataRetrieved",void 0),e}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e){this.sitePluginsProvider=e,this.content=""}return e.prototype.componentCreated=function(e){e&&this.handlerSchema&&this.handlerSchema.methodJSResult&&this.handlerSchema.methodJSResult.componentInit&&this.handlerSchema.methodJSResult.componentInit.apply(e)},e.prototype.getHandlerData=function(e){var t=this.sitePluginsProvider.getSitePluginHandler(e);this.handlerSchema=t&&t.handlerSchema,this.handlerSchema&&this.handlerSchema.methodTemplates&&this.handlerSchema.methodTemplates.length&&(this.content=t.handlerSchema.methodTemplates[0].html)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(96),s=(n.n(i),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.observables={},this.counterHandlers={},this.logger=e.getInstance("AddonPushNotificationsDelegate"),this.observables.click=new i.Subject,this.observables.receive=new i.Subject}return e.prototype.clicked=function(e){this.observables.click.next(e)},e.prototype.received=function(e){this.observables.receive.next(e)},e.prototype.on=function(e){if(void 0===this.observables[e]){var t=Object.keys(this.observables).join(", ");return this.logger.warn("'"+e+"' event name is not allowed. Use one of the following: '"+t+"'."),new i.Subject}return this.observables[e]},e.prototype.registerCounterHandler=function(e){void 0===this.counterHandlers[e]?(this.logger.debug("Registered handler '"+e+"' as badge counter handler."),this.counterHandlers[e]=e):this.logger.log("Handler '"+e+"' as badge counter handler already registered.")},e.prototype.isCounterHandlerRegistered=function(e){return void 0!==this.counterHandlers[e]},e.prototype.getCounterHandlers=function(){return this.counterHandlers},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(27),i=n(2),s=n(11),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,n,o){this.fileProvider=e,this.sitesProvider=n,this.textUtils=o,this.tablesSchema=[{name:t.DISCUSSIONS_TABLE,columns:[{name:"forumid",type:"INTEGER"},{name:"name",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"subject",type:"TEXT"},{name:"message",type:"TEXT"},{name:"options",type:"TEXT"},{name:"groupid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"timecreated",type:"INTEGER"}],primaryKeys:["forumid","userid","timecreated"]},{name:t.REPLIES_TABLE,columns:[{name:"postid",type:"INTEGER"},{name:"discussionid",type:"INTEGER"},{name:"forumid",type:"INTEGER"},{name:"name",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"subject",type:"TEXT"},{name:"message",type:"TEXT"},{name:"options",type:"TEXT"},{name:"userid",type:"INTEGER"},{name:"timecreated",type:"INTEGER"}],primaryKeys:["postid","userid"]}],this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteNewDiscussion=function(e,n,o,r){return this.sitesProvider.getSite(o).then(function(o){var i={forumid:e,userid:r||o.getUserId(),timecreated:n};return o.getDb().deleteRecords(t.DISCUSSIONS_TABLE,i)})},e.prototype.getNewDiscussion=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){var s={forumid:e,userid:r||o.getUserId(),timecreated:n};return o.getDb().getRecord(t.DISCUSSIONS_TABLE,s).then(function(e){return e.options=i.textUtils.parseJSON(e.options),e})})},e.prototype.getAllNewDiscussions=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.DISCUSSIONS_TABLE).then(n.parseRecordOptions.bind(n))})},e.prototype.hasNewDiscussions=function(e,t,n){return this.getNewDiscussions(e,t,n).then(function(e){return!!e.length}).catch(function(){return!1})},e.prototype.getNewDiscussions=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){var i={forumid:e,userid:o||n.getUserId()};return n.getDb().getRecords(t.DISCUSSIONS_TABLE,i).then(r.parseRecordOptions.bind(r))})},e.prototype.addNewDiscussion=function(e,n,o,r,i,s,a,c,u,d){return this.sitesProvider.getSite(u).then(function(u){var l={forumid:e,name:n,courseid:o,subject:r,message:i,options:JSON.stringify(s||{}),groupid:a||-1,userid:d||u.getUserId(),timecreated:c||(new Date).getTime()};return u.getDb().insertRecord(t.DISCUSSIONS_TABLE,l)})},e.prototype.deleteReply=function(e,n,o){return this.sitesProvider.getSite(n).then(function(n){var r={postid:e,userid:o||n.getUserId()};return n.getDb().deleteRecords(t.REPLIES_TABLE,r)})},e.prototype.getAllReplies=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.REPLIES_TABLE).then(n.parseRecordOptions.bind(n))})},e.prototype.hasForumReplies=function(e,t,n){return this.getForumReplies(e,t,n).then(function(e){return!!e.length}).catch(function(){return!1})},e.prototype.getForumReplies=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){var i={forumid:e,userid:o||n.getUserId()};return n.getDb().getRecords(t.REPLIES_TABLE,i).then(r.parseRecordOptions.bind(r))})},e.prototype.hasDiscussionReplies=function(e,t,n){return this.getDiscussionReplies(e,t,n).then(function(e){return!!e.length}).catch(function(){return!1})},e.prototype.getDiscussionReplies=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){var i={discussionid:e,userid:o||n.getUserId()};return n.getDb().getRecords(t.REPLIES_TABLE,i).then(r.parseRecordOptions.bind(r))})},e.prototype.replyPost=function(e,n,o,r,i,s,a,c,u,d){return this.sitesProvider.getSite(u).then(function(u){var l={postid:e,discussionid:n,forumid:o,name:r,courseid:i,subject:s,message:a,options:JSON.stringify(c||{}),userid:d||u.getUserId(),timecreated:(new Date).getTime()};return u.getDb().insertRecord(t.REPLIES_TABLE,l)})},e.prototype.getForumFolder=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o=n.fileProvider.getSiteFolder(t.getId());return n.textUtils.concatenatePaths(o,"offlineforum/"+e)})},e.prototype.getNewDiscussionFolder=function(e,t,n){var o=this;return this.getForumFolder(e,n).then(function(e){return o.textUtils.concatenatePaths(e,"newdisc_"+t)})},e.prototype.getReplyFolder=function(e,t,n,o){var r=this;return this.getForumFolder(e,n).then(function(e){return r.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),r.textUtils.concatenatePaths(e,"reply_"+t+"_"+o)})})},e.prototype.parseRecordOptions=function(e){var t=this;return e.forEach(function(e){e.options=t.textUtils.parseJSON(e.options)}),e},e.DISCUSSIONS_TABLE="addon_mod_forum_discussions",e.REPLIES_TABLE="addon_mod_forum_replies",e=t=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(11),a=n(27),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,n,o,r){this.sitesProvider=n,this.textUtils=o,this.fileProvider=r,this.tablesSchema=[{name:t.DATA_ENTRY_TABLE,columns:[{name:"dataid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"groupid",type:"INTEGER"},{name:"action",type:"TEXT"},{name:"entryid",type:"INTEGER"},{name:"fields",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["dataid","entryid"]}],this.logger=e.getInstance("AddonModDataOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteAllEntryActions=function(e,t,n){var o=this;return this.getEntryActions(e,t,n).then(function(r){var i=[];return r.forEach(function(r){i.push(o.deleteEntry(e,t,r.action,n))}),Promise.all(i)})},e.prototype.deleteEntry=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){return r.getDb().deleteRecords(t.DATA_ENTRY_TABLE,{dataid:e,entryid:n,action:o})})},e.prototype.getAllEntries=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.DATA_ENTRY_TABLE)}).then(function(e){return e.map(n.parseRecord.bind(n))})},e.prototype.getDatabaseEntries=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.DATA_ENTRY_TABLE,{dataid:e})}).then(function(e){return e.map(o.parseRecord.bind(o))})},e.prototype.getEntry=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.getDb().getRecord(t.DATA_ENTRY_TABLE,{dataid:e,entryid:n,action:o})}).then(function(e){return i.parseRecord(e)})},e.prototype.getEntryActions=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().getRecords(t.DATA_ENTRY_TABLE,{dataid:e,entryid:n})}).then(function(e){return e.map(r.parseRecord.bind(r))})},e.prototype.hasOfflineData=function(e,t){return this.getDatabaseEntries(e,t).then(function(e){return!!e.length}).catch(function(){return!1})},e.prototype.getDatabaseFolder=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o=n.fileProvider.getSiteFolder(t.getId());return n.textUtils.concatenatePaths(o,"offlinedatabase/"+e)})},e.prototype.getEntryFieldFolder=function(e,t,n,o){var r=this;return this.getDatabaseFolder(e,o).then(function(e){return r.textUtils.concatenatePaths(e,t+"_"+n)})},e.prototype.parseRecord=function(e){return e.fields=this.textUtils.parseJSON(e.fields),e},e.prototype.saveEntry=function(e,n,o,r,i,s,a,c){return this.sitesProvider.getSite(c).then(function(c){a=a||(new Date).getTime();var u={dataid:e,courseid:r,groupid:i,action:o,entryid:n=void 0===n||null===n?-a:n,fields:JSON.stringify(s||[]),timemodified:a};return c.getDb().insertRecord(t.DATA_ENTRY_TABLE,u)})},e.DATA_ENTRY_TABLE="addon_mod_data_entry",e=t=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1),i=n(12),s=n(7),a=n(2),c=n(6),u=n(9),d=n(18),l=n(201),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,s,a,c){var u=this;this.sitesProvider=t,this.appProvider=n,this.filepoolProvider=o,this.utils=r,this.translate=s,this.wikiOffline=a,this.ROOT_CACHE_KEY="mmaModWiki:",this.subwikiListsCache={},this.logger=e.getInstance("AddonModWikiProvider"),c.on(i.a.LOGIN,function(){u.clearSubwikiList()})}return t=e,e.prototype.clearSubwikiList=function(e){void 0===e?this.subwikiListsCache={}:delete this.subwikiListsCache[e]},e.prototype.editPage=function(e,t,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={pageid:e,content:t};return n&&(r.section=n),o.write("mod_wiki_edit_page",r).then(function(e){return e.pageid||Promise.reject(null)})})},e.prototype.getPageContents=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={pageid:e},s={cacheKey:r.getPageContentsCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_wiki_get_page_contents",i,s).then(function(e){return e.page||Promise.reject(null)})})},e.prototype.getPageContentsCacheKey=function(e){return this.ROOT_CACHE_KEY+"page:"+e},e.prototype.getPageForEditing=function(e,t,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={pageid:e};return t&&(r.section=t),n&&o.isVersionGreaterEqualThan("3.2")&&(r.lockonly=1),o.write("mod_wiki_get_page_for_editing",r).then(function(e){return e.pagesection||Promise.reject(null)})})},e.prototype.getSubwikiFiles=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={wikiid:e,groupid:t=t||-1,userid:n=n||0},c={cacheKey:s.getSubwikiFilesCacheKey(e,t,n)};return o?c.omitExpires=!0:r&&(c.getFromCache=!1,c.emergencyCache=!1),i.read("mod_wiki_get_subwiki_files",a,c).then(function(e){return e.files||Promise.reject(null)})})},e.prototype.getSubwikiFilesCacheKey=function(e,t,n){return this.getSubwikiFilesCacheKeyPrefix(e)+":"+t+":"+n},e.prototype.getSubwikiFilesCacheKeyPrefix=function(e){return this.ROOT_CACHE_KEY+"subwikifiles:"+e},e.prototype.getSubwikiList=function(e){return this.subwikiListsCache[e]},e.prototype.getSubwikiPages=function(e,t,n,o,r,i,s,a,c){var u=this;return void 0===o&&(o="title"),void 0===r&&(r="ASC"),this.sitesProvider.getSite(c).then(function(c){var d={wikiid:e,groupid:t=t||-1,userid:n=n||0,options:{sortby:o=o||"title",sortdirection:r=r||"ASC",includecontent:(i=i||!1)?1:0}},l={cacheKey:u.getSubwikiPagesCacheKey(e,t,n)};return s?l.omitExpires=!0:a&&(l.getFromCache=!1,l.emergencyCache=!1),c.read("mod_wiki_get_subwiki_pages",d,l).then(function(e){return e.pages||Promise.reject(null)})})},e.prototype.getSubwikiPagesCacheKey=function(e,t,n){return this.getSubwikiPagesCacheKeyPrefix(e)+":"+t+":"+n},e.prototype.getSubwikiPagesCacheKeyPrefix=function(e){return this.ROOT_CACHE_KEY+"subwikipages:"+e},e.prototype.getSubwikis=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={wikiid:e},s={cacheKey:r.getSubwikisCacheKey(e)};return t?s.omitExpires=!0:n&&(s.getFromCache=!1,s.emergencyCache=!1),o.read("mod_wiki_get_subwikis",i,s).then(function(e){return e.subwikis||Promise.reject(null)})})},e.prototype.getSubwikisCacheKey=function(e){return this.ROOT_CACHE_KEY+"subwikis:"+e},e.prototype.getWiki=function(e,t,n,o){return this.getWikiByField(e,"coursemodule",t,n,o)},e.prototype.getWikiByField=function(e,t,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(o){var r={courseids:[e]},s={cacheKey:i.getWikiDataCacheKey(e)};return o.read("mod_wiki_get_wikis_by_courses",r,s).then(function(e){if(e.wikis){var o=e.wikis.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getWikiById=function(e,t,n,o){return this.getWikiByField(e,"id",t,n,o)},e.prototype.getWikiDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"wiki:"+e},e.prototype.getWikiFileList=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=[];return this.getSubwikis(e.id,t,n,o).then(function(e){var s=[];return e.forEach(function(e){s.push(r.getSubwikiFiles(e.wikiid,e.groupid,e.userid,t,n,o).then(function(e){i=i.concat(e)}))}),Promise.all(s).then(function(){return i})})},e.prototype.getWikiPageList=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=[];return this.getSubwikis(e.id,t,n,o).then(function(e){var s=[];return e.forEach(function(e){s.push(r.getSubwikiPages(e.wikiid,e.groupid,e.userid,void 0,void 0,void 0,t,n,o).then(function(e){i=i.concat(e)}))}),Promise.all(s).then(function(){return i})})},e.prototype.invalidateContent=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getWiki(t,e,!1,n).then(function(e){var r=[];return r.push(o.invalidateWikiData(t,n)),r.push(o.invalidateSubwikis(e.id,n)),r.push(o.invalidateSubwikiPages(e.id,n)),r.push(o.invalidateSubwikiFiles(e.id,n)),Promise.all(r)})},e.prototype.invalidateFiles=function(e,n){return this.filepoolProvider.invalidateFilesByComponent(n,t.COMPONENT,e)},e.prototype.invalidatePage=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getPageContentsCacheKey(e))})},e.prototype.invalidateSubwikiFiles=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getSubwikiFilesCacheKeyPrefix(e))})},e.prototype.invalidateSubwikiPages=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKeyStartingWith(n.getSubwikiPagesCacheKeyPrefix(e))})},e.prototype.invalidateSubwikis=function(e,t){var n=this;return this.clearSubwikiList(e),this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getSubwikisCacheKey(e))})},e.prototype.invalidateWikiData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getWikiDataCacheKey(e))})},e.prototype.isTitleUsed=function(e,t,n,o,r,i){var s=this;return this.getSubwikis(e,o,r,i).then(function(e){return e.find(function(e){return e.id==t})||Promise.reject(null)}).then(function(t){return s.getSubwikiPages(e,t.groupid,t.userid,void 0,void 0,!1,o,r,i)}).then(function(e){return!!e.find(function(e){return e.title==n})}).catch(function(){return!1})},e.prototype.logPageView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_wiki_view_page",{pageid:e})})},e.prototype.logView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("mod_wiki_view_wiki",{wikiid:e})})},e.prototype.newPage=function(e,t,n,o,r,i,s){var a=this;s=s||this.sitesProvider.getCurrentSiteId();var c=function(){return(o?a.isTitleUsed(o,n,e,!0,!1,s).catch(function(){return!1}).then(function(e){if(e)return Promise.reject(a.translate.instant("addon.mod_wiki.pageexists"))}):Promise.resolve()).then(function(){return a.wikiOffline.saveNewPage(e,t,n,o,r,i,s).then(function(){return-1})})};return this.appProvider.isOnline()?this.wikiOffline.deleteNewPage(e,n,o,r,i,s).then(function(){return a.newPageOnline(e,t,n,o,r,i,s).catch(function(e){return a.utils.isWebServiceError(e)?Promise.reject(e):c()})}):c()},e.prototype.newPageOnline=function(e,t,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){var c={title:e,content:t,contentformat:"html"};return n=a.wikiOffline.convertToPositiveNumber(n),o=a.wikiOffline.convertToPositiveNumber(o),n&&n>0?c.subwikiid=n:o&&(c.wikiid=o,c.userid=a.wikiOffline.convertToPositiveNumber(r),c.groupid=a.wikiOffline.convertToPositiveNumber(i)),s.write("mod_wiki_new_page",c).then(function(e){return e.pageid||Promise.reject(null)})})},e.prototype.setSubwikiList=function(e,t,n,o,r,i){this.subwikiListsCache[e]={count:n,subwikiSelected:o,userSelected:r,groupSelected:i,subwikis:t}},e.prototype.sortPagesByTitle=function(e,t){return e.sort(function(e,n){var o=e.title>=n.title?1:-1;return t&&(o=-o),o})},e.prototype.wikiHasSubwiki=function(e,t,n,o,r){return this.getSubwikis(e,n,o,r).then(function(e){return!!e.find(function(e){return e.id==t})}).catch(function(){return!1})},e.COMPONENT="mmaModWiki",e.PAGE_CREATED_EVENT="addon_mod_wiki_page_created",e.RENEW_LOCK_TIME=3e4,e=t=f([Object(o.A)(),p("design:paramtypes",[s.a,a.a,u.a,d.a,c.a,r.c,l.a,i.a])],e);var t}()},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(7),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.handlers={},this.logger=e.getInstance("CorePluginFileDelegate")}return e.prototype.getPluginHandler=function(e){if(void 0!==this.handlers[e])return this.handlers[e]},e.prototype.getComponentRevisionRegExp=function(e){var t=this.getPluginHandler(e[1]);if(t&&t.getComponentRevisionRegExp)return t.getComponentRevisionRegExp(e)},e.prototype.registerHandler=function(e){return void 0!==this.handlers[e.component]?(this.logger.log("Handler '"+e.component+"' already registered"),!1):(this.logger.log("Registered handler '"+e.component+"'"),this.handlers[e.component]=e,!0)},e.prototype.removeRevisionFromUrl=function(e,t){var n=this.getPluginHandler(t[1]);if(n&&n.getComponentRevisionRegExp&&n.getComponentRevisionReplace){var o=n.getComponentRevisionRegExp(t);if(o)return e.replace(o,n.getComponentRevisionReplace(t))}return e},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(7),s=n(8),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},d=function(){function e(e,t,n,o,r,i,s){this.factoryResolver=t,this.navCtrl=o,this.cdr=r,this.element=i,this.domUtils=s,this.logger=e.getInstance("CoreDynamicComponent"),this.differ=n.find([]).create()}return Object.defineProperty(e.prototype,"dynamicComponent",{set:function(e){this.container=e,this.createComponent()},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.createComponent()},e.prototype.ngOnChanges=function(e){!this.instance&&e.component&&this.createComponent()},e.prototype.ngDoCheck=function(){if(this.instance){var e=this.differ.diff(this.data);e&&(this.setInputData(),this.instance.ngOnChanges&&this.instance.ngOnChanges(this.domUtils.createChangesFromKeyValueDiff(e)))}},e.prototype.callComponentFunction=function(e,t){if(this.instance&&"function"==typeof this.instance[e])return this.instance[e].apply(this.instance,t)},e.prototype.createComponent=function(){if(!this.component||!this.container)return!1;if(this.instance)return!0;if(this.component instanceof o.p)this.container.insert(this.component.hostView),this.instance=this.component.instance,this.instance.ChangeDetectorRef=this.cdr,this.instance.NavController=this.navCtrl,this.instance.componentContainer=this.element.nativeElement;else try{var e=this.factoryResolver.resolveComponentFactory(this.component),t=this.container.createComponent(e);this.instance=t.instance}catch(e){return this.logger.error("Error creating component",e),!1}return this.setInputData(),!0},e.prototype.setInputData=function(){for(var e in this.data)this.instance[e]=this.data[e]},a([Object(o.D)(),c("design:type",Object)],e.prototype,"component",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"data",void 0),a([Object(o._9)("dynamicComponent",{read:o._11}),c("design:type",o._11),c("design:paramtypes",[o._11])],e.prototype,"dynamicComponent",null),e=a([Object(o.m)({selector:"core-dynamic-component",template:'\x3c!-- Content to display if no dynamic component. --\x3e\n<ng-content *ngIf="!instance"></ng-content>\n\n\x3c!-- Container of the dynamic component --\x3e\n<ng-container #dynamicComponent></ng-container>\n'}),u(3,Object(o.N)()),c("design:paramtypes",[i.a,o.o,o.F,r.q,o.j,o.t,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(10),a=n(117),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.courseProvider=n,this.forumProvider=o,this.logger=e.getInstance("CoreSiteHomeProvider")}return e.prototype.getNewsForum=function(e){return this.forumProvider.getCourseForums(e).then(function(e){for(var t=0;t<e.length;t++)if("news"==e[t].type)return e[t];return Promise.reject(null)})},e.prototype.isAvailable=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){if(t.isDisabledInSite(e))return!1;var n=e.getSiteHomeId();return t.logger.debug("Using WS call to check if site home is available."),t.courseProvider.getSections(n,!1,!0,{emergencyCache:!1},e.id).then(function(e){if(!e||!e.length)return Promise.reject(null);for(var t=0;t<e.length;t++){var n=e[t];if(n.summary||n.modules&&n.modules.length)return!0}return Promise.reject(null)}).catch(function(){var t=e.getStoredConfig();if(t&&t.frontpageloggedin){if(t.frontpageloggedin.split(",").length>0)return!0}return!1})}).catch(function(){return!1})},e.prototype.isDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isDisabledInSite(e)})},e.prototype.isDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_CoreSiteHome")},e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(740),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r(t,e),t.prototype.download=function(e,t,n){return this.downloadOrPrefetch(e,t,!1,n)},t.prototype.downloadOrPrefetch=function(e,t,n,o){var r=this;if(!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.networkerrormsg"));var i=this.sitesProvider.getCurrentSiteId();if(this.isDownloading(e.id,i))return this.getOngoingDownload(e.id,i);var s=this.loadContents(e,t,!0).then(function(){return r.getIntroFiles(e,t)}).then(function(t){var s=n?r.filepoolProvider.prefetchPackage.bind(r.filepoolProvider):r.filepoolProvider.downloadPackage.bind(r.filepoolProvider),a=r.getContentDownloadableFiles(e),c=[];if(o)c.push(r.filepoolProvider.downloadOrPrefetchFiles(i,t,n,!1,r.component,e.id)),c.push(s(i,a,r.component,e.id,void 0,o));else{var u=t.concat(a);c.push(s(i,u,r.component,e.id))}return Promise.all(c)});return this.addOngoingDownload(e.id,s,i)},t.prototype.getFiles=function(e,t,n){var o=this;return this.loadContents(e,t).then(function(){return o.getIntroFiles(e,t).then(function(t){return t.concat(o.getContentDownloadableFiles(e))})})},t.prototype.invalidateContent=function(e,t){var n=[],o=this.sitesProvider.getCurrentSiteId();return n.push(this.courseProvider.invalidateModule(e)),n.push(this.filepoolProvider.invalidateFilesByComponent(o,this.component,e)),Promise.all(n)},t.prototype.loadContents=function(e,t,n){return this.courseProvider.loadModuleContents(e,t,void 0,!1,n)},t.prototype.prefetch=function(e,t,n,o){return this.downloadOrPrefetch(e,t,!0,o)},t}(o.a)},,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=t,this.ROOT_CACHE_KEY="mmaCompetency:",this.logger=e.getInstance("AddonCompetencyProvider")}return t=e,e.prototype.getLearningPlansCacheKey=function(e){return this.ROOT_CACHE_KEY+"userplans:"+e},e.prototype.getLearningPlanCacheKey=function(e){return this.ROOT_CACHE_KEY+"learningplan:"+e},e.prototype.getCompetencyInPlanCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"plancompetency:"+e+":"+t},e.prototype.getCompetencyInCourseCacheKey=function(e,t,n){return this.ROOT_CACHE_KEY+"coursecompetency:"+n+":"+e+":"+t},e.prototype.getCompetencySummaryCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"competencysummary:"+t+":"+e},e.prototype.getCourseCompetenciesCacheKey=function(e){return this.ROOT_CACHE_KEY+"coursecompetencies:"+e},e.prototype.isPluginForCourseEnabled=function(e,t){return this.sitesProvider.isLoggedIn()?this.getCourseCompetencies(e,0,t).catch(function(){return!1}):Promise.resolve(!1)},e.prototype.getLearningPlans=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){e=e||t.getUserId(),n.logger.debug("Get plans for user "+e);var o={userid:e},r={cacheKey:n.getLearningPlansCacheKey(e)};return t.read("tool_lp_data_for_plans_page",o,r).then(function(e){return e.plans?e.plans:Promise.reject(null)})})},e.prototype.getLearningPlan=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){n.logger.debug("Get plan "+e);var o={planid:e},r={cacheKey:n.getLearningPlanCacheKey(e)};return t.read("tool_lp_data_for_plan_page",o,r).then(function(e){return e.plan?e:Promise.reject(null)})})},e.prototype.getCompetencyInPlan=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){o.logger.debug("Get competency "+t+" in plan "+e);var r={planid:e,competencyid:t},i={cacheKey:o.getCompetencyInPlanCacheKey(e,t)};return n.read("tool_lp_data_for_user_competency_summary_in_plan",r,i).then(function(e){return e.usercompetencysummary?e:Promise.reject(null)})})},e.prototype.getCompetencyInCourse=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){n=n||o.getUserId(),r.logger.debug("Get competency "+t+" in course "+e);var i={courseid:e,competencyid:t,userid:n},s={cacheKey:r.getCompetencyInCourseCacheKey(e,t,n)};return o.read("tool_lp_data_for_user_competency_summary_in_course",i,s).then(function(e){return e.usercompetencysummary?e:Promise.reject(null)})})},e.prototype.getCompetencySummary=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){t=t||n.getUserId(),o.logger.debug("Get competency "+e+" summary for user"+t);var r={competencyid:e,userid:t},i={cacheKey:o.getCompetencySummaryCacheKey(e,t)};return n.read("tool_lp_data_for_user_competency_summary",r,i).then(function(e){return e.competency?e.competency:Promise.reject(null)})})},e.prototype.getCourseCompetencies=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(t){o.logger.debug("Get course competencies for course "+e);var n={courseid:e},r={cacheKey:o.getCourseCompetenciesCacheKey(e)};return t.read("tool_lp_data_for_course_competencies_page",n,r).then(function(e){return e.competencies?e:Promise.reject(null)})}).then(function(r){if(!t||t==o.sitesProvider.getCurrentSiteUserId())return r;var i=r.competencies.map(function(r){return o.getCompetencyInCourse(e,r.competency.id,t,n)});return Promise.all(i).then(function(e){return e.forEach(function(e,t){r.competencies[t].usercompetencycourse=e.usercompetencysummary.usercompetencycourse}),r})})},e.prototype.invalidateLearningPlans=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return e=e||t.getUserId(),t.invalidateWsCacheForKey(n.getLearningPlansCacheKey(e))})},e.prototype.invalidateLearningPlan=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getLearningPlanCacheKey(e))})},e.prototype.invalidateCompetencyInPlan=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getCompetencyInPlanCacheKey(e,t))})},e.prototype.invalidateCompetencyInCourse=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return n=n||o.getUserId(),o.invalidateWsCacheForKey(r.getCompetencyInCourseCacheKey(e,t,n))})},e.prototype.invalidateCompetencySummary=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return t=t||n.getUserId(),n.invalidateWsCacheForKey(o.getCompetencySummaryCacheKey(e,t))})},e.prototype.invalidateCourseCompetencies=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(t){return t.invalidateWsCacheForKey(o.getCourseCompetenciesCacheKey(e))}).then(function(){if(t&&t!=o.sitesProvider.getCurrentSiteUserId())return o.getCourseCompetencies(e,0,n).then(function(r){var i=r.competencies.map(function(r){return o.invalidateCompetencyInCourse(e,r.competency.id,t,n)});return Promise.all(i)})})},e.prototype.logCompetencyInPlanView=function(e,n,o,r,i){return e&&n?this.sitesProvider.getSite(i).then(function(i){r=r||i.getUserId();var s={planid:e,competencyid:n,userid:r},a={typeExpected:"boolean"};return i.write(o==t.STATUS_COMPLETE?"core_competency_user_competency_plan_viewed":"core_competency_user_competency_viewed_in_plan",s,a)}):Promise.reject(null)},e.prototype.logCompetencyInCourseView=function(e,t,n,o){return e&&t?this.sitesProvider.getSite(o).then(function(o){n=n||o.getUserId();return o.write("core_competency_user_competency_viewed_in_course",{courseid:e,competencyid:t,userid:n},{typeExpected:"boolean"})}):Promise.reject(null)},e.prototype.logCompetencyView=function(e,t){return e?this.sitesProvider.getSite(t).then(function(t){return t.write("core_competency_competency_viewed",{id:e},{typeExpected:"boolean"})}):Promise.reject(null)},e.STATUS_DRAFT=0,e.STATUS_ACTIVE=1,e.STATUS_COMPLETE=2,e.STATUS_WAITIN_GFOR_REVIEW=3,e.STATUS_IN_REVIEW=4,e.REVIEW_STATUS_IDLE=0,e.REVIEW_STATUS_WAITING_FOR_REVIEW=1,e.REVIEW_STATUS_IN_REVIEW=2,e=t=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(27),i=n(2),s=n(6),a=n(11),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,n,o,r){this.fileProvider=e,this.sitesProvider=n,this.textUtils=o,this.utils=r,this.tablesSchema=[{name:t.ENTRIES_TABLE,columns:[{name:"glossaryid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"concept",type:"TEXT"},{name:"definition",type:"TEXT"},{name:"definitionformat",type:"TEXT"},{name:"userid",type:"INTEGER"},{name:"timecreated",type:"INTEGER"},{name:"options",type:"TEXT"},{name:"attachments",type:"TEXT"}],primaryKeys:["glossaryid","concept","timecreated"]}],this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteNewEntry=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){var i={glossaryid:e,concept:n,timecreated:o};return r.getDb().deleteRecords(t.ENTRIES_TABLE,i)})},e.prototype.getAllNewEntries=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.ENTRIES_TABLE).then(function(e){return e.map(n.parseRecord.bind(n))})})},e.prototype.getNewEntry=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){var s={glossaryid:e,concept:n,timecreated:o};return r.getDb().getRecord(t.ENTRIES_TABLE,s).then(i.parseRecord.bind(i))})},e.prototype.getGlossaryNewEntries=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){var i={glossaryid:e,userId:o||n.getUserId()};return n.getDb().getRecords(t.ENTRIES_TABLE,i).then(function(e){return e.map(r.parseRecord.bind(r))})})},e.prototype.isConceptUsed=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(s){var a={glossaryid:e,concept:n};return s.getDb().getRecords(t.ENTRIES_TABLE,a).then(function(t){return!!t.length&&(t.length>1||!o||i.utils.promiseFails(i.getNewEntry(e,n,o,r)))})}).catch(function(){return!1})},e.prototype.addNewEntry=function(e,n,o,r,i,s,a,c,u,d){var l=this;return this.sitesProvider.getSite(c).then(function(c){var f={glossaryid:e,courseid:r,concept:n,definition:o,definitionformat:"html",options:JSON.stringify(i),attachments:JSON.stringify(s),userid:u||c.getUserId(),timecreated:a||(new Date).getTime()};return(d?l.deleteNewEntry(e,d.concept,d.timecreated,c.getId()):Promise.resolve()).then(function(){return c.getDb().insertRecord(t.ENTRIES_TABLE,f).then(function(){return!1})})})},e.prototype.getGlossaryFolder=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o=n.fileProvider.getSiteFolder(t.getId());return n.textUtils.concatenatePaths(o,"offlineglossary/"+e)})},e.prototype.getEntryFolder=function(e,t,n,o){var r=this;return this.getGlossaryFolder(e,o).then(function(e){return r.textUtils.concatenatePaths(e,"newentry_"+t+"_"+n)})},e.prototype.parseRecord=function(e){return e.options=this.textUtils.parseJSON(e.options),e.attachments=this.textUtils.parseJSON(e.attachments),e},e.ENTRIES_TABLE="addon_mod_glossary_entrues",e=t=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,a.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(7),c=n(2),u=n(45),d=n(11),l=n(10),f=n(65),p=n(38),h=n(69),m=n(92),g=n(190),y=n(354),v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var h=e.call(this,"AddonModQuizSyncProvider",t,n,o,r,i,s)||this;return h.eventsProvider=c,h.quizProvider=u,h.quizOfflineProvider=d,h.prefetchHandler=l,h.questionProvider=f,h.questionDelegate=p,h.componentTranslate=a.translateModuleName("quiz"),h}return v(t,e),n=t,t.prototype.finishSync=function(e,t,n,o,r,i,s,a,c){var u=this;return this.quizProvider.invalidateAllQuizData(t.id,n,r,e).catch(function(){}).then(function(){if(a&&r)return u.quizOfflineProvider.removeAttemptAndAnswers(r,e)}).then(function(){if(c)return u.prefetchHandler.prefetchQuizAndLastAttempt(t,!1,e)}).then(function(){return u.setSyncTime(t.id,e).catch(function(){})}).then(function(){return!(!s||u.quizProvider.isAttemptFinished(s.state))&&u.quizProvider.getUserAttempts(t.id,"all",!0,!1,!1,e).then(function(e){for(var t in e){var n=e[t];if(n.id==s.id)return u.quizProvider.isAttemptFinished(n.state)}return!1})}).then(function(e){return{warnings:o,attemptFinished:e}})},t.prototype.hasDataToSync=function(e,t){return this.quizOfflineProvider.getQuizAttempts(e,t).then(function(e){return!!e.length}).catch(function(){return!1})},t.prototype.syncAllQuizzes=function(e){return this.syncOnSites("all quizzes",this.syncAllQuizzesFunc.bind(this),[],e)},t.prototype.syncAllQuizzesFunc=function(e){var t=this;return this.quizOfflineProvider.getAllAttempts(e).then(function(o){var r=[],i=[],s=[];return o.forEach(function(e){-1==i.indexOf(e.quizid)&&(i.push(e.quizid),r.push({id:e.quizid,courseid:e.courseid}))}),r.forEach(function(o){t.syncProvider.isBlocked(m.a.COMPONENT,o.id,e)||s.push(t.quizProvider.getQuizById(o.courseid,o.id,!1,e).then(function(o){return t.syncQuizIfNeeded(o,!1,e).then(function(n){return n&&n.warnings&&n.warnings.length?t.setSyncWarnings(o.id,n.warnings,e).then(function(){return n}):n}).then(function(r){void 0!==r&&t.eventsProvider.trigger(n.AUTO_SYNCED,{quizId:o.id,attemptFinished:r.attemptFinished,warnings:r.warnings},e)})}))}),Promise.all(s)})},t.prototype.syncQuizIfNeeded=function(e,t,n){var o=this;return this.isSyncNeeded(e.id,n).then(function(r){if(r)return o.syncQuiz(e,t,n)})},t.prototype.syncQuiz=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r,i,s=[],a=e.course;return this.isSyncing(e.id,n)?this.getOngoingSync(e.id,n):this.syncProvider.isBlocked(m.a.COMPONENT,e.id,n)?(this.logger.debug("Cannot sync quiz "+e.id+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}))):(this.logger.debug("Try to sync quiz "+e.id+" in site "+n),r=this.quizOfflineProvider.getQuizAttempts(e.id,n).then(function(r){if(!r.length)return o.finishSync(n,e,a,s);var c=r.pop();return o.quizProvider.getUserAttempts(e.id,"all",!0,!1,!0,n).then(function(r){var u,d=r.length?r[r.length-1].id:void 0;for(var l in r){var f=r[l];if(f.id==c.id){u=f;break}}return!u||o.quizProvider.isAttemptFinished(u.state)?(s.push(o.translate.instant("addon.mod_quiz.warningattemptfinished")),o.finishSync(n,e,a,s,d,c,u,!0)):o.quizOfflineProvider.getAttemptAnswers(c.id,n).then(function(r){if(!r.length)return o.finishSync(n,e,a,s,d,c,u,!0);var l,f=o.questionProvider.convertAnswersArrayToObject(r),p=o.quizOfflineProvider.classifyAnswersInQuestions(f);return o.quizProvider.getQuizAccessInformation(e.id,!1,!0,n).then(function(r){return o.prefetchHandler.getPreflightData(e,r,u,t,"core.settings.synchronization",n)}).then(function(t){i=t;var r=o.quizProvider.getPagesFromLayoutAndQuestions(u.layout,p);return o.quizProvider.getAllQuestionsData(e,u,i,r,!1,!0,n)}).then(function(e){return o.validateQuestions(u.id,e,p,n)}).then(function(t){var r=o.quizOfflineProvider.extractAnswersFromQuestions(p);return l=c.finished&&!t,t&&s.push(o.translate.instant(c.finished?"addon.mod_quiz.warningdatadiscardedfromfinished":"addon.mod_quiz.warningdatadiscarded")),o.quizProvider.processAttempt(e,u,r,i,l,!1,!1,n)}).then(function(){if(!l)return o.quizProvider.logViewAttempt(u.id,c.currentpage,i,!1).catch(function(){})}).then(function(){return o.finishSync(n,e,a,s,d,c,u,!0,!0)})})})}),this.addOngoingSync(e.id,r,n))},t.prototype.validateQuestions=function(e,t,n,o){var r=[],i=!1;for(var s in n){var a=n[s],c=t[s];c&&this.questionDelegate.validateSequenceCheck(c,a.answers[":sequencecheck"])?a.answers[":sequencecheck"]=c.sequencecheck:(i=!0,r.push(this.quizOfflineProvider.removeQuestionAndAnswers(e,Number(s),o)),delete n[s])}return Promise.all(r).then(function(){return i})},t.AUTO_SYNCED="addon_mod_quiz_autom_synced",t=n=b([Object(o.A)(),_("design:paramtypes",[a.a,c.a,i.a,u.a,d.a,r.c,l.a,s.a,m.a,g.a,y.a,f.a,p.a])],t);var n}(h.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(7),s=n(6),a=n(2),c=n(1),u=n(26),d=n(360),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.sitesProvider=t,this.appProvider=n,this.utils=o,this.translate=r,this.userProvider=i,this.notesOffline=s,this.ROOT_CACHE_KEY="mmaNotes:",this.logger=e.getInstance("AddonNotesProvider")}return e.prototype.addNote=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId();var s=function(){return i.notesOffline.saveNote(e,t,n,o,r).then(function(){return!1})};return this.appProvider.isOnline()?this.addNoteOnline(e,t,n,o,r).then(function(){return!0}).catch(function(e){return i.utils.isWebServiceError(e)?Promise.reject(e):s()}):s()},e.prototype.addNoteOnline=function(e,t,n,o,r){var i=this;return this.addNotesOnline([{courseid:t,format:1,publishstate:n,text:o,userid:e}],r).then(function(e){return e&&e[0]&&-1===e[0].noteid?Promise.reject(i.utils.createFakeWSError(e[0].errormessage)):i.invalidateNotes(t,r).catch(function(){})})},e.prototype.addNotesOnline=function(e,t){return e&&e.length?this.sitesProvider.getSite(t).then(function(t){return t.write("core_notes_create_notes",{notes:e})}):Promise.resolve()},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canUseAdvancedFeature("enablenotes")})},e.prototype.isPluginAddNoteEnabledForCourse=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return n.utils.promiseWorks(t.read("core_notes_create_notes",{notes:[{userid:-1,publishstate:"personal",courseid:e,text:"",format:1}]}))})},e.prototype.isPluginViewNotesEnabledForCourse=function(e,t){return this.utils.promiseWorks(this.getNotes(e,!1,!0,t))},e.prototype.getNotesCacheKey=function(e){return this.ROOT_CACHE_KEY+"notes:"+e},e.prototype.getNotes=function(e,t,n,o){var r=this;return this.logger.debug("Get notes for course "+e),this.sitesProvider.getSite(o).then(function(i){var s={courseid:e},a={cacheKey:r.getNotesCacheKey(e)};return t&&(a.getFromCache=!1,a.emergencyCache=!1),i.read("core_notes_get_course_notes",s,a).then(function(t){return n?t:r.notesOffline.getNotesForCourse(e,o).then(function(e){return e.forEach(function(e){var n=e.publishstate+"notes";t[n]||(t[n]=[]),e.offline=!0,t[n].unshift(e)}),t})})})},e.prototype.getNotesUserData=function(e,t){var n=this,o=e.map(function(e){return n.userProvider.getProfile(e.userid,e.courseid,!0).then(function(t){e.userfullname=t.fullname,e.userprofileimageurl=t.profileimageurl||null}).catch(function(){e.userfullname=n.translate.instant("addon.notes.userwithid",{id:e.userid})})});return Promise.all(o).then(function(){return e})},e.prototype.invalidateNotes=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getNotesCacheKey(e))})},e.prototype.logView=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.write("core_notes_view_notes",{courseid:e,userid:0})})},e=l([Object(o.A)(),f("design:paramtypes",[i.a,a.a,r.a,s.a,c.c,u.a,d.a])],e)}()},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(27),i=n(6),s=n(183),a=n(224),c=n(9),u=n(79),d=n(7),l=n(2),f=n(78),p=n(22),h=n(731),m=n(226),g=n(30),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(){function e(e,t,n,o,r,i,s,a,c,d){this.file=e,this.fileProvider=t,this.utils=n,this.sitesProvider=r,this.localNotif=i,this.captureHelper=s,this.timeUtils=a,this.appProvider=c,this.localNotifProvider=d,this.name="CoreEmulator",this.priority=u.a.MAX_RECOMMENDED_PRIORITY+500,this.blocking=!0,this.LAST_RECEIVED_NOTIFICATION_TABLE="core_emulator_last_received_notification",this.tablesSchema=[{name:this.LAST_RECEIVED_NOTIFICATION_TABLE,columns:[{name:"component",type:"TEXT"},{name:"id",type:"INTEGER"},{name:"timecreated",type:"INTEGER"}],primaryKeys:["component"]}],this.logger=o.getInstance("CoreEmulatorHelper"),r.createTablesFromSchema(this.tablesSchema)}return e.prototype.load=function(){var e=this,t=[];return t.push(this.file.load().then(function(t){e.fileProvider.setHTMLBasePath(t)})),t.push(this.localNotif.load()),t.push(this.captureHelper.load()),window.FileTransferError=h.a,this.utils.allPromises(t)},e.prototype.checkNewNotifications=function(e,t,n,o){var r=this;if(!this.appProvider.isDesktop()||!this.localNotifProvider.isAvailable())return Promise.resolve(null);if(!this.appProvider.isOnline())return this.logger.debug("Cannot check push notifications because device is offline."),Promise.reject(null);return(o?Promise.resolve([o]):this.sitesProvider.getSitesIds()).then(function(o){var i=o.map(function(o){return r.checkNewNotificationsForSite(e,t,n,o)});return Promise.all(i)})},e.prototype.checkNewNotificationsForSite=function(e,t,n,o){var r=this;return this.getLastReceivedNotification(e,o).then(function(i){return t(o).then(function(t){if(i&&t.length){var s=t[0];if(!(s.id==i.id||s.timecreated<=i.timecreated||r.timeUtils.timestamp()-s.timecreated>g.a.SECONDS_DAY))return n(s).then(function(t){var n={id:1,at:new Date,title:t.title,text:t.text,data:{notif:s,site:o}};return r.localNotifProvider.schedule(n,e,o)})}})})},e.prototype.getLastReceivedNotification=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.getDb().getRecord(n.LAST_RECEIVED_NOTIFICATION_TABLE,{component:e})}).catch(function(){return!1})},e.prototype.storeLastReceivedNotification=function(e,t,n){var o=this;return t||(t={id:-1,timecreated:0}),this.sitesProvider.getSite(n).then(function(n){var r={component:e,id:t.id,timecreated:t.timecreated};return n.getDb().insertRecord(o.LAST_RECEIVED_NOTIFICATION_TABLE,r)})},e=y([Object(o.A)(),v("design:paramtypes",[s.a,r.a,i.a,d.a,l.a,a.a,m.a,p.a,c.a,f.a])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(10),c=n(18),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r){this.sitesProvider=t,this.courseProvider=n,this.utils=o,this.filepoolProvider=r,this.ROOT_CACHE_KEY="mmaModPage:",this.logger=e.getInstance("AddonModPageProvider")}return t=e,e.prototype.getPageData=function(e,t,n){return this.getPageByKey(e,"coursemodule",t,n)},e.prototype.getPageByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getPageCacheKey(e)};return o.read("mod_page_get_pages_by_courses",i,s).then(function(e){if(e&&e.pages){var o=e.pages.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getPageCacheKey=function(e){return this.ROOT_CACHE_KEY+"page:"+e},e.prototype.invalidateContent=function(e,n,o){var r=[];return r.push(this.invalidatePageData(n,o)),r.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),r.push(this.courseProvider.invalidateModule(e,o)),this.utils.allPromises(r)},e.prototype.invalidatePageData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getPageCacheKey(e))})},e.prototype.isGetPageWSAvailable=function(){return this.sitesProvider.wsAvailableInCurrentSite("mod_page_get_pages_by_courses")},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canDownloadFiles()})},e.prototype.logView=function(e){var t={pageid:e};return this.sitesProvider.getCurrentSite().write("mod_page_view_page",t)},e.COMPONENT="mmaModPage",e=t=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,a.a,s.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1),i=n(7),s=n(2),a=n(22),c=n(6),u=n(65),d=n(70),l=n(92),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,n,o,r,i,s,a){this.sitesProvider=n,this.timeUtils=o,this.questionProvider=r,this.translate=i,this.utils=s,this.behaviourDelegate=a,this.tablesSchema=[{name:t.ATTEMPTS_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"attempt",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"quizid",type:"INTEGER"},{name:"currentpage",type:"INTEGER"},{name:"timecreated",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"finished",type:"INTEGER"}]}],this.logger=e.getInstance("AddonModQuizOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.classifyAnswersInQuestions=function(e){var t={};for(var n in e){var o=this.questionProvider.getQuestionSlotFromName(n),r=this.questionProvider.removeQuestionPrefix(n);t[o]||(t[o]={answers:{},prefix:n.substr(0,n.indexOf(r))}),t[o].answers[r]=e[n]}return t},e.prototype.extractAnswersFromQuestions=function(e){var t={};for(var n in e){var o=e[n];for(var r in o.answers)t[o.prefix+r]=o.answers[r]}return t},e.prototype.getAllAttempts=function(e){return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.ATTEMPTS_TABLE)})},e.prototype.getAttemptAnswers=function(e,t){return this.questionProvider.getAttemptAnswers(l.a.COMPONENT,e,t)},e.prototype.getAttemptById=function(e,n){return this.sitesProvider.getSiteDb(n).then(function(n){return n.getRecord(t.ATTEMPTS_TABLE,{id:e})})},e.prototype.getQuizAttempts=function(e,n,o){return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().getRecords(t.ATTEMPTS_TABLE,{quizid:e,userid:o})})},e.prototype.loadQuestionsLocalStates=function(e,t,n){var o=this,r=[];return t.forEach(function(t){r.push(o.questionProvider.getQuestion(l.a.COMPONENT,e,t.slot,n).then(function(e){var n=o.questionProvider.getState(e.state);t.state=e.state,t.status=o.translate.instant("core.question."+n.status)}).catch(function(){}))}),Promise.all(r).then(function(){return t})},e.prototype.processAttempt=function(e,n,o,r,i,s){var a=this;s=s||this.sitesProvider.getCurrentSiteId();var c,u=this.timeUtils.timestamp();return this.sitesProvider.getSiteDb(s).then(function(t){return c=t,a.getAttemptById(n.id,s).catch(function(){return{quizid:e.id,userid:n.userid,id:n.id,courseid:e.course,timecreated:u,attempt:n.attempt,currentpage:n.currentpage}})}).then(function(e){return e.timemodified=u,e.finished=i?1:0,c.insertRecord(t.ATTEMPTS_TABLE,e)}).then(function(){return a.saveAnswers(e,n,o,r,u,s)})},e.prototype.removeAttemptAndAnswers=function(e,n){n=n||this.sitesProvider.getCurrentSiteId();var o=[];return o.push(this.questionProvider.removeAttemptAnswers(l.a.COMPONENT,e,n)),o.push(this.questionProvider.removeAttemptQuestions(l.a.COMPONENT,e,n)),o.push(this.sitesProvider.getSiteDb(n).then(function(n){return n.deleteRecords(t.ATTEMPTS_TABLE,{id:e})})),Promise.all(o)},e.prototype.removeQuestionAndAnswers=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId();var o=[];return o.push(this.questionProvider.removeQuestion(l.a.COMPONENT,e,t,n)),o.push(this.questionProvider.removeQuestionAnswers(l.a.COMPONENT,e,t,n)),Promise.all(o)},e.prototype.saveAnswers=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteId(),r=r||this.timeUtils.timestamp();var a={},c={},u=[];for(var d in o){var f=this.questionProvider.getQuestionSlotFromName(d),p=this.questionProvider.removeQuestionPrefix(d);n[f]&&(a[f]||(a[f]=n[f],a[f].answers={}),a[f].answers[p]=o[d])}var h=function(n){var o=a[n];u.push(m.behaviourDelegate.determineNewState(e.preferredbehaviour,l.a.COMPONENT,t.id,o,i).then(function(e){e&&e.name!=o.state&&(c[o.slot]=e.name)}))},m=this;for(var f in a)h(f);return Promise.all(u).then(function(){return s.questionProvider.saveAnswers(l.a.COMPONENT,e.id,t.id,t.userid,o,r,i)}).then(function(){u=[];for(var n in c){u.push(s.questionProvider.saveQuestion(l.a.COMPONENT,e.id,t.id,t.userid,a[n],c[n],i))}return s.utils.allPromises(u).catch(function(e){s.logger.error("Error saving question state",e)})})},e.prototype.setAttemptCurrentPage=function(e,n,o){return this.sitesProvider.getSiteDb(o).then(function(o){return o.updateRecords(t.ATTEMPTS_TABLE,{currentpage:n},{id:e})})},e.ATTEMPTS_TABLE="addon_mod_quiz_attempts",e=t=f([Object(o.A)(),p("design:paramtypes",[i.a,s.a,a.a,u.a,r.c,c.a,d.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(10),c=n(18),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r){this.sitesProvider=t,this.courseProvider=n,this.filepoolProvider=o,this.utils=r,this.ROOT_CACHE_KEY="mmaModResource:",this.logger=e.getInstance("AddonModResourceProvider")}return t=e,e.prototype.getResourceCacheKey=function(e){return this.ROOT_CACHE_KEY+"resource:"+e},e.prototype.getResourceDataByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getResourceCacheKey(e)};return o.read("mod_resource_get_resources_by_courses",i,s).then(function(e){if(e&&e.resources){var o=e.resources.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getResourceData=function(e,t,n){return this.getResourceDataByKey(e,"coursemodule",t,n)},e.prototype.invalidateContent=function(e,n,o){o=o||this.sitesProvider.getCurrentSiteId();var r=[];return r.push(this.invalidateResourceData(n,o)),r.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),r.push(this.courseProvider.invalidateModule(e,o)),this.utils.allPromises(r)},e.prototype.invalidateResourceData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getResourceCacheKey(e))})},e.prototype.isGetResourceWSAvailable=function(){return this.sitesProvider.wsAvailableInCurrentSite("mod_resource_get_resources_by_courses")},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canDownloadFiles()})},e.prototype.logView=function(e){var t={resourceid:e};return this.sitesProvider.getCurrentSite().write("mod_resource_view_resource",t)},e.COMPONENT="mmaModResource",e=t=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,a.a,c.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(7),i=n(2),s=n(45),a=n(11),c=n(22),u=n(6),d=n(26),l=n(138),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,n,o,r,i,s,a){this.sitesProvider=n,this.timeUtils=o,this.syncProvider=r,this.utils=i,this.textUtils=s,this.userProvider=a,this.tablesSchema=[{name:t.ATTEMPTS_TABLE,columns:[{name:"scormid",type:"INTEGER",notNull:!0},{name:"attempt",type:"INTEGER",notNull:!0},{name:"userid",type:"INTEGER",notNull:!0},{name:"courseid",type:"INTEGER"},{name:"timecreated",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"snapshot",type:"TEXT"}],primaryKeys:["scormid","userid","attempt"]},{name:t.TRACKS_TABLE,columns:[{name:"scormid",type:"INTEGER",notNull:!0},{name:"attempt",type:"INTEGER",notNull:!0},{name:"userid",type:"INTEGER",notNull:!0},{name:"scoid",type:"INTEGER",notNull:!0},{name:"element",type:"TEXT",notNull:!0},{name:"value",type:"TEXT"},{name:"timemodified",type:"INTEGER"},{name:"synced",type:"INTEGER"}],primaryKeys:["scormid","userid","attempt","scoid","element"]}],this.logger=e.getInstance("AddonModScormOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.changeAttemptNumber=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(r).then(function(r){i=i||r.getUserId(),s.logger.debug("Change attempt number from "+n+" to "+o+" in SCORM "+e);var a=r.getDb(),c={scormid:e,userid:i,attempt:n},u={scormid:e,userid:i,attempt:o},d={attempt:o,timemodified:s.timeUtils.timestamp()};return s.syncProvider.blockOperation(l.a.COMPONENT,e,"changeAttemptNumber",r.id),a.updateRecords(t.ATTEMPTS_TABLE,d,c).then(function(){return d={attempt:o,synced:0},a.updateRecords(t.TRACKS_TABLE,d,c).catch(function(e){return a.updateRecords(t.ATTEMPTS_TABLE,{attempt:n},u).then(function(){return Promise.reject(e)})})}).finally(function(){s.syncProvider.unblockOperation(l.a.COMPONENT,e,"changeAttemptNumber",r.id)})})},e.prototype.createNewAttempt=function(e,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(i).then(function(i){s=s||i.getUserId(),a.logger.debug("Creating new offline attempt "+n+" in SCORM "+e.id),a.syncProvider.blockOperation(l.a.COMPONENT,e.id,"createNewAttempt",i.id);var c=i.getDb(),u={scormid:e.id,userid:s,attempt:n,courseid:e.course,timecreated:a.timeUtils.timestamp(),timemodified:a.timeUtils.timestamp(),snapshot:null};return r&&(u.snapshot=JSON.stringify(a.removeDefaultData(r))),c.insertRecord(t.ATTEMPTS_TABLE,u).then(function(){var t=[];for(var r in o){var c=o[r],u=[];for(var d in c.userdata)u.push({element:d,value:c.userdata[d]});t.push(a.saveTracks(e,c.scoid,n,u,o,i.id,s))}return Promise.all(t)}).finally(function(){a.syncProvider.unblockOperation(l.a.COMPONENT,e.id,"createNewAttempt",i.id)})})},e.prototype.deleteAttempt=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){r=r||o.getUserId(),i.logger.debug("Delete offline attempt "+n+" in SCORM "+e);var s=[],a=o.getDb();return s.push(a.deleteRecords(t.ATTEMPTS_TABLE,{scormid:e,userid:r,attempt:n})),s.push(a.deleteRecords(t.TRACKS_TABLE,{scormid:e,userid:r,attempt:n})),Promise.all(s)})},e.prototype.formatInteractions=function(e){var t={};t.score_raw="",t.status="",t.total_time="00:00:00",t.session_time="00:00:00";for(var n in e){var o=e[n];if("score_raw"==n||"status"==n||"total_time"==n||"session_time"==n)return;switch(t[n]=o,n){case"cmi.core.lesson_status":case"cmi.completion_status":"not attempted"==o&&(o="notattempted"),t.status=o;break;case"cmi.core.score.raw":case"cmi.score.raw":t.score_raw=this.textUtils.roundToDecimals(o,2);break;case"cmi.core.session_time":case"cmi.session_time":t.session_time=o;break;case"cmi.core.total_time":case"cmi.total_time":t.total_time=o}}return t},e.prototype.getAllAttempts=function(e){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.ATTEMPTS_TABLE)}).then(function(e){return e.forEach(function(e){e.snapshot=n.textUtils.parseJSON(e.snapshot)}),e})},e.prototype.getAttempt=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(o).then(function(o){return r=r||o.getUserId(),o.getDb().getRecord(t.ATTEMPTS_TABLE,{scormid:e,userid:r,attempt:n})}).then(function(e){return e.snapshot=i.textUtils.parseJSON(e.snapshot),e})},e.prototype.getAttemptCreationTime=function(e,t,n,o){return this.getAttempt(e,t,n,o).catch(function(){return{}}).then(function(e){return e.timecreated})},e.prototype.getAttempts=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().getRecords(t.ATTEMPTS_TABLE,{scormid:e,userid:o})}).then(function(e){return e.forEach(function(e){e.snapshot=r.textUtils.parseJSON(e.snapshot)}),e})},e.prototype.getAttemptSnapshot=function(e,t,n,o){return this.getAttempt(e,t,n,o).catch(function(){return{}}).then(function(e){return e.snapshot})},e.prototype.getLaunchUrlsFromScos=function(e){var t={};return e.forEach(function(e){t[e.id]=e.launch}),t},e.prototype.getScormStoredData=function(e,n,o,r,i,s){var a=this;return o&&r?Promise.resolve([]):this.sitesProvider.getSite(i).then(function(i){s=s||i.getUserId();var a={scormid:e,userid:s,attempt:n};return o?a.synced=0:r&&(a.synced=1),i.getDb().getRecords(t.TRACKS_TABLE,a)}).then(function(e){return e.forEach(function(e){e.value=a.textUtils.parseJSON(e.value)}),e})},e.prototype.getScormUserData=function(e,t,n,o,r){var i=this,s="",a="";return this.sitesProvider.getSite(o).then(function(e){if((r=r||e.getUserId())!=e.getUserId())return i.userProvider.getProfile(r).then(function(e){s=e.fullname,a=e.username||""}).catch(function(){});s=e.getInfo().fullname,a=e.getInfo().username}).then(function(){return i.getScormStoredData(e,t,!1,!1,o,r).then(function(e){var t={},o=i.getLaunchUrlsFromScos(n);e.forEach(function(e){var n=e.scoid;t[n]||(t[n]={scoid:n,userdata:{userid:r,scoid:n,timemodified:0}}),t[n].userdata[e.element]=e.value,e.timemodified>t[n].userdata.timemodified&&(t[n].userdata.timemodified=e.timemodified)});for(var c in t){(u=t[c]).userdata=i.formatInteractions(u.userdata)}n.forEach(function(e){t[e.id]||(t[e.id]={scoid:e.id,userdata:{status:"",score_raw:""}})});for(var c in t){var u;(u=t[c]).defaultdata={},u.defaultdata["cmi.core.student_id"]=a,u.defaultdata["cmi.core.student_name"]=s,u.defaultdata["cmi.core.lesson_mode"]="normal",u.defaultdata["cmi.core.credit"]="credit",u.defaultdata["cmi.core.entry"]=""===u.userdata.status?"ab-initio":"suspend"===u.userdata["cmi.core.exit"]?"resume":"",u.defaultdata["cmi.student_data.mastery_score"]=i.scormIsset(u.userdata,"masteryscore"),u.defaultdata["cmi.student_data.max_time_allowed"]=i.scormIsset(u.userdata,"max_time_allowed"),u.defaultdata["cmi.student_data.time_limit_action"]=i.scormIsset(u.userdata,"time_limit_action"),u.defaultdata["cmi.core.total_time"]=i.scormIsset(u.userdata,"cmi.core.total_time","00:00:00"),u.defaultdata["cmi.launch_data"]=o[u.scoid],u.defaultdata["cmi.core.lesson_location"]=i.scormIsset(u.userdata,"cmi.core.lesson_location"),u.defaultdata["cmi.core.lesson_status"]=i.scormIsset(u.userdata,"cmi.core.lesson_status"),u.defaultdata["cmi.core.score.raw"]=i.scormIsset(u.userdata,"cmi.core.score.raw"),u.defaultdata["cmi.core.score.max"]=i.scormIsset(u.userdata,"cmi.core.score.max"),u.defaultdata["cmi.core.score.min"]=i.scormIsset(u.userdata,"cmi.core.score.min"),u.defaultdata["cmi.core.exit"]=i.scormIsset(u.userdata,"cmi.core.exit"),u.defaultdata["cmi.suspend_data"]=i.scormIsset(u.userdata,"cmi.suspend_data"),u.defaultdata["cmi.comments"]=i.scormIsset(u.userdata,"cmi.comments"),u.defaultdata["cmi.student_preference.language"]=i.scormIsset(u.userdata,"cmi.student_preference.language"),u.defaultdata["cmi.student_preference.audio"]=i.scormIsset(u.userdata,"cmi.student_preference.audio","0"),u.defaultdata["cmi.student_preference.speed"]=i.scormIsset(u.userdata,"cmi.student_preference.speed","0"),u.defaultdata["cmi.student_preference.text"]=i.scormIsset(u.userdata,"cmi.student_preference.text","0"),u.userdata.student_id=a,u.userdata.student_name=s,u.userdata.mode=u.defaultdata["cmi.core.lesson_mode"],u.userdata.credit=u.defaultdata["cmi.core.credit"],u.userdata.entry=u.defaultdata["cmi.core.entry"]}return t})})},e.prototype.insertTrack=function(e,t,n,o,r,i,s,a,c){var u=this;return this.sitesProvider.getSite(a).then(function(a){c=c||a.getUserId();var d=[],l=(s=s||{}).userdata||{},f=a.getDb(),p=!1;return i&&("cmi.core.lesson_status"==o&&"incomplete"==r&&l["cmi.core.score.raw"]&&(r="completed"),"cmi.core.score.raw"==o&&"incomplete"==l["cmi.core.lesson_status"]&&(p=!0,d.push(u.insertTrackToDB(f,c,e,t,n,"cmi.core.lesson_status","completed")))),Promise.all(d).then(function(){if(!l[o]||"x.start.time"!=o){var i=u.insertTrackToDB(f,c,e,t,n,o,r);return i.catch(function(o){return p?(i=u.insertTrackToDB(f,c,e,t,n,"cmi.core.lesson_status","incomplete")).then(function(){return Promise.reject(o)}):Promise.reject(null)})}})})},e.prototype.insertTrackToDB=function(e,n,o,r,i,s,a,c){var u={userid:n,scormid:o,scoid:r,attempt:i,element:s,value:void 0===a?null:JSON.stringify(a),timemodified:this.timeUtils.timestamp(),synced:0};return c?(e.insertRecord(t.TRACKS_TABLE,u),!0):e.insertRecord(t.TRACKS_TABLE,u)},e.prototype.insertTrackSync=function(e,t,n,o,r,i,s,a){if(s=s||{},a=a||this.sitesProvider.getCurrentSiteUserId(),!this.sitesProvider.isLoggedIn())return!1;var c=s.userdata||{},u=this.sitesProvider.getCurrentSite().getDb(),d=!1;return!(i&&("cmi.core.lesson_status"==o&&"incomplete"==r&&c["cmi.core.score.raw"]&&(r="completed"),"cmi.core.score.raw"==o&&"incomplete"==c["cmi.core.lesson_status"]&&(d=!0,!this.insertTrackToDB(u,a,e,t,n,"cmi.core.lesson_status","completed",!0))))&&(c[o]&&"x.start.time"==o?void 0:!!this.insertTrackToDB(u,a,e,t,n,o,r,!0)||(d&&this.insertTrackToDB(u,a,e,t,n,"cmi.core.lesson_status","incomplete",!0),!1))},e.prototype.markAsSynced=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(r).then(function(r){return i=i||r.getUserId(),s.logger.debug("Mark SCO "+o+" as synced for attempt "+n+" in SCORM "+e),r.getDb().updateRecords(t.TRACKS_TABLE,{synced:1},{scormid:e,userid:i,attempt:n,scoid:o,synced:0})})},e.prototype.removeDefaultData=function(e){var t=this.utils.clone(e);for(var n in t)delete t[n].defaultdata;return t},e.prototype.saveTracks=function(e,t,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(i).then(function(c){s=s||c.getUserId(),a.syncProvider.blockOperation(l.a.COMPONENT,e.id,"saveTracksOffline",i);var u=[];return o.forEach(function(o){u.push(a.insertTrack(e.id,t,n,o.element,o.value,e.forcecompleted,r[t],i,s))}),Promise.all(u).finally(function(){a.syncProvider.unblockOperation(l.a.COMPONENT,e.id,"saveTracksOffline",i)})})},e.prototype.saveTracksSync=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteUserId();var a=!0;return o.forEach(function(o){s.insertTrackSync(e.id,t,n,o.element,o.value,e.forcecompleted,r[t],i)||(a=!1)}),a},e.prototype.scormIsset=function(e,t,n){return void 0===n&&(n=""),void 0!==e[t]?e[t]:n},e.prototype.setAttemptSnapshot=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(r).then(function(r){i=i||r.getUserId(),s.logger.debug("Set snapshot for attempt "+n+" in SCORM "+e);var a={timemodified:s.timeUtils.timestamp(),snapshot:JSON.stringify(s.removeDefaultData(o))};return r.getDb().updateRecords(t.ATTEMPTS_TABLE,a,{scormid:e,userid:i,attempt:n})})},e.ATTEMPTS_TABLE="addon_mod_scorm_offline_attempts",e.TRACKS_TABLE="addon_mod_scorm_offline_scos_tracks",e=t=f([Object(o.A)(),p("design:paramtypes",[r.a,i.a,c.a,s.a,u.a,a.a,d.a])],e);var t}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=t,this.ROOT_CACHE_KEY="mmaBadges:",this.logger=e.getInstance("AddonBadgesProvider")}return e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return!!e.canUseAdvancedFeature("enablebadges")&&!!e.wsAvailable("core_course_get_user_navigation_options")})},e.prototype.getBadgesCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"badges:"+e+":"+t},e.prototype.getUserBadges=function(e,t,n){var o=this;return this.logger.debug("Get badges for course "+e),this.sitesProvider.getSite(n).then(function(n){var r={courseid:e,userid:t},i={cacheKey:o.getBadgesCacheKey(e,t)};return n.read("core_badges_get_user_badges",r,i).then(function(e){return e&&e.badges?e.badges:Promise.reject(null)})})},e.prototype.invalidateUserBadges=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.invalidateWsCacheForKey(o.getBadgesCacheKey(e,t))})},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(27),i=n(56),s=n(26),a=n(117),c=n(149),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o){this.fileProvider=e,this.uploaderProvider=t,this.userProvider=n,this.forumOffline=o}return e.prototype.convertOfflineReplyToOnline=function(e,t){var n={attachments:[],canreply:!1,children:[],created:e.timecreated,discussion:e.discussionid,id:!1,mailed:0,mailnow:0,message:e.message,messageformat:1,messagetrust:0,modified:!1,parent:e.postid,postread:!1,subject:e.subject,totalscore:0,userid:e.userid},o=[];return e.options&&e.options.attachmentsid&&(n.attachments=e.options.attachmentsid.online||[],e.options.attachmentsid.offline&&o.push(this.getReplyStoredFiles(e.forumid,n.parent,t,n.userid).then(function(e){n.attachments=n.attachments.concat(e)}))),o.push(this.userProvider.getProfile(e.userid,e.courseid,!0).then(function(e){n.userfullname=e.fullname,n.userpictureurl=e.profileimageurl}).catch(function(){})),Promise.all(o).then(function(){return n.attachment=n.attachments.length>0?1:0,n})},e.prototype.deleteNewDiscussionStoredFiles=function(e,t,n){var o=this;return this.forumOffline.getNewDiscussionFolder(e,t,n).then(function(e){return o.fileProvider.removeDir(e).catch(function(){})})},e.prototype.deleteReplyStoredFiles=function(e,t,n,o){var r=this;return this.forumOffline.getReplyFolder(e,t,n,o).then(function(e){return r.fileProvider.removeDir(e).catch(function(){})})},e.prototype.getNewDiscussionStoredFiles=function(e,t,n){var o=this;return this.forumOffline.getNewDiscussionFolder(e,t,n).then(function(e){return o.uploaderProvider.getStoredFiles(e)})},e.prototype.getReplyStoredFiles=function(e,t,n,o){var r=this;return this.forumOffline.getReplyFolder(e,t,n,o).then(function(e){return r.uploaderProvider.getStoredFiles(e)})},e.prototype.hasPostDataChanged=function(e,t){return!(!t||null==t.subject)&&(e.subject!=t.subject||e.message!=t.message||this.uploaderProvider.areFileListDifferent(e.files,t.files))},e.prototype.storeNewDiscussionFiles=function(e,t,n,o){var r=this;return this.forumOffline.getNewDiscussionFolder(e,t,o).then(function(e){return r.uploaderProvider.storeFilesToUpload(e,n)})},e.prototype.storeReplyFiles=function(e,t,n,o,r){var i=this;return this.forumOffline.getReplyFolder(e,t,o,r).then(function(e){return i.uploaderProvider.storeFilesToUpload(e,n)})},e.prototype.uploadOrStoreNewDiscussionFiles=function(e,t,n,o,r){return o?this.storeNewDiscussionFiles(e,t,n,r):this.uploaderProvider.uploadOrReuploadFiles(n,a.a.COMPONENT,e,r)},e.prototype.uploadOrStoreReplyFiles=function(e,t,n,o,r,i){return o?this.storeReplyFiles(e,t,n,r,i):this.uploaderProvider.uploadOrReuploadFiles(n,a.a.COMPONENT,e,r)},e=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1),i=n(69),s=n(10),a=n(56),c=n(9),u=n(7),d=n(12),l=n(2),f=n(45),p=n(11),h=n(6),m=n(117),g=n(195),y=n(149),v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var h=e.call(this,"AddonModForumSyncProvider",i,s,n,a,c,t)||this;return h.eventsProvider=r,h.uploaderProvider=u,h.utils=d,h.forumProvider=l,h.forumHelper=f,h.forumOffline=p,h.componentTranslate=o.translateModuleName("forum"),h}return v(t,e),n=t,t.prototype.syncAllForums=function(e){return this.syncOnSites("all forums",this.syncAllForumsFunc.bind(this),[],e)},t.prototype.syncAllForumsFunc=function(e){var t=this,o=[];return o.push(this.forumOffline.getAllNewDiscussions(e).then(function(o){var r={};return o.forEach(function(o){void 0===r[o.forumid]&&(r[o.forumid]=t.syncForumDiscussionsIfNeeded(o.forumid,o.userid,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{forumId:o.forumid,userId:o.userid,warnings:r.warnings},e)}))}),Promise.all(t.utils.objectToArray(r))})),o.push(this.forumOffline.getAllReplies(e).then(function(o){var r={};return o.forEach(function(o){void 0===r[o.discussionid]&&(r[o.discussionid]=t.syncDiscussionRepliesIfNeeded(o.discussionid,o.userid,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{forumId:o.forumid,discussionId:o.discussionid,userId:o.userid,warnings:r.warnings},e)}))}),Promise.all(t.utils.objectToArray(r))})),Promise.all(o)},t.prototype.syncForumDiscussionsIfNeeded=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getForumSyncId(e,t);return this.isSyncNeeded(r,n).then(function(r){if(r)return o.syncForumDiscussions(e,t,n)})},t.prototype.syncForumDiscussions=function(e,t,n){var o=this;t=t||this.sitesProvider.getCurrentSiteUserId(),n=n||this.sitesProvider.getCurrentSiteId();var r=this.getForumSyncId(e,t);if(this.isSyncing(r,n))return this.getOngoingSync(r,n);if(this.syncProvider.isBlocked(m.a.COMPONENT,r,n))return this.logger.debug("Cannot sync forum "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync forum "+e+" for user "+t);var i={warnings:[],updated:!1},s=this.forumOffline.getNewDiscussions(e,n,t).catch(function(){return[]}).then(function(r){if(r.length){if(!o.appProvider.isOnline())return Promise.reject(null);var s=[];return r.forEach(function(r){r.options=r.options||{};var a=o.uploadAttachments(e,r,!0,n,t).then(function(t){return r.options.attachmentsid=t,o.forumProvider.addNewDiscussionOnline(e,r.subject,r.message,r.options,r.groupid,n)});s.push(a.then(function(){return i.updated=!0,o.deleteNewDiscussion(e,r.timecreated,n,t)}).catch(function(s){return o.utils.isWebServiceError(s)?(i.updated=!0,o.deleteNewDiscussion(e,r.timecreated,n,t).then(function(){i.warnings.push(o.translate.instant("core.warningofflinedatadeleted",{component:o.componentTranslate,name:r.name,error:s.error}))})):Promise.reject(s)}))}),Promise.all(s)}}).then(function(){if(i.updated){var t=[o.forumProvider.invalidateDiscussionsList(e,n),o.forumProvider.invalidateCanAddDiscussion(e,n)];return Promise.all(t).catch(function(){})}}).then(function(){return o.setSyncTime(r,n).catch(function(){})}).then(function(){return i});return this.addOngoingSync(r,s,n)},t.prototype.syncForumReplies=function(e,t,n){var o=this;return this.forumOffline.getForumReplies(e,n,t).catch(function(){return[]}).then(function(e){if(!e.length)return{warnings:[],updated:!1};if(!o.appProvider.isOnline())return Promise.reject(null);var r={};return e.forEach(function(e){void 0===r[e.discussionid]&&(r[e.discussionid]=o.syncDiscussionReplies(e.discussionid,t,n))}),Promise.all(o.utils.objectToArray(r)).then(function(e){return e.reduce(function(e,t){return{warnings:e.warnings.concat(t.warnings),updated:e.updated||t.updated}},{warnings:[],updated:!1})})})},t.prototype.syncDiscussionRepliesIfNeeded=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getDiscussionSyncId(e,t);return this.isSyncNeeded(r,n).then(function(r){if(r)return o.syncDiscussionReplies(e,t,n)})},t.prototype.syncDiscussionReplies=function(e,t,n){var o=this;t=t||this.sitesProvider.getCurrentSiteUserId(),n=n||this.sitesProvider.getCurrentSiteId();var r=this.getDiscussionSyncId(e,t);if(this.isSyncing(r,n))return this.getOngoingSync(r,n);if(this.syncProvider.isBlocked(m.a.COMPONENT,r,n))return this.logger.debug("Cannot sync forum discussion "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync forum discussion "+e+" for user "+t);var i,s={warnings:[],updated:!1},a=this.forumOffline.getDiscussionReplies(e,n,t).catch(function(){return[]}).then(function(e){if(e.length){if(!o.appProvider.isOnline())return Promise.reject(null);var r=[];return e.forEach(function(e){i=e.forumid,e.options=e.options||{};var a=o.uploadAttachments(i,e,!1,n,t).then(function(t){return e.options.attachmentsid=t,o.forumProvider.replyPostOnline(e.postid,e.subject,e.message,e.options,n)});r.push(a.then(function(){return s.updated=!0,o.deleteReply(i,e.postid,n,t)}).catch(function(r){return o.utils.isWebServiceError(r)?(s.updated=!0,o.deleteReply(i,e.postid,n,t).then(function(){s.warnings.push(o.translate.instant("core.warningofflinedatadeleted",{component:o.componentTranslate,name:e.name,error:r.error}))})):Promise.reject(r)}))}),Promise.all(r)}}).then(function(){var t=[];return i&&t.push(o.forumProvider.invalidateDiscussionsList(i,n)),t.push(o.forumProvider.invalidateDiscussionPosts(e,n)),o.utils.allPromises(t).catch(function(){})}).then(function(){return o.setSyncTime(r,n).catch(function(){})}).then(function(){return s});return this.addOngoingSync(r,a,n)},t.prototype.deleteNewDiscussion=function(e,t,n,o){var r=[];return r.push(this.forumOffline.deleteNewDiscussion(e,t,n,o)),r.push(this.forumHelper.deleteNewDiscussionStoredFiles(e,t,n).catch(function(){})),Promise.all(r)},t.prototype.deleteReply=function(e,t,n,o){var r=[];return r.push(this.forumOffline.deleteReply(t,n,o)),r.push(this.forumHelper.deleteReplyStoredFiles(e,t,n,o).catch(function(){})),Promise.all(r)},t.prototype.uploadAttachments=function(e,t,n,o,r){var i=this,s=t&&t.options&&t.options.attachmentsid;if(s){var a=s.online||[],c=void 0;return s.offline?(c=n?this.forumHelper.getNewDiscussionStoredFiles(e,t.timecreated,o):this.forumHelper.getReplyStoredFiles(e,t.postid,o,r)).then(function(e){a=a.concat(e)}).catch(function(){}):c=Promise.resolve(),c.then(function(){return i.uploaderProvider.uploadOrReuploadFiles(a,m.a.COMPONENT,e,o)})}return Promise.resolve()},t.prototype.getForumSyncId=function(e,t){return t=t||this.sitesProvider.getCurrentSiteUserId(),"forum#"+e+"#"+t},t.prototype.getDiscussionSyncId=function(e,t){return t=t||this.sitesProvider.getCurrentSiteUserId(),"discussion#"+e+"#"+t},t.AUTO_SYNCED="addon_mod_forum_autom_synced",t.MANUAL_SYNCED="addon_mod_forum_manual_synced",t=n=b([Object(o.A)(),_("design:paramtypes",[r.c,c.a,s.a,d.a,u.a,l.a,f.a,p.a,a.a,h.a,m.a,g.a,y.a])],t);var n}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(9),i=n(7),s=n(2),a=n(22),c=n(26),u=n(186),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.appProvider=t,this.sitesProvider=n,this.timeUtils=o,this.userProvider=r,this.emulatorHelper=i,this.ROOT_CACHE_KEY="mmaNotifications:",this.logger=e.getInstance("AddonNotificationsProvider")}return t=e,e.prototype.formatNotificationsData=function(e){var t=this;e.forEach(function(e){e.mobiletext=e.contexturl&&e.contexturl.indexOf("/mod/forum/")?e.smallmessage:e.fullmessage;var n=e.fullmessagehtml.match(/course\/view\.php\?id=([^"]*)/);n&&n[1]&&(e.courseid=n[1]),t.userProvider.getProfile(e.useridfrom,e.courseid,!0).then(function(t){e.profileimageurlfrom=t.profileimageurl})})},e.prototype.getNotificationPreferencesCacheKey=function(){return this.ROOT_CACHE_KEY+"notificationPreferences"},e.prototype.getNotificationPreferences=function(e){var t=this;return this.logger.debug("Get notification preferences"),this.sitesProvider.getSite(e).then(function(e){var n={cacheKey:t.getNotificationPreferencesCacheKey()};return e.read("core_message_get_user_notification_preferences",{},n).then(function(e){return e.preferences})})},e.prototype.getNotificationsCacheKey=function(){return this.ROOT_CACHE_KEY+"list"},e.prototype.getNotifications=function(e,n,o,r,i,s,a){var c=this;return void 0===o&&(o=0),void 0===r&&(r=!0),o=o||t.LIST_LIMIT,this.logger.debug("Get "+(e?"read":"unread")+" notifications from "+n+". Limit: "+o),this.sitesProvider.getSite(a).then(function(u){var d={useridto:u.getUserId(),useridfrom:0,type:"notifications",read:e?1:0,newestfirst:1,limitfrom:n,limitnum:o},l={cacheKey:c.getNotificationsCacheKey(),omitExpires:i,getFromCache:i||!s,emergencyCache:i||!s};return u.read("core_message_get_messages",d,l).then(function(o){if(o.messages){var i=o.messages;return c.formatNotificationsData(i),c.appProvider.isDesktop()&&r&&!e&&0===n&&c.emulatorHelper.storeLastReceivedNotification(t.PUSH_SIMULATION_COMPONENT,i[0],a),i}return Promise.reject(null)})})},e.prototype.getReadNotifications=function(e,t,n,o,r,i){return void 0===n&&(n=!0),this.getNotifications(!0,e,t,n,o,r,i)},e.prototype.getUnreadNotifications=function(e,t,n,o,r,i){return void 0===n&&(n=!0),this.getNotifications(!1,e,t,n,o,r,i)},e.prototype.getUnreadNotificationsCount=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(r){if(r.wsAvailable("message_popup_get_unread_popup_notification_count")){e=e||r.getUserId();return r.read("message_popup_get_unread_popup_notification_count",{useridto:e},{getFromCache:!1,emergencyCache:!1,saveToCache:!1,typeExpected:"number"}).catch(function(){return 0})}return o.getUnreadNotifications(0,t.LIST_LIMIT+1,!1,!1,!1,n).then(function(e){return e.length>t.LIST_LIMIT?t.LIST_LIMIT+"+":e.length}).catch(function(){return 0})})},e.prototype.markNotificationRead=function(e){var t={messageid:e,timeread:this.timeUtils.timestamp()};return this.sitesProvider.getCurrentSite().write("core_message_mark_message_read",t)},e.prototype.invalidateNotificationPreferences=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getNotificationPreferencesCacheKey())})},e.prototype.invalidateNotificationsList=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getNotificationsCacheKey())})},e.prototype.isPreciseNotificationCountEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("message_popup_get_unread_popup_notification_count")},e.prototype.isNotificationPreferencesEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_message_get_user_notification_preferences")},e.READ_CHANGED_EVENT="addon_notifications_read_changed_event",e.READ_CRON_EVENT="addon_notifications_read_cron_event",e.PUSH_SIMULATION_COMPONENT="AddonNotificationsPushSimulation",e.LIST_LIMIT=20,e=t=d([Object(o.A)(),l("design:paramtypes",[i.a,r.a,s.a,a.a,c.a,u.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(2),s=n(11),a=n(56),c=n(62),u=n(150),d=n(59),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.sitesProvider=e,this.dataProvider=t,this.translate=n,this.fieldsDelegate=o,this.dataOffline=r,this.fileUploaderProvider=i,this.textUtils=s}return e.prototype.applyOfflineActions=function(e,t,n){var o=this,r=[];return t.forEach(function(t){switch(t.action){case"approve":e.approved=!0;break;case"disapprove":e.approved=!1;break;case"delete":e.deleted=!0;break;case"add":case"edit":var i={};t.fields.forEach(function(e){void 0===i[e.fieldid]&&(i[e.fieldid]={}),e.subfield?i[e.fieldid][e.subfield]=o.textUtils.parseJSON(e.value):i[e.fieldid][""]=o.textUtils.parseJSON(e.value)}),n.forEach(function(t){o.fieldsDelegate.hasFiles(t)?r.push(o.getStoredFiles(e.dataid,e.id,t.id).then(function(n){e.contents[t.id]=o.fieldsDelegate.overrideData(t,e.contents[t.id],i[t.id],n)})):e.contents[t.id]=o.fieldsDelegate.overrideData(t,e.contents[t.id],i[t.id])})}}),Promise.all(r).then(function(){return e})},e.prototype.displayShowFields=function(e,t,n,o,r){if(!e)return"";var i,s;t.forEach(function(t){i=(i="[["+t.name+"]]").replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),i=new RegExp(i,"gi"),e=e.replace(i,s='<addon-mod-data-field-plugin [field]="fields['+t.id+']" [value]="entries['+n.id+"].contents["+t.id+']" mode="'+o+'" [database]="data" (gotoEntry)="gotoEntry('+n.id+')"></addon-mod-data-field-plugin>')});for(var a in r)i=new RegExp("##"+a+"##","gi"),r[a]?(s="moreurl"==a?this.sitesProvider.getCurrentSite().getURL()+"/mod/data/view.php?d={{data.id}}&rid="+n.id:"approvalstatus"==a?this.translate.instant("addon.mod_data."+(n.approved?"approved":"notapproved")):'<addon-mod-data-action action="'+a+'" [entry]="entries['+n.id+']" mode="'+o+'" [database]="data"></addon-mod-data-action>',e=e.replace(i,s)):e=e.replace(i,"");return e},e.prototype.getActions=function(e,t,n){return{more:!0,moreurl:!0,user:!0,userpicture:!0,timeadded:!0,timemodified:!0,edit:n.canmanageentry&&!n.deleted,delete:n.canmanageentry,approve:e.approval&&t.canapprove&&!n.approved&&!n.deleted,disapprove:e.approval&&t.canapprove&&n.approved&&!n.deleted,approvalstatus:e.approval,comments:e.comments,delcheck:!1,export:!1}},e.prototype.getAllEntriesIds=function(e,t,n,o,r){return void 0===n&&(n=!1),void 0===o&&(o=!1),this.dataProvider.fetchAllEntries(e,t,void 0,void 0,void 0,n,o,r).then(function(e){return e.map(function(e){return e.id})})},e.prototype.getEditDataFromForm=function(e,t,n,o,r,i,s){var a=this;if(void 0===i&&(i=!1),!e)return Promise.resolve({});s=s||this.sitesProvider.getCurrentSiteId();var c=[],u=[];return t.forEach(function(t){u.push(Promise.resolve(a.fieldsDelegate.getFieldEditData(t,e,r[t.id])).then(function(e){if(e){var t=[];return e.forEach(function(e){var r;r=n&&e.files?a.uploadOrStoreFiles(n,0,o,e.fieldid,e.files,i,s).then(function(t){delete e.files,e.value=t}):Promise.resolve(),t.push(r.then(function(){e.value&&(e.value=JSON.stringify(e.value)),void 0===e.subfield&&(e.subfield=""),c.push(e)}))}),Promise.all(t)}}))}),Promise.all(u).then(function(){return c})},e.prototype.getEditTmpFiles=function(e,t,n,o){var r=this;if(!e)return Promise.resolve([]);var i=t.map(function(t){return Promise.resolve(r.fieldsDelegate.getFieldEditFiles(t,e,o[t.id]))});return Promise.all(i).then(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})},e.prototype.getEntry=function(e,t,n,o){return t>0?this.dataProvider.getEntry(e.id,t,o):this.sitesProvider.getSite(o).then(function(t){var o=n.find(function(e){return"add"==e.action});if(o){var r=t.getInfo();return{entry:{id:o.entryid,canmanageentry:!0,approved:!e.approval||e.manageapproved,dataid:o.dataid,groupid:o.groupid,timecreated:-o.entryid,timemodified:-o.entryid,userid:r.userid,fullname:r.fullname,contents:{}}}}})},e.prototype.getPageInfoByEntry=function(e,t,n,o,r,i){return void 0===o&&(o=!1),void 0===r&&(r=!1),this.getAllEntriesIds(e,n,o,r,i).then(function(e){var n=e.findIndex(function(e){return e==t});return n>=0&&{previousId:e[n-1]||!1,nextId:e[n+1]||!1,entryId:t,page:n+1,numEntries:e.length}})},e.prototype.getPageInfoByPage=function(e,t,n,o,r,i){return void 0===o&&(o=!1),void 0===r&&(r=!1),this.getAllEntriesIds(e,n,o,r,i).then(function(e){var n=t-1,o=e[n];return!!o&&{previousId:e[n-1]||null,nextId:e[n+1]||null,entryId:o,page:t,numEntries:e.length}})},e.prototype.getStoredFiles=function(e,t,n,o){var r=this;return this.dataOffline.getEntryFieldFolder(e,t,n,o).then(function(e){return r.fileUploaderProvider.getStoredFiles(e).catch(function(){return[]})})},e.prototype.hasEditDataChanged=function(e,t,n,o){var r=this,i=t.map(function(t){return r.fieldsDelegate.hasFieldDataChanged(t,e,o[t.id])});return Promise.all(i).then(function(){return!1}).catch(function(){return!0})},e.prototype.prefixCSS=function(e,t){if(!e)return"";var n=/\/\*[\s\S]*?\*\/|([^:]|^)\/\/.*$/gm;return e=e.replace(n,""),n=/([^]*?)({[^]*?}|,)/g,e.replace(n,t+" $1 $2")},e.prototype.storeFiles=function(e,t,n,o,r){var i=this;return this.dataOffline.getEntryFieldFolder(e,t,n,r).then(function(e){return i.fileUploaderProvider.storeFilesToUpload(e,o)})},e.prototype.uploadOrStoreFiles=function(e,t,n,o,r,i,s){return void 0===t&&(t=0),r.length?i?this.storeFiles(e,n,o,r,s):this.fileUploaderProvider.uploadOrReuploadFiles(r,d.a.COMPONENT,t,s):Promise.resolve(0)},e=l([Object(o.A)(),f("design:paramtypes",[i.a,d.a,r.c,c.a,u.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(58),i=n(12),s=n(7),a=n(2),c=n(6),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var s=e.call(this,"CoreSettingsDelegate",t,n,o)||this;return s.loggerProvider=t,s.sitesProvider=n,s.eventsProvider=o,s.utils=r,s.siteHandlers=[],o.on(i.a.LOGOUT,s.clearSiteHandlers.bind(s)),s}return u(t,e),t.prototype.clearSiteHandlers=function(){this.siteHandlers=[]},t.prototype.getHandlers=function(){return this.siteHandlers},t.prototype.updateData=function(){var e=[];for(var t in this.enabledHandlers){var n=this.enabledHandlers[t],o=n.getDisplayData();e.push({data:o,priority:n.priority})}e.sort(function(e,t){return t.priority-e.priority}),this.siteHandlers=e.map(function(e){return e.data})},t=d([Object(o.A)(),l("design:paramtypes",[s.a,a.a,i.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(2),s=n(11),a=n(22),c=n(6),u=n(95),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,n,o,r,i){this.sitesProvider=n,this.timeUtils=o,this.textUtils=r,this.utils=i,this.tablesSchema=[{name:t.RETAKES_TABLE,columns:[{name:"lessonid",type:"INTEGER",primaryKey:!0},{name:"retake",type:"INTEGER",notNull:!0},{name:"courseid",type:"INTEGER"},{name:"finished",type:"INTEGER"},{name:"outoftime",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"lastquestionpage",type:"INTEGER"}]},{name:t.PAGE_ATTEMPTS_TABLE,columns:[{name:"lessonid",type:"INTEGER",notNull:!0},{name:"retake",type:"INTEGER",notNull:!0},{name:"pageid",type:"INTEGER",notNull:!0},{name:"timemodified",type:"INTEGER",notNull:!0},{name:"courseid",type:"INTEGER"},{name:"data",type:"TEXT"},{name:"type",type:"INTEGER"},{name:"newpageid",type:"INTEGER"},{name:"correct",type:"INTEGER"},{name:"answerid",type:"INTEGER"},{name:"useranswer",type:"TEXT"}],primaryKeys:["lessonid","retake","pageid","timemodified"]}],this.logger=e.getInstance("AddonModLessonOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteAttempt=function(e,n,o,r,i){return this.sitesProvider.getSite(i).then(function(i){return i.getDb().deleteRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e,retake:n,pageid:o,timemodified:r})})},e.prototype.deleteRetake=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().deleteRecords(t.RETAKES_TABLE,{lessonid:e})})},e.prototype.deleteRetakeAttemptsForPage=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){return r.getDb().deleteRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e,retake:n,pageid:o})})},e.prototype.finishRetake=function(e,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){return a.getRetakeWithFallback(e,n,o,s.id).then(function(e){return e.finished=r?1:0,e.outoftime=i?1:0,e.timemodified=a.timeUtils.timestamp(),s.getDb().insertRecord(t.RETAKES_TABLE,e)})})},e.prototype.getAllAttempts=function(e){var n=this;return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.PAGE_ATTEMPTS_TABLE)}).then(function(e){return n.parsePageAttempts(e)})},e.prototype.getAllLessonsWithData=function(e){var t=this,n=[],o={};return n.push(this.getAllAttempts(e).then(function(e){t.getLessonsFromEntries(o,e)}).catch(function(){})),n.push(this.getAllRetakes(e).then(function(e){t.getLessonsFromEntries(o,e)}).catch(function(){})),Promise.all(n).then(function(){return t.utils.objectToArray(o)})},e.prototype.getAllRetakes=function(e){return this.sitesProvider.getSiteDb(e).then(function(e){return e.getAllRecords(t.RETAKES_TABLE)})},e.prototype.getLastQuestionPageAttempt=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.getRetakeWithFallback(e,0,t,n).then(function(r){if(r.lastquestionpage)return o.getRetakeAttemptsForPage(e,t,r.lastquestionpage,n).then(function(e){return e.reduce(function(e,t){return e.timemodified>t.timemodified?e:t})})}).catch(function(){})},e.prototype.getLessonAttempts=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e})}).then(function(e){return o.parsePageAttempts(e)})},e.prototype.getLessonsFromEntries=function(e,t){t.forEach(function(t){e[t.lessonid]||(e[t.lessonid]={id:t.lessonid,courseId:t.courseid})})},e.prototype.getQuestionsAttempts=function(e,t,n,o,r){return(o?this.getRetakeAttemptsForPage(e,t,o,r):this.getRetakeAttemptsForType(e,t,u.a.TYPE_QUESTION,r)).then(function(e){return n?e.filter(function(e){return!!e.correct}):e})},e.prototype.getRetake=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecord(t.RETAKES_TABLE,{lessonid:e})})},e.prototype.getRetakeAttempts=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().getRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e,retake:n})}).then(function(e){return r.parsePageAttempts(e)})},e.prototype.getRetakeAttemptsForPage=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.getDb().getRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e,retake:n,pageid:o})}).then(function(e){return i.parsePageAttempts(e)})},e.prototype.getRetakeAttemptsForType=function(e,n,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.getDb().getRecords(t.PAGE_ATTEMPTS_TABLE,{lessonid:e,retake:n,type:o})}).then(function(e){return i.parsePageAttempts(e)})},e.prototype.getRetakeWithFallback=function(e,t,n,o){return this.getRetake(e,o).then(function(e){return e.retake!=n?Promise.reject(null):e}).catch(function(){return{lessonid:e,retake:n,courseid:t,finished:0}})},e.prototype.hasFinishedRetake=function(e,t){return this.getRetake(e,t).then(function(e){return!!e.finished}).catch(function(){return!1})},e.prototype.hasOfflineData=function(e,t){var n=[],o=!1;return n.push(this.getRetake(e,t).then(function(){o=!0}).catch(function(){})),n.push(this.getLessonAttempts(e,t).then(function(e){o=o||!!e.length}).catch(function(){})),Promise.all(n).then(function(){return o})},e.prototype.hasRetakeAttempts=function(e,t,n){return this.getRetakeAttempts(e,t,n).then(function(e){return!!e.length}).catch(function(){return!1})},e.prototype.parsePageAttempt=function(e){return e.data=this.textUtils.parseJSON(e.data),e.useranswer=this.textUtils.parseJSON(e.useranswer),e},e.prototype.parsePageAttempts=function(e){var t=this;return e.forEach(function(e){t.parsePageAttempt(e)}),e},e.prototype.processPage=function(e,n,o,r,i,s,a,c,d,l){var f=this;return this.sitesProvider.getSite(l).then(function(u){var l={lessonid:e,retake:o,pageid:r.id,timemodified:f.timeUtils.timestamp(),courseid:n,data:i?JSON.stringify(i):null,type:r.type,newpageid:s,correct:c?1:0,answerid:Number(a),useranswer:d?JSON.stringify(d):null};return u.getDb().insertRecord(t.PAGE_ATTEMPTS_TABLE,l)}).then(function(){if(r.type==u.a.TYPE_QUESTION)return f.setLastQuestionPageAttempted(e,n,o,r.id,l)})},e.prototype.setLastQuestionPageAttempted=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){return s.getRetakeWithFallback(e,n,o,i.id).then(function(e){return e.lastquestionpage=r,e.timemodified=s.timeUtils.timestamp(),i.getDb().insertRecord(t.RETAKES_TABLE,e)})})},e.RETAKES_TABLE="addon_mod_lesson_retakes",e.PAGE_ATTEMPTS_TABLE="addon_mod_lesson_page_attempts",e=t=d([Object(o.A)(),l("design:paramtypes",[r.a,i.a,a.a,s.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,n){this.sitesProvider=n,this.tablesSchema=[{name:t.NEW_PAGES_TABLE,columns:[{name:"wikiid",type:"INTEGER"},{name:"subwikiid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"groupid",type:"INTEGER"},{name:"title",type:"TEXT"},{name:"cachedcontent",type:"TEXT"},{name:"contentformat",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"timecreated",type:"INTEGER"},{name:"timemodified",type:"INTEGER"},{name:"caneditpage",type:"INTEGER"}],primaryKeys:["wikiid","subwikiid","userid","groupid","title"]}],this.logger=e.getInstance("AddonModWikiOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.convertToPositiveNumber=function(e){return(e=parseInt(e,10))>0?e:0},e.prototype.deleteNewPage=function(e,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){return n=a.convertToPositiveNumber(n),o=a.convertToPositiveNumber(o),r=a.convertToPositiveNumber(r),i=a.convertToPositiveNumber(i),s.getDb().deleteRecords(t.NEW_PAGES_TABLE,{subwikiid:n,wikiid:o,userid:r,groupid:i,title:e})})},e.prototype.getAllNewPages=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.NEW_PAGES_TABLE)})},e.prototype.getNewPage=function(e,n,o,r,i,s){var a=this;return this.sitesProvider.getSite(s).then(function(s){return n=a.convertToPositiveNumber(n),o=a.convertToPositiveNumber(o),r=a.convertToPositiveNumber(r),i=a.convertToPositiveNumber(i),s.getDb().getRecord(t.NEW_PAGES_TABLE,{subwikiid:n,wikiid:o,userid:r,groupid:i,title:e})})},e.prototype.getSubwikiNewPages=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){return e=s.convertToPositiveNumber(e),n=s.convertToPositiveNumber(n),o=s.convertToPositiveNumber(o),r=s.convertToPositiveNumber(r),i.getDb().getRecords(t.NEW_PAGES_TABLE,{subwikiid:e,wikiid:n,userid:o,groupid:r})})},e.prototype.getSubwikisNewPages=function(e,t){var n=this,o=[],r=[];return e.forEach(function(e){o.push(n.getSubwikiNewPages(e.id,e.wikiid,e.userid,e.groupid,t).then(function(e){r=r.concat(e)}))}),Promise.all(o).then(function(){return r})},e.prototype.saveNewPage=function(e,n,o,r,i,s,a){var c=this;return this.sitesProvider.getSite(a).then(function(a){var u=(new Date).getTime(),d={title:e,cachedcontent:n,subwikiid:c.convertToPositiveNumber(o),wikiid:c.convertToPositiveNumber(r),userid:c.convertToPositiveNumber(i),groupid:c.convertToPositiveNumber(s),contentformat:"html",timecreated:u,timemodified:u,caneditpage:1};return a.getDb().insertRecord(t.NEW_PAGES_TABLE,d)})},e.prototype.subwikisHaveOfflineData=function(e,t){return this.getSubwikisNewPages(e,t).then(function(e){return!!e.length}).catch(function(){return!1})},e.NEW_PAGES_TABLE="addon_mod_wiki_new_pages_store",e=t=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e);var t}()},,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(9),s=n(27),a=n(18),c=n(2),u=n(6),d=n(30),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i){this.fileProvider=e,this.filepoolProvider=t,this.sitesProvider=n,this.appProvider=o,this.translate=r,this.utils=i}return e.prototype.downloadAndOpenFile=function(e,t,n,o,r,i){var s=this;i=i||this.sitesProvider.getCurrentSiteId();var a=this.getFileUrl(e),c=this.getFileTimemodified(e);return this.downloadFileIfNeeded(e,a,t,n,c,o,r,i).then(function(u){if(u)return 0===u.indexOf("http")?s.utils.openOnlineFile(u).catch(function(e){return s.fileProvider.isAvailable()?o||s.filepoolProvider.getFileStateByUrl(i,a,c):Promise.reject(e)}).then(function(o){if(o==d.a.DOWNLOADING)return Promise.reject(s.translate.instant("core.erroropenfiledownloading"));return(o===d.a.NOT_DOWNLOADED?s.downloadFile(a,t,n,c,r,e,i):s.filepoolProvider.getInternalUrlByUrl(i,a)).then(function(e){return s.utils.openFile(e)})}):s.utils.openFile(u)})},e.prototype.downloadFileIfNeeded=function(e,t,n,o,r,i,s,a){var c=this;return a=a||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(a).then(function(u){var l=u.fixPluginfileURL(t);if(c.fileProvider.isAvailable()){return(i?Promise.resolve(i):c.filepoolProvider.getFileStateByUrl(a,t,r)).then(function(i){var u=!c.appProvider.isNetworkAccessLimited(),f=c.appProvider.isOnline();return i==d.a.DOWNLOADED?c.filepoolProvider.getUrlByUrl(a,t,n,o,r,!1,!1,e):f||c.isStateDownloaded(i)?(s&&s({calculating:!0}),c.filepoolProvider.shouldDownloadBeforeOpen(l,e.filesize).then(function(){if(i!=d.a.DOWNLOADING)return c.downloadFile(t,n,o,r,s,e,a)},function(){return u&&f&&c.downloadFile(t,n,o,r,s,e,a),!c.isStateDownloaded(i)||f?l:c.filepoolProvider.getUrlByUrl(a,t,n,o,r,!1,!1,e)})):Promise.reject(c.translate.instant("core.networkerrormsg"))})}return l})},e.prototype.downloadFile=function(e,t,n,o,r,i,s){var a=this;return s=s||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(s).then(function(c){return c.canDownloadFiles()?a.filepoolProvider.downloadUrl(s,e,!1,t,n,o,r,void 0,i).catch(function(t){return a.filepoolProvider.getFileStateByUrl(s,e,o).then(function(n){return a.isStateDownloaded(n)?a.filepoolProvider.getInternalUrlByUrl(s,e):Promise.reject(t)})}):Promise.reject(a.translate.instant("core.cannotdownloadfiles"))})},e.prototype.getFileUrl=function(e){return e.fileurl||e.url},e.prototype.getFileTimemodified=function(e){return e.timemodified||0},e.prototype.isStateDownloaded=function(e){return e===d.a.DOWNLOADED||e===d.a.OUTDATED},e.prototype.shouldOpenInBrowser=function(e){if(!e||!e.isexternalfile||!e.mimetype)return!1;var t=e.mimetype;return-1!=t.indexOf("application/vnd.google-apps.")||"onedrive"==e.repositorytype&&(-1!=t.indexOf("application/vnd.openxmlformats-officedocument")||"text/plain"==t||"document/unknown"==t)},e=l([Object(o.A)(),f("design:paramtypes",[s.a,a.a,c.a,i.a,r.c,u.a])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(41),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.coursesProvider=n,this.utils=o,this.ROOT_CACHE_KEY="mmaCourseCompletion:",this.logger=e.getInstance("AddonCourseCompletionProvider")}return e.prototype.canMarkSelfCompleted=function(e,t){var n=!1,o=!1;return this.sitesProvider.getCurrentSiteUserId()==e&&(t.completions.forEach(function(e){1===e.type&&(n=!0,o=e.complete)}),n&&!o)},e.prototype.getCompletedStatusText=function(e){if(e.completed)return"addon.coursecompletion.completed";var t=!1;return e.completions.forEach(function(e){(e.timecompleted||e.complete)&&(t=!0)}),t?"addon.coursecompletion.inprogress":"addon.coursecompletion.notyetstarted"},e.prototype.getCompletion=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){t=t||o.getUserId(),n=n||{},r.logger.debug("Get completion for course "+e+" and user "+t);var i={courseid:e,userid:t};return n.cacheKey=r.getCompletionCacheKey(e,t),o.read("core_completion_get_course_completion_status",i,n).then(function(e){return e.completionstatus?e.completionstatus:Promise.reject(null)})})},e.prototype.getCompletionCacheKey=function(e,t){return this.ROOT_CACHE_KEY+"view:"+e+":"+t},e.prototype.invalidateCourseCompletion=function(e,t){return t=t||this.sitesProvider.getCurrentSiteUserId(),this.sitesProvider.getCurrentSite().invalidateWsCacheForKey(this.getCompletionCacheKey(e,t))},e.prototype.isPluginViewEnabled=function(){return this.sitesProvider.isLoggedIn()},e.prototype.isPluginViewEnabledForCourse=function(e,t){return void 0===t&&(t=!0),e?this.coursesProvider.getUserCourse(e,t).then(function(e){return!(e&&void 0!==e.enablecompletion&&0==e.enablecompletion)}):Promise.reject(null)},e.prototype.isPluginViewEnabledForUser=function(e,t){var n=this,o={emergencyCache:0};return this.getCompletion(e,t,o).then(function(){return!0}).catch(function(r){return!n.utils.isWebServiceError(r)&&(o.omitExpires=!0,n.getCompletion(e,t,o).then(function(){return!0}).catch(function(){return!1}))})},e.prototype.markCourseAsSelfCompleted=function(e){var t={courseid:e};return this.sitesProvider.getCurrentSite().write("core_completion_mark_course_self_completed",t).then(function(e){if(!e.status)return Promise.reject(null)})},e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(4),i=n(77),s=n(6),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.utils=e,this.mimeUtils=t,this.modalCtrl=n,this.possibleAudioMimeTypes={"audio/webm":"weba","audio/ogg":"ogg"},this.possibleVideoMimeTypes={"video/webm;codecs=vp9":"webm","video/webm;codecs=vp8":"webm","video/ogg":"ogv"},this.win=window}return e.prototype.captureMedia=function(e,t){t=t||{};try{var n=this.utils.promiseDefer(),o={type:e},r=void 0,i=void 0;if("video"==e)r=this.getMimeTypeAndExtension(e,t.mimetypes),o.mimetype=r.mimetype,o.extension=r.extension;else if("audio"==e)r=this.getMimeTypeAndExtension(e,t.mimetypes),o.mimetype=r.mimetype,o.extension=r.extension;else if("image"==e){if(void 0!==t.sourceType&&1!=t.sourceType)return Promise.reject("This source type is not supported in desktop.");1==t.cameraDirection&&(o.facingMode="user"),1==t.encodingType?(o.mimetype="image/png",o.extension="png"):(o.mimetype="image/jpeg",o.extension="jpeg"),t.quality>=0&&t.quality<=100&&(o.quality=t.quality/100),0==t.destinationType&&(o.returnDataUrl=!0)}return t.duration&&(o.maxTime=1e3*t.duration),(i=this.modalCtrl.create("CoreEmulatorCaptureMediaPage",o)).present(),i.onDidDismiss(function(e,t){"success"==t?n.resolve(e):n.reject(e)}),n.promise}catch(e){return Promise.reject(e.toString())}},e.prototype.getMimeTypeAndExtension=function(e,t){var n={};if(t&&t.length)for(var o=0;o<t.length;o++){var r=t[o],i=r.match(new RegExp("^"+e+"/"));if(i&&i.length&&this.win.MediaRecorder.isTypeSupported(r)){n.mimetype=r;break}}return n.mimetype?n.extension=this.mimeUtils.getExtension(n.mimetype):"video"==e?(n.mimetype=this.videoMimeType,n.extension=this.possibleVideoMimeTypes[n.mimetype]):"audio"==e&&(n.mimetype=this.audioMimeType,n.extension=this.possibleAudioMimeTypes[n.mimetype]),n},e.prototype.initGetUserMedia=function(){var e=this,t=navigator;if(void 0===t.mediaDevices&&(t.mediaDevices={}),!t.mediaDevices.getUserMedia){if(t.getUserMedia=t.getUserMedia||t.webkitGetUserMedia||t.mozGetUserMedia||t.msGetUserMedia,!t.getUserMedia)return!1;navigator.mediaDevices.getUserMedia=function(n){var o=e.utils.promiseDefer();return t.getUserMedia(n,o.resolve,o.reject),o.promise}}return!0},e.prototype.initMimeTypes=function(){for(var e in this.possibleVideoMimeTypes)if(this.win.MediaRecorder.isTypeSupported(e)){this.videoMimeType=e;break}for(var e in this.possibleAudioMimeTypes)if(this.win.MediaRecorder.isTypeSupported(e)){this.audioMimeType=e;break}},e.prototype.load=function(){return void 0!==this.win.MediaRecorder&&this.initGetUserMedia()&&this.initMimeTypes(),Promise.resolve()},e=a([Object(o.A)(),c("design:paramtypes",[s.a,i.a,r.o])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(144),i=n(27),s=n(18),a=n(7),c=n(2),u=n(8),d=n(11),l=n(6),f=n(10),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,o,r,i,s,a,c){this.sitesProvider=t,this.textUtils=n,this.fileProvider=o,this.filepoolProvider=r,this.http=i,this.utils=s,this.courseProvider=a,this.domUtils=c,this.ROOT_CACHE_KEY="mmaModBook:",this.logger=e.getInstance("AddonModBookProvider")}return t=e,e.prototype.getBook=function(e,t,n){return this.getBookByField(e,"coursemodule",t,n)},e.prototype.getBookByField=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getBookDataCacheKey(e)};return o.read("mod_book_get_books_by_courses",i,s).then(function(e){if(e&&e.books)for(var o in e.books){var r=e.books[o];if(r[t]==n)return r}return Promise.reject(null)})})},e.prototype.getBookDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"book:"+e},e.prototype.getChapterContent=function(e,n,o){var r=this,i=e[n]?e[n].indexUrl:void 0,s=this.sitesProvider.getCurrentSiteId();return i?this.fileProvider.isAvailable()?this.filepoolProvider.downloadUrl(s,i,!1,t.COMPONENT,o).then(function(t){return r.http.get(t).toPromise().then(function(t){var o=t.text();return"string"!=typeof o?Promise.reject(null):r.domUtils.restoreSourcesInHtml(o,e[n].paths)})}):Promise.resolve(this.sitesProvider.getCurrentSite().fixPluginfileURL(i)):(this.logger.debug("Could not locate the index chapter"),Promise.reject(null))},e.prototype.getContentsMap=function(e){var t=this,n={};return e?(e.forEach(function(e){if(t.isFileDownloadable(e)){var o=void 0,r=void 0,i=void 0,s=void 0;(r=e.filepath.match(/\/(\d+)\//))&&r[1]&&(i=e.filepath=="/"+(o=r[1])+"/",n[o]=n[o]||{paths:{}},"index.html"==e.filename&&i?n[o].indexUrl=e.fileurl:(s=i?e.fileurl.split("mod_book/chapter"+e.filepath)[1]||e.filename:e.filepath.replace("/"+o+"/","")+e.filename,n[o].paths[t.textUtils.decodeURIComponent(s)]=e.fileurl))}}),n):n},e.prototype.getFirstChapter=function(e){if(e&&e.length)return e[0].id},e.prototype.getNextChapter=function(e,t){for(var n="0",o=0;o<e.length;o++)if(e[o].id==t&&void 0!==e[o+1]){n=e[o+1].id;break}return n},e.prototype.getPreviousChapter=function(e,t){for(var n="0",o=0;o<e.length&&e[o].id!=t;o++)n=e[o].id;return n},e.prototype.getToc=function(e){return e&&e.length?this.textUtils.parseJSON(e[0].content,[]):[]},e.prototype.getTocList=function(e){var t=[];return this.getToc(e).forEach(function(e){var n=e.href.replace("/index.html","");t.push({id:n,title:e.title,level:e.level}),e.subitems&&e.subitems.forEach(function(e){n=e.href.replace("/index.html",""),t.push({id:n,title:e.title,level:e.level})})}),t},e.prototype.invalidateBookData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getBookDataCacheKey(e))})},e.prototype.invalidateContent=function(e,n,o){o=o||this.sitesProvider.getCurrentSiteId();var r=[];return r.push(this.invalidateBookData(n,o)),r.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),r.push(this.courseProvider.invalidateModule(e,o)),this.utils.allPromises(r)},e.prototype.isFileDownloadable=function(e){return"file"===e.type},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canDownloadFiles()})},e.prototype.logView=function(e,t){var n={bookid:e,chapterid:t};return this.sitesProvider.getCurrentSite().write("mod_book_view_book",n)},e.COMPONENT="mmaModBook",e=t=p([Object(o.A)(),h("design:paramtypes",[a.a,c.a,d.a,i.a,s.a,r.a,l.a,f.a,u.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(2),i=n(6),s=n(9),a=n(18),c=n(229),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r){this.sitesProvider=e,this.appProvider=t,this.filepoolProvider=n,this.utils=o,this.choiceOffline=r,this.ROOT_CACHE_KEY="mmaModChoice:"}return t=e,e.prototype.canStudentSeeResults=function(e,n){var o=(new Date).getTime();return e.showresults===t.RESULTS_ALWAYS||e.showresults===t.RESULTS_AFTER_CLOSE&&0!==e.timeclose&&e.timeclose<=o||e.showresults===t.RESULTS_AFTER_ANSWER&&n},e.prototype.deleteResponses=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId(),o=o||[];var s=function(){return i.choiceOffline.saveResponse(e,t,n,o,!0,r).then(function(){return!1})};return this.appProvider.isOnline()?this.choiceOffline.deleteResponse(e,r).then(function(){return i.deleteResponsesOnline(e,o,r).then(function(){return!0}).catch(function(e){return i.utils.isWebServiceError(e)?Promise.reject(e):s()})}):s()},e.prototype.deleteResponsesOnline=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_choice_delete_choice_responses",{choiceid:e,responses:t}).then(function(t){if(!t||!1===t.status)return Promise.reject(o.utils.createFakeWSError(""));var r=[o.invalidateOptions(e,n.id),o.invalidateResults(e,n.id)];return Promise.all(r).catch(function(){})})})},e.prototype.getChoiceDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"choice:"+e},e.prototype.getChoiceOptionsCacheKey=function(e){return this.ROOT_CACHE_KEY+"options:"+e},e.prototype.getChoiceResultsCacheKey=function(e){return this.ROOT_CACHE_KEY+"results:"+e},e.prototype.getChoiceByDataKey=function(e,t,n,o,r){var i=this;return void 0===r&&(r=!1),this.sitesProvider.getSite(e).then(function(e){var s={courseids:[t]},a={cacheKey:i.getChoiceDataCacheKey(t),omitExpires:r};return e.read("mod_choice_get_choices_by_courses",s,a).then(function(e){if(e&&e.choices){var t=e.choices.find(function(e){return e[n]==o});if(t)return t}return Promise.reject(null)})})},e.prototype.getChoice=function(e,t,n,o){return void 0===o&&(o=!1),this.getChoiceByDataKey(n,e,"coursemodule",t,o)},e.prototype.getChoiceById=function(e,t,n,o){return void 0===o&&(o=!1),this.getChoiceByDataKey(n,e,"id",t,o)},e.prototype.getOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={choiceid:e},r={cacheKey:n.getChoiceOptionsCacheKey(e)};return t.read("mod_choice_get_choice_options",o,r).then(function(e){return e.options?e.options:Promise.reject(null)})})},e.prototype.getResults=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={choiceid:e},r={cacheKey:n.getChoiceResultsCacheKey(e)};return t.read("mod_choice_get_choice_results",o,r).then(function(e){return e.options?e.options:Promise.reject(null)})})},e.prototype.invalidateChoiceData=function(e,t){var n=this;return this.sitesProvider.getSite(null).then(function(t){return t.invalidateWsCacheForKey(n.getChoiceDataCacheKey(e))})},e.prototype.invalidateContent=function(e,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=[];return i.push(this.getChoice(n,e).then(function(e){return Promise.all([r.invalidateChoiceData(n),r.invalidateOptions(e.id),r.invalidateResults(e.id)])})),i.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),this.utils.allPromises(i)},e.prototype.invalidateOptions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getChoiceOptionsCacheKey(e))})},e.prototype.invalidateResults=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getChoiceResultsCacheKey(e))})},e.prototype.logView=function(e){var t={choiceid:e};return this.sitesProvider.getCurrentSite().write("mod_choice_view_choice",t)},e.prototype.submitResponse=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId();var s=function(){return i.choiceOffline.saveResponse(e,t,n,o,!1,r).then(function(){return!1})};return this.appProvider.isOnline()?this.choiceOffline.deleteResponse(e,r).then(function(){return i.submitResponseOnline(e,o,r).then(function(){return!0}).catch(function(e){return i.utils.isWebServiceError(e)?Promise.reject(e):s()})}):s()},e.prototype.submitResponseOnline=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(r){return r.write("mod_choice_submit_choice_response",{choiceid:e,responses:t}).then(function(){var t=[o.invalidateOptions(e,n),o.invalidateResults(e,n)];return Promise.all(t).catch(function(){})})})},e.COMPONENT="mmaModChoice",e.RESULTS_NOT=0,e.RESULTS_AFTER_ANSWER=1,e.RESULTS_AFTER_CLOSE=2,e.RESULTS_ALWAYS=3,e.PUBLISH_ANONYMOUS=!1,e.PUBLISH_NAMES=!0,e=t=u([Object(o.A)(),d("design:paramtypes",[r.a,s.a,a.a,i.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(2),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.sitesProvider=e,this.tablesSchema=[{name:t.CHOICE_TABLE,columns:[{name:"choiceid",type:"INTEGER"},{name:"name",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"responses",type:"TEXT"},{name:"deleting",type:"INTEGER"},{name:"timecreated",type:"INTEGER"}],primaryKeys:["choiceid","userid"]}],this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteResponse=function(e,n,o){return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().deleteRecords(t.CHOICE_TABLE,{choiceid:e,userid:o})})},e.prototype.getResponses=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.CHOICE_TABLE).then(function(e){return e.forEach(function(e){e.responses=JSON.parse(e.responses)}),e})})},e.prototype.hasResponse=function(e,t,n){return this.getResponse(e,t,n).then(function(e){return!!e.choiceid}).catch(function(e){return!1})},e.prototype.getResponse=function(e,n,o){return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().getRecord(t.CHOICE_TABLE,{choiceid:e,userid:o}).then(function(e){return e.responses=JSON.parse(e.responses),e})})},e.prototype.saveResponse=function(e,n,o,r,i,s,a){return this.sitesProvider.getSite(s).then(function(s){var c={choiceid:e,name:n,courseid:o,userid:a||s.getUserId(),responses:JSON.stringify(r),deleting:i?1:0,timecreated:(new Date).getTime()};return s.getDb().insertRecord(t.CHOICE_TABLE,c)})},e.CHOICE_TABLE="addon_mod_choice_responses",e=t=i([Object(o.A)(),s("design:paramtypes",[r.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(7),i=n(69),s=n(2),a=n(9),c=n(6),u=n(11),d=n(229),l=n(228),f=n(12),p=n(1),h=n(10),m=n(45),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,"AddonModChoiceSyncProvider",n,t,o,l,u,a)||this;return f.sitesProvider=t,f.appProvider=o,f.choiceOffline=r,f.eventsProvider=i,f.choiceProvider=s,f.utils=c,f.textUtils=u,f.componentTranslate=d.translateModuleName("choice"),f}return g(t,e),n=t,t.prototype.getSyncId=function(e,t){return e+"#"+t},t.prototype.syncAllChoices=function(e){return this.syncOnSites("choices",this.syncAllChoicesFunc.bind(this),void 0,e)},t.prototype.syncAllChoicesFunc=function(e){var t=this;return this.choiceOffline.getResponses(e).then(function(o){var r=[];o.forEach(function(o){r.push(t.syncChoiceIfNeeded(o.choiceid,o.userid,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{choiceId:o.choiceid,userId:o.userid,warnings:r.warnings},e)}))})})},t.prototype.syncChoiceIfNeeded=function(e,t,n){var o=this,r=this.getSyncId(e,t);return this.isSyncNeeded(r,n).then(function(r){if(r)return o.syncChoice(e,t,n)})},t.prototype.syncChoice=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getSyncId(e,t);if(this.isSyncing(r,n))return this.getOngoingSync(r,n);this.logger.debug("Try to sync choice '"+e+"' for user '"+t+"'");var i,s={warnings:[],updated:!1},a=this.choiceOffline.getResponse(e,n,t).catch(function(){return{}}).then(function(r){if(r.choiceid){if(!o.appProvider.isOnline())return Promise.reject(null);i=r.courseid;return(r.deleting?o.choiceProvider.deleteResponsesOnline(e,r.responses,n):o.choiceProvider.submitResponseOnline(e,r.responses,n)).then(function(){return s.updated=!0,o.choiceOffline.deleteResponse(e,n,t)}).catch(function(i){return o.utils.isWebServiceError(i)?(s.updated=!0,o.choiceOffline.deleteResponse(e,n,t).then(function(){s.warnings.push(o.translate.instant("core.warningofflinedatadeleted",{component:o.componentTranslate,name:r.name,error:i.error}))})):Promise.reject(i)})}}).then(function(){if(i){var t=[o.choiceProvider.invalidateChoiceData(i),e?o.choiceProvider.invalidateOptions(e):Promise.resolve(),e?o.choiceProvider.invalidateResults(e):Promise.resolve()];return Promise.all(t).then(function(){return o.choiceProvider.getChoiceById(i,e,n)}).catch(function(){})}}).then(function(){return o.setSyncTime(r,n)}).then(function(){return s});return this.addOngoingSync(r,a,n)},t.AUTO_SYNCED="addon_mod_choice_autom_synced",t=n=y([Object(o.A)(),v("design:paramtypes",[s.a,r.a,a.a,d.a,f.a,l.a,p.c,c.a,u.a,h.a,m.a])],t);var n}(i.a)},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(31),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.courseHelper=t,s.domUtils=n,s.sitesProvider=o,s.addon=r,s.modName=i,s.pattern=new RegExp("/mod/"+i+"/grade.php.*([&?]id=\\d+)"),s.featureName="CoreCourseModuleDelegate_"+r,s}return r(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,i){var s=r.domUtils.showModalLoading();r.sitesProvider.getSite(e).then(function(s){n.userid&&n.userid!=s.getUserId()?r.canReview?r.goToReview(t,n,o,e,i):s.openInBrowserWithAutoLogin(t):r.courseHelper.navigateToModule(parseInt(n.id,10),e,o)}).finally(function(){s.dismiss()})}}]},t.prototype.goToReview=function(e,t,n,o,r){return Promise.resolve()},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(11),a=n(22),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,n,o,r){this.sitesProvider=n,this.textUtils=o,this.timeUtils=r,this.tablesSchema=[{name:t.FEEDBACK_TABLE,columns:[{name:"feedbackid",type:"INTEGER"},{name:"page",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"responses",type:"TEXT"},{name:"timemodified",type:"INTEGER"}],primaryKeys:["feedbackid","page"]}],this.logger=e.getInstance("AddonModFeedbackOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteFeedbackPageResponses=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){return o.getDb().deleteRecords(t.FEEDBACK_TABLE,{feedbackid:e,page:n})})},e.prototype.getAllFeedbackResponses=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.FEEDBACK_TABLE).then(function(e){return e.forEach(function(e){e.responses=n.textUtils.parseJSON(e.responses)}),e})})},e.prototype.getFeedbackResponses=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.FEEDBACK_TABLE,{feedbackid:e})}).then(function(e){return e.forEach(function(e){e.responses=o.textUtils.parseJSON(e.responses)}),e})},e.prototype.getFeedbackPageResponses=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return o.getDb().getRecord(t.FEEDBACK_TABLE,{feedbackid:e,page:n})}).then(function(e){return e.responses=r.textUtils.parseJSON(e.responses),e})},e.prototype.hasFeedbackOfflineData=function(e,t){return this.getFeedbackResponses(e,t).then(function(e){return!!e.length})},e.prototype.saveResponses=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a={feedbackid:e,page:n,courseid:r,responses:JSON.stringify(o),timemodified:s.timeUtils.timestamp()};return i.getDb().insertRecord(t.FEEDBACK_TABLE,a)})},e.FEEDBACK_TABLE="addon_mod_feedback_answers",e=t=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(9),i=n(18),s=n(2),a=n(11),c=n(6),u=n(10),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.appProvider=e,this.courseProvider=t,this.filepoolProvider=n,this.sitesProvider=o,this.textUtils=r,this.utils=i,this.ROOT_CACHE_KEY="mmaModImscp:"}return t=e,e.prototype.getToc=function(e){return e&&e.length?JSON.parse(e[0].content):[]},e.prototype.createItemList=function(e){var t=[];return this.getToc(e).forEach(function(e){t.push({href:e.href,title:e.title,level:e.level}),e.subitems.forEach(function(e){t.push({href:e.href,title:e.title,level:e.level})})}),t},e.prototype.getPreviousItem=function(e,t){var n=this.getItemPosition(e,t);if(-1!=n)for(var o=n-1;o>=0;o--)if(e[o]&&e[o].href)return e[o].href;return""},e.prototype.getNextItem=function(e,t){var n=this.getItemPosition(e,t);if(-1!=n)for(var o=n+1;o<e.length;o++)if(e[o]&&e[o].href)return e[o].href;return""},e.prototype.getItemPosition=function(e,t){for(var n=0;n<e.length;n++)if(e[n].href==t)return n;return-1},e.prototype.checkSpecialFiles=function(e){return"imsmanifest.xml"==e},e.prototype.getImscpDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"imscp:"+e},e.prototype.getImscpByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getImscpDataCacheKey(e)};return o.read("mod_imscp_get_imscps_by_courses",i,s).then(function(e){if(e&&e.imscps){var o=e.imscps.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getImscp=function(e,t,n){return this.getImscpByKey(e,"coursemodule",t,n)},e.prototype.getFileUrlFromContents=function(e,t){var n,o=this;return e.forEach(function(e){if("file"==e.type&&!n){var r=o.textUtils.concatenatePaths(e.filepath,e.filename),i="/"===r.charAt(0)?r.substr(1):"/"+r;r!==t&&i!==t||(n=e.fileurl)}}),n},e.prototype.getIframeSrc=function(e,t){var n=this;if(!t){var o=this.getToc(e.contents);if(!o.length)return Promise.reject(null);t=o[0].href}var r=this.sitesProvider.getCurrentSiteId();return this.filepoolProvider.getPackageDirUrlByUrl(r,e.url).then(function(e){return n.textUtils.concatenatePaths(e,t)}).catch(function(){if(n.appProvider.isOnline()){var o=n.getFileUrlFromContents(e.contents,t);if(o)return n.sitesProvider.getSite(r).then(function(e){return e.fixPluginfileURL(o)})}return Promise.reject(null)})},e.prototype.invalidateContent=function(e,n,o){o=o||this.sitesProvider.getCurrentSiteId();var r=[];return r.push(this.invalidateImscpData(n,o)),r.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),r.push(this.courseProvider.invalidateModule(e,o)),this.utils.allPromises(r)},e.prototype.invalidateImscpData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getImscpDataCacheKey(e))})},e.prototype.isFileDownloadable=function(e){return"file"===e.type&&!this.checkSpecialFiles(e.filename)},e.prototype.isPluginEnabled=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.canDownloadFiles()})},e.prototype.logView=function(e){var t={imscpid:e};return this.sitesProvider.getCurrentSite().write("mod_imscp_view_imscp",t)},e.COMPONENT="mmaModImscp",e=t=d([Object(o.A)(),l("design:paramtypes",[r.a,u.a,i.a,s.a,a.a,c.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(8),i=n(10),s=n(21),a=n(191),c=n(2),u=n(18),d=n(27),l=n(9),f=n(77),p=n(11),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,r,i,s,a,c,u){this.courseProvider=e,this.domUtils=t,this.resourceProvider=n,this.courseHelper=o,this.textUtils=r,this.mimetypeUtils=i,this.fileProvider=s,this.appProvider=a,this.filepoolProvider=c,this.sitesProvider=u,this.DISPLAY_AUTO=0,this.DISPLAY_EMBED=1}return e.prototype.getEmbeddedHtml=function(e,t){var n=this;return this.courseHelper.downloadModuleWithMainFileIfNeeded(e,t,a.a.COMPONENT,e.id,e.contents).then(function(t){var o=e.contents[0],r=n.mimetypeUtils.getFileExtension(o.filename),i=n.mimetypeUtils.getExtensionType(r),s=n.mimetypeUtils.getMimeType(r);return"image"==i?'<img src="'+t.path+'"></img>':"audio"==i||"video"==i?"<"+i+' controls title="'+o.filename+'"" src="'+t.path+'"><source src="'+t.path+'" type="'+s+'"></'+i+">":""})},e.prototype.getIframeSrc=function(e){var t=this;if(!e.contents.length)return Promise.reject(null);var n=e.contents[0],o=n.filename;return"/"!==n.filepath&&(o=n.filepath.substr(1)+o),this.filepoolProvider.getPackageDirUrlByUrl(this.sitesProvider.getCurrentSiteId(),e.url).then(function(e){return t.textUtils.concatenatePaths(e,o)}).catch(function(){return t.appProvider.isOnline()&&n.fileurl?Promise.resolve(t.sitesProvider.getCurrentSite().fixPluginfileURL(n.fileurl)):Promise.reject(null)})},e.prototype.isDisplayedEmbedded=function(e,t){if(!e.contents.length||!this.fileProvider.isAvailable())return!1;var n=this.mimetypeUtils.getFileExtension(e.contents[0].filename);return(t==this.DISPLAY_EMBED||t==this.DISPLAY_AUTO)&&this.mimetypeUtils.canBeEmbedded(n)},e.prototype.isDisplayedInIframe=function(e){if(!e.contents.length||!this.fileProvider.isAvailable())return!1;var t=this.mimetypeUtils.getFileExtension(e.contents[0].filename);return"text/html"==this.mimetypeUtils.getMimeType(t)},e.prototype.openModuleFile=function(e,t){var n=this,o=this.domUtils.showModalLoading();return this.courseHelper.downloadModuleAndOpenFile(e,t,a.a.COMPONENT,e.id,e.contents).then(function(){n.resourceProvider.logView(e.instance).then(function(){n.courseProvider.checkModuleCompletion(t,e.completionstatus)})}).catch(function(e){n.domUtils.showErrorModalDefault(e,"addon.mod_resource.errorwhileloadingthecontent",!0)}).finally(function(){o.dismiss()})},e=h([Object(o.A)(),m("design:paramtypes",[i.a,r.a,a.a,s.a,p.a,f.a,d.a,l.a,u.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(9),c=n(18),u=n(240),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.sitesProvider=t,this.appProvider=n,this.filepoolProvider=o,this.utils=r,this.surveyOffline=i,this.ROOT_CACHE_KEY="mmaModSurvey:",this.logger=e.getInstance("AddonModSurveyProvider")}return t=e,e.prototype.getQuestions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={surveyid:e},r={cacheKey:n.getQuestionsCacheKey(e)};return t.read("mod_survey_get_questions",o,r).then(function(e){return e.questions?e.questions:Promise.reject(null)})})},e.prototype.getQuestionsCacheKey=function(e){return this.ROOT_CACHE_KEY+"questions:"+e},e.prototype.getSurveyCacheKey=function(e){return this.ROOT_CACHE_KEY+"survey:"+e},e.prototype.getSurveyDataByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getSurveyCacheKey(e)};return o.read("mod_survey_get_surveys_by_courses",i,s).then(function(e){if(e&&e.surveys){var o=e.surveys.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getSurvey=function(e,t,n){return this.getSurveyDataByKey(e,"coursemodule",t,n)},e.prototype.getSurveyById=function(e,t,n){return this.getSurveyDataByKey(e,"id",t,n)},e.prototype.invalidateContent=function(e,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=[];return i.push(this.getSurvey(n,e).then(function(e){var t=[];return t.push(r.invalidateSurveyData(n,o)),t.push(r.invalidateQuestions(e.id,o)),Promise.all(t)})),i.push(this.filepoolProvider.invalidateFilesByComponent(o,t.COMPONENT,e)),this.utils.allPromises(i)},e.prototype.invalidateQuestions=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getQuestionsCacheKey(e))})},e.prototype.invalidateSurveyData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getSurveyCacheKey(e))})},e.prototype.logView=function(e){var t={surveyid:e};return this.sitesProvider.getCurrentSite().write("mod_survey_view_survey",t)},e.prototype.submitAnswers=function(e,t,n,o,r){var i=this,s=function(){return i.surveyOffline.saveAnswers(e,t,n,o,r).then(function(){return!1})};return r=r||this.sitesProvider.getCurrentSiteId(),this.appProvider.isOnline()?this.surveyOffline.deleteSurveyAnswers(e,r).then(function(){return i.submitAnswersOnline(e,o,r).then(function(){return!0}).catch(function(e){return i.utils.isWebServiceError(e)?Promise.reject(e):s()})}):s()},e.prototype.submitAnswersOnline=function(e,t,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){return n.write("mod_survey_submit_answers",{surveyid:e,answers:t}).then(function(e){if(!e.status)return Promise.reject(o.utils.createFakeWSError(""))})})},e.COMPONENT="mmaModSurvey",e=t=d([Object(o.A)(),l("design:paramtypes",[r.a,i.a,a.a,c.a,s.a,u.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(2),s=n(11),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,n,o){this.sitesProvider=n,this.textUtils=o,this.tablesSchema=[{name:t.SURVEY_TABLE,columns:[{name:"surveyid",type:"INTEGER"},{name:"name",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"answers",type:"TEXT"},{name:"timecreated",type:"INTEGER"}],primaryKeys:["surveyid","userid"]}],this.logger=e.getInstance("AddonModSurveyOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteSurveyAnswers=function(e,n,o){return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().deleteRecords(t.SURVEY_TABLE,{surveyid:e,userid:o})})},e.prototype.getAllData=function(e){var n=this;return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.SURVEY_TABLE).then(function(e){return e.forEach(function(e){e.answers=n.textUtils.parseJSON(e.answers)}),e})})},e.prototype.getSurveyAnswers=function(e,t,n){return this.getSurveyData(e,t,n).then(function(e){return e.answers||[]}).catch(function(){return[]})},e.prototype.getSurveyData=function(e,n,o){var r=this;return this.sitesProvider.getSite(n).then(function(n){return o=o||n.getUserId(),n.getDb().getRecord(t.SURVEY_TABLE,{surveyid:e,userid:o})}).then(function(e){return e.answers=r.textUtils.parseJSON(e.answers),e})},e.prototype.hasAnswers=function(e,t,n){return this.getSurveyAnswers(e,t,n).then(function(e){return!!e.length})},e.prototype.saveAnswers=function(e,n,o,r,i,s){return this.sitesProvider.getSite(i).then(function(i){s=s||i.getUserId();var a={surveyid:e,name:n,courseid:o,userid:s,answers:JSON.stringify(r),timecreated:(new Date).getTime()};return i.getDb().insertRecord(t.SURVEY_TABLE,a)})},e.SURVEY_TABLE="addon_mod_survey_answers",e=t=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return r([Object(o.D)(),i("design:type",Number)],e.prototype,"workshopId",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"assessment",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"edit",void 0),r([Object(o.D)(),i("design:type",Array)],e.prototype,"selectedValues",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"fieldErrors",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"strategy",void 0),e}()},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(902),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldTextHandler",this.type="text"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;return!!t[o]&&[{fieldid:e.id,value:t[o]}]},e.prototype.hasFieldDataChanged=function(e,t,n){return n=n&&n.content||"",(t["f_"+e.id]||"")!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[""]||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n){return e.call(this,t,"AddonQtypeMultichoiceComponent",n)||this}return s(t,e),t.prototype.ngOnInit=function(){this.initMultichoiceComponent()},t=a([Object(o.m)({selector:"addon-qtype-multichoice",template:'<section ion-list *ngIf="question.text || question.text === \'\'">\n    \x3c!-- Question text first. --\x3e\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n        <p *ngIf="question.prompt"><core-format-text [component]="component" [componentId]="componentId" [text]="question.prompt"></core-format-text></p>\n    </ion-item>\n\n    \x3c!-- Checkbox for multiple choice. --\x3e\n    <ng-container *ngIf="question.multi">\n        <ion-item text-wrap *ngFor="let option of question.options" [ngClass]="{\'core-question-answer-correct\': option.isCorrect === 1, \'core-question-answer-incorrect\': option.isCorrect === 0}">\n            <ion-label>\n                <core-format-text [component]="component" [componentId]="componentId" [text]="option.text"></core-format-text>\n                <p *ngIf="option.feedback" class="core-question-feedback-container"><core-format-text [component]="component" [componentId]="componentId" [text]="option.feedback"></core-format-text></p>\n            </ion-label>\n            <ion-checkbox [attr.name]="option.name" [(ngModel)]="option.checked" [disabled]="option.disabled" item-end></ion-checkbox>\n\n            \x3c!-- ion-checkbox doesn\'t use an input. Create a hidden input to hold the value. --\x3e\n            <input item-content type="hidden" [ngModel]="option.checked" [attr.name]="option.name">\n        </ion-item>\n    </ng-container>\n\n    \x3c!-- Radio buttons for single choice. --\x3e\n    <div *ngIf="!question.multi" radio-group [(ngModel)]="question.singleChoiceModel" [name]="question.optionsName">\n        <ion-item text-wrap *ngFor="let option of question.options" [ngClass]=\'{"core-question-answer-correct": option.isCorrect === 1, "core-question-answer-incorrect": option.isCorrect === 0}\'>\n            <ion-label>\n                <core-format-text [component]="component" [componentId]="componentId" [text]="option.text"></core-format-text>\n                <p *ngIf="option.feedback" class="core-question-feedback-container"><core-format-text [component]="component" [componentId]="componentId" [text]="option.feedback"></core-format-text></p>\n            </ion-label>\n            <ion-radio [value]="option.value" [disabled]="option.disabled"></ion-radio>\n        </ion-item>\n\n        \x3c!-- ion-radio doesn\'t use an input. Create a hidden input to hold the selected value. --\x3e\n        <input type="hidden" [ngModel]="question.singleChoiceModel" [attr.name]="question.optionsName">\n    </div>\n</section>\n'}),c("design:paramtypes",[r.a,o.C])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(86),i=n(26),s=n(11),a=n(1),c=n(5),u=(n.n(c),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o){this.feedbackProvider=e,this.userProvider=t,this.textUtils=n,this.translate=o,this.MODE_RESPONSETIME=1,this.MODE_COURSE=2,this.MODE_CATEGORY=3}return e.prototype.getActivityHistoryBackCounter=function(e,t,n,o,r){for(var i,s,a=r.getActive();!a.isFirst()&&a.name.startsWith(o)&&(s=a.getNavParams(),(i=s.get(n)?s.get(n):s.get("module").instance)&&i==t);){if(a.name==e)return a.index;a=r.getPrevious(a)}return 0},e.prototype.getNonRespondents=function(e,t,n){var o=this;return this.feedbackProvider.getNonRespondents(e,t,n).then(function(e){return o.addImageProfileToAttempts(e.users).then(function(t){return e.users=t,e})})},e.prototype.getPageItemsResponses=function(e){var t={};return e.forEach(function(e){var n=!1;if(e.hasError=!1,"captcha"==e.typ){var o=e.value||"";n=!!o,t[e.typ+"_"+e.id]=1,t["g-recaptcha-response"]=o,t.recaptcha_element="dummyvalue",e.isEmpty=!(!e.required||n)}else if(e.hasvalue){var r,i,s=e.typ+"_"+e.id;"multichoice"==e.typ&&"c"==e.subtype?(t[r=s+"[0]"]=0,e.choices.forEach(function(e,o){r=s+"["+(o+1)+"]",i=e.checked?e.value:0,!n&&i&&(n=!0),t[r]=i})):(r="multichoice"==e.typ?s+"[0]":s,"multichoice"==e.typ||"multichoicerated"==e.typ?i=e.value||0:"numeric"==e.typ?""!=(i=e.value||0==e.value?e.value:"")&&(""!=e.rangefrom&&i<e.rangefrom||""!=e.rangeto&&i>e.rangeto)&&(e.hasError=!0):i=e.value||0==e.value?e.value:"",n=!!i,t[r]=i),e.isEmpty=!(!e.required||n)}}),t},e.prototype.getResponsesAnalysis=function(e,t,n){var o=this;return this.feedbackProvider.getResponsesAnalysis(e,t,n).then(function(e){return o.addImageProfileToAttempts(e.attempts).then(function(t){return e.attempts=t,e})})},e.prototype.addImageProfileToAttempts=function(e){var t=this,n=e.map(function(e){return t.userProvider.getProfile(e.userid,e.courseid,!0).then(function(t){e.profileimageurl=t.profileimageurl}).catch(function(){})});return Promise.all(n).then(function(){return e})},e.prototype.openFeature=function(e,t,n,o,r){void 0===r&&(r=0);var i=e&&"analysis"!=e?"AddonModFeedback"+e+"Page":"AddonModFeedbackIndexPage",s=0,a={module:n,moduleId:n.id,courseId:o,feedbackId:n.instance,group:r};return"AddonModFeedbackIndexPage"==i&&(a.tab="analysis"==e?"analysis":"overview",s=this.getActivityHistoryBackCounter(i,n.instance,"feedbackId","AddonModFeedback",t)),s>0?t.remove(t.getActive().index,s):t.push(i,a)},e.prototype.getItemFormLabel=function(e){return e.template="label",e.name="",e.presentation=this.textUtils.replacePluginfileUrls(e.presentation,e.itemfiles),e},e.prototype.getItemFormInfo=function(e){e.template="label";var t=parseInt(e.presentation,10);if(t==this.MODE_COURSE||t==this.MODE_CATEGORY)e.presentation=e.otherdata,e.value=void 0!==e.rawValue?e.rawValue:e.otherdata;else{if(t!=this.MODE_RESPONSETIME)return!1;e.value="__CURRENT__TIMESTAMP__";var n=void 0!==e.rawValue?1e3*e.rawValue:(new Date).getTime();e.presentation=c(n).format("LLL")}return e},e.prototype.getItemFormNumeric=function(e){e.template="numeric";var t=e.presentation.split(r.a.LINE_SEP)||[];return e.rangefrom=t.length>0?parseInt(t[0],10)||"":"",e.rangeto=t.length>1?parseInt(t[1],10)||"":"",e.value=void 0!==e.rawValue?parseFloat(e.rawValue):"",e},e.prototype.getItemFormTextfield=function(e){return e.template="textfield",e.length=e.presentation.split(r.a.LINE_SEP)[1]||255,e.value=void 0!==e.rawValue?e.rawValue:"",e},e.prototype.getItemFormTextarea=function(e){return e.template="textarea",e.value=void 0!==e.rawValue?e.rawValue:"",e},e.prototype.getItemFormMultichoice=function(e){var t=e.presentation.split(r.a.MULTICHOICE_TYPE_SEP)||[];if(e.subtype=t.length>0&&t[0]?t[0]:"r",e.template="multichoice-"+e.subtype,e.presentation=t.length>1?t[1]:"","d"!=e.subtype&&(t=e.presentation.split(r.a.MULTICHOICE_ADJUST_SEP)||[],e.presentation=t.length>0?t[0]:""),e.choices=e.presentation.split(r.a.LINE_SEP)||[],e.choices=e.choices.map(function(e,t){var n=e.split(r.a.MULTICHOICERATED_VALUE_SEP)||[""];return e=1==n.length?n[0]:"("+n[0]+") "+n[1],{value:t+1,label:e}}),"r"===e.subtype&&-1==e.options.search(r.a.MULTICHOICE_HIDENOSELECT))e.choices.unshift({value:0,label:this.translate.instant("addon.mod_feedback.not_selected")}),e.value=void 0!==e.rawValue?parseInt(e.rawValue,10):0;else if("d"===e.subtype)e.choices.unshift({value:0,label:""}),e.value=void 0!==e.rawValue?parseInt(e.rawValue,10):0;else if("c"===e.subtype)if(void 0===e.rawValue)e.value="";else{e.rawValue=""+e.rawValue;var n=e.rawValue.split(r.a.LINE_SEP);e.choices.forEach(function(e){for(var t in n)if(e.value==n[t])return void(e.checked=!0)})}else e.value=void 0!==e.rawValue?parseInt(e.rawValue,10):"";return e},e.prototype.getItemFormCaptcha=function(e){var t=this.textUtils.parseJSON(e.otherdata);return t&&t.length>3&&(e.captcha={recaptchapublickey:t[3]}),e.template="captcha",e.value="",e},e.prototype.getItemForm=function(e,t){switch(e.typ){case"label":return this.getItemFormLabel(e);case"info":return this.getItemFormInfo(e);case"numeric":return this.getItemFormNumeric(e);case"textfield":return this.getItemFormTextfield(e);case"textarea":return this.getItemFormTextarea(e);case"multichoice":case"multichoicerated":return this.getItemFormMultichoice(e);case"pagebreak":if(!t)return!1;break;case"captcha":return this.getItemFormCaptcha(e);default:return!1}return e},e=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,s.a,a.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(7),i=n(2),s=n(41),a=n(22),c=n(46),u=n(30),d=n(78),l=n(105),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,n,o,r,i,s,a){this.sitesProvider=n,this.groupsProvider=o,this.coursesProvider=r,this.timeUtils=i,this.localNotificationsProvider=s,this.configProvider=a,this.ROOT_CACHE_KEY="mmaCalendar:",this.tablesSchema=[{name:t.EVENTS_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"notificationtime",type:"INTEGER"},{name:"name",type:"TEXT",notNull:!0},{name:"description",type:"TEXT"},{name:"format",type:"INTEGER"},{name:"eventtype",type:"TEXT"},{name:"courseid",type:"INTEGER"},{name:"timestart",type:"INTEGER"},{name:"timeduration",type:"INTEGER"},{name:"categoryid",type:"INTEGER"},{name:"groupid",type:"INTEGER"},{name:"userid",type:"INTEGER"},{name:"instance",type:"INTEGER"},{name:"modulename",type:"TEXT"},{name:"timemodified",type:"INTEGER"},{name:"repeatid",type:"INTEGER"},{name:"visible",type:"INTEGER"},{name:"uuid",type:"TEXT"},{name:"sequence",type:"INTEGER"},{name:"subscriptionid",type:"INTEGER"}]}],this.logger=e.getInstance("AddonCalendarProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.getAllEventsFromLocalDb=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.EVENTS_TABLE)})},e.prototype.getDefaultNotificationTime=function(e){e=e||this.sitesProvider.getCurrentSiteId();return this.configProvider.get(t.DEFAULT_NOTIFICATION_TIME_SETTING+"#"+e,t.DEFAULT_NOTIFICATION_TIME)},e.prototype.getEvent=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={cacheKey:n.getEventCacheKey(e)};return t.read("core_calendar_get_calendar_events",{options:{userevents:0,siteevents:0},events:{eventids:[e]}},o).then(function(t){return t.events.find(function(t){return t.id==e})||n.getEventFromLocalDb(e)}).catch(function(){return n.getEventFromLocalDb(e)})})},e.prototype.getEventCacheKey=function(e){return this.ROOT_CACHE_KEY+"events:"+e},e.prototype.getEventFromLocalDb=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecord(t.EVENTS_TABLE,{id:e})})},e.prototype.getEventNotificationTime=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.getEventNotificationTimeOption(e,t).then(function(e){return-1==e?n.getDefaultNotificationTime(t):e})},e.prototype.getEventNotificationTimeOption=function(e,t){return this.getEventFromLocalDb(e,t).then(function(e){return e.notificationtime||-1}).catch(function(){return-1})},e.prototype.getEventsList=function(e,n,o){var r=this;return void 0===e&&(e=0),void 0===n&&(n=t.DAYS_INTERVAL),this.sitesProvider.getSite(o).then(function(t){return o=t.getId(),r.coursesProvider.getUserCourses(!1,o).then(function(i){return i.push({id:t.getSiteHomeId()}),r.groupsProvider.getUserGroups(i,o).then(function(s){var a=r.timeUtils.timestamp()+u.a.SECONDS_DAY*e,c={options:{userevents:1,siteevents:1,timestart:a,timeend:a+u.a.SECONDS_DAY*n},events:{courseids:[],groupids:[]}};i.forEach(function(e,t){c.events.courseids[t]=e.id}),s.forEach(function(e,t){c.events.groupids[t]=e.id});var d={cacheKey:r.getEventsListCacheKey(e,n),getCacheUsingCacheKey:!0};return t.read("core_calendar_get_calendar_events",c,d).then(function(e){return r.storeEventsInLocalDB(e.events,o),e.events})})})})},e.prototype.getEventsListPrefixCacheKey=function(){return this.ROOT_CACHE_KEY+"events:"},e.prototype.getEventsListCacheKey=function(e,t){return this.getEventsListPrefixCacheKey()+e+":"+t},e.prototype.invalidateEventsList=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(o){t=o.getId();var r=[];return r.push(n.coursesProvider.invalidateUserCourses(t)),r.push(n.groupsProvider.invalidateUserGroups(e,t)),r.push(o.invalidateWsCacheForKeyStartingWith(n.getEventsListPrefixCacheKey())),Promise.all(r)})},e.prototype.invalidateEvent=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getEventCacheKey(e))})},e.prototype.isCalendarDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_AddonCalendar")},e.prototype.isDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isCalendarDisabledInSite(e)})},e.prototype.scheduleAllSitesEventsNotifications=function(){var e=this;return this.localNotificationsProvider.isAvailable()?this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.isDisabled(t).then(function(n){if(!n)return e.getEventsList(void 0,void 0,t).then(function(n){return e.scheduleEventsNotifications(n,t)})}))}),Promise.all(n)}):Promise.resolve([])},e.prototype.scheduleEventNotification=function(e,n,o){var r=this;if(this.localNotificationsProvider.isAvailable()){if(o=o||this.sitesProvider.getCurrentSiteId(),0===n)return this.localNotificationsProvider.cancel(e.id,t.COMPONENT,o);return(-1==n?this.getDefaultNotificationTime(o):Promise.resolve(n)).then(function(n){if(1e3*(e.timestart+e.timeduration)<=(new Date).getTime())return Promise.resolve();var i=new Date(1e3*(e.timestart-60*n)),s=new Date(1e3*e.timestart),a={id:e.id,title:e.name,text:s.toLocaleString(),at:i,data:{eventid:e.id,siteid:o}};return r.localNotificationsProvider.schedule(a,t.COMPONENT,o)})}return Promise.resolve()},e.prototype.scheduleEventsNotifications=function(e,t){var n=this,o=[];return this.localNotificationsProvider.isAvailable()&&(t=t||this.sitesProvider.getCurrentSiteId(),e.forEach(function(e){o.push(n.getEventNotificationTime(e.id,t).then(function(o){return n.scheduleEventNotification(e,o,t)}))})),Promise.all(o)},e.prototype.setDefaultNotificationTime=function(e,n){n=n||this.sitesProvider.getCurrentSiteId();return this.configProvider.set(t.DEFAULT_NOTIFICATION_TIME_SETTING+"#"+n,e)},e.prototype.storeEventInLocalDb=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().insertRecord(t.EVENTS_TABLE,e)})},e.prototype.storeEventsInLocalDB=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(r){n=r.getId();var i=[],s=r.getDb();return e.forEach(function(e){i.push(o.getEventFromLocalDb(e.id,n).catch(function(){return{}}).then(function(n){return s.insertRecord(t.EVENTS_TABLE,{id:e.id,name:e.name,description:e.description,format:e.format,eventtype:e.eventtype,courseid:e.courseid,timestart:e.timestart,timeduration:e.timeduration,categoryid:e.categoryid,groupid:e.groupid,userid:e.userid,instance:e.instance,modulename:e.modulename,timemodified:e.timemodified,repeatid:e.repeatid,visible:e.visible,uuid:e.uuid,sequence:e.sequence,subscriptionid:e.subscriptionid,notificationtime:n.notificationtime||-1})}))}),Promise.all(i)})},e.prototype.updateNotificationTime=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){return r.sitesProvider.isLoggedIn()?o.getDb().updateRecords(t.EVENTS_TABLE,{notificationtime:n},{id:e.id}).then(function(){return r.scheduleEventNotification(e,n)}):Promise.reject(null)})},e.DAYS_INTERVAL=30,e.COMPONENT="AddonCalendarEvents",e.DEFAULT_NOTIFICATION_TIME_CHANGED="AddonCalendarDefaultNotificationTimeChangedEvent",e.DEFAULT_NOTIFICATION_TIME_SETTING="mmaCalendarDefaultNotifTime",e.DEFAULT_NOTIFICATION_TIME=60,e.EVENTS_TABLE="addon_calendar_events",e=t=f([Object(o.A)(),p("design:paramtypes",[r.a,i.a,c.a,s.a,a.a,d.a,l.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(5),s=(n.n(i),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.sitesProvider=e,this.ROOT_CACHE_KEY="myoverview:"}return t=e,e.prototype.getActionEventsByCourse=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var s=i().subtract(14,"days").unix(),a={timesortfrom:s,courseid:e,limitnum:t.EVENTS_LIMIT_PER_COURSE},c={cacheKey:r.getActionEventsByCourseCacheKey(e)};return n&&(a.aftereventid=n),o.read("core_calendar_get_action_events_by_course",a,c).then(function(e){return e&&e.events?r.treatCourseEvents(e,s):Promise.reject(null)})})},e.prototype.getActionEventsByCourseCacheKey=function(e){return this.getActionEventsByCoursesCacheKey()+":"+e},e.prototype.getActionEventsByCourses=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r=i().subtract(14,"days").unix(),s={timesortfrom:r,courseids:e,limitnum:t.EVENTS_LIMIT_PER_COURSE},a={cacheKey:o.getActionEventsByCoursesCacheKey()};return n.read("core_calendar_get_action_events_by_courses",s,a).then(function(e){if(e&&e.groupedbycourse){var t={};return e.groupedbycourse.forEach(function(e){t[e.courseid]=o.treatCourseEvents(e,r)}),t}return Promise.reject(null)})})},e.prototype.getActionEventsByCoursesCacheKey=function(){return this.ROOT_CACHE_KEY+"bycourse"},e.prototype.getActionEventsByTimesort=function(e,n){var o=this;return this.sitesProvider.getSite(n).then(function(n){var r=i().subtract(14,"days").unix(),s={timesortfrom:r,limitnum:t.EVENTS_LIMIT},a={cacheKey:o.getActionEventsByTimesortCacheKey(e,s.limitnum),getCacheUsingCacheKey:!0,uniqueCacheKey:!0};return e&&(s.aftereventid=e),n.read("core_calendar_get_action_events_by_timesort",s,a).then(function(e){if(e&&e.events){var t=e.events.length>=s.limitnum?e.lastid:void 0;return e=e.events.filter(function(e){return e.timesort>=r}),{events:e,canLoadMore:t}}return Promise.reject(null)})})},e.prototype.getActionEventsByTimesortPrefixCacheKey=function(){return this.ROOT_CACHE_KEY+"bytimesort:"},e.prototype.getActionEventsByTimesortCacheKey=function(e,t){return e=e||0,t=t||0,this.getActionEventsByTimesortPrefixCacheKey()+e+":"+t},e.prototype.invalidateActionEventsByCourses=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKeyStartingWith(t.getActionEventsByCoursesCacheKey())})},e.prototype.invalidateActionEventsByTimesort=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKeyStartingWith(t.getActionEventsByTimesortPrefixCacheKey())})},e.prototype.isAvailable=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.wsAvailable("core_calendar_get_action_events_by_courses")})},e.prototype.isDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_CoreCourses")},e.prototype.isEnabled=function(){return this.isDisabledInSite()?Promise.resolve(!1):this.isAvailable().catch(function(){return!1})},e.prototype.treatCourseEvents=function(e,n){var o=e.events.length>=t.EVENTS_LIMIT_PER_COURSE?e.lastid:void 0;return e.events=e.events.filter(function(e){return e.timesort>=n}),{events:e.events,canLoadMore:o}},e.EVENTS_LIMIT=20,e.EVENTS_LIMIT_PER_COURSE=10,e=t=s([Object(o.A)(),a("design:paramtypes",[r.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(8),a=n(6),c=n(92),u=n(190),d=n(74),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.domUtils=e,this.translate=t,this.utils=n,this.accessRuleDelegate=o,this.quizProvider=r,this.modalCtrl=i,this.quizOfflineProvider=s,this.div=document.createElement("div")}return e.prototype.getAndCheckPreflightData=function(e,t,n,o,r,i,s,a,c){var u=this,d=t.activerulenames,l=!1;return this.accessRuleDelegate.isPreflightCheckRequired(d,e,o,i,a).then(function(r){if(l=r,r)return u.getPreflightData(e,t,o,i,s,a).then(function(e){Object.assign(n,e)})}).then(function(){return u.accessRuleDelegate.getFixedPreflightData(d,e,n,o,i,a)}).then(function(){return u.validatePreflightData(e,t,n,o,r,i,a).catch(function(d){return i?Promise.reject(d):c&&!l?Promise.reject(d):(setTimeout(function(){u.domUtils.showErrorModalDefault(d,"core.error",!0)},100),u.getAndCheckPreflightData(e,t,n,o,r,i,s,a,!0))})})},e.prototype.getPreflightData=function(e,t,n,o,r,i){var s=this,a=[];if(t.activerulenames.forEach(function(e){s.accessRuleDelegate.isAccessRuleSupported(e)||a.push(e)}),a.length)return Promise.reject(this.translate.instant("addon.mod_quiz.errorrulesnotsupported")+" "+JSON.stringify(a));var c=this.modalCtrl.create("AddonModQuizPreflightModalPage",{title:r,quiz:e,attempt:n,prefetch:!!o,siteId:i,rules:t.activerulenames});return c.present(),new Promise(function(e,t){c.onDidDismiss(function(n){void 0!==n?e(n):t(s.domUtils.createCanceledError())})})},e.prototype.getQuestionMarkFromHtml=function(e){return this.div.innerHTML=e,this.domUtils.getContentsOfElement(this.div,".grade")},e.prototype.setAttemptCalculatedData=function(e,t,n,o){t.rescaledGrade=this.quizProvider.rescaleGrade(t.sumgrades,e,!1),t.finished=this.quizProvider.isAttemptFinished(t.state),t.readableState=this.quizProvider.getAttemptReadableState(e,t),t.readableMark=e.showMarkColumn&&t.finished?this.quizProvider.formatGrade(t.sumgrades,e.decimalpoints):"",e.showGradeColumn&&t.finished?(t.readableGrade=this.quizProvider.formatGrade(t.rescaledGrade,e.decimalpoints),t.highlightGrade=n&&!t.preview&&t.state==c.a.ATTEMPT_FINISHED&&t.readableGrade==o):t.readableGrade=""},e.prototype.setQuizCalculatedData=function(e,t){e.sumGradesFormatted=this.quizProvider.formatGrade(e.sumgrades,e.decimalpoints),e.gradeFormatted=this.quizProvider.formatGrade(e.grade,e.decimalpoints),e.showAttemptColumn=1!=e.attempts,e.showGradeColumn=t.someoptions.marks>=c.a.QUESTION_OPTIONS_MARK_AND_MAX&&this.quizProvider.quizHasGrades(e),e.showMarkColumn=e.showGradeColumn&&e.grade!=e.sumgrades,e.showFeedbackColumn=e.hasfeedback&&t.alloptions.overallfeedback},e.prototype.validatePreflightData=function(e,t,n,o,r,i,s){var a,u=this,d=t.activerulenames;if(o)if(o.state==c.a.ATTEMPT_OVERDUE||o.finishedOffline)a=this.quizProvider.getAttemptSummary(o.id,n,r,!0,!1,s);else{a=this.quizProvider.getAttemptData(o.id,o.currentpage,n,r,!0,s).then(function(){if(r)return u.quizOfflineProvider.getAttemptById(o.id).then(function(e){o.currentpage=e.currentpage}).catch(function(){})})}else a=this.quizProvider.startAttempt(e.id,n,!1,s).then(function(e){o=e});return a.then(function(){return u.accessRuleDelegate.notifyPreflightCheckPassed(d,e,o,n,i,s),o}).catch(function(t){return u.utils.isWebServiceError(t)&&u.accessRuleDelegate.notifyPreflightCheckFailed(d,e,o,n,i,s),Promise.reject(t)})},e=l([Object(o.A)(),f("design:paramtypes",[s.a,i.c,a.a,d.a,c.a,r.o,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(4),i=n(730),s=n(326),a=n(397),c=n(9),u=n(7),d=n(2),l=n(148),f=n(78),p=n(6),h=n(11),m=n(105),g=n(30),y=n(72),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(){function e(e,n,o,r,i,s,a,c,u,d,l,f,p){this.appProvider=n,this.platform=o,this.pushNotificationsDelegate=r,this.sitesProvider=i,this.badge=s,this.localNotificationsProvider=a,this.utils=c,this.textUtils=u,this.push=d,this.configProvider=l,this.device=f,this.zone=p,this.tablesSchema=[{name:t.BADGE_TABLE,columns:[{name:"siteid",type:"TEXT"},{name:"addon",type:"TEXT"},{name:"number",type:"INTEGER"}],primaryKeys:["siteid","addon"]}],this.logger=e.getInstance("AddonPushNotificationsProvider"),this.appDB=n.getDB(),this.appDB.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.cleanSiteCounters=function(e){var n=this;return this.appDB.deleteRecords(t.BADGE_TABLE,{siteid:e}).finally(function(){n.updateAppCounter()})},e.prototype.getOptions=function(){return this.configProvider.get(g.a.SETTINGS_NOTIFICATION_SOUND,!0).then(function(e){return{android:{senderID:y.a.gcmpn,sound:!!e},ios:{alert:"true",badge:!0,sound:!!e},windows:{sound:!!e}}})},e.prototype.getPushId=function(){return this.pushID},e.prototype.getSiteCounter=function(e){return this.getAddonBadge(e)},e.prototype.notificationClicked=function(e){var t=this;this.platform.ready().then(function(){t.pushNotificationsDelegate.clicked(e)})},e.prototype.onMessageReceived=function(e){var n=this,o=e?e.additionalData:{};this.sitesProvider.getSite(o.site).then(function(){if(n.utils.isTrueOrOne(o.foreground)){if(n.localNotificationsProvider.isAvailable()){var r={id:1,at:new Date,data:{notif:o.notif,site:o.site},title:"",text:""},i=[];i.push(n.textUtils.formatText(e.title,!0,!0).then(function(e){r.title=e}).catch(function(){r.title=e.title})),i.push(n.textUtils.formatText(e.message,!0,!0).then(function(e){r.text=e}).catch(function(){r.text=e.message})),Promise.all(i).then(function(){n.localNotificationsProvider.schedule(r,t.COMPONENT,o.site)})}n.platform.ready().then(function(){o.title=e.title,o.message=e.message,n.pushNotificationsDelegate.received(o)})}else o.title=e.title,o.message=e.message,n.notificationClicked(o)})},e.prototype.unregisterDeviceOnMoodle=function(e){if(!e||!this.appProvider.isMobile())return Promise.reject(null);this.logger.debug("Unregister device on Moodle: '"+e.id+"'");return e.write("core_user_remove_user_device",{appid:y.a.app_id,uuid:this.device.uuid}).then(function(e){if(!e||!e.removed)return Promise.reject(null)})},e.prototype.updateAddonCounter=function(e,t,n){var o=this;return this.pushNotificationsDelegate.isCounterHandlerRegistered(e)?(n=n||this.sitesProvider.getCurrentSiteId(),this.saveAddonBadge(t,n,e).then(function(){return o.updateSiteCounter(n).then(function(){return t})})):Promise.resolve(0)},e.prototype.updateAppCounter=function(){var e=this;return this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.getAddonBadge(t))}),Promise.all(n).then(function(t){var n=t.reduce(function(e,t){return e+parseInt(t,10)},0);return e.appProvider.isDesktop()||e.appProvider.isMobile()?e.badge.set(n).then(function(){return n}):n})})},e.prototype.updateSiteCounter=function(e){var t=this,n=this.pushNotificationsDelegate.getCounterHandlers(),o=[];for(var r in n)o.push(this.getAddonBadge(e,n[r]));return Promise.all(o).then(function(n){var o=!1,r=n.reduce(function(e,t){return t!=parseInt(t,10)&&(o=!0,t=parseInt(t,10)),e+t},0);return r=o&&r>0?r+"+":r,t.saveAddonBadge(r,e)}).then(function(e){return t.updateAppCounter().then(function(){return e})})},e.prototype.registerDevice=function(){var e=this;try{return this.getOptions().then(function(t){var n=e.push.init(t);n.on("notification").subscribe(function(t){e.zone.run(function(){e.logger.log("Received a notification",t),e.onMessageReceived(t)})}),n.on("registration").subscribe(function(t){e.zone.run(function(){e.pushID=t.registrationId,e.registerDeviceOnMoodle().catch(function(t){e.logger.warn("Can't register device",t)})})}),n.on("error").subscribe(function(t){e.zone.run(function(){e.logger.warn("Error with Push plugin",t)})})})}catch(e){this.logger.warn(e)}return Promise.reject(null)},e.prototype.registerDeviceOnMoodle=function(){if(this.logger.debug("Register device on Moodle."),!this.sitesProvider.isLoggedIn()||!this.pushID||!this.appProvider.isMobile())return Promise.reject(null);var e={appid:y.a.app_id,name:this.device.manufacturer||"",model:this.device.model,platform:this.device.platform,version:this.device.version,pushid:this.pushID,uuid:this.device.uuid};return this.sitesProvider.getCurrentSite().write("core_user_add_user_device",e)},e.prototype.getAddonBadge=function(e,n){return void 0===n&&(n="site"),this.appDB.getRecord(t.BADGE_TABLE,{siteid:e,addon:n}).then(function(e){return e&&e.number||0}).catch(function(){return 0})},e.prototype.saveAddonBadge=function(e,n,o){void 0===o&&(o="site"),n=n||this.sitesProvider.getCurrentSiteId();return this.appDB.insertRecord(t.BADGE_TABLE,{siteid:n,addon:o,number:e}).then(function(){return e})},e.COMPONENT="AddonPushNotificationsProvider",e.BADGE_TABLE="addon_pushnotifications_badge",e=t=v([Object(o.A)(),b("design:paramtypes",[u.a,c.a,r.s,l.a,d.a,i.a,f.a,p.a,h.a,s.a,m.a,a.a,o.M])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(69),s=n(10),a=n(9),c=n(7),u=n(12),d=n(2),l=n(45),f=n(11),p=n(6),h=n(106),m=n(136),g=n(116),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,"AddonModWorkshopSyncProvider",i,s,n,a,c,t)||this;return p.eventsProvider=r,p.utils=u,p.workshopProvider=d,p.workshopHelper=l,p.workshopOffline=f,p.componentTranslate=o.translateModuleName("workshop"),p}return y(t,e),n=t,t.prototype.hasDataToSync=function(e,t){return this.workshopOffline.hasWorkshopOfflineData(e,t)},t.prototype.syncAllWorkshops=function(e){return this.syncOnSites("all workshops",this.syncAllWorkshopsFunc.bind(this),[],e)},t.prototype.syncAllWorkshopsFunc=function(e){var t=this;return this.workshopOffline.getAllWorkshops(e).then(function(o){var r=[];return o.forEach(function(o){r.push(t.syncWorkshopIfNeeded(o,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{workshopId:o,warnings:r.warnings},e)}))}),Promise.all(r)})},t.prototype.syncWorkshopIfNeeded=function(e,t){var n=this;return this.isSyncNeeded(e,t).then(function(o){if(o)return n.syncWorkshop(e,t)})},t.prototype.syncWorkshop=function(e,t){var n=this;if(t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncing(e,t))return this.getOngoingSync(e,t);if(this.syncProvider.isBlocked(h.a.COMPONENT,e,t))return this.logger.debug("Cannot sync workshop "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync workshop "+e);var o=[];o.push(this.workshopOffline.getSubmissions(e,t).catch(function(){return[]})),o.push(this.workshopOffline.getAssessments(e,t).catch(function(){return[]})),o.push(this.workshopOffline.getEvaluateSubmissions(e,t).catch(function(){return[]})),o.push(this.workshopOffline.getEvaluateAssessments(e,t).catch(function(){return[]}));var r={warnings:[],updated:!1},i=Promise.all(o).then(function(o){var i;for(var s in o)if(o[s].length>0&&o[s][0].courseid){i=o[s][0].courseid;break}if(i)return n.appProvider.isOnline()?n.workshopProvider.getWorkshopById(i,e,t).then(function(e){var i=o[1],s=o[2],a=o[3],c=[],u={};return o[0].forEach(function(e){void 0===u[e.submissionid]&&(u[e.submissionid]=[]),u[e.submissionid].push(e)}),Object.keys(u).forEach(function(o){c.push(n.syncSubmission(e,u[o],r,t).then(function(){r.updated=!0}))}),i.forEach(function(o){c.push(n.syncAssessment(e,o,r,t).then(function(){r.updated=!0}))}),s.forEach(function(o){c.push(n.syncEvaluateSubmission(e,o,r,t).then(function(){r.updated=!0}))}),a.forEach(function(o){c.push(n.syncEvaluateAssessment(e,o,r,t).then(function(){r.updated=!0}))}),Promise.all(c)}).then(function(){if(r.updated)return n.workshopProvider.invalidateContentById(e,i,t).catch(function(){})}):Promise.reject(null)}).then(function(){return n.setSyncTime(e,t).catch(function(){})}).then(function(){return r});return this.addOngoingSync(e,i,t)},t.prototype.syncSubmission=function(e,t,n,o){var r,i=this,s=!1,a=null,c=(t=t.sort(function(e,t){return e.timemodified-t.timemodified}))[0].submissionid;return c>0?(s=!0,a=this.workshopProvider.getSubmission(e.id,c,o).then(function(e){return e.timemodified}).catch(function(){return-1})):a=Promise.resolve(0),a.then(function(a){if(a<0||a>=t[0].timemodified)return n.updated=!0,r=i.translate.instant("addon.mod_workshop.warningsubmissionmodified"),i.workshopOffline.deleteAllSubmissionActions(e.id,c,o);var u=Promise.resolve();return t.forEach(function(t){u=u.then(function(){c=t.submissionid>0?t.submissionid:c;return(t.attachmentsid?i.workshopHelper.getSubmissionFilesFromOfflineFilesObject(t.attachmentsid,e.id,c,s,o).then(function(t){return i.workshopHelper.uploadOrStoreSubmissionFiles(e.id,c,t,s,!1,o)}):i.workshopHelper.uploadOrStoreSubmissionFiles(e.id,c,[],s,!1,o)).then(function(n){switch(t.action){case"add":return i.workshopProvider.addSubmissionOnline(e.id,t.title,t.content,n,o).then(function(e){c=e});case"update":return i.workshopProvider.updateSubmissionOnline(c,t.title,t.content,n,o);case"delete":return i.workshopProvider.deleteSubmissionOnline(c,o);default:return Promise.resolve()}}).catch(function(e){if(!e||!i.utils.isWebServiceError(e))return Promise.reject(e);r=e.message||e.error}).then(function(){return n.updated=!0,i.workshopOffline.deleteSubmissionAction(t.workshopid,t.submissionid,t.action,o)})})}),u.then(function(){if(r){var t=i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:r});-1==n.warnings.indexOf(t)&&n.warnings.push(t)}})})},t.prototype.syncAssessment=function(e,t,n,o){var r,i=this,s=t.assessmentid;return this.workshopProvider.getAssessment(e.id,s,o).then(function(e){return e.timemodified}).catch(function(){return-1}).then(function(a){if(a<0||a>=t.timemodified)return n.updated=!0,r=i.translate.instant("addon.mod_workshop.warningassessmentmodified"),i.workshopOffline.deleteAssessment(e.id,s,o);var c=t.inputdata;return(c.feedbackauthorattachmentsid?i.workshopHelper.getAssessmentFilesFromOfflineFilesObject(c.feedbackauthorattachmentsid,e.id,s,o).then(function(t){return i.workshopHelper.uploadOrStoreAssessmentFiles(e.id,s,t,!1,o)}):i.workshopHelper.uploadOrStoreAssessmentFiles(e.id,s,[],!1,o)).then(function(e){return c.feedbackauthorattachmentsid=e||0,i.workshopProvider.updateAssessmentOnline(s,c,o)}).catch(function(e){if(!e||!i.utils.isWebServiceError(e))return Promise.reject(e);r=e.message||e.error}).then(function(){return n.updated=!0,i.workshopOffline.deleteAssessment(e.id,s,o)})}).then(function(){if(r){var t=i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:r});-1==n.warnings.indexOf(t)&&n.warnings.push(t)}})},t.prototype.syncEvaluateSubmission=function(e,t,n,o){var r,i=this,s=t.submissionid;return this.workshopProvider.getSubmission(e.id,s,o).then(function(e){return e.timemodified}).catch(function(){return-1}).then(function(a){return a<0||a>=t.timemodified?(n.updated=!0,r=i.translate.instant("addon.mod_workshop.warningsubmissionmodified"),i.workshopOffline.deleteEvaluateSubmission(e.id,s,o)):i.workshopProvider.evaluateSubmissionOnline(s,t.feedbacktext,t.published,t.gradeover,o).catch(function(e){if(!e||!i.utils.isWebServiceError(e))return Promise.reject(e&&e.error);r=e.message||e.error}).then(function(){return n.updated=!0,i.workshopOffline.deleteEvaluateSubmission(e.id,s,o)})}).then(function(){if(r){var t=i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:r});-1==n.warnings.indexOf(t)&&n.warnings.push(t)}})},t.prototype.syncEvaluateAssessment=function(e,t,n,o){var r,i=this,s=t.assessmentid;return this.workshopProvider.getAssessment(e.id,s,o).then(function(e){return e.timemodified}).catch(function(){return-1}).then(function(a){return a<0||a>=t.timemodified?(n.updated=!0,r=i.translate.instant("addon.mod_workshop.warningassessmentmodified"),i.workshopOffline.deleteEvaluateAssessment(e.id,s,o)):i.workshopProvider.evaluateAssessmentOnline(s,t.feedbacktext,t.weight,t.gradinggradeover,o).catch(function(e){if(!e||!i.utils.isWebServiceError(e))return Promise.reject(e&&e.error);r=e.message||e.error}).then(function(){return n.updated=!0,i.workshopOffline.deleteEvaluateAssessment(e.id,s,o)})}).then(function(){if(r){var t=i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:r});-1==n.warnings.indexOf(t)&&n.warnings.push(t)}})},t.AUTO_SYNCED="addon_mod_workshop_autom_synced",t.MANUAL_SYNCED="addon_mod_workshop_manual_synced",t=n=v([Object(o.A)(),b("design:paramtypes",[r.c,a.a,s.a,u.a,c.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a])],t);var n}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(77),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=e,this.mimeUtils=t,this.ROOT_CACHE_KEY="mmaFiles:"}return e.prototype.canGetPrivateFilesInfo=function(){return this.sitesProvider.wsAvailableInCurrentSite("core_user_get_private_files_info")},e.prototype.canViewPrivateFiles=function(){return this.sitesProvider.getCurrentSite().canAccessMyFiles()&&!this.isPrivateFilesDisabledInSite()},e.prototype.canViewSiteFiles=function(){return!this.isSiteFilesDisabledInSite()},e.prototype.canUploadFiles=function(){var e=this.sitesProvider.getCurrentSite();return e.canAccessMyFiles()&&e.canUploadFiles()&&!this.isUploadDisabledInSite()},e.prototype.getFiles=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={cacheKey:n.getFilesListCacheKey(e)};return t.read("core_files_get_files",e,o)}).then(function(e){var t=[];return e.files&&e.files.forEach(function(e){e.isdir&&(e.link={contextid:e.contextid||"",component:e.component||"",filearea:e.filearea||"",itemid:e.itemid||0,filepath:e.filepath||"",filename:e.filename||""},e.component&&(e.link.filename="")),e.imgPath=e.isdir?n.mimeUtils.getFolderIcon():n.mimeUtils.getFileIcon(e.filename),t.push(e)}),t})},e.prototype.getFilesListCacheKey=function(e){return this.ROOT_CACHE_KEY+"list:"+(e.component?"my":"site")+":"+e.contextid+":"+e.filepath},e.prototype.getPrivateFiles=function(){return this.getFiles(this.getPrivateFilesRootParams())},e.prototype.getPrivateFilesRootParams=function(){return{contextid:-1,component:"user",filearea:"private",contextlevel:"user",instanceid:this.sitesProvider.getCurrentSite().getUserId(),itemid:0,filepath:"",filename:""}},e.prototype.getPrivateFilesInfo=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){var o={userid:e=e||t.getUserId()},r={cacheKey:n.getPrivateFilesInfoCacheKey(e)};return t.read("core_user_get_private_files_info",o,r)})},e.prototype.getPrivateFilesInfoCacheKey=function(e){return this.getPrivateFilesInfoCommonCacheKey()+":"+e},e.prototype.getPrivateFilesInfoCommonCacheKey=function(){return this.ROOT_CACHE_KEY+"privateInfo"},e.prototype.getSiteFiles=function(){return this.getFiles(this.getSiteFilesRootParams())},e.prototype.getSiteFilesRootParams=function(){return{contextid:0,component:"",filearea:"",itemid:0,filepath:"",filename:""}},e.prototype.invalidateDirectory=function(e,t,n){var o,r=this;return t?o=t:"site"===e?o=this.getSiteFilesRootParams():"my"===e&&(o=this.getPrivateFilesRootParams()),this.sitesProvider.getSite(n).then(function(e){return e.invalidateWsCacheForKey(r.getFilesListCacheKey(o))})},e.prototype.invalidatePrivateFilesInfo=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKeyStartingWith(t.getPrivateFilesInfoCommonCacheKey())})},e.prototype.invalidatePrivateFilesInfoForUser=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return e=e||t.getUserId(),t.invalidateWsCacheForKey(n.getPrivateFilesInfoCacheKey(e))})},e.prototype.isDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isDisabledInSite(e)})},e.prototype.isDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_AddonFiles")},e.prototype.isPluginEnabled=function(){return this.canViewPrivateFiles()||this.canViewSiteFiles()||this.canUploadFiles()},e.prototype.isPrivateFilesDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isPrivateFilesDisabledInSite(e)})},e.prototype.isPrivateFilesDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("AddonFilesPrivateFiles")},e.prototype.isSiteFilesDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isSiteFilesDisabledInSite(e)})},e.prototype.isSiteFilesDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("AddonFilesSiteFiles")},e.prototype.isUploadDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isUploadDisabledInSite(e)})},e.prototype.isUploadDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("AddonFilesUpload")},e.prototype.moveFromDraftToPrivate=function(e,t){var n={draftid:e},o={responseExpected:!1};return this.sitesProvider.getSite(t).then(function(e){return e.write("core_user_add_user_private_files",n,o)})},e.prototype.versionCanUploadFiles=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.isVersionGreaterEqualThan("3.1.1")})},e.PRIVATE_FILES_COMPONENT="mmaFilesMy",e.SITE_FILES_COMPONENT="mmaFilesSite",e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(7),c=n(2),u=n(45),d=n(11),l=n(6),f=n(10),p=n(115),h=n(69),m=n(52),g=n(80),y=n(102),v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var h=e.call(this,"AddonModAssignSyncProvider",t,n,o,r,i,s)||this;return h.courseProvider=a,h.eventsProvider=c,h.assignProvider=u,h.assignOfflineProvider=d,h.utils=l,h.submissionDelegate=f,h.gradesHelper=p,h.componentTranslate=a.translateModuleName("assign"),h}return v(t,e),n=t,t.prototype.getSelectedScaleId=function(e,t){var n=e.split(",");(n=n.map(function(e){return e.trim()})).unshift("");var o=e.indexOf(t)||0;return o<0?0:o},t.prototype.hasDataToSync=function(e,t){return this.assignOfflineProvider.hasAssignOfflineData(e,t)},t.prototype.syncAllAssignments=function(e){return this.syncOnSites("all assignments",this.syncAllAssignmentsFunc.bind(this),[],e)},t.prototype.syncAllAssignmentsFunc=function(e){var t=this;return this.assignOfflineProvider.getAllAssigns(e).then(function(o){var r=[];return o.forEach(function(o){r.push(t.syncAssignIfNeeded(o,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{assignId:o,warnings:r.warnings},e)}))}),Promise.all(r)})},t.prototype.syncAssignIfNeeded=function(e,t){var n=this;return this.isSyncNeeded(e,t).then(function(o){if(o)return n.syncAssign(e,t)})},t.prototype.syncAssign=function(e,t){var n=this;t=t||this.sitesProvider.getCurrentSiteId();var o,r,i,s=[],a={warnings:[],updated:!1};return this.isSyncing(e,t)?this.getOngoingSync(e,t):this.syncProvider.isBlocked(m.a.COMPONENT,e,t)?(this.logger.debug("Cannot sync assign "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}))):(this.logger.debug("Try to sync assign "+e+" in site "+t),s.push(this.assignOfflineProvider.getAssignSubmissions(e,t).catch(function(){return[]})),s.push(this.assignOfflineProvider.getAssignSubmissionsGrade(e,t).catch(function(){return[]})),i=Promise.all(s).then(function(i){var s=i[0],c=i[1];if(s.length||c.length)return n.appProvider.isOnline()?(r=s.length>0?s[0].courseid:c[0].courseid,n.assignProvider.getAssignmentById(r,e,t).then(function(e){o=e;var i=[];return s.forEach(function(e){i.push(n.syncSubmission(o,e,a.warnings,t).then(function(){a.updated=!0}))}),c.forEach(function(e){i.push(n.syncSubmissionGrade(o,e,a.warnings,r,t).then(function(){a.updated=!0}))}),Promise.all(i)}).then(function(){if(a.updated)return n.assignProvider.invalidateContent(o.cmid,r,t).catch(function(){})})):Promise.reject(null)}).then(function(){return n.setSyncTime(e,t).catch(function(){})}).then(function(){return a}),this.addOngoingSync(e,i,t))},t.prototype.syncSubmission=function(e,t,n,o){var r,i,s=this,a=t.userid,c={};return this.assignProvider.getSubmissionStatus(e.id,a,!1,!0,!0,o).then(function(n){var u=[];if((i=s.assignProvider.getSubmissionObjectFromAttempt(e,n.lastattempt)).timemodified==t.onlinetimemodified)return i.plugins.forEach(function(n){u.push(s.submissionDelegate.preparePluginSyncData(e,i,n,t,c,o))}),Promise.all(u).then(function(){return(Object.keys(c).length?s.assignProvider.saveSubmissionOnline(e.id,c,o):Promise.resolve()).then(function(){if(e.submissiondrafts&&t.submitted)return s.assignProvider.submitForGradingOnline(e.id,t.submissionstatement,o)}).then(function(){s.assignProvider.getSubmissionStatus(e.id,a,!1,!0,!0,o)})}).catch(function(e){if(!e||!s.utils.isWebServiceError(e))return Promise.reject(e);r=e.message||e.error||e.content||e.body});r=s.translate.instant("addon.mod_assign.warningsubmissionmodified")}).then(function(){return s.assignOfflineProvider.deleteSubmission(e.id,a,o).then(function(){var n=[];return i.plugins.forEach(function(r){n.push(s.submissionDelegate.deletePluginOfflineData(e,i,r,t,o))}),Promise.all(n)})}).then(function(){if(r){var t=s.translate.instant("core.warningofflinedatadeleted",{component:s.componentTranslate,name:e.name,error:r});-1==n.indexOf(t)&&n.push(t)}})},t.prototype.syncSubmissionGrade=function(e,t,n,o,r){var i,s=this,a=t.userid;return this.assignProvider.getSubmissionStatus(e.id,a,!1,!0,!0,r).then(function(n){if(!((n.feedback&&(n.feedback.gradeddate||n.feedback.grade.timemodified))>t.timemodified))return s.gradesHelper.getGradeModuleItems(o,e.cmid,a,void 0,r,!0).then(function(n){return s.courseProvider.getModuleBasicGradeInfo(e.cmid,r).then(function(e){n.forEach(function(n){n.gradedategraded>=t.timemodified&&(n.outcomeid||n.scaleid?n.outcomeid&&s.assignProvider.isOutcomesEditEnabled()&&e.outcomes&&e.outcomes.forEach(function(e,o){e.scale&&n.itemnumber==o&&(t.outcomes[n.itemnumber]=s.getSelectedScaleId(e.scale,e.selected))}):t.grade=e&&e.scale?s.getSelectedScaleId(e.scale,n.gradeformatted):parseFloat(n.gradeformatted)||null)})})}).then(function(){return s.assignProvider.submitGradingFormOnline(e.id,a,t.grade,t.attemptnumber,t.addattempt,t.workflowstate,t.applytoall,t.outcomes,t.plugindata,r).then(function(){s.assignProvider.getSubmissionStatus(e.id,a,!1,!0,!0,r)}).catch(function(e){if(!e||!s.utils.isWebServiceError(e))return Promise.reject(e);i=e.message||e.error||e.content||e.body})});i=s.translate.instant("addon.mod_assign.warningsubmissiongrademodified")}).then(function(){return s.assignOfflineProvider.deleteSubmissionGrade(e.id,a,r)}).then(function(){if(i){var t=s.translate.instant("core.warningofflinedatadeleted",{component:s.componentTranslate,name:e.name,error:i});-1==n.indexOf(t)&&n.push(t)}})},t.AUTO_SYNCED="addon_mod_assign_autom_synced",t=n=b([Object(o.A)(),_("design:paramtypes",[a.a,c.a,i.a,u.a,d.a,r.c,f.a,s.a,m.a,g.a,l.a,y.a,p.a])],t);var n}(h.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(11),s=n(50),a=n(36),c=n(21),u=n(120),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r){this.sitePluginsProvider=e,this.courseHelper=t,this.prefetchDelegate=n,this.textUtils=o,this.translate=r,this.isDestroyed=!1}return e.prototype.ngOnInit=function(){if(this.refreshIcon="spinner",this.module){var e=this.sitePluginsProvider.getSitePluginHandler(this.module.modname);e&&(this.component=e.plugin.component,this.method=e.handlerSchema.method,this.args={courseid:this.courseId,cmid:this.module.id},this.initResult=e.initResult),this.description=this.module.description,this.externalUrl=this.module.url}},e.prototype.doRefresh=function(e,t){return this.content?(this.refreshIcon="spinner",Promise.resolve(this.content.refreshContent(!1)).finally(function(){e&&e.complete(),t&&t()})):(e&&e.complete(),t&&t(),Promise.resolve())},e.prototype.contentLoaded=function(e){this.refreshIcon="refresh",this.prefetchDelegate.getPrefetchHandlerFor(this.module)&&this.courseHelper.fillContextMenu(this,this.module,this.courseId,e,this.component)},e.prototype.contentLoading=function(e){this.refreshIcon="spinner"},e.prototype.expandDescription=function(){this.textUtils.expandText(this.translate.instant("core.description"),this.description,this.component,this.module.id)},e.prototype.prefetch=function(){this.courseHelper.contextMenuPrefetch(this,this.module,this.courseId)},e.prototype.removeFiles=function(){this.courseHelper.confirmAndRemoveFiles(this.module,this.courseId)},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.statusObserver&&this.statusObserver.off()},d([Object(o.D)(),l("design:type",Object)],e.prototype,"module",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"courseId",void 0),d([Object(o._9)(u.a),l("design:type",u.a)],e.prototype,"content",void 0),e=d([Object(o.m)({selector:"core-site-plugins-module-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n<core-site-plugins-plugin-content *ngIf="component && method" [component]="component" [method]="method" [args]="args" [initResult]="initResult" (onContentLoaded)="contentLoaded($event)" (onLoadingContent)="contentLoading($event)"></core-site-plugins-plugin-content>\n'}),l("design:paramtypes",[s.a,c.a,a.a,i.a,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(58),i=n(12),s=n(7),a=n(2),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this,"AddonMessageOutputDelegate",t,n,o)||this;return r.loggerProvider=t,r.sitesProvider=n,r.eventsProvider=o,r.handlerNameProperty="processorName",r}return c(t,e),t.prototype.getDisplayData=function(e){return this.executeFunctionOnEnabled(e.name,"getDisplayData",e)},t=u([Object(o.A)(),d("design:paramtypes",[s.a,a.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(7),i=n(2),s=n(69),a=n(9),c=n(6),u=n(11),d=n(236),l=n(86),f=n(12),p=n(1),h=n(10),m=n(45),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,"AddonModFeedbackSyncProvider",n,t,o,l,u,a)||this;return f.sitesProvider=t,f.loggerProvider=n,f.appProvider=o,f.feedbackOffline=r,f.eventsProvider=i,f.feedbackProvider=s,f.translate=a,f.utils=c,f.textUtils=u,f.componentTranslate=d.translateModuleName("feedback"),f}return g(t,e),n=t,t.prototype.syncAllFeedbacks=function(e){return this.syncOnSites("all feedbacks",this.syncAllFeedbacksFunc.bind(this),void 0,e)},t.prototype.syncAllFeedbacksFunc=function(e){var t=this;return this.feedbackOffline.getAllFeedbackResponses(e).then(function(o){var r={},i=function(i){var s=o[i];if(void 0!==r[s.feedbackid])return"continue";r[s.feedbackid]=t.syncFeedbackIfNeeded(s.feedbackid,e).then(function(o){o&&o.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{feedbackId:s.feedbackid,userId:s.userid,warnings:o.warnings},e)})};for(var s in o)i(s);return Promise.all(t.utils.objectToArray(r))})},t.prototype.syncFeedbackIfNeeded=function(e,t){var n=this;return t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncNeeded(e,t).then(function(o){if(o)return n.syncFeedback(e,t)})},t.prototype.syncFeedback=function(e,t){var n=this;t=t||this.sitesProvider.getCurrentSiteId();var o=e;if(this.isSyncing(o,t))return this.getOngoingSync(o,t);if(this.syncProvider.isBlocked(l.a.COMPONENT,o,t))return this.logger.debug("Cannot sync feedback '"+o+"' because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));var r,i,s={warnings:[],updated:!1};this.logger.debug("Try to sync feedback '"+e+"' in site "+t+"'");var a=this.feedbackOffline.getFeedbackResponses(e,t).catch(function(){return[]}).then(function(o){if(o.length)return n.appProvider.isOnline()?(r=o[0].courseid,n.feedbackProvider.getFeedbackById(r,e,t).then(function(t){return!(i=t).multiple_submit&&n.feedbackProvider.isCompleted(e)}).then(function(r){if(r){var a=[];return o.forEach(function(o){a.push(n.feedbackOffline.deleteFeedbackPageResponses(e,o.page,t))}),s.updated=!0,s.warnings.push(n.translate.instant("core.warningofflinedatadeleted",{component:n.componentTranslate,name:i.name,error:n.translate.instant("addon.mod_feedback.this_feedback_is_already_submitted")})),Promise.all(a)}return n.feedbackProvider.getCurrentCompletedTimeModified(e,t).then(function(e){return o.sort(function(e,t){return e.page-t.page}),o=o.map(function(o){return{func:n.processPage.bind(n),params:[i,o,t,e,s],blocking:!0}}),n.utils.executeOrderedPromises(o)})})):Promise.reject(null)}).then(function(){if(s.updated)return n.feedbackProvider.invalidateAllFeedbackData(e,t).catch(function(){})}).then(function(){return n.setSyncTime(o,t)}).then(function(){return s});return this.addOngoingSync(o,a,t)},t.prototype.processPage=function(e,t,n,o,r){var i=this;return o>t.timemodified?this.feedbackOffline.deleteFeedbackPageResponses(e.id,t.page,n):this.feedbackProvider.processPageOnline(e.id,t.page,t.responses,!1,n).then(function(){return r.updated=!0,i.feedbackOffline.deleteFeedbackPageResponses(e.id,t.page,n)}).catch(function(o){return o&&o.wserror?(r.updated=!0,i.feedbackOffline.deleteFeedbackPageResponses(e.id,t.page,n).then(function(){r.warnings.push(i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:o.error}))})):Promise.reject(o&&o.error)})},t.AUTO_SYNCED="addon_mod_feedback_autom_synced",t=n=y([Object(o.A)(),v("design:paramtypes",[i.a,r.a,a.a,d.a,f.a,l.a,p.c,c.a,u.a,h.a,m.a])],t);var n}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(7),c=n(2),u=n(45),d=n(11),l=n(22),f=n(47),p=n(6),h=n(10),m=n(69),g=n(95),y=n(200),v=n(351),b=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},O=function(e){function t(t,o,r,i,s,a,c,u,d,l,f,p,h,m){var g=e.call(this,"AddonModLessonSyncProvider",t,o,r,i,s,a)||this;return g.eventsProvider=u,g.lessonProvider=d,g.lessonOfflineProvider=l,g.prefetchHandler=f,g.timeUtils=p,g.utils=h,g.urlUtils=m,g.tablesSchema={name:n.RETAKES_FINISHED_TABLE,columns:[{name:"lessonid",type:"INTEGER",primaryKey:!0},{name:"retake",type:"INTEGER"},{name:"pageid",type:"INTEGER"},{name:"timefinished",type:"INTEGER"}]},g.componentTranslate=c.translateModuleName("lesson"),g.sitesProvider.createTableFromSchema(g.tablesSchema),g}return b(t,e),n=t,t.prototype.deleteRetakeFinishedInSync=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.getDb().deleteRecords(n.RETAKES_FINISHED_TABLE,{lessonid:e})}).catch(function(){})},t.prototype.getRetakeFinishedInSync=function(e,t){return this.sitesProvider.getSite(t).then(function(t){return t.getDb().getRecord(n.RETAKES_FINISHED_TABLE,{lessonid:e})}).catch(function(){})},t.prototype.hasDataToSync=function(e,t,n){var o=[],r=!1;return o.push(this.lessonOfflineProvider.hasRetakeAttempts(e,t,n).then(function(e){r=r||e}).catch(function(){})),o.push(this.lessonOfflineProvider.hasFinishedRetake(e,n).then(function(e){r=r||e})),Promise.all(o).then(function(){return r})},t.prototype.setRetakeFinishedInSync=function(e,t,o,r){var i=this;return this.sitesProvider.getSite(r).then(function(r){return r.getDb().insertRecord(n.RETAKES_FINISHED_TABLE,{lessonid:e,retake:Number(t),pageid:Number(o),timefinished:i.timeUtils.timestamp()})})},t.prototype.syncAllLessons=function(e){return this.syncOnSites("all lessons",this.syncAllLessonsFunc.bind(this),[],e)},t.prototype.syncAllLessonsFunc=function(e){var t=this;return this.lessonOfflineProvider.getAllLessonsWithData(e).then(function(o){var r=[];return o.forEach(function(o){r.push(t.syncLessonIfNeeded(o.id,!1,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{lessonId:o.id,warnings:r.warnings},e)}))}),Promise.all(r)})},t.prototype.syncLessonIfNeeded=function(e,t,n){var o=this;return this.isSyncNeeded(e,n).then(function(r){if(r)return o.syncLesson(e,t,!1,n)})},t.prototype.syncLesson=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i,s,a,c,u,d={warnings:[],updated:!1};return this.isSyncing(e,o)?this.getOngoingSync(e,o):!n&&this.syncProvider.isBlocked(g.a.COMPONENT,e,o)?(this.logger.debug("Cannot sync lesson "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}))):(this.logger.debug("Try to sync lesson "+e+" in site "+o),i=this.lessonOfflineProvider.getLessonAttempts(e,o).then(function(n){if(n.length)return r.appProvider.isOnline()?(a=n[0].courseid,r.lessonProvider.getLessonById(a,e,!1,o).then(function(n){return s=n,r.prefetchHandler.getLessonPassword(e,!1,!0,t,o)}).then(function(e){var t=n.length,i=[];return u=e.accessInfo,c=e.password,s=e.lesson||s,(n=n.filter(function(e){return e.retake==u.attemptscount||(i.push(r.lessonOfflineProvider.deleteAttempt(s.id,e.retake,e.pageid,e.timemodified,o).catch(function(){})),!1)})).length!=t&&d.warnings.push(r.translate.instant("core.warningofflinedatadeleted",{component:r.componentTranslate,name:s.name,error:r.translate.instant("addon.mod_lesson.warningretakefinished")})),Promise.all(i)}).then(function(){if(n.length)return n.sort(function(e,t){return e.timemodified-t.timemodified}),n=n.map(function(e){return{func:r.sendAttempt.bind(r),params:[s,c,e,d,o],blocking:!0}}),r.utils.executeOrderedPromises(n)})):Promise.reject(null)}).then(function(){return r.lessonOfflineProvider.getRetake(e,o).then(function(i){if(!i.finished)return r.lessonOfflineProvider.deleteRetake(e,o);if(!r.appProvider.isOnline())return Promise.reject(null);return a=i.courseid||a,(s?Promise.resolve():r.lessonProvider.getLessonById(a,e,!1,o).then(function(n){return s=n,r.prefetchHandler.getLessonPassword(e,!1,!0,t,o)}).then(function(e){u=e.accessInfo,c=e.password,s=e.lesson||s})).then(function(){return i.retake!=u.attemptscount?(d.warnings.length||d.warnings.push(r.translate.instant("core.warningofflinedatadeleted",{component:r.componentTranslate,name:s.name,error:r.translate.instant("addon.mod_lesson.warningretakefinished")})),r.lessonOfflineProvider.deleteRetake(e,o)):r.lessonProvider.finishRetakeOnline(e,c,!1,!1,o).then(function(t){if(d.updated=!0,!n&&t.data&&t.data.reviewlesson){var s=r.urlUtils.extractUrlParams(t.data.reviewlesson.value);s&&s.pageid&&r.setRetakeFinishedInSync(e,i.retake,s.pageid,o)}return r.lessonOfflineProvider.deleteRetake(e,o)}).catch(function(t){return t&&r.utils.isWebServiceError(t)?(d.updated=!0,r.lessonOfflineProvider.deleteRetake(e,o).then(function(){d.warnings.push(r.translate.instant("core.warningofflinedatadeleted",{component:r.componentTranslate,name:s.name,error:t}))})):Promise.reject(t)})})},function(){})}).then(function(){if(d.updated&&a){var t=[];return t.push(r.lessonProvider.invalidateAccessInformation(e,o)),t.push(r.lessonProvider.invalidateContentPagesViewed(e,o)),t.push(r.lessonProvider.invalidateQuestionsAttempts(e,o)),t.push(r.lessonProvider.invalidatePagesPossibleJumps(e,o)),t.push(r.lessonProvider.invalidateTimers(e,o)),r.utils.allPromises(t).catch(function(){}).then(function(){return r.lessonProvider.getAccessInformation(e,!1,!1,o).then(function(t){var n=[],i=t.attemptscount;return n.push(r.lessonProvider.getContentPagesViewedOnline(e,i,!1,!1,o)),n.push(r.lessonProvider.getQuestionsAttemptsOnline(e,i,!1,void 0,!1,!1,o)),Promise.all(n)}).catch(function(){})})}}).then(function(){return r.setSyncTime(e,o).catch(function(){})}).then(function(){return d}),this.addOngoingSync(e,i,o))},t.prototype.sendAttempt=function(e,t,n,o,r){var i=this;return this.lessonProvider.processPageOnline(e.id,n.pageid,n.data,t,!1,r).then(function(){return o.updated=!0,i.lessonOfflineProvider.deleteAttempt(e.id,n.retake,n.pageid,n.timemodified,r)}).catch(function(t){return t&&i.utils.isWebServiceError(t)?(o.updated=!0,i.lessonOfflineProvider.deleteAttempt(e.id,n.retake,n.pageid,n.timemodified,r).then(function(){o.warnings.push(i.translate.instant("core.warningofflinedatadeleted",{component:i.componentTranslate,name:e.name,error:t}))})):Promise.reject(t)})},t.AUTO_SYNCED="addon_mod_lesson_autom_synced",t.RETAKES_FINISHED_TABLE="addon_mod_lesson_retakes_finished_sync",t=n=_([Object(o.A)(),P("design:paramtypes",[a.a,c.a,i.a,u.a,d.a,r.c,h.a,s.a,g.a,y.a,v.a,l.a,p.a,f.a])],t);var n}(m.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(7),c=n(2),u=n(45),d=n(11),l=n(6),f=n(10),p=n(69),h=n(138),m=n(192),g=n(355),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,"AddonModScormSyncProvider",t,n,o,r,i,s)||this;return p.eventsProvider=c,p.scormProvider=u,p.scormOfflineProvider=d,p.prefetchHandler=l,p.utils=f,p.componentTranslate=a.translateModuleName("scorm"),p}return y(t,e),n=t,t.prototype.addToNewOrDelete=function(e,t,n,o,r,i,s,a,c){var u=this;return t==n?(o.push(t),Promise.resolve()):this.scormOfflineProvider.getAttemptCreationTime(e,t,c).then(function(n){if(n>i){if(s)return u.logger.debug("Try to delete attempt "+t+" because it cannot be created as a new attempt."),u.scormOfflineProvider.deleteAttempt(e,t,c).then(function(){a.push(u.translate.instant("addon.mod_scorm.warningofflinedatadeleted",{number:t}))}).catch(function(){});r[n]=t}else o.push(t)})},t.prototype.canRetrySync=function(e,t,n,o){var r=this;return this.scormProvider.getScormUserData(e,t,void 0,!1,n!=t,o).then(function(n){return r.scormOfflineProvider.getAttemptSnapshot(e,t,o).then(function(e){if(!e||!Object.keys(e).length||!r.snapshotEquals(e,n))return Promise.reject(null)})})},t.prototype.createNewAttemptsAtEnd=function(e,t,n,o){var r=this,i=Object.keys(t).sort(),s=[];return i.length?(i.forEach(function(i,a){s.push(r.scormOfflineProvider.changeAttemptNumber(e,t[i],n+a+1,o))}),this.utils.allPromises(s)):Promise.resolve()},t.prototype.finishSync=function(e,t,n,o,r,i,s){var a=this;return(s?this.scormProvider.invalidateAllScormData(t.id,e).catch(function(){}).then(function(){return a.prefetchHandler.fetchWSData(t,e)}):Promise.resolve()).then(function(){return a.setSyncTime(t.id,e).catch(function(){})}).then(function(){return!!i&&a.scormProvider.getAttemptCount(t.id,void 0,!1,e).then(function(n){return n.online.length>i.online.length||!r&&o>0&&a.scormProvider.isAttemptIncomplete(t.id,o,!1,!0,e).then(function(e){return!e})})}).then(function(e){return{warnings:n,attemptFinished:e,updated:s}})},t.prototype.getOfflineAttemptData=function(e,t,n){var o=this;return this.scormProvider.isAttemptIncomplete(e,t,!0,!1,n).then(function(r){return o.scormOfflineProvider.getAttemptCreationTime(e,t,n).then(function(e){return{incomplete:r,timecreated:e}})})},t.prototype.moveNewAttempts=function(e,t,n,o,r,i){var s=this;if(!t.length)return Promise.resolve();var a,c=Promise.resolve();return(r=r.sort(function(e,t){return Number(e)<=Number(t)?1:-1})).forEach(function(n){n>o&&(c=c.then(function(){return s.scormOfflineProvider.changeAttemptNumber(e,n,n+t.length,i).then(function(){a=n})}))}),c.then(function(){var o=[],r=[];return(t=t.sort(function(e,t){return Number(e)>=Number(t)?1:-1})).forEach(function(t,a){r.push(s.scormOfflineProvider.changeAttemptNumber(e,t,n+a+1,i).then(function(){o.push(t)}))}),Promise.all(r).catch(function(a){return r=[],o.forEach(function(o){var a=n+t.indexOf(o)+1;r.push(s.scormOfflineProvider.changeAttemptNumber(e,a,o,i))}),s.utils.allPromises(r).then(function(){return Promise.reject(a)})})}).catch(function(n){if(!a)return Promise.reject(n);for(var o=[],c=Promise.resolve(),u=a;-1!=r.indexOf(u);u++)o.push(u);return o.forEach(function(n){c=c.then(function(){return s.scormOfflineProvider.changeAttemptNumber(e,n+t.length,n,i)})}),c.then(function(){return Promise.reject(n)})})},t.prototype.saveSyncSnapshot=function(e,t,n){var o=this;return this.scormProvider.getScormUserData(e,t,void 0,!1,!0,n).then(function(r){return o.scormOfflineProvider.setAttemptSnapshot(e,t,r,n)},function(){return o.scormProvider.getScormUserData(e,t,void 0,!1,!1,n).catch(function(){return{}}).then(function(r){return o.scormOfflineProvider.getScormStoredData(e,t,!1,!0,n).then(function(i){return i.forEach(function(e){r[e.scoid]||(r[e.scoid]={scoid:e.scoid,userdata:{}}),r[e.scoid].userdata[e.element]=e.value}),o.scormOfflineProvider.setAttemptSnapshot(e,t,r,n)})})})},t.prototype.snapshotEquals=function(e,t){for(var n in t){var o=t[n],r=e[n];for(var i in o.userdata)if(i.indexOf(".")>-1&&(!r||o.userdata[i]!==r.userdata[i]))return!1}for(var n in e){o=t[n],r=e[n];for(var i in r.userdata)if(i.indexOf(".")>-1&&(!o||o.userdata[i]!==r.userdata[i]))return!1}return!0},t.prototype.syncAllScorms=function(e){return this.syncOnSites("all SCORMs",this.syncAllScormsFunc.bind(this),[],e)},t.prototype.syncAllScormsFunc=function(e){var t=this;return this.scormOfflineProvider.getAllAttempts(e).then(function(o){var r=[],i=[],s=[];return o.forEach(function(e){-1==i.indexOf(e.scormid)&&(i.push(e.scormid),r.push({id:e.scormid,courseId:e.courseid}))}),r.forEach(function(o){t.syncProvider.isBlocked(h.a.COMPONENT,o.id,e)||s.push(t.scormProvider.getScormById(o.courseId,o.id,"",!1,e).then(function(o){return t.syncScormIfNeeded(o,e).then(function(r){void 0!==r&&t.eventsProvider.trigger(n.AUTO_SYNCED,{scormId:o.id,attemptFinished:r.attemptFinished,warnings:r.warnings,updated:r.updated},e)})}))}),Promise.all(s)})},t.prototype.syncAttempt=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.logger.debug("Try to sync attempt "+t+" in SCORM "+e+" and site "+n),this.scormOfflineProvider.getScormStoredData(e,t,!0,!1,n).then(function(r){var i={},s=[],a=!1;r.forEach(function(e){e.element.indexOf(".")>-1&&(i[e.scoid]||(i[e.scoid]=[]),i[e.scoid].push({element:e.element,value:e.value}))});var c=function(r){var c=Number(r);s.push(o.scormProvider.saveTracksOnline(e,c,t,i[c],n).then(function(){return o.scormOfflineProvider.markAsSynced(e,t,c,n).catch(function(){}).then(function(){a=!0})}))};for(var u in i)c(u);return o.utils.allPromises(s).then(function(){return o.scormOfflineProvider.deleteAttempt(e,t,n).catch(function(){return o.scormOfflineProvider.deleteAttempt(e,t,n).catch(function(){o.logger.error("After sync: error deleting attempt "+t+" in SCORM "+e)})})}).catch(function(r){return a?(o.logger.error("Error synchronizing some SCOs for attempt "+t+" in SCORM "+e+". Saving snapshot."),o.saveSyncSnapshot(e,t,n).then(function(){return Promise.reject(r)})):(o.logger.error("Error synchronizing attempt "+t+" in SCORM "+e),Promise.reject(r))})})},t.prototype.syncScormIfNeeded=function(e,t){var n=this;return this.isSyncNeeded(e.id,t).then(function(o){if(o)return n.syncScorm(e,t)})},t.prototype.syncScorm=function(e,t){var n=this;t=t||this.sitesProvider.getCurrentSiteId();var o,r,i=[],s=0,a=!1;return this.isSyncing(e.id,t)?this.getOngoingSync(e.id,t):this.syncProvider.isBlocked(h.a.COMPONENT,e.id,t)?(this.logger.debug("Cannot sync SCORM "+e.id+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}))):(this.logger.debug("Try to sync SCORM "+e.id+" in site "+t),o=this.scormProvider.getAttemptCount(e.id,!1,!0,t).then(function(o){if(!o.offline||!o.offline.length)return n.finishSync(t,e,i,s,a);r=o;var c=[];o.online.forEach(function(e){s=Math.max(s,e),o.offline.indexOf(e)>-1&&c.push(e)});return(s>0?n.scormProvider.isAttemptIncomplete(e.id,s,!1,!0,t):Promise.resolve(!1)).then(function(u){if(a=!u,c.length||u)return c.length?n.treatCollisions(e.id,c,s,o.offline,t).then(function(o){return i=i.concat(o),n.scormOfflineProvider.getAttempts(e.id,t).then(function(o){var c=[],d=!1;return o=o.map(function(e){return e.attempt}),u&&o.indexOf(s)>-1&&(u=!1),o.forEach(function(o){!u||o<=s?(0==e.maxattempt||o<=e.maxattempt)&&c.push(n.syncAttempt(e.id,o,t)):d=!0}),Promise.all(c).then(function(){return d&&i.push(n.translate.instant("addon.mod_scorm.warningsynconlineincomplete")),n.finishSync(t,e,i,s,a,r,!0)})})}):(i.push(n.translate.instant("addon.mod_scorm.warningsynconlineincomplete")),n.finishSync(t,e,i,s,a,r,!1));var d=[];return o.offline.forEach(function(o){(0==e.maxattempt||o<=e.maxattempt)&&d.push(n.syncAttempt(e.id,o,t))}),Promise.all(d).then(function(){return n.finishSync(t,e,i,s,a,r,!0)})})}),this.addOngoingSync(e.id,o,t))},t.prototype.treatCollisions=function(e,t,n,o,r){var i=this,s=[],a=[],c={},u=Math.max.apply(Math,t),d=Math.max.apply(Math,o);return this.getOfflineAttemptData(e,d,r).then(function(l){var f=[];return t.forEach(function(t){f.push(i.scormOfflineProvider.getScormStoredData(e,t,!1,!0,r).then(function(o){return o&&o.length?i.scormOfflineProvider.getScormStoredData(e,t,!0,!1,r).then(function(o){var u=!1;for(var f in o){if(o[f].element.indexOf(".")>-1){u=!0;break}}return u?i.canRetrySync(e,t,n,r).catch(function(){return i.addToNewOrDelete(e,t,d,a,c,l.timecreated,l.incomplete,s,r)}):i.scormOfflineProvider.deleteAttempt(e,t,r).catch(function(){})}):i.scormOfflineProvider.getAttemptSnapshot(e,t,r).then(function(o){if(o&&Object.keys(o).length){return i.scormProvider.getScormUserData(e,t,void 0,!1,n!=t,r).then(function(n){if(!i.snapshotEquals(o,n))return i.addToNewOrDelete(e,t,d,a,c,l.timecreated,l.incomplete,s,r)})}a.push(t)})}))}),Promise.all(f).then(function(){return i.moveNewAttempts(e,a,n,u,o,r).then(function(){return d+=a.length,i.createNewAttemptsAtEnd(e,c,d,r).then(function(){return s})})})})},t.AUTO_SYNCED="addon_mod_scorm_autom_synced",t=n=v([Object(o.A)(),b("design:paramtypes",[a.a,c.a,i.a,u.a,d.a,r.c,f.a,s.a,h.a,m.a,g.a,l.a])],t);var n}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(9),s=n(12),a=n(46),c=n(7),u=n(2),d=n(45),l=n(11),f=n(6),p=n(10),h=n(69),m=n(151),g=n(201),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,"AddonModWikiSyncProvider",t,n,o,r,i,s)||this;return p.eventsProvider=c,p.wikiProvider=u,p.wikiOfflineProvider=d,p.utils=l,p.groupsProvider=f,p.componentTranslate=a.translateModuleName("wiki"),p}return y(t,e),n=t,t.prototype.getSubwikiBlockId=function(e,t,n,o){return(e=this.wikiOfflineProvider.convertToPositiveNumber(e))&&e>0?String(e):(t=this.wikiOfflineProvider.convertToPositiveNumber(t))?(n=this.wikiOfflineProvider.convertToPositiveNumber(n),o=this.wikiOfflineProvider.convertToPositiveNumber(o),t+":"+n+":"+o):void 0},t.prototype.syncAllWikis=function(e){return this.syncOnSites("all wikis",this.syncAllWikisFunc.bind(this),[],e)},t.prototype.syncAllWikisFunc=function(e){var t=this;return this.wikiOfflineProvider.getAllNewPages(e).then(function(o){var r=[],i={};o.forEach(function(e){var n=t.getSubwikiBlockId(e.subwikiid,e.wikiid,e.userid,e.groupid);i[n]=e});var s=function(o){var s=i[o];r.push(t.syncSubwikiIfNeeded(s.subwikiid,s.wikiid,s.userid,s.groupid,e).then(function(o){o&&o.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{siteId:e,subwikiId:s.subwikiid,wikiId:s.wikiid,userId:s.userid,groupId:s.groupid,created:o.created,discarded:o.discarded,warnings:o.warnings})}))};for(var a in i)s(a);return Promise.all(r)})},t.prototype.syncSubwikiIfNeeded=function(e,t,n,o,r){var i=this,s=this.getSubwikiBlockId(e,t,n,o);return this.isSyncNeeded(s,r).then(function(s){if(s)return i.syncSubwiki(e,t,n,o,r)})},t.prototype.syncSubwiki=function(e,t,n,o,r){var i=this;r=r||this.sitesProvider.getCurrentSiteId();var s={warnings:[],updated:!1,created:[],discarded:[]},a=this.getSubwikiBlockId(e,t,n,o);if(this.isSyncing(a,r))return this.getOngoingSync(a,r);if(this.syncProvider.isBlocked(m.a.COMPONENT,a,r))return this.logger.debug("Cannot sync subwiki "+a+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync subwiki "+a);var c=this.wikiOfflineProvider.getSubwikiNewPages(e,t,n,o,r).catch(function(){return[]}).then(function(a){if(a&&a.length){if(!i.appProvider.isOnline())return Promise.reject(i.translate.instant("core.networkerrormsg"));var c=[];return a.forEach(function(a){c.push(i.wikiProvider.newPageOnline(a.title,a.cachedcontent,e,t,n,o,r).then(function(c){return s.updated=!0,s.created.push({pageId:c,title:a.title}),i.wikiOfflineProvider.deleteNewPage(a.title,e,t,n,o,r)}).catch(function(c){return i.utils.isWebServiceError(c)?i.wikiOfflineProvider.deleteNewPage(a.title,e,t,n,o,r).then(function(){s.updated=!0;var e=i.translate.instant("core.warningofflinedatadeleted",{component:i.translate.instant("addon.mod_wiki.wikipage"),name:a.title,error:c});s.discarded.push({title:a.title,warning:e}),s.warnings.push(e)}):Promise.reject(c)}))}),Promise.all(c)}}).then(function(){return i.setSyncTime(a,r).catch(function(){})}).then(function(){return s});return this.addOngoingSync(a,c,r)},t.prototype.syncWiki=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.wikiProvider.getSubwikis(e).then(function(i){var s=[],a={warnings:[],updated:!1,subwikis:{},siteId:o};return i.forEach(function(e){s.push(r.syncSubwiki(e.id,e.wikiid,e.userid,e.groupid,o).then(function(t){t&&t.updated&&(a.warnings=a.warnings.concat(t.warnings),a.updated=!0,a.subwikis[e.id]={created:t.created,discarded:t.discarded})}))}),Promise.all(s).then(function(){var o=[];return a.updated&&(e&&(o.push(r.wikiProvider.invalidateSubwikis(e)),o.push(r.wikiProvider.invalidateSubwikiPages(e)),o.push(r.wikiProvider.invalidateSubwikiFiles(e))),t&&o.push(r.wikiProvider.invalidateWikiData(t)),n&&(o.push(r.groupsProvider.invalidateActivityAllowedGroups(n)),o.push(r.groupsProvider.invalidateActivityGroupMode(n)))),Promise.all(o).catch(function(){}).then(function(){return a})})})},t.AUTO_SYNCED="addon_mod_wiki_autom_synced",t.MANUAL_SYNCED="addon_mod_wiki_manual_synced",t=n=v([Object(o.A)(),b("design:paramtypes",[c.a,u.a,i.a,d.a,l.a,r.c,p.a,s.a,m.a,g.a,f.a,a.a])],t);var n}(h.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(7),i=n(2),s=n(69),a=n(9),c=n(6),u=n(11),d=n(150),l=n(59),f=n(198),p=n(12),h=n(1),m=n(10),g=n(45),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,"AddonModDataSyncProvider",n,t,o,d,l,a)||this;return p.sitesProvider=t,p.loggerProvider=n,p.appProvider=o,p.dataOffline=r,p.eventsProvider=i,p.dataProvider=s,p.translate=a,p.utils=c,p.textUtils=l,p.dataHelper=f,p.componentTranslate=u.translateModuleName("data"),p}return y(t,e),n=t,t.prototype.hasDataToSync=function(e,t){return this.dataOffline.hasOfflineData(e,t)},t.prototype.syncAllDatabases=function(e){return this.syncOnSites("all databases",this.syncAllDatabasesFunc.bind(this),void 0,e)},t.prototype.syncAllDatabasesFunc=function(e){var t=this;return this.dataOffline.getAllEntries(e).then(function(o){var r={};return o.forEach(function(o){void 0===r[o.dataid]&&(r[o.dataid]=t.syncDatabaseIfNeeded(o.dataid,e).then(function(r){r&&r.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{dataId:o.dataid,warnings:r.warnings},e)}))}),Promise.all(t.utils.objectToArray(r))})},t.prototype.syncDatabaseIfNeeded=function(e,t){var n=this;return this.isSyncNeeded(e,t).then(function(o){if(o)return n.syncDatabase(e,t)})},t.prototype.syncDatabase=function(e,t){var n=this;if(t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncing(e,t))return this.getOngoingSync(e,t);if(this.syncProvider.isBlocked(l.a.COMPONENT,e,t))return this.logger.debug("Cannot sync database '"+e+"' because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync data '"+e+"' in site "+t+"'");var o,r,i={warnings:[],updated:!1},s=this.dataOffline.getDatabaseEntries(e,t).catch(function(){return[]}).then(function(s){if(s.length)return n.appProvider.isOnline()?(o=s[0].courseid,n.dataProvider.getDatabaseById(o,e,t).then(function(e){r=e;var o={};s.forEach(function(e){void 0===o[e.entryid]&&(o[e.entryid]=[]),o[e.entryid].push(e)});var a=n.utils.objectToArray(o).map(function(e){return n.syncEntry(r,e,i,t)});return Promise.all(a)}).then(function(){if(i.updated)return n.dataProvider.invalidateContent(r.cmid,o,t).catch(function(){})})):Promise.reject(null)}).then(function(){return n.setSyncTime(e,t)}).then(function(){return i});return this.addOngoingSync(e,s,t)},t.prototype.syncEntry=function(e,t,o,r){var i,s,a,c=this,u=0,d=!1,l=[];return t=t.sort(function(e,t){return e.timemodified-t.timemodified}),(u=t[0].entryid)>0?s=this.dataProvider.getEntry(e.id,u,r).then(function(e){return e.entry.timemodified}).catch(function(){return-1}):(a=u,s=Promise.resolve(0)),s.then(function(n){return n<0||n>=t[0].timemodified?(o.updated=!0,i=c.translate.instant("addon.mod_data.warningsubmissionmodified"),c.dataOffline.deleteAllEntryActions(e.id,u,r)):(t.forEach(function(t){var n,s=[];u=t.entryid>0?t.entryid:u,t.fields&&t.fields.forEach(function(e){var n=c.textUtils.parseJSON(e.value);if(n.online||n.offline){var o=n.online||[],i=n.offline?c.dataHelper.getStoredFiles(t.dataid,u,e.fieldid):Promise.resolve([]);s.push(i.then(function(n){return o=o.concat(n),c.dataHelper.uploadOrStoreFiles(t.dataid,0,u,e.fieldid,o,!1,r).then(function(t){e.value=JSON.stringify(t)})}))}}),n=Promise.all(s).then(function(){switch(t.action){case"add":return c.dataProvider.addEntryOnline(t.dataid,t.fields,e.groupid,r).then(function(e){u=e.newentryid});case"edit":return c.dataProvider.editEntryOnline(u,t.fields,r);case"approve":return c.dataProvider.approveEntryOnline(u,!0,r);case"disapprove":return c.dataProvider.approveEntryOnline(u,!1,r);case"delete":return c.dataProvider.deleteEntryOnline(u,r).then(function(){d=!0})}}),l.push(n.catch(function(e){if(!e||!e.wserror)return Promise.reject(e&&e.error);i=e.error}).then(function(){return o.updated=!0,c.dataOffline.deleteEntry(t.dataid,t.entryid,t.action,r)}))}),Promise.all(l))}).then(function(){if(i){var t=c.translate.instant("core.warningofflinedatadeleted",{component:c.componentTranslate,name:e.name,error:i});-1==o.warnings.indexOf(t)&&o.warnings.push(t)}c.eventsProvider.trigger(n.AUTO_SYNCED,{dataId:e.id,entryId:u,offlineEntryId:a,warnings:o.warnings,deleted:d},r)})},t.AUTO_SYNCED="addon_mod_data_autom_synced",t=n=v([Object(o.A)(),b("design:paramtypes",[i.a,r.a,a.a,d.a,p.a,l.a,h.c,c.a,m.a,g.a,u.a,f.a])],t);var n}(s.a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(624),i=n(4),s=n(625),a=n(1011),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){this.sqlite=e,this.platform=t,this.dbInstances={}}return e.prototype.getDB=function(e,t){return(void 0===this.dbInstances[e]||t)&&(this.dbInstances[e]=this.platform.is("cordova")?new s.a(e,this.sqlite,this.platform):new a.a(e)),this.dbInstances[e]},e.prototype.deleteDB=function(e){var t=this;return(void 0!==this.dbInstances[e]?this.dbInstances[e].close():Promise.resolve()).then(function(){var n=t.dbInstances[e];return delete t.dbInstances[e],t.platform.is("cordova")?t.sqlite.deleteDatabase({name:e,location:"default"}):n.emptyDatabase()})},e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.s])],e)}()},,,,,,,,,,,function(e,t){},,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return t=e,e.prototype.intercept=function(e,n){var o=e.clone({headers:e.headers.set("Content-Type","application/x-www-form-urlencoded"),body:"object"==typeof e.body&&"[object File]"!=String(e.body)?t.serialize(e.body):e.body});return n.handle(o)},e.serialize=function(e,t){var n,o="";for(var r in e){var i=e[r];if(i instanceof Array)for(var s=0;s<i.length;++s)(n={})[r+"["+s+"]"]=i[s],o+=this.serialize(n)+"&";else if(i instanceof Object)for(var a in i)(n={})[r+"["+a+"]"]=i[a],o+=this.serialize(n)+"&";else(t||void 0!==i&&null!==i)&&(o+=encodeURIComponent(r)+"="+encodeURIComponent(i)+"&")}return o.length?o.substr(0,o.length-1):o},e=t=r([Object(o.A)(),i("design:paramtypes",[])],e);var t}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(12),i=n(7),s=n(2),a=n(58),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var i=e.call(this,"CoreFileUploaderDelegate",t,n,o)||this;return i.sitesProvider=n,i.eventsProvider=o,o.on(r.a.LOGOUT,i.clearSiteHandlers.bind(i)),i}return c(t,e),t.prototype.clearSiteHandlers=function(){this.enabledHandlers={}},t.prototype.getHandlers=function(e){var t=[];for(var n in this.enabledHandlers){var o=this.enabledHandlers[n],r=void 0;if(e){if(!o.getSupportedMimetypes)continue;if(!(r=o.getSupportedMimetypes(e)).length)continue}var i=o.getData();i.priority=o.priority,i.mimetypes=r,t.push(i)}return t},t=u([Object(o.A)(),d("design:paramtypes",[i.a,s.a,r.a])],t)}(a.a)},,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(2),s=n(9),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,n,o){this.sitesProvider=n,this.appProvider=o,this.tablesSchema=[{name:t.MESSAGES_TABLE,columns:[{name:"touserid",type:"INTEGER"},{name:"useridfrom",type:"INTEGER"},{name:"smallmessage",type:"TEXT"},{name:"timecreated",type:"INTEGER"},{name:"deviceoffline",type:"INTEGER"}],primaryKeys:["touserid","smallmessage","timecreated"]}],this.logger=e.getInstance("AddonMessagesOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteMessage=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){return r.getDb().deleteRecords(t.MESSAGES_TABLE,{touserid:e,smallmessage:n,timecreated:o})})},e.prototype.getAllDeviceOfflineMessages=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.MESSAGES_TABLE,{deviceoffline:1})})},e.prototype.getMessages=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.MESSAGES_TABLE,{touserid:e})})},e.prototype.getAllMessages=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getAllRecords(t.MESSAGES_TABLE)})},e.prototype.hasMessages=function(e,t){return this.getMessages(e,t).then(function(e){return!!e.length})},e.prototype.saveMessage=function(e,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={touserid:e,useridfrom:o.getUserId(),smallmessage:n,timecreated:(new Date).getTime(),deviceoffline:r.appProvider.isOnline()?0:1};return o.getDb().insertRecord(t.MESSAGES_TABLE,i).then(function(){return i})})},e.prototype.setMessagesDeviceOffline=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r=o.getDb(),i=[],s={deviceoffline:n?1:0};return e.forEach(function(e){i.push(r.insertRecord(t.MESSAGES_TABLE,s))}),Promise.all(i)})},e.MESSAGES_TABLE="addon_messages_offline_messages",e=t=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(10),i=n(35),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.courseProvider=e,this.moduleDelegate=t}return e.prototype.ngOnInit=function(){this.isDisabledInSite=this.moduleDelegate.isModuleDisabledInSite(this.module.modname),this.isSupportedByTheApp=this.moduleDelegate.hasHandler(this.module.modname),this.moduleName=this.courseProvider.translateModuleName(this.module.modname)},s([Object(o.D)(),a("design:type",Object)],e.prototype,"course",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"module",void 0),e=s([Object(o.m)({selector:"core-course-unsupported-module",template:'<div padding>\n    <core-course-module-description [description]="module.description"></core-course-module-description>\n    <h2 *ngIf="!isDisabledInSite && isSupportedByTheApp">{{ \'core.whoops\' | translate }}</h2>\n    <h2 *ngIf="isDisabledInSite || !isSupportedByTheApp">{{ \'core.uhoh\' | translate }}</h2>\n\n    <p class="core-big" *ngIf="isDisabledInSite">{{ \'core.course.activitydisabled\' | translate }}</p>\n    <p class="core-big" *ngIf="!isDisabledInSite && isSupportedByTheApp">{{ \'core.course.activitynotyetviewablesiteupgradeneeded\' | translate }}</p>\n    <p class="core-big" *ngIf="!isDisabledInSite && !isSupportedByTheApp">{{ \'core.course.activitynotyetviewableremoteaddon\' | translate }}</p>\n    <p *ngIf="isDisabledInSite || !isSupportedByTheApp"><strong>{{ \'core.course.askadmintosupport\' | translate }}</strong></p>\n\n    <div *ngIf="module.url">\n        <p><strong>{{ \'core.course.useactivityonbrowser\' | translate }}</strong></p>\n        <a ion-button block icon-end [href]="module.url" core-link>\n            {{ \'core.openinbrowser\' | translate }}\n            <ion-icon name="open"></ion-icon>\n        </a>\n    </div>\n</div>'}),a("design:paramtypes",[r.a,i.a])],e)}()},function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return CoreCompileProvider});var __WEBPACK_IMPORTED_MODULE_0__angular_core__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__angular_platform_browser_dynamic__=__webpack_require__(263),__WEBPACK_IMPORTED_MODULE_2_ionic_angular__=__webpack_require__(4),__WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_4__providers_logger__=__webpack_require__(7),__WEBPACK_IMPORTED_MODULE_5__app_app_module__=__webpack_require__(436),__WEBPACK_IMPORTED_MODULE_6__core_contentlinks_contentlinks_module__=__webpack_require__(743),__WEBPACK_IMPORTED_MODULE_7__core_course_course_module__=__webpack_require__(744),__WEBPACK_IMPORTED_MODULE_8__core_courses_courses_module__=__webpack_require__(746),__WEBPACK_IMPORTED_MODULE_9__core_fileuploader_fileuploader_module__=__webpack_require__(747),__WEBPACK_IMPORTED_MODULE_10__core_grades_grades_module__=__webpack_require__(748),__WEBPACK_IMPORTED_MODULE_11__core_login_login_module__=__webpack_require__(750),__WEBPACK_IMPORTED_MODULE_12__core_mainmenu_mainmenu_module__=__webpack_require__(751),__WEBPACK_IMPORTED_MODULE_13__core_question_question_module__=__webpack_require__(752),__WEBPACK_IMPORTED_MODULE_14__core_sharedfiles_sharedfiles_module__=__webpack_require__(757),__WEBPACK_IMPORTED_MODULE_15__core_sitehome_sitehome_module__=__webpack_require__(758),__WEBPACK_IMPORTED_MODULE_16__core_user_user_module__=__webpack_require__(759),__WEBPACK_IMPORTED_MODULE_17__core_emulator_emulator_module__=__webpack_require__(761),__WEBPACK_IMPORTED_MODULE_18__core_siteplugins_providers_siteplugins__=__webpack_require__(50),__WEBPACK_IMPORTED_MODULE_19__angular_platform_browser__=__webpack_require__(82),__WEBPACK_IMPORTED_MODULE_20__angular_forms__=__webpack_require__(20),__WEBPACK_IMPORTED_MODULE_21__angular_http__=__webpack_require__(144),__WEBPACK_IMPORTED_MODULE_22__angular_common_http__=__webpack_require__(154),__WEBPACK_IMPORTED_MODULE_23__configconstants__=__webpack_require__(72),__WEBPACK_IMPORTED_MODULE_24__core_constants__=__webpack_require__(30),__WEBPACK_IMPORTED_MODULE_25_moment__=__webpack_require__(5),__WEBPACK_IMPORTED_MODULE_25_moment___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_25_moment__),__WEBPACK_IMPORTED_MODULE_26_ts_md5_dist_md5__=__webpack_require__(109),__WEBPACK_IMPORTED_MODULE_26_ts_md5_dist_md5___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_26_ts_md5_dist_md5__),__WEBPACK_IMPORTED_MODULE_27__classes_base_sync__=__webpack_require__(69),__WEBPACK_IMPORTED_MODULE_28__classes_cache__=__webpack_require__(729),__WEBPACK_IMPORTED_MODULE_29__classes_delegate__=__webpack_require__(58),__WEBPACK_IMPORTED_MODULE_30__core_contentlinks_classes_base_handler__=__webpack_require__(31),__WEBPACK_IMPORTED_MODULE_31__core_contentlinks_classes_module_grade_handler__=__webpack_require__(235),__WEBPACK_IMPORTED_MODULE_32__core_contentlinks_classes_module_index_handler__=__webpack_require__(44),__WEBPACK_IMPORTED_MODULE_33__core_course_classes_activity_prefetch_handler__=__webpack_require__(76),__WEBPACK_IMPORTED_MODULE_34__core_course_classes_resource_prefetch_handler__=__webpack_require__(159),__WEBPACK_IMPORTED_MODULE_35__components_components_module__=__webpack_require__(16),__WEBPACK_IMPORTED_MODULE_36__directives_directives_module__=__webpack_require__(15),__WEBPACK_IMPORTED_MODULE_37__pipes_pipes_module__=__webpack_require__(66),__WEBPACK_IMPORTED_MODULE_38__core_course_components_components_module__=__webpack_require__(42),__WEBPACK_IMPORTED_MODULE_39__core_course_directives_directives_module__=__webpack_require__(1465),__WEBPACK_IMPORTED_MODULE_40__core_courses_components_components_module__=__webpack_require__(931),__WEBPACK_IMPORTED_MODULE_41__core_siteplugins_directives_directives_module__=__webpack_require__(1467),__WEBPACK_IMPORTED_MODULE_42__core_sitehome_components_components_module__=__webpack_require__(938),__WEBPACK_IMPORTED_MODULE_43__core_user_components_components_module__=__webpack_require__(393),__WEBPACK_IMPORTED_MODULE_44__core_question_components_components_module__=__webpack_require__(939),__WEBPACK_IMPORTED_MODULE_45__core_course_components_unsupported_module_unsupported_module__=__webpack_require__(328),__WEBPACK_IMPORTED_MODULE_46__core_course_formats_singleactivity_components_singleactivity__=__webpack_require__(330),__WEBPACK_IMPORTED_MODULE_47__core_siteplugins_components_module_index_module_index__=__webpack_require__(256),__WEBPACK_IMPORTED_MODULE_48__core_siteplugins_components_course_option_course_option__=__webpack_require__(339),__WEBPACK_IMPORTED_MODULE_49__core_siteplugins_components_course_format_course_format__=__webpack_require__(340),__WEBPACK_IMPORTED_MODULE_50__core_siteplugins_components_question_question__=__webpack_require__(341),__WEBPACK_IMPORTED_MODULE_51__core_siteplugins_components_question_behaviour_question_behaviour__=__webpack_require__(342),__WEBPACK_IMPORTED_MODULE_52__core_siteplugins_components_user_profile_field_user_profile_field__=__webpack_require__(343),__WEBPACK_IMPORTED_MODULE_53__core_siteplugins_components_quiz_access_rule_quiz_access_rule__=__webpack_require__(344),__WEBPACK_IMPORTED_MODULE_54__core_siteplugins_components_assign_feedback_assign_feedback__=__webpack_require__(345),__WEBPACK_IMPORTED_MODULE_55__core_siteplugins_components_assign_submission_assign_submission__=__webpack_require__(346),__WEBPACK_IMPORTED_MODULE_56__addon_badges_badges_module__=__webpack_require__(793),__WEBPACK_IMPORTED_MODULE_57__addon_calendar_calendar_module__=__webpack_require__(794),__WEBPACK_IMPORTED_MODULE_58__addon_competency_competency_module__=__webpack_require__(795),__WEBPACK_IMPORTED_MODULE_59__addon_files_files_module__=__webpack_require__(796),__WEBPACK_IMPORTED_MODULE_60__addon_messageoutput_messageoutput_module__=__webpack_require__(797),__WEBPACK_IMPORTED_MODULE_61__addon_messages_messages_module__=__webpack_require__(798),__WEBPACK_IMPORTED_MODULE_62__addon_mod_assign_assign_module__=__webpack_require__(801),__WEBPACK_IMPORTED_MODULE_63__addon_mod_book_book_module__=__webpack_require__(810),__WEBPACK_IMPORTED_MODULE_64__addon_mod_chat_chat_module__=__webpack_require__(811),__WEBPACK_IMPORTED_MODULE_65__addon_mod_choice_choice_module__=__webpack_require__(812),__WEBPACK_IMPORTED_MODULE_66__addon_mod_feedback_feedback_module__=__webpack_require__(813),__WEBPACK_IMPORTED_MODULE_67__addon_mod_folder_folder_module__=__webpack_require__(814),__WEBPACK_IMPORTED_MODULE_68__addon_mod_forum_forum_module__=__webpack_require__(816),__WEBPACK_IMPORTED_MODULE_69__addon_mod_glossary_glossary_module__=__webpack_require__(818),__WEBPACK_IMPORTED_MODULE_70__addon_mod_imscp_imscp_module__=__webpack_require__(820),__WEBPACK_IMPORTED_MODULE_71__addon_mod_lesson_lesson_module__=__webpack_require__(823),__WEBPACK_IMPORTED_MODULE_72__addon_mod_lti_lti_module__=__webpack_require__(824),__WEBPACK_IMPORTED_MODULE_73__addon_mod_page_page_module__=__webpack_require__(825),__WEBPACK_IMPORTED_MODULE_74__addon_mod_quiz_quiz_module__=__webpack_require__(827),__WEBPACK_IMPORTED_MODULE_75__addon_mod_resource_resource_module__=__webpack_require__(831),__WEBPACK_IMPORTED_MODULE_76__addon_mod_scorm_scorm_module__=__webpack_require__(833),__WEBPACK_IMPORTED_MODULE_77__addon_mod_survey_survey_module__=__webpack_require__(834),__WEBPACK_IMPORTED_MODULE_78__addon_mod_url_url_module__=__webpack_require__(835),__WEBPACK_IMPORTED_MODULE_79__addon_mod_wiki_wiki_module__=__webpack_require__(836),__WEBPACK_IMPORTED_MODULE_80__addon_mod_workshop_workshop_module__=__webpack_require__(838),__WEBPACK_IMPORTED_MODULE_81__addon_notes_notes_module__=__webpack_require__(843),__WEBPACK_IMPORTED_MODULE_82__addon_notifications_notifications_module__=__webpack_require__(845),__WEBPACK_IMPORTED_MODULE_83__addon_pushnotifications_pushnotifications_module__=__webpack_require__(846),__WEBPACK_IMPORTED_MODULE_84__addon_remotethemes_remotethemes_module__=__webpack_require__(847),__WEBPACK_IMPORTED_MODULE_85__addon_mod_assign_components_components_module__=__webpack_require__(933),__WEBPACK_IMPORTED_MODULE_86__addon_mod_workshop_components_components_module__=__webpack_require__(394),__decorate=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},CoreCompileProvider=function(){function CoreCompileProvider(e,t,n){this.injector=e,this.OTHER_PROVIDERS=[__WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__.c,__WEBPACK_IMPORTED_MODULE_21__angular_http__.a,__WEBPACK_IMPORTED_MODULE_22__angular_common_http__.b,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.s,__WEBPACK_IMPORTED_MODULE_19__angular_platform_browser__.c,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.a,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.b,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.n,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.o,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.t,__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.A,__WEBPACK_IMPORTED_MODULE_20__angular_forms__.a],this.IMPORTS=[__WEBPACK_IMPORTED_MODULE_2_ionic_angular__.k,__WEBPACK_IMPORTED_MODULE_3__ngx_translate_core__.b.forChild(),__WEBPACK_IMPORTED_MODULE_35__components_components_module__.a,__WEBPACK_IMPORTED_MODULE_36__directives_directives_module__.a,__WEBPACK_IMPORTED_MODULE_37__pipes_pipes_module__.a,__WEBPACK_IMPORTED_MODULE_38__core_course_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_40__core_courses_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_42__core_sitehome_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_43__core_user_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_39__core_course_directives_directives_module__.a,__WEBPACK_IMPORTED_MODULE_41__core_siteplugins_directives_directives_module__.a,__WEBPACK_IMPORTED_MODULE_44__core_question_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_85__addon_mod_assign_components_components_module__.a,__WEBPACK_IMPORTED_MODULE_86__addon_mod_workshop_components_components_module__.a],this.logger=t.getInstance("CoreCompileProvider"),this.compiler=n.createCompiler()}return CoreCompileProvider.prototype.createAndCompileComponent=function(e,t,n){void 0===n&&(n=[]);var o=Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__.m)({template:e})(t),r=this.IMPORTS.concat(n),i=Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__.I)({imports:r,declarations:[o]})(function(){return function(){}}());return this.compiler.compileModuleAndAllComponentsAsync(i).then(function(e){for(var t in e.componentFactories){var n=e.componentFactories[t];if(n.componentType==o)return n}})},CoreCompileProvider.prototype.evalInContext=function(javascript){return eval(javascript)},CoreCompileProvider.prototype.executeJavascript=function(e,t){try{return this.evalInContext.call(e,t)}catch(e){this.logger.error("Error evaluating javascript",e)}},CoreCompileProvider.prototype.injectLibraries=function(e,t){void 0===t&&(t=[]);var n=__WEBPACK_IMPORTED_MODULE_5__app_app_module__.b.concat(__WEBPACK_IMPORTED_MODULE_6__core_contentlinks_contentlinks_module__.a).concat(__WEBPACK_IMPORTED_MODULE_7__core_course_course_module__.a).concat(__WEBPACK_IMPORTED_MODULE_8__core_courses_courses_module__.a).concat(__WEBPACK_IMPORTED_MODULE_9__core_fileuploader_fileuploader_module__.a).concat(__WEBPACK_IMPORTED_MODULE_10__core_grades_grades_module__.a).concat(__WEBPACK_IMPORTED_MODULE_11__core_login_login_module__.a).concat(__WEBPACK_IMPORTED_MODULE_12__core_mainmenu_mainmenu_module__.a).concat(__WEBPACK_IMPORTED_MODULE_14__core_sharedfiles_sharedfiles_module__.a).concat(__WEBPACK_IMPORTED_MODULE_15__core_sitehome_sitehome_module__.a).concat([__WEBPACK_IMPORTED_MODULE_18__core_siteplugins_providers_siteplugins__.a]).concat(__WEBPACK_IMPORTED_MODULE_16__core_user_user_module__.a).concat(__WEBPACK_IMPORTED_MODULE_13__core_question_question_module__.a).concat(__WEBPACK_IMPORTED_MODULE_17__core_emulator_emulator_module__.b).concat(this.OTHER_PROVIDERS).concat(t).concat(__WEBPACK_IMPORTED_MODULE_56__addon_badges_badges_module__.a).concat(__WEBPACK_IMPORTED_MODULE_57__addon_calendar_calendar_module__.a).concat(__WEBPACK_IMPORTED_MODULE_58__addon_competency_competency_module__.a).concat(__WEBPACK_IMPORTED_MODULE_59__addon_files_files_module__.a).concat(__WEBPACK_IMPORTED_MODULE_60__addon_messageoutput_messageoutput_module__.a).concat(__WEBPACK_IMPORTED_MODULE_61__addon_messages_messages_module__.a).concat(__WEBPACK_IMPORTED_MODULE_62__addon_mod_assign_assign_module__.a).concat(__WEBPACK_IMPORTED_MODULE_63__addon_mod_book_book_module__.a).concat(__WEBPACK_IMPORTED_MODULE_64__addon_mod_chat_chat_module__.a).concat(__WEBPACK_IMPORTED_MODULE_65__addon_mod_choice_choice_module__.a).concat(__WEBPACK_IMPORTED_MODULE_66__addon_mod_feedback_feedback_module__.a).concat(__WEBPACK_IMPORTED_MODULE_67__addon_mod_folder_folder_module__.a).concat(__WEBPACK_IMPORTED_MODULE_68__addon_mod_forum_forum_module__.a).concat(__WEBPACK_IMPORTED_MODULE_69__addon_mod_glossary_glossary_module__.a).concat(__WEBPACK_IMPORTED_MODULE_70__addon_mod_imscp_imscp_module__.a).concat(__WEBPACK_IMPORTED_MODULE_71__addon_mod_lesson_lesson_module__.a).concat(__WEBPACK_IMPORTED_MODULE_72__addon_mod_lti_lti_module__.a).concat(__WEBPACK_IMPORTED_MODULE_73__addon_mod_page_page_module__.a).concat(__WEBPACK_IMPORTED_MODULE_74__addon_mod_quiz_quiz_module__.a).concat(__WEBPACK_IMPORTED_MODULE_75__addon_mod_resource_resource_module__.a).concat(__WEBPACK_IMPORTED_MODULE_76__addon_mod_scorm_scorm_module__.a).concat(__WEBPACK_IMPORTED_MODULE_77__addon_mod_survey_survey_module__.a).concat(__WEBPACK_IMPORTED_MODULE_78__addon_mod_url_url_module__.a).concat(__WEBPACK_IMPORTED_MODULE_79__addon_mod_wiki_wiki_module__.a).concat(__WEBPACK_IMPORTED_MODULE_80__addon_mod_workshop_workshop_module__.a).concat(__WEBPACK_IMPORTED_MODULE_81__addon_notes_notes_module__.a).concat(__WEBPACK_IMPORTED_MODULE_82__addon_notifications_notifications_module__.a).concat(__WEBPACK_IMPORTED_MODULE_83__addon_pushnotifications_pushnotifications_module__.a).concat(__WEBPACK_IMPORTED_MODULE_84__addon_remotethemes_remotethemes_module__.a);for(var o in n){var r=n[o];if("function"==typeof r&&r.name)try{e[r.name]=this.injector.get(r)}catch(e){this.logger.warn("Error injecting provider",r.name,e)}}e.CoreCompileProvider=this,e.injector=this.injector,e.Validators=__WEBPACK_IMPORTED_MODULE_20__angular_forms__.h,e.CoreConfigConstants=__WEBPACK_IMPORTED_MODULE_23__configconstants__.a,e.CoreConstants=__WEBPACK_IMPORTED_MODULE_24__core_constants__.a,e.moment=__WEBPACK_IMPORTED_MODULE_25_moment__,e.Md5=__WEBPACK_IMPORTED_MODULE_26_ts_md5_dist_md5__.Md5,e.CoreSyncBaseProvider=__WEBPACK_IMPORTED_MODULE_27__classes_base_sync__.a,e.CoreCache=__WEBPACK_IMPORTED_MODULE_28__classes_cache__.a,e.CoreDelegate=__WEBPACK_IMPORTED_MODULE_29__classes_delegate__.a,e.CoreContentLinksHandlerBase=__WEBPACK_IMPORTED_MODULE_30__core_contentlinks_classes_base_handler__.a,e.CoreContentLinksModuleGradeHandler=__WEBPACK_IMPORTED_MODULE_31__core_contentlinks_classes_module_grade_handler__.a,e.CoreContentLinksModuleIndexHandler=__WEBPACK_IMPORTED_MODULE_32__core_contentlinks_classes_module_index_handler__.a,e.CoreCourseActivityPrefetchHandlerBase=__WEBPACK_IMPORTED_MODULE_33__core_course_classes_activity_prefetch_handler__.a,e.CoreCourseResourcePrefetchHandlerBase=__WEBPACK_IMPORTED_MODULE_34__core_course_classes_resource_prefetch_handler__.a,e.CoreCourseUnsupportedModuleComponent=__WEBPACK_IMPORTED_MODULE_45__core_course_components_unsupported_module_unsupported_module__.a,e.CoreCourseFormatSingleActivityComponent=__WEBPACK_IMPORTED_MODULE_46__core_course_formats_singleactivity_components_singleactivity__.a,e.CoreSitePluginsModuleIndexComponent=__WEBPACK_IMPORTED_MODULE_47__core_siteplugins_components_module_index_module_index__.a,e.CoreSitePluginsCourseOptionComponent=__WEBPACK_IMPORTED_MODULE_48__core_siteplugins_components_course_option_course_option__.a,e.CoreSitePluginsCourseFormatComponent=__WEBPACK_IMPORTED_MODULE_49__core_siteplugins_components_course_format_course_format__.a,e.CoreSitePluginsQuestionComponent=__WEBPACK_IMPORTED_MODULE_50__core_siteplugins_components_question_question__.a,e.CoreSitePluginsQuestionBehaviourComponent=__WEBPACK_IMPORTED_MODULE_51__core_siteplugins_components_question_behaviour_question_behaviour__.a,e.CoreSitePluginsUserProfileFieldComponent=__WEBPACK_IMPORTED_MODULE_52__core_siteplugins_components_user_profile_field_user_profile_field__.a,e.CoreSitePluginsQuizAccessRuleComponent=__WEBPACK_IMPORTED_MODULE_53__core_siteplugins_components_quiz_access_rule_quiz_access_rule__.a,e.CoreSitePluginsAssignFeedbackComponent=__WEBPACK_IMPORTED_MODULE_54__core_siteplugins_components_assign_feedback_assign_feedback__.a,e.CoreSitePluginsAssignSubmissionComponent=__WEBPACK_IMPORTED_MODULE_55__core_siteplugins_components_assign_submission_assign_submission__.a},CoreCompileProvider.prototype.instantiateDynamicComponent=function(e,t,n){return n=n||this.injector,this.createAndCompileComponent(e,t).then(function(e){if(e)return e.create(n,void 0,void 0,n.get(__WEBPACK_IMPORTED_MODULE_0__angular_core__.K))})},CoreCompileProvider=__decorate([Object(__WEBPACK_IMPORTED_MODULE_0__angular_core__.A)(),__metadata("design:paramtypes",[__WEBPACK_IMPORTED_MODULE_0__angular_core__.C,__WEBPACK_IMPORTED_MODULE_4__providers_logger__.a,__WEBPACK_IMPORTED_MODULE_1__angular_platform_browser_dynamic__.a])],CoreCompileProvider)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(35),i=n(328),s=n(156),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.moduleDelegate=e,this.injector=t,this.data={}}return e.prototype.ngOnChanges=function(e){var t=this;if(this.course&&this.sections&&this.sections.length){var n=this.sections[0]&&this.sections[0].modules&&this.sections[0].modules[0];n&&!this.componentClass&&this.moduleDelegate.getMainComponent(this.injector,this.course,n).then(function(e){t.componentClass=e||i.a}),this.data.courseId=this.course.id,this.data.module=n}},e.prototype.doRefresh=function(e,t){return Promise.resolve(this.dynamicComponent.callComponentFunction("doRefresh",[e,t]))},e.prototype.ionViewDidEnter=function(){this.dynamicComponent.callComponentFunction("ionViewDidEnter")},e.prototype.ionViewDidLeave=function(){this.dynamicComponent.callComponentFunction("ionViewDidLeave")},a([Object(o.D)(),c("design:type",Object)],e.prototype,"course",void 0),a([Object(o.D)(),c("design:type",Array)],e.prototype,"sections",void 0),a([Object(o.D)(),c("design:type",Boolean)],e.prototype,"downloadEnabled",void 0),a([Object(o._9)(s.a),c("design:type",s.a)],e.prototype,"dynamicComponent",void 0),e=a([Object(o.m)({selector:"core-course-format-single-activity",template:'<core-dynamic-component [component]="componentClass" [data]="data"></core-dynamic-component>\n'}),c("design:paramtypes",[r.a,o.C])],e)}()},,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(50),i=n(120),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.sitePluginsProvider=e}return e.prototype.ngOnInit=function(){if(this.handlerUniqueName){var e=this.sitePluginsProvider.getSitePluginHandler(this.handlerUniqueName);e&&(this.component=e.plugin.component,this.method=e.handlerSchema.method,this.args={courseid:this.courseId},this.initResult=e.initResult)}},e.prototype.refreshData=function(e){this.content.refreshContent(!1).finally(function(){e.complete()})},s([Object(o.D)(),a("design:type",Number)],e.prototype,"courseId",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"handlerUniqueName",void 0),s([Object(o._9)(i.a),a("design:type",i.a)],e.prototype,"content",void 0),e=s([Object(o.m)({selector:"core-site-plugins-course-option",template:'<ion-content>\n    <ion-refresher [enabled]="content && content.dataLoaded" (ionRefresh)="refreshData($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-site-plugins-plugin-content *ngIf="component && method" [component]="component" [method]="method" [args]="args" [initResult]="initResult"></core-site-plugins-plugin-content>\n</ion-content>'}),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(50),i=n(120),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.sitePluginsProvider=e}return e.prototype.ngOnChanges=function(){if(this.course&&this.course.format){if(!this.component){var e=this.sitePluginsProvider.getSitePluginHandler(this.course.format);e&&(this.component=e.plugin.component,this.method=e.handlerSchema.method,this.args={courseid:this.course.id,downloadenabled:this.downloadEnabled},this.initResult=e.initResult)}this.data={course:this.course,sections:this.sections,downloadEnabled:this.downloadEnabled,initialSectionId:this.initialSectionId,initialSectionNumber:this.initialSectionNumber}}},e.prototype.doRefresh=function(e,t){return Promise.resolve(this.content.refreshContent(!1))},s([Object(o.D)(),a("design:type",Object)],e.prototype,"course",void 0),s([Object(o.D)(),a("design:type",Array)],e.prototype,"sections",void 0),s([Object(o.D)(),a("design:type",Boolean)],e.prototype,"downloadEnabled",void 0),s([Object(o.D)(),a("design:type",Number)],e.prototype,"initialSectionId",void 0),s([Object(o.D)(),a("design:type",Number)],e.prototype,"initialSectionNumber",void 0),s([Object(o._9)(i.a),a("design:type",i.a)],e.prototype,"content",void 0),e=s([Object(o.m)({selector:"core-site-plugins-course-format",template:'<core-site-plugins-plugin-content *ngIf="component && method" [component]="component" [method]="method" [args]="args" [initResult]="initResult" [data]="data"></core-site-plugins-plugin-content>'}),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={question:this.question,component:this.component,componentId:this.componentId,attemptId:this.attemptId,offlineEnabled:this.offlineEnabled,buttonClicked:this.buttonClicked,onAbort:this.onAbort},this.question&&this.getHandlerData("qtype_"+this.question.type)},a([Object(o.D)(),c("design:type",Object)],t.prototype,"question",void 0),a([Object(o.D)(),c("design:type",String)],t.prototype,"component",void 0),a([Object(o.D)(),c("design:type",Number)],t.prototype,"componentId",void 0),a([Object(o.D)(),c("design:type",Number)],t.prototype,"attemptId",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"offlineEnabled",void 0),a([Object(o.O)(),c("design:type",o.v)],t.prototype,"buttonClicked",void 0),a([Object(o.O)(),c("design:type",o.v)],t.prototype,"onAbort",void 0),t=a([Object(o.m)({selector:"core-site-plugins-question",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={question:this.question,component:this.component,componentId:this.componentId,attemptId:this.attemptId,offlineEnabled:this.offlineEnabled,buttonClicked:this.buttonClicked,onAbort:this.onAbort},this.question&&this.getHandlerData("qbehaviour_"+this.question.preferredBehaviour)},a([Object(o.D)(),c("design:type",Object)],t.prototype,"question",void 0),a([Object(o.D)(),c("design:type",String)],t.prototype,"component",void 0),a([Object(o.D)(),c("design:type",Number)],t.prototype,"componentId",void 0),a([Object(o.D)(),c("design:type",Number)],t.prototype,"attemptId",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"offlineEnabled",void 0),a([Object(o.O)(),c("design:type",o.v)],t.prototype,"buttonClicked",void 0),a([Object(o.O)(),c("design:type",o.v)],t.prototype,"onAbort",void 0),t=a([Object(o.m)({selector:"core-site-plugins-question-behaviour",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.signup=!1,n.edit=!1,n}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={field:this.field,signup:this.signup,edit:this.edit,form:this.form,registerAuth:this.registerAuth},this.field&&this.getHandlerData("profilefield_"+(this.field.type||this.field.datatype))},a([Object(o.D)(),c("design:type",Object)],t.prototype,"field",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"signup",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"edit",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"form",void 0),a([Object(o.D)(),c("design:type",String)],t.prototype,"registerAuth",void 0),t=a([Object(o.m)({selector:"core-site-plugins-user-profile-field",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(50),i=n(147),s=n(20),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t){return e.call(this,t)||this}return a(t,e),t.prototype.ngOnInit=function(){this.jsData={rule:this.rule,quiz:this.quiz,attempt:this.attempt,prefetch:this.prefetch,siteId:this.siteId,form:this.form},this.rule&&this.getHandlerData(this.rule)},c([Object(o.D)(),u("design:type",String)],t.prototype,"rule",void 0),c([Object(o.D)(),u("design:type",Object)],t.prototype,"quiz",void 0),c([Object(o.D)(),u("design:type",Object)],t.prototype,"attempt",void 0),c([Object(o.D)(),u("design:type",Boolean)],t.prototype,"prefetch",void 0),c([Object(o.D)(),u("design:type",String)],t.prototype,"siteId",void 0),c([Object(o.D)(),u("design:type",s.c)],t.prototype,"form",void 0),t=c([Object(o.m)({selector:"core-site-plugins-quiz-access-rule",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),u("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={assign:this.assign,submission:this.submission,plugin:this.plugin,userId:this.userId,configs:this.configs,edit:this.edit,canEdit:this.canEdit},this.plugin&&this.getHandlerData("assignfeedback_"+this.plugin.type)},t.prototype.invalidate=function(){return Promise.resolve()},a([Object(o.D)(),c("design:type",Object)],t.prototype,"assign",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"submission",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"plugin",void 0),a([Object(o.D)(),c("design:type",Number)],t.prototype,"userId",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"configs",void 0),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"canEdit",void 0),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"edit",void 0),t=a([Object(o.m)({selector:"core-site-plugins-assign-feedback",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={assign:this.assign,submission:this.submission,plugin:this.plugin,configs:this.configs,edit:this.edit,allowOffline:this.allowOffline},this.plugin&&this.getHandlerData("assignsubmission_"+this.plugin.type)},t.prototype.invalidate=function(){return Promise.resolve()},a([Object(o.D)(),c("design:type",Object)],t.prototype,"assign",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"submission",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"plugin",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"configs",void 0),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"edit",void 0),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"allowOffline",void 0),t=a([Object(o.m)({selector:"core-site-plugins-assign-submission",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return e.prototype.invalidate=function(){return Promise.resolve()},r([Object(o.D)(),i("design:type",Object)],e.prototype,"assign",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"submission",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"plugin",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"configs",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"edit",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"allowOffline",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.modalCtrl=e}return e.prototype.editFeedback=function(){var e=this;return this.canEdit?new Promise(function(t,n){var o=e.modalCtrl.create("AddonModAssignEditFeedbackModalPage",{assign:e.assign,submission:e.submission,plugin:e.plugin,userId:e.userId});o.present(),o.onDidDismiss(function(e){void 0===e?n():t(e)})}):Promise.reject(null)},e.prototype.invalidate=function(){return Promise.resolve()},r([Object(o.D)(),i("design:type",Object)],e.prototype,"assign",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"submission",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"plugin",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"userId",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"configs",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"canEdit",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"edit",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(10),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.courseProvider=n,this.utils=o,this.ROOT_CACHE_KEY="mmaModFolder:",this.logger=e.getInstance("AddonModFolderProvider")}return e.prototype.getFolder=function(e,t,n){return this.getFolderByKey(e,"coursemodule",t,n)},e.prototype.getFolderByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getFolderCacheKey(e)};return o.read("mod_folder_get_folders_by_courses",i,s).then(function(e){if(e&&e.folders){var o=e.folders.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getFolderCacheKey=function(e){return this.ROOT_CACHE_KEY+"folder:"+e},e.prototype.invalidateContent=function(e,t,n){var o=[];return o.push(this.invalidateFolderData(t,n)),o.push(this.courseProvider.invalidateModule(e,n)),this.utils.allPromises(o)},e.prototype.invalidateFolderData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getFolderCacheKey(e))})},e.prototype.isGetFolderWSAvailable=function(){return this.sitesProvider.wsAvailableInCurrentSite("mod_folder_get_folders_by_courses")},e.prototype.logView=function(e){var t={folderid:e};return this.sitesProvider.getCurrentSite().write("mod_folder_view_folder",t)},e.COMPONENT="mmaModFolder",e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1),i=n(69),s=n(10),a=n(56),c=n(9),u=n(7),d=n(12),l=n(2),f=n(45),p=n(11),h=n(6),m=n(137),g=n(410),y=n(163),v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var h=e.call(this,"AddonModGlossarySyncProvider",i,s,n,a,c,t)||this;return h.eventsProvider=r,h.uploaderProvider=u,h.utils=d,h.glossaryProvider=l,h.glossaryHelper=f,h.glossaryOffline=p,h.componentTranslate=o.translateModuleName("glossary"),h}return v(t,e),n=t,t.prototype.syncAllGlossaries=function(e){return this.syncOnSites("all glossaries",this.syncAllGlossariesFunc.bind(this),[],e)},t.prototype.syncAllGlossariesFunc=function(e){var t=this;return this.glossaryOffline.getAllNewEntries(e).then(function(o){var r={},i=function(i){var s=o[i];if(void 0!==r[s.glossaryid])return"continue";r[s.glossaryid]=t.syncGlossaryEntriesIfNeeded(s.glossaryid,s.userid,e).then(function(o){o&&o.updated&&t.eventsProvider.trigger(n.AUTO_SYNCED,{glossaryId:s.glossaryid,userId:s.userid,warnings:o.warnings},e)})};for(var s in o)i(s);return Promise.all(t.utils.objectToArray(r))})},t.prototype.syncGlossaryEntriesIfNeeded=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getGlossarySyncId(e,t);return this.isSyncNeeded(r,n).then(function(r){if(r)return o.syncGlossaryEntries(e,t,n)})},t.prototype.syncGlossaryEntries=function(e,t,n){var o=this;t=t||this.sitesProvider.getCurrentSiteUserId(),n=n||this.sitesProvider.getCurrentSiteId();var r=this.getGlossarySyncId(e,t);if(this.isSyncing(r,n))return this.getOngoingSync(r,n);if(this.syncProvider.isBlocked(m.a.COMPONENT,r,n))return this.logger.debug("Cannot sync glossary "+e+" because it is blocked."),Promise.reject(this.translate.instant("core.errorsyncblocked",{$a:this.componentTranslate}));this.logger.debug("Try to sync glossary "+e+" for user "+t);var i,s={warnings:[],updated:!1},a=this.glossaryOffline.getGlossaryNewEntries(e,n,t).catch(function(){return[]}).then(function(t){if(t.length){if(!o.appProvider.isOnline())return Promise.reject(null);var r=[];return t.forEach(function(t){var a;i=t.courseid,a=o.uploadAttachments(e,t,n).then(function(r){return o.glossaryProvider.addEntryOnline(e,t.concept,t.definition,t.options,r,n)}),r.push(a.then(function(){return s.updated=!0,o.deleteAddEntry(e,t.concept,t.timecreated,n)}).catch(function(r){return o.utils.isWebServiceError(r)?(s.updated=!0,o.deleteAddEntry(e,t.concept,t.timecreated,n).then(function(){s.warnings.push(o.translate.instant("core.warningofflinedatadeleted",{component:o.componentTranslate,name:t.concept,error:r.error}))})):Promise.reject(r)}))}),Promise.all(r)}}).then(function(){if(s.updated&&i)return o.glossaryProvider.getGlossaryById(i,e).then(function(e){return o.glossaryProvider.invalidateGlossaryEntries(e,!0)}).catch(function(){})}).then(function(){return o.setSyncTime(r,n).catch(function(){})}).then(function(){return s});return this.addOngoingSync(r,a,n)},t.prototype.deleteAddEntry=function(e,t,n,o){var r=[];return r.push(this.glossaryOffline.deleteNewEntry(e,t,n,o)),r.push(this.glossaryHelper.deleteStoredFiles(e,t,n,o).catch(function(){})),Promise.all(r)},t.prototype.uploadAttachments=function(e,t,n){var o=this;if(t.attachments){var r=t.attachments.online||[];return(t.attachments.offline?this.glossaryHelper.getStoredFiles(e,t.concept,t.timecreated,n).then(function(e){r=r.concat(e)}).catch(function(){}):Promise.resolve(0)).then(function(){return o.uploaderProvider.uploadOrReuploadFiles(r,m.a.COMPONENT,e,n)})}return Promise.resolve(0)},t.prototype.getGlossarySyncId=function(e,t){return t=t||this.sitesProvider.getCurrentSiteUserId(),"glossary#"+e+"#"+t},t.AUTO_SYNCED="addon_mod_glossary_autom_synced",t=n=b([Object(o.A)(),_("design:paramtypes",[r.c,c.a,s.a,d.a,u.a,l.a,f.a,p.a,a.a,h.a,m.a,g.a,y.a])],t);var n}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(4),i=n(1),s=n(9),a=n(18),c=n(2),u=n(8),d=n(6),l=n(10),f=n(46),p=n(76),h=n(95),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e){function t(t,n,o,r,i,s,a,c,u,d){var l=e.call(this,t,n,o,r,i,s,a)||this;return l.modalCtrl=c,l.groupsProvider=u,l.lessonProvider=d,l.name="AddonModLesson",l.modName="lesson",l.component=h.a.COMPONENT,l.updatesNames=/^configuration$|^.*files$|^grades$|^gradeitems$|^pages$|^answers$|^questionattempts$|^pagesviewed$/,l}return m(t,e),t.prototype.askUserPassword=function(e){var t=this,n=this.modalCtrl.create("AddonModLessonPasswordModalPage");return n.present(),new Promise(function(e,o){n.onDidDismiss(function(n){void 0!==n?e(n):o(t.domUtils.createCanceledError())})})},t.prototype.getDownloadSize=function(e,t,n){var o,r,i,s=this,a=this.sitesProvider.getCurrentSiteId();return this.lessonProvider.getLesson(t,e.id,!1,a).then(function(e){return o=e,s.getLessonPassword(o.id,!1,!0,n,a)}).then(function(t){r=t.password;var n=(o=t.lesson||o).mediafiles||[];return n=n.concat(s.getIntroFilesFromInstance(e,o)),i=s.utils.sumFileSizes(n),s.lessonProvider.getPages(o.id,r,!1,!1,a)}).then(function(e){return e.forEach(function(e){i.size+=e.filessizetotal}),i})},t.prototype.getLessonPassword=function(e,t,n,o,r){var i=this;return r=r||this.sitesProvider.getCurrentSiteId(),this.lessonProvider.getAccessInformation(e,t,n,r).then(function(s){if(s.preventaccessreasons&&s.preventaccessreasons.length){return 1==s.preventaccessreasons.length&&i.lessonProvider.isPasswordProtected(s)?i.lessonProvider.getStoredPassword(e).catch(function(){}).then(function(o){return o?i.validatePassword(e,s,o,t,n,r):Promise.reject(null)}).catch(function(){return o?i.askUserPassword(s).then(function(o){return i.validatePassword(e,s,o,t,n,r)}):Promise.reject(s.preventaccessreasons[0].message)}):Promise.reject(s.preventaccessreasons[0].message)}return{accessInfo:s}})},t.prototype.invalidateContent=function(e,t){var n=[];return n.push(this.lessonProvider.invalidateLessonData(t)),n.push(this.courseProvider.invalidateModule(e)),n.push(this.groupsProvider.invalidateActivityAllowedGroups(e)),Promise.all(n)},t.prototype.invalidateModule=function(e,t){var n=this,o=this.sitesProvider.getCurrentSiteId();return this.lessonProvider.getLesson(t,e.id,!1,o).then(function(e){var r=[];return r.push(n.lessonProvider.invalidateLessonData(t,o)),r.push(n.lessonProvider.invalidateAccessInformation(e.id,o)),Promise.all(r)})},t.prototype.isDownloadable=function(e,t){var n=this,o=this.sitesProvider.getCurrentSiteId();return this.lessonProvider.getLesson(t,e.id,!1,o).then(function(e){return!!n.lessonProvider.isLessonOffline(e)&&n.lessonProvider.getAccessInformation(e.id,!1,!1,o).then(function(e){return!e.preventaccessreasons||!e.preventaccessreasons.length||1==e.preventaccessreasons.length&&n.lessonProvider.isPasswordProtected(e)})})},t.prototype.isEnabled=function(){return this.lessonProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchLesson.bind(this))},t.prototype.prefetchLesson=function(e,t,n,o){var r,i,s,a=this;return this.lessonProvider.getLesson(t,e.id,!1,o).then(function(e){return r=e,a.getLessonPassword(r.id,!1,!0,n,o)}).then(function(t){if(i=t.password,r=t.lesson||r,s=t.accessInfo,!a.lessonProvider.leftDuringTimed(s))return a.lessonProvider.launchRetake(r.id,i,void 0,!1,o).then(function(){var t=[];return t.push(a.filepoolProvider.updatePackageDownloadTime(o,a.component,e.id).catch(function(){})),t.push(a.lessonProvider.getAccessInformation(r.id,!1,!0,o).then(function(e){s=e})),Promise.all(t)})}).then(function(){var t=[],n=s.attemptscount,c=r.mediafiles||[];return c=c.concat(a.getIntroFilesFromInstance(e,r)),t.push(a.filepoolProvider.addFilesToQueue(o,c,a.component,e.id)),t.push(a.lessonProvider.getPages(r.id,i,!1,!0,o).then(function(t){var n=[],s=!1;return t.forEach(function(t){if(!s)for(var c=0;c<t.jumps.length;c++)if(t.jumps[c]==h.a.LESSON_RANDOMBRANCH){s=!0;break}n.push(a.lessonProvider.getPageData(r,t.page.id,i,!1,!0,!1,!0,void 0,void 0,o).then(function(t){var n=t.contentfiles||[];return t.answers.forEach(function(e){e.answerfiles&&e.answerfiles.length&&(n=n.concat(e.answerfiles)),e.responsefiles&&e.responsefiles.length&&(n=n.concat(e.responsefiles))}),a.filepoolProvider.addFilesToQueue(o,n,a.component,e.id)}))}),n.push(a.lessonProvider.getPagesPossibleJumps(r.id,!1,!0,o).catch(function(e){return s?Promise.reject(a.translate.instant("addon.mod_lesson.errorprefetchrandombranch")):Promise.reject(e)})),Promise.all(n)})),t.push(a.lessonProvider.getTimers(r.id,!1,!0,o).catch(function(){})),t.push(a.lessonProvider.getContentPagesViewedOnline(r.id,n,!1,!0,o)),t.push(a.lessonProvider.getQuestionsAttemptsOnline(r.id,n,!1,void 0,!1,!0,o)),t.push(a.courseProvider.getModuleBasicInfo(e.id,o)),s.canviewreports&&t.push(a.groupsProvider.getActivityAllowedGroupsIfEnabled(e.id,void 0,o).then(function(e){var t=[];return e.forEach(function(e){t.push(a.lessonProvider.getRetakesOverview(r.id,e.id,!1,!0,o))}),t.push(a.lessonProvider.getRetakesOverview(r.id,0,!1,!0,o).then(function(e){if(e&&e.students){var t=[];return e.students.forEach(function(e){if(e.attempts&&e.attempts.length){var n=e.attempts[e.attempts.length-1];n&&t.push(a.lessonProvider.getUserRetake(r.id,n.try,e.id,!1,!0,o))}}),Promise.all(t)}})),Promise.all(t)})),Promise.all(t)})},t.prototype.validatePassword=function(e,t,n,o,r,i){var s=this;return i=i||this.sitesProvider.getCurrentSiteId(),this.lessonProvider.getLessonWithPassword(e,n,!0,o,r,i).then(function(e){return s.lessonProvider.storePassword(e.id,n,i).then(function(){return{password:n,lesson:e,accessInfo:t}})})},t=g([Object(o.A)(),y("design:paramtypes",[i.c,s.a,d.a,l.a,a.a,c.a,u.a,r.o,f.a,h.a])],t)}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(27),s=n(2),a=n(11),c=n(6),u=n(47),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.fileProvider=e,this.sitesProvider=t,this.textUtils=n,this.urlUtils=o,this.utils=r,this.translate=i,this.ROOT_CACHE_KEY="mmaModLti:",this.LAUNCHER_FILE_NAME="lti_launcher.html"}return e.prototype.deleteLauncher=function(){return this.fileProvider.removeFile(this.LAUNCHER_FILE_NAME)},e.prototype.generateLauncher=function(e,t){var n=this;if(!this.fileProvider.isAvailable())return Promise.resolve(e);var o='<form action="'+e+'" name="ltiLaunchForm" method="post" encType="application/x-www-form-urlencoded">\n';return t.forEach(function(e){o+="ext_submit"==e.name?'    <input type="submit"':'    <input type="hidden" name="'+n.textUtils.escapeHTML(e.name)+'"',o+=' value="'+n.textUtils.escapeHTML(e.value)+'"/>\n'}),o+="</form>\n",o+='<script type="text/javascript"> \n    window.onload = function() { \n        document.ltiLaunchForm.submit(); \n    }; \n<\/script> \n',this.fileProvider.writeFile(this.LAUNCHER_FILE_NAME,o).then(function(e){return e.toURL()})},e.prototype.getLti=function(e,t){var n={courseids:[e]},o={cacheKey:this.getLtiCacheKey(e)};return this.sitesProvider.getCurrentSite().read("mod_lti_get_ltis_by_courses",n,o).then(function(e){if(e.ltis){var n=e.ltis.find(function(e){return e.coursemodule==t});if(n)return n}return Promise.reject(null)})},e.prototype.getLtiCacheKey=function(e){return this.ROOT_CACHE_KEY+"lti:"+e},e.prototype.getLtiLaunchData=function(e){var t={toolid:e},n={getFromCache:!1,saveToCache:!0,emergencyCache:!0,cacheKey:this.getLtiLaunchDataCacheKey(e)};return this.sitesProvider.getCurrentSite().read("mod_lti_get_tool_launch_data",t,n).then(function(e){return e.endpoint?e:Promise.reject(null)})},e.prototype.getLtiLaunchDataCacheKey=function(e){return this.ROOT_CACHE_KEY+"launch:"+e},e.prototype.invalidateLti=function(e){return this.sitesProvider.getCurrentSite().invalidateWsCacheForKey(this.getLtiCacheKey(e))},e.prototype.invalidateLtiLaunchData=function(e){return this.sitesProvider.getCurrentSite().invalidateWsCacheForKey(this.getLtiLaunchDataCacheKey(e))},e.prototype.launch=function(e,t){var n=this;return this.urlUtils.isHttpURL(e)?this.generateLauncher(e,t).then(function(e){n.utils.openInApp(e)}):Promise.reject(this.translate.instant("addon.mod_lti.errorinvalidlaunchurl"))},e.prototype.logView=function(e){var t={ltiid:e};return this.sitesProvider.getCurrentSite().write("mod_lti_view_lti",t)},e.COMPONENT="mmaModLti",e=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,u.a,c.a,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(7),i=n(8),s=n(11),a=n(18),c=n(189),u=n(27),d=n(2),l=n(144),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s){this.domUtils=t,this.filepoolProvider=n,this.fileProvider=o,this.textUtils=r,this.http=i,this.sitesProvider=s,this.logger=e.getInstance("AddonModPageHelperProvider")}return e.prototype.getPageHtml=function(e,t){var n,o,r=this,i={};return e.forEach(function(e){var t=e.fileurl;if(r.isMainPage(e))n=t;else{var o=e.filename;"/"!==e.filepath&&(o=e.filepath.substr(1)+o),i[r.textUtils.decodeURIComponent(o)]=t}}),n?o=this.fileProvider.isAvailable()?this.filepoolProvider.downloadUrl(this.sitesProvider.getCurrentSiteId(),n,!1,c.a.COMPONENT,t):Promise.resolve(this.sitesProvider.getCurrentSite().fixPluginfileURL(n)):(this.logger.debug("Could not locate the index page"),o=Promise.reject(null)),o.then(function(e){return r.http.get(e).toPromise().then(function(e){var t=e.text();return"string"!=typeof t?Promise.reject(null):r.domUtils.restoreSourcesInHtml(t,i)})})},e.prototype.isMainPage=function(e){var t=e.filename||"",n=e.fileurl||"",o="/mod_page/content/index.html",r=encodeURIComponent(o);return"index.html"===t&&(n.indexOf(o)>0||n.indexOf(r)>0)},e=f([Object(o.A)(),p("design:paramtypes",[r.a,i.a,a.a,u.a,s.a,l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return O});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(11),f=n(73),p=n(76),h=n(92),m=n(251),g=n(74),y=n(164),v=n(30),b=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},O=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var m=e.call(this,t,n,o,r,i,s,a)||this;return m.injector=c,m.quizProvider=u,m.textUtils=d,m.quizHelper=l,m.accessRuleDelegate=f,m.questionHelper=p,m.name="AddonModQuiz",m.modName="quiz",m.component=h.a.COMPONENT,m.updatesNames=/^configuration$|^.*files$|^grades$|^gradeitems$|^questions$|^attempts$/,m}return b(t,e),t.prototype.getDownloadSize=function(e,t,n){return Promise.resolve({size:-1,total:!1})},t.prototype.getPreflightData=function(e,t,n,o,r,i){var s,a=this,c={};if(o)s=this.quizHelper.getAndCheckPreflightData(e,t,c,n,!1,!0,r,i);else{s=this.accessRuleDelegate.getFixedPreflightData(t.activerulenames,e,c,n,!0,i).then(function(){if(!n)return a.quizProvider.startAttempt(e.id,c,!1,i)})}return s.then(function(){return c})},t.prototype.invalidateContent=function(e,t){return this.quizProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.quizProvider.invalidateQuizData(t)),n.push(this.quizProvider.invalidateUserAttemptsForUser(e.instance)),Promise.all(n)},t.prototype.isDownloadable=function(e,t){var n=this;if(this.sitesProvider.getCurrentSite().isOfflineDisabled())return!1;var o=this.sitesProvider.getCurrentSiteId();return this.quizProvider.getQuiz(t,e.id,!1,o).then(function(e){return 1===e.allowofflineattempts&&0!==e.hasquestions&&n.quizProvider.getUserAttempts(e.id,void 0,!0,!1,!1,o).then(function(t){var o=!t.length||n.quizProvider.isAttemptFinished(t[t.length-1].state);return 0===e.attempts||e.attempts>t.length||!o})})},t.prototype.isEnabled=function(){return this.quizProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchQuiz.bind(this))},t.prototype.prefetchQuiz=function(e,t,n,o){var r,i,s,a,c,u=this,d=!1;return this.quizProvider.getQuiz(t,e.id,!1,o).then(function(t){var n=[],c=u.getIntroFilesFromInstance(e,i=t);return n.push(u.quizProvider.getQuizAccessInformation(i.id,!1,!0,o).then(function(e){s=e})),n.push(u.quizProvider.getQuizRequiredQtypes(i.id,!0,o)),n.push(u.quizProvider.getUserAttempts(i.id,"all",!0,!1,!0,o).then(function(e){r=e})),n.push(u.quizProvider.getAttemptAccessInformation(i.id,0,!1,!0,o).then(function(e){a=e})),n.push(u.filepoolProvider.addFilesToQueue(o,c,h.a.COMPONENT,e.id)),Promise.all(n)}).then(function(){var e=r[r.length-1];if(!e||u.quizProvider.isAttemptFinished(e.state)){if(a.preventnewattemptreasons.length)return Promise.reject(u.textUtils.buildMessage(a.preventnewattemptreasons));d=!0,e=void 0}return u.getPreflightData(i,s,e,n,"core.download",o)}).then(function(n){c=n;var s=[];return d&&(s.push(u.quizProvider.getUserAttempts(i.id,"all",!0,!1,!0,o).then(function(e){r=e})),s.push(u.filepoolProvider.updatePackageDownloadTime(o,h.a.COMPONENT,e.id).catch(function(){}))),s.push(u.quizProvider.getCombinedReviewOptions(i.id,!0,o)),s.push(u.quizProvider.getUserBestGrade(i.id,!0,o)),s.push(u.quizProvider.getGradeFromGradebook(t,e.id,!0,o).then(function(e){if(void 0!==e.graderaw)return u.quizProvider.getFeedbackForGrade(i.id,e.graderaw,!0,o)}).catch(function(){})),s.push(u.quizProvider.getAttemptAccessInformation(i.id,0,!1,!0,o)),Promise.all(s)}).then(function(){var e=[];return r.forEach(function(t){e.push(u.prefetchAttempt(i,t,c,o))}),Promise.all(e)}).then(function(){u.syncProvider||(u.syncProvider=u.injector.get(y.a)),u.syncProvider.hasDataToSync(i.id,o).then(function(e){e||u.syncProvider.setSyncTime(i.id,o)})})},t.prototype.prefetchAttempt=function(e,t,n,o){var r=this,i=this.quizProvider.getPagesFromLayout(t.layout),s=[],a=this.quizProvider.isNavigationSequential(e);if(this.quizProvider.isAttemptFinished(t.state)){var c=this.quizProvider.rescaleGrade(t.sumgrades,e,!1);void 0!==c&&s.push(this.quizProvider.getFeedbackForGrade(e.id,Number(c),!0,o)),i.forEach(function(e){s.push(r.quizProvider.getAttemptReview(t.id,e,!0,o).catch(function(){}))}),s.push(this.quizProvider.getAttemptReview(t.id,-1,!0,o).then(function(t){var n=[];return t.questions.forEach(function(t){n.push(r.questionHelper.prefetchQuestionFiles(t,r.component,e.coursemodule,o))}),Promise.all(n)},function(){}))}else s.push(this.quizProvider.getAttemptAccessInformation(e.id,t.id,!1,!0,o)),s.push(this.quizProvider.getAttemptSummary(t.id,n,!1,!0,!1,o)),t.state==h.a.ATTEMPT_IN_PROGRESS&&i.forEach(function(i){a&&i<t.currentpage||s.push(r.quizProvider.getAttemptData(t.id,i,n,!1,!0,o).then(function(t){var n=[];return t.questions.forEach(function(t){n.push(r.questionHelper.prefetchQuestionFiles(t,r.component,e.coursemodule,o))}),Promise.all(n)}))});return Promise.all(s)},t.prototype.prefetchQuizAndLastAttempt=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r,i,s,a,c=[];return c.push(this.quizProvider.getQuizAccessInformation(e.id,!1,!0,n).then(function(e){i=e})),c.push(this.quizProvider.getQuizRequiredQtypes(e.id,!0,n)),c.push(this.quizProvider.getCombinedReviewOptions(e.id,!0,n)),c.push(this.quizProvider.getUserBestGrade(e.id,!0,n)),c.push(this.quizProvider.getUserAttempts(e.id,"all",!0,!1,!0,n).then(function(e){r=e})),c.push(this.quizProvider.getGradeFromGradebook(e.course,e.coursemodule,!0,n).then(function(t){if(void 0!==t.graderaw)return o.quizProvider.getFeedbackForGrade(e.id,t.graderaw,!0,n)}).catch(function(){})),c.push(this.quizProvider.getAttemptAccessInformation(e.id,0,!1,!0,n)),Promise.all(c).then(function(){if(a=r[r.length-1])return o.getPreflightData(e,i,a,t,"core.download",n)}).then(function(t){if(s=t,a)return o.prefetchAttempt(e,a,s,n)}).then(function(){return o.filepoolProvider.getPackageStatus(n,o.component,e.coursemodule)}).then(function(t){if(t!==v.a.NOT_DOWNLOADED){var r=!a||o.quizProvider.isAttemptFinished(a.state);return o.filepoolProvider.storePackageStatus(n,r?v.a.NOT_DOWNLOADED:v.a.DOWNLOADED,o.component,e.coursemodule)}})},t=_([Object(o.A)(),P("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,o.C,h.a,l.a,m.a,g.a,f.a])],t)}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(27),f=n(11),p=n(76),h=n(138),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e){function t(t,n,o,r,i,s,a,c,u,d){var l=e.call(this,t,n,o,r,i,s,a)||this;return l.fileProvider=c,l.textUtils=u,l.scormProvider=d,l.name="AddonModScorm",l.modName="scorm",l.component=h.a.COMPONENT,l.updatesNames=/^configuration$|^.*files$|^tracks$/,l}return m(t,e),t.prototype.download=function(e,t,n,o){var r=this.sitesProvider.getCurrentSiteId();return this.prefetchPackage(e,t,!0,this.downloadOrPrefetchScorm.bind(this),r,!1,o)},t.prototype.downloadOrPrefetchScorm=function(e,t,n,o,r,i){var s,a=this;return this.scormProvider.getScorm(t,e.id,e.url,!1,o).then(function(t){var n=[],c=a.getIntroFilesFromInstance(e,s=t);return n.push(a.fetchWSData(s,o).catch(function(){})),n.push(a.downloadOrPrefetchMainFileIfNeeded(s,r,i,o)),n.push(a.filepoolProvider.downloadOrPrefetchFiles(o,c,r,!1,a.component,e.id).catch(function(){})),Promise.all(n)}).then(function(){return s.sha1hash})},t.prototype.downloadOrPrefetchMainFile=function(e,t,n,o){var r,i=this,s=this.scormProvider.getPackageUrl(e);return this.scormProvider.getScormFolder(e.moduleurl).then(function(a){return r=a,n&&n({message:"core.downloading"}),t?i.filepoolProvider.addToQueueByUrl(o,s,i.component,e.coursemodule,void 0,void 0,i.downloadProgress.bind(i,!0,n)):i.filepoolProvider.downloadUrl(o,s,!0,i.component,e.coursemodule,void 0,i.downloadProgress.bind(i,!0,n))}).then(function(){return i.fileProvider.removeDir(r).catch(function(){})}).then(function(){return i.filepoolProvider.getFilePathByUrl(o,s)}).then(function(e){return n&&n({message:"core.unzipping"}),i.fileProvider.unzipFile(e,r,i.downloadProgress.bind(i,!1,n)).then(function(){return i.filepoolProvider.removeFileByUrl(o,s).catch(function(){})})})},t.prototype.downloadOrPrefetchMainFileIfNeeded=function(e,t,n,o){var r=this;o=o||this.sitesProvider.getCurrentSiteId();var i=this.scormProvider.isScormUnsupported(e);return i?Promise.reject(this.translate.instant(i)):this.scormProvider.shouldDownloadMainFile(e,void 0,o).then(function(i){if(i)return r.downloadOrPrefetchMainFile(e,t,n,o)})},t.prototype.downloadProgress=function(e,t,n){t&&n&&n.loaded&&t({downloading:e,progress:n})},t.prototype.fetchWSData=function(e,t){var n=this;t=t||this.sitesProvider.getCurrentSiteId();var o=[];return o.push(this.scormProvider.getAttemptCountOnline(e.id,void 0,!0,t).catch(function(){return 0}).then(function(o){if(o>0){for(var r=[],i=function(i){r.push(n.scormProvider.getScormUserDataOnline(e.id,i,!0,t).catch(function(e){if(i==o)return Promise.reject(e)}))},s=1;s<=o;s++)i(s);return Promise.all(r)}return n.scormProvider.getScormUserDataOnline(e.id,0,!0,t)})),o.push(this.scormProvider.getScos(e.id,void 0,!0,t)),Promise.all(o)},t.prototype.getDownloadSize=function(e,t,n){var o=this;return this.scormProvider.getScorm(t,e.id,e.url).then(function(e){return o.scormProvider.isScormUnsupported(e)?{size:-1,total:!1}:e.packagesize?{size:e.packagesize,total:!0}:o.scormProvider.calculateScormSize(e).then(function(e){return{size:e,total:!0}})})},t.prototype.getDownloadedSize=function(e,t){var n=this;return this.scormProvider.getScorm(t,e.id,e.url).then(function(e){return n.scormProvider.getScormFolder(e.moduleurl)}).then(function(e){return n.fileProvider.getDirectorySize(e)})},t.prototype.getFiles=function(e,t,n){var o=this;return this.scormProvider.getScorm(t,e.id,e.url).then(function(e){return o.scormProvider.getScormFileList(e)}).catch(function(){return[]})},t.prototype.invalidateContent=function(e,t){return this.scormProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){return this.scormProvider.invalidateScormData(t)},t.prototype.isDownloadable=function(e,t){var n=this;return this.scormProvider.getScorm(t,e.id,e.url).then(function(e){return!e.warningMessage&&!n.scormProvider.isScormUnsupported(e)})},t.prototype.prefetch=function(e,t,n,o,r){var i=this.sitesProvider.getCurrentSiteId();return this.prefetchPackage(e,t,n,this.downloadOrPrefetchScorm.bind(this),i,!0,r)},t.prototype.removeFiles=function(e,t){var n,o=this,r=this.sitesProvider.getCurrentSiteId();return this.scormProvider.getScorm(t,e.id,e.url,!1,r).then(function(e){return n=e,o.scormProvider.getScormFolder(n.moduleurl)}).then(function(e){var t=[];return t.push(o.fileProvider.removeDir(e).catch(function(e){if(!e||1!=e.code)return Promise.reject(e)})),t.push(o.filepoolProvider.removeFileByUrl(r,o.scormProvider.getPackageUrl(n)).catch(function(){})),Promise.all(t)})},t=g([Object(o.A)(),y("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,l.a,f.a,h.a])],t)}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(1),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.translate=e}return e.prototype.commaStringToArray=function(e){return"string"==typeof e?e.length>0?e.split(","):[]:e},e.prototype.getParentQuestions=function(e){var t={};return e.forEach(function(e){0===e.parent&&(t[e.id]=e)}),t},e.prototype.formatQuestions=function(e){var t=this,n=this.translate.instant("addon.mod_survey.ipreferthat"),o=this.translate.instant("addon.mod_survey.ifoundthat"),r=this.translate.instant("core.choose"),i=[],s=this.getParentQuestions(e),a=1;return e.forEach(function(e){var c=Object.assign({},e),u=s[c.parent];if(c.multi=t.commaStringToArray(c.multi),c.options=t.commaStringToArray(c.options),u){if(c.required=!0,1!==u.type&&2!==u.type){var d=Object.assign({},c);return c.text=n+" "+c.text,c.name="qP"+c.id,c.num=a++,i.push(c),d.text=o+" "+d.text,d.name="q"+c.id,d.num=a++,void i.push(d)}c.name="q"+(2==u.type?"P":"")+c.id,c.num=a++}else c.multi&&0===c.multi.length&&(c.name="q"+c.id,c.num=a++,c.type>0&&c.options.unshift(r));i.push(c)}),i},e=i([Object(o.A)(),s("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(7),i=n(2),s=n(69),a=n(9),c=n(6),u=n(11),d=n(240),l=n(239),f=n(12),p=n(1),h=n(10),m=n(45),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,"AddonModSurveySyncProvider",t,n,o,r,i,s)||this;return f.surveyOffline=c,f.eventsProvider=u,f.surveyProvider=d,f.utils=l,f.componentTranslate=a.translateModuleName("survey"),f}return g(t,e),n=t,t.prototype.getSyncId=function(e,t){return e+"#"+t},t.prototype.syncAllSurveys=function(e){return this.syncOnSites("all surveys",this.syncAllSurveysFunc.bind(this),void 0,e)},t.prototype.syncAllSurveysFunc=function(e){var t=this;return this.surveyOffline.getAllData(e).then(function(o){var r=o.map(function(o){return t.syncSurveyIfNeeded(o.surveyid,o.userid,e).then(function(r){r&&r.answersSent&&t.eventsProvider.trigger(n.AUTO_SYNCED,{surveyId:o.surveyid,userId:o.userid,warnings:r.warnings},e)})});return Promise.all(r)})},t.prototype.syncSurveyIfNeeded=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getSyncId(e,t);return this.isSyncNeeded(r,n).then(function(r){if(r)return o.syncSurvey(e,t,n)})},t.prototype.syncSurvey=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getSyncId(e,t);if(this.isSyncing(r,n))return this.getOngoingSync(r,n);this.logger.debug("Try to sync survey '"+e+"' for user '"+t+"'");var i,s={warnings:[],answersSent:!1},a=this.surveyOffline.getSurveyData(e,n,t).catch(function(){return{}}).then(function(r){if(r.answers&&r.answers.length)return o.appProvider.isOnline()?(i=r.courseid,o.surveyProvider.submitAnswersOnline(e,r.answers,n).then(function(){return s.answersSent=!0,o.surveyOffline.deleteSurveyAnswers(e,n,t)}).catch(function(i){return o.utils.isWebServiceError(i)?(s.answersSent=!0,o.surveyOffline.deleteSurveyAnswers(e,n,t).then(function(){s.warnings.push(o.translate.instant("core.warningofflinedatadeleted",{component:o.componentTranslate,name:r.name,error:i.error}))})):Promise.reject(i&&i.error)})):Promise.reject(null)}).then(function(){if(i)return o.surveyProvider.invalidateSurveyData(i,n).then(function(){return o.surveyProvider.getSurveyById(i,e,n)}).catch(function(){})}).then(function(){return o.setSyncTime(r,n)}).then(function(){return s});return this.addOngoingSync(r,a,n)},t.AUTO_SYNCED="addon_mod_survey_autom_synced",t=n=y([Object(o.A)(),v("design:paramtypes",[r.a,i.a,a.a,m.a,u.a,p.c,h.a,d.a,f.a,l.a,c.a])],t);var n}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(2),s=n(6),a=n(10),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=t,this.courseProvider=n,this.utils=o,this.ROOT_CACHE_KEY="mmaModUrl:",this.logger=e.getInstance("AddonModUrlProvider")}return e.prototype.getUrlCacheKey=function(e){return this.ROOT_CACHE_KEY+"url:"+e},e.prototype.getUrlDataByKey=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i={courseids:[e]},s={cacheKey:r.getUrlCacheKey(e)};return o.read("mod_url_get_urls_by_courses",i,s).then(function(e){if(e&&e.urls){var o=e.urls.find(function(e){return e[t]==n});if(o)return o}return Promise.reject(null)})})},e.prototype.getUrl=function(e,t,n){return this.getUrlDataByKey(e,"coursemodule",t,n)},e.prototype.invalidateContent=function(e,t,n){n=n||this.sitesProvider.getCurrentSiteId();var o=[];return o.push(this.invalidateUrlData(t,n)),o.push(this.courseProvider.invalidateModule(e,n)),this.utils.allPromises(o)},e.prototype.invalidateUrlData=function(e,t){var n=this;return this.sitesProvider.getSite(t).then(function(t){return t.invalidateWsCacheForKey(n.getUrlCacheKey(e))})},e.prototype.isGetUrlWSAvailable=function(){return this.sitesProvider.wsAvailableInCurrentSite("mod_url_get_urls_by_courses")},e.prototype.logView=function(e){var t={urlid:e};return this.sitesProvider.getCurrentSite().write("mod_url_view_url",t)},e.COMPONENT="mmaModUrl",e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(2),i=n(8),s=n(32),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.sitesProvider=e,this.domUtils=t,this.contentLinksHelper=n}return e.prototype.open=function(e){var t=this,n=this.domUtils.showModalLoading();this.contentLinksHelper.handleLink(e).then(function(n){if(!n)return t.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(e)}).finally(function(){n.dismiss()})},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(2),s=n(22),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,n,o){this.sitesProvider=n,this.timeUtils=o,this.tablesSchema=[{name:t.NOTES_TABLE,columns:[{name:"userid",type:"INTEGER"},{name:"courseid",type:"INTEGER"},{name:"publishstate",type:"TEXT"},{name:"content",type:"TEXT"},{name:"format",type:"INTEGER"},{name:"created",type:"INTEGER"},{name:"lastmodified",type:"INTEGER"}],primaryKeys:["userid","content","created"]}],this.logger=e.getInstance("AddonNotesOfflineProvider"),this.sitesProvider.createTablesFromSchema(this.tablesSchema)}return t=e,e.prototype.deleteNote=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){return r.getDb().deleteRecords(t.NOTES_TABLE,{userid:e,content:n,created:o})})},e.prototype.getAllNotes=function(e){return this.sitesProvider.getSite(e).then(function(e){return e.getDb().getRecords(t.NOTES_TABLE)})},e.prototype.getNote=function(e,n,o,r){return this.sitesProvider.getSite(r).then(function(r){return r.getDb().getRecord(t.NOTES_TABLE,{userid:e,content:n,created:o})})},e.prototype.getNotesForCourse=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.NOTES_TABLE,{courseid:e})})},e.prototype.getNotesForUser=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.NOTES_TABLE,{userid:e})})},e.prototype.getNotesWithPublishState=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecords(t.NOTES_TABLE,{publishstate:e})})},e.prototype.hasNotesForCourse=function(e,t){return this.getNotesForCourse(e,t).then(function(e){return!!e.length})},e.prototype.hasNotesForUser=function(e,t){return this.getNotesForUser(e,t).then(function(e){return!!e.length})},e.prototype.hasNotesWithPublishState=function(e,t){return this.getNotesWithPublishState(e,t).then(function(e){return!!e.length})},e.prototype.saveNote=function(e,n,o,r,i){var s=this;return this.sitesProvider.getSite(i).then(function(i){var a=s.timeUtils.timestamp(),c={userid:e,courseid:n,publishstate:o,content:r,format:1,created:a,lastmodified:a};return i.getDb().insertRecord(t.NOTES_TABLE,c).then(function(){return c})})},e.NOTES_TABLE="addon_notes_offline_notes",e=t=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(7),i=n(2),s=n(69),a=n(9),c=n(360),u=n(165),d=n(41),l=n(12),f=n(11),p=n(6),h=n(1),m=n(45),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,"AddonNotesSync",t,n,o,r,i,s)||this;return f.notesOffline=a,f.utils=c,f.eventsProvider=u,f.notesProvider=d,f.coursesProvider=l,f}return g(t,e),n=t,t.prototype.syncAllNotes=function(e){return this.syncOnSites("all notes",this.syncAllNotesFunc.bind(this),[],e)},t.prototype.syncAllNotesFunc=function(e){var t=this;return this.notesOffline.getAllNotes(e).then(function(o){var r=[];o.forEach(function(e){-1==r.indexOf(e.courseid)&&r.push(e.courseid)});var i=r.map(function(o){return t.syncNotesIfNeeded(o,e).then(function(r){void 0!==r&&t.eventsProvider.trigger(n.AUTO_SYNCED,{courseId:o,warnings:r},e)})});return Promise.all(i)})},t.prototype.syncNotesIfNeeded=function(e,t){var n=this;return this.isSyncNeeded(e,t).then(function(o){if(o)return n.syncNotes(e,t)})},t.prototype.syncNotes=function(e,t){var n=this;if(t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncing(e,t))return this.getOngoingSync(e,t);this.logger.debug("Try to sync notes for course "+e);var o=[],r=this.notesOffline.getNotesForCourse(e,t).then(function(r){if(r.length){if(!n.appProvider.isOnline())return Promise.reject(n.translate.instant("core.networkerrormsg"));var i=[],s=r.map(function(e){return{userid:e.userid,publishstate:e.publishstate,courseid:e.courseid,text:e.content,format:e.format}});return n.notesProvider.addNotesOnline(s,t).then(function(o){return o.forEach(function(e){-1===e.noteid&&-1==i.indexOf(e.errormessage)&&i.push(e.errormessage)}),n.notesProvider.invalidateNotes(e,t).then(function(){return n.notesProvider.getNotes(e,!1,!0,t)}).catch(function(){})}).catch(function(e){if(!n.utils.isWebServiceError(e))return Promise.reject(e);i.push(e)}).then(function(){var e=r.map(function(e){return n.notesOffline.deleteNote(e.userid,e.content,e.created,t)});return Promise.all(e)}).then(function(){if(i&&i.length)return n.coursesProvider.getUserCourse(e,!0,t).catch(function(){return{}}).then(function(t){i.forEach(function(r){o.push(n.translate.instant("addon.notes.warningnotenotsent",{course:t.fullname?t.fullname:e,error:r}))})})})}}).then(function(){return o});return this.addOngoingSync(e,r,t)},t.AUTO_SYNCED="addon_notes_autom_synced",t=n=y([Object(o.A)(),v("design:paramtypes",[r.a,i.a,a.a,m.a,f.a,h.c,c.a,p.a,l.a,u.a,d.a])],t);var n}(s.a)},,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return r([Object(o.D)(),i("design:type",Object)],e.prototype,"question",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"component",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"componentId",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"attemptId",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"offlineEnabled",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"buttonClicked",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"onAbort",void 0),e=r([Object(o.m)({selector:"addon-qbehaviour-deferredcbm",template:'<div *ngIf="question.behaviourCertaintyOptions && question.behaviourCertaintyOptions.length">\n    <ion-item text-wrap class="addon-qbehaviour-deferredcbm-certainty-title" >\n        <p>{{ \'core.question.certainty\' | translate }}</p>\n    </ion-item>\n    <div radio-group [(ngModel)]="question.behaviourCertaintySelected" [name]="question.behaviourCertaintyOptions[0].name">\n        <ion-item text-wrap *ngFor="let option of question.behaviourCertaintyOptions">\n            <ion-label>\n                <core-format-text [component]="component" [componentId]="componentId" [text]="option.text"></core-format-text>\n            </ion-label>\n            <ion-radio id="{{option.id}}" [value]="option.value" [disabled]="option.disabled"></ion-radio>\n        </ion-item>\n    </div>\n\n    \x3c!-- ion-radio doesn\'t use an input. Create a hidden input to hold the selected value. --\x3e\n    <input type="hidden" [ngModel]="question.behaviourCertaintySelected" [attr.name]="question.behaviourCertaintyOptions[0].name">\n</div>\n'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n){return e.call(this,t,"AddonQtypeShortAnswerComponent",n)||this}return s(t,e),t.prototype.ngOnInit=function(){this.initInputTextComponent()},t=a([Object(o.m)({selector:"addon-qtype-shortanswer",template:'<section ion-list *ngIf="question.text || question.text === \'\'">\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n    </ion-item>\n    <ion-input padding-left type="text" placeholder="{{ \'core.question.answer\' | translate }}" [attr.name]="question.input.name" [value]="question.input.value" autocorrect="off" [disabled]="question.input.readOnly" [ngClass]="[question.input.correctClass]">\n    </ion-input>\n</section>\n'}),c("design:paramtypes",[r.a,o.C])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n){return e.call(this,t,"AddonQtypeCalculatedComponent",n)||this}return s(t,e),t.prototype.ngOnInit=function(){this.initCalculatedComponent()},t=a([Object(o.m)({selector:"addon-qtype-calculated",template:'<section ion-list class="addon-qtype-calculated-container" *ngIf="question.text || question.text === \'\'">\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n    </ion-item>\n\n    \x3c!-- Display unit options before the answer input. --\x3e\n    <ng-container *ngIf="question.options && question.options.length && question.optionsFirst">\n        <ng-container *ngTemplateOutlet="radioUnits"></ng-container>\n    </ng-container>\n\n    <ion-item text-wrap ion-grid>\n        <ion-grid item-content>\n            <ion-row>\n                \x3c!-- Display unit select before the answer input. --\x3e\n                <ng-container *ngIf="question.select && question.selectFirst">\n                    <ng-container *ngTemplateOutlet="selectUnits"></ng-container>\n                </ng-container>\n\n                \x3c!-- Input to enter the answer. --\x3e\n                <ion-col>\n                    <ion-input padding-left type="text" placeholder="{{ \'core.question.answer\' | translate }}" [attr.name]="question.input.name" [value]="question.input.value" [disabled]="question.input.readOnly" [ngClass]="[question.input.correctClass]" autocorrect="off">\n                    </ion-input>\n                </ion-col>\n\n                \x3c!-- Display unit select after the answer input. --\x3e\n                <ng-container *ngIf="question.select && !question.selectFirst">\n                    <ng-container *ngTemplateOutlet="selectUnits"></ng-container>\n                </ng-container>\n            </ion-row>\n        </ion-grid>\n    </ion-item>\n\n    \x3c!-- Display unit options after the answer input. --\x3e\n    <ng-container *ngIf="question.options && question.options.length && !question.optionsFirst">\n        <ng-container *ngTemplateOutlet="radioUnits"></ng-container>\n    </ng-container>\n</section>\n\n\x3c!-- Template for units entered using a select. --\x3e\n<ng-template #selectUnits>\n    <ion-col>\n        <label *ngIf="question.select.accessibilityLabel" class="accesshide" for="{{question.select.id}}">{{ question.select.accessibilityLabel }}</label>\n        <ion-select id="{{question.select.id}}" [name]="question.select.name" [(ngModel)]="question.select.selected" interface="popover" [disabled]="question.select.disabled">\n            <ion-option *ngFor="let option of question.select.options" [value]="option.value">{{option.label}}</ion-option>\n        </ion-select>\n\n        \x3c!-- ion-select doesn\'t use a select. Create a hidden input to hold the selected value. --\x3e\n        <input type="hidden" [ngModel]="question.select.selected" [attr.name]="question.select.name">\n    </ion-col>\n</ng-template>\n\n\x3c!-- Template for units entered using radio buttons. --\x3e\n<ng-template #radioUnits>\n    <div radio-group [(ngModel)]="question.unit" [name]="question.optionsName">\n        <ion-item text-wrap *ngFor="let option of question.options">\n            <ion-label>\n                <p>{{option.text}}</p>\n            </ion-label>\n            <ion-radio [value]="option.value" [disabled]="option.disabled || question.input.readOnly"></ion-radio>\n        </ion-item>\n\n        \x3c!-- ion-radio doesn\'t use an input. Create a hidden input to hold the selected value. --\x3e\n        <input type="hidden" [ngModel]="question.unit" [attr.name]="question.optionsName">\n    </div>\n</ng-template>\n'}),c("design:paramtypes",[r.a,o.C])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n){return e.call(this,t,"AddonQtypeMatchComponent",n)||this}return s(t,e),t.prototype.ngOnInit=function(){this.initMatchComponent()},t=a([Object(o.m)({selector:"addon-qtype-match",template:'<section ion-list class="addon-qtype-match-container" *ngIf="question.loaded">\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n    </ion-item>\n    <ion-item text-wrap *ngFor="let row of question.rows">\n        <ion-grid item-content>\n            <ion-row>\n                <ion-col>\n                    <p><core-format-text id="addon-qtype-match-question-{{row.id}}" [component]="component" [componentId]="componentId" [text]="row.text"></core-format-text></p>\n                </ion-col>\n                <ion-col [ngClass]=\'{"core-question-answer-correct": row.isCorrect === 1, "core-question-answer-incorrect": row.isCorrect === 0}\'>\n                    <label class="accesshide" for="{{row.id}}" *ngIf="row.accessibilityLabel">{{ row.accessibilityLabel }}</label>\n                    <ion-select id="{{row.id}}" [name]="row.name" [attr.aria-labelledby]="\'addon-qtype-match-question-\' + row.id" [(ngModel)]="row.selected" interface="popover">\n                        <ion-option *ngFor="let option of row.options" [value]="option.value">{{option.label}}</ion-option>\n                    </ion-select>\n\n                    \x3c!-- ion-select doesn\'t use a select. Create a hidden input to hold the selected value. --\x3e\n                    <input type="hidden" [ngModel]="row.selected" [attr.name]="row.name">\n                </ion-col>\n            </ion-row>\n        </ion-grid>\n    </ion-item>\n</section>\n'}),c("design:paramtypes",[r.a,o.C])],t)}(i.a)},,,,function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(42),l=n(424),f=n(1619),p=n(1620),h=n(391),m=n(392),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=function(){function e(){}return e=g([Object(o.I)({declarations:[l.a,f.a,p.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a,d.a,h.a,m.a],providers:[],exports:[l.a,f.a,p.a],entryComponents:[l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(17),i=n(1371),s=n(16),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=function(){function e(){}return e=a([Object(o.I)({declarations:[i.a],imports:[r.b,s.a],exports:[i.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(742),c=n(16),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=function(){function e(){}return e=u([Object(o.I)({declarations:[a.a],imports:[r.b,i.k,s.b.forChild(),c.a],providers:[],exports:[a.a],entryComponents:[a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(760),c=n(1400),u=n(16),d=n(15),l=n(66),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){}return e=f([Object(o.I)({declarations:[a.a,c.a],imports:[r.b,i.k,s.b.forChild(),u.a,d.a,l.a],providers:[],exports:[a.a,c.a],entryComponents:[a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(42),l=n(423),f=n(1605),p=n(1606),h=n(969),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=function(){function e(){}return e=m([Object(o.I)({declarations:[l.a,f.a,p.a,h.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a,d.a],providers:[],exports:[l.a,f.a,p.a,h.a],entryComponents:[l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(26),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=e,this.userProvider=t}return e.prototype.getChat=function(e,t,n){void 0===n&&(n=!1);var o={courseids:[e]},r={getFromCache:!n&&void 0};return this.sitesProvider.getCurrentSite().read("mod_chat_get_chats_by_courses",o,r).then(function(e){if(e.chats){var n=e.chats.find(function(e){return e.coursemodule==t});if(n)return n}return Promise.reject(null)})},e.prototype.loginUser=function(e){var t={chatid:e};return this.sitesProvider.getCurrentSite().write("mod_chat_login_user",t).then(function(e){return e.chatsid?e.chatsid:Promise.reject(null)})},e.prototype.logView=function(e){var t={chatid:e};return this.sitesProvider.getCurrentSite().write("mod_chat_view_chat",t)},e.prototype.sendMessage=function(e,t,n){var o={chatsid:e,messagetext:t,beepid:n};return this.sitesProvider.getCurrentSite().write("mod_chat_send_chat_message",o).then(function(e){return e.messageid?e.messageid:Promise.reject(null)})},e.prototype.getLatestMessages=function(e,t){var n={chatsid:e,chatlasttime:t};return this.sitesProvider.getCurrentSite().write("mod_chat_get_chat_latest_messages",n)},e.prototype.getMessagesUserData=function(e,t){var n=this,o=e.map(function(e){return n.userProvider.getProfile(e.userid,t,!0).then(function(t){e.userfullname=t.fullname,e.userprofileimageurl=t.profileimageurl}).catch(function(){e.userfullname=e.userid})});return Promise.all(o).then(function(){return e})},e.prototype.getChatUsers=function(e){var t={chatsid:e};return this.sitesProvider.getCurrentSite().read("mod_chat_get_chat_users",t,{getFromCache:!1})},e.COMPONENT="mmaModChat",e.POLL_INTERVAL=4e3,e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(26),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=e,this.userProvider=t}return e.prototype.getProfile=function(e){return e&&e!=this.sitesProvider.getCurrentSiteUserId()?this.userProvider.getProfile(e,null,!0).then(function(e){return e.profileimageurl=e.profileimageurl||!0,e}):Promise.resolve(!1)},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(2),s=n(72),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.sitesProvider=t,this.ROOT_CACHE_KEY="mmaMessageOutputAirnotifier:",this.logger=e.getInstance("AddonMessageOutputAirnotifier")}return e.prototype.enableDevice=function(e,t,n){return this.sitesProvider.getSite(n).then(function(n){return n.write("message_airnotifier_enable_device",{deviceid:e,enable:t?1:0}).then(function(e){if(!e.success)return e.warnings&&e.warnings.length?Promise.reject(e.warnings[0].message):Promise.reject(null)})})},e.prototype.getUserDevicesCacheKey=function(){return this.ROOT_CACHE_KEY+"userDevices"},e.prototype.getUserDevices=function(e){var t=this;return this.logger.debug("Get user devices"),this.sitesProvider.getSite(e).then(function(e){var n={appid:s.a.app_id},o={cacheKey:t.getUserDevicesCacheKey()};return e.read("message_airnotifier_get_user_devices",n,o).then(function(e){return e.devices})})},e.prototype.invalidateUserDevices=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return e.invalidateWsCacheForKey(t.getUserDevicesCacheKey())})},e.prototype.isEnabled=function(){return this.sitesProvider.wsAvailableInCurrentSite("message_airnotifier_enable_device")&&this.sitesProvider.wsAvailableInCurrentSite("message_airnotifier_get_user_devices")},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(7),i=n(2),s=n(69),a=n(9),c=n(327),u=n(103),d=n(26),l=n(12),f=n(11),p=n(6),h=n(1),m=n(45),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,"AddonMessagesSync",t,n,o,i,s,r)||this;return f.messagesOffline=a,f.eventsProvider=c,f.messagesProvider=u,f.userProvider=d,f.utils=l,f}return g(t,e),n=t,t.prototype.syncAllDiscussions=function(e,t){void 0===t&&(t=!1);return this.syncOnSites("all discussions"+(t?" (Only offline)":""),this.syncAllDiscussionsFunc.bind(this),[t],e)},t.prototype.syncAllDiscussionsFunc=function(e,t){var o=this;void 0===t&&(t=!1);return(t?this.messagesOffline.getAllDeviceOfflineMessages(e):this.messagesOffline.getAllMessages(e)).then(function(t){var r=[],i=[];return t.forEach(function(e){-1==r.indexOf(e.touserid)&&r.push(e.touserid)}),r.forEach(function(t){i.push(o.syncDiscussion(t,e).then(function(r){void 0!==r&&o.eventsProvider.trigger(n.AUTO_SYNCED,{userid:t,warnings:r},e)}))}),Promise.all(i)})},t.prototype.syncDiscussion=function(e,t){var n=this;if(t=t||this.sitesProvider.getCurrentSiteId(),this.isSyncing(e,t))return this.getOngoingSync(e,t);var o=[];this.logger.debug("Try to sync discussion with user '"+e+"'");var r=this.messagesOffline.getMessages(e,t).then(function(o){if(!o.length)return[];if(!n.appProvider.isOnline())return n.messagesOffline.setMessagesDeviceOffline(o,!0),Promise.reject(null);var r=Promise.resolve(),i=[];return(o=n.messagesProvider.sortMessages(o)).forEach(function(s,a){r=r.then(function(){return n.messagesProvider.sendMessageOnline(e,s.smallmessage,t).catch(function(e){if(!n.utils.isWebServiceError(e))return n.appProvider.isOnline()&&n.messagesOffline.setMessagesDeviceOffline(o,!1),Promise.reject(e);-1==i.indexOf(e)&&i.push(e)}).then(function(){return n.messagesOffline.deleteMessage(e,s.smallmessage,s.timecreated,t)}).then(function(){if(a<o.length-1)return setTimeout(function(){},1e3)})})}),r.then(function(){return i})}).then(function(t){if(t&&t.length)return n.userProvider.getProfile(e,void 0,!0).catch(function(){return{}}).then(function(r){t.forEach(function(t){o.push(n.translate.instant("addon.messages.warningmessagenotsent",{user:r.fullname?r.fullname:e,error:t}))})})}).then(function(){return o});return this.addOngoingSync(e,r,t)},t.AUTO_SYNCED="addon_messages_autom_synced",t=n=y([Object(o.A)(),v("design:paramtypes",[r.a,i.a,a.a,h.c,m.a,f.a,c.a,l.a,u.a,d.a,p.a])],t);var n}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(4),i=n(46),s=n(22),a=n(75),c=n(52),u=n(108),d=n(80),l=n(255),f=n(5),p=(n.n(f),n(401)),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},v=function(e){function t(t,n,o,r,i,s,a,u,d){var f=e.call(this,t,o)||this;return f.assignProvider=n,f.assignHelper=r,f.assignOffline=i,f.syncProvider=s,f.timeUtils=a,f.groupsProvider=u,f.navCtrl=d,f.component=c.a.COMPONENT,f.moduleName="assign",f.showNumbers=!0,f.submissionStatusSubmitted=c.a.SUBMISSION_STATUS_SUBMITTED,f.submissionStatusDraft=c.a.SUBMISSION_STATUS_DRAFT,f.needGrading=c.a.NEED_GRADING,f.syncEventName=l.a.AUTO_SYNCED,f}return h(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.userId=this.sitesProvider.getCurrentSiteUserId(),this.loadContent(!1,!0).then(function(){t.assignProvider.logView(t.assign.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(){}),t.canViewSubmissions?t.assignProvider.logGradingView(t.assign.id).catch(function(){}):t.assignProvider.logSubmissionView(t.assign.id).catch(function(){})}),this.savedObserver=this.eventsProvider.on(c.a.SUBMISSION_SAVED_EVENT,function(e){t.assign&&e.assignmentId==t.assign.id&&e.userId==t.userId&&t.showLoadingAndRefresh(!0,!1)},this.siteId),this.submittedObserver=this.eventsProvider.on(c.a.SUBMITTED_FOR_GRADING_EVENT,function(e){t.assign&&e.assignmentId==t.assign.id&&e.userId==t.userId&&(t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus),t.showLoadingAndRefresh(!0,!1))},this.siteId),this.gradedObserver=this.eventsProvider.on(c.a.GRADED_EVENT,function(e){t.assign&&e.assignmentId==t.assign.id&&e.userId==t.userId&&t.showLoadingAndRefresh(!0,!1)},this.siteId)},t.prototype.expandDescription=function(e){e&&e.preventDefault(),e&&e.stopPropagation(),this.assign&&(this.description||this.assign.introattachments)&&this.textUtils.expandText(this.translate.instant("core.description"),this.description,this.component,this.module.id,this.assign.introattachments)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.assignProvider.getAssignment(this.courseId,this.module.id).then(function(e){if(o.assign=e,o.dataRetrieved.emit(o.assign),o.description=o.assign.intro||o.description,t)return o.syncActivity(n).catch(function(){})}).then(function(){return o.assignOffline.hasAssignOfflineData(o.assign.id)}).then(function(e){return o.hasOffline=e,o.assignProvider.getSubmissions(o.assign.id).then(function(e){var t=o.timeUtils.timestamp();if(o.canViewSubmissions=e.canviewsubmissions,e.canviewsubmissions){if(o.assign.duedate>0)if(o.assign.duedate-t<=0)o.timeRemaining=o.translate.instant("addon.mod_assign.assignmentisdue");else if(o.timeRemaining=o.timeUtils.formatDuration(o.assign.duedate-t,3),o.assign.cutoffdate)if(o.assign.cutoffdate>t){var n=o.translate.instant("core.dfmediumdate");o.lateSubmissions=o.translate.instant("addon.mod_assign.latesubmissionsaccepted",{$a:f(1e3*o.assign.cutoffdate).format(n)})}else o.lateSubmissions=o.translate.instant("addon.mod_assign.nomoresubmissionsaccepted");else o.lateSubmissions="";else o.timeRemaining="",o.lateSubmissions="";return o.groupsProvider.activityHasGroups(o.assign.cmid).then(function(e){return o.showNumbers=!e,o.assignProvider.getSubmissionStatus(o.assign.id).then(function(e){o.summary=e.gradingsummary,o.needsGradingAvalaible=e.gradingsummary.submissionsneedgradingcount>0&&o.sitesProvider.getCurrentSite().isVersionGreaterEqualThan("3.2")})})}})}).then(function(){o.fillContextMenu(e)})},t.prototype.goToSubmissionList=function(e,t){void 0===e?this.navCtrl.push("AddonModAssignSubmissionListPage",{courseId:this.courseId,moduleId:this.module.id,moduleName:this.moduleName}):!t&&this.showNumbers||this.navCtrl.push("AddonModAssignSubmissionListPage",{status:e,courseId:this.courseId,moduleId:this.module.id,moduleName:this.moduleName})},t.prototype.hasSyncSucceed=function(e){return e.updated&&this.submissionComponent&&this.submissionComponent.invalidateAndRefresh(),e.updated},t.prototype.invalidateContent=function(){var e=this,t=[];return t.push(this.assignProvider.invalidateAssignmentData(this.courseId)),this.assign&&(t.push(this.assignProvider.invalidateAllSubmissionData(this.assign.id)),this.canViewSubmissions&&t.push(this.assignProvider.invalidateSubmissionStatusData(this.assign.id))),Promise.all(t).finally(function(){e.submissionComponent&&e.submissionComponent.invalidateAndRefresh()})},t.prototype.ionViewDidEnter=function(){e.prototype.ionViewDidEnter.call(this),this.submissionComponent&&this.submissionComponent.ionViewDidEnter()},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),this.submissionComponent&&this.submissionComponent.ionViewDidLeave()},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.assign||e.assignId!=this.assign.id)&&(e.warnings&&e.warnings.length&&this.domUtils.showErrorModal(e.warnings[0]),!0)},t.prototype.sync=function(){return this.syncProvider.syncAssign(this.assign.id)},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.savedObserver&&this.savedObserver.off(),this.submittedObserver&&this.submittedObserver.off(),this.gradedObserver&&this.gradedObserver.off()},m([Object(o._9)(p.a),g("design:type",p.a)],t.prototype,"submissionComponent",void 0),t=m([Object(o.m)({selector:"addon-mod-assign-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="assign && (description || (assign.introattachments && assign.introattachments.length))" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    \x3c!-- Description and intro attachments. --\x3e\n    <ion-card *ngIf="description" (click)="expandDescription($event)">\n        <ion-item text-wrap>\n            <core-format-text [text]="description" [component]="component" [componentId]="componentId" maxHeight="120" (click)="expandDescription($event)"></core-format-text>\n        </ion-item>\n    </ion-card>\n\n    <ion-card *ngIf="assign && assign.introattachments && assign.introattachments.length">\n        <core-file *ngFor="let file of assign.introattachments" [file]="file" [component]="component" [componentId]="componentId"></core-file>\n    </ion-card>\n\n    \x3c!-- Assign has something offline. --\x3e\n    <div *ngIf="hasOffline" class="core-warning-card" icon-start>\n        <ion-icon name="warning"></ion-icon>\n        {{ \'core.hasdatatosync\' | translate:{$a: moduleName} }}\n    </div>\n\n    \x3c!-- User can view all submissions (teacher). --\x3e\n    <ion-card *ngIf="assign && canViewSubmissions" class="core-list-align-detail-right">\n        <ion-item text-wrap *ngIf="timeRemaining">\n            <h2>{{ \'addon.mod_assign.timeremaining\' | translate }}</h2>\n            <p>{{ timeRemaining }}</p>\n        </ion-item>\n        <ion-item text-wrap *ngIf="lateSubmissions">\n            <h2>{{ \'addon.mod_assign.latesubmissions\' | translate }}</h2>\n            <p>{{ lateSubmissions }}</p>\n        </ion-item>\n\n        \x3c!-- Summary of all submissions. --\x3e\n        <a ion-item text-wrap *ngIf="summary && summary.participantcount" (click)="goToSubmissionList()">\n            <h2 *ngIf="assign.teamsubmission">{{ \'addon.mod_assign.numberofteams\' | translate }}</h2>\n            <h2 *ngIf="!assign.teamsubmission">{{ \'addon.mod_assign.numberofparticipants\' | translate }}</h2>\n            <ion-badge item-end *ngIf="showNumbers" color="primary">\n                {{ summary.participantcount }}\n            </ion-badge>\n        </a>\n\n        \x3c!-- Summary of submissions with draft status. --\x3e\n        <a ion-item text-wrap *ngIf="assign.submissiondrafts && summary && summary.submissionsenabled" [attr.detail-none]="(showNumbers && !summary.submissiondraftscount) ? true : null" (click)="goToSubmissionList(submissionStatusDraft, summary.submissiondraftscount)">\n            <h2>{{ \'addon.mod_assign.numberofdraftsubmissions\' | translate }}</h2>\n            <ion-badge item-end *ngIf="showNumbers" color="primary">\n                {{ summary.submissiondraftscount }}\n            </ion-badge>\n        </a>\n\n        \x3c!-- Summary of submissions with submitted status. --\x3e\n        <a ion-item text-wrap *ngIf="summary && summary.submissionsenabled" [attr.detail-none]="(showNumbers && !summary.submissionssubmittedcount) ? true : null" (click)="goToSubmissionList(submissionStatusSubmitted, summary.submissionssubmittedcount)">\n            <h2>{{ \'addon.mod_assign.numberofsubmittedassignments\' | translate }}</h2>\n            <ion-badge item-end *ngIf="showNumbers" color="primary">\n                {{ summary.submissionssubmittedcount }}\n            </ion-badge>\n        </a>\n\n        \x3c!-- Summary of submissions that need grading. --\x3e\n        <a ion-item text-wrap *ngIf="summary && summary.submissionsenabled && !assign.teamsubmission && showNumbers" [attr.detail-none]="needsGradingAvalaible ? null : true" (click)="goToSubmissionList(needGrading, needsGradingAvalaible)">\n            <h2>{{ \'addon.mod_assign.numberofsubmissionsneedgrading\' | translate }}</h2>\n            <ion-badge item-end color="primary">\n                {{ summary.submissionsneedgradingcount }}\n            </ion-badge>\n        </a>\n\n        \x3c!-- Ungrouped users. --\x3e\n        <div *ngIf="assign.teamsubmission && summary && summary.warnofungroupedusers" class="core-info-card" icon-start>\n            <ion-icon name="information-circle"></ion-icon>\n            {{ \'addon.mod_assign.ungroupedusers\' | translate }}\n        </div>\n    </ion-card>\n\n    \x3c!-- If it\'s a student, display his submission. --\x3e\n    <addon-mod-assign-submission *ngIf="loaded && !canViewSubmissions" [courseId]="courseId" [moduleId]="module.id"></addon-mod-assign-submission>\n\n</core-loading>\n'}),y(2,Object(o.N)()),g("design:paramtypes",[o.C,c.a,r.f,u.a,d.a,l.a,s.a,i.a,r.q])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return D});var o=n(0),r=n(4),i=n(1),s=n(9),a=n(12),c=n(46),u=n(93),d=n(2),l=n(45),f=n(8),p=n(11),h=n(22),m=n(6),g=n(10),y=n(107),v=n(115),b=n(26),_=n(52),P=n(108),O=n(80),w=n(5),S=(n.n(w),n(135)),R=n(133),E=n(738),C=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},I=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},A=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},D=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p,h,m,g,y,v,b){this.navCtrl=e,this.appProvider=t,this.domUtils=n,this.syncProvider=r,this.timeUtils=i,this.textUtils=s,this.translate=a,this.utils=c,this.eventsProvider=u,this.courseProvider=d,this.fileUploaderHelper=l,this.gradesHelper=f,this.userProvider=p,this.groupsProvider=h,this.langProvider=m,this.assignProvider=g,this.assignHelper=y,this.assignOfflineProvider=v,this.splitviewCtrl=b,this.submitModel={},this.statusNew=_.a.SUBMISSION_STATUS_NEW,this.statusReopened=_.a.SUBMISSION_STATUS_REOPENED,this.attemptReopenMethodNone=_.a.ATTEMPT_REOPEN_METHOD_NONE,this.unlimitedAttempts=_.a.UNLIMITED_ATTEMPTS,this.originalGrades={},this.siteId=o.getCurrentSiteId(),this.currentUserId=o.getCurrentSiteUserId()}return e.prototype.ngOnInit=function(){this.selectedTab=this.showGrade&&"false"!==this.showGrade?1:0,this.isSubmittedForGrading=!!this.submitId,this.loadData()},e.prototype.calculateTimeRemaining=function(e){if(this.assign.duedate>0){var t=this.timeUtils.timestamp(),n=e.lastattempt&&e.lastattempt.extensionduedate?e.lastattempt.extensionduedate:this.assign.duedate,o=n-t;if(o<=0)if(this.userSubmission&&this.userSubmission.status==_.a.SUBMISSION_STATUS_SUBMITTED){var r=this.userSubmission.timemodified-n;r>0?(this.timeRemaining=this.translate.instant("addon.mod_assign.submittedlate",{$a:this.timeUtils.formatDuration(r,2)}),this.timeRemainingClass="latesubmission"):(this.timeRemaining=this.translate.instant("addon.mod_assign.submittedearly",{$a:this.timeUtils.formatDuration(-r,2)}),this.timeRemainingClass="earlysubmission")}else e.lastattempt&&e.lastattempt.submissionsenabled||e.gradingsummary&&e.gradingsummary.submissionsenabled?(this.timeRemaining=this.translate.instant("addon.mod_assign.overdue",{$a:this.timeUtils.formatDuration(-o,3)}),this.timeRemainingClass="overdue"):(this.timeRemaining=this.translate.instant("addon.mod_assign.duedatereached"),this.timeRemainingClass="");else this.timeRemaining=this.timeUtils.formatDuration(o,3),this.timeRemainingClass=""}else this.timeRemaining="",this.timeRemainingClass=""},e.prototype.canLeave=function(){var e=this;return this.hasDataToSave().then(function(t){if(t)return e.domUtils.showConfirm(e.translate.instant("core.confirmcanceledit")).then(function(){return e.discardDrafts().catch(function(){})})})},e.prototype.copyPrevious=function(){var e=this;if(this.appProvider.isOnline()){if(!this.previousAttempt)return this.goToEdit();var t=this.assignProvider.getSubmissionObjectFromAttempt(this.assign,this.previousAttempt),n=this.domUtils.showModalLoading();this.assignHelper.getSubmissionSizeForCopy(this.assign,t).catch(function(){return-1}).then(function(t){return n.dismiss(),e.fileUploaderHelper.confirmUploadFile(t,!0)}).then(function(){n=e.domUtils.showModalLoading("core.sending",!0),e.assignHelper.copyPreviousAttempt(e.assign,t).then(function(){e.goToEdit(),e.assign.submissiondrafts?e.invalidateAndRefresh():e.eventsProvider.trigger(_.a.SUBMITTED_FOR_GRADING_EVENT,{assignmentId:e.assign.id,submissionId:e.userSubmission.id,userId:e.currentUserId},e.siteId)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.error",!0)}).finally(function(){n.dismiss()})}).catch(function(){})}else this.domUtils.showErrorModal("core.networkerrormsg",!0)},e.prototype.discardDrafts=function(){return this.feedback&&this.feedback.plugins?this.assignHelper.discardFeedbackPluginData(this.assign.id,this.submitId,this.feedback):Promise.resolve()},e.prototype.goToEdit=function(){this.navCtrl.push("AddonModAssignEditPage",{moduleId:this.moduleId,courseId:this.courseId,userId:this.submitId,blindId:this.blindId})},e.prototype.hasDataToSave=function(){if(!this.canSaveGrades||!this.loaded)return Promise.resolve(!1);if(this.originalGrades.grade!=this.grade.grade||this.originalGrades.addAttempt!=this.grade.addAttempt||this.originalGrades.applyToAll!=this.grade.applyToAll)return Promise.resolve(!0);if(this.gradeInfo&&this.gradeInfo.outcomes)for(var e in this.gradeInfo.outcomes){var t=this.gradeInfo.outcomes[e];if("undefined"==this.originalGrades.outcomes[t.id]||this.originalGrades.outcomes[t.id]!=t.selectedId)return Promise.resolve(!0)}return this.feedback&&this.feedback.plugins?this.assignHelper.hasFeedbackDataChanged(this.assign,this.submitId,this.feedback).catch(function(){return!1}):Promise.resolve(!1)},e.prototype.ionViewDidEnter=function(){this.tabs&&this.tabs.ionViewDidEnter()},e.prototype.ionViewDidLeave=function(){this.tabs&&this.tabs.ionViewDidLeave()},e.prototype.invalidateAndRefresh=function(){var e=this;this.loaded=!1;var t=[];return t.push(this.assignProvider.invalidateAssignmentData(this.courseId)),this.assign&&(t.push(this.assignProvider.invalidateSubmissionStatusData(this.assign.id,this.submitId,!!this.blindId)),t.push(this.assignProvider.invalidateAssignmentUserMappingsData(this.assign.id)),t.push(this.assignProvider.invalidateListParticipantsData(this.assign.id))),t.push(this.gradesHelper.invalidateGradeModuleItems(this.courseId,this.submitId)),t.push(this.courseProvider.invalidateModule(this.moduleId)),this.submissionComponents&&this.submissionComponents.length&&this.submissionComponents.forEach(function(e){t.push(e.invalidate())}),Promise.all(t).catch(function(){}).then(function(){return e.loadData()})},e.prototype.loadData=function(){var e=this,t=!!this.blindId;return this.previousAttempt=void 0,this.submitId||(this.submitId=this.currentUserId,t=!1),this.assignProvider.getAssignment(this.courseId,this.moduleId).then(function(t){var n=e.timeUtils.timestamp(),o=[];return e.assign=t,t.allowsubmissionsfromdate&&t.allowsubmissionsfromdate>=n&&(e.fromDate=w(1e3*t.allowsubmissionsfromdate).format(e.translate.instant("core.dfmediumdate"))),e.currentAttempt=0,e.maxAttemptsText=e.translate.instant("addon.mod_assign.unlimitedattempts"),e.blindMarking=e.isSubmittedForGrading&&t.blindmarking&&!t.revealidentities,e.blindMarking||e.submitId==e.currentUserId||o.push(e.userProvider.getProfile(e.submitId,e.courseId).then(function(t){e.user=t})),o.push(e.assignOfflineProvider.getSubmission(t.id,e.submitId).then(function(t){e.hasOffline=t&&t.plugindata&&Object.keys(t.plugindata).length>0,e.submittedOffline=t&&t.submitted}).catch(function(){e.hasOffline=!1,e.submittedOffline=!1})),Promise.all(o)}).then(function(){return e.assignProvider.getSubmissionStatus(e.assign.id,e.submitId,t)}).then(function(t){var n=[];if(e.submissionStatusAvailable=!0,e.lastAttempt=t.lastattempt,e.membersToSubmit=[],t.previousattempts&&t.previousattempts.length>0){var o=t.previousattempts.sort(function(e,t){return e.attemptnumber-t.attemptnumber});e.previousAttempt=o[o.length-1]}return e.treatLastAttempt(t,n),e.calculateTimeRemaining(t),n.push(e.loadFeedback(t.feedback)),e.userSubmission&&e.userSubmission.plugins||(e.userSubmission={},e.userSubmission.plugins=e.assignHelper.getPluginsEnabled(e.assign,"assignsubmission")),n.push(e.assignProvider.getUnsupportedEditPlugins(e.userSubmission.plugins).then(function(t){e.unsupportedEditPlugins=t})),Promise.all(n)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Error getting assigment data.")}).finally(function(){e.loaded=!0})},e.prototype.loadFeedback=function(e){var t=this;if(this.grade={method:!1,grade:!1,modified:0,gradingStatus:!1,addAttempt:!1,applyToAll:!1,scale:!1,lang:!1},this.originalGrades={grade:!1,addAttempt:!1,applyToAll:!1,outcomes:{}},e){if(this.feedback=e,e.grade&&e.grade.grader&&this.userProvider.getProfile(e.grade.grader,this.courseId).then(function(e){t.grader=e}).catch(function(){}),e.gradefordisplay){e.gradefordisplay.indexOf('class="advancedgrade"')>-1&&(this.feedback.advancedgrade=!0)}if(e.grade&&e.grade.grade&&!this.grade.grade){var n=parseFloat(e.grade.grade);this.grade.grade=n||0==n?n:null}}else this.selectedTab=0,this.tabs.selectTab(0);return this.grade.gradingStatus=this.lastAttempt&&this.lastAttempt.gradingstatus,this.courseProvider.getModuleBasicGradeInfo(this.moduleId).then(function(e){if(t.gradeInfo=e,e)return e.outcomes=e.outcomes||[],t.isDestroyed||t.syncProvider.blockOperation(_.a.COMPONENT,t.assign.id),t.treatGradeInfo()}).then(function(){if(t.isGrading){return t.allowAddAttempt=t.assign.attemptreopenmethod==_.a.ATTEMPT_REOPEN_METHOD_MANUAL&&(!t.userSubmission||t.assign.maxattempts==_.a.UNLIMITED_ATTEMPTS||t.userSubmission&&t.userSubmission.attemptnumber<t.assign.maxattempts-1),t.assign.teamsubmission&&(t.grade.applyToAll=!0,t.originalGrades.applyToAll=!0),t.assign.markingworkflow&&t.grade.gradingStatus&&(t.workflowStatusTranslationId=t.assignProvider.getSubmissionGradingStatusTranslationId(t.grade.gradingStatus)),t.feedback&&t.feedback.plugins||(t.feedback={},t.feedback.plugins=t.assignHelper.getPluginsEnabled(t.assign,"assignfeedback")),t.canSaveGrades?t.assignOfflineProvider.getSubmissionGrade(t.assign.id,t.submitId).catch(function(){}).then(function(n){n&&(!e||!e.gradeddate||e.gradeddate<n.timemodified)&&(t.grade.modified<n.timemodified&&(t.grade.grade=n.grade,t.gradingStatusTranslationId="addon.mod_assign.gradenotsynced",t.gradingColor="",t.originalGrades.grade=t.grade.grade),t.grade.applyToAll=n.applytoall,t.grade.addAttempt=n.addattempt,t.originalGrades.applyToAll=t.grade.applyToAll,t.originalGrades.addAttempt=t.grade.addAttempt,n.outcomes&&Object.keys(n.outcomes).length&&t.gradeInfo.outcomes.forEach(function(e){void 0!==n.outcomes[e.itemNumber]&&e.modified<n.timemodified&&(e.selectedId=n.outcomes[e.itemNumber],t.originalGrades.outcomes[e.id]=e.selectedId)}))}):t.courseProvider.getModule(t.moduleId,t.courseId,void 0,!0).then(function(e){t.gradeUrl=e.url+"&action=grader&userid="+t.submitId})}})},e.prototype.openUserProfile=function(e){(this.splitviewCtrl?this.splitviewCtrl.getMasterNav():this.navCtrl).push("CoreUserProfilePage",{userId:e,courseId:this.courseId})},e.prototype.setStatusNameAndClass=function(e){this.hasOffline||this.submittedOffline?(this.statusTranslated=this.translate.instant("core.notsent"),this.statusColor="warning"):this.assign.teamsubmission?!e.lastattempt.submissiongroup&&this.assign.preventsubmissionnotingroup?(this.statusTranslated=this.translate.instant("addon.mod_assign.nosubmission"),this.statusColor=this.assignProvider.getSubmissionStatusColor("nosubmission")):this.userSubmission&&this.userSubmission.status!=this.statusNew?(this.statusTranslated=this.translate.instant("addon.mod_assign.submissionstatus_"+this.userSubmission.status),this.statusColor=this.assignProvider.getSubmissionStatusColor(this.userSubmission.status)):e.lastattempt.submissionsenabled?(this.statusTranslated=this.translate.instant("addon.mod_assign.nosubmission"),this.statusColor=this.assignProvider.getSubmissionStatusColor("nosubmission")):(this.statusTranslated=this.translate.instant("addon.mod_assign.noonlinesubmissions"),this.statusColor=this.assignProvider.getSubmissionStatusColor("noonlinesubmissions")):this.userSubmission&&this.userSubmission.status!=this.statusNew?(this.statusTranslated=this.translate.instant("addon.mod_assign.submissionstatus_"+this.userSubmission.status),this.statusColor=this.assignProvider.getSubmissionStatusColor(this.userSubmission.status)):e.lastattempt.submissionsenabled?(this.statusTranslated=this.translate.instant("addon.mod_assign.noattempt"),this.statusColor=this.assignProvider.getSubmissionStatusColor("noattempt")):(this.statusTranslated=this.translate.instant("addon.mod_assign.noonlinesubmissions"),this.statusColor=this.assignProvider.getSubmissionStatusColor("noonlinesubmissions"))},e.prototype.showAdvancedGrade=function(){this.feedback&&this.feedback.advancedgrade&&this.textUtils.expandText(this.translate.instant("core.grades.grade"),this.feedback.gradefordisplay,_.a.COMPONENT,this.moduleId)},e.prototype.submitForGrading=function(e){var t=this;!this.assign.requiresubmissionstatement||e?this.domUtils.showConfirm(this.translate.instant("addon.mod_assign.confirmsubmission")).then(function(){var n=t.domUtils.showModalLoading("core.sending",!0);t.assignProvider.submitForGrading(t.assign.id,t.courseId,e,t.userSubmission.timemodified,t.hasOffline).then(function(){t.eventsProvider.trigger(_.a.SUBMITTED_FOR_GRADING_EVENT,{assignmentId:t.assign.id,submissionId:t.userSubmission.id,userId:t.currentUserId},t.siteId)}).finally(function(){n.dismiss()})}).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.error",!0)}):this.domUtils.showErrorModal("addon.mod_assign.acceptsubmissionstatement",!0)},e.prototype.submitGrade=function(){var e=this;return this.hasDataToSave().then(function(t){if(t){var n=e.userSubmission?e.userSubmission.attemptnumber:-1,o={},r=e.grade.scale&&0==e.grade.grade?-1:e.utils.unformatFloat(e.grade.grade);if(!1===r)return Promise.reject(e.translate.instant("core.grades.badgrade"));var i=e.domUtils.showModalLoading("core.sending",!0);return e.gradeInfo.outcomes.forEach(function(e){e.itemNumber&&(o[e.itemNumber]=e.selectedId)}),(e.feedback&&e.feedback.plugins?e.assignHelper.prepareFeedbackPluginData(e.assign.id,e.submitId,e.feedback):Promise.resolve({})).then(function(t){return e.assignProvider.submitGradingForm(e.assign.id,e.submitId,e.courseId,r,n,e.grade.addAttempt,e.grade.gradingStatus,e.grade.applyToAll,o,t).then(function(){return e.discardDrafts()}).finally(function(){e.invalidateAndRefresh(),e.eventsProvider.trigger(_.a.GRADED_EVENT,{assignmentId:e.assign.id,submissionId:e.submitId,userId:e.currentUserId},e.siteId)})}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.error",!0)}).finally(function(){e.tabs.selectTab(0),i.dismiss()})}})},e.prototype.treatGradeInfo=function(){var e=this;return this.grade.method=this.gradeInfo.advancedgrading&&this.gradeInfo.advancedgrading[0]&&void 0!==this.gradeInfo.advancedgrading[0].method?this.gradeInfo.advancedgrading[0].method||"simple":"simple",this.isGrading=!0,this.canSaveGrades="simple"==this.grade.method,this.gradeInfo.scale?this.grade.scale=this.utils.makeMenuFromList(this.gradeInfo.scale,this.translate.instant("core.nograde")):this.langProvider.getCurrentLanguage().then(function(t){e.grade.lang=t}),this.assignProvider.isOutcomesEditEnabled()&&this.gradeInfo.outcomes.forEach(function(t){t.scale&&(t.options=e.utils.makeMenuFromList(t.scale,e.translate.instant("core.grades.nooutcome"))),t.selectedId=0,e.originalGrades.outcomes[t.id]=t.selectedId}),this.gradesHelper.getGradeModuleItems(this.courseId,this.moduleId,this.submitId).then(function(t){var n=[];t.forEach(function(t){if(t.outcomeid||t.scaleid)t.outcomeid&&e.gradeInfo.outcomes.forEach(function(o){o.id==t.outcomeid&&(o.selected=t.gradeformatted,o.modified=t.gradedategraded,o.options&&(o.selectedId=e.gradesHelper.getGradeValueFromLabel(o.options,o.selected),e.originalGrades.outcomes[o.id]=o.selectedId,o.itemNumber=t.itemnumber),n.push(o))});else{if(e.grade.scale)e.grade.grade=e.gradesHelper.getGradeValueFromLabel(e.grade.scale,t.gradeformatted);else{var o=parseFloat(t.gradeformatted);e.grade.grade=o||0==o?o:null}e.grade.modified=t.gradedategraded,e.originalGrades.grade=e.grade.grade}}),e.gradeInfo.outcomes=n})},e.prototype.treatLastAttempt=function(e,t){var n=this;if(e.lastattempt){var o=this.assign.requiresubmissionstatement&&void 0===this.assign.submissionstatement;this.canSubmit=!this.isSubmittedForGrading&&!this.submittedOffline&&(e.lastattempt.cansubmit||this.hasOffline&&this.assignProvider.canSubmitOffline(this.assign,e)),this.canEdit=!this.isSubmittedForGrading&&e.lastattempt.canedit&&(!this.submittedOffline||!this.assign.submissiondrafts),this.assign.requiresubmissionstatement&&this.assign.submissiondrafts&&this.submitId==this.currentUserId?(this.submissionStatement=this.assign.submissionstatement,this.submitModel.submissionStatement=!1):(this.submissionStatement=void 0,this.submitModel.submissionStatement=!0),this.showErrorStatementEdit=o&&!this.assign.submissiondrafts&&this.submitId==this.currentUserId,this.showErrorStatementSubmit=o&&this.assign.submissiondrafts,this.userSubmission=this.assignProvider.getSubmissionObjectFromAttempt(this.assign,e.lastattempt),this.assign.attemptreopenmethod!=this.attemptReopenMethodNone&&this.userSubmission&&(this.currentAttempt=this.userSubmission.attemptnumber+1),this.setStatusNameAndClass(e),this.assign.teamsubmission&&(e.lastattempt.submissiongroup&&t.push(this.groupsProvider.getActivityAllowedGroups(this.assign.cmid).then(function(t){t.forEach(function(t){t.id==e.lastattempt.submissiongroup&&(n.lastAttempt.submissiongroupname=t.name)})})),this.userSubmission&&this.userSubmission.status!=this.statusNew&&e.lastattempt.submissiongroupmemberswhoneedtosubmit.forEach(function(e){t.push(n.blindMarking?n.assignProvider.getAssignmentUserMappings(n.assign.id,e).then(function(e){n.membersToSubmit.push(e)}):n.userProvider.getProfile(e,n.courseId).then(function(e){n.membersToSubmit.push(e)}))})),this.gradingStatusTranslationId=this.assignProvider.getSubmissionGradingStatusTranslationId(e.lastattempt.gradingstatus),this.gradingColor=this.assignProvider.getSubmissionGradingStatusColor(e.lastattempt.gradingstatus),this.userSubmission&&(this.assign.teamsubmission&&e.lastattempt.submissiongroup&&this.assign.preventsubmissionnotingroup||(this.submissionPlugins=this.previousAttempt&&this.previousAttempt.submission.plugins&&this.userSubmission.status==this.statusReopened?this.previousAttempt.submission.plugins:this.userSubmission.plugins))}},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.assign&&this.isGrading&&this.syncProvider.unblockOperation(_.a.COMPONENT,this.assign.id)},C([Object(o._9)(S.a),I("design:type",S.a)],e.prototype,"tabs",void 0),C([Object(o._10)(E.a),I("design:type",o.T)],e.prototype,"submissionComponents",void 0),C([Object(o.D)(),I("design:type",Number)],e.prototype,"courseId",void 0),C([Object(o.D)(),I("design:type",Number)],e.prototype,"moduleId",void 0),C([Object(o.D)(),I("design:type",Number)],e.prototype,"submitId",void 0),C([Object(o.D)(),I("design:type",Number)],e.prototype,"blindId",void 0),C([Object(o.D)(),I("design:type",Object)],e.prototype,"showGrade",void 0),e=C([Object(o.m)({selector:"addon-mod-assign-submission",template:'<core-loading [hideUntil]="loaded">\n\n    \x3c!-- User and status of the submission. --\x3e\n    <a ion-item text-wrap *ngIf="!blindMarking && user" (click)="openUserProfile(submitId)" [title]="user.fullname">\n        <ion-avatar item-start>\n            <img [src]="user.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: user.fullname}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n        </ion-avatar>\n        <h2>{{ user.fullname }}</h2>\n        <ng-container *ngTemplateOutlet="submissionStatus"></ng-container>\n    </a>\n\n    \x3c!-- Status of the submission if user is blinded. --\x3e\n    <ion-item text-wrap *ngIf="blindMarking && !user">\n        <h2>{{ \'addon.mod_assign.hiddenuser\' | translate }} {{blindId}}</h2>\n        <ng-container *ngTemplateOutlet="submissionStatus"></ng-container>\n    </ion-item>\n\n    \x3c!-- Status of the submission in the rest of cases. --\x3e\n    <ion-item text-wrap *ngIf="(blindMarking && user) || (!blindMarking && !user)">\n        <h2>{{ \'addon.mod_assign.submissionstatus\' | translate }}</h2>\n        <ng-container *ngTemplateOutlet="submissionStatus"></ng-container>\n    </ion-item>\n\n    \x3c!-- Tabs: see the submission or grade it. --\x3e\n    <core-tabs [selectedIndex]="selectedTab" [hideUntil]="loaded" parentScrollable="true">\n        \x3c!-- View the submission tab. --\x3e\n        <core-tab [title]="\'addon.mod_assign.submission\' | translate">\n            <ng-template>\n                <addon-mod-assign-submission-plugin *ngFor="let plugin of submissionPlugins" [assign]="assign" [submission]="userSubmission" [plugin]="plugin"></addon-mod-assign-submission-plugin>\n\n                \x3c!-- Render some data about the submission. --\x3e\n                <ion-item text-wrap *ngIf="userSubmission && userSubmission.status != statusNew && userSubmission.timemodified">\n                    <h2>{{ \'addon.mod_assign.timemodified\' | translate }}</h2>\n                    <p>{{ userSubmission.timemodified * 1000 | coreFormatDate:"dfmediumdate" }}</p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="timeRemaining" [ngClass]="[timeRemainingClass]">\n                    <h2>{{ \'addon.mod_assign.timeremaining\' | translate }}</h2>\n                    <p><core-format-text [text]="timeRemaining"></core-format-text></p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="fromDate && !isSubmittedForGrading">\n                    <p *ngIf="assign.intro" [innerHTML]="\'addon.mod_assign.allowsubmissionsfromdatesummary\' | translate: {\'$a\': fromDate}"></p>\n                    <p *ngIf="!assign.intro" [innerHTML]="\'addon.mod_assign.allowsubmissionsanddescriptionfromdatesummary\' | translate: {\'$a\': fromDate}"></p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="assign.duedate && !isSubmittedForGrading">\n                    <h2>{{ \'addon.mod_assign.duedate\' | translate }}</h2>\n                    <p *ngIf="assign.duedate" >{{ assign.duedate * 1000 | coreFormatDate:"dfmediumdate" }}</p>\n                    <p *ngIf="!assign.duedate" >{{ \'addon.mod_assign.duedateno\' | translate }}</p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="assign.duedate && assign.cutoffdate && isSubmittedForGrading">\n                    <h2>{{ \'addon.mod_assign.cutoffdate\' | translate }}</h2>\n                    <p>{{ assign.cutoffdate * 1000 | coreFormatDate:"dfmediumdate" }}</p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="assign.duedate && lastAttempt && lastAttempt.extensionduedate && !isSubmittedForGrading">\n                    <h2>{{ \'addon.mod_assign.extensionduedate\' | translate }}</h2>\n                    <p>{{ lastAttempt.extensionduedate * 1000 | coreFormatDate:"dfmediumdate" }}</p>\n                </ion-item>\n\n                <ion-item text-wrap *ngIf="currentAttempt && !isGrading">\n                    <h2>{{ \'addon.mod_assign.attemptnumber\' | translate }}</h2>\n                    <p *ngIf="assign.maxattempts == unlimitedAttempts">{{ \'addon.mod_assign.outof\' | translate : {\'$a\': {\'current\': currentAttempt, \'total\': maxAttemptsText} } }}</p>\n                    <p *ngIf="assign.maxattempts != unlimitedAttempts">{{ \'addon.mod_assign.outof\' | translate : {\'$a\': {\'current\': currentAttempt, \'total\': assign.maxattempts} } }}</p>\n                </ion-item>\n\n                \x3c!-- Add or edit submission. --\x3e\n                <ion-item text-wrap *ngIf="canEdit">\n                    <div *ngIf="!unsupportedEditPlugins.length && !showErrorStatementEdit">\n                        \x3c!-- If has offline data, show edit. --\x3e\n                        <a ion-button block color="primary" *ngIf="hasOffline" (click)="goToEdit()">{{ \'addon.mod_assign.editsubmission\' | translate }}</a>\n                        \x3c!-- If no submission or is new, show add submission. --\x3e\n                        <a ion-button block color="primary" *ngIf="!hasOffline && (!userSubmission || !userSubmission.status || userSubmission.status == statusNew)" (click)="goToEdit()">{{ \'addon.mod_assign.addsubmission\' | translate }}</a>\n                        \x3c!-- If reopened, show addfromprevious and addnewattempt. --\x3e\n                        <ng-container *ngIf="!hasOffline && userSubmission && userSubmission.status == statusReopened">\n                            <a ion-button block color="primary" (click)="copyPrevious()">{{ \'addon.mod_assign.addnewattemptfromprevious\' | translate }}</a>\n                            <a ion-button block color="primary" (click)="goToEdit()">{{ \'addon.mod_assign.addnewattempt\' | translate }}</a>\n                        </ng-container>\n                        \x3c!-- Else show editsubmission. --\x3e\n                        <a ion-button block color="primary" *ngIf="!hasOffline && userSubmission && userSubmission.status && userSubmission.status != statusNew && userSubmission.status != statusReopened" (click)="goToEdit()">{{ \'addon.mod_assign.editsubmission\' | translate }}</a>\n                    </div>\n                    <div *ngIf="unsupportedEditPlugins && unsupportedEditPlugins.length && !showErrorStatementEdit">\n                        <p class="core-danger-item">{{ \'addon.mod_assign.erroreditpluginsnotsupported\' | translate }}</p>\n                        <p class="core-danger-item" *ngFor="let name of unsupportedEditPlugins">{{ name }}</p>\n                    </div>\n                    <div *ngIf="showErrorStatementEdit">\n                        <p class="core-danger-item">{{ \'addon.mod_assign.cannoteditduetostatementsubmission\' | translate }}</p>\n                    </div>\n                </ion-item>\n\n                \x3c!-- Submit for grading form. --\x3e\n                <div *ngIf="canSubmit">\n                    <ion-item text-wrap *ngIf="submissionStatement">\n                        <ion-label><core-format-text [text]="submissionStatement"></core-format-text></ion-label>\n                        <ion-checkbox item-end name="submissionstatement" [(ngModel)]="submitModel.submissionStatement">\n                        </ion-checkbox>\n                    </ion-item>\n                    \x3c!-- Submit button. --\x3e\n                    <ion-item text-wrap *ngIf="!showErrorStatementSubmit">\n                        <a ion-button block (click)="submitForGrading(submitModel.submissionStatement)">{{ \'addon.mod_assign.submitassignment\' | translate }}</a>\n                        <p>{{ \'addon.mod_assign.submitassignment_help\' | translate }}</p>\n                    </ion-item>\n                    \x3c!-- Error because we lack submissions statement. --\x3e\n                    <ion-item text-wrap *ngIf="showErrorStatementSubmit">\n                        <p class="core-danger-item">{{ \'addon.mod_assign.cannotsubmitduetostatementsubmission\' | translate }}</p>\n                    </ion-item>\n                </div>\n\n                \x3c!-- Team members that need to submit it too. --\x3e\n                <ion-item text-wrap *ngIf="membersToSubmit && membersToSubmit.length > 0">\n                    <h2>{{ \'addon.mod_assign.userswhoneedtosubmit\' | translate: {$a: \'\'} }}</h2>\n                    <div *ngFor="let user of membersToSubmit">\n                        <a *ngIf="user.fullname" (click)="openUserProfile(user.id)" [title]="user.fullname">\n                            <ion-avatar item-start>\n                                <img [src]="user.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: user.fullname}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n                            </ion-avatar>\n                            <h2>{{ user.fullname }}</h2>\n                        </a>\n                        <p *ngIf="!user.fullname">\n                            {{ \'addon.mod_assign.hiddenuser\' | translate }} <core-format-text [text]="user"></core-format-text>\n                        </p>\n                    </div>\n                </ion-item>\n\n                \x3c!-- Submission is locked. --\x3e\n                <ion-item text-wrap *ngIf="lastAttempt && lastAttempt.locked">\n                    <h2>{{ \'addon.mod_assign.submissionslocked\' | translate }}</h2>\n                </ion-item>\n\n                \x3c!-- Editing status. --\x3e\n                <ion-item text-wrap *ngIf="lastAttempt && isSubmittedForGrading && lastAttempt.caneditowner !== undefined" [ngClass]="{submissioneditable: lastAttempt.caneditowner, submissionnoteditable: !lastAttempt.caneditowner}">\n                    <h2>{{ \'addon.mod_assign.editingstatus\' | translate }}</h2>\n                    <p *ngIf="lastAttempt.caneditowner">{{ \'addon.mod_assign.submissioneditable\' | translate }}</p>\n                    <p *ngIf="!lastAttempt.caneditowner">{{ \'addon.mod_assign.submissionnoteditable\' | translate }}</p>\n                </ion-item>\n            </ng-template>\n        </core-tab>\n\n        \x3c!-- Grade the submission tab. --\x3e\n        <core-tab [title]="\'addon.mod_assign.grade\' | translate" *ngIf="feedback || isGrading">\n            <ng-template>\n                \x3c!-- Current grade if method is advanced. --\x3e\n                <ion-item text-wrap *ngIf="feedback.gradefordisplay && (!isGrading || grade.method != \'simple\')" class="core-grading-summary">\n                    <h2>{{ \'addon.mod_assign.currentgrade\' | translate }}</h2>\n                    <p><core-format-text [text]="feedback.gradefordisplay"></core-format-text></p>\n                    <a ion-button item-end icon-only *ngIf="feedback.advancedgrade" (click)="showAdvancedGrade()">\n                        <ion-icon name="search"></ion-icon>\n                    </a>\n                </ion-item>\n\n                \x3c!-- Numeric grade. --\x3e\n                <ion-item text-wrap *ngIf="grade.method == \'simple\' && !grade.scale">\n                    <ion-label stacked>{{ \'addon.mod_assign.gradeoutof\' | translate: {$a: gradeInfo.grade} }}</ion-label>\n                    <ion-input type="number" [(ngModel)]="grade.grade" min="0" [max]="gradeInfo.grade" [lang]="grade.lang"></ion-input>\n                </ion-item>\n\n                \x3c!-- Grade using a scale. --\x3e\n                <ion-item text-wrap *ngIf="grade.method == \'simple\' && grade.scale">\n                    <ion-label>{{ \'addon.mod_assign.grade\' | translate }}</ion-label>\n                    <ion-select [(ngModel)]="grade.grade" interface="popover">\n                        <ion-option *ngFor="let grade of grade.scale" [value]="grade.value">{{grade.label}}</ion-option>\n                    </ion-select>\n                </ion-item>\n\n                \x3c!-- Outcomes. --\x3e\n                <ion-item text-wrap *ngFor="let outcome of gradeInfo.outcomes">\n                    <ion-label>{{ outcome.name }}</ion-label>\n                    <ion-select *ngIf="canSaveGrades && outcome.itemNumber" [(ngModel)]="outcome.selectedId" interface="popover">\n                        <ion-option *ngFor="let grade of outcome.options" [value]="grade.value">{{grade.label}}</ion-option>\n                    </ion-select>\n                    <p item-content *ngIf="!canSaveGrades || !outcome.itemNumber">{{ outcome.selected }}</p>\n                </ion-item>\n\n                <addon-mod-assign-feedback-plugin *ngFor="let plugin of feedback.plugins" [assign]="assign" [submission]="userSubmission" [userId]="submitId" [plugin]="plugin" [canEdit]="canSaveGrades"></addon-mod-assign-feedback-plugin>\n\n                \x3c!-- Workflow status. --\x3e\n                <ion-item text-wrap *ngIf="workflowStatusTranslationId">\n                    <h2>{{ \'addon.mod_assign.markingworkflowstate\' | translate }}</h2>\n                    <p>{{ workflowStatusTranslationId | translate }}</p>\n                </ion-item>\n\n                \x3c!--- Apply grade to all team members. --\x3e\n                <ion-item text-wrap *ngIf="assign.teamsubmission && canSaveGrades">\n                    <h2>{{ \'addon.mod_assign.groupsubmissionsettings\' | translate }}</h2>\n                    <ion-label>{{ \'addon.mod_assign.applytoteam\' | translate }}</ion-label>\n                    <ion-toggle [(ngModel)]="grade.applyToAll"></ion-toggle>\n                </ion-item>\n\n                \x3c!-- Attempt status. --\x3e\n                <ion-item text-wrap *ngIf="isGrading && assign.attemptreopenmethod != attemptReopenMethodNone">\n                    <h2>{{ \'addon.mod_assign.attemptsettings\' | translate }}</h2>\n                    <p *ngIf="assign.maxattempts == unlimitedAttempts">{{ \'addon.mod_assign.outof\' | translate : {\'$a\': {\'current\': currentAttempt, \'total\': maxAttemptsText} } }}</p>\n                    <p *ngIf="assign.maxattempts != unlimitedAttempts">{{ \'addon.mod_assign.outof\' | translate : {\'$a\': {\'current\': currentAttempt, \'total\': assign.maxattempts} } }}</p>\n                    <p>{{ \'addon.mod_assign.attemptreopenmethod\' | translate }}: {{ \'addon.mod_assign.attemptreopenmethod_\' + assign.attemptreopenmethod | translate }}</p>\n                    <ng-container *ngIf="canSaveGrades && allowAddAttempt" >\n                        <ion-label>{{ \'addon.mod_assign.addattempt\' | translate }}</ion-label>\n                        <ion-toggle [(ngModel)]="grade.addAttempt"></ion-toggle>\n                    </ng-container>\n                </ion-item>\n\n                \x3c!-- Data about the grader (teacher who graded). --\x3e\n                <a ion-item text-wrap *ngIf="grader" (click)="openUserProfile(grader.id)" [title]="grader.fullname" detail-push>\n                    <ion-avatar item-start>\n                        <img [src]="grader.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: grader.fullname}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n                    </ion-avatar>\n                    <h2>{{ \'addon.mod_assign.gradedby\' | translate }}</h2>\n                    <h2>{{ grader.fullname }}</h2>\n                    <p *ngIf="feedback.gradeddate">{{ feedback.gradeddate * 1000 | coreFormatDate:"dfmediumdate" }}</p>\n                </a>\n\n                \x3c!-- Warning message if cannot save grades. --\x3e\n                <div *ngIf="isGrading && !canSaveGrades" class="core-warning-card" icon-start>\n                    <ion-icon name="warning"></ion-icon>\n                    <p>{{ \'addon.mod_assign.cannotgradefromapp\' | translate:{$a: moduleName} }}</p>\n                    <a ion-button block *ngIf="gradeUrl" [href]="gradeUrl" core-link icon-end>\n                        {{ \'core.openinbrowser\' | translate }}\n                        <ion-icon name="open"></ion-icon>\n                    </a>\n                </div>\n            </ng-template>\n        </core-tab>\n    </core-tabs>\n</core-loading>\n\n\x3c!-- Template to render some data regarding the submission status. --\x3e\n<ng-template #submissionStatus>\n    <p *ngIf="assign && assign.teamsubmission && lastAttempt">\n        <span *ngIf="lastAttempt.submissiongroup && lastAttempt.submissiongroupname">{{lastAttempt.submissiongroupname}}</span>\n        <span *ngIf="assign.preventsubmissionnotingroup && !lastAttempt.submissiongroup && !lastAttempt.usergroups">{{ \'addon.mod_assign.noteam\' | translate }}</span>\n        <span *ngIf="assign.preventsubmissionnotingroup && !lastAttempt.submissiongroup && lastAttempt.usergroups">{{ \'addon.mod_assign.multipleteams\' | translate }}</span>\n        <span *ngIf="!assign.preventsubmissionnotingroup && !lastAttempt.submissiongroup">{{ \'addon.mod_assign.defaultteam\' | translate }}</span>\n    </p>\n    <ion-badge item-end *ngIf="statusTranslated" [color]="statusColor">\n        {{ statusTranslated }}\n    </ion-badge>\n    <ion-badge item-end *ngIf="gradingStatusTranslationId" [color]="gradingColor">\n        {{ gradingStatusTranslationId | translate }}\n    </ion-badge>\n</ng-template>\n'}),A(19,Object(o.N)()),I("design:paramtypes",[r.q,s.a,f.a,d.a,l.a,h.a,p.a,i.c,m.a,a.a,g.a,y.a,v.a,b.a,c.a,u.a,_.a,P.a,O.a,R.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(4),i=n(9),s=n(10),a=n(145),c=n(227),u=n(739),d=n(741),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},m=function(e){function t(t,n,o,r,i,s,a){var u=e.call(this,t)||this;return u.bookProvider=n,u.courseProvider=o,u.appProvider=r,u.prefetchDelegate=i,u.popoverCtrl=s,u.content=a,u.component=c.a.COMPONENT,u}return l(t,e),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.loadContent()},t.prototype.showToc=function(e){var t=this,n=this.popoverCtrl.create(d.a,{chapters:this.chapters});n.onDidDismiss(function(e){t.changeChapter(e)}),n.present({ev:e})},t.prototype.changeChapter=function(e){e&&e!=this.currentChapter&&(this.loaded=!1,this.refreshIcon="spinner",this.loadChapter(e))},t.prototype.invalidateContent=function(){return this.bookProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.fetchContent=function(e){var t=this,n=[],o=!1;return n.push(this.bookProvider.getBook(this.courseId,this.module.id).then(function(e){t.dataRetrieved.emit(e),t.description=e.intro||t.description}).catch(function(){})),n.push(this.prefetchDelegate.download(this.module,this.courseId).catch(function(){if(o=!0,!t.module.contents.length)return t.courseProvider.loadModuleContents(t.module,t.courseId)})),Promise.all(n).then(function(){return t.contentsMap=t.bookProvider.getContentsMap(t.module.contents),t.chapters=t.bookProvider.getTocList(t.module.contents),void 0===t.currentChapter&&(t.currentChapter=t.bookProvider.getFirstChapter(t.chapters)),t.loadChapter(t.currentChapter).then(function(){o&&t.appProvider.isOnline()&&t.domUtils.showErrorModal("core.errordownloadingsomefiles",!0),t.fillContextMenu(e)}).catch(function(){})})},t.prototype.loadChapter=function(e){var t=this;return this.currentChapter=e,this.content&&this.content.scrollToTop(),this.bookProvider.getChapterContent(this.contentsMap,e,this.module.id).then(function(n){t.chapterContent=n,t.previousChapter=t.bookProvider.getPreviousChapter(t.chapters,e),t.nextChapter=t.bookProvider.getNextChapter(t.chapters,e),t.bookProvider.logView(t.module.instance,e).then(function(){t.nextChapter||t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})}).catch(function(e){return t.domUtils.showErrorModalDefault(e,"addon.mod_book.errorchapter",!0),Promise.reject(null)}).finally(function(){t.loaded=!0,t.refreshIcon="refresh"})},t=f([Object(o.m)({selector:"addon-mod-book-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <button ion-button icon-only (click)="showToc($event)">\n        <ion-icon name="bookmark"></ion-icon>\n    </button>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <div padding>\n        <addon-mod-book-navigation-arrows [previous]="previousChapter" [next]="nextChapter" (action)="changeChapter($event)"></addon-mod-book-navigation-arrows>\n        <core-format-text [component]="component" [componentId]="componentId" [text]="chapterContent"></core-format-text>\n        <addon-mod-book-navigation-arrows [previous]="previousChapter" [next]="nextChapter" (action)="changeChapter($event)"></addon-mod-book-navigation-arrows>\n    </div>\n\n</core-loading>\n'}),h(6,Object(o.N)()),p("design:paramtypes",[o.C,c.a,s.a,i.a,u.a,r.t,r.f])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(75),s=n(22),a=n(395),c=n(5),u=(n.n(c),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,t)||this;return i.chatProvider=n,i.timeUtils=o,i.navCtrl=r,i.component=a.a.COMPONENT,i.moduleName="chat",i}return u(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent().then(function(){t.chatProvider.logView(t.chat.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.chatProvider.getChat(this.courseId,this.module.id).then(function(t){o.chat=t,o.description=t.intro||t.description;var n=o.timeUtils.timestamp(),r=t.chattime-n;o.chatInfo=!!(t.chattime&&t.schedule>0&&r>0)&&{date:c(1e3*t.chattime).format("LLL"),fromnow:o.timeUtils.formatTime(r)},o.dataRetrieved.emit(t),o.fillContextMenu(e)})},t.prototype.enterChat=function(){this.navCtrl.push("AddonModChatChatPage",{chatId:this.chat.id,courseId:this.courseId,title:this.chat.name||this.moduleName})},t=d([Object(o.m)({selector:"addon-mod-chat-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ion-card icon-start class="core-info-card" *ngIf="chatInfo">\n        <ion-icon name="time"></ion-icon> {{ \'addon.mod_chat.sessionstart\' | translate:{$a: chatInfo} }}\n    </ion-card>\n\n    <div padding-horizontal>\n        <a ion-button block color="primary" (click)="enterChat()">{{ \'addon.mod_chat.enterchat\' | translate }}</a>\n    </div>\n</core-loading>\n'}),l("design:paramtypes",[o.C,a.a,s.a,r.q])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(75),s=n(228),a=n(229),c=n(230),u=n(5),d=(n.n(u),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},h=function(e){function t(t,n,o,r,i){var a=e.call(this,t,o)||this;return a.choiceProvider=n,a.choiceOffline=r,a.choiceSync=i,a.component=s.a.COMPONENT,a.moduleName="choice",a.options=[],a.choiceNotOpenYet=!1,a.choiceClosed=!1,a.canEdit=!1,a.canDelete=!1,a.canSeeResults=!1,a.data=[],a.labels=[],a.results=[],a.syncEventName=c.a.AUTO_SYNCED,a.hasAnsweredOnline=!1,a}return d(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.userId=this.sitesProvider.getCurrentSiteUserId(),this.loadContent(!1,!0).then(function(){t.choice&&t.choiceProvider.logView(t.choice.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){})})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.choiceProvider.invalidateChoiceData(this.courseId)),this.choice&&(e.push(this.choiceProvider.invalidateOptions(this.choice.id)),e.push(this.choiceProvider.invalidateResults(this.choice.id))),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.choice||e.choiceId!=this.choice.id||e.userId!=this.userId)&&(this.content.scrollToTop(),!0)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.now=(new Date).getTime(),this.choiceProvider.getChoice(this.courseId,this.module.id).then(function(e){if(o.choice=e,o.choice.timeopen=1e3*parseInt(e.timeopen),o.choice.openTimeReadable=u(e.timeopen).format("LLL"),o.choice.timeclose=1e3*parseInt(e.timeclose),o.choice.closeTimeReadable=u(e.timeclose).format("LLL"),o.description=e.intro||e.description,o.choiceNotOpenYet=e.timeopen&&e.timeopen>o.now,o.choiceClosed=e.timeclose&&e.timeclose<=o.now,o.dataRetrieved.emit(e),t)return o.syncActivity(n).then(function(e){if(e)return o.choiceProvider.getChoice(o.courseId,o.module.id).then(function(e){o.choice=e})})}).then(function(){return o.choiceOffline.hasResponse(o.choice.id)}).then(function(e){return o.hasOffline=e,o.fetchOptions(e).then(function(){return o.fetchResults()})}).then(function(){o.fillContextMenu(e)})},t.prototype.fetchOptions=function(e){var t=this;return this.choiceProvider.getOptions(this.choice.id).then(function(n){t.hasAnsweredOnline=n.some(function(e){return e.checked}),(e?t.choiceOffline.getResponse(t.choice.id).then(function(e){var t={};return n.forEach(function(e){t[e.id]=e}),e.deleting?e.responses.length>0?e.responses.forEach(function(e){t[e]&&t[e].checked&&(t[e].checked=!1,t[e].countanswers--)}):Object.keys(t).forEach(function(e){t[e].checked&&(t[e].checked=!1,t[e].countanswers--)}):(Object.keys(t).forEach(function(e){t[e].checked&&(t[e].checked=!1,t[e].countanswers--)}),e.responses.forEach(function(e){t[e]&&(t[e].checked=!0,t[e].countanswers++)})),Object.keys(t).map(function(e){return t[e]})}):Promise.resolve(n)).then(function(e){var n=t.isChoiceOpen(),o=!1;if(t.selectedOption={id:-1},e.forEach(function(e){e.checked&&(o=!0,t.choice.allowmultiple||(t.selectedOption.id=e.id))}),t.canEdit=n&&(t.choice.allowupdate||!o),t.canDelete=n&&t.choice.allowupdate&&o,t.options=e,t.canEdit)switch(t.choice.showresults){case s.a.RESULTS_NOT:t.publishInfo="addon.mod_choice.publishinfonever";break;case s.a.RESULTS_AFTER_ANSWER:t.publishInfo=t.choice.publish==s.a.PUBLISH_ANONYMOUS?"addon.mod_choice.publishinfoanonafter":"addon.mod_choice.publishinfofullafter";break;case s.a.RESULTS_AFTER_CLOSE:t.publishInfo=t.choice.publish==s.a.PUBLISH_ANONYMOUS?"addon.mod_choice.publishinfoanonclose":"addon.mod_choice.publishinfofullclose";break;default:t.publishInfo=""}})})},t.prototype.fetchResults=function(){var e=this;return this.choiceNotOpenYet?(this.canSeeResults=!1,Promise.resolve()):this.choiceProvider.getResults(this.choice.id).then(function(t){var n=!1;e.data=[],e.labels=[],t.forEach(function(t){t.numberofuser>0&&(n=!0),t.percentageamount=parseFloat(t.percentageamount).toFixed(1),e.data.push(t.numberofuser),e.labels.push(t.text)}),e.canSeeResults=n||e.choiceProvider.canStudentSeeResults(e.choice,e.hasAnsweredOnline),e.results=t})},t.prototype.isChoiceOpen=function(){return(0===this.choice.timeopen||this.choice.timeopen<=this.now)&&(0===this.choice.timeclose||this.choice.timeclose>this.now)},t.prototype.canSave=function(){return this.choice.allowmultiple?this.options.some(function(e){return e.checked}):-1!==this.selectedOption.id},t.prototype.save=function(){var e=this;(this.choice.allowupdate?Promise.resolve():this.domUtils.showConfirm(this.translate.instant("core.areyousure"))).then(function(){var t=[];e.choice.allowmultiple?e.options.forEach(function(e){e.checked&&t.push(e.id)}):t.push(e.selectedOption.id);var n=e.domUtils.showModalLoading("core.sending",!0);e.choiceProvider.submitResponse(e.choice.id,e.choice.name,e.courseId,t).then(function(){return e.courseProvider.checkModuleCompletion(e.courseId,e.module.completionstatus),e.content.scrollToTop(),e.refreshContent(!1)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_choice.cannotsubmit",!0)}).finally(function(){n.dismiss()})})},t.prototype.delete=function(){var e=this;this.domUtils.showConfirm(this.translate.instant("core.areyousure")).then(function(){var t=e.domUtils.showModalLoading("core.sending",!0);e.choiceProvider.deleteResponses(e.choice.id,e.choice.name,e.courseId).then(function(){return e.content.scrollToTop(),e.refreshContent(!1)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_choice.cannotsubmit",!0)}).finally(function(){t.dismiss()})}).catch(function(){})},t.prototype.sync=function(){return this.choiceSync.syncChoice(this.choice.id,this.userId)},t.prototype.hasSyncSucceed=function(e){return e.updated},t=l([Object(o.m)({selector:"addon-mod-choice-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    \x3c!-- Activity availability messages --\x3e\n    <ion-card class="core-info-card" icon-start *ngIf="choiceNotOpenYet">\n        <ion-icon name="information-circle"></ion-icon>\n        <p *ngIf="options && options.length">{{ \'addon.mod_choice.previewonly\' | translate:{$a: choice.openTimeReadable} }}</p>\n        <p *ngIf="!options || !options.length">{{ \'addon.mod_choice.notopenyet\' | translate:{$a: choice.openTimeReadable} }}</p>\n    </ion-card>\n    <ion-card class="core-info-card" icon-start *ngIf="choiceClosed">\n        <ion-icon name="information-circle"></ion-icon>\n        <p *ngIf="options && options.length">{{ \'addon.mod_choice.yourselection\' | translate }} <core-format-text [text]="options[0].text"></core-format-text></p>\n        <p>{{ \'addon.mod_choice.expired\' | translate:{$a: choice.closeTimeReadable} }}</p>\n    </ion-card>\n\n    \x3c!-- Choice done in offline but not synchronized --\x3e\n    <ion-card class="core-warning-card" icon-start *ngIf="hasOffline">\n        <ion-icon name="warning"></ion-icon> {{ \'core.hasdatatosync\' | translate:{$a: moduleName} }}\n    </ion-card>\n\n    \x3c!-- Inform what will happen with the choices. --\x3e\n    <div *ngIf="canEdit && publishInfo && options && options.length" class="core-info-card" icon-start>\n        <ion-icon name="information-circle"></ion-icon>\n        {{ publishInfo | translate }}\n    </div>\n\n    \x3c!-- Choice options --\x3e\n    <ion-card *ngIf="options && options.length">\n        <ng-container *ngIf="choice.allowmultiple">\n            <ion-item text-wrap *ngFor="let option of options">\n                <ion-label><core-format-text [text]="option.text"></core-format-text> <span *ngIf="choice.limitanswers && option.countanswers >= option.maxanswers">{{ \'addon.mod_choice.full\' | translate }}</span></ion-label>\n                <ion-checkbox item-end [(ngModel)]="option.checked" [disabled]="option.disabled || !canEdit"></ion-checkbox>\n            </ion-item>\n        </ng-container>\n        <ng-container *ngIf="!choice.allowmultiple">\n            <ion-item text-wrap *ngFor="let option of options" radio-group [(ngModel)]="selectedOption.id">\n                <ion-label><core-format-text [text]="option.text"></core-format-text> <span *ngIf="choice.limitanswers && option.countanswers >= option.maxanswers">{{ \'addon.mod_choice.full\' | translate }}</span></ion-label>\n                <ion-radio color="primary" [value]="option.id" [disabled]="option.disabled || !canEdit"></ion-radio>\n            </ion-item>\n        </ng-container>\n        <ion-item *ngIf="canEdit">\n            <button ion-button block (click)="save()" [disabled]="!canSave()">{{ \'addon.mod_choice.savemychoice\' | translate }}</button>\n        </ion-item>\n        <ion-item *ngIf="canDelete">\n            <button ion-button block color="light" (click)="delete()">{{ \'addon.mod_choice.removemychoice\' | translate }}</button>\n        </ion-item>\n    </ion-card>\n\n    \x3c!-- Choice results --\x3e\n    <ion-card *ngIf="canSeeResults">\n        <ion-item-divider color="light" text-center>\n            {{ \'addon.mod_choice.responses\' | translate }}\n        </ion-item-divider>\n        <ion-grid no-padding>\n            <ion-row>\n                <ion-col col-12 col-lg-4>\n                    <ion-item text-wrap class="core-warning-item" *ngIf="hasOffline">\n                        <ion-icon item-start name="warning" color="warning"></ion-icon> {{ \'addon.mod_choice.resultsnotsynced\' | translate }}\n                    </ion-item>\n                    <ion-item>\n                        <canvas core-chart type="pie" [data]="data" [labels]="labels" height="300"></canvas>\n                    </ion-item>\n                </ion-col>\n                <ion-col *ngIf="choice.publish && results" col-12 col-lg-8>\n                    <ion-item text-wrap *ngFor="let result of results">\n                        <h2><core-format-text [text]="result.text"></core-format-text></h2>\n                        <p>{{ \'addon.mod_choice.numberofuser\' | translate }}: {{ result.numberofuser }} ({{ \'core.percentagenumber\' | translate: {$a: result.percentageamount} }})</p>\n                        <a ion-item *ngFor="let user of result.userresponses" core-user-link [courseId]="courseid" [userId]="user.userid" [title]="user.fullname">\n                            <ion-avatar item-start>\n                                <img [src]="user.profileimageurl" [alt]="\'core.pictureof\' | translate:{$a: user.fullname}" core-external-content onError="this.src=\'assets/img/user-avatar.png\'">\n                            </ion-avatar>\n                            <p>{{user.fullname}}</p>\n                        </a>\n                    </ion-item>\n                </ion-col>\n            </ion-row>\n        </ion-grid>\n    </ion-card>\n    <ion-card class="core-info-card" *ngIf="!canSeeResults && !choiceNotOpenYet">\n        <p>{{ \'addon.mod_choice.noresultsviewable\' | translate }}</p>\n    </ion-card>\n</core-loading>\n'}),p(2,Object(o.N)()),f("design:paramtypes",[o.C,s.a,r.f,a.a,c.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(9),i=n(12),s=n(27),a=n(7),c=n(2),u=n(77),d=n(11),l=n(109),f=(n.n(l),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s){this.fileProvider=t,this.textUtils=o,this.mimeUtils=r,this.sitesProvider=i,this.eventsProvider=s,this.SHARED_FILES_TABLE="shared_files",this.tableSchema={name:this.SHARED_FILES_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0}]},this.logger=e.getInstance("CoreSharedFilesProvider"),this.appDB=n.getDB(),this.appDB.createTableFromSchema(this.tableSchema)}return t=e,e.prototype.checkIOSNewFiles=function(){var e=this;return this.logger.debug("Search for new files on iOS"),this.fileProvider.getDirectoryContents("Inbox").then(function(t){if(t.length>0){var n,o=[];return t.forEach(function(t){var r=e.getFileId(t);o.push(e.isFileTreated(r).then(function(){e.deleteInboxFile(t)}).catch(function(){e.logger.debug("Found new file "+t.name+" shared with the app."),n||(n=t)}))}),Promise.all(o).then(function(){var t;return n?(t=e.getFileId(n),e.markAsTreated(t).then(function(){return e.logger.debug('File marked as "treated": '+n.name),n})):Promise.reject(null)})}return Promise.reject(null)})},e.prototype.deleteInboxFile=function(e){var t=this;return this.logger.debug("Delete inbox file: "+e.name),this.fileProvider.removeFileByFileEntry(e).catch(function(){}).then(function(){return t.unmarkAsTreated(t.getFileId(e)).then(function(){t.logger.debug('"Treated" mark removed from file: '+e.name)}).catch(function(n){return t.logger.debug('Error deleting "treated" mark from file: '+e.name,n),Promise.reject(n)})})},e.prototype.getFileId=function(e){return l.Md5.hashAsciiStr(e.name)},e.prototype.getSiteSharedFiles=function(e,t,n){var o=this,r=this.getSiteSharedFilesDirPath(e);return t&&(r=this.textUtils.concatenatePaths(r,t)),this.fileProvider.getDirectoryContents(r).then(function(e){return n&&(e=e.filter(function(e){var t=o.mimeUtils.getFileExtension(e.name),r=o.mimeUtils.getMimeType(t);return!r||n.indexOf(r)>-1})),e}).catch(function(){return[]})},e.prototype.getSiteSharedFilesDirPath=function(e){return e=e||this.sitesProvider.getCurrentSiteId(),this.fileProvider.getSiteFolder(e)+"/"+t.SHARED_FILES_FOLDER},e.prototype.isFileTreated=function(e){return this.appDB.getRecord(this.SHARED_FILES_TABLE,{id:e})},e.prototype.markAsTreated=function(e){var t=this;return this.isFileTreated(e).catch(function(){return t.appDB.insertRecord(t.SHARED_FILES_TABLE,{id:e})})},e.prototype.storeFileInSite=function(e,t,n){var o=this;if(n=n||this.sitesProvider.getCurrentSiteId(),!e||!n)return Promise.reject(null);t=t||e.name;var r=this.getSiteSharedFilesDirPath(n),s=this.textUtils.concatenatePaths(r,t);return this.fileProvider.createDir(r).then(function(){return o.fileProvider.moveFile(e.fullPath,s).then(function(e){return o.eventsProvider.trigger(i.a.FILE_SHARED,{siteId:n,name:t}),e})})},e.prototype.unmarkAsTreated=function(e){return this.appDB.deleteRecords(this.SHARED_FILES_TABLE,{id:e})},e.SHARED_FILES_FOLDER="sharedfiles",e=t=f([Object(o.A)(),p("design:paramtypes",[a.a,s.a,r.a,d.a,u.a,c.a,i.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(4),i=n(1),s=n(9),a=n(27),c=n(7),u=n(79),d=n(2),l=n(8),f=n(6),p=n(405),h=n(56),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l){this.alertCtrl=t,this.translate=n,this.utils=o,this.sitesProvider=r,this.modalCtrl=i,this.fileUploaderProvider=s,this.initDelegate=a,this.sharedFilesProvider=c,this.domUtils=u,this.fileProvider=d,this.appProvider=l,this.logger=e.getInstance("CoreSharedFilesHelperProvider")}return e.prototype.askRenameReplace=function(e,t){var n=this.utils.promiseDefer();return this.alertCtrl.create({title:this.translate.instant("core.sharedfiles.sharedfiles"),message:this.translate.instant("core.sharedfiles.chooseactionrepeatedfile",{$a:t}),buttons:[{text:this.translate.instant("core.sharedfiles.rename"),handler:function(){n.resolve(t)}},{text:this.translate.instant("core.sharedfiles.replace"),handler:function(){n.resolve(e)}}]}).present(),n.promise},e.prototype.goToChooseSite=function(e){this.appProvider.getRootNavController().push("CoreSharedFilesChooseSitePage",{filePath:e})},e.prototype.pickSharedFile=function(e){var t=this;return new Promise(function(n,o){var r=t.modalCtrl.create("CoreSharedFilesListPage",{mimetypes:e,isModal:!0,pick:!0});r.present(),r.onDidDismiss(function(r){if(r){var i=t.fileUploaderProvider.isInvalidMimetype(e,r.fullPath);i?o(i):n({path:r.fullPath,treated:!1})}else o()})})},e.prototype.searchIOSNewSharedFiles=function(){var e=this;return this.initDelegate.ready().then(function(){var t=e.appProvider.getRootNavController();return t&&"CoreSharedFilesChooseSite"==t.getActive().id?Promise.reject(null):e.sharedFilesProvider.checkIOSNewFiles().then(function(t){return e.sitesProvider.getSitesIds().then(function(n){return n.length?1==n.length?e.storeSharedFileInSite(t,n[0]):void e.goToChooseSite(t.fullPath):(e.domUtils.showErrorModal("core.sharedfiles.errorreceivefilenosites",!0),e.sharedFilesProvider.deleteInboxFile(t))})})})},e.prototype.storeSharedFileInSite=function(e,t){var n=this;t=t||this.sitesProvider.getCurrentSiteId();var o=this.sharedFilesProvider.getSiteSharedFilesDirPath(t);return this.fileProvider.getUniqueNameInFolder(o,e.name).then(function(t){return t==e.name?t:n.askRenameReplace(e.name,t)}).then(function(o){return n.sharedFilesProvider.storeFileInSite(e,o,t).catch(function(e){n.domUtils.showErrorModal(e||"Error moving file.")}).finally(function(){n.sharedFilesProvider.deleteInboxFile(e),n.domUtils.showAlertTranslated("core.success","core.sharedfiles.successstorefile")})})},e=m([Object(o.A)(),g("design:paramtypes",[c.a,r.b,i.c,f.a,d.a,r.o,h.a,u.a,p.a,l.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(4),i=n(46),s=n(75),a=n(86),c=n(248),u=n(236),d=n(258),l=n(5),f=(n.n(l),n(135)),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},y=function(e){function t(t,n,o,r,i,s,c,u){var d=e.call(this,t,o)||this;return d.feedbackProvider=n,d.feedbackOffline=r,d.groupsProvider=i,d.feedbackSync=s,d.navCtrl=c,d.feedbackHelper=u,d.tab="overview",d.group=0,d.moduleName="feedback",d.access={canviewreports:!1,canviewanalysis:!1,isempty:!0},d.groupInfo={groups:[],separateGroups:!1,visibleGroups:!1},d.overview={timeopen:0,openTimeReadable:"",timeclose:0,closeTimeReadable:""},d.warning="",d.tabsLoaded={overview:!1,analysis:!1},d.showTabs=!1,d.tabsReady=!1,d.submitObserver=d.eventsProvider.on(a.a.FORM_SUBMITTED,function(e){d.feedback&&e.feedbackId==d.feedback.id&&(d.tabsLoaded.analysis=!1,d.tabsLoaded.overview=!1,d.loaded=!1,e.tab!=d.tab?d.tabChanged(e.tab):d.loadContent(!0))},d.siteId),d}return p(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent(!1,!0).then(function(){t.feedbackProvider.logView(t.feedback.id)}).finally(function(){t.tabsReady=!0})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.feedbackProvider.invalidateFeedbackData(this.courseId)),this.feedback&&(e.push(this.feedbackProvider.invalidateFeedbackAccessInformationData(this.feedback.id)),e.push(this.feedbackProvider.invalidateAnalysisData(this.feedback.id)),e.push(this.groupsProvider.invalidateActivityAllowedGroups(this.feedback.coursemodule)),e.push(this.groupsProvider.invalidateActivityGroupMode(this.feedback.coursemodule)),e.push(this.feedbackProvider.invalidateResumePageData(this.feedback.id))),this.tabsLoaded.analysis=!1,this.tabsLoaded.overview=!1,Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.feedback||e.feedbackId!=this.feedback.id)&&(this.content.scrollToTop(),!0)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.feedbackProvider.getFeedback(this.courseId,this.module.id).then(function(e){if(o.feedback=e,o.description=e.intro||e.description,o.dataRetrieved.emit(e),t)return o.syncActivity(n)}).then(function(){return o.feedbackProvider.getFeedbackAccessInformation(o.feedback.id)}).then(function(e){return o.access=e,o.showTabs=(e.canviewreports||e.canviewanalysis)&&!e.isempty,o.firstSelectedTab=0,"analysis"==o.tab?(o.firstSelectedTab=1,o.fetchFeedbackAnalysisData(o.access)):o.fetchFeedbackOverviewData(o.access)}).then(function(){return o.fillContextMenu(e),o.feedbackOffline.hasFeedbackOfflineData(o.feedback.id)}).then(function(e){o.hasOffline=e})},t.prototype.fetchFeedbackOverviewData=function(e){var t=this,n=[];return e.cancomplete&&e.cansubmit&&e.isopen&&n.push(this.feedbackProvider.getResumePage(this.feedback.id).then(function(e){t.goPage=e>0&&e})),e.canedititems&&(this.overview.timeopen=1e3*parseInt(this.feedback.timeopen)||0,this.overview.openTimeReadable=this.overview.timeopen?l(this.overview.timeopen).format("LLL"):"",this.overview.timeclose=1e3*parseInt(this.feedback.timeclose)||0,this.overview.closeTimeReadable=this.overview.timeclose?l(this.overview.timeclose).format("LLL"):"",n.push(this.fetchGroupInfo(this.feedback.coursemodule))),Promise.all(n).finally(function(){t.tabsLoaded.overview=!0})},t.prototype.fetchFeedbackAnalysisData=function(e){var t,n=this;return e.canviewanalysis?t=this.fetchGroupInfo(this.feedback.coursemodule):(this.tabChanged("overview"),t=Promise.resolve()),t.finally(function(){n.tabsLoaded.analysis=!0})},t.prototype.fetchGroupInfo=function(e){var t=this;return this.groupsProvider.getActivityGroupInfo(e).then(function(e){return t.groupInfo=e,t.setGroup(t.group)})},t.prototype.parseAnalysisInfo=function(e){var t=this;switch(e.typ){case"numeric":e.average=e.data.reduce(function(e,t){return e+parseInt(t,10)},0)/e.data.length,e.template="numeric";break;case"info":e.data=e.data.map(function(e){return void 0!==(e=t.textUtils.parseJSON(e)).show&&e.show}).filter(function(e){return e});case"textfield":case"textarea":e.template="list";break;case"multichoicerated":case"multichoice":e.data=e.data.map(function(e){return void 0!==(e=t.textUtils.parseJSON(e)).answertext&&e}).filter(function(e){return e}),e.labels=e.data.map(function(e){e.quotient=(100*e.quotient).toFixed(2);var t="";return void 0!==e.value&&(t="("+e.value+") "),t+=e.answertext,t+=e.quotient>0?" ("+e.quotient+"%)":""}),e.chartData=e.data.map(function(e){return e.answercount}),"multichoicerated"==e.typ&&(e.average=e.data.reduce(function(e,t){return e+parseFloat(t.avg)},0));var n=e.presentation.charAt(0);e.chartType="c"!=n?"doughnut":"bar",e.template="chart"}return e},t.prototype.gotoAnswerQuestions=function(e){void 0===e&&(e=!1);this.navCtrl.push("AddonModFeedbackFormPage",{module:this.module,moduleId:this.module.id,courseId:this.courseId,preview:e})},t.prototype.ionViewDidEnter=function(){e.prototype.ionViewDidEnter.call(this),this.tabsComponent&&this.tabsComponent.ionViewDidEnter()},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),this.tabsComponent&&this.tabsComponent.ionViewDidLeave()},t.prototype.openFeature=function(e){this.feedbackHelper.openFeature(e,this.navCtrl,this.module,this.courseId,this.group)},t.prototype.tabChanged=function(e){this.tab=e,this.tabsLoaded[this.tab]||this.loadContent(!1,!1,!0)},t.prototype.setGroup=function(e){var t=this;return this.group=e,this.feedbackProvider.getAnalysis(this.feedback.id,e).then(function(e){if(t.feedback.completedCount=e.completedcount,t.feedback.itemsCount=e.itemscount,"analysis"==t.tab){var n=1;t.items=e.itemsdata.map(function(e){return e.item.data=e.data,e=e.item,e.number=n++,!(!e.data||!e.data.length)&&t.parseAnalysisInfo(e)}).filter(function(e){return e}),t.warning="",e.warnings.length&&(t.warning=e.warnings.find(function(e){return"insufficientresponsesforthisgroup"==e.warningcode}))}})},t.prototype.sync=function(){return this.feedbackSync.syncFeedback(this.feedback.id)},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.submitObserver&&this.submitObserver.off()},h([Object(o._9)(f.a),m("design:type",f.a)],t.prototype,"tabsComponent",void 0),h([Object(o.D)(),m("design:type",Object)],t.prototype,"tab",void 0),h([Object(o.D)(),m("design:type",Object)],t.prototype,"group",void 0),t=h([Object(o.m)({selector:"addon-mod-feedback-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ng-container *ngIf="showTabs">\n        <core-tabs [hideUntil]="tabsReady" [selectedIndex]="firstSelectedTab">\n            <core-tab [title]="\'addon.mod_feedback.overview\' | translate" (ionSelect)="tabChanged(\'overview\')">\n                <ng-template>\n                    <ng-container *ngTemplateOutlet="tabOverview"></ng-container>\n                </ng-template>\n            </core-tab>\n            <core-tab [show]="access.canviewreports" [title]="\'addon.mod_feedback.analysis\' | translate" (ionSelect)="tabChanged(\'analysis\')">\n                <ng-template>\n                    <ng-container *ngTemplateOutlet="tabAnalysis"></ng-container>\n                </ng-template>\n            </core-tab>\n\n            <core-tab [show]="!access.canviewreports" [title]="\'addon.mod_feedback.completed_feedbacks\' | translate" (ionSelect)="tabChanged(\'analysis\')">\n                <ng-template>\n                    <ng-container *ngTemplateOutlet="tabAnalysis"></ng-container>\n                </ng-template>\n            </core-tab>\n        </core-tabs>\n    </ng-container>\n\n    <ng-container *ngIf="!showTabs">\n        <ng-container *ngTemplateOutlet="tabOverview"></ng-container>\n    </ng-container>\n</core-loading>\n\n\n<ng-template #basicInfo>\n    <ion-list *ngIf="(access.canedititems || access.canviewreports) && !access.isempty">\n        <ion-item text-wrap *ngIf="access.canedititems && (groupInfo.separateGroups || groupInfo.visibleGroups)">\n            <ion-label id="addon-feedback-groupslabel" *ngIf="groupInfo.separateGroups">{{ \'core.groupsseparate\' | translate }}</ion-label>\n            <ion-label id="addon-feedback-groupslabel" *ngIf="groupInfo.visibleGroups">{{ \'core.groupsvisible\' | translate }}</ion-label>\n            <ion-select [(ngModel)]="group" (ionChange)="setGroup(group)" aria-labelledby="addon-feedback-groupslabel" interface="popover">\n                <ion-option *ngFor="let groupOpt of groupInfo.groups" [value]="groupOpt.id">{{groupOpt.name}}</ion-option>\n            </ion-select>\n        </ion-item>\n        <a ion-item text-wrap *ngIf="access.canviewreports || access.canedititems" (click)="access.canviewreports && openFeature(\'Respondents\')" [attr.detail-none]="access.canviewreports ? null : true">\n            <h2>{{ \'addon.mod_feedback.completed_feedbacks\' | translate }}</h2>\n            <ion-badge item-end>{{feedback.completedCount}}</ion-badge>\n        </a>\n        <a ion-item text-wrap *ngIf="!access.isanonymous && access.canviewreports" (click)="openFeature(\'NonRespondents\')" detail-push>\n            <h2>{{ \'addon.mod_feedback.show_nonrespondents\' | translate }}</h2>\n        </a>\n        <ion-item text-wrap *ngIf="access.canedititems">\n            <h2>{{ \'addon.mod_feedback.questions\' | translate }}</h2>\n            <ion-badge item-end>{{feedback.itemsCount}}</ion-badge>\n        </ion-item>\n    </ion-list>\n</ng-template>\n\n\x3c!-- Template to render the overview. --\x3e\n<ng-template #tabOverview>\n    <core-loading [hideUntil]="tabsLoaded.overview">\n        <ng-container *ngTemplateOutlet="basicInfo"></ng-container>\n\n        \x3c!-- Feedback done in offline but not synchronized --\x3e\n        <div class="core-warning-card" icon-start *ngIf="hasOffline">\n            <ion-icon name="warning"></ion-icon>\n            {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n        </div>\n\n        <div class="core-info-card" icon-start *ngIf="access.cancomplete && !access.isopen">\n            <ion-icon name="information-circle"></ion-icon>\n            {{ \'addon.mod_feedback.feedback_is_not_open\' | translate }}\n        </div>\n\n        <div class="core-success-card" *ngIf="access.cancomplete && access.isopen && !access.cansubmit">\n            <ion-icon name="checkmark"></ion-icon>\n            {{ \'addon.mod_feedback.this_feedback_is_already_submitted\' | translate }}\n        </div>\n\n        <ion-list *ngIf="access.canedititems || access.canviewreports || !access.isempty">\n            <ion-item text-wrap *ngIf="access.canedititems && overview.timeopen">\n                <h2>{{ \'addon.mod_feedback.feedbackopen\' | translate }}</h2>\n                <p>{{overview.openTimeReadable}}</p>\n            </ion-item>\n            <ion-item text-wrap *ngIf="access.canedititems && overview.timeclose">\n                <h2>{{ \'addon.mod_feedback.feedbackclose\' | translate }}</h2>\n                <p>{{overview.closeTimeReadable}}</p>\n            </ion-item>\n            <ion-item text-wrap *ngIf="access.canedititems && feedback.page_after_submit">\n                <h2>{{ \'addon.mod_feedback.page_after_submit\' | translate }}</h2>\n                <core-format-text  [component]="component" [componentId]="componentId" [text]=" feedback.page_after_submit"></core-format-text>\n            </ion-item>\n            <ng-container *ngIf="!access.isempty">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_feedback.mode\' | translate }}</h2>\n                    <p *ngIf="access.isanonymous">{{ \'addon.mod_feedback.anonymous\' | translate }}</p>\n                    <p *ngIf="!access.isanonymous">{{ \'addon.mod_feedback.non_anonymous\' | translate }}</p>\n                </ion-item>\n                <ion-grid>\n                    <ion-row align-items-center>\n                        <ion-col>\n                            <button ion-button block outline icon-start (click)="gotoAnswerQuestions(true)">\n                                <ion-icon name="search"></ion-icon>\n                                {{ \'addon.mod_feedback.preview\' | translate }}\n                            </button>\n                        </ion-col>\n                        <ion-col *ngIf="access.cancomplete && access.cansubmit">\n                            <button ion-button block icon-end *ngIf="!goPage" (click)="gotoAnswerQuestions()">\n                                {{ \'addon.mod_feedback.complete_the_form\' | translate }}\n                                <ion-icon name="arrow-forward"></ion-icon>\n                            </button>\n                            <button ion-button block icon-end *ngIf="goPage" (click)="gotoAnswerQuestions()">\n                                {{ \'addon.mod_feedback.continue_the_form\' | translate }}\n                                <ion-icon name="arrow-forward"></ion-icon>\n                            </button>\n                        </ion-col>\n                    </ion-row>\n                </ion-grid>\n\n            </ng-container>\n        </ion-list>\n    </core-loading>\n</ng-template>\n\n\x3c!-- Template to render the analysis. --\x3e\n<ng-template #tabAnalysis>\n    <core-loading [hideUntil]="tabsLoaded.analysis">\n        <ng-container *ngTemplateOutlet="basicInfo"></ng-container>\n\n        <ng-container *ngIf="access.canedititems || !access.isempty">\n            <div class="core-info-card" icon-start *ngIf="warning">\n                <ion-icon name="information-circle"></ion-icon>\n                {{ warning }}\n            </div>\n\n            <ion-list *ngIf="items && items.length">\n                <ion-item text-wrap *ngFor="let item of items" class="core-analysis">\n                    <h2>{{item.number}}. <core-format-text  [component]="component" [componentId]="componentId" [text]="item.name"></core-format-text></h2>\n                    <p><core-format-text  [component]="component" [componentId]="componentId" [text]="item.label"></core-format-text></p>\n                    <ng-container [ngSwitch]="item.template">\n                        <ng-container *ngSwitchCase="\'numeric\'">\n                            <ul>\n                                <li *ngFor="let data of item.data">{{ data }}</li>\n                            </ul>\n                            <p>{{ \'addon.mod_feedback.average\' | translate }}: {{item.average | number : \'1.2-2\'}}</p>\n                        </ng-container>\n                        <ng-container *ngSwitchCase="\'list\'">\n                            <ul>\n                                <ng-container *ngFor="let data of item.data">\n                                    <li *ngIf="data">\n                                        <core-format-text [text]="data"></core-format-text>\n                                    </li>\n                                </ng-container>\n                            </ul>\n                        </ng-container>\n                        <ng-container *ngSwitchCase="\'chart\'">\n                            <canvas core-chart [type]="item.chartType" [data]="item.chartData" [labels]="item.labels" height="300"></canvas>\n                            <p *ngIf="item.average">{{ \'addon.mod_feedback.average\' | translate }}: {{item.average | number : \'1.2-2\'}}</p>\n                        </ng-container>\n                    </ng-container>\n                </ion-item>\n            </ion-list>\n        </ng-container>\n    </core-loading>\n</ng-template>\n'}),g(2,Object(o.N)()),m("design:paramtypes",[o.C,a.a,r.f,u.a,i.a,d.a,r.q,c.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(9),i=n(10),s=n(145),a=n(349),c=n(815),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r,i){var s=e.call(this,t)||this;return s.folderProvider=n,s.courseProvider=o,s.appProvider=r,s.folderHelper=i,s.component=a.a.COMPONENT,s}return u(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.canGetFolder=this.folderProvider.isGetFolderWSAvailable(),this.path?(this.showModuleData(this.module),this.loaded=!0,this.refreshIcon="refresh"):this.loadContent().then(function(){t.folderProvider.logView(t.module.instance).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})}).finally(function(){t.loaded=!0,t.refreshIcon="refresh"})},t.prototype.invalidateContent=function(){return this.folderProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.showModuleData=function(e){this.description=e.intro||e.description,this.dataRetrieved.emit(e),this.contents=this.path?e.contents:this.folderHelper.formatContents(e.contents)},t.prototype.fetchContent=function(e){var t=this;return(this.canGetFolder?this.folderProvider.getFolder(this.courseId,this.module.id).then(function(e){return t.courseProvider.loadModuleContents(t.module,t.courseId).then(function(){return e.contents=t.module.contents,e})}):this.courseProvider.getModule(this.module.id,this.courseId).then(function(e){return e.contents.length||!t.module.contents.length||t.appProvider.isOnline()||(e.contents=t.module.contents),t.module=e,e})).then(function(n){n&&(t.description=n.intro||n.description,t.dataRetrieved.emit(n)),t.showModuleData(n),t.fillContextMenu(e)})},d([Object(o.D)(),l("design:type",String)],t.prototype,"path",void 0),t=d([Object(o.m)({selector:"addon-mod-folder-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ion-list *ngIf="contents && contents.length > 0">\n        <ng-container *ngFor="let file of contents">\n            <a *ngIf="file.type === \'folder\'" ion-item class="item-media" [navPush]="\'AddonModFolderIndexPage\'" [navParams]="{path: file.filepath, courseId: courseId, module: file}">\n                <img [src]="file.fileicon" alt="" role="presentation" item-start>\n                <p>{{file.name}}</p>\n            </a>\n            <core-file *ngIf="file.type !== \'folder\'" [file]="file" [component]="component" [componentId]="file.contextid"></core-file>\n        </ng-container>\n    </ion-list>\n\n    <core-empty-box *ngIf="!contents || contents.length == 0" icon="folder" [message]=" \'addon.mod_folder.emptyfilelist\' | translate"></core-empty-box>\n\n</core-loading>\n'}),l("design:paramtypes",[o.C,a.a,i.a,r.a,c.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(4),i=n(133),s=n(75),a=n(36),c=n(26),u=n(46),d=n(117),l=n(195),f=n(149),p=n(196),h=n(817),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},b=function(e){function t(t,n,o,r,i,s,a,c,u,l,f){var h=e.call(this,t)||this;return h.content=n,h.navCtrl=o,h.groupsProvider=r,h.userProvider=i,h.forumProvider=s,h.forumHelper=a,h.forumOffline=c,h.forumSync=u,h.prefetchDelegate=l,h.prefetchHandler=f,h.component=d.a.COMPONENT,h.moduleName="forum",h.canLoadMore=!1,h.discussions=[],h.offlineDiscussions=[],h.selectedDiscussion=0,h.addDiscussionText=h.translate.instant("addon.mod_forum.addanewdiscussion"),h.syncEventName=p.a.AUTO_SYNCED,h.page=0,h.trackPosts=!1,h.usesGroups=!1,h}return m(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.syncManualObserver=this.eventsProvider.on(p.a.MANUAL_SYNCED,function(e){t.autoSyncEventReceived(e)},this.siteId),this.newDiscObserver=this.eventsProvider.on(d.a.NEW_DISCUSSION_EVENT,this.eventReceived.bind(this)),this.replyObserver=this.eventsProvider.on(d.a.REPLY_DISCUSSION_EVENT,this.eventReceived.bind(this)),this.viewDiscObserver=this.eventsProvider.on(d.a.VIEW_DISCUSSION_EVENT,function(e){t.forum&&t.forum.id==e.forumId&&(t.selectedDiscussion=t.splitviewCtrl.isOn()?e.discussion:0)},this.sitesProvider.getCurrentSiteId()),this.loadContent(!1,!0).then(function(){t.forum&&(t.splitviewCtrl.isOn()&&(t.offlineDiscussions.length>0?t.openNewDiscussion(t.offlineDiscussions[0].timecreated):t.discussions.length>0&&t.openDiscussion(t.discussions[0])),t.forumProvider.logView(t.forum.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){}))})},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.forumProvider.getForum(this.courseId,this.module.id).then(function(e){switch(o.forum=e,o.description=e.intro||o.description,o.descriptionNote=o.translate.instant("addon.mod_forum.numdiscussions",{numdiscussions:e.numdiscussions}),void 0!==e.istracked&&(o.trackPosts=e.istracked),o.dataRetrieved.emit(e),e.type){case"news":case"blog":o.addDiscussionText=o.translate.instant("addon.mod_forum.addanewtopic");break;case"qanda":o.addDiscussionText=o.translate.instant("addon.mod_forum.addanewquestion");break;default:o.addDiscussionText=o.translate.instant("addon.mod_forum.addanewdiscussion")}if(t)return o.syncActivity(n).then(function(t){t&&o.eventsProvider.trigger(p.a.MANUAL_SYNCED,{forumId:e.id,userId:o.sitesProvider.getCurrentSiteUserId(),source:"index"},o.sitesProvider.getCurrentSiteId())})}).then(function(){return o.groupsProvider.getActivityGroupMode(o.forum.cmid).then(function(e){o.usesGroups=e===u.a.SEPARATEGROUPS||e===u.a.VISIBLEGROUPS})}).then(function(){return Promise.all([o.fetchOfflineDiscussion(),o.fetchDiscussions(e)])}).catch(function(n){if(!e)return o.refreshContent(t);o.domUtils.showErrorModalDefault(n,"addon.mod_forum.errorgetforum",!0),o.canLoadMore=!1})},t.prototype.fetchOfflineDiscussion=function(){var e=this;return this.forumOffline.getNewDiscussions(this.forum.id).then(function(t){if(e.hasOffline=!!t.length,e.hasOffline){return(e.usesGroups?e.forumProvider.formatDiscussionsGroups(e.forum.cmid,t):Promise.resolve(t)).then(function(t){var n=[];return t.forEach(function(t){0==t.parent&&"single"==e.forum.type||n.push(e.userProvider.getProfile(t.userid,e.courseId,!0).then(function(e){t.userfullname=e.fullname,t.userpictureurl=e.profileimageurl}).catch(function(){}))}),Promise.all(n).then(function(){t.sort(function(e,t){return t.timecreated-e.timecreated}),e.offlineDiscussions=t})})}e.offlineDiscussions=[]})},t.prototype.fetchDiscussions=function(e){var t=this;return e&&(this.page=0),this.forumProvider.getDiscussions(this.forum.id,this.page).then(function(e){return(t.usesGroups?t.forumProvider.formatDiscussionsGroups(t.forum.cmid,e.discussions):Promise.resolve(e.discussions)).then(function(n){if("single"==t.forum.type)for(var o in n)if(n[o].userfullname&&0==n[o].parent){n[o].userfullname=!1;break}if(void 0===t.forum.istracked&&!t.trackPosts)for(var r in n)if(n[r].numunread>0){t.trackPosts=!0;break}return t.discussions=0==t.page?n:t.discussions.concat(n),t.canLoadMore=e.canLoadMore,t.page++,t.forumOffline.hasForumReplies(t.forum.id).then(function(e){var o=[];return t.hasOffline=t.hasOffline||e,e&&n.forEach(function(e){o.push(t.forumOffline.getDiscussionReplies(e.discussion).then(function(t){e.numreplies=parseInt(e.numreplies,10)+t.length}))}),Promise.all(o)})})})},t.prototype.fetchMoreDiscussions=function(){var e=this;return this.fetchDiscussions(!1).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_forum.errorgetforum",!0),e.canLoadMore=!1})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.forumProvider.invalidateForumData(this.courseId)),this.forum&&(e.push(this.forumProvider.invalidateDiscussionsList(this.forum.id)),e.push(this.groupsProvider.invalidateActivityGroupMode(this.forum.cmid))),Promise.all(e)},t.prototype.sync=function(){var e=this,t=[];return t.push(this.forumSync.syncForumDiscussions(this.forum.id).then(function(t){return t.warnings&&t.warnings.length&&e.domUtils.showErrorModal(t.warnings[0]),t})),t.push(this.forumSync.syncForumReplies(this.forum.id).then(function(t){return t.warnings&&t.warnings.length&&e.domUtils.showErrorModal(t.warnings[0]),t})),Promise.all(t).then(function(e){return e.reduce(function(e,t){return{updated:e.updated||t.updated,warnings:(e.warnings||[]).concat(t.warnings||[])}},{updated:!1})})},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.isRefreshSyncNeeded=function(e){return this.forum&&"index"!=e.source&&e.forumId==this.forum.id&&e.userId==this.sitesProvider.getCurrentSiteUserId()},t.prototype.eventReceived=function(e){(this.forum&&this.forum.id===e.forumId||e.cmId===this.module.id)&&(this.showLoadingAndRefresh(!1),this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus))},t.prototype.openDiscussion=function(e){this.splitviewCtrl.push("AddonModForumDiscussionPage",{courseId:this.courseId,cmId:this.module.id,forumId:this.forum.id,discussionId:e.discussion,trackPosts:this.trackPosts,locked:e.locked&&!e.canreply})},t.prototype.openNewDiscussion=function(e){void 0===e&&(e=0);this.splitviewCtrl.push("AddonModForumNewDiscussionPage",{courseId:this.courseId,cmId:this.module.id,forumId:this.forum.id,timeCreated:e})},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.syncManualObserver&&this.syncManualObserver.off(),this.newDiscObserver&&this.newDiscObserver.off(),this.replyObserver&&this.replyObserver.off(),this.viewDiscObserver&&this.viewDiscObserver.off()},g([Object(o._9)(i.a),y("design:type",i.a)],t.prototype,"splitviewCtrl",void 0),t=g([Object(o.m)({selector:"addon-mod-forum-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'addon.mod_forum.refreshdiscussions\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-split-view>\n    <ion-content [class.has-fab]="forum && forum.cancreatediscussions">\n        <ion-refresher [enabled]="loaded" (ionRefresh)="doRefresh($event)">\n            <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n        </ion-refresher>\n        <core-loading [hideUntil]="loaded" class="core-loading-center">\n            <core-course-module-description [description]="description" [component]="component" [componentId]="componentId" [note]="descriptionNote"></core-course-module-description>\n\n            \x3c!-- Forum discussions found to be synchronized --\x3e\n            <ion-card class="core-warning-card" icon-start *ngIf="hasOffline">\n                <ion-icon name="warning"></ion-icon> {{ \'core.hasdatatosync\' | translate:{$a: moduleName} }}\n            </ion-card>\n\n            <ng-container *ngIf="forum && discussions.length > 0">\n                <ion-card *ngFor="let discussion of offlineDiscussions" (click)="openNewDiscussion(discussion.timecreated)" [class.addon-forum-discussion-selected]="discussion.timecreated == -selectedDiscussion">\n                    <ion-item text-wrap>\n                        <ion-avatar item-start core-user-link [userId]="discussion.userid" [courseId]="courseId">\n                            <img [src]="discussion.userpictureurl" onError="this.src=\'assets/img/user-avatar.png\'" core-external-content [alt]="\'core.pictureof\' | translate:{$a: discussion.userfullname}" role="presentation">\n                        </ion-avatar>\n                        <h2>{{discussion.subject}}</h2>\n                        <p *ngIf="discussion.userfullname">\n                            <ion-note float-right padding-left><ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}</ion-note>\n                            {{discussion.userfullname}}\n                        </p>\n                    </ion-item>\n                    <ion-card-content>\n                        <ion-note text-right *ngIf="discussion.groupname">\n                            <ion-icon name="people"></ion-icon> {{ discussion.groupname }}\n                        </ion-note>\n                        <p><core-format-text [clean]="true" [maxHeight]="60" [component]="component" [componentId]="componentId" [text]="discussion.message"></core-format-text></p>\n                    </ion-card-content>\n                </ion-card>\n                <ion-card *ngFor="let discussion of discussions" (click)="openDiscussion(discussion)" [class.addon-forum-discussion-selected]="discussion.discussion == selectedDiscussion">\n                    <ion-item text-wrap>\n                        <ion-avatar item-start core-user-link [userId]="discussion.userid" [courseId]="courseId">\n                            <img [src]="discussion.userpictureurl" onError="this.src=\'assets/img/user-avatar.png\'" core-external-content [alt]="\'core.pictureof\' | translate:{$a: discussion.userfullname}" role="presentation">\n                        </ion-avatar>\n                        <h2><ion-icon name="pin" *ngIf="discussion.pinned"></ion-icon> {{discussion.subject}}</h2>\n                        <p>\n                            <ion-note float-right padding-left>\n                                {{discussion.created | coreDateDayOrTime}}\n                                <div *ngIf="discussion.numunread"><ion-icon name="record"></ion-icon> {{ \'addon.mod_forum.unreadpostsnumber\' | translate:{ \'$a\' : discussion.numunread} }}</div>\n                            </ion-note>\n                            {{discussion.userfullname}}\n                        </p>\n                    </ion-item>\n                    <ion-card-content>\n                        <core-format-text [clean]="true" [maxHeight]="60" [component]="component" [componentId]="componentId" [text]="discussion.message"></core-format-text>\n                    </ion-card-content>\n                    <ion-row text-center>\n                        <ion-col *ngIf="discussion.groupname">\n                            <ion-note>\n                                <ion-icon name="people"></ion-icon> {{ discussion.groupname }}\n                            </ion-note>\n                        </ion-col>\n                        <ion-col>\n                            <ion-note>\n                                <ion-icon name="chatboxes"></ion-icon> {{ \'addon.mod_forum.numreplies\' | translate:{numreplies: discussion.numreplies} }}\n                            </ion-note>\n                        </ion-col>\n                        <ion-col *ngIf="discussion.timemodified > discussion.created">\n                            <ion-note>\n                                <ion-icon name="time"></ion-icon> {{discussion.timemodified | coreTimeAgo}}\n                            </ion-note>\n                        </ion-col>\n                    </ion-row>\n                </ion-card>\n            </ng-container>\n\n            <core-empty-box *ngIf="forum && discussions.length == 0" icon="chatbubbles" [message]="\'addon.mod_forum.forumnodiscussionsyet\' | translate">\n                <div padding *ngIf="forum.cancreatediscussions">\n                    <button ion-button block (click)="openNewDiscussion()">\n                        {{ \'addon.mod_forum.addanewdiscussion\' | translate }}\n                    </button>\n                </div>\n            </core-empty-box>\n\n            <ion-infinite-scroll [enabled]="canLoadMore" (ionInfinite)="$event.waitFor(fetchMoreDiscussions())">\n                <ion-infinite-scroll-content></ion-infinite-scroll-content>\n            </ion-infinite-scroll>\n        </core-loading>\n\n        <ion-fab bottom right *ngIf="forum && forum.cancreatediscussions">\n            <button ion-fab (click)="openNewDiscussion()" [attr.aria-label]="addDiscussionText">\n                <ion-icon name="add"></ion-icon>\n            </button>\n        </ion-fab>\n    </ion-content>\n</core-split-view>\n'}),v(1,Object(o.N)()),y("design:paramtypes",[o.C,r.f,r.q,u.a,c.a,d.a,l.a,f.a,p.a,a.a,h.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(56),i=n(27),s=n(137),a=n(163),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.fileProvider=e,this.uploaderProvider=t,this.glossaryOffline=n}return e.prototype.deleteStoredFiles=function(e,t,n,o){var r=this;return this.glossaryOffline.getEntryFolder(e,t,n,o).then(function(e){return r.fileProvider.removeDir(e).catch(function(){})})},e.prototype.getStoredFiles=function(e,t,n,o){var r=this;return this.glossaryOffline.getEntryFolder(e,t,n,o).then(function(e){return r.uploaderProvider.getStoredFiles(e)})},e.prototype.hasEntryDataChanged=function(e,t,n){return n&&void 0!==n.concept?n.definition!=e.definition||n.concept!=e.concept||this.uploaderProvider.areFileListDifferent(t,n.files):e.definition||e.concept||t.length>0},e.prototype.storeFiles=function(e,t,n,o,r){var i=this;return this.glossaryOffline.getEntryFolder(e,t,n,r).then(function(e){return i.uploaderProvider.storeFilesToUpload(e,o)})},e.prototype.uploadOrStoreFiles=function(e,t,n,o,r,i){return r?this.storeFiles(e,t,n,o,i):this.uploaderProvider.uploadOrReuploadFiles(o,s.a.COMPONENT,e,i)},e=c([Object(o.A)(),u("design:paramtypes",[i.a,r.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(133),s=n(75),a=n(137),c=n(163),u=n(350),d=n(819),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,i){var s=e.call(this,t)||this;return s.popoverCtrl=n,s.glossaryProvider=o,s.glossaryOffline=r,s.glossarySync=i,s.component=a.a.COMPONENT,s.moduleName="glossary",s.isSearch=!1,s.entries=[],s.offlineEntries=[],s.canAdd=!1,s.canLoadMore=!1,s.loadingMessage=s.translate.instant("core.loading"),s.syncEventName=u.a.AUTO_SYNCED,s}return l(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.addEntryObserver=this.eventsProvider.on(a.a.ADD_ENTRY_EVENT,this.eventReceived.bind(this)),this.loadContent(!1,!0).then(function(){t.glossary&&(t.splitviewCtrl.isOn()&&t.entries.length>0&&t.openEntry(t.entries[0].id),t.glossaryProvider.logView(t.glossary.id,t.viewMode).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){}))})},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.glossaryProvider.getGlossary(this.courseId,this.module.id).then(function(e){if(o.glossary=e,o.description=e.intro||o.description,o.canAdd=o.glossaryProvider.isPluginEnabledForEditing()&&e.canaddentry||!1,o.fetchMode||o.switchMode("letter_all"),t)return o.syncActivity(n)}).then(function(){return o.fetchEntries().then(function(){return o.glossaryOffline.getGlossaryNewEntries(o.glossary.id).then(function(e){e.sort(function(e,t){return e.concept.localeCompare(t.fullname)}),o.hasOffline=!!e.length,o.offlineEntries=e||[]})})}).then(function(){o.fillContextMenu(e)})},t.prototype.fetchEntries=function(e){var t=this;if(void 0===e&&(e=!1),!this.fetchFunction||!this.fetchArguments)return Promise.resolve({entries:[],count:0});return this.glossaryProvider.fetchEntries(this.fetchFunction,this.fetchArguments,e?this.entries.length:0,a.a.LIMIT_ENTRIES).then(function(n){e?Array.prototype.push.apply(t.entries,n.entries):t.entries=n.entries,t.canLoadMore=t.entries.length<n.count}).catch(function(e){return t.canLoadMore=!1,Promise.reject(e)})},t.prototype.invalidateContent=function(){var e=[];return this.fetchInvalidate&&this.fetchArguments&&e.push(this.fetchInvalidate.apply(this.glossaryProvider,this.fetchArguments)),e.push(this.glossaryProvider.invalidateCourseGlossaries(this.courseId)),this.glossary&&this.glossary.id&&e.push(this.glossaryProvider.invalidateCategories(this.glossary.id)),Promise.all(e)},t.prototype.sync=function(){return this.glossarySync.syncGlossaryEntries(this.glossary.id)},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.isRefreshSyncNeeded=function(e){return this.glossary&&e.glossaryId==this.glossary.id&&e.userId==this.sitesProvider.getCurrentSiteUserId()},t.prototype.switchMode=function(e){var t=this;switch(this.fetchMode=e,e){case"author_all":this.viewMode="author",this.fetchFunction=this.glossaryProvider.getEntriesByAuthor,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesByAuthor,this.fetchArguments=[this.glossary.id,"ALL","LASTNAME","ASC"],this.getDivider=function(e){return e.userfullname},this.showDivider=function(e,t){return void 0===t||e.userid!=t.userid};break;case"cat_all":this.viewMode="cat",this.fetchFunction=this.glossaryProvider.getEntriesByCategory,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesByCategory,this.fetchArguments=[this.glossary.id,a.a.SHOW_ALL_CATERGORIES],this.getDivider=function(e){return e.categoryname},this.showDivider=function(e,n){return!n||t.getDivider(e)!=t.getDivider(n)};break;case"newest_first":this.viewMode="date",this.fetchFunction=this.glossaryProvider.getEntriesByDate,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesByDate,this.fetchArguments=[this.glossary.id,"CREATION","DESC"],this.getDivider=null,this.showDivider=function(){return!1};break;case"recently_updated":this.viewMode="date",this.fetchFunction=this.glossaryProvider.getEntriesByDate,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesByDate,this.fetchArguments=[this.glossary.id,"UPDATE","DESC"],this.getDivider=null,this.showDivider=function(){return!1};break;case"search":this.viewMode="search",this.fetchFunction=this.glossaryProvider.getEntriesBySearch,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesBySearch,this.fetchArguments=null,this.getDivider=null,this.showDivider=function(){return!1};break;case"letter_all":default:this.viewMode="letter",this.fetchMode="letter_all",this.fetchFunction=this.glossaryProvider.getEntriesByLetter,this.fetchInvalidate=this.glossaryProvider.invalidateEntriesByLetter,this.fetchArguments=[this.glossary.id,"ALL"],this.getDivider=function(e){return e.concept.substr(0,1).toUpperCase()},this.showDivider=function(e,n){return!n||t.getDivider(e)!=t.getDivider(n)}}},t.prototype.loadMoreEntries=function(){var e=this;return this.fetchEntries(!0).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_glossary.errorloadingentries",!0)})},t.prototype.openModePicker=function(e){var t=this,n=this.popoverCtrl.create(d.a,{glossary:this.glossary,selectedMode:this.fetchMode});n.onDidDismiss(function(e){e!==t.fetchMode&&(t.loadingMessage=t.translate.instant("core.loading"),t.content.scrollToTop(),t.switchMode(e),"search"===t.fetchMode?(t.entries=[],t.canLoadMore=!1):(t.loaded=!1,t.loadContent()))}),n.present({ev:e})},t.prototype.openEntry=function(e){this.splitviewCtrl.push("AddonModGlossaryEntryPage",{courseId:this.courseId,entryId:e}),this.selectedEntry=e},t.prototype.openNewEntry=function(e){var t={courseId:this.courseId,module:this.module,glossary:this.glossary,entry:e};this.splitviewCtrl.getMasterNav().push("AddonModGlossaryEditPage",t),this.selectedEntry=0},t.prototype.search=function(e){this.loadingMessage=this.translate.instant("core.searching"),this.fetchArguments=[this.glossary.id,e,1,"CONCEPT","ASC"],this.loaded=!1,this.loadContent()},t.prototype.eventReceived=function(e){this.glossary&&this.glossary.id===e.glossaryId&&(this.showLoadingAndRefresh(!1),this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus))},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.addEntryObserver&&this.addEntryObserver.off()},f([Object(o._9)(i.a),p("design:type",i.a)],t.prototype,"splitviewCtrl",void 0),f([Object(o._9)(r.f),p("design:type",r.f)],t.prototype,"content",void 0),t=f([Object(o.m)({selector:"addon-mod-glossary-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <button *ngIf="glossary" ion-button icon-only (click)="openModePicker($event)" [attr.aria-label]="\'addon.mod_glossary.browsemode\' | translate">\n        <ion-icon name="funnel"></ion-icon>\n    </button>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="650" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="canAdd" [priority]="600" [content]="\'addon.mod_glossary.addentry\' | translate" (action)="openNewEntry()" iconAction="add"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-split-view>\n    <ion-content [class.has-fab]="canAdd">\n        <ion-refresher [enabled]="loaded" (ionRefresh)="doRefresh($event)">\n            <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n        </ion-refresher>\n\n        <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n        \x3c!-- Glossary entries found to be synchronized --\x3e\n        <ion-card class="core-warning-card" icon-start *ngIf="hasOffline">\n            <ion-icon name="warning"></ion-icon> {{ \'core.hasdatatosync\' | translate:{$a: moduleName} }}\n        </ion-card>\n\n        <core-search-box *ngIf="viewMode == \'search\'" (onSubmit)="search($event)" [placeholder]="\'addon.mod_glossary.searchquery\' | translate" [autoFocus]="true" [lengthCheck]="2" [showClear]="false"></core-search-box>\n\n        <core-loading [hideUntil]="loaded" class="core-loading-center">\n\n            <ion-list *ngIf="viewMode != \'search\' && offlineEntries.length > 0">\n                <ion-item-divider color="light">\n                    {{ \'addon.mod_glossary.entriestobesynced\' | translate }}\n                </ion-item-divider>\n                <a ion-item *ngFor="let entry of offlineEntries" (click)="openNewEntry(entry)" detail-none>\n                    <p>{{entry.concept}}</p>\n                </a>\n            </ion-list>\n\n            <ion-list *ngIf="entries.length > 0">\n                <ng-container *ngFor="let entry of entries; let index = index">\n\n                    <ion-item-divider color="light" *ngIf="showDivider(entry, entries[index - 1])">\n                        {{getDivider(entry)}}\n                    </ion-item-divider>\n\n                    <a ion-item (click)="openEntry(entry.id)" [class.core-split-item-selected]="entry.id == selectedEntry" detail-none>\n                        <p>{{entry.concept}}</p>\n                    </a>\n                </ng-container>\n            </ion-list>\n\n            <core-empty-box *ngIf="!entries.length && !offlineEntries.length" icon="list" [message]="\'addon.mod_glossary.noentriesfound\' | translate"></core-empty-box>\n\n            <ion-infinite-scroll [enabled]="canLoadMore" (ionInfinite)="$event.waitFor(loadMoreEntries())">\n                <ion-infinite-scroll-content></ion-infinite-scroll-content>\n            </ion-infinite-scroll>\n        </core-loading>\n\n        <ion-fab bottom right *ngIf="canAdd">\n            <button ion-fab (click)="openNewEntry()" [attr.aria-label]="\'addon.mod_glossary.addentry\' | translate">\n                <ion-icon name="add"></ion-icon>\n            </button>\n        </ion-fab>\n    </ion-content>\n</core-split-view>\n'}),p("design:paramtypes",[o.C,r.t,a.a,c.a,u.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(9),s=n(10),a=n(145),c=n(237),u=n(821),d=n(822),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,i,s){var a=e.call(this,t)||this;return a.imscpProvider=n,a.courseProvider=o,a.appProvider=r,a.popoverCtrl=i,a.imscpPrefetch=s,a.component=c.a.COMPONENT,a.items=[],a.src="",a.previousItem="",a.nextItem="",a}return l(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent().then(function(){t.imscpProvider.logView(t.module.instance).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.invalidateContent=function(){return this.imscpProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.fetchContent=function(e){var t=this,n=!1,o=[];return o.push(this.imscpProvider.getImscp(this.courseId,this.module.id).then(function(e){t.description=e.intro||e.description,t.dataRetrieved.emit(e)})),o.push(this.imscpPrefetch.download(this.module,this.courseId).catch(function(){return n=!0,t.courseProvider.loadModuleContents(t.module,t.courseId).catch(function(e){return t.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0),Promise.reject(null)})})),Promise.all(o).then(function(){return t.items=t.imscpProvider.createItemList(t.module.contents),t.items.length&&void 0===t.currentItem&&(t.currentItem=t.items[0].href),t.loadItem(t.currentItem).catch(function(e){return t.domUtils.showErrorModalDefault(e,"addon.mod_imscp.deploymenterror",!0),Promise.reject(null)})}).then(function(){n&&t.appProvider.isOnline()&&t.domUtils.showErrorModal("core.errordownloadingsomefiles",!0),t.fillContextMenu(e)})},t.prototype.loadItem=function(e){var t=this;return this.imscpProvider.getIframeSrc(this.module,e).then(function(n){t.currentItem=e,t.previousItem=t.imscpProvider.getPreviousItem(t.items,e),t.nextItem=t.imscpProvider.getNextItem(t.items,e),t.src&&n==t.src?(t.src="",setTimeout(function(){t.src=n})):t.src=n})},t.prototype.showToc=function(e){var t=this,n=this.popoverCtrl.create(d.a,{items:this.items});n.onDidDismiss(function(e){e&&t.loadItem(e)}),n.present({ev:e})},t=f([Object(o.m)({selector:"addon-mod-imscp-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <button ion-button icon-only (click)="showToc($event)">\n        <ion-icon name="bookmark" *ngIf="items.length"></ion-icon>\n    </button>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n    <div class="addon-mod-imscp-container">\n        <core-navigation-bar [previous]="previousItem" [next]="nextItem" (action)="loadItem($event)" [info]="description" [title]="\'core.description\' | translate" [component]="component" [componentId]="componentId"></core-navigation-bar>\n        <core-iframe [src]="src"></core-iframe>\n    </div>\n</core-loading>\n'}),p("design:paramtypes",[o.C,c.a,s.a,i.a,r.t,u.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(4),i=n(46),s=n(22),a=n(6),c=n(75),u=n(26),d=n(95),l=n(200),f=n(259),p=n(351),h=n(30),m=n(135),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},_=function(e){function t(t,n,o,r,i,s,a,c,u,l,p){var h=e.call(this,t,o)||this;return h.lessonProvider=n,h.groupsProvider=r,h.lessonOffline=i,h.lessonSync=s,h.utils=a,h.prefetchHandler=c,h.navCtrl=u,h.timeUtils=l,h.userProvider=p,h.component=d.a.COMPONENT,h.moduleName="lesson",h.syncEventName=f.a.AUTO_SYNCED,h}return g(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.selectedTab="report"==this.action?1:0,this.loadContent(!1,!0).then(function(){!t.lesson||t.preventMessages&&t.preventMessages.length||t.logView()})},t.prototype.changeGroup=function(e){var t=this;this.reportLoaded=!1,this.setGroup(e).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error getting report.")}).finally(function(){t.reportLoaded=!0})},t.prototype.fetchContent=function(e,t,n){var o=this;void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1);var r=!0;return this.askPassword=!1,this.lessonProvider.getLesson(this.courseId,this.module.id).then(function(e){if(o.lesson=e,o.dataRetrieved.emit(o.lesson),o.description=o.lesson.intro,t)return o.syncActivity(n)}).then(function(){return o.lessonProvider.getAccessInformation(o.lesson.id)}).then(function(t){var n=[];if(o.accessInfo=t,o.canManage=t.canmanage,o.canViewReports=t.canviewreports,o.lessonProvider.isLessonOffline(o.lesson)&&(o.setStatusListener(),n.push(o.lessonSync.hasDataToSync(o.lesson.id,t.attemptscount).then(function(e){o.hasOffline=e})),n.push(o.lessonSync.getRetakeFinishedInSync(o.lesson.id).then(function(e){e&&e.retake==t.attemptscount-1?o.retakeToReview=e:(o.retakeToReview=void 0,e&&o.lessonSync.deleteRetakeFinishedInSync(o.lesson.id))})),n.push(o.lessonProvider.getContentPagesViewedOnline(o.lesson.id,t.attemptscount)),n.push(o.lessonProvider.getQuestionsAttemptsOnline(o.lesson.id,t.attemptscount))),t.preventaccessreasons&&t.preventaccessreasons.length){if(1==t.preventaccessreasons.length&&o.lessonProvider.isPasswordProtected(t)){var i=o.password?Promise.resolve(o.password):o.lessonProvider.getStoredPassword(o.lesson.id);n.push(i.then(function(e){return o.validatePassword(e)}).catch(function(){o.askPassword=!0,o.preventMessages=t.preventaccessreasons,r=!1}))}else o.preventMessages=t.preventaccessreasons,r=!1}return 1==o.selectedTab&&o.canViewReports&&n.push(o.fetchReportData()),Promise.all(n).then(function(){r&&o.lessonReady(e)})})},t.prototype.fetchReportData=function(){var e=this;return this.groupsProvider.getActivityGroupInfo(this.module.id).then(function(t){return e.groupInfo=t,e.setGroup(e.group||0)}).finally(function(){e.reportLoaded=!0})},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.ionViewDidEnter=function(){e.prototype.ionViewDidEnter.call(this),this.tabsComponent&&this.tabsComponent.ionViewDidEnter(),this.hasPlayed&&(this.hasPlayed=!1,this.showLoadingAndRefresh(!0,!1))},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),this.tabsComponent&&this.tabsComponent.ionViewDidLeave(),"AddonModLessonPlayerPage"==this.navCtrl.getActive().component.name&&(this.hasPlayed=!0)},t.prototype.invalidateContent=function(){var e=[];return e.push(this.lessonProvider.invalidateLessonData(this.courseId)),this.lesson&&(e.push(this.lessonProvider.invalidateAccessInformation(this.lesson.id)),e.push(this.lessonProvider.invalidatePages(this.lesson.id)),e.push(this.lessonProvider.invalidateLessonWithPassword(this.lesson.id)),e.push(this.lessonProvider.invalidateTimers(this.lesson.id)),e.push(this.lessonProvider.invalidateContentPagesViewed(this.lesson.id)),e.push(this.lessonProvider.invalidateQuestionsAttempts(this.lesson.id)),e.push(this.lessonProvider.invalidateRetakesOverview(this.lesson.id)),e.push(this.groupsProvider.invalidateActivityGroupInfo(this.module.id))),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return this.lesson&&e.lessonId==this.lesson.id},t.prototype.lessonReady=function(e){this.askPassword=!1,this.preventMessages=[],this.leftDuringTimed=this.hasOffline||this.lessonProvider.leftDuringTimed(this.accessInfo),this.password&&this.lessonProvider.storePassword(this.lesson.id,this.password),this.fillContextMenu(e)},t.prototype.logView=function(){var e=this;this.lessonProvider.logViewLesson(this.lesson.id,this.password).then(function(){e.courseProvider.checkModuleCompletion(e.courseId,e.module.completionstatus)}).catch(function(e){})},t.prototype.playLesson=function(e){var t=this;return(this.hasOffline?e?this.lessonProvider.getLastPageSeen(this.lesson.id,this.accessInfo.attemptscount):Promise.resolve(this.accessInfo.firstpageid):this.leftDuringTimed&&!this.lesson.timelimit?Promise.resolve(e?this.accessInfo.lastpageseen:this.accessInfo.firstpageid):Promise.resolve()).then(function(e){t.navCtrl.push("AddonModLessonPlayerPage",{courseId:t.courseId,lessonId:t.lesson.id,pageId:e,password:t.password})})},t.prototype.reportsSelected=function(){var e=this;this.groupInfo||this.fetchReportData().catch(function(t){e.domUtils.showErrorModalDefault(t,"Error getting report.")})},t.prototype.review=function(){this.retakeToReview&&this.navCtrl.push("AddonModLessonPlayerPage",{courseId:this.courseId,lessonId:this.lesson.id,pageId:this.retakeToReview.pageid,password:this.password,review:!0,retake:this.retakeToReview.retake})},t.prototype.setGroup=function(e){var t=this;if(this.group=e,this.selectedGroupName="",e&&this.groupInfo&&this.groupInfo.groups)for(var n=0;n<this.groupInfo.groups.length;n++){var o=this.groupInfo.groups[n];if(e==o.id){this.selectedGroupName=o.name;break}}return this.lessonProvider.getRetakesOverview(this.lesson.id,e).then(function(e){var n=[];return e&&null!=e.avetime&&e.numofattempts&&(e.avetime=Math.floor(e.avetime/e.numofattempts),e.avetimeReadable=t.timeUtils.formatTime(e.avetime)),e&&null!=e.hightime&&(e.hightimeReadable=t.timeUtils.formatTime(e.hightime)),e&&null!=e.lowtime&&(e.lowtimeReadable=t.timeUtils.formatTime(e.lowtime)),e&&e.lessonscored&&(e.numofattempts&&(e.avescore=t.textUtils.roundToDecimals(e.avescore,2)),null!=e.highscore&&(e.highscore=t.textUtils.roundToDecimals(e.highscore,2)),null!=e.lowscore&&(e.lowscore=t.textUtils.roundToDecimals(e.lowscore,2))),e&&e.students&&e.students.forEach(function(e){e.bestgrade=t.textUtils.roundToDecimals(e.bestgrade,2),n.push(t.userProvider.getProfile(e.id,t.courseId,!0).then(function(t){e.profileimageurl=t.profileimageurl}).catch(function(){}))}),t.utils.allPromises(n).catch(function(){}).then(function(){t.overview=e})})},t.prototype.showStatus=function(e,t){this.showSpinner=e==h.a.DOWNLOADING},t.prototype.start=function(e){var t=this;this.showSpinner||(this.lessonProvider.isLessonOffline(this.lesson)&&this.currentStatus!=h.a.DOWNLOADED?(this.showSpinner=!0,this.prefetchHandler.prefetch(this.module,this.courseId,!0).then(function(){t.playLesson(e)}).catch(function(n){t.hasOffline?t.playLesson(e):t.domUtils.showErrorModalDefault(n,"core.errordownloading",!0)}).finally(function(){t.showSpinner=!1})):this.playLesson(e))},t.prototype.submitPassword=function(e){var t=this,n=e&&e.value;n?(this.loaded=!1,this.refreshIcon="spinner",this.syncIcon="spinner",this.validatePassword(n).then(function(){t.lessonReady(!1),t.logView()}).catch(function(e){t.domUtils.showErrorModal(e)}).finally(function(){t.loaded=!0,t.refreshIcon="refresh",t.syncIcon="sync"})):this.domUtils.showErrorModal("addon.mod_lesson.emptypassword",!0)},t.prototype.sync=function(){return this.lessonSync.syncLesson(this.lesson.id,!0)},t.prototype.validatePassword=function(e){var t=this;return this.lessonProvider.getLessonWithPassword(this.lesson.id,e).then(function(n){t.lesson=n,t.password=e}).catch(function(e){return t.password="",Promise.reject(e)})},y([Object(o._9)(m.a),v("design:type",m.a)],t.prototype,"tabsComponent",void 0),y([Object(o.D)(),v("design:type",Number)],t.prototype,"group",void 0),y([Object(o.D)(),v("design:type",String)],t.prototype,"action",void 0),t=y([Object(o.m)({selector:"addon-mod-lesson-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-tabs [selectedIndex]="selectedTab">\n        \x3c!-- Index/Preview tab. --\x3e\n        <core-tab [title]="\'addon.mod_lesson.preview\' | translate">\n            <ng-template>\n                <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n                \x3c!-- Prevent access messages. Only show the first one. --\x3e\n                <div class="core-info-card" icon-start *ngIf="lesson && preventMessages && preventMessages.length">\n                    <ion-icon name="information-circle"></ion-icon>\n                    <core-format-text [component]="component" [componentId]="componentId" [text]="preventMessages[0].message"></core-format-text>\n                </div>\n\n                \x3c!-- Lesson has data to be synchronized --\x3e\n                <div class="core-warning-card" icon-start *ngIf="hasOffline">\n                    <ion-icon name="warning"></ion-icon>\n                    {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n                </div>\n\n                \x3c!-- Input password for protected lessons. --\x3e\n                <ion-card *ngIf="askPassword">\n                    <form ion-list (ngSubmit)="submitPassword(passwordinput)">\n                        <ion-item>\n                            <core-show-password item-content [name]="\'password\'">\n                                <ion-label>{{ \'addon.mod_lesson.enterpassword\' | translate }}</ion-label>\n                                <ion-input name="password" type="password" placeholder="{{ \'core.login.password\' | translate }}" [core-auto-focus] #passwordinput></ion-input>\n                            </core-show-password>\n                        </ion-item>\n                        <ion-item>\n                            <button ion-button block type="submit" icon-end>\n                                {{ \'addon.mod_lesson.continue\' | translate }}\n                                <ion-icon name="arrow-forward" md="ios-arrow-forward"></ion-icon>\n                            </button>\n                        </ion-item>\n                    </form>\n                </ion-card>\n\n                <core-loading [hideUntil]="!showSpinner">\n                    <ion-list *ngIf="lesson && (!preventMessages || !preventMessages.length)">\n                        <ion-item text-wrap *ngIf="retakeToReview">\n                            \x3c!-- A retake was finished in a synchronization, allow reviewing it. --\x3e\n                            <p>{{ \'addon.mod_lesson.retakefinishedinsync\' | translate }}</p>\n                            <a ion-button block (click)="review()">{{ \'addon.mod_lesson.review\' | translate }}</a>\n                        </ion-item>\n\n                        <ion-item text-wrap *ngIf="leftDuringTimed && !lesson.timelimit">\n                            \x3c!-- User left during the session and there is no time limit, ask to continue. --\x3e\n                            <p [innerHTML]="\'addon.mod_lesson.youhaveseen\' | translate"></p>\n                            <ion-grid>\n                                <ion-row>\n                                    <ion-col>\n                                        <a ion-button block color="light" (click)="start(false)">{{ \'core.no\' | translate }}</a>\n                                    </ion-col>\n                                    <ion-col>\n                                        <a ion-button block (click)="start(true)">{{ \'core.yes\' | translate }}</a>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-grid>\n                        </ion-item>\n\n                        <ion-item text-wrap *ngIf="leftDuringTimed && lesson.timelimit && lesson.retake">\n                            \x3c!-- User left during the session with time limit and retakes allowed, ask to continue. --\x3e\n                            <p [innerHTML]="\'addon.mod_lesson.leftduringtimed\' | translate"></p>\n                            <a ion-button block icon-end (click)="start(false)">\n                                {{ \'addon.mod_lesson.continue\' | translate }}\n                                <ion-icon name="arrow-forward" md="ios-arrow-forward"></ion-icon>\n                            </a>\n                        </ion-item>\n\n                        <ion-item text-wrap *ngIf="leftDuringTimed && lesson.timelimit && !lesson.retake">\n                            \x3c!-- User left during the session with time limit and retakes not allowed. This should be handled by preventMessages --\x3e\n                            <p [innerHTML]="\'addon.mod_lesson.leftduringtimednoretake\' | translate"></p>\n                        </ion-item>\n\n                        <ion-item text-wrap *ngIf="!leftDuringTimed">\n                            \x3c!-- User hasn\'t left during the session, show a start button. --\x3e\n                            <a ion-button block *ngIf="!canManage" icon-end (click)="start(false)">\n                                {{ \'core.start\' | translate }}\n                                <ion-icon name="arrow-forward" md="ios-arrow-forward"></ion-icon>\n                            </a>\n                            <a ion-button block *ngIf="canManage" icon-end (click)="start(false)">\n                                {{ \'addon.mod_lesson.preview\' | translate }}\n                                <ion-icon name="search"></ion-icon>\n                            </a>\n                        </ion-item>\n                    </ion-list>\n                </core-loading>\n            </ng-template>\n        </core-tab>\n\n        \x3c!-- Reports tab. --\x3e\n        <core-tab *ngIf="canViewReports" [title]="\'addon.mod_lesson.reports\' | translate" (ionSelect)="reportsSelected()">\n            <ng-template>\n                <core-loading [hideUntil]="reportLoaded">\n                    \x3c!-- Group selector if the activity uses groups. --\x3e\n                    <ion-item text-wrap *ngIf="groupInfo && (groupInfo.separateGroups || groupInfo.visibleGroups)">\n                        <ion-label id="addon-mod_lesson-groupslabel" *ngIf="groupInfo.separateGroups">{{ \'core.groupsseparate\' | translate }}</ion-label>\n                        <ion-label id="addon-mod_lesson-groupslabel" *ngIf="groupInfo.visibleGroups">{{ \'core.groupsvisible\' | translate }}</ion-label>\n                        <ion-select [(ngModel)]="group" (ionChange)="setGroup(group)" aria-labelledby="addon-mod_lesson-groupslabel" interface="popover">\n                            <ion-option *ngFor="let groupOpt of groupInfo.groups" [value]="groupOpt.id">{{groupOpt.name}}</ion-option>\n                        </ion-select>\n                    </ion-item>\n\n                    \x3c!-- No lesson retakes. --\x3e\n                    <core-empty-box *ngIf="!overview && selectedGroupName" icon="stats" [message]="\'addon.mod_lesson.nolessonattemptsgroup\' | translate:{$a: selectedGroupName}">\n                    </core-empty-box>\n                    <core-empty-box *ngIf="!overview && !selectedGroupName" icon="stats" [message]="\'addon.mod_lesson.nolessonattempts\' | translate">\n                    </core-empty-box>\n\n                    \x3c!-- General statistics for the current group. --\x3e\n                    <ion-card class="addon-mod_lesson-lessonstats" *ngIf="overview">\n                        <ion-card-header text-wrap>\n                            {{ \'addon.mod_lesson.lessonstats\' | translate }}\n                        </ion-card-header>\n\n                        \x3c!-- In tablet, max 2 rows with 3 columns. --\x3e\n                        <ion-list class="hidden-phone">\n                            <ion-item text-wrap *ngIf="overview.lessonscored">\n                                <ion-row>\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.averagescore\' | translate }}</p>\n                                        <p *ngIf="overview.numofattempts > 0">{{ \'core.percentagenumber\' | translate:{$a: overview.avescore} }}</p>\n                                        <p *ngIf="overview.numofattempts <= 0">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.highscore\' | translate }}</p>\n                                        <p *ngIf="overview.highscore != null">{{ \'core.percentagenumber\' | translate:{$a: overview.highscore} }}</p>\n                                        <p *ngIf="overview.highscore == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.lowscore\' | translate }}</p>\n                                        <p *ngIf="overview.lowscore != null">{{ \'core.percentagenumber\' | translate:{$a: overview.lowscore} }}</p>\n                                        <p *ngIf="overview.lowscore == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-item>\n\n                            <ion-item text-wrap>\n                                <ion-row>\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.averagetime\' | translate }}</p>\n                                        <p *ngIf="overview.avetime != null && overview.numofattempts">{{ overview.avetimeReadable }}</p>\n                                        <p *ngIf="overview.avetime == null || !overview.numofattempts">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.hightime\' | translate }}</p>\n                                        <p *ngIf="overview.hightime != null">{{ overview.hightimeReadable }}</p>\n                                        <p *ngIf="overview.hightime == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col text-center>\n                                        <p class="item-heading">{{ \'addon.mod_lesson.lowtime\' | translate }}</p>\n                                        <p *ngIf="overview.lowtime != null">{{ overview.lowtimeReadable }}</p>\n                                        <p *ngIf="overview.lowtime == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-item>\n                        </ion-list>\n\n                        \x3c!-- In phone, 3 rows with 1 or 2 columns. --\x3e\n                        <ion-list class="hidden-tablet">\n                            <ion-item text-wrap>\n                                <ion-row>\n                                    <ion-col text-center *ngIf="overview.lessonscored">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.averagescore\' | translate }}</p>\n                                        <p *ngIf="overview.numofattempts > 0">{{ \'core.percentagenumber\' | translate:{$a: overview.avescore} }}</p>\n                                        <p *ngIf="overview.numofattempts <= 0">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col [attr.text-center]="overview.lessonscored ? true : null">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.averagetime\' | translate }}</p>\n                                        <p *ngIf="overview.avetime != null && overview.numofattempts">{{ overview.avetimeReadable }}</p>\n                                        <p *ngIf="overview.avetime == null || !overview.numofattempts">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-item>\n\n                            <ion-item text-wrap>\n                                <ion-row>\n                                    <ion-col text-center *ngIf="overview.lessonscored">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.highscore\' | translate }}</p>\n                                        <p *ngIf="overview.highscore != null">{{ \'core.percentagenumber\' | translate:{$a: overview.highscore} }}</p>\n                                        <p *ngIf="overview.highscore == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col [attr.text-center]="overview.lessonscored ? true : null">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.hightime\' | translate }}</p>\n                                        <p *ngIf="overview.hightime != null">{{ overview.hightimeReadable }}</p>\n                                        <p *ngIf="overview.hightime == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-item>\n\n                            <ion-item text-wrap>\n                                <ion-row>\n                                    <ion-col text-center *ngIf="overview.lessonscored">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.lowscore\' | translate }}</p>\n                                        <p *ngIf="overview.lowscore != null">{{ \'core.percentagenumber\' | translate:{$a: overview.lowscore} }}</p>\n                                        <p *ngIf="overview.lowscore == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n\n                                    <ion-col [attr.text-center]="overview.lessonscored ? true : null">\n                                        <p class="item-heading">{{ \'addon.mod_lesson.lowtime\' | translate }}</p>\n                                        <p *ngIf="overview.lowtime != null">{{ overview.lowtimeReadable }}</p>\n                                        <p *ngIf="overview.lowtime == null">{{ \'addon.mod_lesson.notcompleted\' | translate }}</p>\n                                    </ion-col>\n                                </ion-row>\n                            </ion-item>\n                        </ion-list>\n                    </ion-card>\n\n                    \x3c!-- List of students that have retakes. --\x3e\n                    <ion-card *ngIf="overview">\n                        <ion-card-header text-wrap>\n                            {{ \'addon.mod_lesson.overview\' | translate }}\n                        </ion-card-header>\n\n                        <a ion-item text-wrap *ngFor="let student of overview.students" [navPush]="\'AddonModLessonUserRetakePage\'" [navParams]="{courseId: courseId, lessonId: lesson.id, userId: student.id}">\n                            <ion-avatar item-start *ngIf="student.profileimageurl" core-user-link [userId]="student.id" [courseId]="courseId">\n                                <img [src]="student.profileimageurl" [alt]="\'core.pictureof\' | translate:{$a: student.fullname}" core-external-content onError="this.src=\'assets/img/user-avatar.png\'" role="presentation">\n                            </ion-avatar>\n                            <h2>{{ student.fullname }}</h2>\n                            <core-progress-bar [progress]="student.bestgrade"></core-progress-bar>\n                        </a>\n                    </ion-card>\n                </core-loading>\n            </ng-template>\n        </core-tab>\n    </core-tabs>\n</core-loading>\n'}),b(2,Object(o.N)()),v("design:paramtypes",[o.C,d.a,r.f,i.a,l.a,f.a,a.a,p.a,r.q,s.a,u.a])],t)}(c.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(75),s=n(352),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},l=function(e){function t(t,n,o){var r=e.call(this,t,n)||this;return r.content=n,r.ltiProvider=o,r.component=s.a.COMPONENT,r.moduleName="lti",r.fetchContentDefaultError="addon.mod_lti.errorgetlti",r}return a(t,e),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.loadContent()},t.prototype.checkCompletion=function(){this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.ltiProvider.getLti(this.courseId,this.module.id).then(function(e){o.lti=e,o.description=o.lti.intro||o.description,o.dataRetrieved.emit(o.lti)}).then(function(){o.fillContextMenu(e)})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.ltiProvider.invalidateLti(this.courseId)),this.lti&&e.push(this.ltiProvider.invalidateLtiLaunchData(this.lti.id)),Promise.all(e)},t.prototype.launch=function(){var e=this;this.ltiProvider.getLtiLaunchData(this.lti.id).then(function(t){return e.ltiProvider.logView(e.lti.id).then(function(){e.checkCompletion()}).catch(function(e){}),e.ltiProvider.launch(t.endpoint,t.parameters)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.error",!0)})},t=c([Object(o.m)({selector:"addon-mod-lti-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <div padding-horizontal>\n        <button ion-button block icon-left (click)="launch()">\n            <ion-icon name="link"></ion-icon>\n            {{ \'addon.mod_lti.launchactivity\' | translate }}\n        </button>\n    </div>\n</core-loading>\n'}),d(1,Object(o.N)()),u("design:paramtypes",[o.C,r.f,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(10),s=n(145),a=n(189),c=n(353),u=n(826),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i,s){var c=e.call(this,t)||this;return c.pageProvider=n,c.courseProvider=o,c.appProvider=r,c.pageHelper=i,c.pagePrefetch=s,c.component=a.a.COMPONENT,c.fetchContentDefaultError="addon.mod_page.errorwhileloadingthepage",c}return d(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.canGetPage=this.pageProvider.isGetPageWSAvailable(),this.loadContent().then(function(){t.pageProvider.logView(t.module.instance).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.invalidateContent=function(){return this.pageProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.fetchContent=function(e){var t=this,n=!1;return this.pagePrefetch.download(this.module,this.courseId).catch(function(){n=!0}).then(function(){if(!t.module.contents.length)return t.courseProvider.loadModuleContents(t.module,t.courseId)}).then(function(){var o,r=[];return o=t.canGetPage?t.pageProvider.getPageData(t.courseId,t.module.id):t.courseProvider.getModule(t.module.id,t.courseId),r.push(o.then(function(e){e&&(t.description=e.intro||e.description,t.dataRetrieved.emit(e))}).catch(function(){})),r.push(t.pageHelper.getPageHtml(t.module.contents,t.module.id).then(function(o){t.fillContextMenu(e),t.contents=o,n&&t.appProvider.isOnline()&&t.domUtils.showErrorModal("core.errordownloadingsomefiles",!0)})),Promise.all(r)})},t=l([Object(o.m)({selector:"addon-mod-page-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <div padding>\n        <core-format-text [component]="component" [componentId]="componentId" [text]="contents"></core-format-text>\n    </div>\n\n</core-loading>\n'}),f("design:paramtypes",[o.C,a.a,i.a,r.a,c.a,u.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(4),i=n(75),s=n(70),a=n(92),c=n(251),u=n(190),d=n(164),l=n(354),f=n(30),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},y=function(e){function t(t,n,o,r,i,s,c,u,l){var f=e.call(this,t,o)||this;return f.quizProvider=n,f.quizHelper=r,f.quizOffline=i,f.quizSync=s,f.behaviourDelegate=c,f.prefetchHandler=u,f.navCtrl=l,f.component=a.a.COMPONENT,f.moduleName="quiz",f.showStatusSpinner=!0,f.fetchContentDefaultError="addon.mod_quiz.errorgetquiz",f.syncEventName=d.a.AUTO_SYNCED,f.hasPlayed=!1,f}return p(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent(!1,!0).then(function(){t.quizData&&t.quizProvider.logViewQuiz(t.quizData.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){})}),this.finishedObserver=this.eventsProvider.on(a.a.ATTEMPT_FINISHED_EVENT,function(e){t.quizData&&e.quizId==t.quizData.id&&(t.autoReview=e)},this.siteId)},t.prototype.attemptQuiz=function(){var e=this;if(!this.showStatusSpinner)if(this.quizProvider.isQuizOffline(this.quizData)){var t=this.currentStatus==f.a.DOWNLOADED;t&&this.modulePrefetchDelegate.canCheckUpdates()?this.openQuiz():(this.showStatusSpinner=!0,this.prefetchHandler.prefetch(this.module,this.courseId,!0).then(function(){e.openQuiz()}).catch(function(n){e.hasOffline||t&&!e.modulePrefetchDelegate.canCheckUpdates()?e.openQuiz():e.domUtils.showErrorModalDefault(n,"core.errordownloading",!0)}).finally(function(){e.showStatusSpinner=!1}))}else this.openQuiz()},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.quizProvider.getQuiz(this.courseId,this.module.id).then(function(e){return o.quizData=e,o.quizData.gradeMethodReadable=o.quizProvider.getQuizGradeMethod(o.quizData.grademethod),o.now=(new Date).getTime(),o.dataRetrieved.emit(o.quizData),o.description=o.quizData.intro||o.description,o.quizSync.getSyncWarnings(o.quizData.id).then(function(e){if(e&&e.length)return o.domUtils.showErrorModal(o.textUtils.buildMessage(e)),o.quizSync.setSyncWarnings(o.quizData.id,[])})}).then(function(){if(o.quizProvider.isQuizOffline(o.quizData))return o.syncActivity(n).catch(function(){o.autoReview=void 0});o.autoReview=void 0,o.showStatusSpinner=!1}).then(function(){return o.quizProvider.isQuizOffline(o.quizData)&&(o.setStatusListener(),o.quizSync.getReadableSyncTime(o.quizData.id).then(function(e){o.syncTime=e}),o.quizSync.hasDataToSync(o.quizData.id).then(function(e){o.hasOffline=e})),o.quizProvider.getQuizAccessInformation(o.quizData.id).then(function(e){return o.quizAccessInfo=e,o.quizData.showReviewColumn=e.canreviewmyattempts,o.accessRules=e.accessrules,o.unsupportedRules=o.quizProvider.getUnsupportedRules(e.activerulenames),o.quizData.preferredbehaviour&&(o.behaviourSupported=o.behaviourDelegate.isBehaviourSupported(o.quizData.preferredbehaviour)),o.quizProvider.getQuizRequiredQtypes(o.quizData.id).then(function(e){return o.unsupportedQuestions=o.quizProvider.getUnsupportedQuestions(e),o.getAttempts()})})}).then(function(){o.fillContextMenu(e),o.quiz=o.quizData})},t.prototype.getAttempts=function(){var e=this;return this.quizProvider.getAttemptAccessInformation(this.quizData.id,0).then(function(t){return e.attemptAccessInfo=t,e.quizProvider.getUserAttempts(e.quizData.id).then(function(t){return e.treatAttempts(t).then(function(t){if(e.attempts=t,e.attempts.length){e.moreAttempts=!e.quizProvider.isAttemptFinished(e.attempts[e.attempts.length-1].state)||!e.attemptAccessInfo.isfinished}else e.moreAttempts=!e.attemptAccessInfo.isfinished;return e.getButtonText(),e.getResultInfo()})})})},t.prototype.getButtonText=function(){this.buttonText="",0!==this.quizData.hasquestions&&(this.attempts.length&&!this.quizProvider.isAttemptFinished(this.attempts[this.attempts.length-1].state)?this.quizAccessInfo.canattempt?this.buttonText="addon.mod_quiz.continueattemptquiz":this.quizAccessInfo.canpreview&&(this.buttonText="addon.mod_quiz.continuepreview"):this.quizAccessInfo.canattempt?(this.preventMessages=this.attemptAccessInfo.preventnewattemptreasons,this.preventMessages.length||(this.buttonText=this.attempts.length?"addon.mod_quiz.reattemptquiz":"addon.mod_quiz.attemptquiznow")):this.quizAccessInfo.canpreview&&(this.buttonText="addon.mod_quiz.previewquiznow")),this.buttonText&&(this.preventMessages=this.quizAccessInfo.preventaccessreasons,this.moreAttempts?this.quizAccessInfo.canattempt&&this.preventMessages.length?this.buttonText="":(this.unsupportedQuestions.length||this.unsupportedRules.length||!this.behaviourSupported)&&(this.buttonText=""):this.buttonText="")},t.prototype.getResultInfo=function(){var e=this;if(this.attempts.length&&this.quizData.showGradeColumn&&this.bestGrade.hasgrade&&void 0!==this.gradebookData.grade){var t=this.quizProvider.formatGrade(this.gradebookData.grade,this.quizData.decimalpoints),n=this.quizProvider.formatGrade(this.bestGrade.grade,this.quizData.decimalpoints),o=t;if(this.showResults=!0,this.gradeOverridden=t!=n,this.gradebookFeedback=this.gradebookData.feedback,this.bestGrade.grade>this.gradebookData.grade&&this.gradebookData.grade==this.quizData.grade&&(this.gradeOverridden=!1,o=n),this.overallStats)if(this.moreAttempts)this.gradeResult=this.translate.instant("addon.mod_quiz.gradesofar",{$a:{method:this.quizData.gradeMethodReadable,mygrade:o,quizgrade:this.quizData.gradeFormatted}});else{var r=this.translate.instant("addon.mod_quiz.outofshort",{$a:{grade:o,maxgrade:this.quizData.gradeFormatted}});this.gradeResult=this.translate.instant("addon.mod_quiz.yourfinalgradeis",{$a:r})}if(this.quizData.showFeedbackColumn)return this.quizProvider.getFeedbackForGrade(this.quizData.id,this.gradebookData.grade).then(function(t){e.overallFeedback=t.feedbacktext})}else this.showResults=!1;return Promise.resolve()},t.prototype.goToAutoReview=function(){var e=this;this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus);var t=this.autoReview.attemptId;return this.quizAccessInfo.canreviewmyattempts?this.quizProvider.getAttemptReview(t,-1).then(function(){e.navCtrl.push("AddonModQuizReviewPage",{courseId:e.courseId,quizId:e.quizData.id,attemptId:t})}).catch(function(){}):Promise.resolve()},t.prototype.hasSyncSucceed=function(e){return e.attemptFinished&&this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus),e.answersSent},t.prototype.ionViewDidEnter=function(){var t=this;if(e.prototype.ionViewDidEnter.call(this),this.hasPlayed){this.hasPlayed=!1;var n=void 0;this.autoReview&&this.autoReview.synced?(n=this.goToAutoReview(),this.autoReview=void 0):n=Promise.resolve(),this.loaded=!1,this.refreshIcon="spinner",this.syncIcon="spinner",this.content.scrollToTop(),n.then(function(){t.refreshContent().finally(function(){t.loaded=!0,t.refreshIcon="refresh",t.syncIcon="sync"})})}else this.autoReview=void 0},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),this.autoReview=void 0,"AddonModQuizPlayerPage"==this.navCtrl.getActive().component.name&&(this.hasPlayed=!0)},t.prototype.invalidateContent=function(){var e=[];return e.push(this.quizProvider.invalidateQuizData(this.courseId)),this.quizData&&(e.push(this.quizProvider.invalidateUserAttemptsForUser(this.quizData.id)),e.push(this.quizProvider.invalidateQuizAccessInformation(this.quizData.id)),e.push(this.quizProvider.invalidateQuizRequiredQtypes(this.quizData.id)),e.push(this.quizProvider.invalidateAttemptAccessInformation(this.quizData.id)),e.push(this.quizProvider.invalidateCombinedReviewOptionsForUser(this.quizData.id)),e.push(this.quizProvider.invalidateUserBestGradeForUser(this.quizData.id)),e.push(this.quizProvider.invalidateGradeFromGradebook(this.courseId))),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return e.attemptFinished&&this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus),!(!this.quizData||e.quizId!=this.quizData.id)&&(this.content.scrollToTop(),!0)},t.prototype.openQuiz=function(){this.navCtrl.push("AddonModQuizPlayerPage",{courseId:this.courseId,quizId:this.quiz.id,moduleUrl:this.module.url})},t.prototype.showStatus=function(e,t){this.showStatusSpinner=e==f.a.DOWNLOADING},t.prototype.sync=function(){return this.quizSync.syncQuiz(this.quizData,!0)},t.prototype.treatAttempts=function(e){var t=this;if(!e||!e.length)return Promise.resolve(e);var n=this.quizProvider.getLastFinishedAttemptFromList(e),o=[];return this.autoReview&&n&&n.id>=this.autoReview.attemptId&&(!this.isDestroyed&&this.isCurrentView&&o.push(this.goToAutoReview()),this.autoReview=void 0),o.push(this.quizProvider.loadFinishedOfflineData(e)),o.push(this.quizProvider.getCombinedReviewOptions(this.quizData.id).then(function(e){t.options=e})),o.push(this.quizProvider.getUserBestGrade(this.quizData.id).then(function(e){return t.bestGrade=e,t.quizProvider.getGradeFromGradebook(t.courseId,t.module.id).then(function(e){t.gradebookData={grade:e.graderaw,feedback:e.feedback}}).catch(function(){t.gradebookData={grade:t.bestGrade.grade}})})),Promise.all(o).then(function(){var o=t.quizProvider.formatGrade(void 0!==t.gradebookData.grade?t.gradebookData.grade:t.bestGrade.grade,t.quizData.decimalpoints);return t.quizHelper.setQuizCalculatedData(t.quizData,t.options),t.overallStats=n&&t.options.alloptions.marks>=a.a.QUESTION_OPTIONS_MARK_AND_MAX,e.forEach(function(n){t.quizHelper.setAttemptCalculatedData(t.quizData,n,t.overallStats&&t.quizData.grademethod==a.a.GRADEHIGHEST&&e.length>1,o)}),e})},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.finishedObserver&&this.finishedObserver.off()},t=h([Object(o.m)({selector:"addon-mod-quiz-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    \x3c!-- Access rules description messages. --\x3e\n    <ion-card *ngIf="(quiz && quiz.gradeMethodReadable) || (accessRules && accessRules.length) || syncTime">\n        <ion-list>\n            <ion-item text-wrap *ngFor="let rule of accessRules">\n                <p>{{ rule }}</p>\n            </ion-item>\n            <ion-item text-wrap *ngIf="quiz && quiz.gradeMethodReadable">\n                <p class="item-heading">{{ \'addon.mod_quiz.grademethod\' | translate }}</p>\n                <p>{{ quiz.gradeMethodReadable }}</p>\n            </ion-item>\n            <ion-item text-wrap *ngIf="syncTime">\n                <p class="item-heading">{{ \'core.lastsync\' | translate }}</p>\n                <p>{{ syncTime }}</p>\n            </ion-item>\n        </ion-list>\n    </ion-card>\n\n    \x3c!-- List of user attempts. --\x3e\n    <ion-card class="addon-mod_quiz-table" *ngIf="attempts && attempts.length">\n        <ion-card-header text-wrap>\n            <h2>{{ \'addon.mod_quiz.summaryofattempts\' | translate }}</h2>\n        </ion-card-header>\n        <ion-list>\n            \x3c!-- "Header" of the table --\x3e\n            <ion-item text-wrap class="addon-mod_quiz-table-header" detail-push>\n                <ion-row align-items-center>\n                    <ion-col text-center class="hidden-phone" *ngIf="quiz.showAttemptColumn"><b>{{ \'addon.mod_quiz.attemptnumber\' | translate }}</b></ion-col>\n                    <ion-col text-center class="hidden-tablet" *ngIf="quiz.showAttemptColumn"><b>#</b></ion-col>\n                    <ion-col col-7><b>{{ \'addon.mod_quiz.attemptstate\' | translate }}</b></ion-col>\n                    <ion-col text-center class="hidden-phone" *ngIf="quiz.showMarkColumn"><b>{{ \'addon.mod_quiz.marks\' | translate }} / {{ quiz.sumGradesFormatted }}</b></ion-col>\n                    <ion-col text-center *ngIf="quiz.showGradeColumn"><b>{{ \'addon.mod_quiz.grade\' | translate }} / {{ quiz.gradeFormatted }}</b></ion-col>\n                </ion-row>\n            </ion-item>\n            \x3c!-- List of attempts. --\x3e\n            <a ion-item text-wrap *ngFor="let attempt of attempts" [ngClass]=\'{"addon-mod_quiz-highlighted core-white-push-arrow": attempt.highlightGrade}\' [navPush]="\'AddonModQuizAttemptPage\'" [navParams]="{courseId: courseId, quizId: quiz.id, attemptId: attempt.id}" [attr.aria-label]="\'core.seemoredetail\' | translate">\n                <ion-row align-items-center>\n                    <ion-col text-center *ngIf="quiz.showAttemptColumn && attempt.preview">{{ \'addon.mod_quiz.preview\' | translate }}</ion-col>\n                    <ion-col text-center *ngIf="quiz.showAttemptColumn && !attempt.preview">{{ attempt.attempt }}</ion-col>\n                    <ion-col col-7>\n                        <p *ngFor="let sentence of attempt.readableState">{{ sentence }}</p>\n                    </ion-col>\n                    <ion-col text-center class="hidden-phone" *ngIf="quiz.showMarkColumn"><p>{{ attempt.readableMark }}</p></ion-col>\n                    <ion-col text-center *ngIf="quiz.showGradeColumn"><p>{{ attempt.readableGrade }}</p></ion-col>\n                </ion-row>\n            </a>\n        </ion-list>\n    </ion-card>\n\n    \x3c!-- Result info. --\x3e\n    <ion-card *ngIf="showResults && (gradeResult || gradeOverridden || gradebookFeedback || (quiz.showFeedbackColumn && overallFeedback))">\n        <ion-list>\n            <ion-item text-wrap *ngIf="gradeResult">{{ gradeResult }}</ion-item>\n            <ion-item text-wrap *ngIf="gradeOverridden">{{ \'core.course.overriddennotice\' | translate }}</ion-item>\n            <ion-item text-wrap *ngIf="gradebookFeedback">\n                <p class="item-heading">{{ \'addon.mod_quiz.comment\' | translate }}</p>\n                <p><core-format-text [component]="component" [componentId]="componentId" [text]="gradebookFeedback"></core-format-text></p>\n            </ion-item>\n            <ion-item text-wrap *ngIf="quiz.showFeedbackColumn && overallFeedback">\n                <p class="item-heading">{{ \'addon.mod_quiz.overallfeedback\' | translate }}</p>\n                <p><core-format-text [component]="component" [componentId]="componentId" [text]="overallFeedback"></core-format-text></p>\n            </ion-item>\n        </ion-list>\n    </ion-card>\n\n    \x3c!-- More data and button to start/continue. --\x3e\n    <ion-card *ngIf="quiz">\n        <ion-list>\n            \x3c!-- Error messages. --\x3e\n            <ion-item text-wrap class="core-danger-item" *ngFor="let message of preventMessages">\n                <p>{{ message }}</p>\n            </ion-item>\n            <ion-item text-wrap class="core-danger-item" *ngIf="quiz.hasquestions === 0">\n                <p>{{ \'addon.mod_quiz.noquestions\' | translate }}</p>\n            </ion-item>\n            <ion-item text-wrap class="core-danger-item" *ngIf="unsupportedQuestions && unsupportedQuestions.length">\n                <p>{{ \'addon.mod_quiz.errorquestionsnotsupported\' | translate }}</p>\n                <p *ngFor="let type of unsupportedQuestions">{{ type }}</p>\n            </ion-item>\n            <ion-item text-wrap class="core-danger-item" *ngIf="unsupportedRules && unsupportedRules.length">\n                <p>{{ \'addon.mod_quiz.errorrulesnotsupported\' | translate }}</p>\n                <p *ngFor="let name of unsupportedRules">{{ name }}</p>\n            </ion-item>\n            <ion-item text-wrap class="core-danger-item" *ngIf="behaviourSupported === false">\n                <p>{{ \'addon.mod_quiz.errorbehaviournotsupported\' | translate }}</p>\n                <p>{{ quiz.preferredbehaviour }}</p>\n            </ion-item>\n\n            \x3c!-- Synchronization warning. --\x3e\n            <div class="core-warning-card" icon-start *ngIf="buttonText && hasOffline && !showStatusSpinner">\n                <ion-icon name="warning"></ion-icon>\n                {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n            </div>\n\n            \x3c!-- Button to start/continue. --\x3e\n            <ion-item *ngIf="buttonText && !showStatusSpinner">\n                <button ion-button block (click)="attemptQuiz()">\n                    {{ buttonText | translate }}\n                </button>\n            </ion-item>\n\n            \x3c!-- Button to open in browser if it cannot be attempted in the app. --\x3e\n            <ion-item *ngIf="!buttonText && ((unsupportedQuestions && unsupportedQuestions.length) || (unsupportedRules && unsupportedRules.length) || behaviourSupported === false)">\n                <a ion-button block [href]="externalUrl" core-link icon-end>\n                    {{ \'core.openinbrowser\' | translate }}\n                    <ion-icon name="open"></ion-icon>\n                </a>\n            </ion-item>\n\n            \x3c!-- Spinner shown while downloading or calculating. --\x3e\n            <ion-item text-center *ngIf="showStatusSpinner">\n                <ion-spinner></ion-spinner>\n            </ion-item>\n        </ion-list>\n    </ion-card>\n</core-loading>\n'}),g(2,Object(o.N)()),m("design:paramtypes",[o.C,a.a,r.f,c.a,u.a,d.a,s.a,l.a,r.q])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(10),s=n(145),a=n(191),c=n(832),u=n(238),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i,s){var c=e.call(this,t)||this;return c.resourceProvider=n,c.courseProvider=o,c.appProvider=r,c.prefetchHandler=i,c.resourceHelper=s,c.component=a.a.COMPONENT,c}return d(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.canGetResource=this.resourceProvider.isGetResourceWSAvailable(),this.loadContent().then(function(){t.resourceProvider.logView(t.module.instance).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.invalidateContent=function(){return this.resourceProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.fetchContent=function(e){var t=this;return this.courseProvider.loadModuleContents(this.module,this.courseId,null,!1,e).then(function(){return t.module.contents&&t.module.contents.length?t.canGetResource?t.resourceProvider.getResourceData(t.courseId,t.module.id).catch(function(){}):t.courseProvider.getModule(t.module.id,t.courseId).catch(function(){}):Promise.reject(null)}).then(function(e){if(e&&(t.description=e.intro||e.description,t.dataRetrieved.emit(e)),t.resourceHelper.isDisplayedInIframe(t.module)){var n=!1;return t.prefetchHandler.download(t.module,t.courseId).catch(function(){n=!0}).then(function(){return t.resourceHelper.getIframeSrc(t.module).then(function(e){t.mode="iframe",t.src&&e.toString()==t.src.toString()?(t.src="",setTimeout(function(){t.src=e})):t.src=e,n&&t.appProvider.isOnline()&&t.domUtils.showErrorModal("core.errordownloadingsomefiles",!0)})})}if(t.resourceHelper.isDisplayedEmbedded(t.module,e&&e.display))return t.mode="embedded",t.resourceHelper.getEmbeddedHtml(t.module,t.courseId).then(function(e){t.contentText=e});t.mode="external"}).then(function(){t.fillContextMenu(e)})},t.prototype.open=function(){this.resourceHelper.openModuleFile(this.module,this.courseId)},t=l([Object(o.m)({selector:"addon-mod-resource-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="600" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="500" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description *ngIf="mode != \'iframe\'" [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ng-container *ngIf="mode == \'iframe\'">\n        <core-iframe [src]="src"></core-iframe>\n    </ng-container>\n\n    <div *ngIf="mode == \'embedded\'">\n        <core-format-text [text]="contentText"></core-format-text>\n    </div>\n\n    <div padding *ngIf="mode == \'external\'">\n        <a ion-button block (click)="open()" icon-start>\n            <ion-icon name="document" start></ion-icon>\n            {{ \'addon.mod_resource.openthefile\' | translate }}\n        </a>\n    </div>\n\n</core-loading>\n'}),f("design:paramtypes",[o.C,a.a,i.a,r.a,c.a,u.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(2),s=n(8),a=n(6),c=n(138),u=n(192),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.sitesProvider=e,this.translate=t,this.domUtils=n,this.utils=o,this.scormProvider=r,this.scormOfflineProvider=i,this.elementsToIgnore=["status","score_raw","total_time","session_time","student_id","student_name","credit","mode","entry"]}return e.prototype.confirmDownload=function(e,t){var n=this;return this.scormProvider.shouldDownloadMainFile(e,t).then(function(t){if(t){return(e.packagesize?Promise.resolve(e.packagesize):n.scormProvider.calculateScormSize(e).then(function(t){return e.packagesize=t,t})).then(function(e){return n.domUtils.confirmDownloadSize({size:e,total:!0})})}})},e.prototype.convertAttemptToOffline=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.scormProvider.getScormUserData(e.id,t,void 0,!1,!1,n).then(function(r){return o.scormOfflineProvider.getScormUserData(e.id,t,void 0,n).catch(function(){}).then(function(i){var s=o.utils.clone(r),a=function(e){var t=s[e];if(o.elementsToIgnore.forEach(function(e){delete t.userdata[e]}),i&&i[t.scoid]&&i[t.scoid].userdata){var n={};for(var r in t.userdata)i[t.scoid].userdata[r]||(n[r]=t.userdata[r]);t.userdata=n}};for(var c in s)a(c);return o.scormOfflineProvider.createNewAttempt(e,t,s,r,n)})}).catch(function(){return Promise.reject(o.translate.instant("addon.mod_scorm.errorcreateofflineattempt"))})},e.prototype.createOfflineAttempt=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.searchOnlineAttemptUserData(e.id,n,o).then(function(n){for(var i in n){var s=n[i],a={};for(var c in s.userdata)-1==c.indexOf(".")&&-1==r.elementsToIgnore.indexOf(c)&&(a[c]=s.userdata[c]);s.userdata=a}return r.scormOfflineProvider.createNewAttempt(e,t,n,void 0,o)}).catch(function(){return Promise.reject(r.translate.instant("addon.mod_scorm.errorcreateofflineattempt"))})},e.prototype.determineAttemptToContinue=function(e,t,n){var o,r=this;if(t.online.length&&(o=Math.max.apply(Math,t.online)),o){var i=t.offline.indexOf(o)>-1;return this.scormProvider.isAttemptIncomplete(e.id,o,i,!1,n).then(function(n){return n?{number:o,offline:i}:r.getLastBeforeMax(e,t)})}return Promise.resolve(this.getLastBeforeMax(e,t))},e.prototype.getFirstSco=function(e,t,n,o,r,i){return(n&&n.length?Promise.resolve(n):this.scormProvider.getScosWithData(e,t,o,r,!1,i)).then(function(e){for(var t=0;t<e.length;t++){var n=e[t];if(n.isvisible&&n.prereq&&n.launch)return n}})},e.prototype.getLastBeforeMax=function(e,t){return 0!=e.maxattempt&&t.lastAttempt.number>e.maxattempt?{number:e.maxattempt,offline:t.offline.indexOf(e.maxattempt)>-1}:{number:t.lastAttempt.number,offline:t.lastAttempt.offline}},e.prototype.getNextScoFromToc=function(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t){for(var o=n+1;o<e.length;o++)if(e[o].isvisible&&e[o].prereq&&e[o].launch)return e[o];break}},e.prototype.getPreviousScoFromToc=function(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t){for(var o=n-1;o>=0;o--)if(e[o].isvisible&&e[o].prereq&&e[o].launch)return e[o];break}},e.prototype.getScoFromToc=function(e,t){for(var n=0;n<e.length;n++)if(e[n].id==t)return e[n]},e.prototype.searchOnlineAttemptUserData=function(e,t,n){var o=this;return n=n||this.sitesProvider.getCurrentSiteId(),this.scormProvider.getScormUserData(e,t,void 0,!1,!1,n).catch(function(){return t>0?o.searchOnlineAttemptUserData(e,t-1,n):Promise.reject(null)})},e=d([Object(o.A)(),l("design:paramtypes",[i.a,r.c,s.a,a.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(4),i=n(6),s=n(75),a=n(36),c=n(138),u=n(418),d=n(192),l=n(260),f=n(355),p=n(30),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},v=function(e){function t(t,n,o,r,i,s,a,u,d,f){var p=e.call(this,t,o)||this;return p.scormProvider=n,p.content=o,p.scormHelper=r,p.scormOffline=i,p.scormSync=s,p.prefetchHandler=a,p.navCtrl=u,p.prefetchDelegate=d,p.utils=f,p.component=c.a.COMPONENT,p.moduleName="scorm",p.currentOrganization={},p.scormOptions={mode:c.a.MODENORMAL,newAttempt:!1},p.modeNormal=c.a.MODENORMAL,p.modeBrowser=c.a.MODEBROWSE,p.fetchContentDefaultError="addon.mod_scorm.errorgetscorm",p.syncEventName=l.a.AUTO_SYNCED,p.hasPlayed=!1,p}return h(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent(!1,!0).then(function(){t.scorm&&t.scormProvider.logView(t.scorm.id).then(function(){t.checkCompletion()}).catch(function(e){})})},t.prototype.checkCompletion=function(){this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus)},t.prototype.downloadScormPackage=function(){var e=this;return this.downloading=!0,this.prefetchHandler.download(this.module,this.courseId,void 0,function(t){t&&(t.downloading?e.scorm.packagesize&&t.progress&&(e.percentage=(100*Number(t.progress.loaded/e.scorm.packagesize)).toFixed(1)):t.message?(e.progressMessage=t.message,e.percentage=void 0):e.percentage=t.progress&&t.progress.loaded&&t.progress.total?(100*Number(t.progress.loaded/t.progress.total)).toFixed(1):void 0)}).finally(function(){e.progressMessage=void 0,e.percentage=void 0,e.downloading=!1})},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.scormProvider.getScorm(this.courseId,this.module.id,this.module.url).then(function(e){o.scorm=e,o.dataRetrieved.emit(o.scorm),o.description=o.scorm.intro||o.description;var r=o.scormProvider.isScormUnsupported(o.scorm);if(o.errorMessage=r||"",!o.scorm.warningMessage){return(t?o.syncActivity(n).catch(function(){}):Promise.resolve()).catch(function(){}).then(function(){return o.scormSync.getReadableSyncTime(o.scorm.id).then(function(e){o.syncTime=e}),o.scormProvider.getAttemptCount(o.scorm.id)}).then(function(e){return o.attempts=e,o.hasOffline=!!o.attempts.offline.length,o.scormHelper.determineAttemptToContinue(o.scorm,o.attempts)}).then(function(e){return o.lastAttempt=e.number,o.lastIsOffline=e.offline,o.attemptToContinue=o.lastAttempt!=o.attempts.lastAttempt.number?o.lastAttempt:void 0,o.scormProvider.isAttemptIncomplete(o.scorm.id,o.lastAttempt,o.lastIsOffline)}).then(function(e){var t=[];return o.scorm.incomplete=e,o.scorm.numAttempts=o.attempts.total,o.scorm.gradeMethodReadable=o.scormProvider.getScormGradeMethod(o.scorm),o.scorm.attemptsLeft=o.scormProvider.countAttemptsLeft(o.scorm,o.attempts.lastAttempt.number),o.scorm.forceattempt&&o.scorm.incomplete&&(o.scormOptions.newAttempt=!0),t.push(o.getReportedGrades()),t.push(o.fetchStructure()),o.scorm.packagesize||""!==o.errorMessage||t.push(o.scormProvider.calculateScormSize(o.scorm).then(function(e){o.scorm.packagesize=e})),o.setStatusListener(),Promise.all(t)})}}).then(function(){o.fillContextMenu(e)})},t.prototype.fetchStructure=function(){var e=this;return this.scormProvider.getOrganizations(this.scorm.id).then(function(t){return e.organizations=t,e.currentOrganization.identifier||(e.currentOrganization.identifier=t.length?t[0].identifier:""),e.loadOrganizationToc(e.currentOrganization.identifier)})},t.prototype.getAttemptGrade=function(e,t,n){return this.scormProvider.getAttemptGrade(this.scorm,e,t).then(function(t){n[e]={number:e,grade:t}})},t.prototype.getReportedGrades=function(){var e=this,t=[],n={},o={};return this.attempts.online.forEach(function(o){-1==e.attempts.offline.indexOf(o)&&t.push(e.getAttemptGrade(o,!1,n))}),this.attempts.offline.forEach(function(n){t.push(e.getAttemptGrade(n,!0,o))}),Promise.all(t).then(function(){e.scorm.grade=e.scormProvider.calculateScormGrade(e.scorm,n),e.scorm.onlineAttempts=e.utils.objectToArray(n),e.scorm.offlineAttempts=e.utils.objectToArray(o),e.scorm.onlineAttempts.sort(function(e,t){return e.number-t.number}),e.scorm.offlineAttempts.sort(function(e,t){return e.number-t.number}),e.scorm.onlineAttempts.forEach(function(t){t.grade=e.scormProvider.formatGrade(e.scorm,t.grade)}),e.scorm.offlineAttempts.forEach(function(t){t.grade=e.scormProvider.formatGrade(e.scorm,t.grade)}),e.scorm.grade=e.scormProvider.formatGrade(e.scorm,e.scorm.grade)})},t.prototype.hasSyncSucceed=function(e){return e.updated&&this.checkCompletion(),!0},t.prototype.ionViewDidEnter=function(){var t=this;e.prototype.ionViewDidEnter.call(this),this.hasPlayed&&(this.hasPlayed=!1,this.scormOptions.newAttempt=!1,setTimeout(function(){t.showLoadingAndRefresh(!0,!1)},500))},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),"AddonModScormPlayerPage"==this.navCtrl.getActive().component.name&&(this.hasPlayed=!0)},t.prototype.invalidateContent=function(){var e=[];return e.push(this.scormProvider.invalidateScormData(this.courseId)),this.scorm&&e.push(this.scormProvider.invalidateAllScormData(this.scorm.id)),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!e.updated||!this.scorm||e.scormId!=this.scorm.id)&&(this.checkCompletion(),!0)},t.prototype.loadOrganization=function(){var e=this;this.loadOrganizationToc(this.currentOrganization.identifier).catch(function(t){e.domUtils.showErrorModalDefault(t,e.fetchContentDefaultError,!0)})},t.prototype.loadOrganizationToc=function(e){var t=this;return this.scorm.displaycoursestructure?(this.loadingToc=!0,this.scormProvider.getOrganizationToc(this.scorm.id,this.lastAttempt,e,this.lastIsOffline).then(function(n){t.toc=t.scormProvider.formatTocToArray(n),t.toc.forEach(function(e){e.image=t.scormProvider.getScoStatusIcon(e,t.scorm.incomplete)}),t.organizations.forEach(function(n){n.identifier==e&&(t.currentOrganization.title=n.title)})}).finally(function(){t.loadingToc=!1})):Promise.resolve()},t.prototype.open=function(e,t){var n=this;if(e.preventDefault(),e.stopPropagation(),!this.downloading){var o=this.currentStatus==p.a.OUTDATED;o||this.currentStatus==p.a.NOT_DOWNLOADED?this.scormHelper.confirmDownload(this.scorm,o).then(function(){(o?n.scormProvider.invalidateAllScormData(n.scorm.id):Promise.resolve()).finally(function(){n.downloadScormPackage().then(function(){n.isDestroyed||n.openScorm(t)}).catch(function(e){n.isDestroyed||n.domUtils.showErrorModalDefault(e,n.translate.instant("addon.mod_scorm.errordownloadscorm",{name:n.scorm.name}))})})}):this.openScorm(t)}},t.prototype.openScorm=function(e){this.navCtrl.push("AddonModScormPlayerPage",{scorm:this.scorm,mode:this.scormOptions.mode,newAttempt:!!this.scormOptions.newAttempt,organizationId:this.currentOrganization.identifier,scoId:e})},t.prototype.showStatus=function(e,t){var n=this;e==p.a.OUTDATED&&this.scorm?this.scormProvider.shouldDownloadMainFile(this.scorm,!0).then(function(e){n.statusMessage=e?"addon.mod_scorm.scormstatusoutdated":""}):e==p.a.NOT_DOWNLOADED?this.statusMessage="addon.mod_scorm.scormstatusnotdownloaded":e==p.a.DOWNLOADING?this.downloading||this.downloadScormPackage():this.statusMessage=""},t.prototype.sync=function(){return this.scormSync.syncScorm(this.scorm)},t=m([Object(o.m)({selector:"addon-mod-scorm-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    \x3c!-- Warning message. --\x3e\n    <div *ngIf="scorm && scorm.warningMessage" class="core-info-card" icon-start>\n        <ion-icon name="information-circle"></ion-icon>\n        {{ scorm.warningMessage }}\n    </div>\n\n    <div *ngIf="scorm && loaded && !scorm.warningMessage">\n        \x3c!-- Attempts status. --\x3e\n        <ion-card *ngIf="scorm.displayattemptstatus || Object.keys(scorm.offlineAttempts).length">\n            <ion-card-header text-wrap>\n                <h2>{{ \'addon.mod_scorm.attempts\' | translate }}</h2>\n            </ion-card-header>\n            <ion-list>\n                <ng-container *ngIf="scorm.displayattemptstatus">\n                    <ion-item text-wrap *ngIf="scorm.maxattempt >= 0">\n                        <p class="item-heading">{{ \'addon.mod_scorm.noattemptsallowed\' | translate }}</p>\n                        <p *ngIf="scorm.maxattempt == 0">{{ \'core.unlimited\' | translate }}</p>\n                        <p *ngIf="scorm.maxattempt > 0">{{ scorm.maxattempt }}</p>\n                    </ion-item>\n                    <ion-item text-wrap *ngIf="scorm.numAttempts >= 0">\n                        <p class="item-heading">{{ \'addon.mod_scorm.noattemptsmade\' | translate }}</p>\n                        <p>{{ scorm.numAttempts }}</p>\n                    </ion-item>\n                    <ion-item text-wrap *ngFor="let attempt of scorm.onlineAttempts">\n                        <p class="item-heading">{{ \'addon.mod_scorm.gradeforattempt\' | translate }} {{attempt.number}}</p>\n                        <p *ngIf="attempt.grade != -1">{{ attempt.grade }}</p>\n                        <p *ngIf="attempt.grade == -1">{{ \'addon.mod_scorm.cannotcalculategrade\' | translate }}</p>\n                    </ion-item>\n                </ng-container>\n                <ion-item text-wrap *ngFor="let attempt of scorm.offlineAttempts">\n                    <p class="item-heading">{{ \'addon.mod_scorm.gradeforattempt\' | translate }} {{attempt.number}}</p>\n                    <p *ngIf="attempt.grade != -1">{{ attempt.grade }}</p>\n                    <p *ngIf="attempt.grade == -1">{{ \'addon.mod_scorm.cannotcalculategrade\' | translate }}</p>\n                    <p *ngIf="scorm.maxattempt == 0 || attempt.number <= scorm.maxattempt">{{ \'addon.mod_scorm.offlineattemptnote\' | translate }}</p>\n                    <p *ngIf="scorm.maxattempt != 0 && attempt.number > scorm.maxattempt">{{ \'addon.mod_scorm.offlineattemptovermax\' | translate }}</p>\n                </ion-item>\n                <ion-item text-wrap *ngIf="scorm.displayattemptstatus && scorm.gradeMethodReadable">\n                    <p class="item-heading">{{ \'addon.mod_scorm.grademethod\' | translate }}</p>\n                    <p>{{ scorm.gradeMethodReadable }}</p>\n                </ion-item>\n                <ion-item text-wrap *ngIf="scorm.displayattemptstatus && scorm.grade">\n                    <p class="item-heading">{{ \'addon.mod_scorm.gradereported\' | translate }}</p>\n                    <p *ngIf="scorm.grade != -1">{{ scorm.grade }}</p>\n                    <p *ngIf="scorm.grade == -1">{{ \'addon.mod_scorm.cannotcalculategrade\' | translate }}</p>\n                </ion-item>\n                <ion-item text-wrap *ngIf="syncTime">\n                    <p class="item-heading">{{ \'core.lastsync\' | translate }}</p>\n                    <p>{{ syncTime }}</p>\n                </ion-item>\n            </ion-list>\n        </ion-card>\n\n        \x3c!-- Synchronization warning. --\x3e\n        <div class="core-warning-card" icon-start *ngIf="!errorMessage && hasOffline">\n            <ion-icon name="warning"></ion-icon>\n            {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n        </div>\n\n        \x3c!-- TOC. --\x3e\n        <ion-card *ngIf="scorm && organizations && ((scorm.displaycoursestructure && organizations.length) || organizations.length > 1)" class="addon-mod_scorm-toc">\n            <ion-card-header text-wrap>\n                <h2>{{ \'addon.mod_scorm.contents\' | translate }}</h2>\n            </ion-card-header>\n            <ion-list>\n                <ion-item text-wrap *ngIf="organizations.length > 1">\n                    <ion-label>{{ \'addon.mod_scorm.organizations\' | translate }}</ion-label>\n                    <ion-select [(ngModel)]="currentOrganization.identifier" (ionChange)="loadOrganization()" interface="popover">\n                        <ion-option *ngFor="let org of organizations" [value]="org.identifier">{{ org.title }}</ion-option>\n                    </ion-select>\n                </ion-item>\n                <ion-item text-center *ngIf="scorm.displaycoursestructure && loadingToc">\n                    <ion-spinner></ion-spinner>\n                </ion-item>\n                <ion-item text-wrap *ngIf="scorm.displaycoursestructure && !loadingToc">\n                    \x3c!-- If data shown doesn\'t belong to last attempt, show a warning. --\x3e\n                    <p *ngIf="attemptToContinue">{{ \'addon.mod_scorm.dataattemptshown\' | translate:{number: attemptToContinue} }}</p>\n                    <p>{{ currentOrganization.title }}</p>\n                    <div *ngFor="let sco of toc" class="core-padding-{{sco.level}}">\n                        <p *ngIf="sco.isvisible">\n                            <img [src]="sco.image.url" [alt]="sco.image.description" />\n                            <a *ngIf="sco.prereq && sco.launch" (click)="open($event, sco.id)">{{ sco.title }}</a>\n                            <span *ngIf="!sco.prereq || !sco.launch">{{ sco.title }}</span>\n                        </p>\n                    </div>\n                </ion-item>\n            </ion-list>\n        </ion-card>\n\n        \x3c!-- Open in browser button. --\x3e\n        <ion-card *ngIf="errorMessage">\n            <ion-item text-wrap>\n                <p class="text-danger">{{ errorMessage | translate }}</p>\n            </ion-item>\n            <ion-item text-wrap>\n                <a ion-button block icon-end [href]="externalUrl" core-link>\n                    {{ \'core.openinbrowser\' | translate }}\n                    <ion-icon name="open"></ion-icon>\n                </a>\n            </ion-item>\n        </ion-card>\n\n        \x3c!-- Warning that user doesn\'t have any more attempts. --\x3e\n        <ion-card *ngIf="!errorMessage && scorm && scorm.attemptsLeft <= 0">\n            <ion-item text-wrap>\n                <p class="text-danger">{{ \'addon.mod_scorm.exceededmaxattempts\' | translate }}</p>\n            </ion-item>\n        </ion-card>\n\n        \x3c!-- Open SCORM in app form --\x3e\n        <ion-card *ngIf="!errorMessage && scorm && (!scorm.lastattemptlock || scorm.attemptsLeft > 0)">\n            <ion-list>\n                \x3c!-- Open mode (Preview or Normal) --\x3e\n                <div *ngIf="!scorm.hidebrowse" radio-group [(ngModel)]="scormOptions.mode" name="mode">\n                    <ion-item>\n                        <p class="item-heading">{{ \'addon.mod_scorm.mode\' | translate }}</p>\n                    </ion-item>\n                    <ion-item>\n                        <ion-label>{{ \'addon.mod_scorm.browse\' | translate }}</ion-label>\n                        <ion-radio [value]="modeBrowser"></ion-radio>\n                    </ion-item>\n                    <ion-item>\n                        <ion-label>{{ \'addon.mod_scorm.normal\' | translate }}</ion-label>\n                        <ion-radio [value]="modeNormal"></ion-radio>\n                    </ion-item>\n                </div>\n\n                \x3c!-- Create new attempt --\x3e\n                <ion-item text-wrap *ngIf="!scorm.forcenewattempt && scorm.numAttempts > 0 && !scorm.incomplete && scorm.attemptsLeft > 0">\n                    <ion-label>{{ \'addon.mod_scorm.newattempt\' | translate }}</ion-label>\n                    <ion-checkbox item-end name="newAttempt" [(ngModel)]="scormOptions.newAttempt">\n                    </ion-checkbox>\n                </ion-item>\n\n                \x3c!-- Button to open the SCORM. --\x3e\n                <ng-container *ngIf="!downloading">\n                    <ion-item text-wrap *ngIf="statusMessage">\n                        <p >{{ statusMessage | translate }}</p>\n                    </ion-item>\n                    <ion-item text-wrap>\n                        <a ion-button block (click)="open($event)">{{ \'addon.mod_scorm.enter\' | translate }}</a>\n                    </ion-item>\n                </ng-container>\n\n                \x3c!-- Download progress. --\x3e\n                <ion-item text-center *ngIf="downloading">\n                    <ion-spinner></ion-spinner>\n                    <p *ngIf="progressMessage">{{ progressMessage | translate }}</p>\n                    <p *ngIf="percentage <= 100">{{ \'core.percentagenumber\' | translate:{$a: percentage} }}</p>\n                </ion-item>\n            </ion-list>\n        </ion-card>\n    </div>\n</core-loading>\n'}),y(2,Object(o.N)()),g("design:paramtypes",[o.C,c.a,r.f,u.a,d.a,l.a,f.a,r.q,a.a,i.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(75),s=n(239),a=n(356),c=n(240),u=n(357),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},h=function(e){function t(t,n,o,r,i,a){var c=e.call(this,t,o)||this;return c.surveyProvider=n,c.surveyHelper=r,c.surveyOffline=i,c.surveySync=a,c.component=s.a.COMPONENT,c.moduleName="survey",c.answers={},c.syncEventName=u.a.AUTO_SYNCED,c}return d(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.userId=this.sitesProvider.getCurrentSiteUserId(),this.loadContent(!1,!0).then(function(){t.surveyProvider.logView(t.survey.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.surveyProvider.invalidateSurveyData(this.courseId)),this.survey&&e.push(this.surveyProvider.invalidateQuestions(this.survey.id)),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.survey||e.surveyId!=this.survey.id||e.userId!=this.userId)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.surveyProvider.getSurvey(this.courseId,this.module.id).then(function(e){if(o.survey=e,o.description=e.intro||e.description,o.dataRetrieved.emit(e),t)return o.syncActivity(n).then(function(e){if(e)return o.surveyProvider.getSurvey(o.courseId,o.module.id).then(function(e){o.survey=e})})}).then(function(){return o.surveyOffline.hasAnswers(o.survey.id)}).then(function(e){if(o.hasOffline=!o.survey.surveydone&&e,!o.survey.surveydone&&!o.hasOffline)return o.fetchQuestions()}).then(function(){o.fillContextMenu(e)})},t.prototype.fetchQuestions=function(){var e=this;return this.surveyProvider.getQuestions(this.survey.id).then(function(t){e.questions=e.surveyHelper.formatQuestions(t),e.questions.forEach(function(t){if(t.name){e.answers[t.name]=t.required?-1:t.multi&&0===t.multi.length&&0===t.type?"":"0"}t.multi&&!t.multi.length&&0===t.parent&&t.type>0&&(t.options=t.options.map(function(t){return e.textUtils.cleanTags(t)}))})})},t.prototype.isValidResponse=function(){for(var e in this.answers)if(-1===this.answers[e])return!1;return!0},t.prototype.submit=function(){var e=this;this.domUtils.showConfirm(this.translate.instant("core.areyousure")).then(function(){var t=[],n=e.domUtils.showModalLoading("core.sending",!0);for(var o in e.answers)t.push({key:o,value:e.answers[o]});return e.surveyProvider.submitAnswers(e.survey.id,e.survey.name,e.courseId,t).then(function(){return e.showLoadingAndRefresh(!1)}).finally(function(){n.dismiss()})}).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_survey.cannotsubmitsurvey",!0)})},t.prototype.sync=function(){return this.surveySync.syncSurvey(this.survey.id,this.userId)},t.prototype.hasSyncSucceed=function(e){return e.answersSent},t=l([Object(o.m)({selector:"addon-mod-survey-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    \x3c!-- Survey already done --\x3e\n    <ion-card padding *ngIf="survey && survey.surveydone">\n        <p padding>{{ \'addon.mod_survey.surveycompletednograph\' | translate }}</p>\n        <a ion-button block icon-start [href]="externalUrl" core-link>\n            <ion-icon name="open" start></ion-icon>\n            {{ \'addon.mod_survey.results\' | translate }}\n        </a>\n    </ion-card>\n\n    \x3c!-- Survey done in offline but not synchronized --\x3e\n    <div class="core-warning-card" icon-start *ngIf="hasOffline">\n        <ion-icon name="warning"></ion-icon>\n        {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n    </div>\n\n    \x3c!-- Survey questions --\x3e\n    <section *ngIf="survey && !survey.surveydone && !hasOffline && questions && questions.length">\n\n        <ng-container *ngFor="let question of questions; let index=index; let isEven=even;">\n            \x3c!-- Parent question (Category header) --\x3e\n            <div *ngIf="question.multi && question.multi.length" [attr.padding-top]="index == 1">\n                <h3 padding-horizontal>{{ question.text }}</h3>\n                <ion-grid no-padding>\n                    <ion-row no-padding align-items-center class="hidden-phone">\n                        <ion-col col-7>\n                            <div padding>{{ \'addon.mod_survey.responses\' | translate }}</div>\n                        </ion-col>\n                        <ion-col text-center *ngFor="let option of question.options">\n                            <div padding>{{ option }}</div>\n                        </ion-col>\n                    </ion-row>\n                </ion-grid>\n                <ion-item text-wrap [class.even]="isEven" class="addon-mod_survey-question">\n                    <p>{{ question.intro }}</p>\n                </ion-item>\n            </div>\n\n            \x3c!-- Subquestion --\x3e\n            <ion-grid no-padding *ngIf="question.parent !== 0" text-wrap [class.even]="isEven">\n                <ion-row no-padding nowrap align-items-center radio-group [(ngModel)]="answers[question.name]" [required]="question.required">\n                    <ion-col col-7>\n                        <ion-label padding-horizontal [core-mark-required]="question.required" id="addon-mod_survey-{{question.name}}"><strong>{{question.num}}.</strong> {{ question.text }}</ion-label>\n                    </ion-col>\n\n                    \x3c!-- Tablet view: radio buttons --\x3e\n                    <ion-col class="hidden-phone" text-center *ngFor="let option of question.options; let value=index;">\n                        <ion-radio [value]="value + 1" [attr.aria-labelledby]="\'addon-mod_survey-\'+question.name"></ion-radio>\n                    </ion-col>\n                    <ion-col class="hidden-tablet">\n                        <ion-select padding [(ngModel)]="answers[question.name]" [attr.aria-labelledby]="\'addon-mod_survey-\'+question.name" interface="popover" [required]="question.required">\n                            <ion-option value="-1" selected disabled>{{ \'core.choose\' | translate }}</ion-option>\n                            <ion-option *ngFor="let option of question.options; let value=index;" [value]="value +1">{{option}}</ion-option>\n                        </ion-select>\n                    </ion-col>\n                </ion-row>\n            </ion-grid>\n\n            \x3c!-- Single question (don\'t belong to a category) --\x3e\n            <ng-container *ngIf="(!question.multi || question.multi.length == 0) && question.parent === 0">\n                <ion-grid no-padding text-wrap *ngIf="question.type > 0" [class.even]="isEven">\n                    <ion-row no-padding align-items-center>\n                        <ion-col col-7>\n                            <ion-label [core-mark-required]="question.required" padding-horizontal id="addon-mod_survey-{{question.name}}"><strong>{{question.num}}.</strong> {{ question.text }}</ion-label>\n                        </ion-col>\n                        <ion-col col-5>\n                            <ion-select padding [(ngModel)]="answers[question.name]" [attr.aria-labelledby]="\'addon-mod_survey-\'+question.name" interface="popover" [required]="question.required">\n                            <ion-option *ngFor="let option of question.options; let value=index;" [value]="value">{{option}}</ion-option>\n                        </ion-select>\n                        </ion-col>\n                    </ion-row>\n                </ion-grid>\n\n                <ion-item *ngIf="question.type === 0" text-wrap [class.even]="isEven">\n                    <ion-label stacked [core-mark-required]="question.required" id="addon-mod_survey-{{question.name}}">\n                        <strong>{{question.num}}.</strong> {{ question.text }}\n                    </ion-label>\n                    <ion-textarea [(ngModel)]="answers[question.name]" class="addon-mod_survey-textarea" [attr.aria-label]="question.text" [required]="question.required"></ion-textarea>\n                </ion-item>\n            </ng-container>\n\n        </ng-container>\n\n        <ion-item>\n            <button ion-button block (click)="submit()" [disabled]="!isValidResponse()">{{ \'core.submit\' | translate }}</button>\n        </ion-item>\n    </section>\n\n</core-loading>\n'}),p(2,Object(o.N)()),f("design:paramtypes",[o.C,s.a,r.f,a.a,c.a,u.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(10),i=n(145),s=n(358),a=n(359),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o,r){var i=e.call(this,t)||this;return i.urlProvider=n,i.courseProvider=o,i.urlHelper=r,i.component=s.a.COMPONENT,i}return c(t,e),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.canGetUrl=this.urlProvider.isGetUrlWSAvailable(),this.loadContent()},t.prototype.invalidateContent=function(){return this.urlProvider.invalidateContent(this.module.id,this.courseId)},t.prototype.fetchContent=function(e){var t=this,n=this.canGetUrl;return(n?this.urlProvider.getUrl(this.courseId,this.module.id):Promise.reject(null)).catch(function(){return n=!1,t.courseProvider.getModule(t.module.id,t.courseId)}).then(function(e){if(!n&&!e.contents.length)return Promise.reject(null);t.description=e.intro||e.description,t.dataRetrieved.emit(e),t.url=n?e.externalurl:e.contents[0]&&e.contents[0].fileurl?e.contents[0].fileurl:void 0})},t.prototype.go=function(){var e=this;this.urlProvider.logView(this.module.instance).then(function(){e.courseProvider.checkModuleCompletion(e.courseId,e.module.completionstatus)}),this.urlHelper.open(this.url)},t=u([Object(o.m)({selector:"addon-mod-url-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n\x3c!-- <core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description *ngIf="mode != \'iframe\'" [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ion-item text-wrap>\n        <h2>{{ \'addon.mod_url.pointingtourl\' | translate }}</h2>\n        <p>{{ url }}</p>\n    </ion-item>\n    <div padding>\n        <a ion-button block (click)="go()" icon-start>\n            <ion-icon name="link" start></ion-icon>\n            {{ \'addon.mod_url.accessurl\' | translate }}\n        </a>\n    </div>\n</core-loading> --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n<core-iframe [src]="url" >\n    \n</core-iframe>\n</core-loading>\n'}),d("design:paramtypes",[o.C,s.a,r.a,a.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(4),i=n(46),s=n(6),a=n(75),c=n(26),u=n(151),d=n(201),l=n(261),f=n(135),p=n(837),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},v=function(e){function t(t,n,o,r,i,s,a,c,d,f){var p=e.call(this,t,o)||this;return p.wikiProvider=n,p.content=o,p.wikiOffline=r,p.wikiSync=i,p.navCtrl=s,p.utils=a,p.groupsProvider=c,p.userProvider=d,p.popoverCtrl=f,p.component=u.a.COMPONENT,p.moduleName="wiki",p.canEdit=!1,p.pageStr="",p.loadedSubwikis=[],p.selectedTab=0,p.map=[],p.subwikiData={subwikiSelected:0,userSelected:0,groupSelected:0,subwikis:[],count:0},p.syncEventName=l.a.AUTO_SYNCED,p.hasEdited=!1,p.mapInitialized=!1,p.initHomeButton=!0,p.pageStr=p.translate.instant("addon.mod_wiki.page"),p}return h(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.currentUserId=this.sitesProvider.getCurrentSiteUserId(),this.isMainPage=!this.pageId&&!this.pageTitle,this.currentPage=this.pageId,this.selectedTab="map"==this.action?1:0,this.loadContent(!1,!0).then(function(){t.wiki&&(t.isMainPage?t.wikiProvider.logView(t.wiki.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){}):t.wikiProvider.logPageView(t.pageId).catch(function(){}))}),this.manualSyncObserver=this.eventsProvider.on(l.a.MANUAL_SYNCED,function(e){if(e&&t.wiki&&e.wikiId==t.wiki.id){if(t.ignoreManualSyncEvent)return void(t.ignoreManualSyncEvent=!1);t.currentSubwiki&&t.checkPageCreatedOrDiscarded(e.subwikis[t.currentSubwiki.id]),t.pageWarning||t.showLoadingAndFetch(!1,!1)}},this.siteId)},t.prototype.checkPageCreatedOrDiscarded=function(e){if(!this.currentPage&&e){for(var t=void 0,n=0,o=e.created.length;n<o;n++){if((r=e.created[n]).title==this.pageTitle){t=r.pageId;break}}if(t)this.currentPage=t,this.pageIsOffline=!1;else for(n=0,o=e.discarded.length;n<o;n++){var r;(r=e.discarded[n]).title==this.pageTitle&&(this.pageWarning=r.warning,this.pageContent="",this.pageIsOffline=!1,this.hasOffline=!1)}}},t.prototype.constructMap=function(e){var t,n,o=this;this.map=[],this.mapInitialized=!0,e.sort(function(e,t){var n=e.title.toLowerCase().trim(),o=t.title.toLowerCase().trim();return n.localeCompare(o)}),e.forEach(function(e){var r=e.title.charAt(0).toLocaleUpperCase();r!==n&&(n=r,o.map.push(t={label:r,pages:[]})),t.pages.push(e)})},t.prototype.fetchContent=function(e,t,n){var o=this;void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1);return(this.module.id?this.wikiProvider.getWiki(this.courseId,this.module.id):this.wikiProvider.getWikiById(this.courseId,this.wikiId)).then(function(e){if(o.wiki=e,o.dataRetrieved.emit(o.wiki),t)return o.syncActivity(n).catch(function(){})}).then(function(){if(o.pageWarning)return Promise.reject(null);(o.isCurrentView||o.initHomeButton)&&(o.initHomeButton=!1,o.showHomeButton=!!o.getWikiHomeView());return(o.module.id?Promise.resolve(o.module):o.courseProvider.getModule(o.wiki.coursemodule,o.wiki.course,void 0,!0)).then(function(e){return o.module=e,o.description=o.wiki.intro||o.module.description,o.externalUrl=o.module.url,o.componentId=o.module.id,o.groupsProvider.getActivityGroupMode(o.wiki.coursemodule).then(function(e){return(e===i.a.SEPARATEGROUPS||e===i.a.VISIBLEGROUPS?o.groupsProvider.getActivityAllowedGroups(o.wiki.coursemodule):Promise.resolve([])).then(function(e){return o.fetchSubwikis(o.wiki.id).then(function(){var t=o.wikiProvider.getSubwikiList(o.wiki.id);if(!t)return o.createSubwikiList(e);o.subwikiData.count=t.count,o.setSelectedWiki(o.subwikiId,o.userId,o.groupId),o.isAnySubwikiSelected()||o.setSelectedWiki(t.subwikiSelected,t.userSelected,t.groupSelected),o.subwikiData.subwikis=t.subwikis})}).then(function(){if(!o.isAnySubwikiSelected()||o.subwikiData.count<=0)return Promise.reject(o.translate.instant("addon.mod_wiki.errornowikiavailable"))}).then(function(){return o.fetchWikiPage()})})})}).then(function(){o.fillContextMenu(e)}).catch(function(e){if(!o.pageWarning)return Promise.reject(e)})},t.prototype.fetchPageContents=function(e){var t=this;if(!e){var n=this.pageTitle||this.wiki.firstpagetitle;return this.wikiOffline.getNewPage(n,this.currentSubwiki.id,this.currentSubwiki.wikiid,this.currentSubwiki.userid,this.currentSubwiki.groupid).then(function(e){return t.pageIsOffline=!0,t.newPageObserver||(t.newPageObserver=t.eventsProvider.on(u.a.PAGE_CREATED_EVENT,function(e){e.subwikiId==t.currentSubwiki.id&&e.pageTitle==n&&(t.currentPage=e.pageId,t.showLoadingAndFetch(!0,!1).then(function(){t.wikiProvider.logPageView(t.currentPage)}),t.newPageObserver.off(),t.newPageObserver=void 0)},t.sitesProvider.getCurrentSiteId())),e}).catch(function(){})}return this.pageIsOffline=!1,this.wikiProvider.getPageContents(e)},t.prototype.fetchSubwikiPages=function(e){var t,n=this;return this.wikiProvider.getSubwikiPages(e.wikiid,e.groupid,e.userid).then(function(o){if(t=o,!n.currentPage&&!n.pageTitle)for(var r in t){var i=t[r];if(i.firstpage){n.currentPage=i.id;break}}return n.wikiOffline.getSubwikiNewPages(e.id,e.wikiid,e.userid,e.groupid)}).then(function(e){if(!n.currentPage){var o=n.pageTitle?n.pageTitle:n.wiki.firstpagetitle;e.some(function(e){return e.title==o})&&(n.pageTitle=o)}if(n.subwikiPages=n.wikiProvider.sortPagesByTitle(t.concat(e)),n.constructMap(n.subwikiPages),!n.currentPage&&!n.pageTitle&&n.subwikiPages.length>0)return Promise.reject(null)})},t.prototype.fetchSubwikis=function(e){var t=this;return this.wikiProvider.getSubwikis(e).then(function(e){return t.loadedSubwikis=e,t.wikiOffline.subwikisHaveOfflineData(e).then(function(e){t.hasOffline=e})})},t.prototype.fetchWikiPage=function(){var e=this;return this.currentSubwiki=this.loadedSubwikis.find(function(t){return e.isSubwikiSelected(t)}),this.currentSubwiki?(this.setSelectedWiki(this.currentSubwiki.id,this.currentSubwiki.userid,this.currentSubwiki.groupid),this.fetchSubwikiPages(this.currentSubwiki).then(function(){return e.canEdit=e.currentSubwiki.canedit,e.fetchPageContents(e.currentPage).then(function(t){t&&(e.dataRetrieved.emit(t.title),e.setSelectedWiki(t.subwikiid,t.userid,t.groupid),e.pageContent=e.replaceEditLinks(t.cachedcontent),e.canEdit=t.caneditpage,e.currentPageObj=t)})})):Promise.reject(null)},t.prototype.getWikiHomeView=function(){if(this.wiki.id)for(var e=this.navCtrl.getViews(),t=e.length-2;t>=0;t--){var n=e[t];if("AddonModWikiIndexPage"!=n.component.name){if(t==e.length-2)return;return e[t+1]}var o=n.data.wikiId?n.data.wikiId:n.data.module.instance;if(!o||o!=this.wiki.id)return e[t+1]}},t.prototype.goToWikiHome=function(){var e=this.getWikiHomeView();e&&this.navCtrl.popTo(e)},t.prototype.goToCreateFirstPage=function(){this.navCtrl.push("AddonModWikiEditPage",{module:this.module,courseId:this.courseId,pageTitle:this.wiki.firstpagetitle,wikiId:this.currentSubwiki.wikiid,userId:this.currentSubwiki.userid,groupId:this.currentSubwiki.groupid})},t.prototype.goToEditPage=function(){if(this.canEdit)if(this.currentPageObj){var e={module:this.module,courseId:this.courseId,pageId:this.currentPageObj.id,pageTitle:this.currentPageObj.title,subwikiId:this.currentPageObj.subwikiid};this.currentSubwiki&&(e.wikiId=this.currentSubwiki.wikiid,e.userId=this.currentSubwiki.userid,e.groupId=this.currentSubwiki.groupid),this.navCtrl.push("AddonModWikiEditPage",e)}else this.currentSubwiki&&this.goToCreateFirstPage()},t.prototype.goToNewPage=function(){if(this.canEdit)if(this.currentPageObj){var e={module:this.module,courseId:this.courseId,subwikiId:this.currentPageObj.subwikiid};this.currentSubwiki&&(e.wikiId=this.currentSubwiki.wikiid,e.userId=this.currentSubwiki.userid,e.groupId=this.currentSubwiki.groupid),this.navCtrl.push("AddonModWikiEditPage",e)}else this.currentSubwiki&&this.goToCreateFirstPage()},t.prototype.goToPage=function(e){var t=this;if(e.id){if(this.currentPage!=e.id)return void this.fetchPageContents(e.id).then(function(e){t.navCtrl.push("AddonModWikiIndexPage",{module:t.module,courseId:t.courseId,pageTitle:e.title,pageId:e.id,wikiId:e.wikiid,subwikiId:e.subwikiid,action:"page"})})}else if(this.currentPage||!this.pageTitle||e.title!=this.pageTitle)return void this.navCtrl.push("AddonModWikiIndexPage",{module:this.module,courseId:this.courseId,pageTitle:e.title,wikiId:this.wiki.id,subwikiId:e.subwikiid,action:"page"});this.tabs.selectTab(0)},t.prototype.goToSubwiki=function(e,t,n,o){(e>0||o)&&(e==this.currentSubwiki.id&&t==this.currentSubwiki.userid&&n==this.currentSubwiki.groupid||this.navCtrl.push("AddonModWikiIndexPage",{module:this.module,courseId:this.courseId,wikiId:this.wiki.id,subwikiId:e,userId:t,groupId:n,action:0==this.tabs.selected?"page":"map"}))},t.prototype.isAnySubwikiSelected=function(){return this.subwikiData.subwikiSelected>0||this.subwikiData.userSelected>0||this.subwikiData.groupSelected>0},t.prototype.isSubwikiSelected=function(e){var t=parseInt(e.id,10)||0;if(t>0&&this.subwikiData.subwikiSelected>0)return t==this.subwikiData.subwikiSelected;var n=parseInt(e.userid,10)||0,o=parseInt(e.groupid,10)||0;return n==this.subwikiData.userSelected&&o==this.subwikiData.groupSelected},t.prototype.replaceEditLinks=function(e){if((e=e.trim()).length>0){var t=this.textUtils.concatenatePaths(this.sitesProvider.getCurrentSite().getURL(),"/mod/wiki/edit.php");e=e.replace(/href="edit\.php/g,'href="'+t)}return e},t.prototype.setSelectedWiki=function(e,t,n){this.subwikiData.subwikiSelected=this.wikiOffline.convertToPositiveNumber(e),this.subwikiData.userSelected=this.wikiOffline.convertToPositiveNumber(t),this.subwikiData.groupSelected=this.wikiOffline.convertToPositiveNumber(n)},t.prototype.hasSyncSucceed=function(e){return e.wikiId=this.wiki.id,e.updated&&(this.ignoreManualSyncEvent=!0,this.eventsProvider.trigger(l.a.MANUAL_SYNCED,e)),this.currentSubwiki&&this.checkPageCreatedOrDiscarded(e.subwikis[this.currentSubwiki.id]),e.updated},t.prototype.ionViewDidEnter=function(){e.prototype.ionViewDidEnter.call(this),this.tabs&&this.tabs.ionViewDidEnter(),this.hasEdited&&(this.hasEdited=!1,this.showLoadingAndRefresh(!0,!1))},t.prototype.ionViewDidLeave=function(){e.prototype.ionViewDidLeave.call(this),this.tabs&&this.tabs.ionViewDidLeave(),"AddonModWikiEditPage"==this.navCtrl.getActive().component.name&&(this.hasEdited=!0)},t.prototype.invalidateContent=function(){var e=[];return e.push(this.wikiProvider.invalidateWikiData(this.courseId)),this.wiki&&(e.push(this.wikiProvider.invalidateSubwikis(this.wiki.id)),e.push(this.groupsProvider.invalidateActivityAllowedGroups(this.wiki.coursemodule)),e.push(this.groupsProvider.invalidateActivityGroupMode(this.wiki.coursemodule))),this.currentSubwiki&&(e.push(this.wikiProvider.invalidateSubwikiPages(this.currentSubwiki.wikiid)),e.push(this.wikiProvider.invalidateSubwikiFiles(this.currentSubwiki.wikiid))),this.currentPage&&e.push(this.wikiProvider.invalidatePage(this.currentPage)),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return this.currentSubwiki&&e.subwikiId==this.currentSubwiki.id&&e.wikiId==this.currentSubwiki.wikiid&&e.userId==this.currentSubwiki.userid&&e.groupId==this.currentSubwiki.groupid&&(this.isCurrentView&&e.warnings&&e.warnings.length&&this.domUtils.showErrorModal(e.warnings[0]),this.checkPageCreatedOrDiscarded(e)),!this.pageWarning},t.prototype.showSubwikiPicker=function(e){var t=this,n=this.popoverCtrl.create(p.a,{subwikis:this.subwikiData.subwikis,currentSubwiki:this.currentSubwiki});n.onDidDismiss(function(e){e&&t.goToSubwiki(e.id,e.userid,e.groupid,e.canedit)}),n.present({ev:e})},t.prototype.sync=function(){return this.wikiSync.syncWiki(this.wiki.id,this.courseId,this.wiki.coursemodule)},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.manualSyncObserver&&this.manualSyncObserver.off(),this.newPageObserver&&this.newPageObserver.off()},t.prototype.createSubwikiList=function(e){var t=this,n=[],o=[],r=[],i=!1,s=!1,a=!1;return this.subwikiData.subwikis=[],this.setSelectedWiki(this.subwikiId,this.userId,this.groupId),this.subwikiData.count=0,e.length>0&&(r=e.map(function(e){return e.id})),this.loadedSubwikis.forEach(function(c){var u=parseInt(c.groupid,10),d=parseInt(c.userid,10),l="";if(0==u&&0==d)i||(n.unshift({name:t.translate.instant("core.allparticipants"),id:c.id,userid:d,groupid:u,groupLabel:"",canedit:c.canedit}),i=!0);else{if(0!=u&&r.length>0){var f=r.indexOf(u);f>-1&&(l=e[f].name)}else l=t.translate.instant("addon.mod_wiki.notingroup");0!=d?(o.push(t.userProvider.getProfile(d,t.courseId,!0).then(function(e){n.push({name:e.fullname,id:c.id,userid:d,groupid:u,groupLabel:l,canedit:c.canedit})})),a||0==u||(a=!0)):(n.push({name:l,id:c.id,userid:d,groupid:u,groupLabel:l,canedit:c.canedit}),s=!0)}}),Promise.all(o).then(function(){t.fillSubwikiData(n,s,a)})},t.prototype.fillSubwikiData=function(e,t,n){var o,r=-1;if(e.sort(function(e,t){return e.groupid-t.groupid}),this.subwikiData.count=e.length,(!this.subwikiId||!this.userId&&!this.groupId)&&!this.isAnySubwikiSelected()&&e.length>0){var i=void 0,s=void 0,a=void 0;for(var c in e){var u=e[c];if(u.canedit){var d=void 0;if(u.userid>0?this.currentUserId==u.userid&&(d=u.id):u.groupid>0?t&&(d=u.id):u.id>0&&(d=u.id),void 0!==d){if(d>0){a=c;break}void 0===s&&(s=c)}else void 0===i&&(i=c)}}void 0!==(h=e[void 0!==a?a:void 0!==s?s:void 0!==i?i:0])&&this.setSelectedWiki(h.id,h.userid,h.groupid)}if(n)for(var c in e){(h=e[c]).groupid!==r&&(r=h.groupid,this.subwikiData.subwikis.push(o={label:h.groupLabel,subwikis:[]})),o.subwikis.push(h)}else if(t){var l={label:"",subwikis:[]},f={label:this.translate.instant("core.mygroups"),subwikis:[]},p={label:this.translate.instant("core.othergroups"),subwikis:[]};for(var c in e){var h;void 0===(h=e[c]).canedit?l.subwikis.push(h):h.canedit?f.subwikis.push(h):p.subwikis.push(h)}l.subwikis.length>0&&this.subwikiData.subwikis.push(l),f.subwikis.length>0&&this.subwikiData.subwikis.push(f),p.subwikis.length>0&&this.subwikiData.subwikis.push(p)}else this.subwikiData.subwikis.push({label:"",subwikis:e});this.wikiProvider.setSubwikiList(this.wiki.id,this.subwikiData.subwikis,this.subwikiData.count,this.subwikiData.subwikiSelected,this.subwikiData.userSelected,this.subwikiData.groupSelected)},m([Object(o._9)(f.a),g("design:type",f.a)],t.prototype,"tabs",void 0),m([Object(o.D)(),g("design:type",String)],t.prototype,"action",void 0),m([Object(o.D)(),g("design:type",Number)],t.prototype,"pageId",void 0),m([Object(o.D)(),g("design:type",String)],t.prototype,"pageTitle",void 0),m([Object(o.D)(),g("design:type",Number)],t.prototype,"wikiId",void 0),m([Object(o.D)(),g("design:type",Number)],t.prototype,"subwikiId",void 0),m([Object(o.D)(),g("design:type",Number)],t.prototype,"userId",void 0),m([Object(o.D)(),g("design:type",Number)],t.prototype,"groupId",void 0),t=m([Object(o.m)({selector:"addon-mod-wiki-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    \x3c!-- Select subwiki. --\x3e\n    <button ion-button icon-only *ngIf="subwikiData.count > 1" (click)="showSubwikiPicker($event)" [attr.aria-label]="\'addon.mod_wiki.subwiki\' | translate">\n        <ion-icon name="person"></ion-icon>\n    </button>\n\n    \x3c!-- Go to "home". --\x3e\n    <button ion-button icon-only *ngIf="showHomeButton" (click)="goToWikiHome()" [attr.aria-label]="\'addon.mod_wiki.gowikihome\' | translate">\n        <ion-icon name="home"></ion-icon>\n    </button>\n\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline && !pageIsOffline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && isOnline && (hasOffline || pageIsOffline)"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="canEdit && (isOnline || pageIsOffline)" [priority]="590" [content]="\'core.edit\' | translate" iconAction="create" (action)="goToEditPage()"></core-context-menu-item>\n        <core-context-menu-item *ngIf="canEdit" [priority]="580" [content]="\'addon.mod_wiki.createpage\' | translate" iconAction="add" (action)="goToNewPage()"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-tabs [hideUntil]="loaded" [selectedIndex]="selectedTab">\n        \x3c!-- Page contents. --\x3e\n        <core-tab [title]="\'addon.mod_wiki.viewpage\' | translate" icon="document">\n            <ng-template>\n                <div padding class="addon-mod_wiki-page-content">\n                    <core-course-module-description *ngIf="isMainPage" [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n                    \x3c!-- Wiki has something offline. --\x3e\n                    <div class="core-warning-card" icon-start *ngIf="pageIsOffline || hasOffline">\n                        <ion-icon name="warning"></ion-icon>\n                        <span *ngIf="pageIsOffline">{{ \'core.hasdatatosync\' | translate:{$a: pageStr} }}</span>\n                        <span *ngIf="!pageIsOffline">{{ \'core.hasdatatosync\' | translate:{$a: moduleName} }}</span>\n                    </div>\n\n                    \x3c!-- Page warning. --\x3e\n                    <div class="core-warning-card" icon-start *ngIf="pageWarning">\n                        <ion-icon name="warning"></ion-icon>\n                        {{ pageWarning }}\n                    </div>\n\n                    <article [ngClass]="{\'addon-mod_wiki-noedit\': !canEdit}">\n                        <core-format-text *ngIf="pageContent" [component]="component" [componentId]="componentId" [text]="pageContent"></core-format-text>\n                        <core-empty-box *ngIf="!pageContent" icon="document" [message]="\'addon.mod_wiki.nocontent\' | translate"></core-empty-box>\n                    </article>\n                </div>\n            </ng-template>\n        </core-tab>\n\n        \x3c!-- Map. --\x3e\n        <core-tab [title]="\'addon.mod_wiki.map\' | translate" icon="map">\n            <ng-template>\n                <ion-list>\n                    <ng-container *ngFor="let letter of map">\n                        <ion-item-divider color="light" *ngIf="letter.label">\n                            {{ letter.label }}\n                        </ion-item-divider>\n                        <a ion-item text-wrap *ngFor="let page of letter.pages" (click)="goToPage(page)">\n                            {{ page.title }}\n                            <ion-note *ngIf="!page.id" item-end color="danger">{{ \'core.offline\' | translate }}</ion-note>\n                        </a>\n                    </ng-container>\n                </ion-list>\n            </ng-template>\n        </core-tab>\n    </core-tabs>\n\n</core-loading>\n\n<ion-fab bottom right *ngIf="canEdit">\n    <button ion-fab (click)="goToNewPage()" [attr.aria-label]="\'addon.mod_wiki.createpage\' | translate">\n        <ion-icon name="add"></ion-icon>\n    </button>\n</ion-fab>\n'}),y(2,Object(o.N)()),g("design:paramtypes",[o.C,u.a,r.f,d.a,l.a,r.q,s.a,i.a,c.a,r.t])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(46),s=n(6),a=n(75),c=n(106),u=n(136),d=n(253),l=n(116),f=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},g=function(e){function t(t,n,o,r,i,s,a,u,l,f,p){var h=e.call(this,t,o)||this;return h.workshopProvider=n,h.workshopOffline=r,h.groupsProvider=i,h.navCtrl=s,h.modalCtrl=a,h.utils=u,h.workshopHelper=f,h.workshopSync=p,h.group=0,h.moduleName="workshop",h.page=0,h.groupInfo={groups:[],separateGroups:!1,visibleGroups:!1},h.canSubmit=!1,h.canAssess=!1,h.hasNextPage=!1,h.workshopPhases={PHASE_SETUP:c.a.PHASE_SETUP,PHASE_SUBMISSION:c.a.PHASE_SUBMISSION,PHASE_ASSESSMENT:c.a.PHASE_ASSESSMENT,PHASE_EVALUATION:c.a.PHASE_EVALUATION,PHASE_CLOSED:c.a.PHASE_CLOSED},h.offlineSubmissions=[],h.supportedTasks={submit:!0},h.obsSubmissionChanged=h.eventsProvider.on(c.a.SUBMISSION_CHANGED,function(e){h.eventReceived(e)},h.siteId),h.obsAssessmentSaved=h.eventsProvider.on(c.a.ASSESSMENT_SAVED,function(e){h.eventReceived(e)},h.siteId),h.appResumeSubscription=l.resume.subscribe(function(){h.showLoadingAndRefresh(!0)}),h.syncObserver=h.eventsProvider.on(d.a.AUTO_SYNCED,function(e){h.eventReceived(e)},h.siteId),h}return f(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.loadContent(!1,!0).then(function(){t.workshop&&t.workshopProvider.logView(t.workshop.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)}).catch(function(e){})})},t.prototype.eventReceived=function(e){(this.workshop&&this.workshop.id===e.workshopId||e.cmId===this.module.id)&&(this.showLoadingAndRefresh(!0),this.courseProvider.checkModuleCompletion(this.courseId,this.module.completionstatus))},t.prototype.invalidateContent=function(){var e=[];return e.push(this.workshopProvider.invalidateWorkshopData(this.courseId)),this.workshop&&(e.push(this.workshopProvider.invalidateWorkshopAccessInformationData(this.workshop.id)),e.push(this.workshopProvider.invalidateUserPlanPhasesData(this.workshop.id)),this.canSubmit&&e.push(this.workshopProvider.invalidateSubmissionsData(this.workshop.id)),this.access.canviewallsubmissions&&(e.push(this.workshopProvider.invalidateGradeReportData(this.workshop.id)),e.push(this.groupsProvider.invalidateActivityAllowedGroups(this.workshop.coursemodule)),e.push(this.groupsProvider.invalidateActivityGroupMode(this.workshop.coursemodule))),this.canAssess&&e.push(this.workshopProvider.invalidateReviewerAssesmentsData(this.workshop.id)),e.push(this.workshopProvider.invalidateGradesData(this.workshop.id))),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.workshop||e.workshopId!=this.workshop.id)&&(this.content.scrollToTop(),!0)},t.prototype.fetchContent=function(e,t,n){var o=this;return void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1),this.workshopProvider.getWorkshop(this.courseId,this.module.id).then(function(e){if(o.workshop=e,o.selectedPhase=e.phase,o.description=e.intro||e.description,o.dataRetrieved.emit(e),t)return o.syncActivity(n)}).then(function(){return o.workshopProvider.getWorkshopAccessInformation(o.workshop.id)}).then(function(e){if(o.access=e,e.canviewallsubmissions)return o.groupsProvider.getActivityGroupInfo(o.workshop.coursemodule,e.canviewallsubmissions).then(function(e){if(o.groupInfo=e,e&&e.groups&&e.groups.length>0){e.groups.some(function(e){return e.id==o.group})||(o.group=e.groups[0].id)}})}).then(function(){return o.workshopProvider.getUserPlanPhases(o.workshop.id)}).then(function(e){o.phases=e;for(var t in e){e[t].tasks.forEach(function(e){e.link||"examples"!=e.code&&"prepareexamples"!=e.code?e.link&&void 0!==o.supportedTasks[e.code]&&(e.support=!0):e.link=o.externalUrl});var n=e[t].actions.find(function(e){return e.url&&"switchphase"==e.type});e[t].switchUrl=n?n.url:""}return o.workshopOffline.hasWorkshopOfflineData(o.workshop.id).then(function(e){if(o.hasOffline=e,e)return o.workshopOffline.getSubmissions(o.workshop.id).then(function(e){o.offlineSubmissions=e});o.offlineSubmissions=[]})}).then(function(){return o.setPhaseInfo()}).then(function(){o.fillContextMenu(e)})},t.prototype.gotoSubmissionsPage=function(e){var t=this;return this.workshopProvider.getGradesReport(this.workshop.id,this.group,e).then(function(n){var o=n&&n.grades&&n.grades.length||0;t.page=e,t.hasNextPage=o>=c.a.PER_PAGE&&(t.page+1)*c.a.PER_PAGE<n.totalcount,t.grades=n.grades||[],t.grades.forEach(function(e){var n=t.workshopHelper.filterSubmissionActions(t.offlineSubmissions,e.submissionid||!1);return e=t.workshopHelper.applyOfflineData(e,n),t.workshopHelper.applyOfflineData(e,n).then(function(t){e=t})})})},t.prototype.runTask=function(e){if(e.support){if("submit"==e.code&&this.canSubmit&&(this.access.creatingsubmissionallowed&&!this.submission||this.access.modifyingsubmissionallowed&&this.submission)){this.navCtrl.push("AddonModWorkshopEditSubmissionPage",{module:this.module,access:this.access,courseId:this.courseId,submissionId:this.submission&&this.submission.id})}}else e.link&&this.utils.openInBrowser(e.link)},t.prototype.runTaskByCode=function(e){var t=this.workshopHelper.getTask(this.phases[this.workshop.phase].tasks,e);return t?this.runTask(t):null},t.prototype.selectPhase=function(){var e=this;if(this.phases){var t=this.modalCtrl.create("AddonModWorkshopPhaseSelectorPage",{phases:this.utils.objectToArray(this.phases),selected:this.selectedPhase,workshopPhase:this.workshop.phase});t.onDidDismiss(function(t){void 0!==t&&e.switchPhase(t)}),t.present()}},t.prototype.setGroup=function(e){return this.group=e,this.gotoSubmissionsPage(0)},t.prototype.setPhaseInfo=function(){var e=this;this.submission=!1,this.canAssess=!1,this.assessments=!1,this.userGrades=!1,this.publishedSubmissions=!1,this.canSubmit=this.workshopHelper.canSubmit(this.workshop,this.access,this.phases[c.a.PHASE_SUBMISSION].tasks);var t=[];this.canSubmit&&t.push(this.workshopHelper.getUserSubmission(this.workshop.id).then(function(t){var n=e.workshopHelper.filterSubmissionActions(e.offlineSubmissions,t.id||!1);return e.workshopHelper.applyOfflineData(t,n).then(function(t){e.submission=t})})),this.access.canviewallsubmissions&&this.workshop.phase>=c.a.PHASE_SUBMISSION&&t.push(this.gotoSubmissionsPage(this.page));var n=Promise.resolve();return this.workshop.phase>=c.a.PHASE_ASSESSMENT&&(this.canAssess=this.workshopHelper.canAssess(this.workshop,this.access),this.canAssess&&(n=this.workshopHelper.getReviewerAssessments(this.workshop.id).then(function(t){var n=[];return t.forEach(function(t){t.strategy=e.workshop.strategy,e.hasOffline&&n.push(e.workshopOffline.getAssessment(e.workshop.id,t.id).then(function(e){t.offline=!0,t.timemodified=Math.floor(e.timemodified/1e3)}).catch(function(){}))}),Promise.all(n).then(function(){e.assessments=t})}),t.push(n))),this.workshop.phase==c.a.PHASE_CLOSED&&(t.push(this.workshopProvider.getGrades(this.workshop.id).then(function(t){e.userGrades=!(!t.submissionlongstrgrade&&!t.assessmentlongstrgrade)&&t})),this.access.canviewpublishedsubmissions&&t.push(n.then(function(){return e.workshopProvider.getSubmissions(e.workshop.id).then(function(t){e.publishedSubmissions=t.filter(function(t){return!!t.published&&(e.assessments.forEach(function(n){t.reviewedby=[],n.submissionid==t.id&&t.reviewedby.push(e.workshopHelper.realGradeValue(e.workshop,n))}),!0)})})}))),Promise.all(t)},t.prototype.switchPhase=function(e){this.selectedPhase=e,this.page=0},t.prototype.sync=function(){return this.workshopSync.syncWorkshop(this.workshop.id)},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.obsSubmissionChanged&&this.obsSubmissionChanged.off(),this.obsAssessmentSaved&&this.obsAssessmentSaved.off(),this.appResumeSubscription&&this.appResumeSubscription.unsubscribe()},p([Object(o.D)(),h("design:type",Object)],t.prototype,"group",void 0),t=p([Object(o.m)({selector:"addon-mod-workshop-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="500" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="400" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n    <core-course-module-description *ngIf="description && selectedPhase == workshopPhases.PHASE_SETUP" [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    <ion-card class="with-borders" *ngIf="phases">\n        <a ion-item (click)="selectPhase()" detail-none>\n            <h2 stacked text-wrap>{{ phases[selectedPhase].title }}</h2>\n            <p text-wrap *ngIf="phases[selectedPhase].code == workshop.phase">{{ \'addon.mod_workshop.userplancurrentphase\' | translate }}</p>\n            <ion-icon item-end name="arrow-dropdown"></ion-icon>\n        </a>\n        <a ion-item text-wrap *ngIf="phases[selectedPhase].switchUrl" [href]="phases[selectedPhase].switchUrl" detail-none>\n            <ion-icon item-start name="swap"></ion-icon>\n            {{ \'addon.mod_workshop.switchphase\' + selectedPhase | translate }}\n            <ion-icon item-end name="open"></ion-icon>\n        </a>\n    </ion-card>\n\n    <ion-card class="with-borders" *ngIf="phases && phases[selectedPhase] && phases[selectedPhase].tasks && phases[selectedPhase].tasks.length">\n        <a ion-item text-wrap *ngFor="let task of phases[selectedPhase].tasks" [class.item-dimmed]="selectedPhase != workshop.phase" (click)="runTask(task)" detail-none>\n            <ion-icon item-start name="radio-button-off" *ngIf="task.completed == null"></ion-icon>\n            <ion-icon item-start name="close-circle" color="danger" *ngIf="task.completed == \'\'"></ion-icon>\n            <ion-icon item-start name="information-circle" color="info" *ngIf="task.completed == \'info\'"></ion-icon>\n            <ion-icon item-start name="checkmark-circle" color="success" *ngIf="task.completed == \'1\'"></ion-icon>\n\n            <h2>{{task.title}}</h2>\n            <p *ngIf="task.details"><core-format-text [text]="task.details"></core-format-text></p>\n            <ion-icon item-end *ngIf="task.link && !task.support" name="open"></ion-icon>\n        </a>\n    </ion-card>\n\n    \x3c!-- Has something offline. --\x3e\n    <div class="core-warning-card" icon-start *ngIf="hasOffline">\n        <ion-icon name="warning"></ion-icon>\n        {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n    </div>\n\n    <div *ngIf="access && workshop && workshop.phase >= selectedPhase">\n        \x3c!-- SUBMISSION PHASE --\x3e\n        <ng-container *ngIf="selectedPhase == workshopPhases.PHASE_SUBMISSION">\n            <ion-card *ngIf="workshop.instructauthors">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_workshop.areainstructauthors\' | translate }}</h2>\n                    <core-format-text fullOnClick="true" [component]="component" [componentId]="workshop.cmid" [text]="workshop.instructauthors"></core-format-text>\n                </ion-item>\n            </ion-card>\n\n            <ion-card class="with-borders" *ngIf="canSubmit">\n                <ion-item text-wrap *ngIf="!submission">\n                    <h2>{{ \'addon.mod_workshop.yoursubmission\' | translate }}</h2>\n                    <p>{{ \'addon.mod_workshop.noyoursubmission\' | translate }}</p>\n                </ion-item>\n\n                <ng-container *ngIf="submission">\n                    <addon-mod-workshop-submission [submission]="submission" [courseId]="workshop.course" [module]="module" [workshop]="workshop" [access]="access"></addon-mod-workshop-submission>\n                </ng-container>\n            </ion-card>\n\n            \x3c!-- Show only on current phase --\x3e\n            <ng-container *ngIf="workshop.phase == selectedPhase">\n                <ion-item text-wrap *ngIf="canSubmit && ((access.creatingsubmissionallowed && !submission) || (access.modifyingsubmissionallowed && submission))">\n                    <button ion-button icon-start block *ngIf="access.creatingsubmissionallowed && !submission" (click)="runTaskByCode(\'submit\')">\n                        <ion-icon name="add"></ion-icon>\n                        {{ \'addon.mod_workshop.createsubmission\' | translate }}\n                    </button>\n                    <button ion-button icon-start block *ngIf="access.modifyingsubmissionallowed && submission" (click)="runTaskByCode(\'submit\')">\n                        <ion-icon name="create"></ion-icon>\n                        {{ \'addon.mod_workshop.editsubmission\' | translate }}\n                    </button>\n                </ion-item>\n            </ng-container>\n        </ng-container>\n\n        \x3c!-- ASSESSMENT PHASE --\x3e\n        <ng-container *ngIf="selectedPhase == workshopPhases.PHASE_ASSESSMENT">\n            <ion-card *ngIf="workshop.instructreviewers">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_workshop.areainstructreviewers\' | translate }}</h2>\n                    <core-format-text fullOnClick="true" [component]="component" [componentId]="workshop.cmid" [text]="workshop.instructreviewers"></core-format-text>\n                </ion-item>\n            </ion-card>\n\n            <ion-card class="with-borders" *ngIf="canAssess && assessments && assessments.length">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_workshop.assignedassessments\' | translate }}</h2>\n                </ion-item>\n                <ng-container *ngFor="let assessment of assessments">\n                    <addon-mod-workshop-submission [submission]="assessment.submission" [assessment]="assessment" [courseId]="workshop.course" [module]="module" [workshop]="workshop" [access]="access" summary="true"></addon-mod-workshop-submission>\n                </ng-container>\n            </ion-card >\n        </ng-container>\n\n        <ion-card class="with-borders" *ngIf="!access.canviewallsubmissions && selectedPhase == workshop.phase && (canSubmit || canAssess) && selectedPhase == workshopPhases.PHASE_EVALUATION">\n            <a ion-item text-wrap *ngIf="submission" (click)="switchPhase(workshopPhases.PHASE_SUBMISSION)" detail-push>\n                <h2>{{ \'addon.mod_workshop.yoursubmission\' | translate }}</h2>\n            </a>\n            <a ion-item text-wrap *ngIf="canAssess" (click)="switchPhase(workshopPhases.PHASE_ASSESSMENT)" detail-push>\n                <h2>{{ \'addon.mod_workshop.assignedassessments\' | translate }}</h2>\n            </a>\n        </ion-card>\n\n        \x3c!-- CLOSED PHASE --\x3e\n        <ng-container *ngIf="selectedPhase == workshopPhases.PHASE_CLOSED">\n            <ion-card *ngIf="workshop.conclusion">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_workshop.conclusion\' | translate }}</h2>\n                    <core-format-text fullOnClick="true" [component]="component" [componentId]="workshop.cmid" [text]="workshop.conclusion"></core-format-text>\n                </ion-item>\n            </ion-card>\n\n            <ion-card class="with-borders" *ngIf="userGrades">\n                <ion-item-divider color="light" text-wrap>\n                    <h2>{{ \'addon.mod_workshop.yourgrades\' | translate }}</h2>\n                </ion-item-divider>\n                <a ion-item text-wrap *ngIf="userGrades.submissionlongstrgrade" (click)="switchPhase(workshopPhases.PHASE_SUBMISSION)" detail-push>\n                    <h2>{{ \'addon.mod_workshop.submissiongrade\' | translate }}</h2>\n                    <core-format-text [text]="userGrades.submissionlongstrgrade"></core-format-text>\n                </a>\n                <a ion-item text-wrap *ngIf="userGrades.assessmentlongstrgrade" (click)="switchPhase(workshopPhases.PHASE_ASSESSMENT)" detail-push>\n                    <h2>{{ \'addon.mod_workshop.gradinggrade\' | translate }}</h2>\n                    <core-format-text [text]="userGrades.assessmentlongstrgrade"></core-format-text>\n                </a>\n            </ion-card>\n\n            <ion-card class="with-borders" *ngIf="publishedSubmissions && publishedSubmissions.length">\n                <ion-item text-wrap>\n                    <h2>{{ \'addon.mod_workshop.publishedsubmissions\' | translate }}</h2>\n                </ion-item>\n                <ng-container *ngFor="let submission of publishedSubmissions">\n                    <addon-mod-workshop-submission [submission]="submission" [courseId]="workshop.course" [module]="module" [workshop]="workshop" [access]="access" summary="true"></addon-mod-workshop-submission>\n                </ng-container>\n            </ion-card>\n        </ng-container>\n\n        \x3c!-- MULTIPLE PHASES SUBMISSION OR GREATER only teachers --\x3e\n        <ion-card class="with-borders" *ngIf="workshop.phase == selectedPhase && access.canviewallsubmissions && selectedPhase >= workshopPhases.PHASE_SUBMISSION && grades && grades.length">\n            <ion-item text-wrap *ngIf="selectedPhase == workshopPhases.PHASE_SUBMISSION">\n                <h2>{{ \'addon.mod_workshop.submissionsreport\' | translate }}</h2>\n            </ion-item>\n            <ion-item text-wrap *ngIf="selectedPhase > workshopPhases.PHASE_SUBMISSION">\n                <h2>{{ \'addon.mod_workshop.gradesreport\' | translate }}</h2>\n            </ion-item>\n            <ion-item text-wrap *ngIf="groupInfo && (groupInfo.separateGroups || groupInfo.visibleGroups)">\n                <ion-label id="addon-workshop-groupslabel" *ngIf="groupInfo.separateGroups">{{ \'core.groupsseparate\' | translate }}</ion-label>\n                <ion-label id="addon-workshop-groupslabel" *ngIf="groupInfo.visibleGroups">{{ \'core.groupsvisible\' | translate }}</ion-label>\n                <ion-select [(ngModel)]="selectedGroup" (ionChange)="setGroup(selectedGroup)" aria-labelledby="addon-workshop-groupslabel" interface="popover">\n                    <ion-option *ngFor="let groupOpt of groupInfo.groups" [value]="groupOpt.id">{{groupOpt.name}}</ion-option>\n                </ion-select>\n            </ion-item>\n\n            <ng-container *ngFor="let submission of grades">\n                <addon-mod-workshop-submission [submission]="submission" [courseId]="workshop.course" [module]="module" [workshop]="workshop" [access]="access" summary="true"></addon-mod-workshop-submission>\n            </ng-container>\n\n            <ion-grid *ngIf="page > 0 || hasNextPage">\n                <ion-row align-items-center>\n                    <ion-col *ngIf="page > 0">\n                        <button ion-button block outline icon-start (click)="gotoSubmissionsPage(page - 1)">>\n                            <ion-icon name="arrow-back"></ion-icon>\n                            {{ \'core.previous\' | translate }}\n                        </button>\n                    </ion-col>\n                    <ion-col *ngIf="hasNextPage">\n                        <button ion-button block icon-end (click)="gotoSubmissionsPage(page + 1)">\n                            {{ \'core.next\' | translate }}\n                            <ion-icon name="arrow-forward"></ion-icon>\n                        </button>\n                    </ion-col>\n                </ion-row>\n            </ion-grid>\n        </ion-card>\n    </div>\n</core-loading>\n'}),m(2,Object(o.N)()),h("design:paramtypes",[o.C,c.a,r.f,l.a,i.a,r.q,r.o,s.a,r.s,u.a,d.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(4),i=n(22),s=n(6),a=n(46),c=n(75),u=n(139),d=n(59),l=n(198),f=n(150),p=n(262),h=n(390),m=n(5),g=(n.n(m),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},_=function(e){function t(t,n,o,r,i,s,a,c,u,l,f,m){var g=e.call(this,t,i)||this;return g.dataProvider=n,g.dataHelper=o,g.dataOffline=r,g.dataSync=s,g.timeUtils=a,g.groupsProvider=c,g.commentsProvider=u,g.modalCtrl=l,g.utils=f,g.navCtrl=m,g.component=d.a.COMPONENT,g.moduleName="data",g.access={},g.data={},g.isEmpty=!1,g.entries={},g.firstEntry=!1,g.canAdd=!1,g.canSearch=!1,g.search={sortBy:"0",sortDirection:"DESC",page:0,text:"",searching:!1,searchingAdvanced:!1,advanced:[]},g.hasNextPage=!1,g.entriesRendered="",g.cssTemplate="",g.extraImports=[h.a],g.syncEventName=p.a.AUTO_SYNCED,g.hasComments=!1,g.entryChangedObserver=g.eventsProvider.on(d.a.ENTRY_CHANGED,function(e){if(g.data.id==e.dataId)return g.loaded=!1,g.loadContent(!0)},g.siteId),g}return g(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.selectedGroup=this.group||0,this.loadContent(!1,!0).then(function(){t.data&&t.dataProvider.logView(t.data.id).then(function(){t.courseProvider.checkModuleCompletion(t.courseId,t.module.completionstatus)})})},t.prototype.invalidateContent=function(){var e=[];return e.push(this.dataProvider.invalidateDatabaseData(this.courseId)),this.data&&(e.push(this.dataProvider.invalidateDatabaseAccessInformationData(this.data.id)),e.push(this.groupsProvider.invalidateActivityGroupInfo(this.data.coursemodule)),e.push(this.dataProvider.invalidateEntriesData(this.data.id)),this.hasComments&&e.push(this.commentsProvider.invalidateCommentsByInstance("module",this.data.coursemodule))),Promise.all(e)},t.prototype.isRefreshSyncNeeded=function(e){return!(!this.data||e.dataId!=this.data.id||void 0!==e.entryId)&&(this.loaded=!1,this.content.scrollToTop(),!0)},t.prototype.fetchContent=function(e,t,n){var o=this;void 0===e&&(e=!1),void 0===t&&(t=!1),void 0===n&&(n=!1);var r=!1,i=!1;return this.dataProvider.getDatabase(this.courseId,this.module.id).then(function(e){if(o.data=e,o.description=e.intro||e.description,o.dataRetrieved.emit(e),t)return o.syncActivity(n).catch(function(){})}).then(function(){return o.dataProvider.getDatabaseAccessInformation(o.data.id)}).then(function(e){if(o.access=e,!e.timeavailable){var t=o.timeUtils.timestamp();return o.timeAvailableFrom=!!(o.data.timeavailablefrom&&t<o.data.timeavailablefrom)&&1e3*parseInt(o.data.timeavailablefrom,10),o.timeAvailableFromReadable=!!o.timeAvailableFrom&&m(o.timeAvailableFrom).format("LLL"),o.timeAvailableTo=!!(o.data.timeavailableto&&t>o.data.timeavailableto)&&1e3*parseInt(o.data.timeavailableto,10),o.timeAvailableToReadable=!!o.timeAvailableTo&&m(o.timeAvailableTo).format("LLL"),o.isEmpty=!0,void(o.groupInfo=null)}return i=!0,r=e.canaddentry,o.groupsProvider.getActivityGroupInfo(o.data.coursemodule,e.canmanageentries).then(function(e){return o.groupInfo=e,e&&e.groups&&e.groups.length>0&&(e.groups.some(function(e){return o.selectedGroup==e.id})||(o.selectedGroup=e.groups[0].id)),o.fetchOfflineEntries()})}).then(function(){return o.dataProvider.getFields(o.data.id).then(function(e){return 0==e.length&&(i=!1,r=!1),o.search.advanced=[],o.fields=o.utils.arrayToObject(e,"id"),o.fieldsArray=o.utils.objectToArray(o.fields),o.fetchEntriesData()})}).then(function(){o.fillContextMenu(e)}).finally(function(){o.canAdd=r,o.canSearch=i})},t.prototype.fetchEntriesData=function(){var e=this;return this.hasComments=!1,this.dataProvider.getDatabaseAccessInformation(this.data.id,this.selectedGroup).then(function(t){if(e.access.canaddentry=t.canaddentry,e.search.searching){return e.dataProvider.searchEntries(e.data.id,e.selectedGroup,e.search.searchingAdvanced?void 0:e.search.text,e.search.searchingAdvanced?e.search.advanced:void 0,e.search.sortBy,e.search.sortDirection,e.search.page)}return e.dataProvider.getEntries(e.data.id,e.selectedGroup,e.search.sortBy,e.search.sortDirection,e.search.page)}).then(function(t){var n=t&&t.entries&&t.entries.length||0;if(e.isEmpty=!n&&!Object.keys(e.offlineActions).length&&!Object.keys(e.offlineEntries).length,e.hasNextPage=n>=d.a.PER_PAGE&&(e.search.page+1)*d.a.PER_PAGE<t.totalcount,e.entriesRendered="",!e.isEmpty){e.cssTemplate=e.dataHelper.prefixCSS(e.data.csstemplate,".addon-data-entries-"+e.data.id);var o=e.sitesProvider.getCurrentSite().getInfo(),r=[];return e.utils.objectToArray(e.offlineEntries).forEach(function(t){var n=t.find(function(e){return"add"==e.action});if(n){var i={id:n.entryid,canmanageentry:!0,approved:!e.data.approval||e.data.manageapproved,dataid:n.dataid,groupid:n.groupid,timecreated:-n.entryid,timemodified:-n.entryid,userid:o.userid,fullname:o.fullname,contents:{}};r.push(t.length>0?e.dataHelper.applyOfflineActions(i,t,e.fieldsArray):Promise.resolve(i))}}),t.entries.forEach(function(t){t.contents=e.utils.arrayToObject(t.contents,"fieldid"),r.push(void 0!==e.offlineActions[t.id]?e.dataHelper.applyOfflineActions(t,e.offlineActions[t.id],e.fieldsArray):Promise.resolve(t))}),Promise.all(r).then(function(t){var n=e.data.listtemplateheader||"";!t||!t[0]||e.search.searching&&e.firstEntry||(e.firstEntry=t[0].id),t.forEach(function(t){e.entries[t.id]=t;var o=e.dataHelper.getActions(e.data,e.access,t);n+=e.dataHelper.displayShowFields(e.data.listtemplate,e.fieldsArray,t,"list",o)}),e.entriesRendered=n+=e.data.listtemplatefooter||"",e.jsData={fields:e.fields,entries:e.entries,data:e.data,gotoEntry:e.gotoEntry.bind(e)}})}e.search.searching||(e.canSearch=!1),e.firstEntry=!1})},t.prototype.showSearch=function(){var e=this,t=this.modalCtrl.create("AddonModDataSearchPage",{search:this.search,fields:this.fields,data:this.data});t.onDidDismiss(function(t){t&&(e.search=t,e.searchEntries(0))}),t.present()},t.prototype.searchEntries=function(e){var t=this;return this.loaded=!1,this.search.page=e,this.fetchEntriesData().catch(function(e){t.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}).finally(function(){t.loaded=!0})},t.prototype.searchReset=function(){this.search.sortBy="0",this.search.sortDirection="DESC",this.search.text="",this.search.advanced=[],this.search.searchingAdvanced=!1,this.search.searching=!1,this.searchEntries(0)},t.prototype.setGroup=function(e){var t=this;return this.selectedGroup=e,this.fetchEntriesData().catch(function(e){return t.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0),Promise.reject(null)})},t.prototype.gotoAddEntries=function(){this.navCtrl.push("AddonModDataEditPage",{module:this.module,courseId:this.courseId,group:this.selectedGroup})},t.prototype.gotoEntry=function(e){this.navCtrl.push("AddonModDataEntryPage",{module:this.module,courseId:this.courseId,entryId:e,group:this.selectedGroup})},t.prototype.fetchOfflineEntries=function(){var e=this;return this.dataOffline.getDatabaseEntries(this.data.id).then(function(t){e.hasOffline=!!t.length,e.offlineActions={},e.offlineEntries={},0==e.search.page&&e.hasOffline&&t.forEach(function(t){t.entryid>0?(void 0===e.offlineActions[t.entryid]&&(e.offlineActions[t.entryid]=[]),e.offlineActions[t.entryid].push(t)):(void 0===e.offlineActions[t.entryid]&&(e.offlineEntries[t.entryid]=[]),e.offlineEntries[t.entryid].push(t))})})},t.prototype.sync=function(){return this.dataSync.syncDatabase(this.data.id)},t.prototype.hasSyncSucceed=function(e){return e.updated},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.entryChangedObserver&&this.entryChangedObserver.off()},t=y([Object(o.m)({selector:"addon-mod-data-index",template:'\x3c!-- Buttons to add to the header. --\x3e\n<core-navbar-buttons end>\n    <button *ngIf="canSearch" ion-button icon-only (click)="showSearch($event)" [attr.aria-label]="\'addon.mod_data.search\' | translate">\n        <ion-icon name="search"></ion-icon>\n    </button>\n    <core-context-menu>\n        <core-context-menu-item *ngIf="externalUrl" [priority]="900" [content]="\'core.openinbrowser\' | translate" [href]="externalUrl" [iconAction]="\'open\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="description" [priority]="800" [content]="\'core.moduleintro\' | translate" (action)="expandDescription()" [iconAction]="\'arrow-forward\'"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && !hasOffline && isOnline" [priority]="700" [content]="\'core.refresh\' | translate" (action)="doRefresh(null, $event)" [iconAction]="refreshIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="loaded && hasOffline && isOnline"  [priority]="600" [content]="\'core.settings.synchronizenow\' | translate" (action)="doRefresh(null, $event, true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item [priority]="500" *ngIf="canAdd" [content]="\'addon.mod_data.addentries\' | translate" [iconAction]="\'add\'" (action)="gotoAddEntries($event)"></core-context-menu-item>\n        <core-context-menu-item [priority]="400" *ngIf="firstEntry" [content]="\'addon.mod_data.single\' | translate" [iconAction]="\'document\'" (action)="gotoEntry(firstEntry)"></core-context-menu-item>\n        <core-context-menu-item *ngIf="prefetchStatusIcon" [priority]="300" [content]="prefetchText" (action)="prefetch()" [iconAction]="prefetchStatusIcon" [closeOnClick]="false"></core-context-menu-item>\n        <core-context-menu-item *ngIf="size" [priority]="200" [content]="size" [iconDescription]="\'cube\'" (action)="removeFiles()" [iconAction]="\'trash\'"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Content. --\x3e\n<core-loading [hideUntil]="loaded" class="core-loading-center">\n\n    <core-course-module-description [description]="description" [component]="component" [componentId]="componentId"></core-course-module-description>\n\n    \x3c!-- Data done in offline but not synchronized --\x3e\n    <div class="core-warning-card" icon-start *ngIf="hasOffline">\n        <ion-icon name="warning"></ion-icon>\n        {{ \'core.hasdatatosync\' | translate: {$a: moduleName} }}\n    </div>\n\n    <ion-item text-wrap *ngIf="groupInfo && (groupInfo.separateGroups || groupInfo.visibleGroups)">\n        <ion-label id="addon-data-groupslabel" *ngIf="groupInfo.separateGroups">{{ \'core.groupsseparate\' | translate }}</ion-label>\n        <ion-label id="addon-data-groupslabel" *ngIf="groupInfo.visibleGroups">{{ \'core.groupsvisible\' | translate }}</ion-label>\n        <ion-select [(ngModel)]="selectedGroup" (ionChange)="setGroup(selectedGroup)" aria-labelledby="addon-data-groupslabel" interface="popover">\n            <ion-option *ngFor="let groupOpt of groupInfo.groups" [value]="groupOpt.id">{{groupOpt.name}}</ion-option>\n        </ion-select>\n    </ion-item>\n\n    <div class="core-info-card" icon-start  *ngIf="!access.timeavailable && timeAvailableFrom">\n        <ion-icon name="information-circle"></ion-icon>\n        {{ \'addon.mod_data.notopenyet\' | translate:{$a: timeAvailableFromReadable} }}\n    </div>\n\n    <div class="core-info-card" icon-start *ngIf="!access.timeavailable && timeAvailableTo">\n        <ion-icon name="information-circle"></ion-icon>\n        {{ \'addon.mod_data.expired\' | translate:{$a: timeAvailableToReadable} }}\n    </div>\n\n    <div class="core-info-card" icon-start *ngIf="access.entrieslefttoview">\n        <ion-icon name="information-circle"></ion-icon>\n        {{ \'addon.mod_data.entrieslefttoaddtoview\' | translate:{$a: {entrieslefttoview: access.entrieslefttoview} } }}\n    </div>\n\n    <div class="core-info-card" icon-start *ngIf="access.entrieslefttoadd">\n        <ion-icon name="information-circle"></ion-icon>\n        {{ \'addon.mod_data.entrieslefttoadd\' | translate:{$a: {entriesleft: access.entrieslefttoadd} } }}\n    </div>\n\n    <ion-item class="item" *ngIf="search.searching && !isEmpty">\n        <a (click)="searchReset()">{{ \'addon.mod_data.resetsettings\' | translate}}</a>\n    </ion-item>\n\n    <div class="addon-data-contents addon-data-entries-{{data.id}}" *ngIf="!isEmpty">\n        <style *ngIf="cssTemplate">\n            {{ cssTemplate }}\n        </style>\n\n        <core-compile-html [text]="entriesRendered" [jsData]="jsData" [extraImports]="extraImports"></core-compile-html>\n    </div>\n\n    <ion-grid *ngIf="search.page > 0 || hasNextPage">\n        <ion-row align-items-center>\n            <ion-col *ngIf="search.page > 0">\n                <button ion-button block outline icon-start (click)="searchEntries(search.page - 1)">\n                    <ion-icon name="arrow-back"></ion-icon>\n                    {{ \'core.previous\' | translate }}\n                </button>\n            </ion-col>\n            <ion-col *ngIf="hasNextPage">\n                <button ion-button block icon-end (click)="searchEntries(search.page + 1)">\n                    {{ \'core.next\' | translate }}\n                    <ion-icon name="arrow-forward"></ion-icon>\n                </button>\n            </ion-col>\n        </ion-row>\n    </ion-grid>\n\n    <core-empty-box *ngIf="isEmpty && !search.searching" icon="archive" [message]="\'addon.mod_data.norecords\' | translate">\n        <div padding-top *ngIf="canAdd">\n            <button block (click)="gotoAddEntries($event)">\n                {{ \'addon.mod_data.addentries\' | translate }}\n            </button>\n        </div>\n    </core-empty-box>\n\n    <core-empty-box *ngIf="isEmpty && search.searching" icon="archive" [message]="\'addon.mod_data.nomatch\' | translate">\n        <a (click)="searchReset()">{{ \'addon.mod_data.resetsettings\' | translate}}</a>\n    </core-empty-box>\n\n</core-loading>\n\n<ion-fab bottom right *ngIf="canAdd">\n    <button ion-fab (click)="gotoAddEntries($event)" [attr.aria-label]="\'addon.mod_data.addentries\' | translate">\n        <ion-icon name="add"></ion-icon>\n    </button>\n</ion-fab>\n'}),b(4,Object(o.N)()),v("design:paramtypes",[o.C,d.a,l.a,f.a,r.f,p.a,i.a,a.a,u.a,r.o,s.a,r.q])],t)}(c.a)},,,,,,,,,,,function(e,t){function n(e){return Promise.resolve().then(function(){throw new Error("Cannot find module '"+e+"'.")})}n.keys=function(){return[]},n.resolve=n,e.exports=n,n.id=435},function(e,t,n){"use strict";function o(e){return new m.a(e,"./assets/lang/",".json")}n.d(t,"b",function(){return Qe}),n.d(t,"a",function(){return Ye});var r=n(82),i=n(974),s=n(0),a=n(4),c=n(13),u=n(144),d=n(154),l=n(263),f=n(17),p=n(1636),h=n(1),m=n(1637),g=n(1639),y=n(322),v=n(1640),b=n(7),_=n(306),P=n(9),O=n(105),w=n(93),S=n(11),R=n(8),E=n(22),C=n(47),I=n(6),A=n(77),D=n(79),j=n(27),x=n(118),T=n(12),k=n(712),M=n(2),N=n(78),U=n(46),F=n(61),L=n(121),H=n(18),q=n(51),B=n(155),K=n(45),G=n(222),W=n(16),z=n(761),V=n(750),Q=n(751),Y=n(746),$=n(747),X=n(757),J=n(744),Z=n(758),ee=n(743),te=n(759),ne=n(748),oe=n(1641),re=n(1642),ie=n(1659),se=n(752),ae=n(1660),ce=n(793),ue=n(794),de=n(1661),le=n(1663),fe=n(795),pe=n(1665),he=n(1668),me=n(796),ge=n(801),ye=n(810),ve=n(811),be=n(812),_e=n(1679),Pe=n(1712),Oe=n(824),we=n(831),Se=n(813),Re=n(814),Ee=n(816),Ce=n(818),Ie=n(823),Ae=n(825),De=n(827),je=n(833),xe=n(835),Te=n(834),ke=n(838),Me=n(820),Ne=n(836),Ue=n(797),Fe=n(1715),Le=n(798),He=n(843),qe=n(846),Be=n(845),Ke=n(847),Ge=n(1717),We=n(1737),ze=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},Ve=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},Qe=[b.a,_.a,P.a,O.a,w.a,S.a,R.a,E.a,C.a,I.a,A.a,D.a,j.a,x.a,T.a,k.a,M.a,N.a,U.a,F.a,L.a,H.a,q.a,B.a,K.a,G.a],Ye=function(){function e(e,t,n,o,r,i){t.registerProcess({name:"CorePlatformReady",priority:D.a.MAX_RECOMMENDED_PRIORITY+400,blocking:!0,load:e.ready}),t.registerProcess(n),t.registerProcess({name:"CoreRestoreSession",priority:D.a.MAX_RECOMMENDED_PRIORITY+200,blocking:!1,load:r.restoreSession.bind(r)}),t.registerProcess({name:"CoreClearTmpFolder",priority:D.a.MAX_RECOMMENDED_PRIORITY+150,blocking:!1,load:i.clearTmpFolder.bind(i)}),t.executeInitProcesses(),o.setTransition("core-page-transition",v.a),this.decorateIonContent()}return e.prototype.decorateIonContent=function(){var e=function(e){return e.indexOf("px")>0?parseInt(e,10):0};a.f.prototype._readDimensions=function(){var t,n=this._pTop,o=this._pRight,r=this._pBottom,i=this._pLeft,s=this._hdrHeight,a=this._ftrHeight,u=this._tabsPlacement,d=0;if(this._pTop=0,this._pRight=0,this._pBottom=0,this._pLeft=0,this._hdrHeight=0,this._ftrHeight=0,this._tabsPlacement=null,this._tTop=0,this._fTop=0,this._fBottom=0,this._scroll){t=this._scroll.ev;var l=this.getNativeElement();if(l){for(var f,p,h=l.parentElement,m=h.children,g=m.length-1;g>=0;g--)"ION-CONTENT"===(p=(l=m[g]).tagName)?(t.contentElement=l,this._fullscreen&&(f=getComputedStyle(l),this._pTop=e(f.paddingTop),this._pBottom=e(f.paddingBottom),this._pRight=e(f.paddingRight),this._pLeft=e(f.paddingLeft))):"ION-HEADER"===p?(t.headerElement=l,this._hdrHeight=l.clientHeight):"ION-FOOTER"===p&&(t.footerElement=l,this._ftrHeight=l.clientHeight,this._footerEle=l);l=h;for(;l&&"ION-MODAL"!==l.tagName&&!l.classList.contains("tab-subpage");)-1!=l.tagName.indexOf("ION-TABS")&&(this._tabbarHeight=l.firstElementChild.clientHeight,null===this._tabsPlacement&&(this._tabsPlacement=l.getAttribute("tabsplacement"))),l=l.parentElement;this._tabs&&"top"===this._tabsPlacement&&(this._tTop=this._hdrHeight,d=this._tabs._top),this._cTop=this._hdrHeight,this._cBottom=this._ftrHeight,"top"===this._tabsPlacement?this._cTop+=this._tabbarHeight:"bottom"===this._tabsPlacement&&(this._cBottom+=this._tabbarHeight),this._hasRefresher&&(this._cTop-=1),this._fTop=this._cTop,this._fBottom=this._cBottom,this._fullscreen&&(this._cTop+=this._pTop,this._cBottom+=this._pBottom);var y=this.getContentDimensions();t.scrollHeight=y.scrollHeight,t.scrollWidth=y.scrollWidth,t.contentHeight=y.contentHeight,t.contentWidth=y.contentWidth,t.contentTop=y.contentTop,t.contentBottom=y.contentBottom,this._dirty=n!==this._pTop||r!==this._pBottom||i!==this._pLeft||o!==this._pRight||s!==this._hdrHeight||a!==this._ftrHeight||u!==this._tabsPlacement||d!==this._tTop||this._cTop!==this.contentTop||this._cBottom!==this.contentBottom,this._scroll.init(this.getScrollElement(),this._cTop,this._cBottom),this.imgsUpdate()}else Object(c.a)(!1,"ele should be valid")}}},e=ze([Object(s.I)({declarations:[g.a],imports:[r.a,i.a,d.c,u.b,a.k.forRoot(g.a,{pageTransition:"core-page-transition"},{links:[{loadChildren:"../addon/badges/pages/issued-badge/issued-badge.module#AddonBadgesIssuedBadgePageModule",name:"AddonBadgesIssuedBadgePage",segment:"addon-badges-issued-badge",priority:"low",defaultHistory:[]},{loadChildren:"../addon/badges/pages/user-badges/user-badges.module#AddonBadgesUserBadgesPageModule",name:"AddonBadgesUserBadgesPage",segment:"addon-badges-user-badges",priority:"low",defaultHistory:[]},{loadChildren:"../addon/calendar/pages/event/event.module#AddonCalendarEventPageModule",name:"AddonCalendarEventPage",segment:"addon-calendar-event",priority:"low",defaultHistory:[]},{loadChildren:"../addon/calendar/pages/list/list.module#AddonCalendarListPageModule",name:"AddonCalendarListPage",segment:"addon-calendar-list",priority:"low",defaultHistory:[]},{loadChildren:"../addon/calendar/pages/settings/settings.module#AddonCalendarSettingsPageModule",name:"AddonCalendarSettingsPage",segment:"addon-calendar-settings",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/competencies/competencies.module#AddonCompetencyCompetenciesPageModule",name:"AddonCompetencyCompetenciesPage",segment:"addon-competency-competencies",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/competency/competency.module#AddonCompetencyCompetencyPageModule",name:"AddonCompetencyCompetencyPage",segment:"addon-competency-competency",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/competencysummary/competencysummary.module#AddonCompetencyCompetencySummaryPageModule",name:"AddonCompetencyCompetencySummaryPage",segment:"addon-competency-competency-summary",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/coursecompetencies/coursecompetencies.module#AddonCompetencyCourseCompetenciesPageModule",name:"AddonCompetencyCourseCompetenciesPage",segment:"addon-competency-coursecompetencies",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/plan/plan.module#AddonCompetencyPlanPageModule",name:"AddonCompetencyPlanPage",segment:"addon-competency-plan",priority:"low",defaultHistory:[]},{loadChildren:"../addon/competency/pages/planlist/planlist.module#AddonCompetencyPlanListPageModule",name:"AddonCompetencyPlanListPage",segment:"addon-competency-planlist",priority:"low",defaultHistory:[]},{loadChildren:"../addon/coursecompletion/pages/report/report.module#AddonModFolderIndexPageModule",name:"AddonCourseCompletionReportPage",segment:"addon-course-completion-report",priority:"low",defaultHistory:[]},{loadChildren:"../addon/files/pages/list/list.module#AddonFilesListPageModule",name:"AddonFilesListPage",segment:"addon-files-list",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mandatory/pages/my-mandatory/my-mandatory.module#AddonMandatoryMyMandatoryPageModule",name:"AddonMandatoryMyMandatoryPage",segment:"addon-mandatory-my-mandatory",priority:"low",defaultHistory:[]},{loadChildren:"../addon/messageoutput/airnotifier/pages/devices/devices.module#AddonMessageOutputAirnotifierDevicesPageModule",name:"AddonMessageOutputAirnotifierDevicesPage",segment:"addon-message-output-airnotifier-devices",priority:"low",defaultHistory:[]},{loadChildren:"../addon/messages/pages/discussion/discussion.module#AddonMessagesDiscussionPageModule",name:"AddonMessagesDiscussionPage",segment:"addon-messages-discussion",priority:"low",defaultHistory:[]},{loadChildren:"../addon/messages/pages/index/index.module#AddonMessagesIndexPageModule",name:"AddonMessagesIndexPage",segment:"addon-messages-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/messages/pages/settings/settings.module#AddonMessagesSettingsPageModule",name:"AddonMessagesSettingsPage",segment:"addon-messages-settings",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/assign/pages/edit-feedback-modal/edit-feedback-modal.module#AddonModAssignEditFeedbackModalPageModule",name:"AddonModAssignEditFeedbackModalPage",segment:"addon-mod-assign-edit-feedback-modal",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/assign/pages/edit/edit.module#AddonModAssignEditPageModule",name:"AddonModAssignEditPage",segment:"addon-mod-assign-edit",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/assign/pages/index/index.module#AddonModAssignIndexPageModule",name:"AddonModAssignIndexPage",segment:"addon-mod-assign-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/assign/pages/submission-list/submission-list.module#AddonModAssignSubmissionListPageModule",name:"AddonModAssignSubmissionListPage",segment:"addon-mod-assign-submission-list",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/assign/pages/submission-review/submission-review.module#AddonModAssignSubmissionReviewPageModule",name:"AddonModAssignSubmissionReviewPage",segment:"addon-mod-assign-submission-review",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/book/pages/index/index.module#AddonModBookIndexPageModule",name:"AddonModBookIndexPage",segment:"addon-mod-book-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/chat/pages/chat/chat.module#AddonModChatChatPageModule",name:"AddonModChatChatPage",segment:"addon-mod-chat-chat",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/chat/pages/index/index.module#AddonModChatIndexPageModule",name:"AddonModChatIndexPage",segment:"addon-mod-chat-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/chat/pages/users/users.module#AddonModChatUsersPageModule",name:"AddonModChatUsersPage",segment:"addon-mod-chat-users",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/choice/pages/index/index.module#AddonModChoiceIndexPageModule",name:"AddonModChoiceIndexPage",segment:"addon-mod-choice-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/data/pages/edit/edit.module#AddonModDataEditPageModule",name:"AddonModDataEditPage",segment:"addon-mod-data-edit",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/data/pages/entry/entry.module#AddonModDataEntryPageModule",name:"AddonModDataEntryPage",segment:"addon-mod-data-entry",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/data/pages/index/index.module#AddonModDataIndexPageModule",name:"AddonModDataIndexPage",segment:"addon-mod-data-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/data/pages/search/search.module#AddonModDataSearchPageModule",name:"AddonModDataSearchPage",segment:"addon-mod-data-search",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/feedback/pages/attempt/attempt.module#AddonModFeedbackAttemptPageModule",name:"AddonModFeedbackAttemptPage",segment:"addon-mod-feedback-attempt",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/feedback/pages/form/form.module#AddonModFeedbackFormPageModule",name:"AddonModFeedbackFormPage",segment:"addon-mod-feedback-form",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/feedback/pages/index/index.module#AddonModFeedbackIndexPageModule",name:"AddonModFeedbackIndexPage",segment:"addon-mod-feedback-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/feedback/pages/nonrespondents/nonrespondents.module#AddonModFeedbackNonRespondentsPageModule",name:"AddonModFeedbackNonRespondentsPage",segment:"addon-mod-feedback-nonrespondents",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/feedback/pages/respondents/respondents.module#AddonModFeedbackRespondentsPageModule",name:"AddonModFeedbackRespondentsPage",segment:"addon-mod-feedback-respondents",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/folder/pages/index/index.module#AddonModFolderIndexPageModule",name:"AddonModFolderIndexPage",segment:"addon-mod-folder-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/forum/pages/discussion/discussion.module#AddonModForumDiscussionPageModule",name:"AddonModForumDiscussionPage",segment:"addon-mod-forum-discussion",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/forum/pages/index/index.module#AddonModForumIndexPageModule",name:"AddonModForumIndexPage",segment:"addon-mod-forum-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/forum/pages/new-discussion/new-discussion.module#AddonModForumNewDiscussionPageModule",name:"AddonModForumNewDiscussionPage",segment:"addon-mod-forum-new-discussion",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/glossary/pages/edit/edit.module#AddonModGlossaryNewDiscussionPageModule",name:"AddonModGlossaryEditPage",segment:"addon-mod-glossary-edit",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/glossary/pages/entry/entry.module#AddonModForumDiscussionPageModule",name:"AddonModGlossaryEntryPage",segment:"addon-mod-glossary-entry",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/glossary/pages/index/index.module#AddonModGlossaryIndexPageModule",name:"AddonModGlossaryIndexPage",segment:"addon-mod-glossary-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/imscp/pages/index/index.module#AddonModImscpIndexPageModule",name:"AddonModImscpIndexPage",segment:"addon-mod-imscp-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lesson/pages/index/index.module#AddonModLessonIndexPageModule",name:"AddonModLessonIndexPage",segment:"addon-mod-lesson-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lesson/pages/menu-modal/menu-modal.module#AddonModLessonMenuModalPageModule",name:"AddonModLessonMenuModalPage",segment:"addon-mod-lesson-menu-modal",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lesson/pages/password-modal/password-modal.module#AddonModLessonPasswordModalPageModule",name:"AddonModLessonPasswordModalPage",segment:"addon-mod-lesson-password-modal",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lesson/pages/player/player.module#AddonModLessonPlayerPageModule",name:"AddonModLessonPlayerPage",segment:"addon-mod-lesson-player",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lesson/pages/user-retake/user-retake.module#AddonModLessonUserRetakePageModule",name:"AddonModLessonUserRetakePage",segment:"addon-mod-lesson-user-retake",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/lti/pages/index/index.module#AddonModLtiIndexPageModule",name:"AddonModLtiIndexPage",segment:"addon-mod-lti-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/page/pages/index/index.module#AddonModPageIndexPageModule",name:"AddonModPageIndexPage",segment:"addon-mod-page-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/attempt/attempt.module#AddonModQuizAttemptPageModule",name:"AddonModQuizAttemptPage",segment:"addon-mod-quiz-attempt",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/index/index.module#AddonModQuizIndexPageModule",name:"AddonModQuizIndexPage",segment:"addon-mod-quiz-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/navigation-modal/navigation-modal.module#AddonModQuizNavigationModalPageModule",name:"AddonModQuizNavigationModalPage",segment:"addon-mod-quiz-navigation-modal",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/player/player.module#AddonModQuizPlayerPageModule",name:"AddonModQuizPlayerPage",segment:"addon-mod-quiz-player",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/preflight-modal/preflight-modal.module#AddonModQuizPreflightModalModule",name:"AddonModQuizPreflightModalPage",segment:"addon-mod-quiz-preflight-modal",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/quiz/pages/review/review.module#AddonModQuizReviewPageModule",name:"AddonModQuizReviewPage",segment:"addon-mod-quiz-review",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/resource/pages/index/index.module#AddonModResourceIndexPageModule",name:"AddonModResourceIndexPage",segment:"addon-mod-resource-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/scorm/pages/index/index.module#AddonModScormIndexPageModule",name:"AddonModScormIndexPage",segment:"addon-mod-scorm-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/scorm/pages/player/player.module#AddonModScormPlayerPageModule",name:"AddonModScormPlayerPage",segment:"addon-mod-scorm-player",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/survey/pages/index/index.module#AddonModSurveyIndexPageModule",name:"AddonModSurveyIndexPage",segment:"addon-mod-survey-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/url/pages/index/index.module#AddonModUrlIndexPageModule",name:"AddonModUrlIndexPage",segment:"addon-mod-url-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/wiki/pages/edit/edit.module#AddonModWikiEditPageModule",name:"AddonModWikiEditPage",segment:"addon-mod-wiki-edit",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/wiki/pages/index/index.module#AddonModWikiIndexPageModule",name:"AddonModWikiIndexPage",segment:"addon-mod-wiki-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/workshop/pages/assessment/assessment.module#AddonModWorkshopAssessmentPageModule",name:"AddonModWorkshopAssessmentPage",segment:"addon-mod-workshop-assessment",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/workshop/pages/edit-submission/edit-submission.module#AddonModWorkshopEditSubmissionPageModule",name:"AddonModWorkshopEditSubmissionPage",segment:"addon-mod-workshop-edit-submission",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/workshop/pages/index/index.module#AddonModWorkshopIndexPageModule",name:"AddonModWorkshopIndexPage",segment:"addon-mod-workshop-index",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/workshop/pages/phase/phase.module#AddonModWorkshopPhaseSelectorPageModule",name:"AddonModWorkshopPhaseSelectorPage",segment:"addon-mod-workshop-phase-selector",priority:"low",defaultHistory:[]},{loadChildren:"../addon/mod/workshop/pages/submission/submission.module#AddonModWorkshopSubmissionPageModule",name:"AddonModWorkshopSubmissionPage",segment:"addon-mod-workshop-submission",priority:"low",defaultHistory:[]},{loadChildren:"../addon/notes/pages/add/add.module#AddonNotesAddPageModule",name:"AddonNotesAddPage",segment:"addon-notes-add",priority:"low",defaultHistory:[]},{loadChildren:"../addon/notifications/pages/list/list.module#AddonNotificationsListPageModule",name:"AddonNotificationsListPage",segment:"addon-notifications-list",priority:"low",defaultHistory:[]},{loadChildren:"../addon/notifications/pages/settings/settings.module#AddonNotificationsSettingsPageModule",name:"AddonNotificationsSettingsPage",segment:"addon-notifications-settings",priority:"low",defaultHistory:[]},{loadChildren:"../addon/resource/pages/my-resource/my-resource.module#AddonResourceMyResourcePageModule",name:"AddonResourceMyResourcePage",segment:"addon-resource-my-resource",priority:"low",defaultHistory:[]},{loadChildren:"../components/split-view/placeholder/placeholder.module#CorePlaceholderPageModule",name:"CoreSplitViewPlaceholderPage",segment:"core-placeholder",priority:"low",defaultHistory:[]},{loadChildren:"../core/comments/pages/viewer/viewer.module#CoreCommentsViewerPageModule",name:"CoreCommentsViewerPage",segment:"core-comments-viewer",priority:"low",defaultHistory:[]},{loadChildren:"../core/contentlinks/pages/choose-site/choose-site.module#CoreContentLinksChooseSitePageModule",name:"CoreContentLinksChooseSitePage",segment:"core-content-links-choose-site",priority:"low",defaultHistory:[]},{loadChildren:"../core/course/pages/section-selector/section-selector.module#CoreCourseSectionSelectorPageModule",name:"CoreCourseSectionSelectorPage",segment:"core-course-section-selector",priority:"low",defaultHistory:[]},{loadChildren:"../core/course/pages/section/section.module#CoreCourseSectionPageModule",name:"CoreCourseSectionPage",segment:"core-course-section",priority:"low",defaultHistory:[]},{loadChildren:"../core/course/pages/unsupported-module/unsupported-module.module#CoreCourseUnsupportedModulePageModule",name:"CoreCourseUnsupportedModulePage",segment:"core-course-unsupported-module",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/available-courses/available-courses.module#CoreCoursesAvailableCoursesPageModule",name:"CoreCoursesAvailableCoursesPage",segment:"core-courses-available-courses",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/categories/categories.module#CoreCoursesCategoriesPageModule",name:"CoreCoursesCategoriesPage",segment:"core-courses-categories",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/course-preview/course-preview.module#CoreCoursesCoursePreviewPageModule",name:"CoreCoursesCoursePreviewPage",segment:"core-courses-course-preview",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/my-courses/my-courses.module#CoreCoursesMyCoursesPageModule",name:"CoreCoursesMyCoursesPage",segment:"core-courses-my-courses",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/my-overview/my-overview.module#CoreCoursesMyOverviewPageModule",name:"CoreCoursesMyOverviewPage",segment:"core-courses-my-overview",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/search/search.module#CoreCoursesSearchPageModule",name:"CoreCoursesSearchPage",segment:"core-courses-search",priority:"low",defaultHistory:[]},{loadChildren:"../core/courses/pages/self-enrol-password/self-enrol-password.module#CoreCoursesSelfEnrolPasswordPageModule",name:"CoreCoursesSelfEnrolPasswordPage",segment:"core-courses-self-enrol-password",priority:"low",defaultHistory:[]},{loadChildren:"../core/emulator/pages/capture-media/capture-media.module#CoreEmulatorCaptureMediaPageModule",name:"CoreEmulatorCaptureMediaPage",segment:"core-emulator-capture-media",priority:"low",defaultHistory:[]},{loadChildren:"../core/grades/pages/course/course.module#CoreGradesCoursePageModule",name:"CoreGradesCoursePage",segment:"core-grades-course",priority:"low",defaultHistory:[]},{loadChildren:"../core/grades/pages/courses/courses.module#CoreGradesCoursesPageModule",name:"CoreGradesCoursesPage",segment:"core-grades-courses",priority:"low",defaultHistory:[]},{loadChildren:"../core/grades/pages/coursesplit/coursesplit.module#CoreGradesCourseSplitPageModule",name:"CoreGradesCourseSplitPage",segment:"core-grades-course-split",priority:"low",defaultHistory:[]},{loadChildren:"../core/grades/pages/grade/grade.module#CoreGradesGradePageModule",name:"CoreGradesGradePage",segment:"core-grades-grade",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/credentials/credentials.module#CoreLoginCredentialsPageModule",name:"CoreLoginCredentialsPage",segment:"core-login-credentials",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/email-signup/email-signup.module#CoreLoginCredentialsPageModule",name:"CoreLoginEmailSignupPage",segment:"core-login-email-signup",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/forgotten-password/forgotten-password.module#CoreLoginForgottenPasswordPageModule",name:"CoreLoginForgottenPasswordPage",segment:"core-login-forgotten-password",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/init/init.module#CoreLoginInitPageModule",name:"CoreLoginInitPage",segment:"core-login-init",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/introduction/introduction.module#CoreLoginIntroductionPageModule",name:"CoreLoginIntroductionPage",segment:"core-login-introduction",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/reconnect/reconnect.module#CoreLoginReconnectPageModule",name:"CoreLoginReconnectPage",segment:"core-login-reconnect",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/site-error/site-error.module#CoreLoginSiteErrorPageModule",name:"CoreLoginSiteErrorPage",segment:"core-login-site-error",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/site-help/site-help.module#CoreLoginSiteHelpPageModule",name:"CoreLoginSiteHelpPage",segment:"core-login-site-help",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/site-policy/site-policy.module#CoreLoginSitePolicyPageModule",name:"CoreLoginSitePolicyPage",segment:"core-login-site-policy",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/site/site.module#CoreLoginSitePageModule",name:"CoreLoginSitePage",segment:"core-login-site",priority:"low",defaultHistory:[]},{loadChildren:"../core/login/pages/sites/sites.module#CoreLoginSitesPageModule",name:"CoreLoginSitesPage",segment:"core-login-sites",priority:"low",defaultHistory:[]},{loadChildren:"../core/mainmenu/pages/menu/menu.module#CoreMainMenuPageModule",name:"CoreMainMenuPage",segment:"core-mainmenu",priority:"low",defaultHistory:[]},{loadChildren:"../core/mainmenu/pages/more/more.module#CoreMainMenuPageModule",name:"CoreMainMenuMorePage",segment:"core-mainmenu-more",priority:"low",defaultHistory:[]},{loadChildren:"../core/settings/pages/about/about.module#CoreSettingsAboutPageModule",name:"CoreSettingsAboutPage",segment:"core-settings-about",priority:"low",defaultHistory:[]},{loadChildren:"../core/settings/pages/general/general.module#CoreSettingsGeneralPageModule",name:"CoreSettingsGeneralPage",segment:"core-settings-general",priority:"low",defaultHistory:[]},{loadChildren:"../core/settings/pages/list/list.module#CoreSettingsListPageModule",name:"CoreSettingsListPage",segment:"core-settings-list",priority:"low",defaultHistory:[]},{loadChildren:"../core/settings/pages/space-usage/space-usage.module#CoreSettingsSpaceUsagePageModule",name:"CoreSettingsSpaceUsagePage",segment:"core-settings-space-usage",priority:"low",defaultHistory:[]},{loadChildren:"../core/settings/pages/synchronization/synchronization.module#CoreSettingsSynchronizationPageModule",name:"CoreSettingsSynchronizationPage",segment:"core-settings-synchronization",priority:"low",defaultHistory:[]},{loadChildren:"../core/sharedfiles/pages/choose-site/choose-site.module#CoreSharedFilesChooseSitePageModule",name:"CoreSharedFilesChooseSitePage",segment:"core-shared-files-choose-site",priority:"low",defaultHistory:[]},{loadChildren:"../core/sharedfiles/pages/list/list.module#CoreSharedFilesListPageModule",name:"CoreSharedFilesListPage",segment:"core-shared-files-list",priority:"low",defaultHistory:[]},{loadChildren:"../core/sitehome/pages/index/index.module#CoreSiteHomeIndexPageModule",name:"CoreSiteHomeIndexPage",segment:"core-sitehome-index",priority:"low",defaultHistory:[]},{loadChildren:"../core/siteplugins/pages/module-index/module-index.module#CoreSitePluginsModuleIndexPageModule",name:"CoreSitePluginsModuleIndexPage",segment:"core-site-plugins-module-index-page",priority:"low",defaultHistory:[]},{loadChildren:"../core/siteplugins/pages/plugin-page/plugin-page.module#CoreSitePluginsPluginPageModule",name:"CoreSitePluginsPluginPage",segment:"core-site-plugins-plugin-page",priority:"low",defaultHistory:[]},{loadChildren:"../core/user/pages/about/about.module#CoreUserAboutPageModule",name:"CoreUserAboutPage",segment:"core-user-about",priority:"low",defaultHistory:[]},{loadChildren:"../core/user/pages/participants/participants.module#CoreUserParticipantsPageModule",name:"CoreUserParticipantsPage",segment:"core-user-participants",priority:"low",defaultHistory:[]},{loadChildren:"../core/user/pages/profile/profile.module#CoreUserProfilePageModule",name:"CoreUserProfilePage",segment:"core-user-profile",priority:"low",defaultHistory:[]},{loadChildren:"../core/viewer/pages/iframe/iframe.module#CoreViewerIframePageModule",name:"CoreViewerIframePage",segment:"core-viewer-iframe",priority:"low",defaultHistory:[]},{loadChildren:"../core/viewer/pages/image/image.module#CoreViewerImagePageModule",name:"CoreViewerImagePage",segment:"core-viewer-image",priority:"low",defaultHistory:[]},{loadChildren:"../core/viewer/pages/text/text.module#CoreViewerTextPageModule",name:"CoreViewerTextPage",segment:"core-viewer-text",priority:"low",defaultHistory:[]}]}),h.b.forRoot({loader:{provide:h.a,useFactory:o,deps:[d.b]}}),W.a,z.a,V.b,Q.b,Y.b,$.b,X.b,J.b,Z.b,ee.b,te.b,ne.b,oe.a,re.a,ie.a,se.b,ae.a,ce.b,ue.b,fe.b,pe.a,he.a,me.b,ge.b,ye.b,ve.b,be.b,_e.a,Pe.a,Ie.b,we.b,Se.b,Re.b,Ee.b,Ce.b,Oe.b,Ae.b,De.b,je.b,xe.b,Te.b,ke.b,Me.b,Ne.b,Ue.b,Fe.a,Le.b,He.b,Be.b,qe.b,Ke.b,Ge.a,de.a,le.a,We.a],bootstrap:[a.j],entryComponents:[g.a],providers:[b.a,_.a,P.a,O.a,w.a,S.a,R.a,E.a,C.a,I.a,A.a,D.a,j.a,x.a,T.a,k.a,M.a,N.a,U.a,F.a,L.a,H.a,q.a,B.a,K.a,G.a,{provide:d.a,useClass:y.a,multi:!0},{provide:s.h,useValue:{},multi:!0},{provide:l.a,useClass:l.a,deps:[s.h]},{provide:f.f,useClass:p.a}]}),Ve("design:paramtypes",[a.s,D.a,q.a,a.e,M.a,j.a])],e)}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){function o(e){var t=r[e];return t?n.e(t[1]).then(function(){return n(t[0])}):Promise.reject(new Error("Cannot find module '"+e+"'."))}var r={"../addon/badges/pages/issued-badge/issued-badge.module":[1786,119],"../addon/badges/pages/user-badges/user-badges.module":[1787,118],"../addon/calendar/pages/event/event.module":[1788,117],"../addon/calendar/pages/list/list.module":[1789,116],"../addon/calendar/pages/settings/settings.module":[1790,115],"../addon/competency/pages/competencies/competencies.module":[1791,114],"../addon/competency/pages/competency/competency.module":[1792,113],"../addon/competency/pages/competencysummary/competencysummary.module":[1793,112],"../addon/competency/pages/coursecompetencies/coursecompetencies.module":[1794,111],"../addon/competency/pages/plan/plan.module":[1795,110],"../addon/competency/pages/planlist/planlist.module":[1796,109],"../addon/coursecompletion/pages/report/report.module":[1797,108],"../addon/files/pages/list/list.module":[1798,107],"../addon/mandatory/pages/my-mandatory/my-mandatory.module":[1799,106],"../addon/messageoutput/airnotifier/pages/devices/devices.module":[1800,105],"../addon/messages/pages/discussion/discussion.module":[1801,104],"../addon/messages/pages/index/index.module":[1802,1],"../addon/messages/pages/settings/settings.module":[1803,0],"../addon/mod/assign/pages/edit-feedback-modal/edit-feedback-modal.module":[1804,103],"../addon/mod/assign/pages/edit/edit.module":[1805,102],"../addon/mod/assign/pages/index/index.module":[1806,101],"../addon/mod/assign/pages/submission-list/submission-list.module":[1807,100],"../addon/mod/assign/pages/submission-review/submission-review.module":[1808,99],"../addon/mod/book/pages/index/index.module":[1809,98],"../addon/mod/chat/pages/chat/chat.module":[1810,97],"../addon/mod/chat/pages/index/index.module":[1811,96],"../addon/mod/chat/pages/users/users.module":[1812,95],"../addon/mod/choice/pages/index/index.module":[1813,94],"../addon/mod/data/pages/edit/edit.module":[1814,93],"../addon/mod/data/pages/entry/entry.module":[1815,92],"../addon/mod/data/pages/index/index.module":[1816,91],"../addon/mod/data/pages/search/search.module":[1817,90],"../addon/mod/feedback/pages/attempt/attempt.module":[1818,89],"../addon/mod/feedback/pages/form/form.module":[1819,88],"../addon/mod/feedback/pages/index/index.module":[1820,87],"../addon/mod/feedback/pages/nonrespondents/nonrespondents.module":[1821,86],"../addon/mod/feedback/pages/respondents/respondents.module":[1822,85],"../addon/mod/folder/pages/index/index.module":[1823,84],"../addon/mod/forum/pages/discussion/discussion.module":[1824,83],"../addon/mod/forum/pages/index/index.module":[1825,82],"../addon/mod/forum/pages/new-discussion/new-discussion.module":[1826,81],"../addon/mod/glossary/pages/edit/edit.module":[1827,80],"../addon/mod/glossary/pages/entry/entry.module":[1828,79],"../addon/mod/glossary/pages/index/index.module":[1829,78],"../addon/mod/imscp/pages/index/index.module":[1830,77],"../addon/mod/lesson/pages/index/index.module":[1831,76],"../addon/mod/lesson/pages/menu-modal/menu-modal.module":[1832,75],"../addon/mod/lesson/pages/password-modal/password-modal.module":[1833,74],"../addon/mod/lesson/pages/player/player.module":[1834,73],"../addon/mod/lesson/pages/user-retake/user-retake.module":[1835,72],"../addon/mod/lti/pages/index/index.module":[1836,71],"../addon/mod/page/pages/index/index.module":[1837,70],"../addon/mod/quiz/pages/attempt/attempt.module":[1838,69],"../addon/mod/quiz/pages/index/index.module":[1839,68],"../addon/mod/quiz/pages/navigation-modal/navigation-modal.module":[1840,67],"../addon/mod/quiz/pages/player/player.module":[1841,5],"../addon/mod/quiz/pages/preflight-modal/preflight-modal.module":[1842,66],"../addon/mod/quiz/pages/review/review.module":[1843,65],"../addon/mod/resource/pages/index/index.module":[1844,64],"../addon/mod/scorm/pages/index/index.module":[1845,63],"../addon/mod/scorm/pages/player/player.module":[1846,4],"../addon/mod/survey/pages/index/index.module":[1847,62],"../addon/mod/url/pages/index/index.module":[1848,61],"../addon/mod/wiki/pages/edit/edit.module":[1849,60],"../addon/mod/wiki/pages/index/index.module":[1850,59],"../addon/mod/workshop/pages/assessment/assessment.module":[1851,58],"../addon/mod/workshop/pages/edit-submission/edit-submission.module":[1852,57],"../addon/mod/workshop/pages/index/index.module":[1853,56],"../addon/mod/workshop/pages/phase/phase.module":[1854,55],"../addon/mod/workshop/pages/submission/submission.module":[1855,3],"../addon/notes/pages/add/add.module":[1856,54],"../addon/notifications/pages/list/list.module":[1857,2],"../addon/notifications/pages/settings/settings.module":[1858,53],"../addon/resource/pages/my-resource/my-resource.module":[1859,52],"../components/split-view/placeholder/placeholder.module":[1860,51],"../core/comments/pages/viewer/viewer.module":[1861,50],"../core/contentlinks/pages/choose-site/choose-site.module":[1862,49],"../core/course/pages/section-selector/section-selector.module":[1863,48],"../core/course/pages/section/section.module":[1864,120],"../core/course/pages/unsupported-module/unsupported-module.module":[1865,47],"../core/courses/pages/available-courses/available-courses.module":[1866,46],"../core/courses/pages/categories/categories.module":[1867,45],"../core/courses/pages/course-preview/course-preview.module":[1868,44],"../core/courses/pages/my-courses/my-courses.module":[1869,43],"../core/courses/pages/my-overview/my-overview.module":[1870,42],"../core/courses/pages/search/search.module":[1871,41],"../core/courses/pages/self-enrol-password/self-enrol-password.module":[1872,40],"../core/emulator/pages/capture-media/capture-media.module":[1873,39],"../core/grades/pages/course/course.module":[1874,38],"../core/grades/pages/courses/courses.module":[1875,37],"../core/grades/pages/coursesplit/coursesplit.module":[1876,36],"../core/grades/pages/grade/grade.module":[1877,35],"../core/login/pages/credentials/credentials.module":[1878,34],"../core/login/pages/email-signup/email-signup.module":[1879,33],"../core/login/pages/forgotten-password/forgotten-password.module":[1880,32],"../core/login/pages/init/init.module":[1881,31],"../core/login/pages/introduction/introduction.module":[1882,30],"../core/login/pages/reconnect/reconnect.module":[1883,29],"../core/login/pages/site-error/site-error.module":[1884,28],"../core/login/pages/site-help/site-help.module":[1885,27],"../core/login/pages/site-policy/site-policy.module":[1886,26],"../core/login/pages/site/site.module":[1887,25],"../core/login/pages/sites/sites.module":[1888,24],"../core/mainmenu/pages/menu/menu.module":[1889,23],"../core/mainmenu/pages/more/more.module":[1890,22],"../core/settings/pages/about/about.module":[1891,21],"../core/settings/pages/general/general.module":[1892,20],"../core/settings/pages/list/list.module":[1893,19],"../core/settings/pages/space-usage/space-usage.module":[1894,18],"../core/settings/pages/synchronization/synchronization.module":[1895,17],"../core/sharedfiles/pages/choose-site/choose-site.module":[1896,16],"../core/sharedfiles/pages/list/list.module":[1897,15],"../core/sitehome/pages/index/index.module":[1898,14],"../core/siteplugins/pages/module-index/module-index.module":[1899,13],"../core/siteplugins/pages/plugin-page/plugin-page.module":[1900,12],"../core/user/pages/about/about.module":[1901,11],"../core/user/pages/participants/participants.module":[1902,10],"../core/user/pages/profile/profile.module":[1903,9],"../core/viewer/pages/iframe/iframe.module":[1904,8],"../core/viewer/pages/image/image.module":[1905,7],"../core/viewer/pages/text/text.module":[1906,6]};o.keys=function(){return Object.keys(r)},o.id=480,e.exports=o},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e,t,n){this.name=e,this.sqlite=t,this.platform=n,this.init()}return e.prototype.buildCreateTableSql=function(e,t,n,o,r,i){var s=[],a="CREATE TABLE IF NOT EXISTS "+e+" (";for(var c in t){var u=t[c],d=u.name||"";u.type&&(d+=" "+u.type),u.primaryKey&&(d+=" PRIMARY KEY",u.autoIncrement&&(d+=" AUTOINCREMENT")),u.notNull&&(d+=" NOT NULL"),u.unique&&(d+=" UNIQUE"),u.check&&(d+=" CHECK ("+u.check+")"),void 0!==u.default&&(d+=" DEFAULT "+u.default),s.push(d)}if(a+=s.join(", "),n&&n.length&&(a+=", PRIMARY KEY ("+n.join(", ")+")"),o&&o.length)for(var c in o){var l=o[c];l&&l.length&&(a+=", UNIQUE ("+l.join(", ")+")")}i&&(a+=", CHECK ("+i+")");for(var c in r){var f=r[c];if(!f.columns||f.columns.length)return;a+=", FOREIGN KEY ("+f.columns.join(", ")+") REFERENCES "+f.table+" ",f.foreignColumns&&f.foreignColumns.length&&(a+="("+f.foreignColumns.join(", ")+")"),f.actions&&(a+=" "+f.actions)}return a+")"},e.prototype.close=function(){var e=this;return this.ready().then(function(){return e.db.close()})},e.prototype.countRecords=function(e,t){var n=this.whereClause(t);return this.countRecordsSelect(e,n[0],n[1])},e.prototype.countRecordsSelect=function(e,t,n,o){return void 0===t&&(t=""),void 0===o&&(o="COUNT('x')"),t&&(t="WHERE "+t),this.countRecordsSql("SELECT "+o+" FROM "+e+" "+t,n)},e.prototype.countRecordsSql=function(e,t){return this.getFieldSql(e,t).then(function(e){return"number"!=typeof e||e<0?0:e})},e.prototype.createTable=function(e,t,n,o,r,i){var s=this.buildCreateTableSql(e,t,n,o,r,i);return this.execute(s)},e.prototype.createTableFromSchema=function(e){return this.createTable(e.name,e.columns,e.primaryKeys,e.uniqueKeys,e.foreignKeys,e.tableCheck)},e.prototype.createTablesFromSchema=function(e){var t=this,n=[];return e.forEach(function(e){n.push(t.createTableFromSchema(e))}),Promise.all(n)},e.prototype.deleteRecords=function(e,t){if(null===t||void 0===t)return this.execute("DELETE FROM "+e);var n=this.whereClause(t);return this.deleteRecordsSelect(e,n[0],n[1])},e.prototype.deleteRecordsList=function(e,t,n){var o=this.whereClauseList(t,n);return this.deleteRecordsSelect(e,o[0],o[1])},e.prototype.deleteRecordsSelect=function(e,t,n){return void 0===t&&(t=""),t&&(t="WHERE "+t),this.execute("DELETE FROM "+e+" "+t,n)},e.prototype.execute=function(e,t){var n=this;return this.ready().then(function(){return n.db.executeSql(e,t)})},e.prototype.executeBatch=function(e){var t=this;return this.ready().then(function(){return t.db.sqlBatch(e)})},e.prototype.formatDataToInsert=function(e){if(e)for(var t in e){void 0===e[t]&&delete e[t]}},e.prototype.getAllRecords=function(e){return this.getRecords(e)},e.prototype.getField=function(e,t,n){var o=this.whereClause(n);return this.getFieldSelect(e,t,o[0],o[1])},e.prototype.getFieldSelect=function(e,t,n,o){return void 0===n&&(n=""),n&&(n="WHERE "+n),this.getFieldSql("SELECT "+t+" FROM "+e+" "+n,o)},e.prototype.getFieldSql=function(e,t){return this.getRecordSql(e,t).then(function(e){return e?e[Object.keys(e)[0]]:Promise.reject(null)})},e.prototype.getInOrEqual=function(e,t,n){void 0===t&&(t=!0);var o,r;if(void 0===n&&(n=!1),Array.isArray(e)&&!e.length&&!1===n)return["",[]];if(Array.isArray(e)&&!e.length){if(null===n)return o=t?" IS NULL":" IS NOT NULL",[o,[]];e=[n]}return Array.isArray(e)&&1!=e.length?(o=(t?"":"NOT ")+"IN ("+",?".repeat(e.length).substr(1)+")",r=e):(o=t?"= ?":"<> ?",r=Array.isArray(e)?e:[e]),[o,r]},e.prototype.getName=function(){return this.name},e.prototype.getRecord=function(e,t,n){void 0===n&&(n="*");var o=this.whereClause(t);return this.getRecordSelect(e,o[0],o[1],n)},e.prototype.getRecordSelect=function(e,t,n,o){return void 0===t&&(t=""),void 0===n&&(n=[]),void 0===o&&(o="*"),t&&(t=" WHERE "+t),this.getRecordSql("SELECT "+o+" FROM "+e+" "+t,n)},e.prototype.getRecordSql=function(e,t){return this.getRecordsSql(e,t,0,1).then(function(e){return e&&e.length?e[0]:Promise.reject(null)})},e.prototype.getRecords=function(e,t,n,o,r,i){void 0===n&&(n=""),void 0===o&&(o="*"),void 0===r&&(r=0),void 0===i&&(i=0);var s=this.whereClause(t);return this.getRecordsSelect(e,s[0],s[1],n,o,r,i)},e.prototype.getRecordsList=function(e,t,n,o,r,i,s){void 0===o&&(o=""),void 0===r&&(r="*"),void 0===i&&(i=0),void 0===s&&(s=0);var a=this.whereClauseList(t,n);return this.getRecordsSelect(e,a[0],a[1],o,r,i,s)},e.prototype.getRecordsSelect=function(e,t,n,o,r,i,s){void 0===t&&(t=""),void 0===n&&(n=[]),void 0===o&&(o=""),void 0===r&&(r="*"),void 0===i&&(i=0),void 0===s&&(s=0),t&&(t=" WHERE "+t),o&&(o=" ORDER BY "+o);return this.getRecordsSql("SELECT "+r+" FROM "+e+" "+t+" "+o,n,i,s)},e.prototype.getRecordsSql=function(e,t,n,o){var r=this.normaliseLimitFromNum(n,o);return(r[0]||r[1])&&(r[1]<1&&(r[1]=Number.MAX_VALUE),e+=" LIMIT "+r[0]+", "+r[1]),this.execute(e,t).then(function(e){for(var t=[],n=0;n<e.rows.length;n++)t.push(e.rows.item(n));return t})},e.prototype.getSqlInsertQuery=function(e,t){this.formatDataToInsert(t);var n=Object.keys(t);return["INSERT OR REPLACE INTO "+e+" ("+n.join(",")+") VALUES ("+",?".repeat(n.length).substr(1)+")",n.map(function(e){return t[e]})]},e.prototype.init=function(){var e=this;this.promise=this.platform.ready().then(function(){return e.sqlite.create({name:e.name,location:"default"})}).then(function(t){e.db=t})},e.prototype.insertRecord=function(e,t){var n=this.getSqlInsertQuery(e,t);return this.execute(n[0],n[1]).then(function(e){return e.insertId})},e.prototype.insertRecords=function(e,t){var n=this;if(!Array.isArray(t))return Promise.reject(null);var o=[];return t.forEach(function(t){o.push(n.getSqlInsertQuery(e,t))}),this.executeBatch(o)},e.prototype.normaliseLimitFromNum=function(e,t){return void 0!==e&&null!==e&&""!==e&&-1!==e||(e=0),void 0!==t&&null!==t&&""!==t&&-1!==t||(t=0),e=parseInt(e,10),t=parseInt(t,10),e=Math.max(0,e),t=Math.max(0,t),[e,t]},e.prototype.open=function(){var e=this;return this.ready().then(function(){return e.db.open()})},e.prototype.ready=function(){return this.promise},e.prototype.recordExists=function(e,t){return this.getRecord(e,t).then(function(e){if(!e)return Promise.reject(null)})},e.prototype.recordExistsSelect=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n=[]),this.getRecordSelect(e,t,n).then(function(e){if(!e)return Promise.reject(null)})},e.prototype.recordExistsSql=function(e,t){return this.getRecordSql(e,t).then(function(e){if(!e)return Promise.reject(null)})},e.prototype.updateRecords=function(e,t,n){if(this.formatDataToInsert(t),!t||!Object.keys(t).length)return Promise.resolve();var o,r,i=this.whereClause(n),s=[];for(var a in t)s.push(a+" = ?");return o="UPDATE "+e+" SET "+s.join(", ")+" WHERE "+i[0],r=Object.keys(t).map(function(e){return t[e]}).concat(i[1]),this.execute(o,r)},e.prototype.updateRecordsWhere=function(e,t,n,o){if(!t||!Object.keys(t).length)return Promise.resolve();var r,i,s=[];for(var a in t)s.push(a+" = ?");return r="UPDATE "+e+" SET "+s.join(", "),n&&(r+=" WHERE "+n),i=Object.keys(t).map(function(e){return t[e]}),n&&o&&(i=i.concat(o)),this.execute(r,i)},e.prototype.whereClause=function(e){if(void 0===e&&(e={}),!e||!Object.keys(e).length)return["1 = 1",[]];var t=[],n=[];for(var o in e){var r=e[o];void 0===r||null===r?t.push(o+" IS NULL"):(t.push(o+" = ?"),n.push(r))}return[t.join(" AND "),n]},e.prototype.whereClauseList=function(e,t){if(!t||!t.length)return["1 = 2",[]];var n=[],o="";if(t.forEach(function(t){"boolean"==typeof t&&(t=Number(t)),void 0===t||null===t?o=e+" IS NULL":n.push(t)}),n&&n.length)if(""!==o&&(o+=" OR "),1==n.length)o=o+e+" = ?";else{var r=",?".repeat(n.length).substr(1);o=o+e+" IN ("+r+")"}return[o,n]},e}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(1276),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.injector=e}return e.prototype.makeSite=function(e,t,n,o,i,s,a){return new r.a(this.injector,e,t,n,o,i,s,a)},e.prototype.getSiteMethods=function(){var e=[];for(var t in r.a.prototype)e.push(t);return e},e=i([Object(o.A)(),s("design:paramtypes",[o.C])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(9),s=n(7),a=n(18),c=n(2),u=n(8),d=n(47),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s,a){this.filepoolProvider=n,this.platform=o,this.sitesProvider=r,this.domUtils=i,this.urlUtils=s,this.appProvider=a,this.element=e.nativeElement||e,this.logger=t.getInstance("CoreExternalContentDirective")}return e.prototype.ngAfterViewInit=function(){var e,t,n=this.sitesProvider.getCurrentSite(),o=this.siteId||n&&n.getId(),r=this.element.tagName;if("A"===r)e="href",t="href";else if("IMG"===r)e="src",t="src";else{if("AUDIO"!==r&&"VIDEO"!==r&&"SOURCE"!==r&&"TRACK"!==r)return void this.logger.warn("Directive attached to non-supported tag: "+r);if(e="src",t="target-src","VIDEO"===r){var i=this.element.poster;i&&this.handleExternalContent("poster",i,o).catch(function(){})}}var s=this.element.getAttribute(t)||this.element.getAttribute(e);this.handleExternalContent(e,s,o).catch(function(){})},e.prototype.addSource=function(e){if("SOURCE"===this.element.tagName){var t=document.createElement("source"),n=this.element.getAttribute("type");t.setAttribute("src",e),n&&(this.platform.is("android")&&"video/quicktime"==n?t.setAttribute("type","video/mp4"):t.setAttribute("type",n)),this.element.parentNode.insertBefore(t,this.element)}},e.prototype.handleExternalContent=function(e,t,n){var o=this,r=this.element.tagName;if("VIDEO"==r&&"poster"!=e){var i=this.element;i.textTracks&&(i.textTracks.onaddtrack=function(e){var t=e.track;t&&(t.oncuechange=function(){var e=o.platform.is("tablet")||o.platform.is("android")?90:80;Array.from(t.cues).forEach(function(t){t.snapToLines=!1,t.line=e,t.size=100}),t.oncuechange=null})})}return t&&t.match(/^https?:\/\//i)&&("A"!==r||this.urlUtils.isDownloadableUrl(t))?this.sitesProvider.getSite(n).then(function(i){if(!i.canDownloadFiles()&&o.urlUtils.isPluginFileUrl(t))return o.element.parentElement.removeChild(o.element),Promise.reject(null);var s="IMG"==r||"TRACK"==r||"poster"==e;return("src"===e&&"SOURCE"!==r&&"TRACK"!==r?o.filepoolProvider.getSrcByUrl(n,t,o.component,o.componentId,0,!0,s):o.filepoolProvider.getUrlByUrl(n,t,o.component,o.componentId,0,!0,s)).then(function(i){if(o.logger.debug("Using URL "+i+" for "+t),"SOURCE"===r?o.addSource(i):o.element.setAttribute(e,i),0===i.indexOf("http")&&"poster"!=e&&("VIDEO"==r||"AUDIO"==r||"A"==r||"SOURCE"==r)){var s="A"==r?"click":"play",a=o.element;if("SOURCE"==r&&!(a=o.domUtils.closest(o.element,"video,audio")))return;a.addEventListener(s,function(){o.appProvider.isNetworkAccessLimited()||o.filepoolProvider.getUrlByUrl(n,t,o.component,o.componentId,0,!1)})}})}):(this.logger.debug("Ignoring non-downloadable URL: "+t),"SOURCE"===r&&this.addSource(t),Promise.reject(null))},l([Object(o.D)(),f("design:type",String)],e.prototype,"siteId",void 0),l([Object(o.D)(),f("design:type",String)],e.prototype,"component",void 0),l([Object(o.D)(),f("design:type",Object)],e.prototype,"componentId",void 0),e=l([Object(o.s)({selector:"[core-external-content]"}),f("design:paramtypes",[o.t,s.a,a.a,r.s,c.a,u.a,d.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(2),s=n(8),a=n(47),c=n(6),u=n(32),d=n(72),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},h=function(){function e(e,t,n,o,r,i,s,a){this.domUtils=t,this.utils=n,this.sitesProvider=o,this.urlUtils=r,this.contentLinksHelper=i,this.navCtrl=s,this.content=a,this.autoLogin="check",this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.inApp=this.utils.isTrueOrOne(this.inApp),this.element.addEventListener("click",function(t){if(!t.defaultPrevented){var n=e.element.getAttribute("href");n&&(t.preventDefault(),t.stopPropagation(),e.utils.isTrueOrOne(e.capture)?e.contentLinksHelper.handleLink(n,void 0,e.navCtrl).then(function(t){t||e.navigate(n)}):e.navigate(n))}})},e.prototype.navigate=function(e){var t=this,n=d.a.customurlscheme+"://link=";0===e.indexOf("cdvfile://")||0===e.indexOf("file://")||0===e.indexOf("filesystem:")?this.utils.openFile(e).catch(function(e){t.domUtils.showErrorModal(e)}):"#"==e.charAt(0)?"/"==(e=e.substr(1)).charAt(0)||this.domUtils.scrollToElementBySelector(this.content,"#"+e+", [name='"+e+"']"):0===e.indexOf(n)?(e=n+encodeURIComponent(e.replace(n,"")),this.utils.openInBrowser(e)):this.sitesProvider.isLoggedIn()?(this.urlUtils.isAbsoluteURL(e)||(e="/"==e.charAt(0)?this.sitesProvider.getCurrentSite().getURL()+e:this.sitesProvider.getCurrentSite().getURL()+"/"+e),"yes"==this.autoLogin?this.inApp?this.sitesProvider.getCurrentSite().openInAppWithAutoLogin(e):this.sitesProvider.getCurrentSite().openInBrowserWithAutoLogin(e):"no"==this.autoLogin?this.inApp?this.utils.openInApp(e):this.utils.openInBrowser(e):this.inApp?this.sitesProvider.getCurrentSite().openInAppWithAutoLoginIfSameSite(e):this.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(e)):this.inApp?this.utils.openInApp(e):this.utils.openInBrowser(e)},l([Object(o.D)(),f("design:type",Object)],e.prototype,"capture",void 0),l([Object(o.D)(),f("design:type",Object)],e.prototype,"inApp",void 0),l([Object(o.D)(),f("design:type",Object)],e.prototype,"autoLogin",void 0),e=l([Object(o.s)({selector:"[core-link]"}),p(6,Object(o.N)()),p(7,Object(o.N)()),f("design:paramtypes",[o.t,s.a,c.a,i.a,a.a,u.a,r.q,r.f])],e)}()},,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(8),a=n(721),c=n(722),u=n(96),d=(n.n(u),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},p=function(){function e(e,t,n,o,r){var i=this;this.translate=e,this.popoverCtrl=t,this.domUtils=o,this.coreTab=r,this.items=[],this.itemsMovedToParent=[],this.itemsChangedStream=new u.Subject,this.itemsChangedStream.auditTime(250).subscribe(function(){i.hideMenu=!i.items.some(function(e){return!e.hidden}),i.items.sort(function(e,t){return e.priority<=t.priority?1:-1})}),this.instanceId=this.domUtils.storeInstanceByElement(n.nativeElement,this)}return e.prototype.ngOnInit=function(){this.icon=this.icon||"more",this.ariaLabel=this.title||this.translate.instant("core.info")},e.prototype.addItem=function(e){this.parentContextMenu?(this.parentContextMenu.addItem(e),-1==this.itemsMovedToParent.indexOf(e)&&this.itemsMovedToParent.push(e)):-1==this.items.indexOf(e)&&(this.items.push(e),this.itemsChanged())},e.prototype.itemsChanged=function(){this.parentContextMenu?this.parentContextMenu.itemsChanged():this.itemsChangedStream.next()},e.prototype.mergeContextMenus=function(e){this.parentContextMenu=e;for(var t=0;t<this.items.length;t++){var n=this.items[t];e.addItem(n),this.itemsMovedToParent.push(n)}this.items=[],this.itemsChanged()},e.prototype.removeItem=function(e){if(this.parentContextMenu){this.parentContextMenu.removeItem(e);(t=this.itemsMovedToParent.indexOf(e))>=0&&this.itemsMovedToParent.splice(t,1)}else{var t;(t=this.items.indexOf(e))>=0&&this.items.splice(t,1),this.itemsChanged()}},e.prototype.removeMergedItems=function(){if(this.parentContextMenu)for(var e=0;e<this.itemsMovedToParent.length;e++)this.parentContextMenu.removeItem(this.itemsMovedToParent[e])},e.prototype.restoreMergedItems=function(){if(this.parentContextMenu)for(var e=0;e<this.itemsMovedToParent.length;e++)this.parentContextMenu.addItem(this.itemsMovedToParent[e])},e.prototype.showContextMenu=function(e){this.popoverCtrl.create(a.a,{title:this.title,items:this.items}).present({ev:e})},e.prototype.ngOnDestroy=function(){this.domUtils.removeInstanceById(this.instanceId),this.removeMergedItems()},d([Object(o.D)(),l("design:type",String)],e.prototype,"icon",void 0),d([Object(o.D)(),l("design:type",String)],e.prototype,"title",void 0),e=d([Object(o.m)({selector:"core-context-menu",template:'<button [hidden]="hideMenu" ion-button clear icon-only [attr.aria-label]="ariaLabel" (click)="showContextMenu($event)">\n    <core-icon [name]="icon"></core-icon>\n</button>\n<ng-content></ng-content>'}),f(4,Object(o.N)()),l("design:paramtypes",[i.c,r.t,o.t,s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=n(7),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.viewCtrl=t,this.title=e.get("title"),this.items=e.get("items")||[],this.logger=n.getInstance("CoreContextMenuPopoverComponent")}return e.prototype.closeMenu=function(){this.viewCtrl.dismiss()},e.prototype.itemClicked=function(e,t){if(t.action.observers.length>0){if(e.preventDefault(),e.stopPropagation(),!t.iconAction)return this.logger.warn("Items with action must have an icon action to work",t),!1;if("spinner"==t.iconAction)return!1;t.closeOnClick&&this.closeMenu(),t.action.emit(this.closeMenu.bind(this))}else t.href&&t.closeOnClick&&this.closeMenu();return!0},e=s([Object(o.m)({selector:"core-context-menu-popover",template:'<ion-list>\n    <ion-list-header *ngIf="title">{{title}}</ion-list-header>\n    <a ion-item text-wrap *ngFor="let item of items" core-link [capture]="item.captureLink" [autoLogin]="item.autoLogin" [href]="item.href" (click)="itemClicked($event, item)" [attr.aria-label]="item.ariaAction" [hidden]="item.hidden" [attr.detail-none]="!item.href || item.iconAction">\n        <core-icon *ngIf="item.iconDescription" [name]="item.iconDescription" [attr.aria-label]="item.ariaDescription" item-start></core-icon>\n        <core-format-text [clean]="true" [text]="item.content"></core-format-text>\n        <core-icon *ngIf="(item.href || item.action) && item.iconAction && item.iconAction != \'spinner\'" [name]="item.iconAction" item-end></core-icon>\n        <ion-spinner *ngIf="(item.href || item.action) && item.iconAction == \'spinner\'" item-end></ion-spinner>\n        <ion-badge class="{{item.badgeClass}}" item-end *ngIf="item.badge">{{item.badge}}</ion-badge>\n    </a>\n</ion-list>'}),a("design:paramtypes",[r.r,r.B,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(135),i=n(4),s=n(8),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.tabs=e,this.domUtils=n,this.enabled=!0,this.ionSelect=new o.v,this.loaded=!1,this.initialized=!1,this._show=!0,this.element=t.nativeElement}return Object.defineProperty(e.prototype,"show",{get:function(){return this._show},set:function(e){if(void 0!==e){var t=this._show!=e;this._show=e,this.initialized&&t&&this.tabs.tabVisibilityChanged()}},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){this.tabs.addTab(this),this.initialized=!0},e.prototype.ngOnDestroy=function(){this.tabs.removeTab(this)},e.prototype.selectTab=function(){var e=this;this.element.classList.add("selected"),this.loaded=!0,this.ionSelect.emit(this),this.showHideNavBarButtons(!0),setTimeout(function(){e.scroll&&(e.scroll.getScrollElement().onscroll=function(t){e.tabs.showHideTabs(t)})},1)},e.prototype.unselectTab=function(){this.element.classList.remove("selected"),this.showHideNavBarButtons(!1)},e.prototype.getChildrenNavBarButtons=function(){for(var e=this.element.querySelectorAll("core-navbar-buttons"),t=[],n=0;n<e.length;n++){var o=this.domUtils.getInstanceByElement(e[n]);o&&t.push(o)}return t},e.prototype.showHideNavBarButtons=function(e){var t=this.getChildrenNavBarButtons();for(var n in t)t[n].forceHide(!e)},a([Object(o.D)(),c("design:type",String)],e.prototype,"title",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"icon",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"badge",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"badgeStyle",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"enabled",void 0),a([Object(o.D)(),c("design:type",Boolean),c("design:paramtypes",[Boolean])],e.prototype,"show",null),a([Object(o.D)(),c("design:type",String)],e.prototype,"id",void 0),a([Object(o.O)(),c("design:type",o.v)],e.prototype,"ionSelect",void 0),a([Object(o.q)(o._6),c("design:type",o._6)],e.prototype,"template",void 0),a([Object(o.q)(i.f),c("design:type",i.f)],e.prototype,"scroll",void 0),e=a([Object(o.m)({selector:"core-tab",template:'<ng-container *ngIf="loaded" [ngTemplateOutlet]="template"></ng-container>'}),c("design:paramtypes",[r.a,o.t,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.viewCtrl=e,this.expired=!1,this.value="",this.src=t.get("src")}return e.prototype.closeModal=function(){this.viewCtrl.dismiss({expired:this.expired,value:this.value})},e.prototype.loaded=function(e){var t=this,n=e&&e.contentWindow;n&&(n.recaptchacallback=function(e){t.expired=!1,t.value=e,t.closeModal()},n.recaptchaexpiredcallback=function(){t.expired=!0,t.value=""})},e=i([Object(o.m)({selector:"core-recaptcha-modal",template:'<ion-header>\n    <ion-navbar>\n        <ion-title>{{ \'core.login.security_question\' | translate }}</ion-title>\n\n        <ion-buttons end>\n            <button ion-button icon-only (click)="closeModal()" [attr.aria-label]="\'core.close\' | translate">\n                <ion-icon name="close"></ion-icon>\n            </button>\n        </ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <core-iframe [src]="src" (loaded)="loaded($event)"></core-iframe>\n</ion-content>'}),s("design:paramtypes",[r.B,r.r])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(6),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},d=function(e){function t(t,n,o,r,i,s,a,c,u,d){var l=e.call(this,n,o,r,i,s,a,c,u,d)||this;return l.utils=t,l.tabsNotInit=[],l.tabsIds=[],l.tabsNotInitIds=[],l.viewInit=!1,l.initialized=!1,l}return s(t,e),n=t,Object.defineProperty(t.prototype,"loaded",{set:function(e){var t=this;this._loaded=this.utils.isTrueOrOne(e),this.viewInit&&!this.initialized&&setTimeout(function(){t.initTabs()})},enumerable:!0,configurable:!0}),t.prototype.ngAfterViewInit=function(){this.viewInit=!0,e.prototype.ngAfterViewInit.call(this)},t.prototype.add=function(e,t){var n=this._tabs.indexOf(e);if(-1!=n)return this.tabsIds[n];if(-1!=(n=this.tabsNotInit.indexOf(e))){if(!t)return this.tabsNotInitIds[n];var o=this.tabsNotInitIds[n];return this.tabsNotInit.splice(n,1),this.tabsNotInitIds.splice(n,1),this._tabs.push(e),this.tabsIds.push(o),this.sortTabs(),o}var r=this.id+"-"+ ++this._ids;return t?(this._tabs.push(e),this.tabsIds.push(r),this.sortTabs()):(this.tabsNotInit.push(e),this.tabsNotInitIds.push(r)),r},t.prototype.initTabs=function(){var t=this;return this.initialized||!this._loaded&&void 0!==this._loaded?(this.setTabbarPosition(-1,0),Promise.resolve()):(this.initialized=!0,e.prototype.initTabs.call(this).then(function(){if(t.selectedDisabled&&void 0!==t.selectedIndex){var e=t.getByIndex(t.selectedIndex);!e||e.enabled&&e.show||t.select(e)}}))},t.prototype.remove=function(e){var t=this._tabs.indexOf(e);-1!=t?(this._tabs.splice(t,1),this.tabsIds.splice(t,1)):-1!=(t=this.tabsNotInit.indexOf(e))&&(this.tabsNotInit.splice(t,1),this.tabsNotInitIds.splice(t,1))},t.prototype.sortTabs=function(){var e=this;if(this.originalTabsRef){var t=[],n=[],o=this.originalTabsRef.nativeElement;this._tabs.forEach(function(r,i){var s=Array.prototype.indexOf.call(o.children,r.getNativeElement());-1!=s&&(t[s]=r,n[s]=e.tabsIds[i])}),this._tabs=t.filter(function(e){return void 0!==e}),this.tabsIds=n.filter(function(e){return void 0!==e})}},a([Object(o.D)(),c("design:type",Boolean),c("design:paramtypes",[Boolean])],t.prototype,"loaded",null),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"selectedDisabled",void 0),a([Object(o._9)("originalTabs"),c("design:type",o.t)],t.prototype,"originalTabsRef",void 0),t=n=a([Object(o.m)({selector:"core-ion-tabs",template:'<div class="tabbar" role="tablist" #tabbar>\n    <a [hidden]="_loaded === false" *ngFor="let t of _tabs" [tab]="t" class="tab-button" role="tab" href="#" (ionSelect)="select(t)"></a>\n    <div class="tab-highlight"></div>\n    <div *ngIf="_loaded === false" class="core-ion-tabs-loading">\n        <span class="core-ion-tabs-loading-spinner">\n            <ion-spinner></ion-spinner>\n        </span>\n    </div>\n</div>\n<div #originalTabs>\n    <ng-content></ng-content>\n</div>\n<div #portal tab-portal></div>\n',encapsulation:o._12.None,providers:[{provide:r.u,useExisting:Object(o._15)(function(){return n})}]}),u(1,Object(o.N)()),u(2,Object(o.N)()),c("design:paramtypes",[i.a,r.q,r.B,r.c,r.e,o.t,r.s,o.V,r.g,r.m])],t);var n}(r.y)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(9),s=n(8),a=n(162),c=n(396),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r){this.navCtrl=e,this.appProvider=t,this.domUtils=n,this.competencyProvider=o,this.helperProvider=r,this.competenciesLoaded=!1}return e.prototype.ngOnInit=function(){var e=this;this.fetchCourseCompetencies().finally(function(){e.competenciesLoaded=!0})},e.prototype.fetchCourseCompetencies=function(){var e=this;return this.competencyProvider.getCourseCompetencies(this.courseId,this.userId).then(function(t){e.competencies=t,e.helperProvider.getProfile(e.userId).then(function(t){e.user=t})}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Error getting course competencies data.")})},e.prototype.openCompetency=function(e){this.appProvider.isWide()?this.navCtrl.push("AddonCompetencyCompetenciesPage",{competencyId:e,courseId:this.courseId,userId:this.userId}):this.navCtrl.push("AddonCompetencyCompetencyPage",{competencyId:e,courseId:this.courseId,userId:this.userId})},e.prototype.openCompetencySummary=function(e){this.navCtrl.push("AddonCompetencyCompetencySummaryPage",{competencyId:e})},e.prototype.refreshCourseCompetencies=function(e){var t=this;this.competencyProvider.invalidateCourseCompetencies(this.courseId,this.userId).finally(function(){t.fetchCourseCompetencies().finally(function(){e.complete()})})},u([Object(o._9)(r.f),d("design:type",r.f)],e.prototype,"content",void 0),u([Object(o.D)(),d("design:type",Number)],e.prototype,"courseId",void 0),u([Object(o.D)(),d("design:type",Number)],e.prototype,"userId",void 0),e=u([Object(o.m)({selector:"addon-competency-course",template:'<ion-content>\n    <ion-refresher [enabled]="competenciesLoaded" (ionRefresh)="refreshCourseCompetencies($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="competenciesLoaded">\n        <ion-card *ngIf="!user && competencies && competencies.statistics.competencycount > 0">\n            <ion-item text-wrap *ngIf="competencies.settings.pushratingstouserplans">\n                {{ \'addon.competency.coursecompetencyratingsarepushedtouserplans\' | translate }}\n            </ion-item>\n            <ion-item text-wrap *ngIf="!competencies.settings.pushratingstouserplans">\n                {{ \'addon.competency.coursecompetencyratingsarenotpushedtouserplans\' | translate }}\n            </ion-item>\n            <ion-item text-wrap>\n                <strong>{{ \'addon.competency.progress\' | translate }}</strong>:\n                {{ \'addon.competency.xcompetenciesproficientoutofyincourse\' | translate:{$a: {x: competencies.statistics.proficientcompetencycount, y: competencies.statistics.competencycount} } }} ({{ competencies.statistics.proficientcompetencypercentageformatted }}%)\n                <core-progress-bar [progress]="competencies.statistics.proficientcompetencypercentage"></core-progress-bar>\n            </ion-item>\n            <ion-item text-wrap *ngIf="competencies.statistics.leastproficientcount > 0">\n                <strong>{{ \'addon.competency.competenciesmostoftennotproficientincourse\' | translate }}</strong>:\n                <p *ngFor="let comp of competencies.statistics.leastproficient">\n                    <a (click)="openCompetencySummary(comp.id)">\n                        {{ comp.shortname }} - {{ comp.idnumber }}\n                    </a>\n                </p>\n            </ion-item>\n        </ion-card>\n\n        <h3 margin-horizontal *ngIf="competencies && competencies.statistics.competencycount > 0">{{ \'addon.competency.competencies\' | translate }}</h3>\n        <ion-card *ngIf="user">\n             <ion-item text-wrap>\n                <ion-avatar *ngIf="user.profileimageurl && user.profileimageurl !== true" item-start>\n                    <img [src]="user.profileimageurl" [alt]="\'core.pictureof\' | translate:{$a: user.fullname}" core-external-content>\n                </ion-avatar>\n                <span *ngIf="user.profileimageurl === true" item-start>\n                    <ion-icon name="person"></ion-icon>\n                </span>\n                <h2><core-format-text [text]="user.fullname"></core-format-text></h2>\n            </ion-item>\n        </ion-card>\n        <core-empty-box *ngIf="competencies && competencies.statistics.competencycount == 0" icon="ribbon" message="{{ \'addon.competency.nocompetencies\' | translate }}"></core-empty-box>\n\n        <div *ngIf="competencies">\n            <ion-card *ngFor="let competency of competencies.competencies">\n                <a ion-item text-wrap (click)="openCompetency(competency.competency.id)" [title]="competency.competency.shortname">\n                    {{competency.competency.shortname}} <small>{{competency.competency.idnumber}}</small>\n                    <ion-badge item-end *ngIf="competency.usercompetencycourse && competency.usercompetencycourse.gradename" [color]="competency.usercompetencycourse.proficiency ? \'success\' : \'danger\'">{{ competency.usercompetencycourse.gradename }}</ion-badge>\n                </a>\n                <ion-item text-wrap>\n                    <div *ngIf="competency.competency.description">\n                        <core-format-text [text]=" competency.competency.description "></core-format-text>\n                    </div>\n                    <div>\n                        <strong>{{ \'addon.competency.path\' | translate }}</strong>:\n                        {{ competency.comppath.framework.name }}\n                        <span *ngFor="let ancestor of competency.comppath.ancestors">\n                            &nbsp;/&nbsp;<a (click)="openCompetencySummary(ancestor.id)">{{ ancestor.name }}</a>\n                        </span>\n                    </div>\n                    <div>\n                        <strong>{{ \'addon.competency.activities\' | translate }}</strong>:\n                        <span *ngIf="competency.coursemodules.length == 0">\n                            {{ \'addon.competency.noactivities\' | translate }}\n                        </span>\n                        <a ion-item text-wrap *ngFor="let activity of competency.coursemodules" [href]="activity.url" [title]="activity.name">\n                            <img item-start [src]="activity.iconurl" core-external-content alt="" role="presentation" *ngIf="activity.iconurl" class="core-module-icon">\n                            <core-format-text [text]="activity.name"></core-format-text>\n                        </a>\n                    </div>\n                </ion-item>\n            </ion-card>\n        </div>\n    </core-loading>\n</ion-content>\n'}),d("design:paramtypes",[r.q,i.a,s.a,a.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(2),i=n(8),s=n(225),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.sitesProvider=e,this.domUtils=t,this.courseCompletionProvider=n,this.completionLoaded=!1}return e.prototype.ngOnInit=function(){var e=this;this.userId||(this.userId=this.sitesProvider.getCurrentSiteUserId()),this.fetchCompletion().finally(function(){e.completionLoaded=!0})},e.prototype.fetchCompletion=function(){var e=this;return this.courseCompletionProvider.getCompletion(this.courseId,this.userId).then(function(t){t.statusText=e.courseCompletionProvider.getCompletedStatusText(t),e.completion=t,e.showSelfComplete=e.courseCompletionProvider.canMarkSelfCompleted(e.userId,t)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.coursecompletion.couldnotloadreport",!0)})},e.prototype.refreshCompletion=function(e){var t=this;this.courseCompletionProvider.invalidateCourseCompletion(this.courseId,this.userId).finally(function(){t.fetchCompletion().finally(function(){e&&e.complete()})})},e.prototype.completeCourse=function(){var e=this,t=this.domUtils.showModalLoading("core.sending",!0);this.courseCompletionProvider.markCourseAsSelfCompleted(this.courseId).then(function(){return e.refreshCompletion()}).catch(function(t){e.domUtils.showErrorModal(t)}).finally(function(){t.dismiss()})},a([Object(o.D)(),c("design:type",Number)],e.prototype,"courseId",void 0),a([Object(o.D)(),c("design:type",Number)],e.prototype,"userId",void 0),e=a([Object(o.m)({selector:"addon-course-completion-report",template:'<ion-content>\n    <ion-refresher [enabled]="completionLoaded" (ionRefresh)="refreshCompletion($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="completionLoaded">\n        <ion-card *ngIf="completion">\n            <ion-item text-wrap>\n                <h2>{{ \'addon.coursecompletion.status\' | translate }}</h2>\n                <p>{{ completion.statusText | translate }}</p>\n            </ion-item>\n            <ion-item text-wrap>\n                <h2>{{ \'addon.coursecompletion.required\' | translate }}</h2>\n                <p *ngIf="completion.aggregation === 1">{{ \'addon.coursecompletion.criteriarequiredall\' | translate }}</p>\n                <p *ngIf="completion.aggregation === 2">{{ \'addon.coursecompletion.criteriarequiredany\' | translate }}</p>\n            </ion-item>\n        </ion-card>\n        <ion-card *ngIf="completion">\n            <ion-item-divider>{{ \'addon.coursecompletion.requiredcriteria\' | translate }}</ion-item-divider>\n            <ion-item class="hidden-tablet" text-wrap *ngFor="let criteria of completion.completions">\n                <h2><core-format-text clean="true" [text]="criteria.details.criteria"></core-format-text></h2>\n                <p><core-format-text clean="true" [text]="criteria.details.requirement"></core-format-text></p>\n                <strong item-end>{{ criteria.status }}</strong>\n            </ion-item>\n            <ion-item class="hidden-phone" text-wrap>\n                <ion-row>\n                    <ion-col><strong>{{ \'addon.coursecompletion.criteriagroup\' | translate }}</strong></ion-col>\n                    <ion-col><strong>{{ \'addon.coursecompletion.criteria\' | translate }}</strong></ion-col>\n                    <ion-col><strong>{{ \'addon.coursecompletion.requirement\' | translate }}</strong></ion-col>\n                    <ion-col><strong>{{ \'addon.coursecompletion.status\' | translate }}</strong></ion-col>\n                    <ion-col><strong>{{ \'addon.coursecompletion.complete\' | translate }}</strong></ion-col>\n                    <ion-col><strong>{{ \'addon.coursecompletion.completiondate\' | translate }}</strong></ion-col>\n                </ion-row>\n                <ion-row *ngFor="let criteria of completion.completions">\n                    <ion-col><core-format-text clean="true" [text]="criteria.title"></core-format-text></ion-col>\n                    <ion-col><core-format-text clean="true" [text]="criteria.details.criteria"></core-format-text></ion-col>\n                    <ion-col><core-format-text clean="true" [text]="criteria.details.requirement"></core-format-text></ion-col>\n                    <ion-col><core-format-text [text]="criteria.details.status"></core-format-text></ion-col>\n                    <ion-col>{{ criteria.status }}</ion-col>\n                    <ion-col *ngIf="criteria.timecompleted">{{ criteria.timecompleted | coreToLocaleString }}</ion-col>\n                    <ion-col *ngIf="!criteria.timecompleted"></ion-col>\n                </ion-row>\n            </ion-item>\n        </ion-card>\n        <ion-card *ngIf="showSelfComplete">\n            <ion-item-divider>{{ \'addon.coursecompletion.manualselfcompletion\' | translate }}</ion-item-divider>\n            <ion-item>\n                <button ion-button block (click)="completeCourse()">{{ \'addon.coursecompletion.completecourse\' | translate }}</button>\n            </ion-item>\n        </ion-card>\n    </core-loading>\n</ion-content>\n'}),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(41),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.coursesProvider=e,this.name="CoreCourseFormatDefault",this.format="default"}return e.prototype.isEnabled=function(){return!0},e.prototype.getCourseTitle=function(e){return e.fullname||""},e.prototype.canViewAllSections=function(e){return!0},e.prototype.displayEnableDownload=function(e){return!0},e.prototype.displaySectionSelector=function(e){return!0},e.prototype.displayRefresher=function(e,t){return!0},e.prototype.getCurrentSection=function(e,t){return this.coursesProvider.isGetCoursesByFieldAvailable()?this.coursesProvider.getCoursesByField("id",e.id).catch(function(){}).then(function(e){if(e&&e[0])for(var n=e[0],o=0;o<t.length;o++){if((r=t[o]).section==n.marker)return r}for(o=0;o<t.length;o++){var r;if((r=t[o]).id!=i.a.ALL_SECTIONS_ID)return r}return Promise.reject(null)}):t[0].id!=i.a.ALL_SECTIONS_ID?t[0]:t[1]},e.prototype.invalidateData=function(e,t){return this.coursesProvider.invalidateCoursesByField("id",e.id)},e.prototype.openCourse=function(e,t){return e.push("CoreCourseSectionPage",{course:t})},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=e,this.courseProvider=t,this.name="CoreCourseModuleDefault",this.modName="default"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){var o=this,r={icon:this.courseProvider.getModuleIconSrc(e.modname),title:e.name,class:"core-course-default-handler core-course-module-"+e.modname+"-handler",action:function(e,t,n,o,r){e.preventDefault(),e.stopPropagation(),t.push("CoreCourseUnsupportedModulePage",{module:n},r)}};return e.url&&(r.buttons=[{icon:"open",label:"core.openinbrowser",action:function(t){t.preventDefault(),t.stopPropagation(),o.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(e.url)}}]),r},e.prototype.getMainComponent=function(e,t,n){},e.prototype.displayRefresherInSingleActivity=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){this.cacheStore={}}return e.prototype.clear=function(){this.cacheStore={}},e.prototype.getEntry=function(e){return this.cacheStore[e]||(this.cacheStore[e]={}),this.cacheStore[e]},e.prototype.getValue=function(e,t,n){var o=this.getEntry(e);if(o[t]&&void 0!==o[t].value){var r=Date.now();if(n||o[t].timemodified+3e5>=r)return o[t].value}},e.prototype.invalidate=function(e){var t=this.getEntry(e);for(var n in t)t[n].timemodified=0},e.prototype.setValue=function(e,t,n){return this.getEntry(e)[t]={value:n,timemodified:Date.now()},n},e}()},,function(e,t,n){"use strict";(function(e){n.d(t,"a",function(){return d}),n.d(t,"b",function(){return l});var o=n(0),r=n(320),i=n(9),s=n(27),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o,r,i){this.code=e,this.source=t,this.target=n,this.http_status=o,this.body=r,this.exception=i}return e.FILE_NOT_FOUND_ERR=1,e.INVALID_URL_ERR=2,e.CONNECTION_ERR=3,e.ABORT_ERR=4,e.NOT_MODIFIED_ERR=5,e}(),l=function(e){function t(t,n){var o=e.call(this)||this;return o.appProvider=t,o.fileProvider=n,o}return a(t,e),t.prototype.create=function(){return new f(this.appProvider,this.fileProvider)},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a),f=function(t){function n(e,n){var o=t.call(this)||this;return o.appProvider=e,o.fileProvider=n,o}return a(n,t),n.prototype.abort=function(){this.xhr&&(this.xhr.abort(),this.reject(new d(d.ABORT_ERR,this.source,this.target,null,null,null)))},n.prototype.download=function(t,n,o,r){var i=this;return new Promise(function(o,s){var a=i.getBasicAuthHeader(t),c=new XMLHttpRequest,u=i.appProvider.isDesktop(),l=null;i.xhr=c,i.source=t,i.target=n,i.reject=s,a&&(t=t.replace(i.getUrlCredentials(t)+"@",""),(r=r||{}).headers=r.headers||{},r.headers[a.name]=a.value),r&&(l=r.headers||null),c.open("GET",t,!0),c.responseType=u?"arraybuffer":"blob";for(var f in l)c.setRequestHeader(f,l[f]);c.onprogress=function(e,t){i.progressListener&&i.progressListener(t)},c.onerror=function(e){s(new d(-1,t,n,c.status,c.statusText,null))},c.onload=function(){var t=c.response;if(t){var r=i.fileProvider.getBasePathInstant();n=(n=n.replace(r,"")).replace(/%20/g," "),u&&(t=e.from(new Uint8Array(t))),i.fileProvider.writeFile(n,t).then(o,s)}else s()},c.send()})},n.prototype.getBasicAuthHeader=function(e){var t=null;if(window.btoa){var n=this.getUrlCredentials(e);if(n){t={name:"Authorization",value:"Basic "+window.btoa(n)}}}return t},n.prototype.getHeadersAsObject=function(e){var t=e.getAllResponseHeaders(),n={};if(t){var o=t.split("\n");for(var r in o){var i=o[r],s=i.indexOf(":");-1!=s&&(n[i.substr(0,s)]=i.substr(s+1).trim())}}return n},n.prototype.getUrlCredentials=function(e){var t=/^https?\:\/\/(?:(?:(([^:@\/]*)(?::([^@\/]*))?)?@)?([^:\/?#]*)(?::(\d*))?).*$/.exec(e);return t&&t[1]},n.prototype.onProgress=function(e){this.progressListener=e},n.prototype.upload=function(e,t,n,o){var r=this;return new Promise(function(o,i){var s=r.getBasicAuthHeader(t),a=null,c=null,u=null,l=null,f=null;s&&(t=t.replace(r.getUrlCredentials(t)+"@",""),(n=n||{}).headers=n.headers||{},n.headers[s.name]=s.value),n&&(a=n.fileKey,c=n.fileName,l=n.headers,f="PUT"==(f=n.httpMethod||"POST").toUpperCase()?"PUT":"POST",u=n.params?n.params:{}),(l=l||{})["Content-Disposition"]||(l["Content-Disposition"]="form-data;"+(a?' name="'+a+'";':"")+(c?' filename="'+c+'"':"")),delete l["Content-Type"],r.fileProvider.getFile(e).then(function(e){return r.fileProvider.getFileObjectFromFileEntry(e)}).then(function(n){var s=new XMLHttpRequest;s.open(f||"POST",t);for(var a in l)"Connection"!=a&&s.setRequestHeader(a,l[a]);s.onprogress=function(e){r.progressListener&&r.progressListener(e)},r.xhr=s,r.source=e,r.target=t,r.reject=i,s.onerror=function(){i(new d(-1,e,t,s.status,s.statusText,null))},s.onload=function(){o({bytesSent:n.size,responseCode:s.status,response:s.response,headers:r.getHeadersAsObject(s)})};var c=new FormData;for(var p in u)c.append(p,u[p]);c.append("file",n),s.send(c)}).catch(i)})},n}(r.b)}).call(t,n(158).Buffer)},,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(734),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.translate=t,n.name="AddonModAssignDefaultFeedbackHandler",n.type="default",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[r.c])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e){this.translate=e,this.name="AddonModAssignBaseFeedbackHandler",this.type="base"}return e.prototype.discardDraft=function(e,t,n){},e.prototype.getComponent=function(e,t){},e.prototype.getDraft=function(e,t,n){},e.prototype.getPluginFiles=function(e,t,n,o){return[]},e.prototype.getPluginName=function(e){var t="addon.mod_assign_feedback_"+e.type+".pluginname",n=this.translate.instant(t);return t!=n?n:e.name?e.name:void 0},e.prototype.hasDataChanged=function(e,t,n,o){return!1},e.prototype.hasDraftData=function(e,t,n){return!1},e.prototype.isEnabled=function(){return!0},e.prototype.prefetch=function(e,t,n,o){return Promise.resolve()},e.prototype.prepareFeedbackData=function(e,t,n,o,r){},e.prototype.saveDraft=function(e,t,n,o,r){},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(1),s=n(12),a=n(2),c=n(8),u=n(10),d=n(21),l=n(97),f=n(36),p=n(156),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,r,i,a,c,d,l,f){var p=this;this.cfDelegate=e,this.injector=n,this.courseHelper=r,this.domUtils=i,this.sitesProvider=c,this.content=d,this.modalCtrl=f,this.data={},this.allSectionsId=u.a.ALL_SECTIONS_ID,this.selectOptions={},this.selectOptions.title=t.instant("core.course.sections"),this.completionChanged=new o.v,this.sectionStatusObserver=a.on(s.a.SECTION_STATUS_CHANGED,function(e){if(p.downloadEnabled&&p.sections&&p.sections.length&&p.course&&e.sectionId&&e.courseId==p.course.id){var t=p.courseHelper.getSectionDownloadId({id:e.sectionId});if(l.isBeingDownloaded(t))return;for(var n,o=0;o<p.sections.length;o++){var r=p.sections[o];if(r.id===e.sectionId){n=r;break}}if(!n)return;p.courseHelper.calculateSectionStatus(n,p.course.id,!1).then(function(){n.isDownloading&&!l.isBeingDownloaded(t)&&p.prefetch(n,!1)})}},this.sitesProvider.getCurrentSiteId())}return e.prototype.ngOnInit=function(){this.displaySectionSelector=this.cfDelegate.displaySectionSelector(this.course)},e.prototype.ngOnChanges=function(e){var t=this;if(this.setInputData(),e.course&&this.getComponents(),e.sections&&this.sections)if(this.selectedSection){var n=void 0;for(o=0;o<this.sections.length;o++){if(this.compareSections(r=this.sections[o],this.selectedSection)){n=r;break}}n||(n=this.cfDelegate.getCurrentSection(this.course,this.sections)),this.sectionChanged(n)}else if(this.initialSectionId||this.initialSectionNumber)for(var o=0;o<this.sections.length;o++){var r;if((r=this.sections[o]).id&&r.id==this.initialSectionId||r.section&&r.section==this.initialSectionNumber){this.loaded=!0,this.sectionChanged(r);break}}else this.cfDelegate.getCurrentSection(this.course,this.sections).then(function(e){t.loaded=!0,t.sectionChanged(e)});e.downloadEnabled&&this.downloadEnabled&&this.calculateSectionsStatus(!1)},e.prototype.setInputData=function(){this.data.course=this.course,this.data.sections=this.sections,this.data.initialSectionId=this.initialSectionId=-1,this.data.initialSectionNumber=this.initialSectionNumber,this.data.downloadEnabled=this.downloadEnabled},e.prototype.getComponents=function(){var e=this;this.course&&(this.courseFormatComponent||this.cfDelegate.getCourseFormatComponent(this.injector,this.course).then(function(t){e.courseFormatComponent=t}),this.courseSummaryComponent||this.cfDelegate.getCourseSummaryComponent(this.injector,this.course).then(function(t){e.courseSummaryComponent=t}),this.sectionSelectorComponent||this.cfDelegate.getSectionSelectorComponent(this.injector,this.course).then(function(t){e.sectionSelectorComponent=t}),this.singleSectionComponent||this.cfDelegate.getSingleSectionComponent(this.injector,this.course).then(function(t){e.singleSectionComponent=t}),this.allSectionsComponent||this.cfDelegate.getAllSectionsComponent(this.injector,this.course).then(function(t){e.allSectionsComponent=t}))},e.prototype.showSectionSelector=function(){var e=this,t=this.modalCtrl.create("CoreCourseSectionSelectorPage",{sections:this.sections,selected:this.selectedSection});t.onDidDismiss(function(t){t&&e.sectionChanged(t)}),t.present()},e.prototype.sectionChanged=function(e){var t=this,n=this.selectedSection;this.selectedSection=e,this.data.section=this.selectedSection,this.moduleId&&void 0===n&&setTimeout(function(){t.domUtils.scrollToElementBySelector(t.content,"#core-course-module-"+t.moduleId)},200)},e.prototype.compareSections=function(e,t){return e&&t?e.id===t.id:e===t},e.prototype.calculateSectionsStatus=function(e){this.courseHelper.calculateSectionsStatus(this.sections,this.course.id,e).catch(function(){})},e.prototype.prefetch=function(e,t){var n=this;e.preventDefault(),e.stopPropagation(),t.isCalculating=!0,this.courseHelper.confirmDownloadSizeSection(this.course.id,t,this.sections).then(function(){n.prefetchSection(t,!0)},function(e){e&&n.domUtils.showErrorModal(e)}).finally(function(){t.isCalculating=!1})},e.prototype.prefetchSection=function(e,t){var n=this;this.courseHelper.prefetchSection(e,this.course.id,this.sections).catch(function(e){t&&n.domUtils.showErrorModalDefault(e,"core.course.errordownloadingsection",!0)})},e.prototype.doRefresh=function(e,t){var n=[];return this.dynamicComponents.forEach(function(o){n.push(Promise.resolve(o.callComponentFunction("doRefresh",[e,t])))}),Promise.all(n)},e.prototype.ngOnDestroy=function(){this.sectionStatusObserver&&this.sectionStatusObserver.off()},e.prototype.ionViewDidEnter=function(){this.dynamicComponents.forEach(function(e){e.callComponentFunction("ionViewDidEnter")})},e.prototype.ionViewDidLeave=function(){this.dynamicComponents.forEach(function(e){e.callComponentFunction("ionViewDidLeave")})},h([Object(o.D)(),m("design:type",Object)],e.prototype,"course",void 0),h([Object(o.D)(),m("design:type",Array)],e.prototype,"sections",void 0),h([Object(o.D)(),m("design:type",Boolean)],e.prototype,"downloadEnabled",void 0),h([Object(o.D)(),m("design:type",Number)],e.prototype,"initialSectionId",void 0),h([Object(o.D)(),m("design:type",Number)],e.prototype,"initialSectionNumber",void 0),h([Object(o.D)(),m("design:type",Number)],e.prototype,"moduleId",void 0),h([Object(o.O)(),m("design:type",o.v)],e.prototype,"completionChanged",void 0),h([Object(o._10)(p.a),m("design:type",o.T)],e.prototype,"dynamicComponents",void 0),e=h([Object(o.m)({selector:"core-course-format",template:'\x3c!-- Buttons to add to the header. *ngIf is needed, otherwise the component is executed too soon and doesn\'t find the header. --\x3e\n<core-navbar-buttons end *ngIf="loaded">\n    <core-context-menu>\n        <core-context-menu-item [hidden]="!displaySectionSelector || !sections || !sections.length" [priority]="500" [content]="\'core.course.sections\' | translate" (action)="showSectionSelector($event)" iconAction="menu"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n\x3c!-- Default course format. --\x3e\n<core-dynamic-component [component]="courseFormatComponent" [data]="data" >\n    \x3c!-- Course summary. By default we only display the course progress. --\x3e\n    <core-dynamic-component [component]="courseSummaryComponent" [data]="data" >\n        <ion-list no-lines *ngIf="course.imageThumb || (course.progress != null && course.progress >= 0)" class="core-format-progress-list">\n            <div *ngIf="course.imageThumb" class="core-course-thumb">\n                <img [src]="course.imageThumb" core-external-content alt=""/>\n            </div>\n            <ion-item *ngIf="course.progress != null && course.progress >= 0">\n                <core-progress-bar [progress]="course.progress"></core-progress-bar>\n            </ion-item>\n        </ion-list>\n    </core-dynamic-component>\n\n    <core-loading [hideUntil]="loaded">\n        \x3c!-- Section selector. --\x3e\n        <core-dynamic-component [component]="sectionSelectorComponent" [data]="data" style="display:none;">\n            <div text-wrap *ngIf="displaySectionSelector && sections && sections.length" no-padding class="clearfix">\n                <button float-start ion-button (click)="showSectionSelector($event)" clear class="core-button-select button-no-uppercase">\n                    {{selectedSection && (selectedSection.formattedName || selectedSection.name) || \'core.course.sections\' | translate }}\n                    <ion-icon name="arrow-dropdown" ios="md-arrow-dropdown"></ion-icon>\n                </button>\n                \x3c!-- Section download. --\x3e\n                <ng-container *ngTemplateOutlet="sectionDownloadTemplate; context: {section: selectedSection}"></ng-container>\n            </div>\n        </core-dynamic-component>\n\n        \x3c!-- Single section. --\x3e\n        <div *ngIf="selectedSection && selectedSection.id != allSectionsId" style="display:none;">\n            <core-dynamic-component [component]="singleSectionComponent" [data]="data">\n                <ng-container *ngTemplateOutlet="sectionTemplate; context: {section: selectedSection}"></ng-container>\n                <core-empty-box *ngIf="!selectedSection.hasContent" icon="qr-scanner" [message]="\'core.course.nocontentavailable\' | translate"></core-empty-box>\n            </core-dynamic-component>\n        </div>\n\n        \x3c!-- Multiple sections. --\x3e\n        <div *ngIf="selectedSection && selectedSection.id == allSectionsId">\n            <core-dynamic-component [component]="allSectionsComponent" [data]="data">\n                <ng-container *ngFor="let section of sections">\n                    <ng-container *ngTemplateOutlet="sectionTemplate; context: {section: section}"></ng-container>\n                </ng-container>\n            </core-dynamic-component>\n        </div>\n    </core-loading>\n</core-dynamic-component>\n\n\x3c!-- Template to render a section. --\x3e\n<ng-template #sectionTemplate let-section="section">\n    <section ion-list *ngIf="section.hasContent">\n        \x3c!-- Title is only displayed when viewing all sections. --\x3e\n        <ion-item-divider text-wrap color="light" *ngIf="selectedSection.id == allSectionsId && section.name">\n            <core-format-text [text]="section.name"></core-format-text>\n            \x3c!-- Section download. --\x3e\n            <ng-container *ngTemplateOutlet="sectionDownloadTemplate; context: {section: section}"></ng-container>\n        </ion-item-divider>\n\n        <ion-item text-wrap *ngIf="section.summary">\n            <core-format-text [text]="section.summary"></core-format-text>\n        </ion-item>\n\n        <ng-container *ngFor="let module of section.modules">\n            <core-course-module *ngIf="module.visibleoncoursepage !== 0" [module]="module" [courseId]="course.id" [downloadEnabled]="downloadEnabled" (completionChanged)="completionChanged.emit()"></core-course-module>\n        </ng-container>\n    </section>\n</ng-template>\n\n\x3c!-- Template to render a section download button/progress. --\x3e\n<ng-template #sectionDownloadTemplate let-section="section">\n    <div *ngIf="section && downloadEnabled" class="core-button-spinner" float-end>\n        \x3c!-- Download button. --\x3e\n        <button *ngIf="section.showDownload && !section.isDownloading && !section.isCalculating" (click)="prefetch($event, section)" ion-button icon-only clear color="dark" [attr.aria-label]="\'core.download\' | translate">\n            <ion-icon name="cloud-download"></ion-icon>\n        </button>\n        \x3c!-- Refresh button. --\x3e\n        <button *ngIf="section.showRefresh && !section.isDownloading && !section.isCalculating" (click)="prefetch($event, section)" ion-button icon-only clear color="dark" [attr.aria-label]="\'core.refresh\' | translate">\n            <ion-icon name="refresh"></ion-icon>\n        </button>\n        \x3c!-- Download progress. --\x3e\n        <ion-badge class="core-course-download-section-progress" *ngIf="section.isDownloading && section.total > 0 && section.count < section.total">{{section.count}} / {{section.total}}</ion-badge>\n        \x3c!-- Spinner (downloading or calculating status). --\x3e\n        <ion-spinner *ngIf="(section.isDownloading && section.total > 0) || section.isCalculating"></ion-spinner>\n    </div>\n</ng-template>\n'}),m("design:paramtypes",[l.a,i.c,o.C,d.a,c.a,s.a,a.a,r.f,f.a,r.o])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(737),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.translate=t,n.name="AddonModAssignDefaultSubmissionHandler",n.type="default",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[r.c])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e){this.translate=e,this.name="AddonModAssignBaseSubmissionHandler",this.type="base"}return e.prototype.canEditOffline=function(e,t,n){return!1},e.prototype.clearTmpData=function(e,t,n,o){},e.prototype.copySubmissionData=function(e,t,n,o,r){},e.prototype.deleteOfflineData=function(e,t,n,o,r){},e.prototype.getComponent=function(e,t,n){},e.prototype.getPluginFiles=function(e,t,n,o){return[]},e.prototype.getPluginName=function(e){var t="addon.mod_assign_submission_"+e.type+".pluginname",n=this.translate.instant(t);return t!=n?n:e.name?e.name:void 0},e.prototype.getSizeForCopy=function(e,t){return 0},e.prototype.getSizeForEdit=function(e,t){return 0},e.prototype.hasDataChanged=function(e,t,n,o){return!1},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForEdit=function(){return!1},e.prototype.prefetch=function(e,t,n,o){return Promise.resolve()},e.prototype.prepareSubmissionData=function(e,t,n,o,r,i,s,a){},e.prototype.prepareSyncData=function(e,t,n,o,r,i){},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(52),i=n(108),s=n(102),a=n(156),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.injector=e,this.submissionDelegate=t,this.assignProvider=n,this.assignHelper=o,this.component=r.a.COMPONENT,this.text="",this.files=[]}return e.prototype.ngOnInit=function(){var e=this;this.plugin&&(this.plugin.name=this.submissionDelegate.getPluginName(this.plugin),this.plugin.name&&(this.edit=this.edit&&"false"!==this.edit,this.allowOffline=this.allowOffline&&"false"!==this.allowOffline,this.submissionDelegate.getComponentForPlugin(this.injector,this.plugin,this.edit).then(function(t){e.pluginComponent=t,t?e.data={assign:e.assign,submission:e.submission,plugin:e.plugin,configs:e.assignHelper.getPluginConfig(e.assign,"assignsubmission",e.plugin.type),edit:e.edit,allowOffline:e.allowOffline}:(e.text=e.assignProvider.getSubmissionPluginText(e.plugin),e.files=e.assignProvider.getSubmissionPluginAttachments(e.plugin),e.notSupported=e.submissionDelegate.isPluginSupported(e.plugin.type),e.pluginLoaded=!0)})))},e.prototype.invalidate=function(){return Promise.resolve(this.dynamicComponent&&this.dynamicComponent.callComponentFunction("invalidate",[]))},c([Object(o._9)(a.a),u("design:type",a.a)],e.prototype,"dynamicComponent",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"assign",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"submission",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"plugin",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"edit",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"allowOffline",void 0),e=c([Object(o.m)({selector:"addon-mod-assign-submission-plugin",template:'\n<core-dynamic-component [component]="pluginComponent" [data]="data">\n    \x3c!-- This content will be replaced by the component if found. --\x3e\n    <core-loading [hideUntil]="pluginLoaded">\n        <ion-item text-wrap *ngIf="text.length > 0 || files.length > 0">\n            <h2>{{ plugin.name }}</h2>\n            <ion-badge *ngIf="notSupported" color="primary">\n                {{ \'addon.mod_assign.submissionnotsupported\' | translate }}\n            </ion-badge>\n            <p *ngIf="text">\n                <core-format-text [component]="component" [componentId]="assign.cmid" [maxHeight]="80" [fullOnClick]="true" [fullTitle]="plugin.name" [text]="text"></core-format-text>\n            </p>\n            <core-file *ngFor="let file of files" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n        </ion-item>\n    </core-loading>\n</core-dynamic-component>\n'}),u("design:paramtypes",[o.C,s.a,r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(159),f=n(227),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e){function t(t,n,o,r,i,s,a,c){var u=e.call(this,t,n,o,r,i,s,a)||this;return u.bookProvider=c,u.name="AddonModBook",u.modName="book",u.component=f.a.COMPONENT,u.updatesNames=/^configuration$|^.*files$|^entries$/,u}return p(t,e),t.prototype.downloadOrPrefetch=function(t,n,o,r){var i=[];return i.push(e.prototype.downloadOrPrefetch.call(this,t,n,o)),i.push(this.bookProvider.getBook(n,t.id).catch(function(){})),Promise.all(i)},t.prototype.getIntroFiles=function(e,t){var n=this;return this.bookProvider.getBook(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.bookProvider.invalidateContent(e,t)},t.prototype.isEnabled=function(){return this.bookProvider.isPluginEnabled()},t=h([Object(o.A)(),m("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e,t,n,o,r,i,s){this.translate=e,this.appProvider=t,this.utils=n,this.courseProvider=o,this.filepoolProvider=r,this.sitesProvider=i,this.domUtils=s,this.name="CoreCourseModulePrefetchHandler",this.modName="default",this.component="core_module",this.updatesNames=/^.*files$/,this.downloadPromises={}}return e.prototype.addOngoingDownload=function(e,t,n){var o=this;n=n||this.sitesProvider.getCurrentSiteId();var r=this.getUniqueId(e);return this.downloadPromises[n]||(this.downloadPromises[n]={}),this.downloadPromises[n][r]=t.finally(function(){delete o.downloadPromises[n][r]}),this.downloadPromises[n][r]},e.prototype.download=function(e,t,n){return Promise.resolve()},e.prototype.getContentDownloadableFiles=function(e){var t=this,n=[];return e.contents&&e.contents.length&&e.contents.forEach(function(e){t.isFileDownloadable(e)&&n.push(e)}),n},e.prototype.getDownloadSize=function(e,t,n){var o=this;return this.getFiles(e,t).then(function(e){return o.utils.sumFileSizes(e)}).catch(function(){return{size:-1,total:!1}})},e.prototype.getDownloadedSize=function(e,t){var n=this.sitesProvider.getCurrentSiteId();return this.filepoolProvider.getFilesSizeByComponent(n,this.component,e.id)},e.prototype.getFiles=function(e,t,n){return Promise.resolve([])},e.prototype.getIntroFiles=function(e,t){return Promise.resolve(this.getIntroFilesFromInstance(e))},e.prototype.getIntroFilesFromInstance=function(e,t){if(t){if(void 0!==t.introfiles)return t.introfiles;if(t.intro)return this.domUtils.extractDownloadableFilesFromHtmlAsFakeFileObjects(t.intro)}return e.description?this.domUtils.extractDownloadableFilesFromHtmlAsFakeFileObjects(e.description):[]},e.prototype.getOngoingDownload=function(e,t){return t=t||this.sitesProvider.getCurrentSiteId(),this.isDownloading(e,t)?this.downloadPromises[t][this.getUniqueId(e)]:Promise.resolve()},e.prototype.getUniqueId=function(e){return this.component+"#"+e},e.prototype.invalidateContent=function(e,t){return Promise.resolve()},e.prototype.invalidateModule=function(e,t){return this.courseProvider.invalidateModule(e.id)},e.prototype.isDownloadable=function(e,t){return!0},e.prototype.isDownloading=function(e,t){return t=t||this.sitesProvider.getCurrentSiteId(),!(!this.downloadPromises[t]||!this.downloadPromises[t][this.getUniqueId(e)])},e.prototype.isEnabled=function(){return!0},e.prototype.isFileDownloadable=function(e){return"file"===e.type},e.prototype.loadContents=function(e,t,n){return Promise.resolve()},e.prototype.prefetch=function(e,t,n,o){return Promise.resolve()},e.prototype.removeFiles=function(e,t){return this.filepoolProvider.removeFilesByComponent(this.sitesProvider.getCurrentSiteId(),this.component,e.id)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.viewCtrl=t,this.chapters=e.get("chapters")||[]}return e.prototype.loadChapter=function(e){this.viewCtrl.dismiss(e)},e=i([Object(o.m)({selector:"addon-mod-book-toc-popover",template:'<ion-list>\n    <a ion-item text-wrap *ngFor="let chapter of chapters" (click)="loadChapter(chapter.id)" detail-none>\n        <p [attr.padding-left]="chapter.level == 1 ? true : null">{{chapter.title}}</p>\n    </a>\n</ion-list>\n'}),s("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=n(139),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.navCtrl=t,this.commentsProvider=n,this.area="",this.page=0,this.commentsLoaded=!1}return e.prototype.ngOnInit=function(){var e=this;this.commentsProvider.getComments(this.contextLevel,this.instanceId,this.component,this.itemId,this.area,this.page).then(function(t){e.commentsCount=t&&t.length?t.length:0}).catch(function(){e.commentsCount=-1}).finally(function(){e.commentsLoaded=!0})},e.prototype.openComments=function(){this.commentsCount>0&&this.navCtrl.push("CoreCommentsViewerPage",{contextLevel:this.contextLevel,instanceId:this.instanceId,component:this.component,itemId:this.itemId,area:this.area,page:this.page,title:this.title})},s([Object(o.D)(),a("design:type",String)],e.prototype,"contextLevel",void 0),s([Object(o.D)(),a("design:type",Number)],e.prototype,"instanceId",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"component",void 0),s([Object(o.D)(),a("design:type",Number)],e.prototype,"itemId",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"area",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"page",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"title",void 0),e=s([Object(o.m)({selector:"core-comments",template:'<core-loading [hideUntil]="commentsLoaded">\n    <div (click)="openComments()" *ngIf="commentsCount >= 0">\n        {{ \'core.commentscount\' | translate : {\'$a\': commentsCount} }}\n    </div>\n    <div *ngIf="commentsCount < 0">\n        {{ \'core.commentsnotworking\' | translate }}\n    </div>\n</core-loading>\n'}),a("design:paramtypes",[r.r,r.q,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var o=n(0),r=n(33),i=n(32),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=[r.a,i.a],c=function(){function e(){}return e=s([Object(o.I)({declarations:[],imports:[],providers:a,exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var o=n(0),r=n(10),i=n(21),s=n(97),a=n(35),c=n(36),u=n(104),d=n(727),l=n(728),f=n(1372),p=n(1373),h=n(1375),m=n(1377),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=[r.a,i.a,s.a,a.a,c.a,u.a],v=function(){function e(){}return e=g([Object(o.I)({declarations:[],imports:[f.a,h.a,m.a,p.a],providers:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(35),i=n(330),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.moduleDelegate=e,this.name="CoreCourseFormatSingleActivity",this.format="singleactivity"}return e.prototype.isEnabled=function(){return!0},e.prototype.canViewAllSections=function(e){return!1},e.prototype.getCourseTitle=function(e,t){return t&&t[0]&&t[0].modules&&t[0].modules[0]?t[0].modules[0].name:e.fullname||""},e.prototype.displayEnableDownload=function(e){return!1},e.prototype.displaySectionSelector=function(e){return!1},e.prototype.displayRefresher=function(e,t){return!(t&&t[0]&&t[0].modules&&t[0].modules[0])||this.moduleDelegate.displayRefresherInSingleActivity(t[0].modules[0].modname)},e.prototype.getCourseFormatComponent=function(e,t){return i.a},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return m});var o=n(0),r=n(41),i=n(1379),s=n(250),a=n(1380),c=n(1381),u=n(1382),d=n(81),l=n(33),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=[r.a,s.a],m=function(){function e(e,t,n,o,r,i){e.registerHandler(n),t.registerHandler(o),t.registerHandler(r),t.registerHandler(i)}return e=f([Object(o.I)({declarations:[],imports:[],providers:[r.a,s.a,i.a,a.a,c.a,u.a],exports:[]}),p("design:paramtypes",[d.a,l.a,i.a,a.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return m});var o=n(0),r=n(56),i=n(107),s=n(325),a=n(1383),c=n(1384),u=n(1385),d=n(1386),l=n(1387),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=[r.a,i.a,s.a],m=function(){function e(e,t,n,o,r,i){e.registerHandler(t),e.registerHandler(n),e.registerHandler(o),e.registerHandler(i),e.registerHandler(r)}return e=f([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a]}),p("design:paramtypes",[s.a,a.a,c.a,u.a,l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P}),n.d(t,"b",function(){return O});var o=n(0),r=n(94),i=n(115),s=n(81),a=n(1388),c=n(1389),u=n(935),d=n(104),l=n(1390),f=n(1391),p=n(33),h=n(1392),m=n(57),g=n(12),y=n(2),v=n(26),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=[r.a,i.a],O=function(){function e(e,t,n,o,r,i,s,a,c,u,d){e.registerHandler(t),o.registerHandler(n),r.registerHandler(i),r.registerHandler(s),c.registerHandler(a),u.on(v.a.PROFILE_REFRESHED,function(e){a.clearViewGradesCache(e.courseId,e.userId)},d.getCurrentSiteId()),u.on(g.a.LOGOUT,function(){a.clearViewGradesCache()},d.getCurrentSiteId())}return e=b([Object(o.I)({declarations:[],imports:[u.a],providers:[r.a,i.a,a.a,c.a,l.a,f.a,h.a]}),_("design:paramtypes",[s.a,a.a,c.a,d.a,p.a,l.a,f.a,h.a,m.a,g.a,y.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(94),s=n(8),a=n(115),c=n(133),u=n(9),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},p=function(){function e(e,t,n,o,r,i,s){this.gradesProvider=e,this.domUtils=t,this.gradesHelper=o,this.navCtrl=r,this.appProvider=i,this.svComponent=s,this.gradesLoaded=!1}return e.prototype.ngOnInit=function(){var e=this;this.fetchData().then(function(){return e.gradeId&&e.gotoGrade(e.gradeId),e.gradesProvider.logCourseGradesView(e.courseId,e.userId)}).finally(function(){e.gradesLoaded=!0})},e.prototype.fetchData=function(e){var t=this;return void 0===e&&(e=!1),this.gradesProvider.getCourseGradesTable(this.courseId,this.userId).then(function(e){t.gradesTable=t.gradesHelper.formatGradesTable(e)}).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error loading grades")})},e.prototype.refreshGrades=function(e){var t=this;this.gradesProvider.invalidateCourseGradesData(this.courseId,this.userId).finally(function(){t.fetchData().finally(function(){e.complete()})})},e.prototype.gotoGrade=function(e){if(e){this.gradeId=e;var t=void 0,n=void 0;this.svComponent?"CoreGradesCourseSplitPage"==this.svComponent.getMasterNav().getActive().component.name?(t=this.svComponent,n="CoreGradesGradePage"):(t=this.svComponent.getMasterNav(),n="CoreGradesCourseSplitPage"):this.appProvider.isWide()?(t=this.navCtrl,n="CoreGradesCourseSplitPage"):(t=this.navCtrl,n="CoreGradesGradePage"),t.push(n,{courseId:this.courseId,userId:this.userId,gradeId:e})}},d([Object(o._9)(r.f),l("design:type",r.f)],e.prototype,"content",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"courseId",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"userId",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"gradeId",void 0),e=d([Object(o.m)({selector:"core-grades-course",template:'<ion-content>\n    <ion-refresher [enabled]="gradesLoaded" (ionRefresh)="refreshGrades($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="gradesLoaded">\n        <core-empty-box *ngIf="!gradesTable" icon="stats" [message]="\'core.grades.nogradesreturned\' | translate">\n        </core-empty-box>\n\n        <div *ngIf="gradesTable" class="core-grades-container">\n            <table cellspacing="0" cellpadding="0" class="core-grades-table">\n                <thead>\n                    <tr>\n                        <th *ngFor="let column of gradesTable.columns" id="{{column.name}}" [class.hidden-phone]="column.hiddenPhone" [attr.colspan]="column.colspan">\n                            {{ \'core.grades.\' + column.name | translate }}\n                        </th>\n                    </tr>\n                </thead>\n                <tbody>\n                    <tr *ngFor="let row of gradesTable.rows" (click)="row.itemtype != \'category\' && gotoGrade(row.id)" [class]="row.rowclass">\n                        <td *ngIf="row.itemtype == \'category\'" class="core-grades-table-category" [attr.rowspan]="row.rowspan">\n                        </td>\n                        <th class="core-grades-table-gradeitem" [attr.colspan]="row.colspan" [class.core-split-item-selected]="gradeId == row.id">\n                            <ion-icon *ngIf="row.icon" name="{{row.icon}}" item-start></ion-icon>\n                            <img *ngIf="row.image" [src]="row.image" item-start/>\n                            <span [innerHTML]="row.gradeitem"></span>\n                        </th>\n                        <ng-container *ngFor="let column of gradesTable.columns">\n                            <td *ngIf="column.name != \'gradeitem\' && row[column.name] != undefined" [class]="\'core-grades-table-\' + column.name" [innerHTML]="row[column.name]" [class.hidden-phone]="column.hiddenPhone">\n                            </td>\n                        </ng-container>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n    </core-loading>\n</ion-content>'}),f(4,Object(o.N)()),f(6,Object(o.N)()),l("design:paramtypes",[i.a,s.a,r.r,a.a,r.q,u.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a});var o=n(0),r=n(71),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=[r.a],a=function(){function e(){}return e=i([Object(o.I)({declarations:[],imports:[],providers:s})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a}),n.d(t,"b",function(){return c});var o=n(0),r=n(81),i=n(936),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=[r.a,i.a],c=function(){function e(){}return e=s([Object(o.I)({declarations:[],imports:[],providers:a})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var o=n(0),r=n(65),i=n(38),s=n(70),a=n(753),c=n(755),u=n(73),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=[r.a,i.a,s.a,u.a],f=function(){function e(){}return e=d([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a,u.a,a.a,c.a],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(754),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e){function t(){var t=e.call(this)||this;return t.name="CoreQuestionDefault",t.type="default",t}return i(t,e),t=s([Object(o.A)(),a("design:paramtypes",[])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(){this.name="CoreQuestionBase",this.type="base"}return e.prototype.isEnabled=function(){return!0},e.prototype.getComponent=function(e,t){},e.prototype.getBehaviour=function(e,t){return t},e.prototype.getPreventSubmitMessage=function(e){return""},e.prototype.isCompleteResponse=function(e,t){return-1},e.prototype.isGradableResponse=function(e,t){return-1},e.prototype.isSameResponse=function(e,t,n){return!1},e.prototype.prepareAnswers=function(e,t,n,o){},e.prototype.validateSequenceCheck=function(e,t){return e.sequencecheck==t},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(756),i=n(65),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.questionProvider=t,n.name="CoreQuestionBehaviourDefault",n.type="default",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e){this.questionProvider=e,this.name="CoreQuestionBehaviourBase",this.type="base"}return e.prototype.determineNewState=function(e,t,n,o){return this.questionProvider.getState(n.state)},e.prototype.handleQuestion=function(e,t){},e.prototype.isEnabled=function(){return!0},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var o=n(0),r=n(4),i=n(405),s=n(406),a=n(1393),c=n(325),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=[i.a,s.a],f=function(){function e(e,t,n,o){t.registerHandler(n),e.is("ios")&&(o.searchIOSNewSharedFiles(),e.resume.subscribe(function(){o.searchIOSNewSharedFiles()}))}return e=u([Object(o.I)({declarations:[],imports:[],providers:[i.a,s.a,a.a]}),d("design:paramtypes",[r.s,c.a,a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var o=n(0),r=n(157),i=n(1394),s=n(1395),a=n(81),c=n(33),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=[r.a],f=function(){function e(e,t,n,o){e.registerHandler(n),t.registerHandler(o)}return e=u([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a],exports:[]}),d("design:paramtypes",[a.a,c.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return _});var o=n(0),r=n(57),i=n(119),s=n(26),a=n(937),c=n(1396),u=n(12),d=n(2),l=n(33),f=n(1397),p=n(1398),h=n(1399),m=n(104),g=n(393),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=[r.a,i.a,s.a,a.a],_=function(){function e(e,t,n,o,r,i,s,a,c,d){e.registerHandler(t),d.registerHandler(a),i.registerHandler(s),i.registerHandler(c),n.on(u.a.USER_DELETED,function(e){var t=e.params,n=0;t.userid?n=t.userid:t.userids?n=t.userids[0]:"id"===t.field&&t.values&&t.values.length?n=t.values[0]:t.userlist&&t.userlist.length&&(n=t.userlist[0].userid),n>0&&r.deleteStoredUser(n,e.siteId)},o.getCurrentSiteId())}return e=y([Object(o.I)({declarations:[],imports:[g.a],providers:[r.a,i.a,s.a,a.a,c.a,f.a,p.a,h.a]}),v("design:paramtypes",[r.a,c.a,u.a,d.a,s.a,l.a,f.a,p.a,h.a,m.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(26),s=n(8),a=n(133),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){this.userProvider=e,this.domUtils=t,this.participants=[],this.canLoadMore=!1,this.participantsLoaded=!1}return e.prototype.ngOnInit=function(){var e=this;this.fetchData(!0).then(function(){!e.participantId&&e.splitviewCtrl.isOn()&&e.participants.length>0&&e.gotoParticipant(e.participants[0].id),e.userProvider.logParticipantsView(e.courseId).catch(function(){})}).finally(function(){e.participantsLoaded=!0})},e.prototype.fetchData=function(e){var t=this;void 0===e&&(e=!1);return this.userProvider.getParticipants(this.courseId,e?0:this.participants.length).then(function(n){t.participants=e?n.participants:t.participants.concat(n.participants),t.canLoadMore=n.canLoadMore}).catch(function(e){t.domUtils.showErrorModalDefault(e,"Error loading participants"),t.canLoadMore=!1})},e.prototype.refreshParticipants=function(e){var t=this;this.userProvider.invalidateParticipantsList(this.courseId).finally(function(){t.fetchData(!0).finally(function(){e.complete()})})},e.prototype.gotoParticipant=function(e){this.participantId=e,this.splitviewCtrl.push("CoreUserProfilePage",{userId:e,courseId:this.courseId})},c([Object(o._9)(r.f),u("design:type",r.f)],e.prototype,"content",void 0),c([Object(o._9)(a.a),u("design:type",a.a)],e.prototype,"splitviewCtrl",void 0),c([Object(o.D)(),u("design:type",Number)],e.prototype,"courseId",void 0),e=c([Object(o.m)({selector:"core-user-participants",template:'<core-split-view>\n    <ion-content>\n        <ion-refresher [enabled]="participantsLoaded" (ionRefresh)="refreshParticipants($event)">\n            <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n        </ion-refresher>\n        <core-loading [hideUntil]="participantsLoaded">\n            <core-empty-box *ngIf="participants && participants.length == 0" icon="person" [message]="\'core.user.noparticipants\' | translate">\n            </core-empty-box>\n\n            <ion-list *ngIf="participants && participants.length > 0" no-margin>\n                <a ion-item text-wrap *ngFor="let participant of participants" [title]="participant.fullname" (click)="gotoParticipant(participant.id)" [class.core-split-item-selected]="participant.id == participantId">\n                    <ion-avatar item-start>\n                        <img src="{{participant.profileimageurl}}" [alt]="\'core.pictureof\' | translate:{$a: participant.fullname}" core-external-content onError="this.src=\'assets/img/user-avatar.png\'">\n                    </ion-avatar>\n                    <h2><core-format-text [text]="participant.fullname"></core-format-text></h2>\n                    <p *ngIf="participant.lastaccess"><strong>{{ \'core.lastaccess\' | translate }}: </strong>{{ participant.lastaccess * 1000 | coreFormatDate:"dfmediumdate"}}</p>\n                </a>\n            </ion-list>\n\n            <ion-infinite-scroll [enabled]="canLoadMore" (ionInfinite)="$event.waitFor(fetchData())">\n               <ion-infinite-scroll-content></ion-infinite-scroll-content>\n            </ion-infinite-scroll>\n        </core-loading>\n    </ion-content>\n</core-split-view>'}),u("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"b",function(){return V}),n.d(t,"a",function(){return Q});var o=n(0),r=n(4),i=n(730),s=n(324),a=n(318),c=n(397),u=n(183),d=n(319),l=n(320),f=n(303),p=n(221),h=n(305),m=n(224),g=n(323),y=n(134),v=n(326),b=n(954),_=n(762),P=n(624),O=n(711),w=n(321),S=n(1401),R=n(1402),E=n(1403),C=n(1404),I=n(1406),A=n(731),D=n(1407),j=n(1408),x=n(1410),T=n(1411),k=n(1412),M=n(1413),N=n(1414),U=n(186),F=n(226),L=n(9),H=n(27),q=n(11),B=n(47),K=n(6),G=n(79),W=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},z=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},V=[i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a,_.a,P.a,O.a,w.a],Q=function(){function e(e,t,o){var r=window;e.isDesktop()&&n(1464).ipcRenderer.on("mmAppLaunched",function(e,t){void 0!==r.handleOpenURL&&r.handleOpenURL(t)}),e.isMobile()||t.registerProcess(o)}return e=W([Object(o.I)({declarations:[],imports:[],providers:[{provide:i.a,deps:[L.a],useFactory:function(e){return e.isMobile()?new i.a:new S.a(e)}},U.a,F.a,{provide:s.a,deps:[L.a,F.a],useFactory:function(e,t){return e.isMobile()?new s.a:new R.a(t)}},{provide:a.a,deps:[L.a],useFactory:function(e){return e.isMobile()?new a.a:new E.a(e)}},c.a,{provide:u.a,deps:[L.a,q.a],useFactory:function(e,t){return e.isMobile()?new u.a:new C.a(e,t)}},{provide:d.a,deps:[L.a],useFactory:function(e){return e.isMobile()?new d.a:new I.a(e)}},{provide:l.a,deps:[L.a,H.a],useFactory:function(e,t){return e.isMobile()?new l.a:new A.b(e,t)}},{provide:f.a,deps:[L.a],useFactory:function(e){return e.isMobile()?new f.a:new D.a(e)}},{provide:p.a,deps:[L.a,H.a,B.a],useFactory:function(e,t,n){return e.isDesktop()?new j.a(e,t,n):new p.a}},h.a,{provide:m.a,deps:[L.a,K.a,q.a],useFactory:function(e,t,n){return e.isMobile()?new m.a:new x.a(e,t,n)}},{provide:g.a,deps:[L.a,F.a],useFactory:function(e,t){return e.isMobile()?new g.a:new T.a(t)}},{provide:y.a,deps:[r.s],useFactory:function(e){return e.is("cordova")?new y.a:new k.a}},{provide:v.a,deps:[L.a],useFactory:function(e){return e.isMobile()?new v.a:new M.a(e)}},b.a,_.a,P.a,O.a,{provide:w.a,deps:[L.a,u.a,q.a],useFactory:function(e,t,n){return e.isMobile()?new w.a:new N.a(t,n)}}]}),z("design:paramtypes",[L.a,G.a,U.a])],e)}()},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(792),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(e){function t(t,n,o,r,i){var s=e.call(this,t,n,o,r,i)||this;return s.translate=n,s.domUtils=o,s.sitePluginsProvider=r,s.parentContent=i,s}return i(t,e),t.prototype.ngOnInit=function(){var t=this;e.prototype.ngOnInit.call(this),this.element.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),void 0!==t.confirmMessage?t.domUtils.showConfirm(t.confirmMessage||t.translate.instant("core.areyousure")).then(function(){t.callWS()}).catch(function(){}):t.callWS()})},t.prototype.callWS=function(){var t=this.domUtils.showModalLoading();return e.prototype.callWS.call(this).finally(function(){t.dismiss()})},s([Object(o.D)(),a("design:type",String)],t.prototype,"confirmMessage",void 0),t}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e,t,n,o,r){this.translate=t,this.domUtils=n,this.sitePluginsProvider=o,this.parentContent=r,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.parentContent&&this.parentContent.invalidateObservable&&(this.invalidateObserver=this.parentContent.invalidateObservable.subscribe(function(){e.invalidate()}))},e.prototype.callWS=function(){var e=this,t=this.getParamsForWS();return this.sitePluginsProvider.callWS(this.name,t,this.preSets).then(function(t){return e.wsCallSuccess(t)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.serverconnection",!0)})},e.prototype.getParamsForWS=function(){var e=this.params||{};return this.parentContent&&(e=this.sitePluginsProvider.loadOtherDataInArgs(e,this.parentContent.otherData,this.useOtherDataForWS)),this.form&&document.forms[this.form]&&(e=Object.assign(e,this.domUtils.getDataFromForm(document.forms[this.form]))),e},e.prototype.wsCallSuccess=function(e){},e.prototype.invalidate=function(){var e=this.getParamsForWS();return this.sitePluginsProvider.invalidateCallWS(this.name,e,this.preSets)},e.prototype.ngOnDestroy=function(){this.invalidateObserver&&this.invalidateObserver.unsubscribe()},r([Object(o.D)(),i("design:type",String)],e.prototype,"name",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"params",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"preSets",void 0),r([Object(o.D)(),i("design:type",Array)],e.prototype,"useOtherDataForWS",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"form",void 0),e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return p});var o=n(0),r=n(194),i=n(1479),s=n(1480),a=n(1481),c=n(33),u=n(57),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=[r.a],p=function(){function e(e,t,n,o,r){e.registerHandler(t),n.registerHandler(o),n.registerHandler(r)}return e=d([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a,a.a]}),l("design:paramtypes",[u.a,i.a,c.a,s.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return m});var o=n(0),r=n(249),i=n(934),s=n(1482),a=n(81),c=n(79),u=n(78),d=n(71),l=n(51),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=[r.a,i.a],m=function(){function e(e,t,n,o,i,s,a){e.registerHandler(t),n.ready().then(function(){o.scheduleAllSitesEventsNotifications()}),s.registerClick(r.a.COMPONENT,function(e){e.eventid&&n.ready().then(function(){o.isDisabled(e.siteId).then(function(t){t||i.redirect("AddonCalendarListPage",{eventId:e.eventid},e.siteId)})})}),a.registerSiteTableMigration({name:"calendar_events",newName:r.a.EVENTS_TABLE,filterFields:["id","name","description","format","eventtype","courseid","timestart","timeduration","categoryid","groupid","userid","instance","modulename","timemodified","repeatid","visible","uuid","sequence","subscriptionid","notificationtime"]}),a.registerLocalNotifComponentMigration("mmaCalendarComponent",r.a.COMPONENT)}return e=f([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a]}),p("design:paramtypes",[a.a,s.a,c.a,r.a,d.a,u.a,l.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m}),n.d(t,"b",function(){return g});var o=n(0),r=n(162),i=n(396),s=n(1483),a=n(1484),c=n(1485),u=n(947),d=n(104),l=n(81),f=n(57),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=[r.a,i.a],g=function(){function e(e,t,n,o,r,i){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i)}return e=p([Object(o.I)({declarations:[],imports:[u.a],providers:[r.a,i.a,s.a,a.a,c.a]}),h("design:paramtypes",[l.a,a.a,d.a,s.a,f.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d}),n.d(t,"b",function(){return l});var o=n(0),r=n(254),i=n(949),s=n(1486),a=n(81),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=[r.a,i.a],l=function(){function e(e,t){e.registerHandler(t)}return e=c([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a]}),u("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s}),n.d(t,"b",function(){return a});var o=n(0),r=n(257),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=[r.a],a=function(){function e(){}return e=i([Object(o.I)({declarations:[],imports:[],providers:[r.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return D}),n.d(t,"b",function(){return j});var o=n(0),r=n(134),i=n(103),s=n(327),a=n(399),c=n(1487),u=n(81),d=n(33),l=n(57),f=n(61),p=n(1488),h=n(799),m=n(800),g=n(1489),y=n(1490),v=n(1491),b=n(9),_=n(2),P=n(78),O=n(32),w=n(199),S=n(1492),R=n(148),E=n(6),C=n(51),I=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},A=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},D=[i.a,s.a,a.a],j=function(){function e(e,t,n,o,r,a,c,u,d,l,f,p,h,m,g,y,v,b,_,P,O,w,S,R){e.registerHandler(t),n.registerHandler(o),n.registerHandler(r),c.registerHandler(a),c.registerHandler(S),c.registerHandler(R),u.register(d),u.register(t),P.registerHandler(_),l.onConnect().subscribe(function(){f.run(function(){p.syncAllDiscussions(void 0,!0)})});var E=function(e){g.isMessagingEnabledForSite(e.site).then(function(){y.isFeatureDisabled("CoreMainMenuDelegate_AddonMessages",e.site).then(function(t){t||g.invalidateDiscussionsCache().finally(function(){v.goInSite(void 0,"AddonMessagesIndexPage",void 0,e.site)})})})};h.isDesktop()&&m.registerClick(i.a.PUSH_SIMULATION_COMPONENT,E),O.on("click").subscribe(function(e){if(w.isFalseOrZero(e.notif))return E(e),!0}),b.registerSiteTableMigration({name:"mma_messages_offline_messages",newName:s.a.MESSAGES_TABLE,fields:[{name:"textformat",delete:!0}]}),b.registerLocalNotifComponentMigration("mmaMessagesPushSimulation",i.a.PUSH_SIMULATION_COMPONENT)}return e=I([Object(o.I)({declarations:[],imports:[],providers:[i.a,s.a,a.a,c.a,p.a,h.a,m.a,g.a,y.a,v.a,S.a]}),A("design:paramtypes",[u.a,c.a,d.a,y.a,g.a,p.a,l.a,f.a,v.a,r.a,o.M,a.a,b.a,P.a,i.a,_.a,O.a,C.a,S.a,w.a,R.a,E.a,h.a,m.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(57),i=n(2),s=n(103),a=n(800),c=n(12),u=n(8),d=n(1),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,i){var s=this;this.sitesProvider=e,this.messagesProvider=t,this.eventsProvider=n,this.domUtils=o,this.translate=i,this.name="AddonMessages:addContact",this.priority=800,this.type=r.a.TYPE_ACTION,this.disabled=!1,this.updateObs=n.on(a.a.UPDATED_EVENT,function(e){s.checkButton(e.userId)})}return t=e,e.prototype.isEnabled=function(){return this.messagesProvider.isPluginEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){return e.id!=this.sitesProvider.getCurrentSiteUserId()},e.prototype.getDisplayData=function(e,n){var o=this;return this.checkButton(e.id),{icon:"",title:"",spinner:!1,class:"",action:function(e,n,r,i){e.preventDefault(),e.stopPropagation(),o.disabled||(o.disabled=!0,o.updateButton({spinner:!0}),o.messagesProvider.isContact(r.id).then(function(e){if(e){var t=o.translate.instant("addon.messages.removecontactconfirm"),n=o.translate.instant("addon.messages.removecontact");return o.domUtils.showConfirm(t,n,n).then(function(){return o.messagesProvider.removeContact(r.id)})}return o.messagesProvider.addContact(r.id)}).catch(function(e){o.domUtils.showErrorModalDefault(e,"core.error",!0)}).finally(function(){o.eventsProvider.trigger(t.UPDATED_EVENT,{userId:r.id}),o.checkButton(r.id).finally(function(){o.disabled=!1})}))}}},e.prototype.checkButton=function(e){var t=this;return this.updateButton({spinner:!0}),this.messagesProvider.isContact(e).then(function(e){t.updateButton(e?{title:"addon.messages.removecontact",class:"addon-messages-removecontact-handler",icon:"remove",hidden:!1,spinner:!1}:{title:"addon.messages.addcontact",class:"addon-messages-addcontact-handler",icon:"add",hidden:!1,spinner:!1})}).catch(function(){t.updateButton({hidden:!0})})},e.prototype.updateButton=function(e){this.eventsProvider.trigger(r.a.UPDATE_HANDLER_EVENT,{handler:this.name,data:e})},e.prototype.ngOnDestroy=function(){this.updateObs&&this.updateObs.off()},e.UPDATED_EVENT="AddonMessagesAddContactUserHandler_updated_event",e=t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,c.a,u.a,d.c])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(57),i=n(2),s=n(103),a=n(799),c=n(12),u=n(8),d=n(1),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,i){var s=this;this.sitesProvider=e,this.messagesProvider=t,this.eventsProvider=n,this.domUtils=o,this.translate=i,this.name="AddonMessages:blockContact",this.priority=600,this.type=r.a.TYPE_ACTION,this.disabled=!1,this.updateObs=n.on(a.a.UPDATED_EVENT,function(e){s.checkButton(e.userId)})}return t=e,e.prototype.isEnabled=function(){return this.messagesProvider.isPluginEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){return e.id!=this.sitesProvider.getCurrentSiteUserId()},e.prototype.getDisplayData=function(e,n){var o=this;return this.checkButton(e.id),{icon:"",title:"",spinner:!1,class:"",action:function(e,n,r,i){e.preventDefault(),e.stopPropagation(),o.disabled||(o.disabled=!0,o.updateButton({spinner:!0}),o.messagesProvider.isBlocked(r.id).then(function(e){if(e)return o.messagesProvider.unblockContact(r.id);var t=o.translate.instant("addon.messages.blockcontactconfirm"),n=o.translate.instant("addon.messages.blockcontact");return o.domUtils.showConfirm(t,n,n).then(function(){return o.messagesProvider.blockContact(r.id)})}).catch(function(e){o.domUtils.showErrorModalDefault(e,"core.error",!0)}).finally(function(){o.eventsProvider.trigger(t.UPDATED_EVENT,{userId:r.id}),o.checkButton(r.id).finally(function(){o.disabled=!1})}))}}},e.prototype.checkButton=function(e){var t=this;return this.updateButton({spinner:!0}),this.messagesProvider.isBlocked(e).then(function(e){t.updateButton(e?{title:"addon.messages.unblockcontact",class:"addon-messages-unblockcontact-handler",icon:"checkmark-circle",hidden:!1,spinner:!1}:{title:"addon.messages.blockcontact",class:"addon-messages-blockcontact-handler",icon:"close-circle",hidden:!1,spinner:!1})}).catch(function(){t.updateButton({hidden:!0})})},e.prototype.updateButton=function(e){this.eventsProvider.trigger(r.a.UPDATE_HANDLER_EVENT,{handler:this.name,data:e})},e.prototype.ngOnDestroy=function(){this.updateObs&&this.updateObs.off()},e.UPDATED_EVENT="AddonMessagesBlockContactUserHandler_updated_event",e=t=l([Object(o.A)(),f("design:paramtypes",[i.a,s.a,c.a,u.a,d.c])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return R}),n.d(t,"b",function(){return E});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(52),u=n(80),d=n(255),l=n(108),f=n(110),p=n(102),h=n(733),m=n(736),g=n(1493),y=n(1494),v=n(1495),b=n(1496),_=n(1497),P=n(1503),O=n(51),w=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},S=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=[c.a,u.a,d.a,l.a,f.a,p.a],E=function(){function e(e,t,n,o,r,i,s,a,c){e.registerHandler(t),n.registerHandler(o),r.register(i),a.registerHandler(c),s.registerSiteTablesMigration([{name:"mma_mod_assign_submissions",newName:u.a.SUBMISSIONS_TABLE,fields:[{name:"assignmentid",newName:"assignid"},{name:"submitted",type:"boolean"},{name:"submissionstatement",type:"boolean"},{name:"plugindata",type:"object"}]},{name:"mma_mod_assign_submissions_grading",newName:u.a.SUBMISSIONS_GRADES_TABLE,fields:[{name:"assignmentid",newName:"assignid"},{name:"addattempt",type:"boolean"},{name:"applytoall",type:"boolean"},{name:"outcomes",type:"object"},{name:"plugindata",type:"object"}]}])}return e=w([Object(o.I)({declarations:[],imports:[_.a,P.a],providers:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a]}),S("design:paramtypes",[s.a,g.a,a.a,y.a,r.a,v.a,O.a,i.a,b.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(139),i=n(742),s=n(347),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t){var n=e.call(this)||this;return n.commentsProvider=t,n}return a(t,e),t.prototype.invalidate=function(){return this.commentsProvider.invalidateCommentsData("module",this.assign.cmid,"assignsubmission_comments",this.submission.id,"submission_comments")},t.prototype.showComments=function(){this.commentsComponent&&this.commentsComponent.openComments()},c([Object(o._9)(i.a),u("design:type",i.a)],t.prototype,"commentsComponent",void 0),t=c([Object(o.m)({selector:"addon-mod-assign-submission-comments",template:'<a ion-item text-wrap (click)="showComments()" detail-none>\n    <h2>{{plugin.name}}</h2>\n    <core-comments contextLevel="module" [instanceId]="assign.cmid" component="assignsubmission_comments" [itemId]="submission.id" area="submission_comments" [title]="plugin.name"></core-comments>\n</a>\n'}),u("design:paramtypes",[r.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(27),i=n(121),s=n(18),a=n(2),c=n(118),u=n(6),d=n(56),l=n(52),f=n(80),p=n(108),h=n(804),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(){function e(e,t,n,o,r,i,s,a,c,u){this.sitesProvider=e,this.wsProvider=t,this.assignProvider=n,this.assignOfflineProvider=o,this.assignHelper=r,this.fileSessionProvider=i,this.fileUploaderProvider=s,this.filepoolProvider=a,this.fileProvider=c,this.utils=u,this.name="AddonModAssignSubmissionFileHandler",this.type="file"}return t=e,e.prototype.canEditOffline=function(e,t,n){return!0},e.prototype.clearTmpData=function(e,t,n,o){var r=this.fileSessionProvider.getFiles(l.a.COMPONENT,e.id);this.fileSessionProvider.clearFiles(l.a.COMPONENT,e.id),this.fileUploaderProvider.clearTmpFiles(r)},e.prototype.copySubmissionData=function(e,t,n,o,r){var i=this.assignProvider.getSubmissionPluginAttachments(t);return this.assignHelper.uploadFiles(e.id,i).then(function(e){n.files_filemanager=e})},e.prototype.getComponent=function(e,t,n){return h.a},e.prototype.deleteOfflineData=function(e,n,o,r,i){return this.assignHelper.deleteStoredSubmissionFiles(e.id,t.FOLDER_NAME,n.userid,i).catch(function(){})},e.prototype.getPluginFiles=function(e,t,n,o){return this.assignProvider.getSubmissionPluginAttachments(n)},e.prototype.getSizeForCopy=function(e,t){var n=this,o=[],r=0;return this.assignProvider.getSubmissionPluginAttachments(t).forEach(function(e){o.push(n.wsProvider.getRemoteFileSize(e.fileurl).then(function(e){if(-1==e)return Promise.reject(null);r+=e}))}),Promise.all(o).then(function(){return r})},e.prototype.getSizeForEdit=function(e,t,n,o){var r=this,i=this.sitesProvider.getCurrentSiteId();if(this.hasDataChanged(e,t,n,o)){var s=[],a=0;return this.fileSessionProvider.getFiles(l.a.COMPONENT,e.id).forEach(function(e){e.filename&&!e.name?s.push(r.filepoolProvider.getFilePathByUrl(i,e.fileurl).then(function(e){return r.fileProvider.getFile(e).then(function(e){return r.fileProvider.getFileObjectFromFileEntry(e)}).then(function(e){a+=e.size})}).catch(function(){return r.wsProvider.getRemoteFileSize(e.fileurl).then(function(e){if(-1==e)return Promise.reject(null);a+=e})})):e.name&&s.push(r.fileProvider.getFileObjectFromFileEntry(e).then(function(e){a+=e.size}))}),Promise.all(s).then(function(){return a})}return 0},e.prototype.hasDataChanged=function(e,t,n,o){var r=this;return this.assignOfflineProvider.getSubmission(e.id,t.userid).catch(function(){}).then(function(e){if(e&&e.plugindata&&e.plugindata.files_filemanager)return e.plugindata.files_filemanager.offline+e.plugindata.files_filemanager.online.length;var t=r.assignProvider.getSubmissionPluginAttachments(n);return t&&t.length}).then(function(t){var n=r.fileSessionProvider.getFiles(l.a.COMPONENT,e.id);if(n.length!=t)return!0;for(var o=0;o<n.length;o++){var i=n[o];if(!i.filename&&void 0!==i.name&&!i.offline)return!0}return!1})},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForEdit=function(){return!0},e.prototype.prepareSubmissionData=function(e,n,o,r,i,s,a,c){if(this.hasDataChanged(e,n,o,r)){var u=this.fileSessionProvider.getFiles(l.a.COMPONENT,e.id),d=this.utils.hasRepeatedFilenames(u);return d?Promise.reject(d):this.assignHelper.uploadOrStoreFiles(e.id,t.FOLDER_NAME,u,s,a,c).then(function(e){i.files_filemanager=e})}},e.prototype.prepareSyncData=function(e,n,o,r,i,s){var a=this,c=r&&r.plugindata&&r.plugindata.files_filemanager;if(c){var u=c.online||[];return(c.offline?this.assignHelper.getStoredSubmissionFiles(e.id,t.FOLDER_NAME,n.userid,s).then(function(e){u=u.concat(e)}).catch(function(){}):Promise.resolve()).then(function(){return a.assignHelper.uploadFiles(e.id,u,s).then(function(e){i.files_filemanager=e})})}},e.FOLDER_NAME="submission_file",e=t=m([Object(o.A)(),g("design:paramtypes",[a.a,c.a,l.a,f.a,p.a,i.a,d.a,s.a,r.a,u.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(121),i=n(56),s=n(52),a=n(108),c=n(80),u=n(803),d=n(347),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,i){var a=e.call(this)||this;return a.fileSessionprovider=t,a.assignProvider=n,a.assignOfflineProvider=o,a.assignHelper=r,a.fileUploaderProvider=i,a.component=s.a.COMPONENT,a}return l(t,e),t.prototype.ngOnInit=function(){var e=this;this.assignOfflineProvider.getSubmission(this.assign.id).catch(function(){}).then(function(t){if(t&&t.plugindata&&t.plugindata.files_filemanager){return(t.plugindata.files_filemanager.offline?e.assignHelper.getStoredSubmissionFiles(e.assign.id,u.a.FOLDER_NAME):Promise.resolve([])).then(function(n){var o=t.plugindata.files_filemanager.online||[];n=e.fileUploaderProvider.markOfflineFiles(n),e.files=o.concat(n)})}e.files=e.assignProvider.getSubmissionPluginAttachments(e.plugin)}).finally(function(){e.fileSessionprovider.setFiles(e.component,e.assign.id,e.files)})},t=f([Object(o.m)({selector:"addon-mod-assign-submission-file",template:'\x3c!-- Read only. --\x3e\n<ion-item text-wrap *ngIf="files && files.length && !edit">\n    <h2>{{plugin.name}}</h2>\n    <div *ngFor="let file of files" no-lines>\n        \x3c!-- Files already attached to the submission. --\x3e\n        <core-file *ngIf="!file.name" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n\n        \x3c!-- Files stored in offline to be sent later. --\x3e\n        <core-local-file *ngIf="file.name" [file]="file"></core-local-file>\n    </div>\n</ion-item>\n\n\x3c!-- Edit --\x3e\n<div *ngIf="edit">\n    <ion-item-divider text-wrap color="light">{{plugin.name}}</ion-item-divider>\n    <core-attachments [files]="files" [maxSize]="configs.maxsubmissionsizebytes" [maxSubmissions]="configs.maxfilesubmissions" [component]="component" [componentId]="assign.cmid" [acceptedTypes]="configs.filetypeslist" [allowOffline]="allowOffline"></core-attachments>\n</div>\n'}),p("design:paramtypes",[r.a,s.a,c.a,a.a,i.a])],t)}(d.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(20),i=n(8),s=n(11),a=n(52),c=n(80),u=n(347),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i,s){var c=e.call(this)||this;return c.fb=t,c.domUtils=n,c.textUtils=o,c.assignProvider=r,c.assignOfflineProvider=i,c.component=a.a.COMPONENT,c.element=s.nativeElement,c}return d(t,e),t.prototype.ngOnInit=function(){var e=this;this.assignOfflineProvider.getSubmission(this.assign.id).catch(function(){}).then(function(t){return t&&t.plugindata&&t.plugindata.onlinetext_editor?t.plugindata.onlinetext_editor.text:e.assignProvider.getSubmissionPluginText(e.plugin)}).then(function(t){e.configs.wordlimit=parseInt(e.configs.wordlimit,10),e.configs.wordlimitenabled=parseInt(e.configs.wordlimitenabled,10),e.text=t,e.edit?e.control=e.fb.control(t):e.element.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation(),t&&e.textUtils.expandText(e.plugin.name,t,e.component,e.assign.cmid)}),e.configs.wordlimitenabled&&(e.words=e.textUtils.countWords(t))}).finally(function(){e.loaded=!0})},t.prototype.onChange=function(e){var t=this;this.configs.wordlimitenabled&&(clearTimeout(this.wordCountTimeout),this.wordCountTimeout=setTimeout(function(){t.words=t.textUtils.countWords(e)},1500))},t=l([Object(o.m)({selector:"addon-mod-assign-submission-online-text",template:'\x3c!-- Read only --\x3e\n<ion-item text-wrap *ngIf="!edit && text">\n    <h2>{{ plugin.name }}</h2>\n    <p *ngIf="words">{{ \'addon.mod_assign.numwords\' | translate: {\'$a\': words} }}</p>\n    <p>\n        <core-format-text [component]="component" [componentId]="assign.cmid" [maxHeight]="80" [fullOnClick]="true" [fullTitle]="plugin.name" [text]="text"></core-format-text>\n    </p>\n</ion-item>\n\n\x3c!-- Edit --\x3e\n<div *ngIf="edit && loaded">\n    <ion-item-divider text-wrap color="light">{{ plugin.name }}</ion-item-divider>\n    <ion-item text-wrap *ngIf="configs.wordlimitenabled && words >= 0">\n        <h2>{{ \'addon.mod_assign.wordlimit\' | translate }}</h2>\n        <p>{{ \'core.numwords\' | translate: {\'$a\': words + \' / \' + configs.wordlimit} }}</p>\n    </ion-item>\n    <ion-item text-wrap>\n        <core-rich-text-editor item-content [control]="control" [placeholder]="plugin.name" name="onlinetext_editor_text" (contentChanged)="onChange($event)" [component]="component" [componentId]="assign.cmid"></core-rich-text-editor>\n    </ion-item>\n</div>\n'}),f("design:paramtypes",[r.a,i.a,s.a,a.a,c.a,o.t])],t)}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(2),i=n(11),s=n(52),a=n(80),c=n(807),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o){this.sitesProvider=e,this.textUtils=t,this.assignProvider=n,this.assignOfflineProvider=o,this.name="AddonModAssignFeedbackCommentsHandler",this.type="comments",this.drafts={}}return t=e,e.prototype.discardDraft=function(e,t,n){var o=this.getDraftId(e,t,n);void 0!==this.drafts[o]&&delete this.drafts[o]},e.prototype.getComponent=function(e,t){return c.a},e.prototype.getDraft=function(e,t,n){var o=this.getDraftId(e,t,n);if(void 0!==this.drafts[o])return this.drafts[o]},e.prototype.getDraftId=function(e,t,n){return(n=n||this.sitesProvider.getCurrentSiteId())+"#"+e+"#"+t},e.getTextFromInputData=function(e,t,n){var o=n.assignfeedbackcomments_editor;return o&&o.text&&(o=o.text),e.restorePluginfileUrls(o,t.fileareas&&t.fileareas[0]?t.fileareas[0].files:[])},e.prototype.hasDataChanged=function(e,n,o,r,i){var s=this;return this.assignOfflineProvider.getSubmissionGrade(e.id,i).catch(function(){}).then(function(e){return e&&e.plugindata&&e.plugindata.assignfeedbackcomments_editor?e.plugindata.assignfeedbackcomments_editor.text:s.assignProvider.getSubmissionPluginText(o)}).then(function(e){var n=t.getTextFromInputData(s.textUtils,o,r);return void 0!==n&&e!=n})},e.prototype.hasDraftData=function(e,t,n){return!!this.getDraft(e,t,n)},e.prototype.isEnabled=function(){return!0},e.prototype.prepareFeedbackData=function(e,t,n,o,r){var i=this.getDraft(e,t,r);i&&(i.text=this.textUtils.formatHtmlLines(i.text),o.assignfeedbackcomments_editor=i)},e.prototype.saveDraft=function(e,t,n,o,r){o&&(this.drafts[this.getDraftId(e,t,r)]=o)},e=t=u([Object(o.A)(),d("design:paramtypes",[r.a,i.a,s.a,a.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(20),s=n(8),a=n(11),c=n(52),u=n(80),d=n(110),l=n(348),f=n(806),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e){function t(t,n,o,r,i,s,a,u){var d=e.call(this,t)||this;return d.domUtils=o,d.textUtils=r,d.assignOfflineProvider=i,d.assignProvider=s,d.fb=a,d.feedbackDelegate=u,d.component=c.a.COMPONENT,d.element=n.nativeElement,d}return p(t,e),t.prototype.ngOnInit=function(){var e=this;this.getText().then(function(t){e.text=t,e.canEdit||e.edit?e.edit&&(e.control=e.fb.control(t)):e.element.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.text&&e.textUtils.expandText(e.plugin.name,e.text,e.component,e.assign.cmid)})}).finally(function(){e.loaded=!0})},t.prototype.editComment=function(){var e=this;this.editFeedback().then(function(t){var n=f.a.getTextFromInputData(e.textUtils,e.plugin,t);e.isSent=!1,e.text=n,e.feedbackDelegate.saveFeedbackDraft(e.assign.id,e.userId,e.plugin,{text:n,format:1})}).catch(function(){})},t.prototype.getText=function(){var e=this;return this.feedbackDelegate.getPluginDraftData(this.assign.id,this.userId,this.plugin).then(function(t){return t?(e.isSent=!1,t.text):e.assignOfflineProvider.getSubmissionGrade(e.assign.id,e.userId).catch(function(){}).then(function(t){return t&&t.plugindata&&t.plugindata.assignfeedbackcomments_editor?(e.isSent=!1,e.feedbackDelegate.saveFeedbackDraft(e.assign.id,e.userId,e.plugin,t.plugindata.assignfeedbackcomments_editor),t.plugindata.assignfeedbackcomments_editor.text):(e.isSent=!0,e.assignProvider.getSubmissionPluginText(e.plugin))})})},t=h([Object(o.m)({selector:"addon-mod-assign-feedback-comments",template:'\x3c!-- Read only. --\x3e\n<ion-item text-wrap *ngIf="(text || canEdit) && !edit">\n    <h2>{{ plugin.name }}</h2>\n    <p>\n        <core-format-text [component]="component" [componentId]="assign.cmid" [maxHeight]="80" [fullOnClick]="true" [fullTitle]="plugin.name" [text]="text"></core-format-text>\n    </p>\n    <div item-end>\n        <div text-right>\n            <button ion-button icon-only clear *ngIf="canEdit" (click)="editComment()" color="dark">\n                <ion-icon name="create"></ion-icon>\n            </button>\n        </div>\n        <ion-note *ngIf="!isSent" color="dark">\n            <ion-icon name="time"></ion-icon>\n            {{ \'core.notsent\' | translate }}\n        </ion-note>\n    </div>\n</ion-item>\n\n\x3c!-- Edit --\x3e\n<ion-item text-wrap *ngIf="edit && loaded">\n    <core-rich-text-editor item-content [control]="control" [placeholder]="plugin.name" name="assignfeedbackcomments_editor" [component]="component" [componentId]="assign.cmid"></core-rich-text-editor>\n</ion-item>\n'}),m("design:paramtypes",[r.o,o.t,s.a,a.a,u.a,c.a,i.a,d.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(52),s=n(348),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t)||this;return o.assignProvider=n,o.component=i.a.COMPONENT,o}return a(t,e),t.prototype.ngOnInit=function(){this.plugin&&(this.files=this.assignProvider.getSubmissionPluginAttachments(this.plugin))},t=c([Object(o.m)({selector:"addon-mod-assign-feedback-edit-pdf",template:'\x3c!-- Read only. --\x3e\n<ion-item text-wrap *ngIf="files && files.length">\n    <h2>{{plugin.name}}</h2>\n    <div no-lines>\n        <core-file *ngFor="let file of files" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n    </div>\n</ion-item>\n'}),u("design:paramtypes",[r.o,i.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(52),s=n(348),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t)||this;return o.assignProvider=n,o.component=i.a.COMPONENT,o}return a(t,e),t.prototype.ngOnInit=function(){this.plugin&&(this.files=this.assignProvider.getSubmissionPluginAttachments(this.plugin))},t=c([Object(o.m)({selector:"addon-mod-assign-feedback-file",template:'\x3c!-- Read only. --\x3e\n<ion-item text-wrap *ngIf="files && files.length">\n    <h2>{{plugin.name}}</h2>\n    <div no-lines>\n        <core-file *ngFor="let file of files" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n    </div>\n</ion-item>\n'}),u("design:paramtypes",[r.o,i.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h}),n.d(t,"b",function(){return m});var o=n(0),r=n(951),i=n(227),s=n(1509),a=n(1510),c=n(739),u=n(35),d=n(33),l=n(36),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=[i.a],m=function(){function e(e,t,n,o,r,i){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i)}return e=f([Object(o.I)({declarations:[],imports:[r.a],providers:[i.a,s.a,a.a,c.a]}),p("design:paramtypes",[u.a,s.a,d.a,a.a,l.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return p});var o=n(0),r=n(33),i=n(35),s=n(952),a=n(395),c=n(1511),u=n(1512),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=[a.a],p=function(){function e(e,t,n,o){e.registerHandler(t),n.registerHandler(o)}return e=d([Object(o.I)({declarations:[],imports:[s.a],providers:[a.a,c.a,u.a]}),l("design:paramtypes",[i.a,u.a,r.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return _});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(953),u=n(1513),d=n(228),l=n(1514),f=n(1515),p=n(230),h=n(1516),m=n(229),g=n(51),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=[d.a,p.a,m.a],_=function(){function e(e,t,n,o,r,i,s,a,c){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.register(a),c.registerSiteTableMigration({name:"mma_mod_choice_offline_responses",newName:m.a.CHOICE_TABLE,fields:[{name:"responses",type:"object"},{name:"deleting",type:"boolean"}]})}return e=y([Object(o.I)({declarations:[],imports:[c.a],providers:[d.a,p.a,m.a,u.a,f.a,l.a,h.a]}),v("design:paramtypes",[s.a,u.a,a.a,f.a,i.a,l.a,r.a,h.a,g.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return R}),n.d(t,"b",function(){return E});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(932),u=n(1517),d=n(86),l=n(1518),f=n(1519),p=n(1520),h=n(1521),m=n(1522),g=n(1523),y=n(248),v=n(1524),b=n(258),_=n(1525),P=n(236),O=n(51),w=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},S=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},R=[d.a,y.a,b.a,P.a],E=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f,p){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),r.registerHandler(c),r.registerHandler(d),r.registerHandler(l),r.registerHandler(f),r.registerHandler(p),s.register(a),u.registerSiteTableMigration({name:"mma_mod_feedback_responses",newName:P.a.FEEDBACK_TABLE,fields:[{name:"responses",type:"object"}]})}return e=w([Object(o.I)({declarations:[],imports:[c.a],providers:[d.a,y.a,b.a,P.a,u.a,v.a,l.a,f.a,p.a,h.a,m.a,g.a,_.a]}),S("design:paramtypes",[s.a,u.a,a.a,v.a,i.a,l.a,r.a,_.a,f.a,O.a,p.a,h.a,m.a,g.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var o=n(0),r=n(349),i=n(815),s=n(1526),a=n(35),c=n(955),u=n(1527),d=n(1528),l=n(1529),f=n(33),p=n(36),h=n(155),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=[r.a,i.a],v=function(){function e(e,t,n,o,r,i,s,a){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.registerHandler(a)}return e=m([Object(o.I)({declarations:[],imports:[c.a],providers:[r.a,i.a,s.a,u.a,d.a,l.a]}),g("design:paramtypes",[a.a,s.a,p.a,u.a,f.a,d.a,h.a,l.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(10),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.courseProvider=e}return e.prototype.formatContents=function(e){var t=[],n=[],o=this.courseProvider.getModuleIconSrc("folder");return e.forEach(function(e){if("/"!==e.filepath){var r=n,i=e.filepath,s="";"/"===i.substr(0,1)&&(i=i.substr(1)),"/"===i.substr(i.length-1)&&(i=i.slice(0,-1)),i.split("/").forEach(function(e){s=s+"/"+e;var t=r.find(function(t){return t.name===e});if(t)r=t.contents;else{var n={name:e,fileicon:o,contents:[],filepath:s,type:"folder"};r.push(n),r=n.contents}}),r.push(e)}else t.push(e)}),n.concat(t)},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P}),n.d(t,"b",function(){return O});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(117),u=n(149),d=n(195),l=n(196),f=n(1530),p=n(817),h=n(1531),m=n(1532),g=n(1533),y=n(940),v=n(51),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=[c.a,u.a,d.a,l.a],O=function(){function e(e,t,n,o,r,i,s,a,c,d){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),d.registerSiteTablesMigration([{name:"mma_mod_forum_offline_discussions",newName:u.a.DISCUSSIONS_TABLE,fields:[{name:"forumAndUser",delete:!0},{name:"options",type:"object"}]},{name:"mma_mod_forum_offline_replies",newName:u.a.REPLIES_TABLE,fields:[{name:"forumAndUser",delete:!0},{name:"discussionAndUser",delete:!0},{name:"options",type:"object"}]}])}return e=b([Object(o.I)({declarations:[],imports:[y.a],providers:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a]}),_("design:paramtypes",[i.a,f.a,s.a,p.a,r.a,h.a,a.a,m.a,g.a,v.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(46),p=n(26),h=n(117),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e){function t(t,n,o,r,i,s,a,c,u,d){var l=e.call(this,t,n,o,r,i,s,a)||this;return l.groupsProvider=c,l.userProvider=u,l.forumProvider=d,l.name="AddonModForum",l.modName="forum",l.component=h.a.COMPONENT,l.updatesNames=/^configuration$|^.*files$|^discussions$/,l}return m(t,e),t.prototype.getFiles=function(e,t,n){var o=this;return this.forumProvider.getForum(t,e.id).then(function(t){var n=o.getIntroFilesFromInstance(e,t);return o.getPostsForPrefetch(t.id).then(function(e){return n.concat(o.getPostsFiles(e))})}).catch(function(){return[]})},t.prototype.getPostsFiles=function(e){var t=this,n=[];return e.forEach(function(e){e.attachments&&e.attachments.length&&(n=n.concat(e.attachments)),e.message&&(n=n.concat(t.domUtils.extractDownloadableFilesFromHtmlAsFakeFileObjects(e.message)))}),n},t.prototype.getPostsForPrefetch=function(e){var t=this;return this.forumProvider.getDiscussionsInPages(e,!1,2).then(function(e){if(e.error)return Promise.reject(null);var n=[],o=[];return e.discussions.forEach(function(e){n.push(t.forumProvider.getDiscussionPosts(e.discussion).then(function(e){o=o.concat(e)}))}),Promise.all(n).then(function(){return o})})},t.prototype.invalidateContent=function(e,t){return this.forumProvider.invalidateContent(e,t)},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchForum.bind(this))},t.prototype.prefetchForum=function(e,t,n,o){var r=this;return this.forumProvider.getForum(t,e.id).then(function(n){return r.getPostsForPrefetch(n.id).then(function(i){var s=[],a=i.map(function(e){return e.userid}).filter(function(e){return!!e});s.push(r.userProvider.prefetchProfiles(a).catch(function(){}));var c=r.getIntroFilesFromInstance(e,n).concat(r.getPostsFiles(i));return s.push(r.filepoolProvider.addFilesToQueue(o,c,r.component,e.id)),s.push(r.prefetchGroupsInfo(n,t,n.cancreatediscussions)),Promise.all(s)})})},t.prototype.prefetchGroupsInfo=function(e,t,n){var o=this;return this.groupsProvider.getActivityGroupMode(e.cmid).then(function(t){return t!==f.a.SEPARATEGROUPS&&t!==f.a.VISIBLEGROUPS?o.forumProvider.canAddDiscussionToAll(e.id).catch(function(){}):o.groupsProvider.getActivityAllowedGroups(e.cmid).then(function(r){return t===f.a.SEPARATEGROUPS?o.forumProvider.canAddDiscussionToAll(e.id).catch(function(){}):n?o.forumProvider.canAddDiscussionToAll(e.id).catch(function(){return{status:!1}}).then(function(t){if(!t.status){var n=[];return r.forEach(function(t){n.push(o.forumProvider.canAddDiscussion(e.id,t.id).catch(function(){}))}),Promise.all(n)}}):void 0})}).catch(function(e){if(n)return Promise.reject(e)})},t=g([Object(o.A)(),y("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a,h.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return P}),n.d(t,"b",function(){return O});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(137),u=n(163),d=n(410),l=n(350),f=n(1535),p=n(1536),h=n(1537),m=n(1538),g=n(1539),y=n(956),v=n(51),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=[c.a,u.a,d.a,l.a],O=function(){function e(e,t,n,o,r,i,s,a,c,d){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),d.registerSiteTableMigration({name:"mma_mod_glossary_add_entry",newName:u.a.ENTRIES_TABLE,fields:[{name:"glossaryAndConcept",delete:!0},{name:"glossaryAndUser",delete:!0},{name:"options",type:"object"},{name:"attachments",type:"object"}]})}return e=b([Object(o.I)({declarations:[],imports:[y.a],providers:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a]}),_("design:paramtypes",[i.a,f.a,s.a,p.a,r.a,h.a,a.a,m.a,g.a,v.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){var n=this;this.viewCtrl=t,this.modes=[],this.selectedMode=e.get("selectedMode");var o=e.get("glossary");this.modes=[{key:"search",langkey:"addon.mod_glossary.bysearch"}],o.browsemodes.forEach(function(e){switch(e){case"letter":n.modes.push({key:"letter_all",langkey:"addon.mod_glossary.byalphabet"});break;case"cat":n.modes.push({key:"cat_all",langkey:"addon.mod_glossary.bycategory"});break;case"date":n.modes.push({key:"newest_first",langkey:"addon.mod_glossary.bynewestfirst"}),n.modes.push({key:"recently_updated",langkey:"addon.mod_glossary.byrecentlyupdated"});break;case"author":n.modes.push({key:"author_all",langkey:"addon.mod_glossary.byauthor"})}})}return e.prototype.modePicked=function(e,t){return this.viewCtrl.dismiss(t),!0},e=i([Object(o.m)({selector:"addon-mod-glossary-mode-picker-popover",template:'<ion-list radio-group [(ngModel)]="selectedMode">\n    <ion-item text-wrap *ngFor="let mode of modes" >\n        <ion-label>{{mode.langkey | translate}}</ion-label>\n        <ion-radio [value]="mode.key" (ionSelect)="modePicked($event, mode.key)" ></ion-radio>\n    </ion-item>\n</ion-list>\n'}),s("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g}),n.d(t,"b",function(){return y});var o=n(0),r=n(957),i=n(1540),s=n(237),a=n(821),c=n(1541),u=n(1542),d=n(33),l=n(35),f=n(36),p=n(155),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=[s.a],y=function(){function e(e,t,n,o,r,i,s,a){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.registerHandler(a)}return e=h([Object(o.I)({declarations:[],imports:[r.a],providers:[s.a,i.a,a.a,c.a,u.a]}),m("design:paramtypes",[l.a,i.a,f.a,a.a,d.a,c.a,p.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(159),f=n(237),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e){function t(t,n,o,r,i,s,a,c){var u=e.call(this,t,n,o,r,i,s,a)||this;return u.imscpProvider=c,u.name="AddonModImscp",u.modName="imscp",u.component=f.a.COMPONENT,u}return p(t,e),t.prototype.downloadOrPrefetch=function(t,n,o,r){var i=this,s=this.sitesProvider.getCurrentSiteId();return this.filepoolProvider.getPackageDirPathByUrl(s,t.url).then(function(r){var a=[];return a.push(e.prototype.downloadOrPrefetch.call(i,t,n,o,r)),a.push(i.imscpProvider.getImscp(n,t.id,s)),Promise.all(a)})},t.prototype.getIntroFiles=function(e,t){var n=this;return this.imscpProvider.getImscp(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.imscpProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.imscpProvider.invalidateImscpData(t)),n.push(this.courseProvider.invalidateModule(e.id)),Promise.all(n)},t.prototype.isEnabled=function(){return this.imscpProvider.isPluginEnabled()},t.prototype.isFileDownloadable=function(e){return this.imscpProvider.isFileDownloadable(e)},t=h([Object(o.A)(),m("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.viewCtrl=t,this.items=[],this.items=e.get("items")||[]}return e.prototype.loadItem=function(e){this.viewCtrl.dismiss(e)},e.prototype.getNumberForPadding=function(e){return new Array(e)},e=i([Object(o.m)({selector:"addon-mod-imscp-toc-popover",template:'<ion-list>\n    <a ion-item *ngFor="let item of items" (click)="loadItem(item.href)" detail-none [class.core-bold]="!item.href">\n        <span padding-left *ngFor="let i of getNumberForPadding(item.level)"></span>{{item.title}}\n    </a>\n</ion-list>\n'}),s("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"b",function(){return w});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(958),u=n(95),d=n(200),l=n(259),f=n(941),p=n(1543),h=n(351),m=n(1544),g=n(1545),y=n(1546),v=n(1547),b=n(51),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},O=[u.a,d.a,l.a,f.a],w=function(){function e(e,t,n,o,r,i,s,a,c,f,p){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),s.registerHandler(f),p.registerSiteTablesMigration([{name:"mma_mod_lesson_password",newName:u.a.PASSWORD_TABLE,fields:[{name:"id",newName:"lessonid"}]},{name:"mma_mod_lesson_retakes",newName:d.a.RETAKES_TABLE,fields:[{name:"finished",type:"boolean"},{name:"outoftime",type:"boolean"}]},{name:"mma_mod_lesson_page_attempts",newName:d.a.PAGE_ATTEMPTS_TABLE,fields:[{name:"lessonAndPage",delete:!0},{name:"lessonAndRetake",delete:!0},{name:"lessonAndRetakeAndType",delete:!0},{name:"lessonAndRetakeAndPage",delete:!0},{name:"data",type:"object"},{name:"correct",type:"boolean"},{name:"userAnswer",type:"object"}]},{name:"mma_mod_lesson_retakes_finished_sync",newName:l.a.RETAKES_FINISHED_TABLE}])}return e=_([Object(o.I)({declarations:[],imports:[c.a],providers:[u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a]}),P("design:paramtypes",[i.a,p.a,s.a,h.a,r.a,m.a,a.a,g.a,y.a,v.a,b.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f}),n.d(t,"b",function(){return p});var o=n(0),r=n(959),i=n(1548),s=n(352),a=n(1549),c=n(33),u=n(35),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=[s.a],p=function(){function e(e,t,n,o){e.registerHandler(t),n.registerHandler(o)}return e=d([Object(o.I)({declarations:[],imports:[r.a],providers:[s.a,i.a,a.a]}),l("design:paramtypes",[u.a,i.a,c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var o=n(0),r=n(960),i=n(1550),s=n(189),a=n(826),c=n(1551),u=n(1552),d=n(353),l=n(33),f=n(35),p=n(36),h=n(155),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=[s.a,d.a],v=function(){function e(e,t,n,o,r,i,s,a){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.registerHandler(a)}return e=m([Object(o.I)({declarations:[],imports:[r.a],providers:[s.a,d.a,i.a,a.a,c.a,u.a]}),g("design:paramtypes",[f.a,i.a,p.a,a.a,l.a,c.a,h.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(159),f=n(189),p=n(353),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e){function t(t,n,o,r,i,s,a,c,u){var d=e.call(this,t,n,o,r,i,s,a)||this;return d.pageProvider=c,d.pageHelper=u,d.name="AddonModPage",d.modName="page",d.component=f.a.COMPONENT,d.updatesNames=/^configuration$|^.*files$/,d}return h(t,e),t.prototype.downloadOrPrefetch=function(t,n,o,r){var i=[];return i.push(e.prototype.downloadOrPrefetch.call(this,t,n,o)),this.pageProvider.isGetPageWSAvailable()&&i.push(this.pageProvider.getPageData(n,t.id)),Promise.all(i)},t.prototype.invalidateContent=function(e,t){return this.pageProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.pageProvider.invalidatePageData(t)),n.push(this.courseProvider.invalidateModule(e.id)),this.utils.allPromises(n)},t=m([Object(o.A)(),g("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return x}),n.d(t,"b",function(){return T});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(74),u=n(92),d=n(190),l=n(251),f=n(164),p=n(1553),h=n(354),m=n(1554),g=n(1555),y=n(1556),v=n(1557),b=n(961),_=n(51),P=n(1558),O=n(1560),w=n(1562),S=n(1564),R=n(1566),E=n(1568),C=n(1570),I=n(1572),A=n(1574),D=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},j=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},x=[c.a,u.a,d.a,l.a,f.a],T=function(){function e(e,t,n,o,r,i,s,a,c,u,l){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),s.registerHandler(u),l.registerSiteTableMigration({name:"mod_quiz_attempts",newName:d.a.ATTEMPTS_TABLE,fields:[{name:"quizAndUser",delete:!0},{name:"finished",type:"boolean"}]})}return e=D([Object(o.I)({declarations:[],imports:[b.a,P.a,O.a,w.a,S.a,R.a,E.a,C.a,I.a,A.a],providers:[c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a]}),j("design:paramtypes",[i.a,p.a,s.a,h.a,r.a,m.a,a.a,g.a,y.a,v.a,_.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.fb=e}return e.prototype.ngOnInit=function(){this.form.addControl("confirmdatasaved",this.fb.control(1))},i([Object(o.D)(),s("design:type",String)],e.prototype,"rule",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"quiz",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"attempt",void 0),i([Object(o.D)(),s("design:type",Boolean)],e.prototype,"prefetch",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"siteId",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),e=i([Object(o.m)({selector:"addon-mod-quiz-access-offline-attempts",template:"<ion-item text-wrap>\n    <p class=\"item-heading\">{{ 'core.settings.synchronization' | translate }}</p>\n    <p>{{ 'addon.mod_quiz.confirmcontinueoffline' | translate:{$a: quiz.syncTimeReadable} }}</p>\n</ion-item>\n"}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.fb=e}return e.prototype.ngOnInit=function(){this.form.addControl("quizpassword",this.fb.control(""))},i([Object(o.D)(),s("design:type",String)],e.prototype,"rule",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"quiz",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"attempt",void 0),i([Object(o.D)(),s("design:type",Boolean)],e.prototype,"prefetch",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"siteId",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),e=i([Object(o.m)({selector:"addon-mod-quiz-access-password",template:'<ion-item text-wrap>\n    <p class="item-heading">{{ \'addon.mod_quiz.quizpassword\' | translate }}</p>\n    <p>{{ \'addon.mod_quiz.requirepasswordmessage\' | translate}}</p>\n</ion-item>\n<ion-item [formGroup]="form">\n    <core-show-password item-content [name]="\'quizpassword\'">\n        <ion-input id="addon-mod_quiz-accessrule-password-input" name="quizpassword" type="password" placeholder="{{ \'addon.mod_quiz.quizpassword\' | translate }}" [formControlName]="\'quizpassword\'"></ion-input>\n    </core-show-password>\n</ion-item>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){}return i([Object(o.D)(),s("design:type",String)],e.prototype,"rule",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"quiz",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"attempt",void 0),i([Object(o.D)(),s("design:type",Boolean)],e.prototype,"prefetch",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"siteId",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),e=i([Object(o.m)({selector:"addon-mod-quiz-access-time-limit",template:"<ion-item text-wrap>\n    <p class=\"item-heading\">{{ 'addon.mod_quiz.confirmstartheader' | translate }}</p>\n    <p>{{ 'addon.mod_quiz.confirmstart' | translate:{$a: quiz.readableTimeLimit} }}</p>\n</ion-item>\n"}),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var o=n(0),r=n(963),i=n(1576),s=n(191),a=n(832),c=n(1577),u=n(1578),d=n(238),l=n(33),f=n(35),p=n(36),h=n(155),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=[s.a],v=function(){function e(e,t,n,o,r,i,s,a){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.registerHandler(a)}return e=m([Object(o.I)({declarations:[],imports:[r.a],providers:[s.a,i.a,d.a,a.a,c.a,u.a]}),g("design:paramtypes",[f.a,i.a,p.a,a.a,l.a,c.a,h.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(159),f=n(191),p=n(238),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e){function t(t,n,o,r,i,s,a,c,u){var d=e.call(this,t,n,o,r,i,s,a)||this;return d.resourceProvider=c,d.resourceHelper=u,d.name="AddonModResource",d.modName="resource",d.component=f.a.COMPONENT,d}return h(t,e),t.prototype.downloadOrPrefetch=function(t,n,o,r){var i=this;return(this.resourceHelper.isDisplayedInIframe(t)?this.filepoolProvider.getPackageDirPathByUrl(this.sitesProvider.getCurrentSiteId(),t.url):Promise.resolve()).then(function(r){var s=[];return s.push(e.prototype.downloadOrPrefetch.call(i,t,n,o,r)),i.resourceProvider.isGetResourceWSAvailable()&&s.push(i.resourceProvider.getResourceData(n,t.id)),Promise.all(s)})},t.prototype.invalidateContent=function(e,t){return this.resourceProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.resourceProvider.invalidateResourceData(t)),n.push(this.courseProvider.invalidateModule(e.id)),Promise.all(n)},t.prototype.isEnabled=function(){return this.resourceProvider.isPluginEnabled()},t=m([Object(o.A)(),g("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return P}),n.d(t,"b",function(){return O});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(138),u=n(418),d=n(192),l=n(1579),f=n(355),p=n(1580),h=n(1581),m=n(1582),g=n(260),y=n(964),v=n(51),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=[c.a,d.a,u.a,g.a],O=function(){function e(e,t,n,o,r,i,s,a,c,u){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),u.registerSiteTablesMigration([{name:"mod_scorm_offline_attempts",newName:d.a.ATTEMPTS_TABLE,fields:[{name:"snapshot",type:"object"},{name:"scormAndUser",delete:!0}]},{name:"mod_scorm_offline_scos_tracks",newName:d.a.TRACKS_TABLE,fields:[{name:"value",type:"object"},{name:"scormUserAttempt",delete:!0},{name:"scormUserAttemptSynced",delete:!0}]}])}return e=b([Object(o.I)({declarations:[],imports:[y.a],providers:[c.a,d.a,u.a,g.a,l.a,f.a,p.a,h.a,m.a]}),_("design:paramtypes",[i.a,l.a,s.a,f.a,r.a,p.a,a.a,h.a,m.a,v.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _}),n.d(t,"b",function(){return P});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(966),u=n(1583),d=n(239),l=n(1584),f=n(356),p=n(1585),h=n(357),m=n(1586),g=n(240),y=n(51),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=[d.a,f.a,h.a,g.a],P=function(){function e(e,t,n,o,r,i,s,a,c){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.register(a),c.registerSiteTableMigration({name:"mma_mod_survey_answers",newName:g.a.SURVEY_TABLE,fields:[{name:"answers",type:"object"}]})}return e=v([Object(o.I)({declarations:[],imports:[c.a],providers:[d.a,f.a,h.a,g.a,u.a,p.a,l.a,m.a]}),b("design:paramtypes",[s.a,u.a,a.a,p.a,i.a,l.a,r.a,m.a,y.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"b",function(){return h});var o=n(0),r=n(967),i=n(1587),s=n(358),a=n(1588),c=n(359),u=n(33),d=n(35),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=[s.a,c.a],h=function(){function e(e,t,n,o){e.registerHandler(t),n.registerHandler(o)}return e=l([Object(o.I)({declarations:[],imports:[r.a],providers:[s.a,c.a,i.a,a.a]}),f("design:paramtypes",[d.a,i.a,u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"b",function(){return w});var o=n(0),r=n(61),i=n(35),s=n(36),a=n(33),c=n(968),u=n(151),d=n(201),l=n(261),f=n(1589),p=n(1590),h=n(1591),m=n(1592),g=n(1593),y=n(1594),v=n(1595),b=n(51),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},O=[u.a,d.a,l.a],w=function(){function e(e,t,n,o,r,i,s,a,c,u,l,f){e.registerHandler(t),n.registerHandler(o),r.register(i),s.registerHandler(a),s.registerHandler(c),s.registerHandler(u),s.registerHandler(l),f.registerSiteTableMigration({name:"mma_mod_wiki_new_pages_store",newName:d.a.NEW_PAGES_TABLE,fields:[{name:"subwikiWikiUserGroup",delete:!0},{name:"caneditpage",type:"boolean"}]})}return e=_([Object(o.I)({declarations:[],imports:[c.a],providers:[u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a]}),P("design:paramtypes",[i.a,f.a,s.a,p.a,r.a,h.a,a.a,m.a,g.a,y.a,v.a,b.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.viewCtrl=t,this.subwikis=e.get("subwikis"),this.currentSubwiki=e.get("currentSubwiki")}return e.prototype.isSubwikiSelected=function(e){var t=parseInt(e.id,10)||0;if(t>0&&this.currentSubwiki.id>0)return t==this.currentSubwiki.id;var n=parseInt(e.userid,10)||0,o=parseInt(e.groupid,10)||0;return n==this.currentSubwiki.userid&&o==this.currentSubwiki.groupid},e.prototype.openSubwiki=function(e){(e.id>0||e.canedit)&&e!=this.currentSubwiki&&this.viewCtrl.dismiss(e)},e=i([Object(o.m)({selector:"addon-mod-wiki-subwiki-picker",template:'<ion-list>\n    <ng-container *ngFor="let group of subwikis">\n        <ion-item-divider *ngIf="group.label" color="light">\n            {{ group.label }}\n        </ion-item-divider>\n        <a ion-item text-wrap *ngFor="let subwiki of group.subwikis;" (click)="openSubwiki(subwiki)" [attr.disabled]="!subwiki.canedit && subwiki.id <= 0 ? true : null" [ngClass]="{\'addon-mod_wiki-subwiki-selected\': isSubwikiSelected(subwiki)}" detail-none>\n            {{ subwiki.name }}\n            <ion-icon *ngIf="isSubwikiSelected(subwiki)" name="checkmark" item-end></ion-icon>\n        </a>\n    </ng-container>\n</ion-list>\n'}),s("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return O}),n.d(t,"b",function(){return w});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(1596),u=n(394),d=n(1607),l=n(106),f=n(1608),p=n(116),h=n(253),m=n(136),g=n(131),y=n(1609),v=n(1610),b=n(51),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},O=[l.a,p.a,h.a,m.a,g.a],w=function(){function e(e,t,n,o,r,i,s,a,c){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),s.register(a),c.registerSiteTablesMigration([{name:"mma_mod_workshop_offline_submissions",newName:p.a.SUBMISSIONS_TABLE,fields:[{name:"attachmentsid",type:"object"}]},{name:"mma_mod_workshop_offline_assessments",newName:p.a.ASSESSMENTS_TABLE,fields:[{name:"inputdata",type:"object"}]},{name:"mma_mod_workshop_offline_evaluate_submissions",newName:p.a.EVALUATE_SUBMISSIONS_TABLE,fields:[{name:"gradeover",type:"object"},{name:"published",type:"boolean"}]},{name:"mma_mod_workshop_offline_evaluate_assessments",newName:p.a.EVALUATE_ASSESSMENTS_TABLE,fields:[{name:"gradinggradeover",type:"object"}]}])}return e=_([Object(o.I)({declarations:[],imports:[u.a,c.a],providers:[l.a,d.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a]}),P("design:paramtypes",[s.a,d.a,i.a,f.a,a.a,y.a,r.a,v.a,b.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(241),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t=s([Object(o.m)({selector:"addon-mod-workshop-assessment-strategy-accumulative",template:'<ion-card *ngFor="let field of assessment.form.fields; let n = index">\n    <ion-item text-wrap>\n        <h2>{{ field.dimtitle }}</h2>\n        <core-format-text [text]="field.description"></core-format-text>\n    </ion-item>\n    <ion-item *ngIf="edit && field.grades">\n        <ion-label [core-mark-required]="true" stacked>{{ \'addon.mod_workshop_assessment_accumulative.dimensiongradefor\' | translate : {\'$a\': field.dimtitle } }}</ion-label>\n        <ion-select [(ngModel)]="selectedValues[n].grade" interface="popover">\n            <ion-option *ngFor="let grade of field.grades" [value]="grade.value">{{grade.label}}</ion-option>\n        </ion-select>\n        <core-input-errors item-content *ngIf="fieldErrors[\'grade_\' + n]" [errorText]="fieldErrors[\'grade_\' + n]"></core-input-errors>\n    </ion-item>\n    <ion-item *ngIf="!edit && field.grades" text-wrap>\n        <h2>{{ \'addon.mod_workshop_assessment_accumulative.dimensiongradefor\' | translate : {\'$a\': field.dimtitle } }}</h2>\n        <ng-container *ngFor="let grade of field.grades">\n            <p *ngIf="grade.value === selectedValues[n].grade">{{grade.label}}</p>\n        </ng-container>\n    </ion-item>\n    <ion-item *ngIf="edit">\n        <ion-label stacked>{{ \'addon.mod_workshop_assessment_accumulative.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</ion-label>\n        <ion-textarea aria-multiline="true" [(ngModel)]="selectedValues[n].peercomment" core-auto-rows></ion-textarea>\n    </ion-item>\n    <ion-item *ngIf="!edit" text-wrap>\n        <h2>{{ \'addon.mod_workshop_assessment_accumulative.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</h2>\n        <p><core-format-text [text]="selectedValues[n].peercomment"></core-format-text></p>\n    </ion-item>\n</ion-card>\n'})],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(241),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t=s([Object(o.m)({selector:"addon-mod-workshop-assessment-strategy-comments",template:'<ion-card *ngFor="let field of assessment.form.fields; let n = index">\n    <ion-item text-wrap>\n        <h2>{{ field.dimtitle }}</h2>\n        <core-format-text [text]="field.description"></core-format-text>\n    </ion-item>\n    <ion-item *ngIf="edit">\n        <ion-label stacked [core-mark-required]="true">{{ \'addon.mod_workshop_assessment_comments.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</ion-label>\n        <ion-textarea aria-multiline="true" [(ngModel)]="selectedValues[n].peercomment" core-auto-rows></ion-textarea>\n        <core-input-errors item-content *ngIf="fieldErrors[\'peercomment_\' + n]" [errorText]="fieldErrors[\'peercomment_\' + n]"></core-input-errors>\n    </ion-item>\n    <ion-item *ngIf="!edit" text-wrap>\n        <h2>{{ \'addon.mod_workshop_assessment_comments.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</h2>\n        <p><core-format-text [text]="selectedValues[n].peercomment"></core-format-text></p>\n    </ion-item>\n</ion-card>\n'})],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(241),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t=s([Object(o.m)({selector:"addon-mod-workshop-assessment-strategy-numerrors",template:'<ion-card *ngFor="let field of assessment.form.fields; let n = index">\n    <ion-item text-wrap>\n        <h2>{{ field.dimtitle }}</h2>\n        <core-format-text [text]="field.description"></core-format-text>\n    </ion-item>\n    <ion-list radio-group [(ngModel)]="selectedValues[n].grade" [name]="\'grade_\' + n">\n        <ion-item>\n            <ion-label stacked [core-mark-required]="edit">{{ \'addon.mod_workshop.yourassessmentfor\' | translate : {\'$a\': field.dimtitle } }}</ion-label>\n            <core-input-errors item-content *ngIf="edit && fieldErrors[\'grade_\' + n]" [errorText]="fieldErrors[\'grade_\' + n]"></core-input-errors>\n        </ion-item>\n        <ion-item>\n            <ion-label><core-format-text [text]="field.grade0"></core-format-text></ion-label>\n            <ion-radio [value]="-1" [disabled]="!edit"></ion-radio>\n        </ion-item>\n        <ion-item>\n            <ion-label><core-format-text [text]="field.grade1"></core-format-text></ion-label>\n            <ion-radio [value]="1" [disabled]="!edit"></ion-radio>\n        </ion-item>\n    </ion-list>\n    <ion-item *ngIf="edit">\n        <ion-label stacked>{{ \'addon.mod_workshop_assessment_numerrors.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</ion-label>\n        <ion-textarea aria-multiline="true" [(ngModel)]="selectedValues[n].peercomment" [name]="\'peercomment_\' + n" core-auto-rows></ion-textarea>\n    </ion-item>\n    <ion-item *ngIf="!edit" text-wrap>\n        <h2>{{ \'addon.mod_workshop_assessment_numerrors.dimensioncommentfor\' | translate : {\'$a\': field.dimtitle } }}</h2>\n        <p><core-format-text [text]="selectedValues[n].peercomment"></core-format-text></p>\n    </ion-item>\n</ion-card>\n'})],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(241),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return i(t,e),t=s([Object(o.m)({selector:"addon-mod-workshop-assessment-strategy-rubric",template:'<ion-card *ngFor="let field of assessment.form.fields; let n = index">\n    <ion-item text-wrap>\n        <h2 [core-mark-required]="edit">{{ field.dimtitle }}</h2>\n        <core-format-text [text]="field.description"></core-format-text>\n        <core-input-errors *ngIf="edit && fieldErrors[\'chosenlevelid_\' + n]" [errorText]="fieldErrors[\'chosenlevelid_\' + n]"></core-input-errors>\n    </ion-item>\n    <ion-list radio-group [(ngModel)]="selectedValues[n].chosenlevelid" [name]="\'chosenlevelid_\' + n">\n        <ion-item *ngFor="let subfield of field.fields">\n            <ion-label><p><core-format-text [text]="subfield.definition"></core-format-text></p></ion-label>\n            <ion-radio [value]="subfield.levelid" [disabled]="!edit"></ion-radio>\n        </ion-item>\n    </ion-list>\n</ion-card>\n'})],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return y}),n.d(t,"b",function(){return v});var o=n(0),r=n(165),i=n(360),s=n(361),a=n(1611),c=n(1612),u=n(1613),d=n(1614),l=n(104),f=n(61),p=n(57),h=n(51),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=[r.a,i.a,s.a],v=function(){function e(e,t,n,o,r,s,a){e.registerHandler(t),n.registerHandler(o),r.register(s),a.registerSiteTableMigration({name:"mma_notes_offline_notes",newName:i.a.NOTES_TABLE})}return e=m([Object(o.I)({declarations:[],imports:[d.a],providers:[r.a,i.a,s.a,a.a,c.a,u.a]}),g("design:paramtypes",[l.a,a.a,p.a,u.a,f.a,c.a,h.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(8),s=n(12),a=n(2),c=n(11),u=n(165),d=n(361),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i){var s=this;this.domUtils=e,this.textUtils=t,this.notesProvider=r,this.notesSync=i,this.type="course",this.refreshIcon="spinner",this.syncIcon="spinner",this.hasOffline=!1,this.notesLoaded=!1,this.syncObserver=o.on(d.a.AUTO_SYNCED,function(e){e.courseId==s.courseId&&(s.showSyncWarnings(e.warnings),s.notesLoaded=!1,s.refreshIcon="spinner",s.syncIcon="spinner",s.content.scrollToTop(),s.fetchNotes(!1))},n.getCurrentSiteId())}return e.prototype.ngOnInit=function(){var e=this;this.fetchNotes(!0).then(function(){e.notesProvider.logView(e.courseId)})},e.prototype.fetchNotes=function(e,t){var n=this;return(e?this.syncNotes(t):Promise.resolve()).catch(function(){}).then(function(){return n.notesProvider.getNotes(n.courseId).then(function(e){return e=e[n.type+"notes"]||[],n.hasOffline=e.some(function(e){return e.offline}),n.notesProvider.getNotesUserData(e,n.courseId).then(function(e){n.notes=e})})}).catch(function(e){n.domUtils.showErrorModal(e)}).finally(function(){n.notesLoaded=!0,n.refreshIcon="refresh",n.syncIcon="sync"})},e.prototype.refreshNotes=function(e,t){var n=this;this.refreshIcon="spinner",this.syncIcon="spinner",this.notesProvider.invalidateNotes(this.courseId).finally(function(){n.fetchNotes(!0,e).finally(function(){t&&t.complete()})})},e.prototype.typeChanged=function(){var e=this;this.notesLoaded=!1,this.refreshIcon="spinner",this.syncIcon="spinner",this.fetchNotes(!0).then(function(){e.notesProvider.logView(e.courseId)})},e.prototype.syncNotes=function(e){var t=this;return this.notesSync.syncNotes(this.courseId).then(function(e){t.showSyncWarnings(e)}).catch(function(n){return e&&t.domUtils.showErrorModalDefault(n,"core.errorsync",!0),Promise.reject(null)})},e.prototype.showSyncWarnings=function(e){var t=this.textUtils.buildMessage(e);t&&this.domUtils.showErrorModal(t)},e.prototype.ngOnDestroy=function(){this.syncObserver&&this.syncObserver.off()},l([Object(o.D)(),f("design:type",Number)],e.prototype,"courseId",void 0),l([Object(o._9)(r.f),f("design:type",r.f)],e.prototype,"content",void 0),e=l([Object(o.m)({selector:"addon-notes-list",template:'<core-navbar-buttons end>\n    <core-context-menu>\n        <core-context-menu-item [hidden]="!(notesLoaded && !hasOffline)" [priority]="100" [content]="\'core.refresh\' | translate" (action)="refreshNotes(false)" [iconAction]="refreshIcon" [closeOnClick]="true"></core-context-menu-item>\n        <core-context-menu-item [hidden]="!(notesLoaded && hasOffline)" [priority]="100" [content]="\'core.settings.synchronizenow\' | translate" (action)="refreshNotes(true)" [iconAction]="syncIcon" [closeOnClick]="false"></core-context-menu-item>\n    </core-context-menu>\n</core-navbar-buttons>\n\n<ion-content>\n    <ion-refresher [enabled]="notesLoaded" (ionRefresh)="refreshNotes(false, $event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n    <core-loading [hideUntil]="notesLoaded" class="core-loading-center">\n\n        <ion-select [(ngModel)]="type" (ngModelChange)="typeChanged()" interface="popover">\n            <ion-option value="site">{{ \'addon.notes.sitenotes\' | translate }}</ion-option>\n            <ion-option value="course">{{ \'addon.notes.coursenotes\' | translate }}</ion-option>\n            <ion-option value="personal">{{ \'addon.notes.personalnotes\' | translate }}</ion-option>\n        </ion-select>\n\n        <div class="core-warning-card" icon-start *ngIf="hasOffline">\n            <ion-icon name="warning"></ion-icon>\n            {{ \'core.thereisdatatosync\' | translate:{$a: \'addon.notes.notes\' | translate | lowercase } }}\n        </div>\n\n        <core-empty-box *ngIf="notes && notes.length == 0" icon="list" [message]="\'addon.notes.nonotes\' | translate"></core-empty-box>\n\n        <ion-list *ngIf="notes && notes.length > 0">\n            <ion-card *ngFor="let note of notes">\n                <ion-item text-wrap>\n                    <ion-avatar item-start>\n                        <img [src]="note.userprofileimageurl || \'assets/img/user-avatar.png\'" core-external-content core-user-link [userId]="note.userid" [courseId]="note.courseid" [alt]="\'core.pictureof\' | translate:{$a: note.userfullname}" role="presentation">\n                    </ion-avatar>\n                    <h2>{{note.userfullname}}</h2>\n                    <p *ngIf="!note.offline" item-end>{{note.lastmodified | coreDateDayOrTime}}</p>\n                    <p *ngIf="note.offline" item-end><ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}</p>\n                </ion-item>\n                <ion-item text-wrap>\n                    <core-format-text [clean]="true" [text]="note.content"></core-format-text>\n                </ion-item>\n            </ion-card>\n        </ion-list>\n    </core-loading>\n</ion-content>\n'}),f("design:paramtypes",[i.a,c.a,a.a,s.a,u.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b}),n.d(t,"b",function(){return _});var o=n(0),r=n(197),i=n(1615),s=n(1616),a=n(1617),c=n(9),u=n(32),d=n(81),l=n(199),f=n(61),p=n(78),h=n(2),m=n(6),g=n(148),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=[r.a],_=function(){function e(e,t,n,o,i,s,a,c,u,d,l,f,p){e.registerHandler(t),n.registerHandler(o),i.register(s);var h=function(e){u.isFeatureDisabled("CoreMainMenuDelegate_AddonNotifications",e.site).then(function(t){t||d.invalidateNotificationsList().finally(function(){f.goInSite(void 0,"AddonNotificationsListPage",void 0,e.site)})})};a.isDesktop()&&l.registerClick(r.a.PUSH_SIMULATION_COMPONENT,h),p.on("click").subscribe(function(e){if(c.isTrueOrOne(e.notif))return h(e),!0})}return e=y([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a,s.a,a.a]}),v("design:paramtypes",[d.a,i.a,l.a,s.a,f.a,a.a,c.a,m.a,h.a,r.a,p.a,u.a,g.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p}),n.d(t,"b",function(){return h});var o=n(0),r=n(4),i=n(252),s=n(148),a=n(12),c=n(7),u=n(78),d=n(51),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=[i.a,s.a],h=function(){function e(e,t,n,o,r,s){var c=r.getInstance("AddonPushNotificationsModule");e.ready().then(function(){t.registerDevice()}),n.on(a.a.NOTIFICATION_SOUND_CHANGED,function(){t.registerDevice()}),n.on(a.a.LOGIN,function(){t.registerDeviceOnMoodle().catch(function(e){c.warn("Can't register device",e)})}),n.on(a.a.SITE_DELETED,function(e){t.unregisterDeviceOnMoodle(e).catch(function(e){c.warn("Can't unregister device",e)}),t.cleanSiteCounters(e.id)}),o.registerClick(i.a.COMPONENT,t.notificationClicked),s.registerAppTableMigration({name:"mma_pushnotifications_badge",newName:i.a.BADGE_TABLE,fields:[{name:"siteid",newName:"siteId"}]}),s.registerLocalNotifComponentMigration("mmaPushNotifications",i.a.COMPONENT)}return e=l([Object(o.I)({declarations:[],imports:[],providers:[i.a,s.a]}),f("design:paramtypes",[r.s,i.a,a.a,u.a,c.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l}),n.d(t,"b",function(){return f});var o=n(0),r=n(1618),i=n(12),s=n(79),a=n(7),c=n(2),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=[r.a],f=function(){function e(e,t,n,o,r){var a=r.getInstance("AddonRemoteThemesModule");e.registerProcess({name:"AddonRemoteThemesPreloadCurrent",priority:s.a.MAX_RECOMMENDED_PRIORITY+250,blocking:!0,load:t.preloadCurrentSite.bind(t)}),e.registerProcess({name:"AddonRemoteThemesPreload",blocking:!0,load:t.preloadSites.bind(t)});var c;n.on(i.a.SITE_ADDED,function(e){c=e.siteId,t.addSite(e.siteId).catch(function(e){a.error("Error adding site",e)}).then(function(){c==e.siteId&&(c=!1),e.siteId==o.getCurrentSiteId()&&(t.unloadTmpStyles(),t.enable(e.siteId))})}),n.on(i.a.SITE_UPDATED,function(e){e.siteId===o.getCurrentSiteId()&&t.load(e.siteId).catch(function(e){a.error("Error loading site after site update",e)})}),n.on(i.a.LOGIN,function(e){t.unloadTmpStyles(),t.enable(e.siteId)}),n.on(i.a.LOGOUT,function(e){t.clear()}),n.on(i.a.SITE_DELETED,function(e){t.removeSite(e.id)}),n.on(i.a.LOGIN_SITE_CHECKED,function(e){t.loadTmpStyles(e.config.mobilecssurl)}),n.on(i.a.LOGIN_SITE_UNCHECKED,function(e){e.siteId&&e.siteId===c||t.unloadTmpStyles()})}return e=u([Object(o.I)({declarations:[],imports:[],providers:[r.a]}),d("design:paramtypes",[s.a,r.a,i.a,c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.name="AddonModDataDefaultFieldHandler",this.type="default"}return e.prototype.getFieldSearchData=function(e,t){return!1},e.prototype.getFieldEditData=function(e,t,n){return!1},e.prototype.hasFieldDataChanged=function(e,t,n){return!1},e.prototype.getFieldEditFiles=function(e,t,n){return[]},e.prototype.getFieldsNotifications=function(e,t){return!1},e.prototype.overrideData=function(e,t,n){return e},e.prototype.isEnabled=function(){return!0},e=r([Object(o.A)()],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(50),i=n(147),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){return e.call(this,t)||this}return s(t,e),t.prototype.ngOnInit=function(){this.jsData={workshopId:this.workshopId,assessment:this.assessment,edit:this.edit,selectedValues:this.selectedValues,fieldErrors:this.fieldErrors,strategy:this.strategy},this.getHandlerData("workshopform_"+this.strategy)},a([Object(o.D)(),c("design:type",Number)],t.prototype,"workshopId",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"assessment",void 0),a([Object(o.D)(),c("design:type",Boolean)],t.prototype,"edit",void 0),a([Object(o.D)(),c("design:type",Array)],t.prototype,"selectedValues",void 0),a([Object(o.D)(),c("design:type",Object)],t.prototype,"fieldErrors",void 0),a([Object(o.D)(),c("design:type",String)],t.prototype,"strategy",void 0),t=a([Object(o.m)({selector:"core-siteplugins-workshop-assessment-strategy",template:'<core-compile-html [text]="content" [jsData]="jsData" (created)="componentCreated($event)"></core-compile-html>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=t,this.logger=e.getInstance("AddonMandatoryProvider")}return e.prototype.isMandatoryDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_AddonMandatory")},e.prototype.isDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isMandatoryDisabledInSite(e)})},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sitesProvider=t,this.logger=e.getInstance("AddonResourceProvider")}return e.prototype.isResourceDisabledInSite=function(e){return(e=e||this.sitesProvider.getCurrentSite()).isFeatureDisabled("CoreMainMenuDelegate_AddonResource")},e.prototype.isDisabled=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){return t.isResourceDisabledInSite(e)})},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(20),i=n(6),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.fb=e,this.utils=t,this.edit=!1,this.disabled=!1}return e.prototype.ngOnInit=function(){var e=this.field;if(e&&this.edit&&this.form){e.modelName="profile_field_"+e.shortname;var t={value:this.utils.isTrueOrOne(e.defaultdata),disabled:this.disabled};this.form.addControl(e.modelName,this.fb.control(t,e.required&&!e.locked?r.h.requiredTrue:null))}},s([Object(o.D)(),a("design:type",Object)],e.prototype,"field",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"edit",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"disabled",void 0),s([Object(o.D)(),a("design:type",r.c)],e.prototype,"form",void 0),e=s([Object(o.m)({selector:"addon-user-profile-field-checkbox",template:'\x3c!-- Render (no edit). --\x3e\n<ion-item *ngIf="!edit && field && field.name">\n    <h2>{{ field.name }}</h2>\n    <p *ngIf="field.value != \'0\'">\n        {{ \'core.yes\' | translate }}\n    </p>\n    <p *ngIf="field.value == \'0\'">\n        {{ \'core.no\' | translate }}\n    </p>\n</ion-item>\n\x3c!-- Edit. --\x3e\n<ion-item *ngIf="edit && field && field.shortname" [formGroup]="form">\n    <ion-label>\n        <span [core-mark-required]="field.required">{{ field.name }}</span>\n        <core-input-errors [control]="form.controls[field.modelName]"></core-input-errors>\n    </ion-label>\n    <ion-checkbox item-end [formControlName]="field.modelName">\n    </ion-checkbox>\n</ion-item>'}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(22),s=n(6),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.fb=e,this.timeUtils=t,this.utils=n,this.edit=!1,this.disabled=!1}return e.prototype.ngOnInit=function(){var e,t=this.field;if(t&&this.edit&&this.form){t.modelName="profile_field_"+t.shortname;var n=this.utils.isTrueOrOne(t.param3);t.format=this.timeUtils.getLocalizedDateFormat(n?"LLL":"LL"),t.param1&&(e=parseInt(t.param1,10))&&(t.min=e),t.param2&&(e=parseInt(t.param2,10))&&(t.max=e);this.form.addControl(t.modelName,this.fb.control({value:t.defaultdata,disabled:this.disabled},t.required&&!t.locked?r.h.required:null))}},a([Object(o.D)(),c("design:type",Object)],e.prototype,"field",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"edit",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"disabled",void 0),a([Object(o.D)(),c("design:type",r.c)],e.prototype,"form",void 0),e=a([Object(o.m)({selector:"addon-user-profile-field-datetime",template:'\x3c!-- Render (no edit). --\x3e\n<ion-item *ngIf="!edit && field && field.name">\n    <h2>{{ field.name }}</h2>\n    <p>{{ field.value * 1000 | coreFormatDate:"dfmediumdate"}}</p>\n</ion-item>\n\x3c!-- Edit. --\x3e\n<ion-item *ngIf="edit && field && field.shortname" text-wrap [formGroup]="form">\n    <ion-label stacked [core-mark-required]="field.required">{{ field.name }}</ion-label>\n    <ion-datetime [formControlName]="field.modelName" [placeholder]="\'core.choosedots\' | translate" [displayFormat]="field.format" [max]="field.max" [min]="field.min"></ion-datetime>\n    <core-input-errors item-content [control]="form.controls[field.modelName]"></core-input-errors>\n</ion-item>'}),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.fb=e,this.edit=!1,this.disabled=!1}return e.prototype.ngOnInit=function(){var e=this.field;if(e&&this.edit&&this.form){e.modelName="profile_field_"+e.shortname,e.options=e.param1?e.param1.split(/\r\n|\r|\n/g):[];this.form.addControl(e.modelName,this.fb.control({value:e.defaultdata,disabled:this.disabled},e.required&&!e.locked?r.h.required:null))}},i([Object(o.D)(),s("design:type",Object)],e.prototype,"field",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"edit",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"disabled",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),e=i([Object(o.m)({selector:"addon-user-profile-field-menu",template:'\x3c!-- Render (no edit). --\x3e\n<ion-item *ngIf="!edit && field && field.name">\n    <h2>{{ field.name }}</h2>\n    <p><core-format-text [text]="field.value"></core-format-text></p>\n</ion-item>\n\x3c!-- Edit. --\x3e\n<ion-item *ngIf="edit && field && field.shortname" text-wrap [formGroup]="form">\n    <ion-label stacked [core-mark-required]="field.required">{{ field.name }}</ion-label>\n    <ion-select [formControlName]="field.modelName" [placeholder]="\'core.choosedots\' | translate" interface="popover">\n        <ion-option value="">{{ \'core.choosedots\' | translate }}</ion-option>\n        <ion-option *ngFor="let option of field.options" [value]="option">{{option}}</ion-option>\n    </ion-select>\n    <core-input-errors item-content [control]="form.controls[field.modelName]"></core-input-errors>\n</ion-item>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(20),i=n(6),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.fb=e,this.utils=t,this.edit=!1,this.disabled=!1}return e.prototype.ngOnInit=function(){var e=this.field;if(e&&this.edit&&this.form){e.modelName="profile_field_"+e.shortname,e.param2&&(e.maxlength=parseInt(e.param2,10)||""),e.inputType=this.utils.isTrueOrOne(e.param3)?"password":"text";this.form.addControl(e.modelName,this.fb.control({value:e.defaultdata,disabled:this.disabled},e.required&&!e.locked?r.h.required:null))}},s([Object(o.D)(),a("design:type",Object)],e.prototype,"field",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"edit",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"disabled",void 0),s([Object(o.D)(),a("design:type",r.c)],e.prototype,"form",void 0),e=s([Object(o.m)({selector:"addon-user-profile-field-text",template:'\x3c!-- Render (no edit). --\x3e\n<ion-item *ngIf="!edit && field && field.name">\n    <h2>{{ field.name }}</h2>\n    <p><core-format-text [text]="field.value"></core-format-text></p>\n</ion-item>\n\x3c!-- Edit. --\x3e\n<ion-item *ngIf="edit && field && field.shortname" text-wrap [formGroup]="form">\n    <ion-label stacked [core-mark-required]="field.required">{{ field.name }}</ion-label>\n    <ion-input [type]="field.inputType" [formControlName]="field.modelName" [placeholder]="field.name" maxlength="{{field.maxlength}}"></ion-input>\n    <core-input-errors item-content [control]="form.controls[field.modelName]"></core-input-errors>\n</ion-item>\n'}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(20),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.edit=!1,this.disabled=!1}return e.prototype.ngOnInit=function(){var e=this.field;if(e&&this.edit&&this.form){e.modelName="profile_field_"+e.shortname;this.control=new r.b({value:e.defaultdata,disabled:this.disabled},e.required&&!e.locked?r.h.required:null),this.form.addControl(e.modelName,this.control)}},i([Object(o.D)(),s("design:type",Object)],e.prototype,"field",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"edit",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"disabled",void 0),i([Object(o.D)(),s("design:type",r.c)],e.prototype,"form",void 0),e=i([Object(o.m)({selector:"addon-user-profile-field-textarea",template:'\x3c!-- Render (no edit). --\x3e\n<ion-item *ngIf="!edit && field && field.name">\n    <h2>{{ field.name }}</h2>\n    <p><core-format-text [text]="field.value"></core-format-text></p>\n</ion-item>\n\x3c!-- Edit. --\x3e\n<ion-item *ngIf="edit && field && field.shortname" text-wrap [formGroup]="form">\n    <ion-label stacked>\n        <span [core-mark-required]="field.required">{{ field.name }}</span>\n        <core-input-errors [control]="control"></core-input-errors>\n    </ion-label>\n    <core-rich-text-editor item-content [control]="control" [placeholder]="field.name"></core-rich-text-editor>\n</ion-item>'}),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n.options=[],n}return s(t,e),t.prototype.init=function(){var e=this;if(this.isShowOrListMode())this.updateValue(this.value);else{this.options=this.field.param1.split("\n").map(function(e){return{key:e,value:e}});var t=[];"edit"==this.mode&&this.value&&this.value.content&&this.value.content.split("##").forEach(function(n){e.options.findIndex(function(e){return n==e.key})>=0&&t.push(n)}),"search"==this.mode&&this.addControl("f_"+this.field.id+"_allreq"),this.addControl("f_"+this.field.id,t)}},t.prototype.updateValue=function(e){this.value=e,this.value.content=e&&e.content&&e.content.split("##").join("<br>")},t=a([Object(o.m)({selector:"addon-mod-data-field-checkbox",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-select [formControlName]="\'f_\'+field.id" multiple="true" [placeholder]="\'addon.mod_data.menuchoose\' | translate" [selectOptions]="{title: field.name}" interface="popover">\n        <ion-option *ngFor="let option of options" [value]="option.value">{{option.key}}</ion-option>\n    </ion-select>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n\n    <ion-item *ngIf="mode == \'search\'">\n        <ion-label>{{ \'addon.mod_data.selectedrequired\' | translate }}</ion-label>\n        <ion-checkbox item-end [formControlName]="\'f_\'+field.id+\'_allreq\'" [(ngModel)]="search[\'f_\'+field.id+\'_allreq\']">\n        </ion-checkbox>\n    </ion-item>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(20),i=n(22),s=n(85),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t)||this;return o.fb=t,o.timeUtils=n,o}return a(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){var e;this.format=this.timeUtils.getLocalizedDateFormat("LL"),"search"==this.mode?(this.addControl("f_"+this.field.id+"_z"),e=this.search["f_"+this.field.id+"_y"]?new Date(this.search["f_"+this.field.id+"_y"]+"-"+this.search["f_"+this.field.id+"_m"]+"-"+this.search["f_"+this.field.id+"_d"]):new Date,this.search["f_"+this.field.id]=e.toISOString()):e=(e=this.value&&this.value.content?new Date(1e3*parseInt(this.value.content,10)):new Date).toISOString(),this.addControl("f_"+this.field.id,e)}},t=c([Object(o.m)({selector:"addon-mod-data-field-date",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-datetime [formControlName]="\'f_\'+field.id" [placeholder]="\'core.date\' | translate" [disabled]="mode == \'search\' && !search[\'f_\'+field.id+\'_z\']" [displayFormat]="format"></ion-datetime>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n\n    <ion-item *ngIf="mode == \'search\'">\n        <ion-label>{{ \'addon.mod_data.usedate\' | translate }}</ion-label>\n        <ion-checkbox item-end [formControlName]="\'f_\'+field.id+\'_z\'" [(ngModel)]="search[\'f_\'+field.id+\'_z\']">\n        </ion-checkbox>\n    </ion-item>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content * 1000 | coreFormatDate:\'LL\'"></core-format-text>\n\n'}),u("design:paramtypes",[r.a,i.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(20),i=n(85),s=n(121),a=n(59),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n){var o=e.call(this,t)||this;return o.fb=t,o.fileSessionprovider=n,o.files=[],o}return c(t,e),t.prototype.getFiles=function(e){var t=e&&e.files||[];return t.length>0&&(t=[t[0]]),t},t.prototype.init=function(){"search"!=this.mode?(this.component=a.a.COMPONENT,this.componentId=this.database.coursemodule,this.updateValue(this.value),"edit"==this.mode&&(this.maxSizeBytes=parseInt(this.field.param3,10),this.fileSessionprovider.setFiles(this.component,this.database.id+"_"+this.field.id,this.files))):this.addControl("f_"+this.field.id)},t.prototype.updateValue=function(e){this.value=e,this.files=this.getFiles(e)},t=u([Object(o.m)({selector:"addon-mod-data-field-file",template:'<span *ngIf="mode == \'edit\'">\n    <span [core-mark-required]="field.required" class="core-mark-required"></span>\n    <core-attachments [files]="files" [maxSize]="maxSizeBytes" maxSubmissions="1" [component]="component" [componentId]="componentId" [allowOffline]="true"></core-attachments>\n    <core-input-errors *ngIf="error" [errorText]="error"></core-input-errors>\n</span>\n\n<span *ngIf="mode == \'search\'" [formGroup]="form">\n    <ion-input type="text" [formControlName]="\'f_\'+field.id" [placeholder]="field.name"></ion-input>\n</span>\n\n<ng-container *ngIf="isShowOrListMode()">\n    <div *ngFor="let file of files" no-lines>\n        \x3c!-- Files already attached to the submission. --\x3e\n        <core-file *ngIf="!file.name" [file]="file" [component]="component" [componentId]="componentId" [alwaysDownload]="true"></core-file>\n\n        \x3c!-- Files stored in offline to be sent later. --\x3e\n        <core-local-file *ngIf="file.name" [file]="file"></core-local-file>\n    </div>\n</ng-container>\n'}),d("design:paramtypes",[r.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(20),i=n(4),s=n(85),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t)||this;return o.fb=t,o.platform=n,o}return a(t,e),t.prototype.formatLatLong=function(e,t){if(null!==e||null!==t){var n=e?Math.abs(e).toFixed(4):"0.0000",o=t?Math.abs(t).toFixed(4):"0.0000";return n+(e<0?"°S":"°N")+" "+o+(t<0?"°W":"°E")}},t.prototype.getLatLongLink=function(e,t){if(null!==e||null!==t){var n=e?e.toFixed(4):"0.0000",o=t?t.toFixed(4):"0.0000";return this.platform.is("ios")?"http://maps.apple.com/?ll="+n+","+o+"&near="+n+","+o:"geo:"+n+","+o}},t.prototype.init=function(){this.value&&this.updateValue(this.value),"edit"==this.mode?(this.addControl("f_"+this.field.id+"_0",this.north),this.addControl("f_"+this.field.id+"_1",this.east)):"search"==this.mode&&this.addControl("f_"+this.field.id)},t.prototype.updateValue=function(e){this.value=e,this.north=e&&parseFloat(e.content)||null,this.east=e&&parseFloat(e.content1)||null},t=c([Object(o.m)({selector:"addon-mod-data-field-latlong",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <ion-input *ngIf="mode == \'search\'" type="text" [placeholder]="field.name" [formControlName]="\'f_\'+field.id"></ion-input>\n\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <div *ngIf="mode == \'edit\'" class="addon-data-lantlong">\n        <ion-input type="text" [formControlName]="\'f_\'+field.id+\'_0\'" maxlength="10"></ion-input>\n        <span class="placeholder-icon" item-right>°N</span>\n    </div>\n    <div *ngIf="mode == \'edit\'" class="addon-data-lantlong">\n        <ion-input type="text" [formControlName]="\'f_\'+field.id+\'_1\'" maxlength="10"></ion-input>\n        <span class="placeholder-icon" item-right>°E</span>\n    </div>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n\n<span *ngIf="isShowOrListMode() && value">\n    <a [href]="getLatLongLink(north, east)">{{ formatLatLong(north, east) }}</a>\n</span>'}),u("design:paramtypes",[r.a,i.s])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n.options=[],n}return s(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){this.options=this.field.param1.split("\n");var e;"edit"==this.mode&&this.value&&(e=this.value.content),this.addControl("f_"+this.field.id,e)}},t=a([Object(o.m)({selector:"addon-mod-data-field-menu",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-select [formControlName]="\'f_\'+field.id" [placeholder]="\'addon.mod_data.menuchoose\' | translate" [selectOptions]="{title: field.name}" interface="popover">\n        <ion-option value="">{{ \'addon.mod_data.menuchoose\' | translate }}</ion-option>\n        <ion-option *ngFor="let option of options" [value]="option">{{option}}</ion-option>\n    </ion-select>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n.options=[],n}return s(t,e),t.prototype.init=function(){var e=this;if(this.isShowOrListMode())this.updateValue(this.value);else{this.options=this.field.param1.split("\n").map(function(e){return{key:e,value:e}});var t=[];"edit"==this.mode&&this.value&&this.value.content&&this.value.content.split("##").forEach(function(n){e.options.findIndex(function(e){return n==e.key})>=0&&t.push(n)}),"search"==this.mode&&this.addControl("f_"+this.field.id+"_allreq"),this.addControl("f_"+this.field.id,t)}},t.prototype.updateValue=function(e){this.value=e,this.value.content=e&&e.content&&e.content.split("##").join("<br>")},t=a([Object(o.m)({selector:"addon-mod-data-field-multimenu",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-select [formControlName]="\'f_\'+field.id" multiple="true" [placeholder]="\'addon.mod_data.menuchoose\' | translate" [selectOptions]="{title: field.name}" interface="popover">\n        <ion-option *ngFor="let option of options" [value]="option.value">{{option.key}}</ion-option>\n    </ion-select>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n\n\n    <ion-item *ngIf="mode == \'search\'">\n        <ion-label>{{ \'addon.mod_data.selectedrequired\' | translate }}</ion-label>\n        <ion-checkbox item-end [formControlName]="\'f_\'+field.id+\'_allreq\'" [(ngModel)]="search[\'f_\'+field.id+\'_allreq\']">\n        </ion-checkbox>\n    </ion-item>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n}return s(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){var e;"edit"==this.mode&&this.value&&(e=this.value.content),this.addControl("f_"+this.field.id,e)}},t=a([Object(o.m)({selector:"addon-mod-data-field-text",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-input type="text" [formControlName]="\'f_\'+field.id" [placeholder]="field.name"></ion-input>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n}return s(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){var e;if("edit"==this.mode&&this.value){var t=parseFloat(this.value.content);e=isNaN(t)?"":t}this.addControl("f_"+this.field.id,e)}},t=a([Object(o.m)({selector:"addon-mod-data-field-number",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-input type="number" [formControlName]="\'f_\'+field.id" [placeholder]="field.name"></ion-input>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>\n'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(20),i=n(121),s=n(8),a=n(85),c=n(59),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.fb=t,r.fileSessionprovider=n,r.domUtils=o,r.files=[],r}return u(t,e),t.prototype.getFiles=function(e){var t=e&&e.files||[];return t.length>0&&(t=[t[0]]),t},t.prototype.findFile=function(e,t){return e.find(function(e){return e.filename==t})||!1},t.prototype.init=function(){if("search"!=this.mode){if(this.component=c.a.COMPONENT,this.componentId=this.database.coursemodule,this.updateValue(this.value),"edit"==this.mode){this.maxSizeBytes=parseInt(this.field.param3,10),this.fileSessionprovider.setFiles(this.component,this.database.id+"_"+this.field.id,this.files);this.addControl("f_"+this.field.id+"_alttext",this.value&&this.value.content1||"")}}else this.addControl("f_"+this.field.id)},t.prototype.updateValue=function(e){this.value=e;var t=e&&e.files||[];if(t.length>0){this.image=this.findFile(t,"list"==this.mode?"thumb_"+e.content:e.content),this.image||"list"!=this.mode||(this.image=this.findFile(t,e.content)),this.files=[this.image]}else this.image=!1,this.files=[];"edit"!=this.mode&&(this.entryId=e&&e.recordid||null,this.title=e&&e.content1||"",this.imageUrl=null,this.image&&(this.imageUrl=this.image.offline?this.image&&this.image.toURL()||null:this.image&&this.image.fileurl||null),this.width=this.domUtils.formatPixelsSize(this.field.param1),this.height=this.domUtils.formatPixelsSize(this.field.param2))},t=d([Object(o.m)({selector:"addon-mod-data-field-picture",template:'<span *ngIf="mode == \'edit\'" [formGroup]="form">\n    <span [core-mark-required]="field.required" class="core-mark-required"></span>\n    <core-attachments [files]="files" [maxSize]="maxSizeBytes" maxSubmissions="1" [component]="component" [componentId]="componentId" [allowOffline]="true" acceptedTypes="image"></core-attachments>\n    <core-input-errors *ngIf="error" [errorText]="error"></core-input-errors>\n\n    <ion-label stacked>{{ \'addon.mod_data.alttext\' | translate }}</ion-label>\n    <ion-input type="text" [formControlName]="\'f_\'+field.id+\'_alttext\'" [placeholder]=" \'addon.mod_data.alttext\' | translate" ></ion-input>\n</span>\n\n<span *ngIf="mode == \'search\'" [formGroup]="form">\n    <ion-input type="text" [formControlName]="\'f_\'+field.id" [placeholder]="field.name"></ion-input>\n</span>\n\n<span *ngIf="mode == \'list\' && imageUrl" (click)="gotoEntry.emit(entryId)"><img [src]="imageUrl" [alt]="title" [title]="title" class="core-media-adapt-width list_picture" core-external-content/></span>\n\n<img *ngIf="mode == \'show\' && imageUrl" [src]="imageUrl" [alt]="title" [title]="title" class="core-media-adapt-width list_picture" [attr.width]="width" [attr.height]="height" core-external-content/>\n'}),l("design:paramtypes",[r.a,i.a,s.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n.options=[],n}return s(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){this.options=this.field.param1.split("\n");var e;"edit"==this.mode&&this.value&&(e=this.value.content),this.addControl("f_"+this.field.id,e)}},t=a([Object(o.m)({selector:"addon-mod-data-field-radiobutton",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-select [formControlName]="\'f_\'+field.id" [placeholder]="\'addon.mod_data.menuchoose\' | translate" [selectOptions]="{title: field.name}" interface="popover">\n        <ion-option value="">{{ \'addon.mod_data.menuchoose\' | translate }}</ion-option>\n        <ion-option *ngFor="let option of options" [value]="option">{{option}}</ion-option>\n    </ion-select>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value && value.content" [text]="value.content"></core-format-text>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(20),i=n(11),s=n(59),a=n(85),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n){var o=e.call(this,t)||this;return o.fb=t,o.textUtils=n,o}return c(t,e),t.prototype.format=function(e){return e?this.textUtils.replacePluginfileUrls(e.content,e&&e.files||[]):""},t.prototype.init=function(){if(this.isShowOrListMode())return this.component=s.a.COMPONENT,void(this.componentId=this.database.coursemodule);var e;if("edit"==this.mode){e=this.value?this.textUtils.replacePluginfileUrls(this.value.content,this.value&&this.value.files||[]):""}this.addControl("f_"+this.field.id,e)},t=u([Object(o.m)({selector:"addon-mod-data-field-textarea",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <ion-input *ngIf="mode == \'search\'" type="text" [placeholder]="field.name" [formControlName]="\'f_\'+field.id"></ion-input>\n\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <core-rich-text-editor *ngIf="mode == \'edit\'" item-content [control]="form.controls[\'f_\'+field.id]" [placeholder]="field.name" [formControlName]="\'f_\'+field.id" [component]="component" [componentId]="componentId"></core-rich-text-editor>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<core-format-text *ngIf="isShowOrListMode() && value" [text]="format(value)" [component]="component" [componentId]="componentId"></core-format-text>'}),d("design:paramtypes",[r.a,i.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(20),i=n(85),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t)||this;return n.fb=t,n}return s(t,e),t.prototype.init=function(){if(!this.isShowOrListMode()){var e;"edit"==this.mode&&this.value&&(e=this.value.content),this.addControl("f_"+this.field.id,e)}},t=a([Object(o.m)({selector:"addon-mod-data-field-url",template:'<span *ngIf="!isShowOrListMode()" [formGroup]="form">\n    <span *ngIf="mode == \'edit\'" [core-mark-required]="field.required" class="core-mark-required"></span>\n    <ion-input type="url" [formControlName]="\'f_\'+field.id" [placeholder]="field.name"></ion-input>\n    <core-input-errors *ngIf="error && mode == \'edit\'" [control]="form.controls[\'f_\'+field.id]" [errorText]="error"></core-input-errors>\n</span>\n\n<a *ngIf="isShowOrListMode() && value && value.content" [href]="value.content" core-link capture="true">{{field.name}}</a>'}),c("design:paramtypes",[r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(65),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.questionDelegate=e,this.questionProvider=t,this.name="AddonQbehaviourDeferredFeedback",this.type="deferredfeedback"}return e.prototype.determineNewState=function(e,t,n,o){return this.determineNewStateDeferred(e,t,n,o)},e.prototype.determineNewStateDeferred=function(e,t,n,o,r,i){var s=this;return this.questionProvider.getQuestion(e,t,n.slot,o).catch(function(){return n}).then(function(a){var c=s.questionProvider.getState(a.state);return c.finished||!c.active?c:s.questionProvider.getQuestionAnswers(e,t,n.slot,!1,o).then(function(e){var t=s.questionProvider.getBasicAnswers(n.answers);e=s.questionProvider.convertAnswersArrayToObject(e,!0);var o=s.questionProvider.getBasicAnswers(e);if(i){if(i(n,e,o,n.answers,t))return c}else if(s.questionDelegate.isSameResponse(n,o,t))return c;var a,u;if((a=r?r(n,n.answers):s.questionDelegate.isCompleteResponse(n,t))<0)u="unknown";else if(a>0)u="complete";else{var d=s.questionDelegate.isGradableResponse(n,t);u=d<0?"unknown":d>0?"invalid":"todo"}return s.questionProvider.getState(u)})})},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return r([Object(o.D)(),i("design:type",Object)],e.prototype,"question",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"component",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"componentId",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"attemptId",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"offlineEnabled",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"buttonClicked",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"onAbort",void 0),e=r([Object(o.m)({selector:"addon-qbehaviour-informationitem",template:'<input *ngIf="question.behaviourSeenInput" type="hidden" name="{{question.behaviourSeenInput.name}}" value="{{question.behaviourSeenInput.value}}" >\n'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(6),i=n(911),s=n(385),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.utils=e,this.numericalHandler=t,this.name="AddonQtypeCalculated",this.type="qtype_calculated"}return e.prototype.getComponent=function(e,t){return s.a},e.prototype.isCompleteResponse=function(e,t){return 0!==this.isGradableResponse(e,t)&&this.numericalHandler.validateUnits(t.answer)?this.requiresUnits(e)?this.isValidValue(t.unit)?1:0:-1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){var n=this.isValidValue(t.answer);return n&&this.requiresUnits(e)&&(n=this.isValidValue(t.unit)),n?1:0},e.prototype.isSameResponse=function(e,t,n){return this.utils.sameAtKeyMissingIsBlank(t,n,"answer")&&this.utils.sameAtKeyMissingIsBlank(t,n,"unit")},e.prototype.isValidValue=function(e){return!!e||"0"===e||0===e},e.prototype.requiresUnits=function(e){var t=document.createElement("div");return t.innerHTML=e.html,!(!t.querySelector("select[name*=unit]")&&!t.querySelector('input[type="radio"]'))},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(6),i=n(384),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.utils=e,this.name="AddonQtypeNumerical",this.type="qtype_numerical"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return 0!==this.isGradableResponse(e,t)&&this.validateUnits(t.answer)?-1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return t.answer||"0"===t.answer||0===t.answer?1:0},e.prototype.isSameResponse=function(e,t,n){return this.utils.sameAtKeyMissingIsBlank(t,n,"answer")},e.prototype.validateUnits=function(e){if(!e)return!1;var t="[+-]?(?:\\d+(?:\\.\\d*)?|\\.\\d+)(?:e[-+]?\\d+)?";return e=e.replace(" ",""),e=e.replace(/(?:e|E|(?:x|\*|×)10(?:\^|\*\*))([+-]?\d+)/,"e$1"),null!==(e=-1!=e.indexOf(".")||e.split(",").length-1>1?e.replace(",",""):e.replace(",",".")).match(new RegExp("^"+t))&&null!==e.match(new RegExp(t+"$"))},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(6),i=n(247),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.utils=e,this.name="AddonQtypeMultichoice",this.type="qtype_multichoice"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){var n=!0,o=!1;for(var r in t)-1!=r.indexOf("choice")&&(n=!1,t[r]&&(o=!0));return n?this.isCompleteResponseSingle(t):o?1:0},e.prototype.isCompleteResponseSingle=function(e){return e.answer&&""!==e.answer?1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.isCompleteResponse(e,t)},e.prototype.isGradableResponseSingle=function(e){return this.isCompleteResponseSingle(e)},e.prototype.isSameResponse=function(e,t,n){var o=!0,r=!0;for(var i in n)-1!=i.indexOf("choice")&&(o=!1,this.utils.sameAtKeyMissingIsBlank(t,n,i)||(r=!1));return o?this.isSameResponseSingle(t,n):r},e.prototype.isSameResponseSingle=function(e,t){return this.utils.sameAtKeyMissingIsBlank(e,t,"answer")},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(91),s=n(1745),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeDdImageOrTextComponent",n)||this;return r.loggerProvider=t,r.destroyed=!1,r.element=o.nativeElement,r}return a(t,e),t.prototype.ngOnInit=function(){if(!this.question)return this.logger.warn("Aborting because of no question received."),this.questionHelper.showComponentError(this.onAbort);var e=document.createElement("div");e.innerHTML=this.question.html;var t=e.querySelector(".ddarea");if(this.question.text=this.domUtils.getContentsOfElement(e,".qtext"),!t||void 0===this.question.text)return this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.question.ddArea=t.outerHTML,this.question.readOnly=!1,this.question.initObjects&&(void 0!==this.question.initObjects.drops&&(this.drops=this.question.initObjects.drops),void 0!==this.question.initObjects.readonly&&(this.question.readOnly=this.question.initObjects.readonly)),this.question.loaded=!1},t.prototype.questionRendered=function(){this.destroyed||(this.questionInstance=new s.a(this.loggerProvider,this.domUtils,this.element,this.question,this.question.readOnly,this.drops))},t.prototype.ngOnDestroy=function(){this.destroyed=!0,this.questionInstance&&this.questionInstance.destroy()},t=c([Object(o.m)({selector:"addon-qtype-ddimageortext",template:'<section ion-list *ngIf="question.text || question.text === \'\'" class="addon-qtype-ddimageortext-container">\n    \x3c!-- Content is outside the core-loading to let the script calculate drag items position --\x3e\n    <core-loading [hideUntil]="question.loaded"></core-loading>\n\n    <ion-item text-wrap [ngClass]="{invisible: !question.loaded}">\n        <p *ngIf="!question.readOnly" class="core-info-card" icon-start>\n            <ion-icon name="information-circle"></ion-icon>\n            {{ \'core.question.howtodraganddrop\' | translate }}\n        </p>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n        <core-format-text *ngIf="question.ddArea" [adaptImg]="false" [component]="component" [componentId]="componentId" [text]="question.ddArea" (afterRender)="questionRendered()"></core-format-text>\n    </ion-item>\n</section>\n'}),u("design:paramtypes",[r.a,o.C,o.t])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(91),s=n(1748),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeDdMarkerComponent",n)||this;return r.loggerProvider=t,r.destroyed=!1,r.element=o.nativeElement,r}return a(t,e),t.prototype.ngOnInit=function(){if(!this.question)return this.logger.warn("Aborting because of no question received."),this.questionHelper.showComponentError(this.onAbort);var e=document.createElement("div");e.innerHTML=this.question.html;var t=e.querySelector(".ddarea"),n=e.querySelector(".ddform");if(this.question.text=this.domUtils.getContentsOfElement(e,".qtext"),!t||!n||void 0===this.question.text)return this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort);this.question.ddArea=t.outerHTML;var o=e.querySelector(".wrongparts");o&&(this.question.ddArea+=o.outerHTML),this.question.ddArea+=n.outerHTML,this.question.readOnly=!1,this.question.initObjects&&(void 0!==this.question.initObjects.dropzones&&(this.dropZones=this.question.initObjects.dropzones),void 0!==this.question.initObjects.readonly&&(this.question.readOnly=this.question.initObjects.readonly)),this.question.loaded=!1},t.prototype.questionRendered=function(){this.destroyed||(this.questionInstance=new s.a(this.loggerProvider,this.domUtils,this.textUtils,this.element,this.question,this.question.readOnly,this.dropZones))},t.prototype.ngOnDestroy=function(){this.destroyed=!0,this.questionInstance&&this.questionInstance.destroy()},t=c([Object(o.m)({selector:"addon-qtype-ddmarker",template:'<section ion-list *ngIf="question.text || question.text === \'\'" class="addon-qtype-ddmarker-container">\n    \x3c!-- Content is outside the core-loading to let the script calculate drag items position --\x3e\n    <core-loading [hideUntil]="question.loaded"></core-loading>\n\n    <ion-item text-wrap [ngClass]="{invisible: !question.loaded}">\n        <p *ngIf="!question.readOnly" class="core-info-card" icon-start>\n            <ion-icon name="information-circle"></ion-icon>\n            {{ \'core.question.howtodraganddrop\' | translate }}\n        </p>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n        <core-format-text *ngIf="question.ddArea" [adaptImg]="false" [component]="component" [componentId]="componentId" [text]="question.ddArea" (afterRender)="questionRendered()"></core-format-text>\n    </ion-item>\n</section>\n'}),u("design:paramtypes",[r.a,o.C,o.t])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(91),s=n(1752),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeDdwtosComponent",n)||this;return r.loggerProvider=t,r.inputIds=[],r.destroyed=!1,r.element=o.nativeElement,r}return a(t,e),t.prototype.ngOnInit=function(){var e=this;if(!this.question)return this.logger.warn("Aborting because of no question received."),this.questionHelper.showComponentError(this.onAbort);var t=document.createElement("div");t.innerHTML=this.question.html,this.questionHelper.replaceCorrectnessClasses(t),this.questionHelper.replaceFeedbackClasses(t),this.questionHelper.treatCorrectnessIcons(t);var n=t.querySelector(".answercontainer");if(!n)return this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort);if(this.question.readOnly=n.classList.contains("readonly"),this.question.answers=n.outerHTML,this.question.text=this.domUtils.getContentsOfElement(t,".qtext"),void 0===this.question.text)return this.logger.warn("Aborting because of an error parsing question.",this.question.name),this.questionHelper.showComponentError(this.onAbort);Array.from(t.querySelectorAll('input[type="hidden"]:not([name*=sequencecheck])')).forEach(function(t){e.question.text+=t.outerHTML,e.inputIds.push(t.getAttribute("id"))})},t.prototype.questionRendered=function(){this.destroyed||(this.questionInstance=new s.a(this.loggerProvider,this.domUtils,this.element,this.question,this.question.readOnly,this.inputIds),this.questionHelper.treatCorrectnessIconsClicks(this.element,this.component,this.componentId))},t.prototype.ngOnDestroy=function(){this.destroyed=!0,this.questionInstance&&this.questionInstance.destroy()},t=c([Object(o.m)({selector:"addon-qtype-ddwtos",template:'<section ion-list *ngIf="question.text || question.text === \'\'">\n    <ion-item text-wrap class="addon-qtype-ddwtos-container">\n        <p *ngIf="!question.readOnly" class="core-info-card" icon-start>\n            <ion-icon name="information-circle"></ion-icon>\n            {{ \'core.question.howtodraganddrop\' | translate }}\n        </p>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n        <core-format-text *ngIf="question.answers" [component]="component" [componentId]="componentId" [text]="question.answers" (afterRender)="questionRendered()"></core-format-text>\n        <div class="drags"></div>\n    </ion-item>\n</section>\n'}),u("design:paramtypes",[r.a,o.C,o.t])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n){return e.call(this,t,"AddonQtypeDescriptionComponent",n)||this}return s(t,e),t.prototype.ngOnInit=function(){var e=this.initComponent();if(e){var t=e.querySelector('input[type="hidden"][name*=seen]');t&&(this.question.seenInput={name:t.name,value:t.value})}},t=a([Object(o.m)({selector:"addon-qtype-description",template:'<section ion-list *ngIf="question.text || question.text === \'\'">\n    \x3c!-- "Seen" hidden input --\x3e\n    <input *ngIf="question.seenInput" type="hidden" [name]="question.seenInput.name" [value]="question.seenInput.value" >\n    <ion-item text-wrap class="item item-text-wrap">\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n    </ion-item>\n</section>\n'}),c("design:paramtypes",[r.a,o.C])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(7),i=n(91),s=n(20),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeEssayComponent",n)||this;return r.fb=o,r}return a(t,e),t.prototype.ngOnInit=function(){this.initEssayComponent(),this.formControl=this.fb.control(this.question.textarea&&this.question.textarea.text)},t=c([Object(o.m)({selector:"addon-qtype-essay",template:'<section ion-list *ngIf="question.text || question.text === \'\'">\n    \x3c!-- Question text. --\x3e\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text"></core-format-text></p>\n    </ion-item>\n\n    \x3c!-- Textarea. --\x3e\n    <ion-item *ngIf="question.textarea && !question.hasDraftFiles">\n        \x3c!-- "Format" hidden input --\x3e\n        <input item-content *ngIf="question.formatInput" type="hidden" [name]="question.formatInput.name" [value]="question.formatInput.value" >\n        \x3c!-- Plain text textarea. --\x3e\n        <ion-textarea *ngIf="question.isPlainText" class="core-question-textarea" [ngClass]=\'{"core-monospaced": question.isMonospaced}\' placeholder="{{ \'core.question.answer\' | translate }}" [attr.name]="question.textarea.name" aria-multiline="true" [ngModel]="question.textarea.text"></ion-textarea>\n        \x3c!-- Rich text editor. --\x3e\n        <core-rich-text-editor item-content *ngIf="!question.isPlainText" placeholder="{{ \'core.question.answer\' | translate }}" [control]="formControl" [name]="question.textarea.name" [component]="component" [componentId]="componentId"></core-rich-text-editor>\n    </ion-item>\n\n    \x3c!-- Draft files not supported. --\x3e\n    <ng-container *ngIf="question.textarea && question.hasDraftFiles">\n        <ion-item text-wrap class="core-danger-item">\n            <p class="core-question-warning">{{ \'core.question.errorinlinefilesnotsupported\' | translate }}</p>\n        </ion-item>\n        <ion-item text-wrap>\n            <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.textarea.text"></core-format-text></p>\n        </ion-item>\n    </ng-container>\n\n    \x3c!-- Attachments not supported in the app yet. --\x3e\n    <ion-item text-wrap *ngIf="question.allowsAttachments" class="core-danger-item">\n        <p class="core-question-warning">{{ \'core.question.errorattachmentsnotsupported\' | translate }}</p>\n    </ion-item>\n\n    \x3c!-- Answer to the question and attachments (reviewing). --\x3e\n    <ion-item text-wrap *ngIf="!question.textarea && (question.answer || (!question.attachments.length && !question.allowsAttachments))">\n        <p><core-format-text [ngClass]=\'{"core-monospaced": question.isMonospaced}\' [component]="component" [componentId]="componentId" [text]="question.answer"></core-format-text></p>\n    </ion-item>\n\n    <ion-item *ngIf="!question.textarea && question.attachments && question.attachments.length">\n        <core-file *ngFor="let attachment of question.attachments" [file]="attachment" [component]="component" [componentId]="componentId"></core-file>\n    </ion-item>\n</section>\n'}),u("design:paramtypes",[r.a,o.C,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeGapSelectComponent",n)||this;return r.element=o.nativeElement,r}return s(t,e),t.prototype.ngOnInit=function(){this.initOriginalTextComponent(".qtext")},t.prototype.questionRendered=function(){this.questionHelper.treatCorrectnessIconsClicks(this.element,this.component,this.componentId)},t=a([Object(o.m)({selector:"addon-qtype-gapselect",template:'<section ion-list class="addon-qtype-gapselect-container" *ngIf="question.text || question.text === \'\'">\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text" (afterRender)="questionRendered()"></core-format-text></p>\n    </ion-item>\n</section>\n'}),c("design:paramtypes",[r.a,o.C,o.t])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(65),i=n(386),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionProvider=e,this.name="AddonQtypeMatch",this.type="qtype_match"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){for(var n in t){var o=t[n];if(!o||"0"===o)return 0}return 1},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){for(var n in t){var o=t[n];if(o&&"0"!==o)return 1}return 0},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(91),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t,n,o){var r=e.call(this,t,"AddonQtypeMultiAnswerComponent",n)||this;return r.element=o.nativeElement,r}return s(t,e),t.prototype.ngOnInit=function(){this.initOriginalTextComponent(".formulation")},t.prototype.questionRendered=function(){this.questionHelper.treatCorrectnessIconsClicks(this.element,this.component,this.componentId)},t=a([Object(o.m)({selector:"addon-qtype-multianswer",template:'<section ion-list class="addon-qtype-multianswer-container" *ngIf="question.text || question.text === \'\'">\n    <ion-item text-wrap>\n        <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.text" (afterRender)="questionRendered()"></core-format-text></p>\n    </ion-item>\n</section>\n'}),c("design:paramtypes",[r.a,o.C,o.t])],t)}(i.a)},,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(1360),l=n(1361),f=n(1362),p=n(1363),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=function(){function e(){}return e=h([Object(o.I)({declarations:[d.a,l.a,p.a,f.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a,p.a,f.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(407),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(42),l=n(400),f=n(401),p=n(738),h=n(1369),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=function(){function e(){}return e=m([Object(o.I)({declarations:[l.a,f.a,p.a,h.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a,d.a],providers:[],exports:[l.a,f.a,p.a,h.a],entryComponents:[l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.courseProvider=t,this.EVENTICONS={course:"fa-university",group:"people",site:"globe",user:"person",category:"fa-cubes"},this.logger=e.getInstance("AddonCalendarHelperProvider")}return e.prototype.formatEventData=function(e){e.icon=this.EVENTICONS[e.eventtype]||!1,e.icon||(e.icon=this.courseProvider.getModuleIconSrc(e.modulename),e.moduleIcon=e.icon)},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(749),c=n(16),u=n(15),d=n(66),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[a.a],imports:[r.b,i.k,s.b.forChild(),c.a,u.a,d.a],providers:[],exports:[a.a],entryComponents:[a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(93),i=n(2),s=n(72),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.langProvider=e,this.sitesProvider=t}return e.prototype.getCustomMenuItems=function(e){var t=this;return this.sitesProvider.getSite(e).then(function(e){var n=e.getStoredConfig("tool_mobile_custommenuitems"),o={},r=[],i=0;return n&&"string"==typeof n?(n.split(/(?:\r\n|\r|\n)/).forEach(function(e){var t,n=e.split("|"),r=n[0]?n[0].trim():n[0],s=n[1]?n[1].trim():n[1],a=n[2]?n[2].trim():n[2],c=(n[3]?n[3].trim():n[3])||"none",u=n[4]?n[4].trim():n[4];r&&s&&a&&(t=s+"#"+a,u||(u="embedded"==a?"qr-scanner":"link"),o[t]||(o[t]={url:s,type:a,position:i,labels:{}},i++),o[t].labels[c.toLowerCase()]={label:r,icon:u})}),i?t.langProvider.getCurrentLanguage().then(function(e){var t=s.a.default_lang||"en";for(var n in o){var i=o[n],a=i.labels[e]||i.labels[e+"_only"]||i.labels.none||i.labels[t];if(!a){for(var c in i.labels)if(-1==c.indexOf("_only")){a=i.labels[c];break}if(!a)return}r[i.position]={url:i.url,type:i.type,label:a.label,icon:a.icon}}return r}):r):r})},e.NUM_MAIN_HANDLERS=4,e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(1),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.translate=t,this.logger=e.getInstance("CoreUserHelperProvider")}return e.prototype.formatAddress=function(e,t,n){var o=this.translate.instant("core.listsep"),r=[e,t,n];return(r=r.filter(function(e){return e&&e.length>0})).join(o+" ")},e.prototype.formatRoleList=function(e){var t=this;if(!e||e.length<=0)return"";var n=this.translate.instant("core.listsep");return e.map(function(e){var n=t.translate.instant("core.user."+e.shortname);return n.indexOf("core.user.")<0?n:e.shortname}).join(n+" ")},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(1472),l=n(1473),f=n(1474),p=n(1475),h=n(1476),m=n(1477),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=function(){function e(){}return e=g([Object(o.I)({declarations:[d.a,l.a,f.a,p.a,h.a,m.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],exports:[d.a,l.a,f.a,p.a,h.a,m.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1478),c=n(16),u=n(15),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=function(){function e(){}return e=d([Object(o.I)({declarations:[a.a],imports:[r.b,i.k,s.b.forChild(),c.a,u.a],providers:[],exports:[a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(42),l=n(409),f=n(1534),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=function(){function e(){}return e=p([Object(o.I)({declarations:[l.a,f.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a,d.a],providers:[],exports:[l.a,f.a],entryComponents:[l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(20),i=n(1),s=n(8),a=n(11),c=n(22),u=n(95),d=n(5),l=(n.n(d),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r){this.domUtils=e,this.fb=t,this.translate=n,this.textUtils=o,this.timeUtils=r,this.div=document.createElement("div")}return e.prototype.formatActivityLink=function(e){this.div.innerHTML=e;var t=this.div.querySelector("a");return t?{formatted:!0,label:t.innerHTML,href:t.href}:{formatted:!1,label:e,href:""}},e.prototype.getContentPageAnswerDataFromHtml=function(e){var t={buttonText:"",content:""};this.div.innerHTML=e;var n=this.div.querySelector('input[type="button"]');return n&&(t.buttonText=n.value,n.remove()),t.content=this.div.innerHTML.trim(),t},e.prototype.getPageButtonsFromHtml=function(e){var t=[];this.div.innerHTML=e;var n=this.div.querySelector(".branchbuttoncontainer");if(!n){if(!this.div.querySelector('form input[type="submit"]'))return t;n=this.div}return Array.from(n.querySelectorAll("form")).forEach(function(e){var n=e.querySelector('input[type="submit"], button[type="submit"]'),o=Array.from(e.querySelectorAll("input"));if(n&&o&&o.length){var r={id:n.id,title:n.title||n.value,content:"INPUT"==n.tagName?n.value:n.innerHTML.trim(),data:{}};o.forEach(function(e){"submit"!=e.type&&(r.data[e.name]=e.value)}),t.push(r)}}),t},e.prototype.getPageContentsFromPageData=function(e){this.div.innerHTML=e.pagecontent;var t=this.div.querySelector(".contents");return t?t.innerHTML.trim():e.page.contents},e.prototype.getQuestionFromPageData=function(e,t){var n=this,o={};this.div.innerHTML=t.pagecontent;var r=this.div.querySelector(".fcontainer");Array.from(this.div.querySelectorAll('input[type="hidden"]')).forEach(function(t){e.addControl(t.name,n.fb.control(t.value))});var i=this.div.querySelector('input[type="submit"]');if(o.submitLabel=i?i.value:this.translate.instant("addon.mod_lesson.submit"),!r)return o;var s;switch(t.page.qtype){case u.a.LESSON_PAGE_TRUEFALSE:case u.a.LESSON_PAGE_MULTICHOICE:o.template="multichoice",o.options=[];var a=Array.from(r.querySelectorAll('input[type="radio"]'));if(!(a&&a.length||(o.multi=!0,(a=Array.from(r.querySelectorAll('input[type="checkbox"]')))&&a.length)))return o;var c=!1;a.forEach(function(t){var r={id:t.id,name:t.name,value:t.value,checked:!!t.checked,disabled:!!t.disabled},i=t.parentElement;if(r.checked||o.multi){e.addControl(r.name,n.fb.control(o.multi?{value:r.checked,disabled:r.disabled}:r.value)),c=!0}t.remove(),r.text=i.innerHTML.trim(),o.options.push(r)}),o.multi||(o.controlName=a[0].name,c||e.addControl(o.controlName,this.fb.control("")));break;case u.a.LESSON_PAGE_NUMERICAL:s="number";case u.a.LESSON_PAGE_SHORTANSWER:o.template="shortanswer";var d=r.querySelector('input[type="text"], input[type="number"]');if(!d)return o;o.input={id:d.id,name:d.name,maxlength:d.maxLength,type:s||"text"},e.addControl(d.name,this.fb.control({value:d.value,disabled:d.readOnly}));break;case u.a.LESSON_PAGE_ESSAY:o.template="essay";var l=r.querySelector("textarea");if(l)o.textarea={id:l.id,name:l.name||"answer[text]"},o.control=this.fb.control(""),e.addControl(o.textarea.name,o.control);else{var f=r.querySelector(".reviewessay");if(!f)return o;o.useranswer=f.innerHTML}break;case u.a.LESSON_PAGE_MATCHING:o.template="matching";var p=Array.from(r.querySelectorAll(".answeroption"));o.rows=[],p.forEach(function(t){var r=t.querySelector("label"),i=t.querySelector("select"),s=Array.from(t.querySelectorAll("option")),a={};if(r&&i&&s&&s.length){a.text=r.innerHTML.trim(),a.id=i.id,a.name=i.name,a.options=[];var c=!1;s.forEach(function(t){if(void 0!==t.value){var o={value:t.value,label:t.innerHTML.trim(),selected:t.selected};o.selected&&(c=!0,e.addControl(a.name,n.fb.control({value:o.value,disabled:!!i.disabled}))),a.options.push(o)}}),c||e.addControl(a.name,n.fb.control({value:"",disabled:!!i.disabled})),o.rows.push(a)}})}return o},e.prototype.getQuestionPageAnswerDataFromHtml=function(e){var t={};this.div.innerHTML=e;var n=this.div.querySelector('input[type="checkbox"][name*="answer"]');if(n)return t.isCheckbox=!0,t.checked=!!n.checked,t.name=n.name,t.highlight=!!this.div.querySelector(".highlight"),n.remove(),t.content=this.div.innerHTML.trim(),t;if(n=this.div.querySelector('input[type="number"],input[type="text"]'))return t.isText=!0,t.value=n.value,t;var o=this.div.querySelector("select");if(o&&o.options){var r=o.options[o.selectedIndex];return t.isSelect=!0,t.id=o.id,t.value=r?r.value:"",o.remove(),t.content=this.div.innerHTML.trim(),t}return e},e.prototype.getRetakeLabel=function(e,t){var n={retake:e.try+1,grade:"",timestart:"",duration:""},o=null!=e.grade;return o||e.end?(o&&(n.grade=this.translate.instant("core.percentagenumber",{$a:e.grade})),n.timestart=d(1e3*e.timestart).format("LLL"),t&&(n.duration=this.timeUtils.formatTime(e.timeend-e.timestart))):(n.grade=this.translate.instant("addon.mod_lesson.notcompleted"),e.timestart&&(n.timestart=d(1e3*e.timestart).format("LLL"))),this.translate.instant("addon.mod_lesson.retakelabel"+(t?"full":"short"),n)},e.prototype.prepareQuestionData=function(e,t){if("essay"==e.template&&e.textarea)t[e.textarea.property]=this.textUtils.formatHtmlLines(t[e.textarea.property]);else if("multichoice"==e.template&&e.multi)for(var n in t)n.match(/answer\[\d+\]/)&&0==t[n]&&delete t[n];return t},e.prototype.removeQuestionFromFeedback=function(e){return this.div.innerHTML=e,this.domUtils.removeElement(this.div,".generalbox:not(.feedback):not(.correctanswer)"),this.div.innerHTML.trim()},e=l([Object(o.A)(),f("design:paramtypes",[s.a,r.a,i.c,a.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(9),i=n(61),s=n(12),a=n(18),c=n(7),u=n(2),d=n(6),l=n(1),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s,a){this.appProvider=t,this.cronDelegate=n,this.eventsProvider=o,this.filePoolProvider=r,this.sitesProvider=i,this.utils=s,this.translate=a,this.syncPromises={},this.logger=e.getInstance("CoreSettingsHelper")}return e.prototype.getProcessor=function(e,t,n){if(void 0===n&&(n=!0),e&&e.length){for(var o=0;o<e.length;o++)if(e[o].name==t)return e[o];return n?e[0]:void 0}},e.prototype.getProcessorComponents=function(e,t){var n=this,o=[];return t.forEach(function(t){var r=n.utils.clone(t);r.notifications=[],t.notifications.forEach(function(t){for(var n=!1,o=0;o<t.processors.length;o++){var i=t.processors[o];if(i.name==e){n=!0,t.currentProcessor=i;break}}n&&r.notifications.push(t)}),r.notifications.length&&o.push(r)}),o},e.prototype.getSiteSyncPromise=function(e){return this.syncPromises[e]?this.syncPromises[e]:null},e.prototype.synchronizeSite=function(e,t){var n=this;if(this.syncPromises[t])return this.syncPromises[t];var o=[],r=this.cronDelegate.hasManualSyncHandlers();if(r&&!this.appProvider.isOnline())return Promise.reject(this.translate.instant("core.settings.cannotsyncoffline"));if(r&&e&&this.appProvider.isNetworkAccessLimited())return Promise.reject(this.translate.instant("core.settings.cannotsyncwithoutwifi"));o.push(this.filePoolProvider.invalidateAllFiles(t).catch(function(){})),o.push(this.sitesProvider.getSite(t).then(function(e){return e.invalidateWsCache().then(function(){var o=[];return o.push(e.checkIfLocalMobileInstalledAndNotUsed().then(function(){return n.eventsProvider.trigger(s.a.SESSION_EXPIRED,{},t),Promise.reject(n.translate.instant("core.lostconnection"))},function(){return n.sitesProvider.updateSiteInfo(t)})),o.push(n.cronDelegate.forceSyncExecution(t)),Promise.all(o)})}));var i=Promise.all(o);return this.syncPromises[t]=i,i.finally(function(){delete n.syncPromises[t]}),i},e=f([Object(o.A)(),p("design:paramtypes",[c.a,r.a,i.a,s.a,a.a,u.a,d.a,l.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(391),u=n(120),d=n(256),l=n(339),f=n(340),p=n(343),h=n(341),m=n(342),g=n(344),y=n(345),v=n(346),b=n(849),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=function(){function e(){}return e=_([Object(o.I)({declarations:[u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a],imports:[r.b,i.k,a.a,c.a,s.b.forChild()],providers:[],exports:[u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a],entryComponents:[d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r}),n.d(t,"b",function(){return i});var o=n(268),r=Object(o.j)("coreShowHideAnimation",[Object(o.i)(":enter",[Object(o.h)({opacity:0}),Object(o.e)("500ms ease-in-out",Object(o.h)({opacity:1}))]),Object(o.i)(":leave",[Object(o.h)({opacity:1}),Object(o.e)("500ms ease-in-out",Object(o.h)({opacity:0}))])]),i=Object(o.j)("coreSlideInOut",[Object(o.i)("void => fromLeft",[Object(o.h)({transform:"translateX(0)",opacity:1}),Object(o.e)(300,Object(o.f)([Object(o.h)({opacity:0,transform:"translateX(-100%)",offset:0}),Object(o.h)({opacity:1,transform:"translateX(5%)",offset:.7}),Object(o.h)({opacity:1,transform:"translateX(0)",offset:1})]))]),Object(o.i)("fromLeft => void",[Object(o.h)({transform:"translateX(-100%)",opacity:0}),Object(o.e)(300,Object(o.f)([Object(o.h)({opacity:1,transform:"translateX(0)",offset:0}),Object(o.h)({opacity:1,transform:"translateX(5%)",offset:.3}),Object(o.h)({opacity:0,transform:"translateX(-100%)",offset:1})]))]),Object(o.i)("void => fromRight",[Object(o.h)({transform:"translateX(0)",opacity:1}),Object(o.e)(300,Object(o.f)([Object(o.h)({opacity:0,transform:"translateX(100%)",offset:0}),Object(o.h)({opacity:1,transform:"translateX(-5%)",offset:.7}),Object(o.h)({opacity:1,transform:"translateX(0)",offset:1})]))]),Object(o.i)("fromRight => void",[Object(o.h)({transform:"translateX(-100%)",opacity:0}),Object(o.e)(300,Object(o.f)([Object(o.h)({opacity:1,transform:"translateX(0)",offset:0}),Object(o.h)({opacity:1,transform:"translateX(-5%)",offset:.3}),Object(o.h)({opacity:0,transform:"translateX(100%)",offset:1})]))])])},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.viewCtrl=t,this.courseId=-1,this.courses=e.get("courses")||[],this.courseId=e.get("courseId")||-1}return e.prototype.coursePicked=function(e,t){return this.viewCtrl.dismiss(t),!0},e=i([Object(o.m)({selector:"core-course-picker-menu-popover",template:'<ion-list radio-group [(ngModel)]="courseId">\n    <ion-item text-wrap *ngFor="let course of courses" >\n        <ion-label><core-format-text [text]="course.fullname"></core-format-text></ion-label>\n        <ion-radio value="{{course.id}}" (ionSelect)="coursePicked($event, course)" ></ion-radio>\n    </ion-item>\n</ion-list>'}),s("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(4),i=n(2),s=n(18),a=n(8),c=n(47),u=n(6),d=n(12),l=n(20),f=n(305),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},g=function(){function e(e,t,n,r,i,s,a,c,u){this.domUtils=e,this.keyboard=t,this.urlUtils=n,this.sitesProvider=r,this.filepoolProvider=i,this.content=s,this.events=c,this.utils=u,this.placeholder="",this.name="core-rich-text-editor",this.rteEnabled=!1,this.editorSupported=!0,this.contentChanged=new o.v,this.element=a.nativeElement}return e.prototype.ngAfterContentInit=function(){var e=this;this.domUtils.isRichTextEditorEnabled().then(function(t){e.rteEnabled=!!t}),this.editorSupported=this.domUtils.isRichTextEditorSupported(),this.editorElement=this.editor.nativeElement,this.editorElement.innerHTML=this.control.value,this.textarea.value=this.control.value,this.editorElement.onchange=this.onChange.bind(this),this.editorElement.onkeyup=this.onChange.bind(this),this.editorElement.onpaste=this.onChange.bind(this),this.editorElement.oninput=this.onChange.bind(this),this.editorElement.onkeydown=this.moveCursor.bind(this),this.valueChangeSubscription=this.control.valueChanges.subscribe(function(t){e.editorElement.innerHTML=t,e.textarea.value=t});for(var t=this.decorate.nativeElement.getElementsByTagName("button"),n=function(n){var o=t[n],r=o.getAttribute("data-command");if(r)if(r.includes("|")){var i=r.split("|")[1];r=r.split("|")[0],o.addEventListener("click",function(t){e.buttonAction(t,r,i)})}else o.addEventListener("click",function(t){e.buttonAction(t,r)})},o=0;o<t.length;o++)n(o);document.execCommand("DefaultParagraphSeparator",!1,"p"),this.treatExternalContent(),this.resizeFunction=this.maximizeEditorSize.bind(this),window.addEventListener("resize",this.resizeFunction);var r=0,i=setInterval(function(){e.maximizeEditorSize().then(function(e){(r>=5||0!=e)&&clearInterval(i),r++})},750);this.keyboardObs=this.events.on(d.a.KEYBOARD_CHANGE,function(t){e.maximizeEditorSize()})},e.prototype.maximizeEditorSize=function(){var e=this;this.content.resize();var t=this.utils.promiseDefer();return setTimeout(function(){var n=e.content.contentHeight;n<=0?t.resolve(0):setTimeout(function(){var o=e.getSurroundingHeight(e.element);e.element.style.height=n>o?e.domUtils.formatPixelsSize(n-o):"",t.resolve(n-o)},100)}),t.promise},e.prototype.getSurroundingHeight=function(e){for(var t=0;e.parentNode&&"ION-CONTENT"!=e.parentNode.tagName;){var n=e.parentNode;if(e.tagName&&"CORE-LOADING"!=e.tagName)for(var o=0;o<n.childNodes.length;o++){var r=n.childNodes[o];r.tagName&&r!=e&&(t+=this.domUtils.getElementHeight(r,!1,!0,!0))}e=n}var i=getComputedStyle(e);if(t+=this.domUtils.getComputedStyleMeasure(i,"paddingTop")+this.domUtils.getComputedStyleMeasure(i,"paddingBottom"),e&&e.parentNode&&"ION-CONTENT"==e.parentNode.tagName){var s=getComputedStyle(e);t-=this.domUtils.getComputedStyleMeasure(s,"paddingTop")+this.domUtils.getComputedStyleMeasure(s,"paddingBottom")}return t},e.prototype.onChange=function(e){this.rteEnabled?this.isNullOrWhiteSpace(this.editorElement.innerText)?this.clearText():(this.control.setValue(this.editorElement.innerHTML,{emitEvent:!1}),this.control.markAsDirty(),this.textarea.value=this.editorElement.innerHTML):this.isNullOrWhiteSpace(this.textarea.value)?this.clearText():(this.control.setValue(this.textarea.value,{emitEvent:!1}),this.control.markAsDirty()),this.contentChanged.emit(this.control.value)},e.prototype.moveCursor=function(e){if(this.rteEnabled&&("ArrowLeft"==e.key||"ArrowRight"==e.key)){e.preventDefault(),e.stopPropagation();var t="ArrowLeft"==e.key?-1:1,n=this.getCurrentCursorPosition(this.editorElement);this.setCurrentCursorPosition(this.editorElement,n+t)}},e.prototype.getCurrentCursorPosition=function(e){var t,n=window.getSelection(),o=-1;if(n.focusNode&&e.contains(n.focusNode))for(t=n.focusNode,o=n.focusOffset;t&&!t.isSameNode(e);)if(t.previousSibling)o+=(t=t.previousSibling).textContent.length;else if(null===(t=t.parentNode))break;return o},e.prototype.setCurrentCursorPosition=function(e,t){var n=function(e,t,o){if(0===o.count)t.setEnd(e,0);else if(e&&o.count>0)if(e.hasChildNodes())for(var r=0;r<e.childNodes.length&&(t=n(e.childNodes[r],t,o),0!==o.count);r++);else e.textContent.length<o.count?o.count-=e.textContent.length:(t.setEnd(e,o.count),o.count=0);return t},o=document.createRange();if(void 0===t)o.selectNode(e),o.selectNodeContents(e);else{if(t<0||t>e.textContent.length)return;o.selectNode(e),o.setStart(e,0),o=n(e,o,{count:t})}if(o){var r=window.getSelection();o.collapse(!1),r.removeAllRanges(),r.addRange(o)}},e.prototype.toggleEditor=function(e){var t=this;e.preventDefault(),e.stopPropagation();this.isNullOrWhiteSpace(this.control.value)?this.clearText():(this.editorElement.innerHTML=this.control.value,this.textarea.value=this.control.value),this.rteEnabled=!this.rteEnabled,setTimeout(function(){t.rteEnabled?(t.editorElement.focus(),t.setCurrentCursorPosition(t.editorElement.firstChild)):t.textarea.setFocus(),setTimeout(function(){t.keyboard.show()})})},e.prototype.treatExternalContent=function(){var e=this;if(this.sitesProvider.isLoggedIn()){var t=Array.from(this.editorElement.querySelectorAll("img")),n=this.sitesProvider.getCurrentSiteId(),o=this.sitesProvider.getCurrentSite().canDownloadFiles();t.forEach(function(t){var r=t.src;if(r&&e.urlUtils.isDownloadableUrl(r)&&(o||!e.urlUtils.isPluginFileUrl(r)))return e.filepoolProvider.getSrcByUrl(n,r,e.component,e.componentId).then(function(e){t.setAttribute("src",e)})})}},e.prototype.isNullOrWhiteSpace=function(e){return null==e||void 0===e||(e=e.replace(/[\n\r]/g,""),0===(e=e.split(" ").join("")).length)},e.prototype.clearText=function(){var e=this;this.editorElement.innerHTML="<p></p>",this.textarea.value="",this.control.setValue(null,{emitEvent:!1}),setTimeout(function(){e.rteEnabled&&e.setCurrentCursorPosition(e.editorElement)},1)},e.prototype.buttonAction=function(e,t,n){var o=this;void 0===n&&(n=null),e.preventDefault(),e.stopPropagation(),document.execCommand(t,!1,n),setTimeout(function(){o.rteEnabled?o.editorElement.focus():o.textarea.setFocus(),setTimeout(function(){o.keyboard.show()})})},e.prototype.ngOnDestroy=function(){this.valueChangeSubscription&&this.valueChangeSubscription.unsubscribe(),window.removeEventListener("resize",this.resizeFunction)},p([Object(o.D)(),h("design:type",Object)],e.prototype,"placeholder",void 0),p([Object(o.D)(),h("design:type",l.b)],e.prototype,"control",void 0),p([Object(o.D)(),h("design:type",Object)],e.prototype,"name",void 0),p([Object(o.D)(),h("design:type",String)],e.prototype,"component",void 0),p([Object(o.D)(),h("design:type",Number)],e.prototype,"componentId",void 0),p([Object(o.O)(),h("design:type",o.v)],e.prototype,"contentChanged",void 0),p([Object(o._9)("editor"),h("design:type",o.t)],e.prototype,"editor",void 0),p([Object(o._9)("textarea"),h("design:type",r.z)],e.prototype,"textarea",void 0),p([Object(o._9)("decorate"),h("design:type",o.t)],e.prototype,"decorate",void 0),e=p([Object(o.m)({selector:"core-rich-text-editor",template:'<div [hidden]="!rteEnabled">\n    <div #editor contenteditable="true" class="core-rte-editor" tappable [attr.data-placeholder-text]="placeholder">\n    </div>\n\n    \x3c!-- https://developer.mozilla.org/en-US/docs/Web/API/Document/execCommand --\x3e\n    <div #decorate class="core-rte-toolbar">\n        <div class="core-rte-buttons">\n            <button data-command="bold"><core-icon name="fa-bold"></core-icon></button>\n            <button data-command="italic"><core-icon name="fa-italic"></core-icon></button>\n            <button data-command="underline"><core-icon name="fa-underline"></core-icon></button>\n            <button data-command="strikeThrough"><core-icon name="fa-strikethrough"></core-icon></button>\n            <button data-command="formatBlock|<p>"><core-icon name="fa-paragraph"></core-icon></button>\n            <button data-command="formatBlock|<h1>"><core-icon name="fa-header"></core-icon>1</button>\n            <button data-command="formatBlock|<h2>"><core-icon name="fa-header"></core-icon>2</button>\n            <button data-command="formatBlock|<h3>"><core-icon name="fa-header"></core-icon>3</button>\n            <button data-command="insertUnorderedList"><core-icon name="fa-list-ul"></core-icon></button>\n            <button data-command="insertOrderedList"><core-icon name="fa-list-ol"></core-icon></button>\n            <button data-command="removeFormat"><core-icon name="fa-eraser"></core-icon></button>\n            <button (click)="toggleEditor($event)"><core-icon name="fa-code"></core-icon> {{ \'core.viewcode\' | translate }}</button>\n        </div>\n    </div>\n</div>\n\n<div [hidden]="rteEnabled">\n    <ion-textarea #textarea class="core-textarea" [placeholder]="placeholder" [attr.name]="name" ngControl="control" (ionChange)="onChange($event)"></ion-textarea>\n    <div class="core-rte-toolbar" [hidden]="!editorSupported">\n        <div #decorate class="core-rte-buttons">\n            <button tappable (click)="toggleEditor($event)"><core-icon name="fa-pencil-square-o"></core-icon> {{ \'core.vieweditor\' | translate }}</button>\n        </div>\n    </div>\n</div>\n\n\n'}),m(5,Object(o.N)()),h("design:paramtypes",[a.a,f.a,c.a,i.a,s.a,r.f,o.t,d.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(725),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(726),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(2),i=n(8),s=n(107),a=n(254),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=e,this.fileUploaderHelper=t,this.filesProvider=n,this.domUtils=o}return e.prototype.uploadPrivateFile=function(e){var t=this,n=this.sitesProvider.getCurrentSite(),o=n.getInfo().usermaxuploadfilesize,r=n.getInfo().userquota;return 0===r?r=-1:r>0&&void 0!==e&&(r-=e.filesizewithoutreferences),void 0!==r&&(o=Math.min(o,r)),this.fileUploaderHelper.selectAndUploadFile(o).then(function(e){if(!e)return Promise.reject(null);var n=t.domUtils.showModalLoading("core.fileuploader.uploading",!0);return t.filesProvider.moveFromDraftToPrivate(e.itemid).catch(function(e){return t.domUtils.showErrorModalDefault(e,"core.fileuploader.errorwhileuploading",!0),Promise.reject(null)}).finally(function(){n.dismiss()})}).then(function(){t.domUtils.showToast("core.fileuploader.fileuploaded",!0,void 0,"core-toast-success")})},e=c([Object(o.A)(),u("design:paramtypes",[r.a,s.a,a.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(4),i=n(1),s=n(12),a=n(2),c=n(8),u=n(11),d=n(10),l=n(21),f=n(97),p=n(36),h=n(104),m=n(735),g=n(41),y=n(135),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(){function e(e,t,n,o,r,i,a,c,u,d,l,f,p,h){var m=this;this.courseProvider=t,this.domUtils=n,this.courseFormatDelegate=o,this.courseOptionsDelegate=r,this.translate=i,this.courseHelper=a,this.textUtils=u,this.coursesProvider=d,this.navCtrl=f,this.injector=p,this.prefetchDelegate=h,this.downloadEnabledIcon="square-outline",this.prefetchCourseData={prefetchCourseIcon:"spinner",title:"core.course.downloadcourse"},this.isDestroyed=!1,this.course=e.get("course"),this.sectionId=e.get("sectionId"),this.sectionNumber=e.get("sectionNumber"),this.module=e.get("module"),this.title=o.getCourseTitle(this.course),this.displayEnableDownload=o.displayEnableDownload(this.course),this.downloadCourseEnabled=!this.coursesProvider.isDownloadCourseDisabledInSite(),this.completionObserver=c.on(s.a.COMPLETION_MODULE_VIEWED,function(e){e&&e.courseId==m.course.id&&m.refreshAfterCompletionChange()}),this.downloadCourseEnabled&&(this.courseStatusObserver=c.on(s.a.COURSE_STATUS_CHANGED,function(e){e.courseId==m.course.id&&m.updateCourseStatus(e.status)},l.getCurrentSiteId()))}return e.prototype.ionViewDidLoad=function(){var e=this;this.module&&(this.moduleId=this.module.id,this.courseHelper.openModule(this.navCtrl,this.module,this.course.id,this.sectionId)),this.loadData().finally(function(){e.dataLoaded=!0,e.downloadCourseEnabled&&e.determineCoursePrefetchIcon().then(function(){if("spinner"==e.prefetchCourseData.prefetchCourseIcon){var t=e.courseHelper.getCourseDownloadPromise(e.course.id);t?t.catch(function(t){e.isDestroyed||e.domUtils.showErrorModalDefault(t,"core.course.errordownloadingcourse",!0)}):e.courseProvider.setCoursePreviousStatus(e.course.id).then(function(t){e.updateCourseStatus(t)})}})})},e.prototype.loadData=function(e){var t=this;return this.coursesProvider.getUserCourse(this.course.id).catch(function(){}).then(function(n){var o,r=[];return n&&(t.course=n),o=!1===t.course.enablecompletion?Promise.resolve({}):t.courseProvider.getActivitiesCompletionStatus(t.course.id).catch(function(){return{}}),r.push(o.then(function(n){return t.courseProvider.getSections(t.course.id,!1,!0).then(function(n){if(e){var o=t.courseProvider.getSectionsModules(n);return t.prefetchDelegate.invalidateModules(o,t.course.id).then(function(){return n})}return n}).then(function(e){t.courseHelper.addHandlerDataForModules(e,t.course.id,n),t.sections=e.map(function(e){return t.textUtils.formatText(e.name.trim(),!0,!0).then(function(t){e.formattedName=t}),e.hasContent=t.courseHelper.sectionHasContent(e),e}),t.courseFormatDelegate.canViewAllSections(t.course)&&t.sections.unshift({name:t.translate.instant("core.course.allsections"),id:d.a.ALL_SECTIONS_ID,hasContent:!0}),t.title=t.courseFormatDelegate.getCourseTitle(t.course,t.sections),t.displayRefresher=t.courseFormatDelegate.displayRefresher(t.course,t.sections)})})),t.course.overviewfiles?t.course.imageThumb=t.course.overviewfiles[0]&&t.course.overviewfiles[0].fileurl:t.coursesProvider.isGetCoursesByFieldAvailable()&&r.push(t.coursesProvider.getCoursesByField("id",t.course.id).then(function(e){t.course.imageThumb=!!(e[0]&&e[0].overviewfiles&&e[0].overviewfiles[0])&&e[0].overviewfiles[0].fileurl})),r.push(t.courseOptionsDelegate.getHandlersToDisplay(t.injector,t.course,e,!1).then(function(e){e.forEach(function(e){e.data.componentData=e.data.componentData||{},e.data.componentData.courseId=t.course.id}),t.courseHandlers=e})),Promise.all(r).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.course.couldnotloadsectioncontent",!0)})})},e.prototype.doRefresh=function(e){var t=this;return this.invalidateData().finally(function(){return t.loadData(!0).finally(function(){return(t.displayRefresher?t.formatComponent.doRefresh(e):Promise.resolve()).finally(function(){e&&e.complete()})})})},e.prototype.onCompletionChange=function(){var e=this;this.invalidateData().finally(function(){e.refreshAfterCompletionChange()})},e.prototype.invalidateData=function(){var e=[];return e.push(this.courseProvider.invalidateSections(this.course.id)),e.push(this.coursesProvider.invalidateUserCourses()),e.push(this.courseFormatDelegate.invalidateData(this.course,this.sections)),e.push(this.coursesProvider.invalidateCoursesByField("id",this.course.id)),this.sections&&e.push(this.prefetchDelegate.invalidateCourseUpdates(this.course.id)),Promise.all(e)},e.prototype.refreshAfterCompletionChange=function(){var e=this,t=this.content.getScrollElement(),n=t.scrollTop||0,o=t.scrollLeft||0;this.dataLoaded=!1,this.content.scrollToTop(),this.loadData().finally(function(){e.dataLoaded=!0,e.content.scrollTo(o,n)})},e.prototype.determineCoursePrefetchIcon=function(){var e=this;return this.courseHelper.getCourseStatusIconAndTitle(this.course.id).then(function(t){e.prefetchCourseData.prefetchCourseIcon=t.icon,e.prefetchCourseData.title=t.title})},e.prototype.prefetchCourse=function(){var e=this;this.courseHelper.confirmAndPrefetchCourse(this.prefetchCourseData,this.course,this.sections,this.courseHandlers).then(function(){e.downloadEnabled&&e.courseHelper.calculateSectionsStatus(e.sections,e.course.id).catch(function(){})}).catch(function(t){e.isDestroyed||e.domUtils.showErrorModalDefault(t,"core.course.errordownloadingcourse",!0)})},e.prototype.toggleDownload=function(){this.downloadEnabled=!this.downloadEnabled,this.downloadEnabledIcon=this.downloadEnabled?"checkbox-outline":"square-outline"},e.prototype.updateCourseStatus=function(e){var t=this.courseHelper.getCourseStatusIconAndTitleFromStatus(e);this.prefetchCourseData.prefetchCourseIcon=t.icon,this.prefetchCourseData.title=t.title},e.prototype.openCourseSummary=function(){this.navCtrl.push("CoreCoursesCoursePreviewPage",{course:this.course,avoidOpenCourse:!0})},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.completionObserver&&this.completionObserver.off()},e.prototype.ionViewDidEnter=function(){this.formatComponent&&this.formatComponent.ionViewDidEnter(),this.tabsComponent&&this.tabsComponent.ionViewDidEnter()},e.prototype.ionViewDidLeave=function(){this.formatComponent&&this.formatComponent.ionViewDidLeave(),this.tabsComponent&&this.tabsComponent.ionViewDidLeave()},v([Object(o._9)(r.f),b("design:type",r.f)],e.prototype,"content",void 0),v([Object(o._9)(m.a),b("design:type",m.a)],e.prototype,"formatComponent",void 0),v([Object(o._9)(y.a),b("design:type",y.a)],e.prototype,"tabsComponent",void 0),e=v([Object(o.m)({selector:"page-core-course-section",template:'<ion-header>\n    <ion-navbar>\n        <ion-title><core-format-text [text]="title"></core-format-text></ion-title>\n\n        <ion-buttons end></ion-buttons>\n    </ion-navbar>\n</ion-header>\n<ion-content>\n    <core-tabs>\n        \x3c!-- Course contents tab. --\x3e\n        <core-tab [title]="\'core.course.contents\' | translate">\n            <ng-template>\n                <core-navbar-buttons>\n                    <core-context-menu>\n                        <core-context-menu-item *ngIf="displayEnableDownload" [priority]="2000" [content]="\'core.settings.enabledownloadsection\' | translate" (action)="toggleDownload()" [iconAction]="downloadEnabledIcon"></core-context-menu-item>\n                        <core-context-menu-item [hidden]="!downloadCourseEnabled" [priority]="1900" [content]="prefetchCourseData.title | translate" (action)="prefetchCourse()" [iconAction]="prefetchCourseData.prefetchCourseIcon" [closeOnClick]="false"></core-context-menu-item>\n                        <core-context-menu-item [priority]="1800" [content]="\'core.course.coursesummary\' | translate" (action)="openCourseSummary()" iconAction="fa-graduation-cap"></core-context-menu-item>\n                    </core-context-menu>\n                </core-navbar-buttons>\n                <ion-content>\n                    <ion-refresher [enabled]="dataLoaded && displayRefresher" (ionRefresh)="doRefresh($event)">\n                        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n                    </ion-refresher>\n\n                    <core-loading [hideUntil]="dataLoaded">\n                        <core-course-format [course]="course" [sections]="sections" [initialSectionId]="sectionId" [initialSectionNumber]="sectionNumber" [downloadEnabled]="downloadEnabled" [moduleId]="moduleId" (completionChanged)="onCompletionChange()"></core-course-format>\n                    </core-loading>\n                </ion-content>\n            </ng-template>\n        </core-tab>\n        \x3c!-- One tab per handler. --\x3e\n        <core-tab *ngFor="let handler of courseHandlers" [title]="handler.data.title | translate" class="{{handler.data.class}}">\n            <ng-template>\n                <core-dynamic-component [component]="handler.data.component" [data]="handler.data.componentData"></core-dynamic-component>\n            </ng-template>\n        </core-tab>\n    </core-tabs>\n</ion-content>\n'}),b("design:paramtypes",[r.r,d.a,c.a,f.a,h.a,i.c,l.a,s.a,u.a,g.a,a.a,r.q,o.C,p.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(402),l=n(741),f=n(1370),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=function(){function e(){}return e=p([Object(o.I)({declarations:[d.a,l.a,f.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a,f.a],entryComponents:[d.a,l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(403),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(404),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(42),u=n(408),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=function(){function e(){}return e=d([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[],exports:[u.a],entryComponents:[u.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(42),l=n(411),f=n(819),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=function(){function e(){}return e=p([Object(o.I)({declarations:[l.a,f.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a,d.a],providers:[],exports:[l.a,f.a],entryComponents:[l.a,f.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(412),l=n(822),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){}return e=f([Object(o.I)({declarations:[d.a,l.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a],entryComponents:[d.a,l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(413),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(414),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(415),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(416),l=n(962),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){}return e=f([Object(o.I)({declarations:[d.a,l.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a],entryComponents:[d.a,l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return e=r([Object(o.m)({selector:"addon-mod-quiz-connection-error",template:'<ion-item text-wrap>{{ "addon.mod_quiz.connectionerror" | translate }}</ion-item>'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(417),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(419),l=n(965),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){}return e=f([Object(o.I)({declarations:[d.a,l.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a],entryComponents:[d.a,l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=n(138),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.viewCtrl=t,this.toc=e.get("toc")||[],this.attemptToContinue=e.get("attemptToContinue");var n=e.get("mode");this.isBrowse=n===i.a.MODEBROWSE,this.isReview=n===i.a.MODEREVIEW}return e.prototype.loadSco=function(e){e.prereq&&e.isvisible&&e.launch&&this.viewCtrl.dismiss(e)},e=s([Object(o.m)({selector:"addon-mod-scorm-toc-popover",template:'<ion-list>\n    <ion-item text-wrap *ngIf="attemptToContinue">\n        <p>{{ \'addon.mod_scorm.dataattemptshown\' | translate:{number: attemptToContinue} }}</p>\n    </ion-item>\n    <ion-item text-center *ngIf="isBrowse">\n        <p>{{ \'addon.mod_scorm.mod_scorm.browsemode\' }}</p>\n    </ion-item>\n    <ion-item text-center *ngIf="isReview">\n        <p>{{ \'addon.mod_scorm.mod_scorm.reviewmode\' }}</p>\n    </ion-item>\n\n    \x3c!-- List of SCOs. --\x3e\n    <ng-container *ngFor="let sco of toc">\n        <a *ngIf="sco.isvisible" ion-item text-wrap [ngClass]="[\'core-padding-\' + sco.level]" (click)="loadSco(sco)" [attr.disabled]="!sco.prereq || !sco.launch ? true : null" detail-none>\n            <img [src]="sco.image.url" [alt]="sco.image.description" />\n            <span>{{ sco.title }}</span>\n        </a>\n    </ng-container>\n</ion-list>\n'}),a("design:paramtypes",[r.r,r.B])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(420),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(421),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(42),d=n(422),l=n(837),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=function(){function e(){}return e=f([Object(o.I)({declarations:[d.a,l.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a,l.a],entryComponents:[d.a,l.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(20),i=n(1),s=n(45),a=n(8),c=n(11),u=n(6),d=n(12),l=n(121),f=n(2),p=n(56),h=n(106),m=n(136),g=n(116),y=n(131),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(){function e(e,t,n,o,i,s,a,c,u,d,l,f,p,m){this.translate=e,this.injector=t,this.eventsProvider=n,this.fileSessionProvider=o,this.syncProvider=i,this.domUtils=s,this.textUtils=a,this.utils=c,this.sitesProvider=u,this.uploaderProvider=d,this.workshopProvider=l,this.workshopHelper=f,this.workshopOffline=p,this.strategyDelegate=m,this.data={workshopId:0,assessment:null,edit:!1,selectedValues:[],fieldErrors:{},strategy:""},this.assessmentStrategyLoaded=!1,this.notSupported=!1,this.feedbackText="",this.feedbackControl=new r.b,this.overallFeedkback=!1,this.overallFeedkbackRequired=!1,this.component=h.a.COMPONENT,this.originalData={text:"",files:[],weight:1,selectedValues:[]}}return e.prototype.ngOnInit=function(){var e=this;if(this.assessmentId&&this.strategy)if(this.data.workshopId=this.workshop.id,this.data.edit=this.edit,this.data.strategy=this.strategy,this.componentClass=this.strategyDelegate.getComponentForPlugin(this.injector,this.strategy),this.componentClass){if(this.overallFeedkback=!!this.workshop.overallfeedbackmode,this.overallFeedkbackRequired=2==this.workshop.overallfeedbackmode,this.componentId=this.workshop.coursemodule,this.edit&&this.access.canallocate){this.weights=[];for(var t=16;t>=0;t--)this.weights[t]=t}this.edit&&this.syncProvider.blockOperation(h.a.COMPONENT,this.workshop.id),this.load().then(function(){e.obsInvalidated=e.eventsProvider.on(h.a.ASSESSMENT_INVALIDATED,e.load.bind(e),e.sitesProvider.getCurrentSiteId())}).finally(function(){e.assessmentStrategyLoaded=!0})}else this.notSupported=!this.strategyDelegate.isPluginSupported(this.strategy),this.assessmentStrategyLoaded=!0;else this.assessmentStrategyLoaded=!0},e.prototype.load=function(){var e=this;return this.workshopHelper.getReviewerAssessmentById(this.workshop.id,this.assessmentId,this.userId).then(function(t){e.data.assessment=t;return(e.edit?e.workshopOffline.getAssessment(e.workshop.id,e.assessmentId).then(function(n){var o=n.inputdata;if(e.hasOffline=!0,t.feedbackauthor=o.feedbackauthor,e.access.canallocate&&(t.weight=o.weight),t.form.current=e.workshopProvider.parseFields(e.utils.objectToArrayOfObjects(o,"name","value")),o)return e.workshopHelper.getAssessmentFilesFromOfflineFilesObject(o.feedbackauthorattachmentsid,e.workshop.id,e.assessmentId).then(function(e){t.feedbackattachmentfiles=e})}).catch(function(){e.hasOffline=!1}).finally(function(){e.feedbackText=t.feedbackauthor,e.feedbackControl.setValue(e.feedbackText),e.originalData.text=e.data.assessment.feedbackauthor,e.access.canallocate&&(e.originalData.weight=t.weight),e.originalData.files=[],t.feedbackattachmentfiles.forEach(function(t){var n;n=t.filename?t.filename:"/"==t.filepath[0]?t.filepath.substr(1):t.filepath,e.originalData.files.push({filename:n,fileurl:t.fileurl})})}):Promise.resolve()).then(function(){return e.strategyDelegate.getOriginalValues(e.strategy,t.form,e.workshop.id).then(function(t){e.data.selectedValues=t}).finally(function(){e.originalData.selectedValues=e.utils.clone(e.data.selectedValues),e.edit&&(e.fileSessionProvider.setFiles(h.a.COMPONENT,e.workshop.id+"_"+e.assessmentId,t.feedbackattachmentfiles),e.access.canallocate&&(e.weight=t.weight))})})})},e.prototype.hasDataChanged=function(){if(!this.assessmentStrategyLoaded)return!1;var e=this.textUtils.restorePluginfileUrls(this.feedbackText,this.data.assessment.feedbackcontentfiles||[]);if(this.originalData.text!=e)return!0;if(this.access.canallocate&&this.originalData.weight!=this.weight)return!0;var t=this.fileSessionProvider.getFiles(h.a.COMPONENT,this.workshop.id+"_"+this.assessmentId)||[];return!!this.uploaderProvider.areFileListDifferent(t,this.originalData.files)||this.strategyDelegate.hasDataChanged(this.workshop,this.originalData.selectedValues,this.data.selectedValues)},e.prototype.saveAssessment=function(){var e=this,t=this.fileSessionProvider.getFiles(h.a.COMPONENT,this.workshop.id+"_"+this.assessmentId)||[],n=!1,o=!t.length,r=this.domUtils.showModalLoading("core.sending",!0);return this.data.fieldErrors={},this.workshopHelper.uploadOrStoreAssessmentFiles(this.workshop.id,this.assessmentId,t,n).catch(function(){return n=!0,o=!0,e.workshopHelper.uploadOrStoreAssessmentFiles(e.workshop.id,e.assessmentId,t,n)}).then(function(n){var o=e.textUtils.restorePluginfileUrls(e.feedbackText,e.data.assessment.feedbackcontentfiles||[]);return e.workshopHelper.prepareAssessmentData(e.workshop,e.data.selectedValues,o,t,e.data.assessment.form,n).catch(function(t){return e.data.fieldErrors=t,Promise.reject(e.translate.instant("core.errorinvalidform"))})}).then(function(t){return n?e.workshopOffline.saveAssessment(e.workshop.id,e.assessmentId,e.workshop.course,t).then(function(){}):e.workshopProvider.updateAssessment(e.workshop.id,e.assessmentId,e.workshop.course,t,!1,o)}).then(function(n){var o=[];return n&&(o.push(e.workshopHelper.deleteAssessmentStoredFiles(e.workshop.id,e.assessmentId)),o.push(e.workshopProvider.invalidateAssessmentFormData(e.workshop.id,e.assessmentId)),o.push(e.workshopProvider.invalidateAssessmentData(e.workshop.id,e.assessmentId))),Promise.all(o).catch(function(){}).finally(function(){e.eventsProvider.trigger(h.a.ASSESSMENT_SAVED,{workshopId:e.workshop.id,assessmentId:e.assessmentId,userId:e.sitesProvider.getCurrentSiteUserId()},e.sitesProvider.getCurrentSiteId()),t&&e.uploaderProvider.clearTmpFiles(t)})}).catch(function(t){return e.domUtils.showErrorModalDefault(t,"Error saving assessment."),Promise.reject(null)}).finally(function(){r.dismiss()})},e.prototype.onFeedbackChange=function(e){this.feedbackText=e},e.prototype.ngOnDestroy=function(){this.obsInvalidated&&this.obsInvalidated.off(),this.data.assessment.feedbackattachmentfiles&&this.uploaderProvider.clearTmpFiles(this.data.assessment.feedbackattachmentfiles)},v([Object(o.D)(),b("design:type",Object)],e.prototype,"workshop",void 0),v([Object(o.D)(),b("design:type",Object)],e.prototype,"access",void 0),v([Object(o.D)(),b("design:type",Number)],e.prototype,"assessmentId",void 0),v([Object(o.D)(),b("design:type",Number)],e.prototype,"userId",void 0),v([Object(o.D)(),b("design:type",String)],e.prototype,"strategy",void 0),v([Object(o.D)(),b("design:type",Boolean)],e.prototype,"edit",void 0),e=v([Object(o.m)({selector:"addon-mod-workshop-assessment-strategy",template:'<h3 padding>{{ \'addon.mod_workshop.assessmentform\' | translate }}</h3>\n\n<form name="mma-mod_workshop-assessment-form">\n    <core-loading [hideUntil]="assessmentStrategyLoaded">\n        <ng-container *ngIf="componentClass && assessmentStrategyLoaded">\n            <core-dynamic-component [component]="componentClass" [data]="data"></core-dynamic-component>\n        </ng-container>\n\n        <div class="core-info-card" *ngIf="notSupported">\n            {{ \'addon.mod_workshop.assessmentstrategynotsupported\' | translate:{$a: strategy} }}\n        </div>\n\n        <ion-card *ngIf="assessmentStrategyLoaded && overallFeedkback && (edit || data.assessment.feedbackauthor || data.assessment.feedbackattachmentfiles.length) ">\n            <ion-item text-wrap>\n                <h2>{{ \'addon.mod_workshop.overallfeedback\' | translate }}</h2>\n            </ion-item>\n            <ion-item stacked *ngIf="edit">\n                <ion-label stacked [core-mark-required]="overallFeedkbackRequired">{{ \'addon.mod_workshop.feedbackauthor\' | translate }}</ion-label>\n                <core-rich-text-editor item-content [control]="feedbackControl" [component]="component" [componentId]="workshop.coursemodule" (contentChanged)="onFeedbackChange($event)"></core-rich-text-editor>\n                <core-input-errors item-content *ngIf="overallFeedkbackRequired && fieldErrors[\'feedbackauthor\']" [errorText]="fieldErrors[\'feedbackauthor\']"></core-input-errors>\n            </ion-item>\n            <core-attachments *ngIf="edit && workshop.overallfeedbackfiles" [files]="data.assessment.feedbackattachmentfiles" [maxSize]="workshop.overallfeedbackmaxbytes"\n                [maxSubmissions]="workshop.overallfeedbackfiles" [component]="component" [componentId]="componentId" [allowOffline]="true"></core-attachments>\n            <ion-item *ngIf="edit && access && access.canallocate">\n                <ion-label stacked [core-mark-required]="true">{{ \'addon.mod_workshop.assessmentweight\' | translate }}</ion-label>\n                <ion-select [(ngModel)]="weight" interface="popover">\n                    <ion-option *ngFor="let w of weights" [value]="w">{{w}}</ion-option>\n                </ion-select>\n            </ion-item>\n            <ion-item text-wrap *ngIf="!edit && data.assessment.feedbackauthor">\n                <core-format-text [component]="component" [componentId]="componentId" [text]="data.assessment.feedbackauthor"></core-format-text>\n            </ion-item>\n            <ion-item *ngIf="!edit && workshop.overallfeedbackfiles && data.assessment.feedbackattachmentfiles && data.assessment.feedbackattachmentfiles.length">\n                <ng-container *ngFor="let attachment of data.assessment.feedbackattachmentfiles">\n                    \x3c!-- Files already attached to the submission. --\x3e\n                    <core-file *ngIf="!attachment.name" [file]="attachment" [component]="component" [componentId]="componentId"></core-file>\n                    \x3c!-- Files stored in offline to be sent later. --\x3e\n                    <core-local-file *ngIf="attachment.name" [file]="attachment"></core-local-file>\n                </ng-container>\n            </ion-item>\n        </ion-card>\n    </core-loading>\n</form>'}),b("design:paramtypes",[i.c,o.C,d.a,l.a,s.a,a.a,c.a,u.a,f.a,p.a,h.a,m.a,g.a,y.a])],e)}()},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=n(263),r=n(436),i=n(1770);n.n(i);Object(i.shim)(),Object(o.b)().bootstrapModule(r.a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(8),s=n(6),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},d=function(){function e(e,t,n,o){this.domUtils=t,this.utils=n,this.navCtrl=o,this.coreAutoFocus=!0,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;if(this.navCtrl.isTransitioning())var t=this.navCtrl.viewDidEnter.subscribe(function(){e.autoFocus(),t.unsubscribe()});else this.autoFocus()},e.prototype.autoFocus=function(){var e=this;this.utils.isTrueOrOne(this.coreAutoFocus)&&setTimeout(function(){var t=e.element;"ION-INPUT"==e.element.tagName?t=e.element.querySelector("input")||t:"ION-TEXTAREA"==e.element.tagName&&(t=e.element.querySelector("textarea")||t),e.domUtils.focusElement(t)},200)},a([Object(o.D)("core-auto-focus"),c("design:type",Object)],e.prototype,"coreAutoFocus",void 0),e=a([Object(o.s)({selector:"[core-auto-focus]"}),u(3,Object(o.N)()),c("design:paramtypes",[o.t,i.a,s.a,r.q])],e)}()},,function(e,t,n){function o(e){return n(r(e))}function r(e){var t=i[e];if(!(t+1))throw new Error("Cannot find module '"+e+"'.");return t}var i={"./af":498,"./af.js":498,"./ar":499,"./ar-dz":500,"./ar-dz.js":500,"./ar-kw":501,"./ar-kw.js":501,"./ar-ly":502,"./ar-ly.js":502,"./ar-ma":503,"./ar-ma.js":503,"./ar-sa":504,"./ar-sa.js":504,"./ar-tn":505,"./ar-tn.js":505,"./ar.js":499,"./az":506,"./az.js":506,"./be":507,"./be.js":507,"./bg":508,"./bg.js":508,"./bm":509,"./bm.js":509,"./bn":510,"./bn.js":510,"./bo":511,"./bo.js":511,"./br":512,"./br.js":512,"./bs":513,"./bs.js":513,"./ca":514,"./ca.js":514,"./cs":515,"./cs.js":515,"./cv":516,"./cv.js":516,"./cy":517,"./cy.js":517,"./da":518,"./da.js":518,"./de":519,"./de-at":520,"./de-at.js":520,"./de-ch":521,"./de-ch.js":521,"./de.js":519,"./dv":522,"./dv.js":522,"./el":523,"./el.js":523,"./en-au":524,"./en-au.js":524,"./en-ca":525,"./en-ca.js":525,"./en-gb":526,"./en-gb.js":526,"./en-ie":527,"./en-ie.js":527,"./en-il":528,"./en-il.js":528,"./en-nz":529,"./en-nz.js":529,"./eo":530,"./eo.js":530,"./es":531,"./es-do":532,"./es-do.js":532,"./es-us":533,"./es-us.js":533,"./es.js":531,"./et":534,"./et.js":534,"./eu":535,"./eu.js":535,"./fa":536,"./fa.js":536,"./fi":537,"./fi.js":537,"./fo":538,"./fo.js":538,"./fr":539,"./fr-ca":540,"./fr-ca.js":540,"./fr-ch":541,"./fr-ch.js":541,"./fr.js":539,"./fy":542,"./fy.js":542,"./gd":543,"./gd.js":543,"./gl":544,"./gl.js":544,"./gom-latn":545,"./gom-latn.js":545,"./gu":546,"./gu.js":546,"./he":547,"./he.js":547,"./hi":548,"./hi.js":548,"./hr":549,"./hr.js":549,"./hu":550,"./hu.js":550,"./hy-am":551,"./hy-am.js":551,"./id":552,"./id.js":552,"./is":553,"./is.js":553,"./it":554,"./it.js":554,"./ja":555,"./ja.js":555,"./jv":556,"./jv.js":556,"./ka":557,"./ka.js":557,"./kk":558,"./kk.js":558,"./km":559,"./km.js":559,"./kn":560,"./kn.js":560,"./ko":561,"./ko.js":561,"./ky":562,"./ky.js":562,"./lb":563,"./lb.js":563,"./lo":564,"./lo.js":564,"./lt":565,"./lt.js":565,"./lv":566,"./lv.js":566,"./me":567,"./me.js":567,"./mi":568,"./mi.js":568,"./mk":569,"./mk.js":569,"./ml":570,"./ml.js":570,"./mn":571,"./mn.js":571,"./mr":572,"./mr.js":572,"./ms":573,"./ms-my":574,"./ms-my.js":574,"./ms.js":573,"./mt":575,"./mt.js":575,"./my":576,"./my.js":576,"./nb":577,"./nb.js":577,"./ne":578,"./ne.js":578,"./nl":579,"./nl-be":580,"./nl-be.js":580,"./nl.js":579,"./nn":581,"./nn.js":581,"./pa-in":582,"./pa-in.js":582,"./pl":583,"./pl.js":583,"./pt":584,"./pt-br":585,"./pt-br.js":585,"./pt.js":584,"./ro":586,"./ro.js":586,"./ru":587,"./ru.js":587,"./sd":588,"./sd.js":588,"./se":589,"./se.js":589,"./si":590,"./si.js":590,"./sk":591,"./sk.js":591,"./sl":592,"./sl.js":592,"./sq":593,"./sq.js":593,"./sr":594,"./sr-cyrl":595,"./sr-cyrl.js":595,"./sr.js":594,"./ss":596,"./ss.js":596,"./sv":597,"./sv.js":597,"./sw":598,"./sw.js":598,"./ta":599,"./ta.js":599,"./te":600,"./te.js":600,"./tet":601,"./tet.js":601,"./tg":602,"./tg.js":602,"./th":603,"./th.js":603,"./tl-ph":604,"./tl-ph.js":604,"./tlh":605,"./tlh.js":605,"./tr":606,"./tr.js":606,"./tzl":607,"./tzl.js":607,"./tzm":608,"./tzm-latn":609,"./tzm-latn.js":609,"./tzm.js":608,"./ug-cn":610,"./ug-cn.js":610,"./uk":611,"./uk.js":611,"./ur":612,"./ur.js":612,"./uz":613,"./uz-latn":614,"./uz-latn.js":614,"./uz.js":613,"./vi":615,"./vi.js":615,"./x-pseudo":616,"./x-pseudo.js":616,"./yo":617,"./yo.js":617,"./zh-cn":618,"./zh-cn.js":618,"./zh-hk":619,"./zh-hk.js":619,"./zh-tw":620,"./zh-tw.js":620};o.keys=function(){return Object.keys(i)},o.resolve=r,e.exports=o,o.id=1004},,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(625),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t){var n=e.call(this,t,null,null)||this;return n.name=t,n}return r(t,e),t.prototype.close=function(){return Promise.resolve()},t.prototype.emptyDatabase=function(){var e=this;return new Promise(function(t,n){e.db.transaction(function(e){e.executeSql("SELECT * FROM sqlite_master\n                            WHERE name NOT LIKE 'sqlite\\_%' escape '\\' AND name NOT LIKE '\\_%' escape '\\'",[],function(e,o){if(o.rows.length<=0)t();else{for(var r=[],i=function(t){r.push(new Promise(function(n,r){var i=JSON.stringify(o.rows.item(t).name);e.executeSql("DROP TABLE "+i,[],n,r)}))},s=0;s<o.rows.length;s++)i(s);Promise.all(r).then(t,n)}},n)})})},t.prototype.execute=function(e,t){var n=this;return new Promise(function(o,r){n.db.transaction(function(n){n.executeSql(e,t,function(e,t){o(t)},function(n,o){console.error(e,t,o),r(o)})})})},t.prototype.executeBatch=function(e){var t=this;return new Promise(function(n,o){t.db.transaction(function(t){var r=[];e.forEach(function(e){r.push(new Promise(function(n,o){var r,i;Array.isArray(e)?(r=e[0],i=e[1]):(r=e,i=null),t.executeSql(r,i,function(e,t){n(t)},function(e,t){console.error(r,i,t),o(t)})}))}),Promise.all(r).then(n,o)})})},t.prototype.init=function(){this.db=window.openDatabase(this.name,"1.0",this.name,524288e3),this.promise=Promise.resolve()},t.prototype.open=function(){return Promise.resolve()},t}(o.a)},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(222),i=n(8),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.domUtils=t,this.fileHelper=n,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.element.addEventListener("click",function(t){if(e.file){t.preventDefault(),t.stopPropagation();var n=e.domUtils.showModalLoading();e.fileHelper.downloadAndOpenFile(e.file,e.component,e.componentId).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.errordownloading",!0)}).finally(function(){n.dismiss()})}})},s([Object(o.D)("core-download-file"),a("design:type",Object)],e.prototype,"file",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"component",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"componentId",void 0),e=s([Object(o.s)({selector:"[core-download-file]"}),a("design:paramtypes",[o.t,i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(1),r=n(154),i=n(9),s=n(306),a=n(12),c=n(27),u=n(7),d=n(118),l=n(8),f=n(11),p=n(22),h=n(47),m=n(6),g=n(30),y=n(72),v=n(109),b=(n.n(v),function(){function e(e,t,n,g,y,v,b,_){this.id=t,this.siteUrl=n,this.token=g,this.infos=y,this.privateToken=v,this.config=b,this.loggedOut=_,this.WS_CACHE_TABLE="wscache",this.tableSchema={name:this.WS_CACHE_TABLE,columns:[{name:"id",type:"TEXT",primaryKey:!0},{name:"data",type:"TEXT"},{name:"key",type:"TEXT"},{name:"expirationTime",type:"INTEGER"}]},this.MOODLE_RELEASES={3.1:2016052300,3.2:2016120500,3.3:2017051503,3.4:2017111300},this.cleanUnicode=!1,this.lastAutoLogin=0,this.offlineDisabled=!1;var P=e.get(u.a);this.appProvider=e.get(i.a),this.dbProvider=e.get(s.a),this.domUtils=e.get(l.a),this.eventsProvider=e.get(a.a),this.fileProvider=e.get(c.a),this.http=e.get(r.b),this.textUtils=e.get(f.a),this.timeUtils=e.get(p.a),this.translate=e.get(o.c),this.utils=e.get(m.a),this.urlUtils=e.get(h.a),this.wsProvider=e.get(d.a),this.logger=P.getInstance("CoreWSProvider"),this.calculateOfflineDisabled(),this.id&&this.initDB()}return e.prototype.initDB=function(){this.db=this.dbProvider.getDB("Site-"+this.id),this.db.createTableFromSchema(this.tableSchema)},e.prototype.getId=function(){return this.id},e.prototype.getURL=function(){return this.siteUrl},e.prototype.getToken=function(){return this.token},e.prototype.getInfo=function(){return this.infos},e.prototype.getPrivateToken=function(){return this.privateToken},e.prototype.getDb=function(){return this.db},e.prototype.getUserId=function(){if(void 0!==this.infos&&void 0!==this.infos.userid)return this.infos.userid},e.prototype.getSiteHomeId=function(){return this.infos&&this.infos.siteid||1},e.prototype.setId=function(e){this.id=e,this.initDB()},e.prototype.setToken=function(e){this.token=e},e.prototype.setPrivateToken=function(e){this.privateToken=e},e.prototype.isLoggedOut=function(){return!!this.loggedOut},e.prototype.setInfo=function(e){this.infos=e},e.prototype.setConfig=function(e){e&&(e.tool_mobile_disabledfeatures=this.textUtils.treatDisabledFeatures(e.tool_mobile_disabledfeatures)),this.config=e,this.calculateOfflineDisabled()},e.prototype.setLoggedOut=function(e){this.loggedOut=!!e},e.prototype.canAccessMyFiles=function(){var e=this.getInfo();return e&&(void 0===e.usercanmanageownfiles||e.usercanmanageownfiles)},e.prototype.canDownloadFiles=function(){var e=this.getInfo();return e&&e.downloadfiles},e.prototype.canUseAdvancedFeature=function(e,t){void 0===t&&(t=!0);var n=this.getInfo(),o=!0;if(void 0===n.advancedfeatures)o=t;else for(var r in n.advancedfeatures){var i=n.advancedfeatures[r];i.name===e&&0===parseInt(i.value,10)&&(o=!1)}return o},e.prototype.canUploadFiles=function(){var e=this.getInfo();return e&&e.uploadfiles},e.prototype.fetchSiteInfo=function(){return this.cleanUnicode=!1,this.read("core_webservice_get_site_info",{},{getFromCache:!1,saveToCache:!1})},e.prototype.read=function(e,t,n){return void 0===(n=n||{}).getFromCache&&(n.getFromCache=!0),void 0===n.saveToCache&&(n.saveToCache=!0),this.request(e,t,n)},e.prototype.write=function(e,t,n){return void 0===(n=n||{}).getFromCache&&(n.getFromCache=!1),void 0===n.saveToCache&&(n.saveToCache=!1),void 0===n.emergencyCache&&(n.emergencyCache=!1),this.request(e,t,n)},e.prototype.request=function(e,t,n,o){var r=this,i=this.token;if(t=t||{},!this.appProvider.isOnline()&&this.offlineDisabled)return Promise.reject(this.wsProvider.createFakeWSError("core.errorofflinedisabled",!0));if(this.getInfo()&&!this.wsAvailable(e,!1)){var s=g.a.WS_PREFIX+e;if(!this.wsAvailable(s,!1))return this.logger.error("WS function '"+e+"' is not available, even in compatibility mode."),Promise.reject(this.utils.createFakeWSError("core.wsfunctionnotavailable",!0));this.logger.info("Using compatibility WS method '"+s+"'"),e=s}var c={wsToken:this.token,siteUrl:this.siteUrl,cleanUnicode:this.cleanUnicode,typeExpected:n.typeExpected,responseExpected:n.responseExpected};c.cleanUnicode&&this.textUtils.hasUnicodeData(t)?this.domUtils.showToast("core.unicodenotsupported",!0,3e3):c.cleanUnicode=!1,this.offlineDisabled&&(n.getFromCache=!1,n.saveToCache=!1,n.emergencyCache=!1),t.moodlewssettingfilter=!1!==n.filter,t.moodlewssettingfileurl=!1!==n.rewriteurls;var u=t;try{t=this.wsProvider.convertValuesToString(t,c.cleanUnicode)}catch(e){return Promise.reject(this.utils.createFakeWSError("core.unicodenotsupportedcleanerror",!0))}return this.getFromCache(e,t,n,!1,u).catch(function(){return r.wsProvider.call(e,t,c).then(function(o){return n.saveToCache&&r.saveToCache(e,t,o,n),r.utils.clone(o)}).catch(function(s){if("invalidtoken"==s.errorcode||"accessexception"==s.errorcode&&s.message.indexOf("Invalid token - token expired")>-1){if(i!==r.token&&!o)return r.request(e,t,n,!0);if(r.appProvider.isSSOAuthenticationOngoing())return r.appProvider.waitForSSOAuthentication().then(function(){return r.request(e,t,n,!0)});r.eventsProvider.trigger(a.a.SESSION_EXPIRED,{},r.id),s.message=r.translate.instant("core.lostconnection")}else{if("userdeleted"===s.errorcode)return r.eventsProvider.trigger(a.a.USER_DELETED,{params:t},r.id),s.message=r.translate.instant("core.userdeleted"),Promise.reject(s);if("forcepasswordchangenotice"===s.errorcode)return r.eventsProvider.trigger(a.a.PASSWORD_CHANGE_FORCED,{},r.id),s.message=r.translate.instant("core.forcepasswordchangenotice"),Promise.reject(s);if("usernotfullysetup"===s.errorcode)return r.eventsProvider.trigger(a.a.USER_NOT_FULLY_SETUP,{},r.id),s.message=r.translate.instant("core.usernotfullysetup"),Promise.reject(s);if("sitepolicynotagreed"===s.errorcode)return r.eventsProvider.trigger(a.a.SITE_POLICY_NOT_AGREED,{},r.id),s.message=r.translate.instant("core.sitepolicynotagreederror"),Promise.reject(s);if("dmlwriteexception"===s.errorcode&&r.textUtils.hasUnicodeData(t))return r.cleanUnicode?(s.message=r.translate.instant("core.unicodenotsupported"),Promise.reject(s)):(r.cleanUnicode=!0,r.request(e,t,n));if(void 0!==n.emergencyCache&&!n.emergencyCache)return r.logger.debug("WS call '"+e+"' failed. Emergency cache is forbidden, rejecting."),Promise.reject(s)}return n.deleteCacheIfWSError&&r.utils.isWebServiceError(s)?(r.deleteFromCache(e,t,n).catch(function(){}),Promise.reject(s)):(r.logger.debug("WS call '"+e+"' failed. Trying to use the emergency cache."),n.omitExpires=!0,n.getFromCache=!0,r.getFromCache(e,t,n,!0,u).catch(function(){return Promise.reject(s)}))})})},e.prototype.wsAvailable=function(e,t){if(void 0===t&&(t=!0),void 0===this.infos)return!1;for(var n=0;n<this.infos.functions.length;n++){if(this.infos.functions[n].name==e)return!0}return!!t&&this.wsAvailable(g.a.WS_PREFIX+e,!1)},e.prototype.getCacheId=function(e,t){return v.Md5.hashAsciiStr(e+":"+this.utils.sortAndStringify(t))},e.prototype.getCacheOldId=function(e,t){return v.Md5.hashAsciiStr(e+":"+JSON.stringify(t))},e.prototype.getFromCache=function(e,t,n,o,r){var i=this;if(!this.db||!n.getFromCache)return Promise.reject(null);var s=this.getCacheId(e,t);return(n.getCacheUsingCacheKey||o&&n.getEmergencyCacheUsingCacheKey?this.db.getRecords(this.WS_CACHE_TABLE,{key:n.cacheKey}).then(function(e){if(!e.length)return i.db.getRecord(i.WS_CACHE_TABLE,{id:s});if(e.length>1)for(var t=0,n=e.length;t<n;t++){var o=e[t];if(o.id==s)return o}return e[0]}):this.db.getRecord(this.WS_CACHE_TABLE,{id:s}).catch(function(){var t=i.getCacheOldId(e,r||{});return i.db.getRecord(i.WS_CACHE_TABLE,{id:t}).then(function(e){return i.db.updateRecords(i.WS_CACHE_TABLE,{id:s},{id:t}),e})})).then(function(e){var t=Date.now();if(n.omitExpires=n.omitExpires||!i.appProvider.isOnline(),!n.omitExpires&&t>e.expirationTime)return i.logger.debug("Cached element found, but it is expired"),Promise.reject(null);if(void 0!==e&&void 0!==e.data){return i.logger.info("Cached element found, id: "+s+" expires in "+(e.expirationTime-t)/1e3+" seconds"),i.textUtils.parseJSON(e.data,{})}return Promise.reject(null)})},e.prototype.saveToCache=function(e,t,n,o){var r=this;if(!this.db)return Promise.reject(null);return(o.uniqueCacheKey?this.deleteFromCache(e,t,o,!0).catch(function(){}):Promise.resolve()).then(function(){var i={id:r.getCacheId(e,t),data:JSON.stringify(n)},s=y.a.cache_expiration_time;return s=isNaN(s)?3e5:s,i.expirationTime=(new Date).getTime()+s,o.cacheKey&&(i.key=o.cacheKey),r.db.insertRecord(r.WS_CACHE_TABLE,i)})},e.prototype.deleteFromCache=function(e,t,n,o){if(!this.db)return Promise.reject(null);var r=this.getCacheId(e,t);return this.db.deleteRecords(this.WS_CACHE_TABLE,o?{key:n.cacheKey}:{id:r})},e.prototype.uploadFile=function(e,t,n){return t.fileArea||(t.fileArea="draft"),this.wsProvider.uploadFile(e,t,{siteUrl:this.siteUrl,wsToken:this.token},n)},e.prototype.invalidateWsCache=function(){return this.db?(this.logger.debug("Invalidate all the cache for site: "+this.id),this.db.updateRecords(this.WS_CACHE_TABLE,{expirationTime:0})):Promise.reject(null)},e.prototype.invalidateWsCacheForKey=function(e){return this.db?e?(this.logger.debug("Invalidate cache for key: "+e),this.db.updateRecords(this.WS_CACHE_TABLE,{expirationTime:0},{key:e})):Promise.resolve():Promise.reject(null)},e.prototype.invalidateMultipleWsCacheForKey=function(e){var t=this;if(!this.db)return Promise.reject(null);if(!e||!e.length)return Promise.resolve();var n=[];return this.logger.debug("Invalidating multiple cache keys"),e.forEach(function(e){n.push(t.invalidateWsCacheForKey(e))}),Promise.all(n)},e.prototype.invalidateWsCacheForKeyStartingWith=function(e){if(!this.db)return Promise.reject(null);if(!e)return Promise.resolve();this.logger.debug("Invalidate cache for key starting with: "+e);return this.db.execute("UPDATE "+this.WS_CACHE_TABLE+" SET expirationTime=0 WHERE key LIKE ?",[e+"%"])},e.prototype.fixPluginfileURL=function(e){return this.urlUtils.fixPluginfileURL(e,this.token,this.siteUrl)},e.prototype.deleteDB=function(){return this.dbProvider.deleteDB("Site-"+this.id)},e.prototype.deleteFolder=function(){if(this.fileProvider.isAvailable()){var e=this.fileProvider.getSiteFolder(this.id);return this.fileProvider.removeDir(e).catch(function(){})}return Promise.resolve()},e.prototype.getSpaceUsage=function(){if(this.fileProvider.isAvailable()){var e=this.fileProvider.getSiteFolder(this.id);return this.fileProvider.getDirectorySize(e).catch(function(){return 0})}return Promise.resolve(0)},e.prototype.getDocsUrl=function(e){return this.urlUtils.getDocsUrl(this.infos.release?this.infos.release:void 0,e)},e.prototype.checkLocalMobilePlugin=function(e){var t=this,n=this.siteUrl+"/local/mobile/check.php",o=y.a.wsextservice;if(!o)return Promise.resolve({code:0});return this.http.post(n,{service:o}).timeout(g.a.WS_TIMEOUT).toPromise().then(function(n){if(void 0!==n&&"requirecorrectaccess"===n.errorcode)return e?Promise.reject(n.error):(t.siteUrl=t.urlUtils.addOrRemoveWWW(t.siteUrl),t.checkLocalMobilePlugin(!0));if(void 0===n||void 0===n.code)return{code:0,warning:"core.login.localmobileunexpectedresponse"};var r=parseInt(n.code,10);if(!n.error)return{code:r,service:o,coreSupported:!!n.coresupported};switch(r){case 1:return Promise.reject(t.translate.instant("core.login.siteinmaintenance"));case 2:return Promise.reject(t.translate.instant("core.login.webservicesnotenabled"));case 3:return{code:0};case 4:return Promise.reject(t.translate.instant("core.login.mobileservicesnotenabled"));default:return Promise.reject(t.translate.instant("core.unexpectederror"))}},function(){return{code:0}})},e.prototype.checkIfAppUsesLocalMobile=function(){var e=!1;return this.infos&&this.infos.functions?(this.infos.functions.forEach(function(t){-1!=t.name.indexOf(g.a.WS_PREFIX)&&(e=!0)}),e):e},e.prototype.checkIfLocalMobileInstalledAndNotUsed=function(){return this.checkIfAppUsesLocalMobile()?Promise.reject(null):this.checkLocalMobilePlugin().then(function(e){return void 0===e.service?Promise.reject(null):e})},e.prototype.containsUrl=function(e){if(!e)return!1;var t=this.urlUtils.removeProtocolAndWWW(this.siteUrl);return 0==(e=this.urlUtils.removeProtocolAndWWW(e)).indexOf(t)},e.prototype.getPublicConfig=function(){var e=this;return this.wsProvider.callAjax("tool_mobile_get_public_config",{},{siteUrl:this.siteUrl}).then(function(t){return t.httpswwwroot&&(e.siteUrl=t.httpswwwroot),t})},e.prototype.openInBrowserWithAutoLogin=function(e,t){return this.openWithAutoLogin(!1,e,void 0,t)},e.prototype.openInBrowserWithAutoLoginIfSameSite=function(e,t){return this.openWithAutoLoginIfSameSite(!1,e,void 0,t)},e.prototype.openInAppWithAutoLogin=function(e,t,n){return this.openWithAutoLogin(!0,e,t,n)},e.prototype.openInAppWithAutoLoginIfSameSite=function(e,t,n){return this.openWithAutoLoginIfSameSite(!0,e,t,n)},e.prototype.openWithAutoLogin=function(e,t,n,o){var r=this,i=function(t){return new Promise(function(i,s){c&&c.dismiss(),o?r.domUtils.showAlert(r.translate.instant("core.notice"),o,void 0,3e3).then(function(o){o.onDidDismiss(function(){i(e?r.utils.openInApp(t,n):r.utils.openInBrowser(t))})}):i(e?r.utils.openInApp(t,n):r.utils.openInBrowser(t))})};if(!this.privateToken||!this.wsAvailable("tool_mobile_get_autologin_key")||this.lastAutoLogin&&this.timeUtils.timestamp()-this.lastAutoLogin<6*g.a.SECONDS_MINUTE)return Promise.resolve(i(t));var s=this.getUserId(),a={privatetoken:this.privateToken},c=this.domUtils.showModalLoading();return this.write("tool_mobile_get_autologin_key",a).then(function(e){return e.autologinurl&&e.key?(r.lastAutoLogin=r.timeUtils.timestamp(),i(e.autologinurl+"?userid="+s+"&key="+e.key+"&urltogo="+t)):i(t)}).catch(function(){return i(t)})},e.prototype.openWithAutoLoginIfSameSite=function(e,t,n,o){return this.containsUrl(t)?this.openWithAutoLogin(e,t,n,o):(e?this.utils.openInApp(t,n):this.utils.openInBrowser(t),Promise.resolve(null))},e.prototype.getConfig=function(e,t){var n={cacheKey:this.getConfigCacheKey()};return t&&(n.getFromCache=!1,n.emergencyCache=!1),this.read("tool_mobile_get_config",{},n).then(function(t){if(e){for(var n in t.settings)if(t.settings[n].name==e)return t.settings[n].value;return Promise.reject(null)}var o={};return t.settings.forEach(function(e){o[e.name]=e.value}),o})},e.prototype.invalidateConfig=function(){return this.invalidateWsCacheForKey(this.getConfigCacheKey())},e.prototype.getConfigCacheKey=function(){return"tool_mobile_get_config"},e.prototype.getStoredConfig=function(e){if(this.config)return e?this.config[e]:this.config},e.prototype.isFeatureDisabled=function(e){var t=this.getStoredConfig("tool_mobile_disabledfeatures");if(!t)return!1;var n=new RegExp("(,|^)"+this.textUtils.escapeForRegex(e)+"(,|$)","g");return!!t.match(n)},e.prototype.calculateOfflineDisabled=function(){this.offlineDisabled=this.isFeatureDisabled("NoDelegate_CoreOffline")},e.prototype.isOfflineDisabled=function(){return this.offlineDisabled},e.prototype.isVersionGreaterEqualThan=function(e){var t=parseInt(this.getInfo().version,10);if(Array.isArray(e)){if(!e.length)return!1;for(var n=0;n<e.length;n++){var o=this.getVersionNumber(e[n]);if(n==e.length-1)return t>=o;if(t>=o&&t<this.getNextMajorVersionNumber(e[n]))return!0}}else if("string"==typeof e)return t>=this.getVersionNumber(e);return!1},e.prototype.getVersionNumber=function(e){var t=this.getMajorAndMinor(e);return t?(void 0===this.MOODLE_RELEASES[t.major]&&(t.major=Object.keys(this.MOODLE_RELEASES).slice(-1)),this.MOODLE_RELEASES[t.major]+t.minor):0},e.prototype.getMajorAndMinor=function(e){var t=e.match(/(\d)+(?:\.(\d)+)?(?:\.(\d)+)?/);return!(!t||!t[1])&&{major:t[1]+"."+(t[2]||"0"),minor:parseInt(t[3],10)||0}},e.prototype.getNextMajorVersionNumber=function(e){var t,n=this.getMajorAndMinor(e),o=Object.keys(this.MOODLE_RELEASES);return n?-1==(t=o.indexOf(n.major))||t==o.length-1?this.MOODLE_RELEASES[o[t]]:this.MOODLE_RELEASES[o[t+1]]:0},e}())},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(4),i=n(1),s=n(9),a=n(18),c=n(7),u=n(2),d=n(8),l=n(11),f=n(47),p=n(6),h=n(714),m=n(713),g=n(32),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},_=function(){function e(e,t,n,r,i,s,a,c,u,d,l,f,p,h){this.sitesProvider=t,this.domUtils=n,this.textUtils=r,this.translate=i,this.platform=s,this.utils=a,this.urlUtils=c,this.loggerProvider=u,this.filepoolProvider=d,this.appProvider=l,this.contentLinksHelper=f,this.navCtrl=p,this.content=h,this.adaptImg=!0,this.tagsToIgnore=["AUDIO","VIDEO","BUTTON","INPUT","SELECT","TEXTAREA","A"],this.element=e.nativeElement,this.element.classList.add("opacity-hide"),this.afterRender=new o.v}return e.prototype.ngOnChanges=function(e){e.text&&this.formatAndRenderContents()},e.prototype.addExternalContent=function(e){var t=new m.a(e,this.loggerProvider,this.filepoolProvider,this.platform,this.sitesProvider,this.domUtils,this.urlUtils,this.appProvider);t.component=this.component,t.componentId=this.componentId,t.siteId=this.siteId,t.ngAfterViewInit()},e.prototype.addMediaAdaptClass=function(e){e.classList.add("core-media-adapt-width")},e.prototype.adaptImage=function(e,t){var n=this.getElementWidth(t),o=document.createElement("span");o.classList.add("core-adapted-img-container"),o.style.cssFloat=t.style.cssFloat,t.classList.contains("atto_image_button_right")?o.classList.add("atto_image_button_right"):t.classList.contains("atto_image_button_left")&&o.classList.add("atto_image_button_left"),this.domUtils.wrapElement(t,o),n>e&&this.addMagnifyingGlass(o,t)},e.prototype.addMagnifyingGlass=function(e,t){var n=this,o=this.textUtils.escapeHTML(t.getAttribute("src")),r=this.textUtils.escapeHTML(this.translate.instant("core.openfullimage")),i=document.createElement("a");i.classList.add("core-image-viewer-icon"),i.setAttribute("aria-label",r),i.innerHTML='<ion-icon name="search" class="icon icon-md ion-md-search"></ion-icon>',i.addEventListener("click",function(e){e.preventDefault(),e.stopPropagation(),n.domUtils.viewImage(o,t.getAttribute("alt"),n.component,n.componentId)}),e.appendChild(i)},e.prototype.calculateHeight=function(){var e=this.element.style.maxHeight?0:this.getElementHeight(this.element);!e||e>this.maxHeight?this.clickListener||this.displayShowMore():this.clickListener&&this.hideShowMore()},e.prototype.displayShowMore=function(){var e=this.utils.isTrueOrOne(this.fullOnClick)||!1,t=document.createElement("div");t.classList.add("core-show-more"),t.innerHTML=this.translate.instant("core.showmore"),this.element.appendChild(t),e&&this.element.classList.add("core-expand-in-fullview"),this.element.classList.add("core-text-formatted"),this.element.classList.add("core-shortened"),this.element.style.maxHeight=this.maxHeight+"px",this.clickListener=this.elementClicked.bind(this,e),this.element.addEventListener("click",this.clickListener)},e.prototype.elementClicked=function(e,t){if(!t.defaultPrevented){t.preventDefault(),t.stopPropagation();var n=t.target;-1!==this.tagsToIgnore.indexOf(n.tagName)&&("A"!==n.tagName||n.getAttribute("href"))||e?this.textUtils.expandText(this.fullTitle||this.translate.instant("core.description"),this.text,this.component,this.componentId):this.element.classList.toggle("core-shortened")}},e.prototype.finishRender=function(){this.element.classList.remove("opacity-hide"),this.afterRender.emit()},e.prototype.formatAndRenderContents=function(){var e=this;if(!this.text)return this.element.innerHTML="",void this.finishRender();this.text=this.text?this.text.trim():"",this.formatContents().then(function(t){e.element.classList.add("core-disable-media-adapt"),e.element.innerHTML="",e.maxHeight&&""!=t.innerHTML?(e.domUtils.moveChildren(t,e.element),e.calculateHeight(),e.waitForImages().then(function(t){t&&e.calculateHeight()})):e.domUtils.moveChildren(t,e.element),e.element.classList.remove("core-disable-media-adapt"),e.finishRender()})},e.prototype.formatContents=function(){var e,t=this;return this.sitesProvider.getSite(this.siteId).catch(function(){}).then(function(n){return e=n,t.textUtils.formatText(t.text,t.utils.isTrueOrOne(t.clean),t.utils.isTrueOrOne(t.singleLine))}).then(function(n){var o,r,i,s,a,c,u=document.createElement("div"),d=e&&e.isVersionGreaterEqualThan(["3.3.4","3.4"]);if(u.innerHTML=n,o=Array.from(u.querySelectorAll("img")),r=Array.from(u.querySelectorAll("a")),i=Array.from(u.querySelectorAll("audio")),s=Array.from(u.querySelectorAll("video")),a=Array.from(u.querySelectorAll("iframe")),c=Array.from(u.querySelectorAll(".button")),r.forEach(function(e){var n=new h.a(e,t.domUtils,t.utils,t.sitesProvider,t.urlUtils,t.contentLinksHelper,t.navCtrl,t.content);n.capture=!0,n.ngOnInit(),t.addExternalContent(e)}),o&&o.length>0){var l=t.getElementWidth(t.element)||100;o.forEach(function(e){t.addMediaAdaptClass(e),t.addExternalContent(e),t.utils.isTrueOrOne(t.adaptImg)&&t.adaptImage(l,e)})}return i.forEach(function(e){t.treatMedia(e)}),s.forEach(function(e){t.treatVideoFilters(e),t.treatMedia(e)}),a.forEach(function(n){t.treatIframe(n,e,d)}),c.forEach(function(e){e.querySelector("a")&&e.classList.add("core-button-with-inner-link")}),u})},e.prototype.getElementWidth=function(e){var t=this.domUtils.getElementWidth(e);if(!t){var n=this.domUtils.getElementWidth(e.parentNode,!0,!1,!1,!0),o=getComputedStyle(e,null).display;e.style.display="inline-block",t=this.domUtils.getElementWidth(e),n>0&&(!t||t>n)&&(t=n),e.style.display=o}return t},e.prototype.getElementHeight=function(e){return this.domUtils.getElementHeight(e)||0},e.prototype.hideShowMore=function(){var e=this.element.querySelector("div.core-show-more");e&&e.remove(),this.element.classList.remove("core-expand-in-fullview"),this.element.classList.remove("core-text-formatted"),this.element.classList.remove("core-shortened"),this.element.style.maxHeight=null,this.element.removeEventListener("click",this.clickListener),this.clickListener=null},e.prototype.treatVideoFilters=function(e){if(e.classList.contains("video-js")){var t=this.textUtils.parseJSON(e.getAttribute("data-setup")||e.getAttribute("data-setup-lazy")||"{}"),n=t.techOrder&&t.techOrder[0]&&"youtube"==t.techOrder[0]&&t.sources&&t.sources[0]&&t.sources[0].src&&this.youtubeGetId(t.sources[0].src);if(n){var o=document.createElement("iframe");o.id=e.id,o.src="https://www.youtube.com/embed/"+n,o.setAttribute("frameborder","0"),o.width="100%",o.height="300",e.parentNode.replaceChild(o,e)}}},e.prototype.treatMedia=function(e){var t=this;this.addMediaAdaptClass(e),this.addExternalContent(e);var n=Array.from(e.querySelectorAll("source")),o=Array.from(e.querySelectorAll("track"));n.forEach(function(e){e.setAttribute("target-src",e.getAttribute("src")),e.removeAttribute("src"),t.addExternalContent(e)}),o.forEach(function(e){t.addExternalContent(e)})},e.prototype.treatIframe=function(e,t,n){if(this.addMediaAdaptClass(e),e.src&&n){var o=e.src.match(/https?:\/\/player\.vimeo\.com\/video\/([0-9]+)/);if(o&&o[1]){var r=this.textUtils.concatenatePaths(t.getURL(),"/media/player/vimeo/wsplayer.php?video=")+o[1]+"&token="+t.getToken(),i=void 0,s=void 0;e.width?i=e.width:(i=this.getElementWidth(e))||(i=window.innerWidth),e.height?s=e.height:(s=this.getElementHeight(e))||(s=i),e.src=r+"&width="+i+"&height="+s,e.width||(e.width=i),e.height||(e.height=s),e.parentElement.classList.contains("embed-responsive")&&e.addEventListener("load",function(){var t=document.createElement("style");t.setAttribute("type","text/css"),t.innerHTML="iframe {width: 100%;height: 100%;}",e.contentDocument.head.appendChild(t)})}}},e.prototype.waitForImages=function(){var e=[],t=!1;return Array.from(this.element.querySelectorAll("img")).forEach(function(n){n&&!n.complete&&(t=!0,e.push(new Promise(function(e,t){var o=function(){e(),n.removeEventListener("loaded",o),n.removeEventListener("error",o)};n.addEventListener("load",o),n.addEventListener("error",o)})))}),Promise.all(e).then(function(){return t})},e.prototype.youtubeGetId=function(e){var t=e.match(/^.*(?:(?:youtu.be\/)|(?:v\/)|(?:\/u\/\w\/)|(?:embed\/)|(?:watch\?))\??v?=?([^#\&\?]*).*/);return t&&11==t[1].length?t[1]:""},y([Object(o.D)(),v("design:type",String)],e.prototype,"text",void 0),y([Object(o.D)(),v("design:type",String)],e.prototype,"siteId",void 0),y([Object(o.D)(),v("design:type",String)],e.prototype,"component",void 0),y([Object(o.D)(),v("design:type",Object)],e.prototype,"componentId",void 0),y([Object(o.D)(),v("design:type",Object)],e.prototype,"adaptImg",void 0),y([Object(o.D)(),v("design:type",Object)],e.prototype,"clean",void 0),y([Object(o.D)(),v("design:type",Object)],e.prototype,"singleLine",void 0),y([Object(o.D)(),v("design:type",Number)],e.prototype,"maxHeight",void 0),y([Object(o.D)(),v("design:type",Object)],e.prototype,"fullOnClick",void 0),y([Object(o.D)(),v("design:type",String)],e.prototype,"fullTitle",void 0),y([Object(o.O)(),v("design:type",o.v)],e.prototype,"afterRender",void 0),e=y([Object(o.s)({selector:"core-format-text"}),b(12,Object(o.N)()),b(13,Object(o.N)()),v("design:paramtypes",[o.t,u.a,d.a,l.a,i.c,r.s,p.a,f.a,c.a,a.a,s.a,g.a,r.q,r.f])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(8),i=n(6),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.domUtils=t,this.utils=n,this.lastFocusOut=0,this.element=e.nativeElement}return e.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){var t,n,o=e.utils.isTrueOrOne(e.inButton);if("string"==typeof e.selector&&e.selector&&(t=document.querySelectorAll(e.selector),n=t[t.length-1])){if(o)e.button=e.element,e.input=n;else if(e.button=n,e.input="ION-INPUT"==e.element.tagName?e.element.querySelector("input"):"ION-TEXTAREA"==e.element.tagName?e.element.querySelector("textarea"):e.element,!e.input)return;e.focusOutListener=e.focusOut.bind(e),e.input.addEventListener("focusout",e.focusOutListener),e.clickListener=e.buttonClicked.bind(e),e.button.addEventListener("click",e.clickListener)}})},e.prototype.ngOnDestroy=function(){this.button&&this.clickListener&&this.button.removeEventListener("click",this.clickListener),this.input&&this.focusOutListener&&this.input.removeEventListener("focusout",this.focusOutListener)},e.prototype.buttonClicked=function(){document.activeElement==this.input?(this.focusAgainListener=this.focusElementAgain.bind(this),this.input.addEventListener("focusout",this.focusAgainListener)):document.activeElement==this.button&&Date.now()-this.lastFocusOut<200&&setTimeout(this.focusElementAgain.bind(this),0)},e.prototype.focusElementAgain=function(){var e=this;if(this.domUtils.focusElement(this.input),this.focusAgainListener){var t=this.focusAgainListener;clearTimeout(this.stopFocusAgainTimeout),this.stopFocusAgainTimeout=setTimeout(function(){e.input.removeEventListener("focusout",t),t==e.focusAgainListener&&delete e.focusAgainListener},1e3)}},e.prototype.focusOut=function(){this.lastFocusOut=Date.now()},s([Object(o.D)("core-keep-keyboard"),a("design:type",String)],e.prototype,"selector",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"inButton",void 0),e=s([Object(o.s)({selector:"[core-keep-keyboard]"}),a("design:paramtypes",[o.t,r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},c=function(){function e(e,t){this.navCtrl=t,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.element.addEventListener("click",function(t){t.defaultPrevented||(t.preventDefault(),t.stopPropagation(),e.navCtrl.push("CoreUserProfilePage",{userId:e.userId,courseId:e.courseId}))})},i([Object(o.D)(),s("design:type",Number)],e.prototype,"userId",void 0),i([Object(o.D)(),s("design:type",Number)],e.prototype,"courseId",void 0),e=i([Object(o.s)({selector:"[core-user-link]"}),a(1,Object(o.N)()),s("design:paramtypes",[o.t,r.q])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.element=e,this.height=0,this.onResize=new o.v}return e.prototype.onInput=function(){this.resize()},e.prototype.onChange=function(){var e=this;setTimeout(function(){e.resize()},300)},e.prototype.ngAfterViewInit=function(){var e=this;setTimeout(function(){e.resize()},300)},e.prototype.resize=function(e){var t=this.element.nativeElement;"ION-TEXTAREA"==t.tagName&&(t=t.firstElementChild),t.style.height="1px",t.style.height=t.scrollHeight+"px",this.height!=t.scrollHeight&&(this.height=t.scrollHeight,this.onResize.emit())},r([Object(o.O)(),i("design:type",o.v)],e.prototype,"onResize",void 0),r([Object(o.y)("input"),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"onInput",null),r([Object(o.y)("change"),i("design:type",Function),i("design:paramtypes",[]),i("design:returntype",void 0)],e.prototype,"onChange",null),e=r([Object(o.s)({selector:"textarea[core-auto-rows], ion-textarea[core-auto-rows]"}),i("design:paramtypes",[o.t])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(715),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.longPress=new o.v,this.el=e.nativeElement,this.el.setAttribute("tappable","")}return e.prototype.ngOnInit=function(){var e=this;this.pressGesture=new r.a(this.el),this.pressGesture.listen(),this.pressGesture.on("press",function(t){e.longPress.emit(t)})},e.prototype.ngOnDestroy=function(){this.pressGesture.destroy()},i([Object(o.O)(),s("design:type",Object)],e.prototype,"longPress",void 0),e=i([Object(o.s)({selector:"[longPress]"}),s("design:paramtypes",[o.t])],e)}()},,function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(1284),i=(n.n(r),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.labels=[],this.element=e}return t=e,e.prototype.ngOnInit=function(){var e={};e=void 0===this.legend?{display:!0,position:"bottom",labels:{generateLabels:function(e){var t=e.data;if(t.labels.length&&t.labels.length){var n=t.datasets[0];return t.labels.map(function(e,t){return{text:e+": "+n.data[t],fillStyle:n.backgroundColor[t]}})}return[]}}}:Object.assign({},this.legend),"bar"==this.type&&this.data.length>=5&&(this.type="horizontalBar");var t=this.element.nativeElement.getContext("2d");this.chart=new r.Chart(t,{type:this.type,data:{labels:this.labels,datasets:[{data:this.data,backgroundColor:this.getRandomColors(this.data.length)}]},options:{legend:e}})},e.prototype.ngOnChanges=function(){this.chart&&(this.chart.data.datasets[0]={data:this.data,backgroundColor:this.getRandomColors(this.data.length)},this.chart.data.labels=this.labels,this.chart.update())},e.prototype.getRandomColors=function(e){for(;t.backgroundColors.length<e;){var n=Math.floor(255*Math.random()),o=Math.floor(255*Math.random()),r=Math.floor(255*Math.random());t.backgroundColors.push("rgba("+n+", "+o+", "+r+", 0.6)")}return t.backgroundColors.slice(0,e)},e.prototype.ngOnDestroy=function(){this.chart&&(this.chart.destroy(),this.chart=!1)},e.backgroundColors=["rgba(0,100,210, 0.6)","rgba(203,61,77, 0.6)","rgba(0,121,130, 0.6)","rgba(249,128,18, 0.6)","rgba(94,129,0, 0.6)","rgba(251,173,26, 0.6)"],i([Object(o.D)(),s("design:type",Array)],e.prototype,"data",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"labels",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"type",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"legend",void 0),e=t=i([Object(o.s)({selector:"canvas[core-chart]"}),s("design:paramtypes",[o.t])],e);var t}()},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(11),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.textUtils=t,this.logger=e.getInstance("CoreBytesToSizePipe")}return e.prototype.transform=function(e){if("string"==typeof e){var t=parseInt(e,10);if(isNaN(t))return this.logger.error("Invalid value received",e),e;e=t}return this.textUtils.bytesToSize(e)},e=s([Object(o.S)({name:"coreBytesToSize"}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.replacePattern=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])(?![^<]*>|[^<>]*<\/)/gim}return e.prototype.transform=function(e){return e.replace(this.replacePattern,'<a href="$1">$1</a>')},e=r([Object(o.S)({name:"coreCreateLinks"})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(7),s=n(5),a=(n.n(s),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.translate=t,this.logger=e.getInstance("CoreDateDayOrTimePipe")}return e.prototype.transform=function(e){if("string"==typeof e){var t=parseInt(e,10);if(isNaN(t))return this.logger.error("Invalid value received",e),e;e=t}return s(1e3*e).calendar(null,{sameDay:"LT",lastDay:this.translate.instant("core.dflastweekdate"),lastWeek:this.translate.instant("core.dflastweekdate"),sameElse:"L"})},e=a([Object(o.S)({name:"coreDateDayOrTime"}),c("design:paramtypes",[i.a,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(22),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.timeUtils=t,this.logger=e.getInstance("CoreBytesToSizePipe")}return e.prototype.transform=function(e){if("string"==typeof e){var t=parseInt(e,10);if(isNaN(t))return this.logger.error("Invalid value received",e),e;e=t}return this.timeUtils.formatTime(e)},e=s([Object(o.S)({name:"coreDuration"}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(7),s=n(5),a=(n.n(s),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.translate=t,this.logger=e.getInstance("CoreDateDayOrTimePipe")}return e.prototype.transform=function(e,t){if("string"==typeof(e=e||Date.now())){var n=parseInt(e,10);if(isNaN(n))return this.logger.error("Invalid value received",e),e;e=n}return 0==t.indexOf("df")?t=this.translate.instant("core."+t):t.indexOf(".")>0&&(t=this.translate.instant(t)),s(e).format(t)},e=a([Object(o.S)({name:"coreFormatDate"}),c("design:paramtypes",[i.a,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){}return e.prototype.transform=function(e){return e.replace(/(<([^>]+)>)/gi,"")},e=r([Object(o.S)({name:"coreNoTags"})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(7),i=n(11),s=n(30),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.textUtils=t,this.logger=e.getInstance("CoreSecondsToHMSPipe")}return e.prototype.transform=function(e){var t,n;if(!e||e<0)e=0;else if("string"==typeof e){var o=parseInt(e,10);if(isNaN(o))return this.logger.error("Invalid value received",e),e;e=o}return e=Math.floor(e),t=Math.floor(e/s.a.SECONDS_HOUR),e-=t*s.a.SECONDS_HOUR,n=Math.floor(e/s.a.SECONDS_MINUTE),e-=n*s.a.SECONDS_MINUTE,this.textUtils.twoDigits(t)+":"+this.textUtils.twoDigits(n)+":"+this.textUtils.twoDigits(e)},e=a([Object(o.S)({name:"coreSecondsToHMS"}),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(7),i=n(5),s=(n.n(i),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.logger=e.getInstance("CoreTimeAgoPipe")}return e.prototype.transform=function(e){if("string"==typeof e){var t=parseInt(e,10);if(isNaN(t))return this.logger.error("Invalid value received",e),e;e=t}return i(1e3*e).fromNow(!0)},e=s([Object(o.S)({name:"coreTimeAgo"}),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(7),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.logger=e.getInstance("CoreToLocaleStringPipe")}return e.prototype.transform=function(e){if("string"==typeof e){var t=parseInt(e,10);if(isNaN(t))return this.logger.error("Invalid value received",e),e;e=t}return e<0?"":(e<1e11&&(e*=1e3),new Date(e).toLocaleString())},e=i([Object(o.S)({name:"coreToLocaleString"}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(944),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.translate=e,this.element=t.nativeElement}return e.prototype.ngOnInit=function(){this.message||(this.message=this.translate.instant("core.loading"))},e.prototype.ngOnChanges=function(e){var t=this;!0===e.hideUntil.currentValue&&setTimeout(function(){t.element.classList.add("core-loading-loaded"),setTimeout(function(){t.content.nativeElement.classList.add("core-loading-content")},500)})},s([Object(o.D)(),a("design:type",Boolean)],e.prototype,"hideUntil",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"message",void 0),s([Object(o._9)("content"),a("design:type",o.t)],e.prototype,"content",void 0),e=s([Object(o.m)({selector:"core-loading",template:'<div [@coreShowHideAnimation] class="core-loading-container" *ngIf="!hideUntil">\n    <span class="core-loading-spinner">\n        <ion-spinner></ion-spinner>\n        <p class="core-loading-message" *ngIf="message">{{message}}</p>\n    </span>\n</div>\n<div #content>\n    <ng-content [@coreShowHideAnimation] *ngIf="hideUntil">\n    </ng-content>\n</div>',animations:[i.a]}),a("design:paramtypes",[r.c,o.t])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(11),s=n(6),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n,o){this.translate=t,this.textUtils=n,this.utils=o,this.coreMarkRequired=!0,this.element=e.nativeElement,this.requiredLabel=this.translate.instant("core.required")}return e.prototype.ngOnInit=function(){this.coreMarkRequired=this.utils.isTrueOrOne(this.coreMarkRequired)},e.prototype.ngAfterViewInit=function(){if(this.coreMarkRequired){(e=this.element.getAttribute("aria-label")||this.textUtils.cleanTags(this.element.innerHTML,!0))&&this.element.setAttribute("aria-label",e+" "+this.requiredLabel)}else{var e;(e=this.element.getAttribute("aria-label"))&&this.element.setAttribute("aria-label",e.replace(" "+this.requiredLabel,""))}},a([Object(o.D)("core-mark-required"),c("design:type",Object)],e.prototype,"coreMarkRequired",void 0),e=a([Object(o.m)({selector:"[core-mark-required]",template:'<ng-content></ng-content>\n<ion-icon *ngIf="coreMarkRequired" class="core-input-required-asterisk" name="medical" md="ios-medical" [title]="requiredLabel"></ion-icon> \x3c!-- Use iOS icon because it\'s more narrow, so it looks better since it\'s small. --\x3e\n'}),c("design:paramtypes",[o.t,r.c,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(20),i=n(1),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e}return e.prototype.ngOnInit=function(){this.formControl&&(this.initErrorMessages(),this.errorKeys=Object.keys(this.errorMessages))},e.prototype.initErrorMessages=function(){this.errorMessages=this.errorMessages||{},this.errorMessages.required=this.errorMessages.required||this.translate.instant("core.required"),this.errorMessages.email=this.errorMessages.email||this.translate.instant("core.login.invalidemail"),this.errorMessages.date=this.errorMessages.date||this.translate.instant("core.login.invaliddate"),this.errorMessages.datetime=this.errorMessages.datetime||this.translate.instant("core.login.invaliddate"),this.errorMessages.datetimelocal=this.errorMessages.datetimelocal||this.translate.instant("core.login.invaliddate"),this.errorMessages.time=this.errorMessages.time||this.translate.instant("core.login.invalidtime"),this.errorMessages.url=this.errorMessages.url||this.translate.instant("core.login.invalidurl"),this.errorMessages.max=this.errorMessages.max||"",this.errorMessages.min=this.errorMessages.min||""},e.prototype.ngOnChanges=function(e){e.errorText&&(this.errorText=e.errorText.currentValue)},s([Object(o.D)("control"),a("design:type",r.b)],e.prototype,"formControl",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"errorMessages",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"errorText",void 0),e=s([Object(o.m)({selector:"core-input-errors",template:'<div class="core-input-error-container" role="alert" *ngIf="(formControl && formControl.dirty && !formControl.valid) || errorText">\n    <ng-container *ngIf="formControl && formControl.dirty && !formControl.valid">\n        <ng-container *ngFor="let error of errorKeys">\n            <div *ngIf="formControl.hasError(error)" class="core-input-error">\n                <span *ngIf="errorMessages[error]">{{errorMessages[error]}}</span>\n                <span *ngIf="!errorMessages[error] && error == \'max\' && formControl.errors.max">\n                    {{ \'core.login.invalidvaluemax\' | translate:{$a: formControl.errors.max.max} }}\n                </span>\n                <span *ngIf="!errorMessages[error] && error == \'min\' && formControl.errors.min">\n                    {{ \'core.login.invalidvaluemin\' | translate:{$a: formControl.errors.min.min} }}\n                </span>\n            </div>\n        </ng-container>\n    </ng-container>\n    <div *ngIf="errorText" class="core-input-error">{{ errorText }}</div>\n</div>'}),a("design:paramtypes",[i.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(6),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e,t){this.utils=t,this.selector="",this.element=e.nativeElement}return e.prototype.ngOnInit=function(){this.shown=this.utils.isTrueOrOne(this.initialShown),this.selector='input[name="'+this.name+'"]',this.setData()},e.prototype.ngAfterViewInit=function(){this.searchInput()},e.prototype.searchInput=function(){this.input=this.element.querySelector(this.selector),this.input&&(this.input.type=this.shown?"text":"password",this.input.getAttribute("autocorrect")||this.input.setAttribute("autocorrect","off"),this.input.getAttribute("autocapitalize")||this.input.setAttribute("autocapitalize","none"))},e.prototype.setData=function(){this.label=this.shown?"core.hide":"core.show",this.iconName=this.shown?"eye-off":"eye",this.input&&(this.input.type=this.shown?"text":"password")},e.prototype.toggle=function(){this.shown=!this.shown,this.setData()},i([Object(o.D)(),s("design:type",String)],e.prototype,"name",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"initialShown",void 0),e=i([Object(o.m)({selector:"core-show-password",template:'<ng-content></ng-content>\n<a ion-button icon-only clear [attr.aria-label]="label | translate" (click)="toggle()" [core-keep-keyboard]="selector" [inButton]="true">\n    <core-icon [name]="iconName"></core-icon>\n</a>\n'}),s("design:paramtypes",[o.t,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(82),i=n(4),s=n(27),a=n(7),c=n(2),u=n(8),d=n(11),l=n(47),f=n(6),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,r,i,s,a,c,u){this.fileProvider=t,this.urlUtils=n,this.textUtils=r,this.utils=i,this.domUtils=s,this.sitesProvider=a,this.platform=c,this.sanitizer=u,this.loaded=new o.v,this.tags=["iframe","frame","object","embed"],this.IFRAME_TIMEOUT=15e3,this.logger=e.getInstance("CoreIframe"),this.loaded=new o.v}return e.prototype.ngOnInit=function(){var e=this,t=this.iframe&&this.iframe.nativeElement;this.iframeWidth=this.domUtils.formatPixelsSize(this.iframeWidth)||"100%",this.iframeHeight=this.domUtils.formatPixelsSize(this.iframeHeight)||"100%",this.loading=!this.src||!!this.src.match(/^https?:\/\//i),this.treatFrame(t),this.loading&&(t.addEventListener("load",function(){e.loading=!1,e.loaded.emit(t)}),t.addEventListener("error",function(){e.loading=!1,e.domUtils.showErrorModal("core.errorloadingcontent",!0)}),setTimeout(function(){e.loading=!1},this.IFRAME_TIMEOUT))},e.prototype.ngOnChanges=function(e){e.src&&(this.safeUrl=this.sanitizer.bypassSecurityTrustResourceUrl(e.src.currentValue))},e.prototype.getContentWindowAndDocument=function(e){var t=e.contentWindow,n=e.contentDocument||t&&t.document;return!t&&n&&(t=n.defaultView),!t&&e.getSVGDocument&&((n=e.getSVGDocument())&&n.defaultView?t=n.defaultView:e.window?t=e.window:e.getWindow&&(t=e.getWindow())),{window:t,document:n}},e.prototype.treatFrame=function(e){var t=this;if(e){var n=this.getContentWindowAndDocument(e);this.redefineWindowOpen(e,n.window,n.document),this.treatLinks(e,n.document),e.addEventListener("load",function(){n=t.getContentWindowAndDocument(e),t.redefineWindowOpen(e,n.window,n.document),t.treatLinks(e,n.document),n.window&&setTimeout(function(){n.window.dispatchEvent(new Event("resize"))},1e3)})}},e.prototype.redefineWindowOpen=function(e,t,n){var o=this;t&&(t.open=function(t){if(!o.urlUtils.getUrlScheme(t)){var n=e.src||e.data;if(!n)return o.logger.warn("Cannot get iframe src to open relative url",t,e),new Window;var r=o.fileProvider.getFileAndDirectoryFromPath(n);if(!r.directory)return o.logger.warn("Cannot get iframe dir path to open relative url",t,e),new Window;t=o.textUtils.concatenatePaths(r.directory,t)}return 0===t.indexOf("cdvfile://")||0===t.indexOf("file://")?o.utils.openFile(t).catch(function(e){o.domUtils.showErrorModal(e)}):o.sitesProvider.isLoggedIn()?o.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(t):o.utils.openInBrowser(t),new Window}),n&&this.tags.forEach(function(e){Array.from(n.querySelectorAll(e)).forEach(function(e){o.treatFrame(e)})})},e.prototype.treatLinks=function(e,t){var n=this;if(t){Array.from(t.querySelectorAll("a")).forEach(function(t){var o=t.href;if(o){var r=n.urlUtils.getUrlScheme(o);if(r&&"javascript"==r)return;r&&"file"!=r&&"filesystem"!=r?t.addEventListener("click",function(e){e.defaultPrevented||(e.preventDefault(),n.sitesProvider.isLoggedIn()?n.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(o):n.utils.openInBrowser(o))}):"_parent"==t.target||"_top"==t.target||"_blank"==t.target?t.addEventListener("click",function(e){e.defaultPrevented||(e.preventDefault(),n.utils.openFile(o).catch(function(e){n.domUtils.showErrorModal(e)}))}):!n.platform.is("ios")||t.target&&"_self"!=t.target||t.addEventListener("click",function(t){t.defaultPrevented||("object"==e.tagName.toLowerCase()?(t.preventDefault(),e.attr("data",o)):(t.preventDefault(),e.attr("src",o)))})}})}},p([Object(o._9)("iframe"),h("design:type",o.t)],e.prototype,"iframe",void 0),p([Object(o.D)(),h("design:type",String)],e.prototype,"src",void 0),p([Object(o.D)(),h("design:type",String)],e.prototype,"iframeWidth",void 0),p([Object(o.D)(),h("design:type",String)],e.prototype,"iframeHeight",void 0),p([Object(o.O)(),h("design:type",o.v)],e.prototype,"loaded",void 0),e=p([Object(o.m)({selector:"core-iframe",template:'<div [class.core-loading-container]="loading">\n    <iframe #iframe [hidden]="loading" class="core-iframe" [ngStyle]="{\'width\': iframeWidth, \'height\': iframeHeight}" [src]="safeUrl"></iframe>\n    <span class="core-loading-spinner">\n        <ion-spinner *ngIf="loading"></ion-spinner>\n    </span>\n</div>'}),h("design:paramtypes",[a.a,s.a,l.a,d.a,f.a,u.a,c.a,i.s,r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(82),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.sanitizer=e,this.textSupplied=!1}return e.prototype.ngOnChanges=function(e){e.text&&void 0!==e.text.currentValue&&(this.textSupplied=!0),e.progress&&("string"==typeof this.progress&&(this.progress=parseInt(this.progress,10)),(this.progress<0||isNaN(this.progress))&&(this.progress=-1),-1!=this.progress&&(this.progress=Math.floor(this.progress),this.textSupplied||(this.text=String(this.progress)),this.width=this.sanitizer.bypassSecurityTrustStyle(this.progress+"%")))},i([Object(o.D)(),s("design:type",Object)],e.prototype,"progress",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"text",void 0),e=i([Object(o.m)({selector:"core-progress-bar",template:'<div *ngIf="progress >= 0">\n    <progress max="100" [value]="progress">\n        <div class="progress-bar-fallback" role="progressbar" aria-valuemin="0" aria-valuemax="100" [attr.aria-valuenow]="progress">\n            <span [style.width]="width"></span>\n        </div>\n    </progress>\n    <span class="core-progress-text">{{ \'core.percentagenumber\' | translate: {$a: text} }}</span>\n</div>\n',changeDetection:o.i.OnPush}),s("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return r([Object(o.D)(),i("design:type",String)],e.prototype,"message",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"icon",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"image",void 0),e=r([Object(o.m)({selector:"core-empty-box",template:'<div class="core-empty-box" [class.core-empty-box-inline]="!image && !icon">\n    <div class="core-empty-box-content" padding>\n        <img *ngIf="image && !icon" [src]="image" role="presentation">\n        <core-icon *ngIf="icon" [name]="icon"></core-icon>\n        <p *ngIf="message" [class.padding-top]="image || icon">{{ message }}</p>\n        <ng-content></ng-content>\n    </div>\n</div>'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(6),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.translate=e,this.utils=t,this.autocorrect="on",this.spellcheck=!0,this.lengthCheck=3,this.showClear=!0,this.disabled=!1,this.searched=!1,this.searchText="",this.onSubmit=new o.v,this.onClear=new o.v}return e.prototype.ngOnInit=function(){this.searchLabel=this.searchLabel||this.translate.instant("core.search"),this.placeholder=this.placeholder||this.translate.instant("core.search"),this.spellcheck=this.utils.isTrueOrOne(this.spellcheck),this.showClear=this.utils.isTrueOrOne(this.showClear)},e.prototype.submitForm=function(e){this.searchText.length<this.lengthCheck||(this.searched=!0,this.onSubmit.emit(this.searchText))},e.prototype.clearForm=function(){this.searched=!1,this.searchText="",this.onClear.emit()},s([Object(o.D)(),a("design:type",String)],e.prototype,"searchLabel",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"placeholder",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"autocorrect",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"spellcheck",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"autoFocus",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"lengthCheck",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"showClear",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"disabled",void 0),s([Object(o.O)(),a("design:type",o.v)],e.prototype,"onSubmit",void 0),s([Object(o.O)(),a("design:type",o.v)],e.prototype,"onClear",void 0),e=s([Object(o.m)({selector:"core-search-box",template:'<ion-card>\n    <form #f="ngForm" (ngSubmit)="submitForm()">\n        <ion-item>\n            <ion-input type="text" name="search" [(ngModel)]="searchText" [placeholder]="placeholder" [autocorrect]="autocorrect" [spellcheck]="spellcheck" [core-auto-focus]="autoFocus" [disabled]="disabled"></ion-input>\n            <button item-end ion-button clear icon-only type="submit" class="button-small" [attr.aria-label]="searchLabel" [disabled]="!searchText || (searchText.length < lengthCheck)" [disabled]="disabled">\n                <ion-icon name="search"></ion-icon>\n            </button>\n            <button *ngIf="showClear" item-end ion-button clear icon-only class="button-small" [attr.aria-label]="\'core.clearsearch\' | translate" [disabled]="!searched" (click)="clearForm()" [disabled]="disabled">\n                <ion-icon name="close"></ion-icon>\n            </button>\n        </ion-item>\n    </form>\n</ion-card>\n'}),a("design:paramtypes",[r.c,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(9),i=n(12),s=n(18),a=n(222),c=n(2),u=n(8),d=n(77),l=n(6),f=n(30),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t,n,r,i,s,a,c){this.sitesProvider=e,this.utils=t,this.domUtils=n,this.filepoolProvider=r,this.appProvider=i,this.fileHelper=s,this.mimeUtils=a,this.eventsProvider=c,this.canDownload=!0,this.onDelete=new o.v}return e.prototype.ngOnInit=function(){var e=this;this.canDelete=this.utils.isTrueOrOne(this.canDelete),this.alwaysDownload=this.utils.isTrueOrOne(this.alwaysDownload),this.canDownload=this.utils.isTrueOrOne(this.canDownload),this.fileUrl=this.fileHelper.getFileUrl(this.file),this.timemodified=this.fileHelper.getFileTimemodified(this.file),this.siteId=this.sitesProvider.getCurrentSiteId(),this.fileSize=this.file.filesize,this.fileName=this.file.filename,this.file.isexternalfile&&(this.alwaysDownload=!0),this.fileIcon=this.mimeUtils.getFileIcon(this.file.filename),this.canDownload&&(this.calculateState(),this.filepoolProvider.getFileEventNameByUrl(this.siteId,this.fileUrl).then(function(t){e.observer=e.eventsProvider.on(t,function(){e.calculateState()})}))},e.prototype.calculateState=function(){var e=this;return this.filepoolProvider.getFileStateByUrl(this.siteId,this.fileUrl,this.timemodified).then(function(t){var n=e.sitesProvider.getCurrentSite().canDownloadFiles();e.state=t,e.isDownloaded=t===f.a.DOWNLOADED||t===f.a.OUTDATED,e.isDownloading=n&&t===f.a.DOWNLOADING,e.showDownload=n&&(t===f.a.NOT_DOWNLOADED||t===f.a.OUTDATED||e.alwaysDownload&&t===f.a.DOWNLOADED)})},e.prototype.openFile=function(){var e=this;return this.fileHelper.downloadAndOpenFile(this.file,this.component,this.componentId,this.state,function(t){t&&t.calculating&&(e.isDownloading=!0)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.errordownloading",!0)})},e.prototype.download=function(e,t){var n=this;e.preventDefault(),e.stopPropagation();this.isDownloading&&!t||(this.appProvider.isOnline()||t&&(!t||this.isDownloaded)?t?this.openFile().catch(function(e){n.domUtils.showErrorModalDefault(e,"core.errordownloading",!0)}):(this.fileSize?this.domUtils.confirmDownloadSize({size:this.fileSize,total:!0}):Promise.resolve()).then(function(){return n.filepoolProvider.invalidateFileByUrl(n.siteId,n.fileUrl).finally(function(){n.isDownloading=!0,n.filepoolProvider.addToQueueByUrl(n.siteId,n.fileUrl,n.component,n.componentId,n.timemodified,void 0,void 0,0,n.file).catch(function(e){n.domUtils.showErrorModalDefault(e,"core.errordownloading",!0),n.calculateState()})})}).catch(function(){}):this.domUtils.showErrorModal("core.networkerrormsg",!0))},e.prototype.delete=function(e){e.preventDefault(),e.stopPropagation(),this.canDelete&&this.onDelete.emit()},e.prototype.ngOnDestroy=function(){this.observer&&this.observer.off()},p([Object(o.D)(),h("design:type",Object)],e.prototype,"file",void 0),p([Object(o.D)(),h("design:type",String)],e.prototype,"component",void 0),p([Object(o.D)(),h("design:type",Object)],e.prototype,"componentId",void 0),p([Object(o.D)(),h("design:type",Object)],e.prototype,"canDelete",void 0),p([Object(o.D)(),h("design:type",Object)],e.prototype,"alwaysDownload",void 0),p([Object(o.D)(),h("design:type",Object)],e.prototype,"canDownload",void 0),p([Object(o.O)(),h("design:type",o.v)],e.prototype,"onDelete",void 0),e=p([Object(o.m)({selector:"core-file",template:'<a ion-item text-wrap class="item-media" (click)="download($event, true)" detail-none>\n    <img [src]="fileIcon" alt="" role="presentation" item-start />\n    <p>{{fileName}}</p>\n    <div class="buttons" item-end>\n        <button ion-button clear icon-only (click)="download($event)" *ngIf="!isDownloading && showDownload" [attr.aria-label]="\'core.download\' | translate" color="dark">\n            <ion-icon [name]="isDownloaded ? \'refresh\' : \'cloud-download\'"></ion-icon>\n        </button>\n        <button ion-button clear icon-only (click)="delete($event)" *ngIf="!isDownloading && canDelete" [attr.aria-label]="\'core.delete\' | translate" color="danger">\n            <ion-icon name="trash"></ion-icon>\n        </button>\n    </div>\n    <ion-spinner *ngIf="isDownloading" item-end></ion-spinner>\n</a>\n'}),h("design:paramtypes",[c.a,l.a,u.a,s.a,r.a,a.a,d.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.element=e.nativeElement}return e.prototype.ngOnInit=function(){var e;this.name.startsWith("fa-")?((e=document.createElement("ion-icon")).classList.add("icon"),e.classList.add("fa"),e.classList.add(this.name),this.isTrueProperty(this.fixedWidth)&&e.classList.add("fa-fw"),this.color&&e.classList.add("fa-"+this.color)):e=this.element.firstElementChild;for(var t=this.element.attributes,n=t.length-1;n>=0;n--)e.setAttribute(t[n].name,t[n].value);this.element.parentElement.replaceChild(e,this.element)},e.prototype.isTrueProperty=function(e){return"string"==typeof e?"true"===(e=e.toLowerCase().trim())||"on"===e||""===e:!!e},r([Object(o.D)(),i("design:type",String)],e.prototype,"name",void 0),r([Object(o.D)("color"),i("design:type",String)],e.prototype,"color",void 0),r([Object(o.D)("isActive"),i("design:type",Boolean)],e.prototype,"isActive",void 0),r([Object(o.D)("md"),i("design:type",String)],e.prototype,"md",void 0),r([Object(o.D)("ios"),i("design:type",String)],e.prototype,"ios",void 0),r([Object(o.D)("fixed-width"),i("design:type",String)],e.prototype,"fixedWidth",void 0),e=r([Object(o.m)({selector:"core-icon",template:'<ion-icon [name]="name" [isActive]="isActive" [md]="md" [ios]="ios" [color]="color"></ion-icon>'}),i("design:paramtypes",[o.t])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(720),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.ctxtMenu=e,this.closeOnClick=!0,this.hasAction=!1,this.destroyed=!1,this.action=new o.v}return e.prototype.ngOnInit=function(){this.priority=this.priority||1,this.closeOnClick=this.getBooleanValue(this.closeOnClick,!0),this.hasAction=this.action.observers.length>0,this.ariaAction=this.ariaAction||this.content,this.hasAction&&(this.href=""),this.captureLink=!(!this.href||!this.captureLink)&&this.captureLink,this.autoLogin=this.autoLogin||"check",this.destroyed||this.ctxtMenu.addItem(this)},e.prototype.getBooleanValue=function(e,t){return void 0===e?t:e&&"false"!==e},e.prototype.ngOnDestroy=function(){this.destroyed=!0,this.ctxtMenu.removeItem(this)},e.prototype.ngOnChanges=function(e){e.hidden&&!e.hidden.firstChange&&this.ctxtMenu.itemsChanged()},i([Object(o.D)(),s("design:type",String)],e.prototype,"content",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"iconDescription",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"iconAction",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"ariaDescription",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"ariaAction",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"href",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"captureLink",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"autoLogin",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"closeOnClick",void 0),i([Object(o.D)(),s("design:type",Number)],e.prototype,"priority",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"badge",void 0),i([Object(o.D)(),s("design:type",Number)],e.prototype,"badgeClass",void 0),i([Object(o.D)(),s("design:type",Boolean)],e.prototype,"hidden",void 0),i([Object(o.O)(),s("design:type",o.v)],e.prototype,"action",void 0),e=i([Object(o.m)({selector:"core-context-menu-item",template:""}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(e){this.cdr=e,this.startTime=0,this.time=0,this.onEnd=new o.v}return e.prototype.ngOnInit=function(){this.time=this.startTime||0},e.prototype.ngOnChanges=function(e){e&&e.running&&(e.running.currentValue?this.start():this.stop()),e&&e.reset&&e.reset.currentValue&&this.resetChrono()},e.prototype.resetChrono=function(){this.stop(),this.time=this.startTime||0},e.prototype.start=function(){var e=this;if(!this.interval){var t=Date.now();this.interval=setInterval(function(){e.time+=Date.now()-t,t=Date.now(),void 0!==e.endTime&&e.time>e.endTime&&(e.stop(),e.onEnd.emit()),e.cdr.detectChanges()},200)}},e.prototype.stop=function(){clearInterval(this.interval),delete this.interval},e.prototype.ngOnDestroy=function(){this.stop()},r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"running",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"startTime",void 0),r([Object(o.D)(),i("design:type",Number)],e.prototype,"endTime",void 0),r([Object(o.D)(),i("design:type",Boolean)],e.prototype,"reset",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"onEnd",void 0),e=r([Object(o.m)({selector:"core-chrono",template:"<span>{{ time / 1000 | coreSecondsToHMS }}</span>"}),i("design:paramtypes",[o.j])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(27),s=n(8),a=n(77),c=n(11),u=n(6),d=n(5),l=(n.n(d),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,r,i,s){this.mimeUtils=e,this.utils=t,this.translate=n,this.textUtils=r,this.fileProvider=i,this.domUtils=s,this.newFileName="",this.onDelete=new o.v,this.onRename=new o.v,this.onClick=new o.v}return e.prototype.ngOnInit=function(){var e=this;this.manage=this.utils.isTrueOrOne(this.manage),this.relativePath=this.fileProvider.removeBasePath(this.file.toURL()),this.relativePath||(this.relativePath=this.file.fullPath),this.loadFileBasicData(),this.fileProvider.getMetadata(this.file).then(function(t){t.size>=0&&(e.size=e.textUtils.bytesToSize(t.size,2)),e.timemodified=d(t.modificationTime).format("LLL")})},e.prototype.loadFileBasicData=function(){this.fileName=this.file.name,this.fileIcon=this.mimeUtils.getFileIcon(this.file.name),this.fileExtension=this.mimeUtils.getFileExtension(this.file.name)},e.prototype.fileClicked=function(e){this.editMode||(e.preventDefault(),e.stopPropagation(),this.utils.isTrueOrOne(this.overrideClick)&&this.onClick.observers.length?this.onClick.emit():this.utils.openFile(this.file.toURL()))},e.prototype.activateEdit=function(e){e.preventDefault(),e.stopPropagation(),this.editMode=!0,this.newFileName=this.file.name},e.prototype.changeName=function(e,t){var n=this;if(t.preventDefault(),t.stopPropagation(),e!=this.file.name){var o=this.domUtils.showModalLoading(),r=this.fileProvider.getFileAndDirectoryFromPath(this.relativePath),i=this.textUtils.concatenatePaths(r.directory,e);this.fileProvider.getFile(i).then(function(){n.domUtils.showErrorModal("core.errorfileexistssamename",!0)}).catch(function(){return n.fileProvider.moveFile(n.relativePath,i).then(function(e){n.editMode=!1,n.file=e,n.loadFileBasicData(),n.onRename.emit({file:n.file})}).catch(function(e){n.domUtils.showErrorModalDefault(e,"core.errorrenamefile",!0)})}).finally(function(){o.dismiss()})}else this.editMode=!1},e.prototype.deleteFile=function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.domUtils.showConfirm(this.translate.instant("core.confirmdeletefile")).then(function(){var e=t.domUtils.showModalLoading();return t.fileProvider.removeFile(t.relativePath).then(function(){t.onDelete.emit()}).finally(function(){e.dismiss()})}).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.errordeletefile",!0)})},l([Object(o.D)(),f("design:type",Object)],e.prototype,"file",void 0),l([Object(o.D)(),f("design:type",Object)],e.prototype,"manage",void 0),l([Object(o.D)(),f("design:type",Object)],e.prototype,"overrideClick",void 0),l([Object(o.O)(),f("design:type",o.v)],e.prototype,"onDelete",void 0),l([Object(o.O)(),f("design:type",o.v)],e.prototype,"onRename",void 0),l([Object(o.O)(),f("design:type",o.v)],e.prototype,"onClick",void 0),e=l([Object(o.m)({selector:"core-local-file",template:'<form (ngSubmit)="changeName(newFileName, $event)">\n    <a ion-item text-wrap stacked class="item-media" [class.item-input]="editMode" (click)="fileClicked($event)" detail-none>\n        <img [src]="fileIcon" alt="{{fileExtension}}" role="presentation" item-start />\n\n        \x3c!-- File name and edit button (if editable). --\x3e\n        <h2 *ngIf="!editMode">{{fileName}}</h2>\n        \x3c!-- More data about the file. --\x3e\n        <p *ngIf="size && !editMode">{{ size }}</p>\n        <p *ngIf="timemodified && !editMode">{{ timemodified }}</p>\n\n        \x3c!-- Form to edit the file\'s name. --\x3e\n        <ion-input type="text" name="filename" [placeholder]="\'core.filename\' | translate" autocapitalize="none" autocorrect="off" (click)="$event.stopPropagation()" [core-auto-focus] [(ngModel)]="newFileName" *ngIf="editMode"></ion-input>\n\n        <div class="buttons" item-end *ngIf="manage">\n            <button *ngIf="!editMode" ion-button icon-only clear (click)="activateEdit($event)" [attr.aria-label]="\'core.edit\' | translate" color="dark">\n                <ion-icon name="create" ios="md-create"></ion-icon>\n            </button>\n\n            <button *ngIf="editMode" ion-button icon-only clear [attr.aria-label]="\'core.save\' | translate" color="success" type="submit">\n                <ion-icon name="checkmark"></ion-icon>\n            </button>\n\n            <button ion-button clear icon-only (click)="deleteFile($event)" [attr.aria-label]="\'core.delete\' | translate" color="danger">\n                <ion-icon name="trash"></ion-icon>\n            </button>\n        </div>\n    </a>\n</form>\n'}),f("design:paramtypes",[a.a,u.a,r.c,c.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(2),s=n(11),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.translate=e,this.sitesProvider=t,this.textUtils=n,this.siteSelected=new o.v}return e.prototype.ngOnInit=function(){var e=this;this.selectedSite=this.initialSite||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSites().then(function(t){var n=[];return t.forEach(function(t){n.push(e.textUtils.formatText(t.siteName,!0,!0).catch(function(){return t.siteName}).then(function(n){t.fullNameAndSiteName=e.translate.instant("core.fullnameandsitename",{fullname:t.fullName,sitename:n})}))}),Promise.all(n).then(function(){e.sites=t})})},a([Object(o.D)(),c("design:type",String)],e.prototype,"initialSite",void 0),a([Object(o.O)(),c("design:type",o.v)],e.prototype,"siteSelected",void 0),e=a([Object(o.m)({selector:"core-site-picker",template:'<ion-item>\n    <ion-label>{{ \'core.site\' | translate }}</ion-label>\n    <ion-select [(ngModel)]="selectedSite" (ngModelChange)="siteSelected.emit(selectedSite)" interface="popover">\n        <ion-option *ngFor="let site of sites" [value]="site.id">{{ site.fullNameAndSiteName }}</ion-option>\n    </ion-select>\n</ion-item>\n'}),c("design:paramtypes",[r.c,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(4),i=n(7),s=n(8),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.domUtils=n,this.BUTTON_HIDDEN_CLASS="core-navbar-button-hidden",this.forceHidden=!1,this.element=e.nativeElement,this.logger=t.getInstance("CoreNavBarButtonsComponent"),this.instanceId=this.domUtils.storeInstanceByElement(this.element,this)}return Object.defineProperty(e.prototype,"hidden",{set:function(e){this._hidden=e,this.showHideAllElements()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"buttons",{set:function(e){e.forEach(function(e){e.setRole("bar-button")})},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.searchHeader().then(function(t){if(t){var n="ion-buttons",o=void 0;e.element.hasAttribute("start")?n+="[start]":e.element.hasAttribute("end")&&(n+="[end]"),(o=t.querySelector(n))?(e.mergeContextMenus(o),e.movedChildren=e.domUtils.moveChildren(e.element,o),e.showHideAllElements()):e.logger.warn("The header was found, but it didn't have the right ion-buttons.",n)}}).catch(function(){e.logger.warn("Header not found.")})},e.prototype.forceHide=function(e){this.forceHidden=e,this.showHideAllElements()},e.prototype.mergeContextMenus=function(e){var t=e.querySelector("core-context-menu");if(t){var n=this.element.querySelector("core-context-menu");if(n){var o=this.domUtils.getInstanceByElement(t),r=this.domUtils.getInstanceByElement(n);o&&r&&o.coreTab===r.coreTab&&(this.mergedContextMenu=r,this.mergedContextMenu.mergeContextMenus(o),n.parentElement.removeChild(n))}}},e.prototype.searchHeader=function(e){var t=this;void 0===e&&(e=0);for(var n=this.element;n&&n.parentElement;)if(n=this.domUtils.closest(n.parentElement,".ion-page")){var o=this.searchHeaderInPage(n);if(o&&"none"!=getComputedStyle(o,null).display)return Promise.resolve(o)}return e<5?new Promise(function(n,o){setTimeout(function(){t.searchHeader(e+1).then(n,o)},200)}):Promise.reject(null)},e.prototype.searchHeaderInPage=function(e){for(var t=0;t<e.children.length;t++){var n=e.children[t];if("ION-HEADER"==n.tagName)return n}},e.prototype.showHideAllElements=function(){var e=this;this.movedChildren&&this.movedChildren.forEach(function(t){e.showHideElement(t)}),this.mergedContextMenu&&(this.forceHidden||this._hidden?this.mergedContextMenu.removeMergedItems():this.mergedContextMenu.restoreMergedItems())},e.prototype.showHideElement=function(e){e instanceof Element&&(this.forceHidden||this._hidden?e.classList.add(this.BUTTON_HIDDEN_CLASS):e.classList.remove(this.BUTTON_HIDDEN_CLASS))},e.prototype.ngOnDestroy=function(){this.domUtils.removeInstanceById(this.instanceId),this.movedChildren&&this.movedChildren.forEach(function(e){e.parentElement&&e.parentElement.removeChild(e)}),this.mergedContextMenu&&this.mergedContextMenu.removeMergedItems()},a([Object(o.D)("hidden"),c("design:type",Boolean),c("design:paramtypes",[Boolean])],e.prototype,"hidden",null),a([Object(o.r)(r.d),c("design:type",o.T),c("design:paramtypes",[o.T])],e.prototype,"buttons",null),e=a([Object(o.m)({selector:"core-navbar-buttons",template:"<ng-content></ng-content>"}),c("design:paramtypes",[o.t,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(6),i=n(11),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.utils=e,this.textUtils=t,this.placeholder="",this.showKeyboard=!1,this.onSubmit=new o.v,this.onResize=new o.v}return e.prototype.ngOnInit=function(){this.showKeyboard=this.utils.isTrueOrOne(this.showKeyboard)},e.prototype.submitForm=function(e){var t=this.message.trim();e.target.reset(),e.target[0].focus(),t&&(t=this.textUtils.replaceNewLines(t,"<br>"),this.onSubmit.emit(t))},e.prototype.textareaResized=function(){this.onResize.emit()},s([Object(o.D)(),a("design:type",String)],e.prototype,"message",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"placeholder",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"showKeyboard",void 0),s([Object(o.O)(),a("design:type",o.v)],e.prototype,"onSubmit",void 0),s([Object(o.O)(),a("design:type",o.v)],e.prototype,"onResize",void 0),e=s([Object(o.m)({selector:"core-send-message-form",template:'<form (ngSubmit)="submitForm($event)">\n    <textarea class="core-send-message-input" [core-auto-focus]="showKeyboard" [placeholder]="placeholder" rows="1" core-auto-rows [(ngModel)]="message" name="message" (onResize)="textareaResized()"></textarea>\n    <ion-buttons end>\n        <button ion-button icon-only clear="true" type="submit" [disabled]="!message" [attr.aria-label]="\'core.send\' | translate">\n            <ion-icon name="send" color="dark"></ion-icon>\n        </button>\n    </ion-buttons>\n</form>\n'}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(22),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.timeUtils=e,this.finished=new o.v}return e.prototype.ngOnInit=function(){var e=this,t=this.timeLeftClass||"core-timer-timeleft-",n=Math.round(Number(this.endTime)),o=this.containerRef&&this.containerRef.nativeElement;n&&(this.timeInterval=setInterval(function(){if(e.timeLeft=n-e.timeUtils.timestamp(),e.timeLeft<0)return clearInterval(e.timeInterval),void e.finished.emit();e.timeLeft<100&&!o.classList.contains(t+e.timeLeft)&&(o.classList.remove(t+(e.timeLeft+1)),o.classList.remove(t+(e.timeLeft+2)),o.classList.add(t+e.timeLeft))},200))},e.prototype.ngOnDestroy=function(){clearInterval(this.timeInterval)},i([Object(o.D)(),s("design:type",Object)],e.prototype,"endTime",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"timerText",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"timeLeftClass",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"align",void 0),i([Object(o.O)(),s("design:type",o.v)],e.prototype,"finished",void 0),i([Object(o._9)("container",{read:o.t}),s("design:type",o.t)],e.prototype,"containerRef",void 0),e=i([Object(o.m)({selector:"core-timer",template:'<ion-item #container class="core-timer" [attr.text-center]="align == \'center\' ? true : null" [attr.text-right]="align == \'right\' ? true : null">\n    <ion-icon name="timer" item-start></ion-icon>\n    <label *ngIf="timeLeft > 0 && timerText">{{ timerText }}</label>\n    <span *ngIf="timeLeft > 0">{{ timeLeft | coreSecondsToHMS }}</span>\n    <span class="core-timesup" *ngIf="timeLeft <= 0">{{ \'core.timesup\' | translate }}</span>\n</ion-item>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(2),s=n(93),a=n(11),c=n(723),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o){var r=this;this.sitesProvider=e,this.textUtils=n,this.modalCtrl=o,this.modelValueName="recaptcharesponse",this.expired=!1,t.getCurrentLanguage().then(function(e){r.lang=e})}return e.prototype.ngOnInit=function(){this.siteUrl=this.siteUrl||this.sitesProvider.getCurrentSite().getURL()},e.prototype.answerRecaptcha=function(){var e=this,t=this.textUtils.concatenatePaths(this.siteUrl,"webservice/recaptcha.php?lang="+this.lang),n=this.modalCtrl.create(c.a,{src:t},{cssClass:"core-modal-fullscreen"});n.onDidDismiss(function(t){e.expired=t.expired,e.model[e.modelValueName]=t.value}),n.present()},u([Object(o.D)(),d("design:type",Object)],e.prototype,"model",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"publicKey",void 0),u([Object(o.D)(),d("design:type",Object)],e.prototype,"modelValueName",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"siteUrl",void 0),e=u([Object(o.m)({selector:"core-recaptcha",template:'\x3c!-- ReCAPTCHA V2 --\x3e\n<div *ngIf="publicKey">\n    \x3c!-- A button to open the recaptcha modal. --\x3e\n    \x3c!-- Use anchor instead of button to prevent marking form as submitted. --\x3e\n    <button ion-button block *ngIf="!model[modelValueName]" (click)="answerRecaptcha()" type="button">{{ \'core.answer\' | translate }}</button>\n    <p *ngIf="model[modelValueName]" class="text-success">{{ \'core.answered\' | translate }}</p>\n    <p *ngIf="expired" class="text-danger">{{ \'core.login.recaptchaexpired\' | translate }}</p>\n</div>\n\n\x3c!-- Error that happens sometimes with reCaptcha V1, probably due to deprecation warnings. --\x3e\n<div class="core-warning-card" icon-start *ngIf="!challengehash && challengeimage" >\n    <ion-icon name="warning"></ion-icon>\n    {{ \'core.errorloadingcontent\' | translate }}\n</div>'}),d("design:paramtypes",[i.a,s.a,a.a,r.o])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(11),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.textUtils=e,this.action=new o.v}return e.prototype.showInfo=function(){this.textUtils.expandText(this.title,this.info,this.component,this.componentId)},i([Object(o.D)(),s("design:type",Object)],e.prototype,"previous",void 0),i([Object(o.D)(),s("design:type",Object)],e.prototype,"next",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"info",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"title",void 0),i([Object(o.D)(),s("design:type",String)],e.prototype,"component",void 0),i([Object(o.D)(),s("design:type",Number)],e.prototype,"componentId",void 0),i([Object(o.O)(),s("design:type",o.v)],e.prototype,"action",void 0),e=i([Object(o.m)({selector:"core-navigation-bar",template:'<ion-grid no-padding  *ngIf="previous || info || next">\n    <ion-row>\n        <ion-col text-left>\n            <a ion-button icon-only clear color="info" *ngIf="previous" (click)="action.emit(previous)" [title]="\'core.previous\' | translate">\n                <ion-icon name="arrow-dropleft-circle"></ion-icon>\n            </a>\n        </ion-col>\n        <ion-col text-center>\n            <a ion-button icon-only clear color="info" *ngIf="info" (click)="showInfo()" [title]="title">\n                <ion-icon name="information-circle"></ion-icon>\n            </a>\n        </ion-col>\n        <ion-col text-right>\n            <a ion-button icon-only clear color="info" *ngIf="next" (click)="action.emit(next)" [title]="\'core.next\' | translate">\n                <ion-icon name="arrow-dropright-circle"></ion-icon>\n            </a>\n        </ion-col>\n    </ion-row>\n</ion-grid>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(1),i=n(9),s=n(8),a=n(11),c=n(56),u=n(107),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.appProvider=e,this.domUtils=t,this.textUtils=n,this.fileUploaderProvider=o,this.translate=r,this.fileUploaderHelper=i}return e.prototype.ngOnInit=function(){this.maxSize=Number(this.maxSize),this.maxSize=!isNaN(this.maxSize)&&this.maxSize>0?this.maxSize:-1,this.maxSizeReadable=-1==this.maxSize?this.translate.instant("core.unknown"):this.textUtils.bytesToSize(this.maxSize,2),void 0===this.maxSubmissions||this.maxSubmissions<0?(this.maxSubmissionsReadable=this.translate.instant("core.unknown"),this.unlimitedFiles=!0):this.maxSubmissionsReadable=String(this.maxSubmissions),this.acceptedTypes&&this.acceptedTypes.trim()&&(this.fileTypes=this.fileUploaderProvider.prepareFiletypeList(this.acceptedTypes))},e.prototype.add=function(){var e=this,t=this.allowOffline&&"false"!==this.allowOffline;if(t||this.appProvider.isOnline()){this.fileUploaderHelper.selectFile(this.maxSize,t,void 0,this.fileTypes&&this.fileTypes.mimetypes).then(function(t){e.files.push(t)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Error selecting file.")})}else this.domUtils.showErrorModal("core.fileuploader.errormustbeonlinetoupload",!0)},e.prototype.delete=function(e,t){var n=this;(t?this.domUtils.showConfirm(this.translate.instant("core.confirmdeletefile")):Promise.resolve()).then(function(){n.files.splice(e,1)}).catch(function(){})},e.prototype.renamed=function(e,t){this.files[e]=t.file},d([Object(o.D)(),l("design:type",Array)],e.prototype,"files",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"maxSize",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"maxSubmissions",void 0),d([Object(o.D)(),l("design:type",String)],e.prototype,"component",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"componentId",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"allowOffline",void 0),d([Object(o.D)(),l("design:type",String)],e.prototype,"acceptedTypes",void 0),e=d([Object(o.m)({selector:"core-attachments",template:'<ion-item text-wrap>\n    {{ \'core.maxsizeandattachments\' | translate:{$a: {size: maxSizeReadable, attachments: maxSubmissionsReadable} } }}\n</ion-item>\n<ion-item text-wrap *ngIf="fileTypes && fileTypes.mimetypes && fileTypes.mimetypes.length">\n    <p>{{ \'core.fileuploader.filesofthesetypes\' | translate }}</p>\n    <ul class="list-with-style">\n        <li *ngFor="let typeInfo of fileTypes.info">\n            <strong *ngIf="typeInfo.name">{{typeInfo.name}} </strong>{{typeInfo.extlist}}\n        </li>\n    </ul>\n</ion-item>\n<div *ngFor="let file of files; let index=index">\n    \x3c!-- Files already attached to the submission, either in online or in offline. --\x3e\n    <core-file *ngIf="!file.name || file.offline" [file]="file" [component]="component" [componentId]="componentId" [canDelete]="true" (onDelete)="delete(index, true)" [canDownload]="!file.offline"></core-file>\n\n    \x3c!-- Files added to draft but not attached to submission yet. --\x3e\n    <core-local-file *ngIf="file.name && !file.offline" [file]="file" [manage]="true" (onDelete)="delete(index, false)" (onRename)="renamed(index, $event)"></core-local-file>\n</div>\n\x3c!-- Button to add more files. --\x3e\n<ion-item text-wrap *ngIf="unlimitedFiles || (maxSubmissions >= 0 && files && files.length < maxSubmissions)">\n    <a ion-button block icon-start (click)="add()">\n        <ion-icon name="add"></ion-icon>\n        {{ \'core.fileuploader.addfiletext\' | translate }}\n    </a>\n</ion-item>'}),l("design:paramtypes",[i.a,s.a,a.a,c.a,r.c,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(169),s=n(724),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},l=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p,h){return e.call(this,t,n,o,r,i,s,a,c,u,d,l,f,p,h)||this}return a(t,e),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.parent.add(this,!0)},t.prototype.ngOnDestroy=function(){e.prototype.ngOnDestroy.call(this),this.parent.remove(this)},t=c([Object(o.m)({selector:"core-ion-tab",template:'<div #viewport></div><div class="nav-decor"></div>',host:{"[attr.id]":"_tabId","[attr.aria-labelledby]":"_btnId",role:"tabpanel"},encapsulation:o._12.None}),d(11,Object(o.N)()),u("design:paramtypes",[s.a,r.c,r.e,r.s,o.t,o.M,o.V,o.o,o.j,r.i,i.a,r.g,r.h,o.u])],t)}(r.x)},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(4),i=n(12),s=n(2),a=n(8),c=n(41),u=n(97),d=n(10),l=n(21),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},m=function(){function e(e,t,n,o,r,i,s,a){this.navCtrl=e,this.courseHelper=t,this.courseFormatDelegate=n,this.domUtils=o,this.courseProvider=r,this.eventsProvider=i,this.sitesProvider=s,this.coursesProvider=a,this.prefetchCourseData={prefetchCourseIcon:"spinner",title:"core.course.downloadcourse"},this.isDestroyed=!1}return e.prototype.ngOnInit=function(){var e=this;this.downloadCourseEnabled=!this.coursesProvider.isDownloadCourseDisabledInSite(),this.downloadCourseEnabled&&this.initPrefetchCourse(),this.siteUpdatedObserver=this.eventsProvider.on(i.a.SITE_UPDATED,function(){var t=e.downloadCourseEnabled;e.downloadCourseEnabled=!e.coursesProvider.isDownloadCourseDisabledInSite(),!t&&e.downloadCourseEnabled&&e.initPrefetchCourse()},this.sitesProvider.getCurrentSiteId())},e.prototype.initPrefetchCourse=function(){var e=this;void 0===this.courseStatusObserver&&(this.courseStatusObserver=this.eventsProvider.on(i.a.COURSE_STATUS_CHANGED,function(t){t.courseId==e.course.id&&e.updateCourseStatus(t.status)},this.sitesProvider.getCurrentSiteId()),this.courseHelper.getCourseStatusIconAndTitle(this.course.id).then(function(t){if(e.prefetchCourseData.prefetchCourseIcon=t.icon,e.prefetchCourseData.title=t.title,"spinner"==t.icon){var n=e.courseHelper.getCourseDownloadPromise(e.course.id);n?n.catch(function(t){e.isDestroyed||e.domUtils.showErrorModalDefault(t,"core.course.errordownloadingcourse",!0)}):e.courseProvider.setCoursePreviousStatus(e.course.id)}}))},e.prototype.openCourse=function(e){this.courseFormatDelegate.openCourse(this.navCtrl,e)},e.prototype.prefetchCourse=function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.courseHelper.confirmAndPrefetchCourse(this.prefetchCourseData,this.course).catch(function(e){t.isDestroyed||t.domUtils.showErrorModalDefault(e,"core.course.errordownloadingcourse",!0)})},e.prototype.updateCourseStatus=function(e){var t=this.courseHelper.getCourseStatusIconAndTitleFromStatus(e);this.prefetchCourseData.prefetchCourseIcon=t.icon,this.prefetchCourseData.title=t.title},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.siteUpdatedObserver&&this.siteUpdatedObserver.off(),this.courseStatusObserver&&this.courseStatusObserver.off()},f([Object(o.D)(),p("design:type",Object)],e.prototype,"course",void 0),e=f([Object(o.m)({selector:"core-courses-course-progress",template:'<ion-card class="couse-item">\n    <div (click)="openCourse(course)" class="core-course-thumb core-course-color-{{course.id % 10}}">\n        <img *ngIf="course.imageThumb" [src]="course.imageThumb" core-external-content alt=""/>\n    </div>\n\n    <div class="core-course-link" (click)="openCourse(course)">\n        <div>\n            <p>{{ course.fullname }}</p>    \n        </div>\n        \n    </div>\n    \x3c!-- <ion-item tappable text-wrap detail-none (click)="openCourse(course)" [title]="course.fullname" class="core-course-link">\n        <h2><core-format-text [text]="course.fullname"></core-format-text></h2>\n\n        <div class="core-button-spinner" *ngIf="downloadCourseEnabled"> --\x3e\n            \x3c!-- Download course. --\x3e\n            \x3c!-- <button *ngIf="prefetchCourseData.prefetchCourseIcon != \'spinner\'" ion-button icon-only clear color="dark" (click)="prefetchCourse($event)" [attr.aria-label]="prefetchCourseData.title | translate">\n                <core-icon [name]="prefetchCourseData.prefetchCourseIcon"></core-icon>\n            </button> --\x3e\n            \x3c!-- Download course spinner. --\x3e\n            \x3c!-- <ion-spinner *ngIf="prefetchCourseData.prefetchCourseIcon == \'spinner\'"></ion-spinner>\n        </div>\n    </ion-item> --\x3e\n    <ion-item text-wrap *ngIf="course.summary && course.summary.length">\n        <p>\n            <summary>\n                <core-format-text [text]="course.summary" singleLine="true" clean="true"></core-format-text>\n            </summary>\n        </p>\n    </ion-item>\n    \x3c!-- <ion-item *ngIf="course.progress != null && course.progress >= 0">\n        <core-progress-bar [progress]="course.progress"></core-progress-bar>\n    </ion-item> --\x3e\n    <ng-content></ng-content>\n</ion-card>\n'}),h(0,Object(o.N)()),p("design:paramtypes",[r.q,l.a,u.a,a.a,d.a,i.a,s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(4),i=n(1),s=n(41),a=n(97),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},l=function(){function e(e,t,n,o){this.navCtrl=e,this.translate=t,this.coursesProvider=n,this.courseFormatDelegate=o}return e.prototype.ngOnInit=function(){var e=this;this.coursesProvider.getUserCourse(this.course.id).then(function(){e.course.isEnrolled=!0}).catch(function(){e.course.isEnrolled=!1,e.course.enrollment=[],e.course.enrollmentmethods.forEach(function(t){"self"===t?e.course.enrollment.push({name:e.translate.instant("core.courses.selfenrolment"),icon:"unlock"}):"guest"===t?e.course.enrollment.push({name:e.translate.instant("core.courses.allowguests"),icon:"person"}):"paypal"===t&&e.course.enrollment.push({name:e.translate.instant("core.courses.paypalaccepted"),img:"assets/img/icons/paypal.png"})}),0==e.course.enrollment.length&&e.course.enrollment.push({name:e.translate.instant("core.courses.notenrollable"),icon:"lock"})})},e.prototype.openCourse=function(e){e.isEnrolled?this.courseFormatDelegate.openCourse(this.navCtrl,e):this.navCtrl.push("CoreCoursesCoursePreviewPage",{course:e})},c([Object(o.D)(),u("design:type",Object)],e.prototype,"course",void 0),e=c([Object(o.m)({selector:"core-courses-course-list-item",template:'<a ion-item text-wrap (click)="openCourse(course)" [attr.disabled]="course.visible == 0 ? true : null" [attr.detail-none]="course.visible == 0 ? true : null" [title]="course.fullname">\n    <core-icon name="fa-graduation-cap" fixed-width item-start></core-icon>\n    <h2><core-format-text [text]="course.fullname"></core-format-text></h2>\n    <div item-end>\n        <span *ngIf="!course.isEnrolled">\n            <span ion-button icon-only clear color="gray" *ngFor="let instance of course.enrollment" [attr.aria-label]=" instance.name | translate">\n                <core-icon *ngIf="instance.icon" [name]="instance.icon"></core-icon>\n                <img *ngIf="instance.img && !instance.icon" [src]="instance.img" class="core-course-enrollment-img">\n            </span>\n        </span>\n    </div>\n</a>\n'}),d(0,Object(o.N)()),u("design:paramtypes",[r.q,i.c,s.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.isDestroyed=!1}return e.prototype.ngOnInit=function(){},e.prototype.ngOnDestroy=function(){this.isDestroyed=!0,this.siteUpdatedObserver&&this.siteUpdatedObserver.off(),this.courseStatusObserver&&this.courseStatusObserver.off()},r([Object(o.D)(),i("design:type",Object)],e.prototype,"categories",void 0),e=r([Object(o.m)({selector:"core-courses-course-list-slide",template:'<ion-list no-lines>\n    <div *ngFor="let category of categories" class="item-category">\n    <ion-slides   class="login-slides" slidesPerView="2" >\n\n                <ion-slide class="common first-el">\n                    <ion-card class="card-category-title category-title-background-{{category.id % 10}}" >\n                        <h2>{{ category.name }}</h2>\n                    </ion-card>\n                </ion-slide>\n                <ion-slide *ngFor="let course of category.courses" class="common" >\n                        <core-courses-course-progress [course]="course" class="core-courseoverview"></core-courses-course-progress>\n                </ion-slide>\n    </ion-slides>\n    </div>\n</ion-list>'})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(4),i=n(2),s=n(8),a=n(11),c=n(6),u=n(10),d=n(32),l=n(5),f=(n.n(l),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},m=function(){function e(e,t,n,r,i,s,a){this.navCtrl=e,this.utils=t,this.textUtils=n,this.domUtils=r,this.sitesProvider=i,this.courseProvider=s,this.contentLinksHelper=a,this.recentlyOverdue=[],this.today=[],this.next7Days=[],this.next30Days=[],this.future=[],this.loadMore=new o.v}return e.prototype.ngOnChanges=function(e){this.showCourse=this.utils.isTrueOrOne(this.showCourse),e.events&&this.updateEvents()},e.prototype.filterEventsByTime=function(e,t){var n=this;return e=l().add(e,"days").unix(),t=void 0!==t?l().add(t,"days").unix():t,this.events.filter(function(n){return t?e<=n.timesort&&n.timesort<t:e<=n.timesort}).map(function(e){return e.iconUrl=n.courseProvider.getModuleIconSrc(e.icon.component),e})},e.prototype.updateEvents=function(){this.empty=!this.events||this.events.length<=0,this.empty||(this.recentlyOverdue=this.filterEventsByTime(-14,0),this.today=this.filterEventsByTime(0,1),this.next7Days=this.filterEventsByTime(1,7),this.next30Days=this.filterEventsByTime(7,30),this.future=this.filterEventsByTime(30))},e.prototype.loadMoreEvents=function(){this.loadingMore=!0,this.loadMore.emit()},e.prototype.action=function(e,t){var n=this;e.preventDefault(),e.stopPropagation(),t=this.textUtils.decodeHTMLEntities(t);var o=this.domUtils.showModalLoading();this.contentLinksHelper.handleLink(t,void 0,this.navCtrl).then(function(e){if(!e)return n.sitesProvider.getCurrentSite().openInBrowserWithAutoLoginIfSameSite(t)}).finally(function(){o.dismiss()})},f([Object(o.D)(),p("design:type",Array)],e.prototype,"events",void 0),f([Object(o.D)(),p("design:type",Object)],e.prototype,"showCourse",void 0),f([Object(o.D)(),p("design:type",Boolean)],e.prototype,"canLoadMore",void 0),f([Object(o.O)(),p("design:type",o.v)],e.prototype,"loadMore",void 0),e=f([Object(o.m)({selector:"core-courses-overview-events",template:'<ng-template #eventTemplate let-event="event">\n    <a ion-item core-link text-wrap detail-none captureLink="true" class="core-course-module-handler item-media" [href]="event.url" [title]="event.name" [class.item-badge-right-phone]="event.action && event.action.showitemcount">\n        <img item-start [src]="event.iconUrl" core-external-content alt="" role="presentation" *ngIf="event.iconUrl" class="core-module-icon">\n        <h2><core-format-text [text]="event.name"></core-format-text></h2>\n        <p>{{event.timesort * 1000 | coreFormatDate:"dfmediumdate" }} <core-format-text *ngIf="showCourse" [text]="event.course.fullnamedisplay"></core-format-text></p>\n        <button ion-button clear item-end class="hidden-phone" (click)="action($event, event.action.url)" [title]="event.action.name" [disabled]="!event.action.actionable" *ngIf="event.action">\n            {{event.action.name}}\n            <ion-badge item-end margin-left *ngIf="event.action.showitemcount">{{event.action.itemcount}}</ion-badge>\n        </button>\n        <ion-badge class="hidden-tablet" item-end *ngIf="event.action.showitemcount">{{event.action.itemcount}}</ion-badge>\n    </a>\n</ng-template>\n\n<ion-item-group *ngIf="recentlyOverdue.length > 0">\n    <ion-item-divider color="danger">{{ \'core.courses.recentlyoverdue\' | translate }}</ion-item-divider>\n    <ng-container *ngFor="let event of recentlyOverdue">\n        <ng-container *ngTemplateOutlet="eventTemplate; context: {event: event}"></ng-container>\n    </ng-container>\n</ion-item-group>\n\n<ion-item-group *ngIf="next7Days.length > 0">\n    <ion-item-divider color="light">{{ \'core.courses.next7days\' | translate }}</ion-item-divider>\n    <ng-container *ngFor="let event of next7Days">\n        <ng-container *ngTemplateOutlet="eventTemplate; context: {event: event}"></ng-container>\n    </ng-container>\n</ion-item-group>\n\n<ion-item-group *ngIf="next30Days.length > 0">\n    <ion-item-divider color="light">{{ \'core.courses.next30days\' | translate }}</ion-item-divider>\n    <ng-container *ngFor="let event of next30Days">\n        <ng-container *ngTemplateOutlet="eventTemplate; context: {event: event}"></ng-container>\n    </ng-container>\n</ion-item-group>\n\n<ion-item-group *ngIf="future.length > 0">\n    <ion-item-divider color="light">{{ \'core.courses.future\' | translate }}</ion-item-divider>\n    <ng-container *ngFor="let event of future">\n        <ng-container *ngTemplateOutlet="eventTemplate; context: {event: event}"></ng-container>\n    </ng-container>\n</ion-item-group>\n\n<div padding text-center *ngIf="canLoadMore && !empty">\n    \x3c!-- Button and spinner to show more attempts. --\x3e\n    <button *ngIf="!loadingMore" ion-button block (click)="loadMoreEvents()">{{ \'core.loadmore\' | translate }}</button>\n    <ion-spinner *ngIf="loadingMore"></ion-spinner>\n</div>\n\n<core-empty-box *ngIf="empty && showCourse" image="assets/img/icons/activities.svg" [message]="\'core.courses.noevents\' | translate"></core-empty-box>\n<core-empty-box *ngIf="empty && !showCourse" [message]="\'core.courses.noevents\' | translate"></core-empty-box>\n'}),h(0,Object(o.N)()),p("design:paramtypes",[r.q,c.a,a.a,s.a,i.a,u.a,d.a])],e)}()},,,function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(12),s=n(2),a=n(8),c=n(21),u=n(36),d=n(30),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},h=function(){function e(e,t,n,r,i,s){this.navCtrl=e,this.prefetchDelegate=t,this.domUtils=n,this.courseHelper=r,this.eventsProvider=i,this.sitesProvider=s,this.statusCalculated=!1,this.isDestroyed=!1,this.completionChanged=new o.v}return Object.defineProperty(e.prototype,"enabled",{set:function(e){this.downloadEnabled=e,this.module.handlerData.showDownloadButton&&this.downloadEnabled&&!this.statusCalculated&&(this.statusCalculated=!0,this.spinner=!0,this.prefetchDelegate.getModuleStatus(this.module,this.courseId).then(this.showStatus.bind(this)))},enumerable:!0,configurable:!0}),e.prototype.ngOnInit=function(){var e=this;this.module&&!this.module.handlerData&&(this.module.handlerData={}),this.module.handlerData.showDownloadButton&&(this.prefetchHandler=this.prefetchDelegate.getPrefetchHandlerFor(this.module),this.statusObserver=this.eventsProvider.on(i.a.PACKAGE_STATUS_CHANGED,function(t){t.componentId===e.module.id&&e.prefetchHandler&&t.component===e.prefetchHandler.component&&(e.downloadEnabled?e.showStatus(t.status):e.module.handlerData.updateStatus&&e.module.handlerData.updateStatus(t.status))},this.sitesProvider.getCurrentSiteId()))},e.prototype.moduleClicked=function(e){!1!==this.module.uservisible&&this.module.handlerData.action&&this.module.handlerData.action(e,this.navCtrl,this.module,this.courseId)},e.prototype.buttonClicked=function(e,t){t&&t.action&&(e.preventDefault(),e.stopPropagation(),t.action(e,this.navCtrl,this.module,this.courseId))},e.prototype.download=function(e,t){var n=this;e.preventDefault(),e.stopPropagation(),this.prefetchHandler&&(this.spinner=!0,this.prefetchHandler.getDownloadSize(this.module,this.courseId,!0).then(function(e){return n.courseHelper.prefetchModule(n.prefetchHandler,n.module,e,n.courseId,t)}).catch(function(e){n.spinner=!1,n.isDestroyed||n.domUtils.showErrorModalDefault(e,"core.errordownloading",!0)}))},e.prototype.showStatus=function(e){e&&(this.spinner=e===d.a.DOWNLOADING,this.showDownload=e===d.a.NOT_DOWNLOADED,this.showRefresh=e===d.a.OUTDATED||!this.prefetchDelegate.canCheckUpdates()&&e===d.a.DOWNLOADED,this.module.handlerData.updateStatus&&this.module.handlerData.updateStatus(e))},e.prototype.ngOnDestroy=function(){this.statusObserver&&this.statusObserver.off(),this.isDestroyed=!0},l([Object(o.D)(),f("design:type",Object)],e.prototype,"module",void 0),l([Object(o.D)(),f("design:type",Number)],e.prototype,"courseId",void 0),l([Object(o.D)("downloadEnabled"),f("design:type",Boolean),f("design:paramtypes",[Boolean])],e.prototype,"enabled",null),l([Object(o.O)(),f("design:type",o.v)],e.prototype,"completionChanged",void 0),e=l([Object(o.m)({selector:"core-course-module",template:'<a *ngIf="module && module.visibleoncoursepage !== 0" ion-item text-wrap id="core-course-module-{{module.id}}" class="core-course-module-handler {{module.handlerData.class}}" (click)="moduleClicked($event)" [ngClass]="{\'item-media\': module.handlerData.icon, \'core-not-clickable\': !module.handlerData.action || !module.uservisible === false, \'item-dimmed\': module.visible === 0 || module.uservisible === false}" title="{{ module.handlerData.title }}" detail-none>\n\n    <img item-start *ngIf="module.handlerData.icon" [src]="module.handlerData.icon" alt="" role="presentation" class="core-module-icon">\n    <div class="core-module-title">\n        <core-format-text [text]="module.handlerData.title"></core-format-text>\n\n        \x3c!-- Buttons. --\x3e\n        <div item-end *ngIf="module.uservisible !== false" class="buttons core-module-buttons" [ngClass]="{\'core-button-completion\': module.completionstatus}">\n            \x3c!-- Module completion. --\x3e\n            <core-course-module-completion *ngIf="module.completionstatus" [completion]="module.completionstatus" [moduleName]="module.name" (completionChanged)="completionChanged.emit()"></core-course-module-completion>\n\n            <div class="core-module-buttons-more">\n                \x3c!-- Download button. --\x3e\n                <button *ngIf="downloadEnabled && showDownload" [hidden]="spinner || module.handlerData.spinner" ion-button icon-only clear (click)="download($event, false)" color="dark" class="core-animate-show-hide" [attr.aria-label]="\'core.download\' | translate">\n                    <ion-icon name="cloud-download"></ion-icon>\n                </button>\n\n                \x3c!-- Refresh button. --\x3e\n                <button *ngIf="downloadEnabled && showRefresh" [hidden]="spinner || module.handlerData.spinner" ion-button icon-only clear (click)="download($event, true)" color="dark" class="core-animate-show-hide" [attr.aria-label]="\'core.refresh\' | translate">\n                    <ion-icon name="refresh"></ion-icon>\n                </button>\n\n                \x3c!-- Buttons defined by the module handler. --\x3e\n                <button ion-button icon-only clear *ngFor="let button of module.handlerData.buttons" [hidden]="button.hidden || spinner || module.handlerData.spinner" (click)="buttonClicked($event, button)" color="dark" class="core-animate-show-hide" [attr.aria-label]="button.label | translate">\n                    <core-icon [name]="button.icon" [ios]="button.iosIcon || \'\'" [md]="button.mdIcon || \'\'"></core-icon>\n                </button>\n\n                \x3c!-- Spinner. --\x3e\n                <ion-spinner *ngIf="spinner || module.handlerData.spinner" class="core-animate-show-hide"></ion-spinner>\n            </div>\n        </div>\n    </div>\n    <div *ngIf="module.visible === 0 || module.availabilityinfo">\n        <ion-badge item-end *ngIf="module.visible === 0">{{ \'core.course.hiddenfromstudents\' | translate }}</ion-badge>\n        <ion-badge item-end *ngIf="module.availabilityinfo"><core-format-text [text]="module.availabilityinfo"></core-format-text></ion-badge>\n    </div>\n    <core-format-text class="core-module-description" *ngIf="module.description" maxHeight="80" [text]="module.description"></core-format-text>\n</a>'}),p(0,Object(o.N)()),f("design:paramtypes",[r.q,u.a,a.a,c.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(1),i=n(2),s=n(8),a=n(11),c=n(26),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,r,i){this.textUtils=e,this.domUtils=t,this.translate=n,this.sitesProvider=r,this.userProvider=i,this.completionChanged=new o.v}return e.prototype.ngOnChanges=function(e){e.completion&&this.completion&&this.showStatus()},e.prototype.completionClicked=function(e){var t=this;if(this.completion){if(void 0===this.completion.cmid||1!==this.completion.tracking)return;e.preventDefault(),e.stopPropagation();var n=this.domUtils.showModalLoading(),o={cmid:this.completion.cmid,completed:1===this.completion.state?0:1};this.sitesProvider.getCurrentSite().write("core_completion_update_activity_completion_status_manually",o).then(function(e){if(!e.status)return Promise.reject(null);t.completionChanged.emit()}).catch(function(e){t.domUtils.showErrorModalDefault(e,"core.errorchangecompletion",!0)}).finally(function(){n.dismiss()})}},e.prototype.showStatus=function(){var e,t,n=this,o=this.moduleName||"";1===this.completion.tracking&&0===this.completion.state?(t="completion-manual-n",e="core.completion-alt-manual-n"):1===this.completion.tracking&&1===this.completion.state?(t="completion-manual-y",e="core.completion-alt-manual-y"):2===this.completion.tracking&&0===this.completion.state?(t="completion-auto-n",e="core.completion-alt-auto-n"):2===this.completion.tracking&&1===this.completion.state?(t="completion-auto-y",e="core.completion-alt-auto-y"):2===this.completion.tracking&&2===this.completion.state?(t="completion-auto-pass",e="core.completion-alt-auto-pass"):2===this.completion.tracking&&3===this.completion.state&&(t="completion-auto-fail",e="core.completion-alt-auto-fail"),t&&(this.completion.overrideby>0&&(t+="-override"),this.completionImage="assets/img/completion/"+t+".svg"),o&&this.textUtils.formatText(o,!0,!0,50).then(function(t){var o;return n.completion.overrideby>0?(e+="-override",o=n.userProvider.getProfile(n.completion.overrideby,n.completion.courseId,!0).then(function(e){return{overrideuser:e.fullname,modname:t}})):o=Promise.resolve(t),o.then(function(t){n.completionDescription=n.translate.instant(e,{$a:t})})})},u([Object(o.D)(),d("design:type",Object)],e.prototype,"completion",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"moduleName",void 0),u([Object(o.O)(),d("design:type",o.v)],e.prototype,"completionChanged",void 0),e=u([Object(o.m)({selector:"core-course-module-completion",template:'<a *ngIf="completion" (click)="completionClicked($event)">\n    <img [src]="completionImage" [alt]="completionDescription" [title]="completionDescription">\n</a>'}),d("design:paramtypes",[a.a,s.a,r.c,i.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){}return r([Object(o.D)(),i("design:type",String)],e.prototype,"description",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"note",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"component",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"componentId",void 0),r([Object(o.D)(),i("design:type",Object)],e.prototype,"showFull",void 0),e=r([Object(o.m)({selector:"core-course-module-description",template:'<ion-card *ngIf="description">\n    <ion-item text-wrap>\n        <core-format-text [text]="description" [component]="component" [componentId]="componentId" [maxHeight]="showFull && showFull !== \'false\' ? 0 : 120" fullOnClick="true"></core-format-text>\n    </ion-item>\n    <ion-item text-wrap *ngIf="note">\n        <ion-note item-end>{{ note }}</ion-note>\n    </ion-item>\n</ion-card>'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(52),i=n(108),s=n(110),a=n(156),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.injector=e,this.feedbackDelegate=t,this.assignProvider=n,this.assignHelper=o,this.component=r.a.COMPONENT,this.text="",this.files=[]}return e.prototype.ngOnInit=function(){var e=this;this.plugin?(this.plugin.name=this.feedbackDelegate.getPluginName(this.plugin),this.plugin.name?(this.edit=this.edit&&"false"!==this.edit,this.canEdit=this.canEdit&&"false"!==this.canEdit,this.feedbackDelegate.getComponentForPlugin(this.injector,this.plugin).then(function(t){e.pluginComponent=t,t?e.data={assign:e.assign,submission:e.submission,plugin:e.plugin,userId:e.userId,configs:e.assignHelper.getPluginConfig(e.assign,"assignfeedback",e.plugin.type),edit:e.edit,canEdit:e.canEdit}:(e.text=e.assignProvider.getSubmissionPluginText(e.plugin),e.files=e.assignProvider.getSubmissionPluginAttachments(e.plugin),e.notSupported=e.feedbackDelegate.isPluginSupported(e.plugin.type),e.pluginLoaded=!0)})):this.pluginLoaded=!0):this.pluginLoaded=!0},e.prototype.invalidate=function(){return Promise.resolve(this.dynamicComponent&&this.dynamicComponent.callComponentFunction("invalidate",[]))},c([Object(o._9)(a.a),u("design:type",a.a)],e.prototype,"dynamicComponent",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"assign",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"submission",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"plugin",void 0),c([Object(o.D)(),u("design:type",Number)],e.prototype,"userId",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"canEdit",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"edit",void 0),e=c([Object(o.m)({selector:"addon-mod-assign-feedback-plugin",template:'\n<core-dynamic-component [component]="pluginComponent" [data]="data">\n    \x3c!-- This content will be replaced by the component if found. --\x3e\n    <core-loading [hideUntil]="pluginLoaded">\n        <ion-item text-wrap *ngIf="text.length > 0 || files.length > 0">\n            <h2>{{ plugin.name }}</h2>\n            <ion-badge *ngIf="notSupported" color="primary">\n                {{ \'addon.mod_assign.feedbacknotsupported\' | translate }}\n            </ion-badge>\n            <p *ngIf="text">\n                <core-format-text [component]="component" [componentId]="assign.cmid" [maxHeight]="80" [fullOnClick]="true" [fullTitle]="plugin.name" [text]="text"></core-format-text>\n            </p>\n            <core-file *ngFor="let file of files" [file]="file" [component]="component" [componentId]="assign.cmid" [alwaysDownload]="true"></core-file>\n        </ion-item>\n    </core-loading>\n</core-dynamic-component>\n'}),u("design:paramtypes",[o.C,s.a,r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.action=new o.v}return r([Object(o.D)(),i("design:type",String)],e.prototype,"previous",void 0),r([Object(o.D)(),i("design:type",String)],e.prototype,"next",void 0),r([Object(o.O)(),i("design:type",o.v)],e.prototype,"action",void 0),e=r([Object(o.m)({selector:"addon-mod-book-navigation-arrows",template:'<ion-grid>\n    <ion-row>\n        <ion-col>\n            <a ion-button icon-only clear *ngIf="previous > 0" (click)="action.emit(previous)" title="{{ \'core.previous\' | translate }}">\n                <ion-icon name="arrow-back" md="ios-arrow-back"></ion-icon>\n            </a>\n        </ion-col>\n        <ion-col text-right>\n            <a ion-button icon-only clear *ngIf="next > 0" (click)="action.emit(next)" title="{{ \'core.next\' | translate }}">\n                <ion-icon name="arrow-forward" md="ios-arrow-forward"></ion-icon>\n            </a>\n        </ion-col>\n    </ion-row>\n</ion-grid>\n'}),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(329),s=n(8),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},d=function(){function e(e,t,n,r,i,s){this.compileProvider=e,this.cdr=t,this.navCtrl=r,this.domUtils=s,this.extraImports=[],this.extraProviders=[],this.created=new o.v,this.element=n.nativeElement,this.differ=i.find([]).create()}return e.prototype.ngDoCheck=function(){if(this.componentInstance){var e=this.differ.diff(this.jsData);e&&(this.setInputData(),this.componentInstance.ngOnChanges&&this.componentInstance.ngOnChanges(this.domUtils.createChangesFromKeyValueDiff(e)))}},e.prototype.ngOnChanges=function(e){var t=this;(e.text||e.javascript)&&this.text&&this.compileProvider.createAndCompileComponent(this.text,this.getComponentClass(),this.extraImports).then(function(e){t.componentRef&&t.componentRef.destroy(),e&&(t.componentRef=t.container.createComponent(e),t.created.emit(t.componentRef.instance)),t.loaded=!0})},e.prototype.ngOnDestroy=function(){this.componentRef&&this.componentRef.destroy()},e.prototype.getComponentClass=function(){var e=this;return function(){function t(){e.componentInstance=this,this.dataObject={},this.dataArray=[],e.compileProvider.injectLibraries(this,e.extraProviders),this.ChangeDetectorRef=e.cdr,this.NavController=e.navCtrl,this.componentContainer=e.element,e.setInputData()}return t.prototype.ngOnInit=function(){e.javascript&&e.compileProvider.executeJavascript(this,e.javascript)},t}()},e.prototype.setInputData=function(){if(this.componentInstance)for(var e in this.jsData)this.componentInstance[e]=this.jsData[e]},a([Object(o.D)(),c("design:type",String)],e.prototype,"text",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"javascript",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"jsData",void 0),a([Object(o.D)(),c("design:type",Array)],e.prototype,"extraImports",void 0),a([Object(o.D)(),c("design:type",Array)],e.prototype,"extraProviders",void 0),a([Object(o.O)(),c("design:type",o.v)],e.prototype,"created",void 0),a([Object(o._9)("dynamicComponent",{read:o._11}),c("design:type",o._11)],e.prototype,"container",void 0),e=a([Object(o.m)({selector:"core-compile-html",template:'<core-loading [hideUntil]="loaded"><ng-container #dynamicComponent></ng-container></core-loading>'}),u(3,Object(o.N)()),c("design:paramtypes",[i.a,o.j,o.t,r.q,o.F,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(330),i=n(745),s=n(97),a=n(16),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){e.registerHandler(t)}return e=c([Object(o.I)({declarations:[r.a],imports:[a.a],providers:[i.a],exports:[r.a],entryComponents:[r.a]}),u("design:paramtypes",[s.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1374),i=n(97),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],imports:[],providers:[r.a],exports:[]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(745),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.name="CoreCourseFormatSocial",t.format="social",t}return i(t,e),t=s([Object(o.A)()],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1376),i=n(97),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],imports:[],providers:[r.a],exports:[]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="CoreCourseFormatTopics",this.format="topics"}return e.prototype.isEnabled=function(){return!0},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1378),i=n(97),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],imports:[],providers:[r.a],exports:[]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(22),i=n(30),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.timeUtils=e,this.name="CoreCourseFormatWeeks",this.format="weeks"}return e.prototype.isEnabled=function(){return!0},e.prototype.getCurrentSection=function(e,t){var n=this.timeUtils.timestamp();if(n<e.startdate||e.enddate&&n>e.enddate)return t[1];for(var o=0;o<t.length;o++){var r=t[o];if(!(void 0===r.section||r.section<1)){var i=this.getSectionDates(r,e.startdate);if(n>=i.start&&n<i.end)return r}}return t[1]},e.prototype.getSectionDates=function(e,t){var n={start:(t+=7200)+i.a.SECONDS_WEEK*(e.section-1),end:0};return n.end=n.start+i.a.SECONDS_WEEK,n},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(41),i=n(250),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.coursesProvider=e,this.myOverviewProvider=t,this.name="CoreCourses",this.priority=1100}return e.prototype.isEnabled=function(){var e=this;return this.myOverviewProvider.isEnabled().then(function(t){return e.isOverviewEnabled=t,!!t||!e.coursesProvider.isMyCoursesDisabledInSite()})},e.prototype.getDisplayData=function(){return this.isOverviewEnabled?{icon:"home",title:"core.courses.courseoverview",page:"CoreCoursesMyOverviewPage",class:"core-courseoverview-handler"}:{icon:"fa-graduation-cap",title:"core.courses.mycourses",page:"CoreCoursesMyCoursesPage",class:"core-mycourses-handler"}},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1),i=n(2),s=n(8),a=n(31),c=n(71),u=n(10),d=n(41),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,i,s){var a=e.call(this)||this;return a.sitesProvider=t,a.coursesProvider=n,a.loginHelper=o,a.domUtils=r,a.translate=i,a.courseProvider=s,a.name="CoreCoursesCourseLinkHandler",a.pattern=/((\/enrol\/index\.php)|(\/course\/enrol\.php)|(\/course\/view\.php)).*([\?\&]id=\d+)/,a.waitStart=0,a}return l(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;o=parseInt(n.id,10);var i=n.sectionid?parseInt(n.sectionid,10):null,s=void 0!==n.section?parseInt(n.section,10):NaN,a={course:{id:o},sectionId:i||null};return isNaN(s)||(a.sectionNumber=s),[{action:function(e,n){(e=e||r.sitesProvider.getCurrentSiteId())==r.sitesProvider.getCurrentSiteId()?r.actionEnrol(o,t,a).catch(function(){}):r.loginHelper.redirect("CoreCourseSectionPage",a,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return!!(o=parseInt(n.id,10))&&this.sitesProvider.getSiteHomeId(e).then(function(e){return o!=e})},t.prototype.actionEnrol=function(e,t,n){var o=this,r=this.domUtils.showModalLoading(),i=!!t.match(/(\/enrol\/index\.php)|(\/course\/enrol\.php)/);return this.coursesProvider.getUserCourse(e).catch(function(){return o.canSelfEnrol(e).then(function(){r.dismiss();return(i?Promise.resolve():o.domUtils.showConfirm(o.translate.instant("core.courses.confirmselfenrol"))).then(function(){return o.selfEnrol(e).catch(function(e){return e&&o.domUtils.showErrorModal(e),Promise.reject(null)})},function(){return o.courseProvider.getSections(e,!1,!0)})},function(n){return o.courseProvider.getSections(e,!1,!0).catch(function(){r.dismiss(),n&&(n=n.message||n.error||n.content||n.body||n),n||(n=o.translate.instant("core.courses.notenroled"));var e=o.translate.instant("core.twoparagraphs",{p1:n,p2:o.translate.instant("core.confirmopeninbrowser")});return o.domUtils.showConfirm(e).then(function(){o.sitesProvider.getCurrentSite().openInBrowserWithAutoLogin(t)}).catch(function(){}),Promise.reject(null)})})}).then(function(){r.dismiss(),o.loginHelper.redirect("CoreCourseSectionPage",n,o.sitesProvider.getCurrentSiteId())})},t.prototype.canSelfEnrol=function(e){return this.coursesProvider.getCourseEnrolmentMethods(e).then(function(e){var t=!1,n=0;if(e.forEach(function(e){"self"==e.type&&e.status&&(t=!0,n++)}),!t||1!=n)return Promise.reject(null)})},t.prototype.selfEnrol=function(e,t){var n=this,o=this.domUtils.showModalLoading();return this.coursesProvider.selfEnrol(e,t).then(function(){return n.coursesProvider.invalidateUserCourses().catch(function(){}).then(function(){return n.waitForEnrolled(e,!0).finally(function(){o.dismiss()})})}).catch(function(r){if(o.dismiss(),r&&r.code===d.a.ENROL_INVALID_KEY){var i=n.translate.instant("core.courses.selfenrolment"),s=n.translate.instant("core.courses.password");return void 0!==t&&n.domUtils.showErrorModal(r.message),n.domUtils.showPrompt(" ",i,s).then(function(t){return n.selfEnrol(e,t)})}return Promise.reject(r)})},t.prototype.waitForEnrolled=function(e,t){var n=this;return t&&(this.waitStart=Date.now()),this.coursesProvider.invalidateUserCourses().catch(function(){}).then(function(){return n.coursesProvider.getUserCourse(e)}).catch(function(){if(!(Date.now()-n.waitStart>6e4))return new Promise(function(t,o){setTimeout(function(){n.waitForEnrolled(e).then(t)},5e3)})})},t=f([Object(o.A)(),p("design:paramtypes",[i.a,d.a,c.a,s.a,r.c,u.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(71),s=n(41),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.coursesProvider=t,o.loginHelper=n,o.name="CoreCoursesIndexLinkHandler",o.featureName="CoreMainMenuDelegate_CoreCourses",o.pattern=/\/course\/?(index\.php.*)?$/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o="CoreCoursesMyCoursesPage",i={};r.coursesProvider.isGetCoursesByFieldAvailable()&&(n.categoryid?(o="CoreCoursesCategoriesPage",i.categoryId=parseInt(n.categoryid,10)):o="CoreCoursesAvailableCoursesPage"),r.loginHelper.redirect(o,i,e)}}]},t=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(31),i=n(71),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.loginHelper=t,n.name="CoreCoursesMyOverviewLinkHandler",n.featureName="CoreMainMenuDelegate_CoreCourses",n.pattern=/\/my\/?$/,n}return s(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.loginHelper.redirect("CoreCoursesMyOverviewPage",void 0,e)}}]},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(9),i=n(6),s=n(107),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.appProvider=e,this.utils=t,this.uploaderHelper=n,this.name="CoreFileUploaderAlbum",this.priority=2e3}return e.prototype.isEnabled=function(){return this.appProvider.isMobile()},e.prototype.getSupportedMimetypes=function(e){return this.utils.filterByRegexp(e,/^(image|video)\//)},e.prototype.getData=function(){var e=this;return{title:"core.fileuploader.photoalbums",class:"core-fileuploader-album-handler",icon:"images",action:function(t,n,o,r){return e.uploaderHelper.uploadImage(!0,t,n,r).then(function(e){return{treated:!0,result:e}})}}},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(9),s=n(6),a=n(107),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.appProvider=e,this.utils=t,this.platform=n,this.uploaderHelper=o,this.name="CoreFileUploaderAudio",this.priority=1600}return e.prototype.isEnabled=function(){return this.appProvider.isMobile()||this.appProvider.canGetUserMedia()&&this.appProvider.canRecordMedia()},e.prototype.getSupportedMimetypes=function(e){if(this.platform.is("ios"))return this.utils.filterByRegexp(e,/^audio\/wav$/);if(this.platform.is("android"))return this.utils.filterByRegexp(e,/^audio\//);var t=window.MediaRecorder;return t?e.filter(function(e){var n=e.match(/^audio\//);return n&&n.length&&t.isTypeSupported(e)}):[]},e.prototype.getData=function(){var e=this;return{title:"core.fileuploader.audio",class:"core-fileuploader-audio-handler",icon:"microphone",action:function(t,n,o,r){return e.uploaderHelper.uploadAudioOrVideo(!0,t,n,r).then(function(e){return{treated:!0,result:e}})}}},e=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a,r.s,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(9),i=n(6),s=n(107),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.appProvider=e,this.utils=t,this.uploaderHelper=n,this.name="CoreFileUploaderCamera",this.priority=1800}return e.prototype.isEnabled=function(){return this.appProvider.isMobile()||this.appProvider.canGetUserMedia()},e.prototype.getSupportedMimetypes=function(e){return this.utils.filterByRegexp(e,/^image\/(jpeg|png)$/)},e.prototype.getData=function(){var e=this;return{title:"core.fileuploader.camera",class:"core-fileuploader-camera-handler",icon:"camera",action:function(t,n,o,r){return e.uploaderHelper.uploadImage(!1,t,n,r).then(function(e){return{treated:!0,result:e}})}}},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(9),s=n(8),a=n(22),c=n(107),u=n(56),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.appProvider=e,this.platform=t,this.timeUtils=n,this.uploaderHelper=o,this.uploaderProvider=r,this.domUtils=i,this.name="CoreFileUploaderFile",this.priority=1200}return e.prototype.isEnabled=function(){return this.platform.is("android")||!this.appProvider.isMobile()||this.platform.is("ios")&&this.platform.version().major>=9},e.prototype.getSupportedMimetypes=function(e){return e},e.prototype.getData=function(){var e=this,t=this.platform.is("ios");return{title:t?"core.fileuploader.more":"core.fileuploader.file",class:"core-fileuploader-file-handler",icon:t?"more":"folder",afterRender:function(n,o,r,i){var s=document.querySelector(".core-fileuploader-file-handler");if(s){var a=document.createElement("input");a.setAttribute("type","file"),!i||!i.length||e.platform.is("android")&&1!=i.length||a.setAttribute("accept",i.join(", ")),a.addEventListener("change",function(s){var c,u=a.files[0];if(a.value="",u){var d=e.uploaderProvider.isInvalidMimetype(i,u.name,u.type);if(d)e.domUtils.showErrorModal(d);else{if(c=u.name,t){var l=c.match(/image\.(jpe?g|png)/);l&&(c="image_"+e.timeUtils.readableTimestamp()+"."+l[1])}e.uploaderHelper.uploadFileObject(u,n,o,r,c).then(function(t){e.uploaderHelper.fileUploaded(t)}).catch(function(t){t&&e.domUtils.showErrorModal(t)})}}}),s.appendChild(a)}}}},e=d([Object(o.A)(),l("design:paramtypes",[i.a,r.s,a.a,c.a,u.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(9),s=n(6),a=n(107),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.appProvider=e,this.utils=t,this.platform=n,this.uploaderHelper=o,this.name="CoreFileUploaderVideo",this.priority=1400}return e.prototype.isEnabled=function(){return this.appProvider.isMobile()||this.appProvider.canGetUserMedia()&&this.appProvider.canRecordMedia()},e.prototype.getSupportedMimetypes=function(e){if(this.platform.is("ios"))return this.utils.filterByRegexp(e,/^video\/quicktime$/);if(this.platform.is("android"))return this.utils.filterByRegexp(e,/^video\//);var t=window.MediaRecorder;return t?e.filter(function(e){var n=e.match(/^video\//);return n&&n.length&&t.isTypeSupported(e)}):[]},e.prototype.getData=function(){var e=this;return{title:"core.fileuploader.video",class:"core-fileuploader-video-handler",icon:"videocam",action:function(t,n,o,r){return e.uploaderHelper.uploadAudioOrVideo(!1,t,n,r).then(function(e){return{treated:!0,result:e}})}}},e=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a,r.s,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(94),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.gradesProvider=e,this.name="CoreGrades",this.priority=600}return e.prototype.isEnabled=function(){return this.gradesProvider.isCourseGradesEnabled()},e.prototype.getDisplayData=function(){return{icon:"stats",title:"core.grades.grades",page:"CoreGradesCoursesPage",class:"core-grades-coursesgrades-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(10),i=n(94),s=n(41),a=n(749),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){this.gradesProvider=e,this.coursesProvider=t,this.name="CoreGrades",this.priority=400}return e.prototype.invalidateEnabledForCourse=function(e,t,n){return t&&void 0!==t.grades?Promise.resolve():this.coursesProvider.invalidateUserCourses()},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForCourse=function(e,t,n,o){return(!t||t.type!=r.a.ACCESS_GUEST)&&(n&&void 0!==n.grades?n.grades:this.gradesProvider.isPluginEnabledForCourse(e))},e.prototype.getDisplayData=function(e,t){return{title:"core.grades.grades",class:"core-grades-course-handler",component:a.a}},e=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(32),s=n(94),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.linkHelper=t,o.gradesProvider=n,o.name="CoreGradesUserLinkHandler",o.pattern=/\/grade\/report\/user\/index.php/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var i={course:{id:o},userId:!!n.userid&&parseInt(n.userid,10)};r.linkHelper.goInSite(t,"CoreGradesCoursePage",i,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return!!o&&this.gradesProvider.isPluginEnabledForCourse(o,e)},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(32),s=n(94),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.linkHelper=t,o.gradesProvider=n,o.name="CoreGradesOverviewLinkHandler",o.pattern=/\/grade\/report\/overview\/index.php/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.linkHelper.goInSite(t,"CoreGradesCoursesPage",void 0,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return this.gradesProvider.isCourseGradesEnabled(e)},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(57),i=n(2),s=n(32),a=n(94),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.linkHelper=e,this.sitesProvider=t,this.gradesProvider=n,this.name="CoreGrades:viewGrades",this.priority=400,this.type=r.a.TYPE_NEW_PAGE,this.viewGradesEnabledCache={}}return e.prototype.clearViewGradesCache=function(e,t){e&&t?delete this.viewGradesEnabledCache[this.getCacheKey(e,t)]:this.viewGradesEnabledCache={}},e.prototype.getCacheKey=function(e,t){return e+"#"+t},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForUser=function(e,t,n,o){var r=this,i=this.getCacheKey(t,e.id),s=this.viewGradesEnabledCache[i];return void 0!==s?s:this.gradesProvider.isPluginEnabledForCourse(t).then(function(){return r.gradesProvider.getCourseGradesTable(t,e.id).then(function(){return r.viewGradesEnabledCache[i]=!0,!0}).catch(function(){return r.viewGradesEnabledCache[i]=!1,!1})})},e.prototype.getDisplayData=function(e,t){var n=this;return{icon:"stats",title:"core.grades.grades",class:"core-grades-user-handler",action:function(e,t,o,r){e.preventDefault(),e.stopPropagation();n.linkHelper.goInSite(t,"CoreGradesCoursePage",{courseId:r,userId:o.id})}}},e=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(4),i=n(406),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.sharedFilesHelper=e,this.platform=t,this.name="CoreSharedFilesUpload",this.priority=1300}return e.prototype.isEnabled=function(){return this.platform.is("ios")},e.prototype.getSupportedMimetypes=function(e){return e},e.prototype.getData=function(){var e=this;return{title:"core.sharedfiles.sharedfiles",class:"core-sharedfiles-fileuploader-handler",icon:"folder",action:function(t,n,o,r){return e.sharedFilesHelper.pickSharedFile(r)}}},e=s([Object(o.A)(),a("design:paramtypes",[i.a,r.s])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(157),i=n(250),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.siteHomeProvider=e,this.myOverviewProvider=t,this.name="CoreSiteHome",this.priority=1200}return e.prototype.isEnabled=function(){var e=this;return this.myOverviewProvider.isEnabled().then(function(t){return!t&&e.siteHomeProvider.isAvailable()})},e.prototype.getDisplayData=function(){return{icon:"home",title:"core.sitehome.sitehome",page:"CoreSiteHomeIndexPage",class:"core-sitehome-handler"}},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(2),i=n(31),s=n(71),a=n(157),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this)||this;return r.sitesProvider=t,r.siteHomeProvider=n,r.loginHelper=o,r.name="CoreSiteHomeIndexLinkHandler",r.featureName="CoreMainMenuDelegate_CoreSiteHome",r.pattern=/\/course\/view\.php.*([\?\&]id=\d+)/,r}return c(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.loginHelper.redirect("CoreSiteHomeIndexPage",void 0,e)}}]},t.prototype.isEnabled=function(e,t,n,o){var r=this;return!!(o=parseInt(n.id,10))&&this.sitesProvider.getSite(e).then(function(t){return o==t.getSiteHomeId()&&r.siteHomeProvider.isAvailable(e).then(function(){return!0}).catch(function(){return!1})})},t=u([Object(o.A)(),d("design:paramtypes",[r.a,a.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(57),i=n(2),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.sitesProvider=e,this.name="CoreUserProfileMail",this.priority=700,this.type=r.a.TYPE_COMMUNICATION}return e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForUser=function(e,t,n,o){return e.id!=this.sitesProvider.getCurrentSite().getUserId()&&e.email},e.prototype.getDisplayData=function(e,t){return{icon:"mail",title:"core.user.sendemail",class:"core-user-profile-mail",action:function(e,t,n,o){e.preventDefault(),e.stopPropagation(),window.open("mailto:"+n.email,"_blank")}}},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(31),i=n(32),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.linkHelper=t,n.name="CoreUserProfileLinkHandler",n.pattern=/((\/user\/view\.php)|(\/user\/profile\.php)).*([\?\&]id=\d+)/,n}return s(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o={courseId:n.course,userId:parseInt(n.id,10)};r.linkHelper.goInSite(t,"CoreUserProfilePage",o,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return-1==t.indexOf("/grade/report/")},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(10),i=n(26),s=n(760),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.userProvider=e,this.name="CoreUserParticipants",this.priority=600}return e.prototype.invalidateEnabledForCourse=function(e,t,n){return t&&void 0!==t.participants?Promise.resolve():this.userProvider.invalidateParticipantsList(e)},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForCourse=function(e,t,n,o){return(!t||t.type!=r.a.ACCESS_GUEST)&&(n&&void 0!==n.participants?n.participants:this.userProvider.isPluginEnabledForCourse(e))},e.prototype.getDisplayData=function(e,t){return{title:"core.user.participants",class:"core-user-participants-handler",component:s.a}},e=a([Object(o.A)(),c("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(71),s=n(26),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.userProvider=t,o.loginHelper=n,o.name="CoreUserParticipants",o.featureName="CoreCourseOptionsDelegate_CoreUserParticipants",o.pattern=/\/user\/index\.php/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=parseInt(n.id,10)||o,[{action:function(e,t){r.loginHelper.redirect("CoreUserParticipantsPage",{courseId:o},e)}}]},t.prototype.isEnabled=function(e,t,n,o){return!(!(o=parseInt(n.id,10)||o)||-1!=t.indexOf("/grade/report/"))&&this.userProvider.isPluginEnabledForCourse(o,e)},t=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(119),i=n(6),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t,n){this.ufDelegate=e,this.utilsProvider=t,this.injector=n,this.signup=!1,this.edit=!1,this.data={}}return e.prototype.ngOnInit=function(){var e=this;this.ufDelegate.getComponent(this.injector,this.field,this.signup).then(function(t){e.componentClass=t}),this.data.field=this.field,this.data.edit=this.utilsProvider.isTrueOrOne(this.edit),this.edit&&(this.data.signup=this.utilsProvider.isTrueOrOne(this.signup),this.data.disabled=this.utilsProvider.isTrueOrOne(this.field.locked),this.data.form=this.form)},s([Object(o.D)(),a("design:type",Object)],e.prototype,"field",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"signup",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"edit",void 0),s([Object(o.D)(),a("design:type",Object)],e.prototype,"form",void 0),s([Object(o.D)(),a("design:type",String)],e.prototype,"registerAuth",void 0),e=s([Object(o.m)({selector:"core-user-profile-field",template:'<core-dynamic-component [component]="componentClass" [data]="data"></core-dynamic-component>\n'}),a("design:paramtypes",[r.a,i.a,o.C])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(9),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.appProvider=e}return e.prototype.clear=function(){return Promise.reject("clear is only supported in mobile devices")},e.prototype.set=function(e){if(!this.appProvider.isDesktop())return Promise.reject("set is not supported in browser");try{return n(114).remote.app.setBadgeCount(e)?Promise.resolve():Promise.reject(null)}catch(e){return Promise.reject(e)}},e.prototype.get=function(){if(!this.appProvider.isDesktop())return Promise.reject("get is not supported in browser");try{var e=n(114).remote.app;return Promise.resolve(e.getBadgeCount())}catch(e){return Promise.reject(e)}},e.prototype.increase=function(e){return Promise.reject("increase is only supported in mobile devices")},e.prototype.decrease=function(e){return Promise.reject("decrease is only supported in mobile devices")},e.prototype.isSupported=function(){return Promise.reject("isSupported is only supported in mobile devices")},e.prototype.hasPermission=function(){return Promise.reject("hasPermission is only supported in mobile devices")},e.prototype.requestPermission=function(){return Promise.reject("requestPermission is only supported in mobile devices")},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(324),i=n(226),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.captureHelper=t,n}return s(t,e),t.prototype.cleanup=function(){return Promise.resolve()},t.prototype.getPicture=function(e){return this.captureHelper.captureMedia("image",e)},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(318),i=n(9),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var o=e.call(this)||this;return o.isDesktop=t.isDesktop(),o.isDesktop?o.clipboard=n(114).clipboard:(o.copyTextarea=document.createElement("textarea"),o.copyTextarea.className="core-browser-copy-area",o.copyTextarea.setAttribute("aria-hidden","true"),document.body.appendChild(o.copyTextarea)),o}return s(t,e),t.prototype.copy=function(e){var t=this;return new Promise(function(n,o){if(t.isDesktop)t.clipboard.writeText(e),n();else{t.copyTextarea.innerHTML=e,t.copyTextarea.select();try{document.execCommand("copy")?n():o()}catch(e){o()}t.copyTextarea.innerHTML=""}})},t.prototype.paste=function(){var e=this;return new Promise(function(t,n){if(e.isDesktop)t(e.clipboard.readText());else{e.copyTextarea.innerHTML="",e.copyTextarea.select();try{document.execCommand("paste")?t(e.copyTextarea.innerHTML):n()}catch(e){n()}e.copyTextarea.innerHTML=""}})},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(183),i=n(9),s=n(11),a=n(72),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n){var o=e.call(this)||this;return o.appProvider=t,o.textUtils=n,o}return c(t,e),t.prototype.checkDir=function(e,t){var n=this.textUtils.concatenatePaths(e,t);return this.resolveDirectoryUrl(n).then(function(){return!0})},t.prototype.checkFile=function(e,t){return this.resolveLocalFilesystemUrl(this.textUtils.concatenatePaths(e,t)).then(function(e){if(e.isFile)return!0;var t=new r.FileError(13);return t.message="input is not a file",Promise.reject(t)})},t.prototype.copyMock=function(e,t,n){var o=this;return new Promise(function(r,i){n=n.replace(/%20/g," "),e.copyTo(t,n,function(e){r(e)},function(e){o.fillErrorMessageMock(e),i(e)})})},t.prototype.copyDir=function(e,t,n,o){var r=this;return this.resolveDirectoryUrl(e).then(function(e){return r.getDirectory(e,t,{create:!1})}).then(function(e){return r.resolveDirectoryUrl(n).then(function(t){return r.copyMock(e,t,o)})})},t.prototype.copyFile=function(e,t,n,o){var r=this;return o=o||t,this.resolveDirectoryUrl(e).then(function(e){return r.getFile(e,t,{create:!1})}).then(function(e){return r.resolveDirectoryUrl(n).then(function(t){return r.copyMock(e,t,o)})})},t.prototype.createDir=function(e,t,n){var o=this,r={create:!0};return n||(r.exclusive=!0),this.resolveDirectoryUrl(e).then(function(e){return o.getDirectory(e,t,r)})},t.prototype.createFile=function(e,t,n){var o=this,r={create:!0};return n||(r.exclusive=!0),this.resolveDirectoryUrl(e).then(function(e){return o.getFile(e,t,r)})},t.prototype.createWriterMock=function(e){var t=this;return new Promise(function(n,o){e.createWriter(function(e){n(e)},function(e){t.fillErrorMessageMock(e),o(e)})})},t.prototype.fillErrorMessageMock=function(e){try{e.message=this.cordovaFileError[e.code]}catch(e){}},t.prototype.getDirectory=function(e,t,n){var o=this;return new Promise(function(r,i){try{t=t.replace(/%20/g," "),e.getDirectory(t,n,function(e){r(e)},function(e){o.fillErrorMessageMock(e),i(e)})}catch(e){o.fillErrorMessageMock(e),i(e)}})},t.prototype.getFile=function(e,t,n){var o=this;return new Promise(function(r,i){try{t=t.replace(/%20/g," "),e.getFile(t,n,r,function(e){o.fillErrorMessageMock(e),i(e)})}catch(e){o.fillErrorMessageMock(e),i(e)}})},t.prototype.getFreeDiskSpace=function(){return window.requestFileSystem?new Promise(function(e,t){var n=0,o=50,r=function(e,t){return new Promise(function(i,s){window.requestFileSystem(LocalFileSystem.PERSISTENT,e,function(){++n>o?i(e):r(e*t,t).then(i)},function(){i(e/t)})})};r(1048576,1.3).then(function(t){n=0,o=10,r(t,1.1).then(function(t){e(t/1024)})})}):Promise.reject(null)},t.prototype.listDir=function(e,t){var n=this;return this.resolveDirectoryUrl(e).then(function(e){return n.getDirectory(e,t,{create:!1,exclusive:!1})}).then(function(e){var t=e.createReader();return n.readEntriesMock(t)})},t.prototype.load=function(){var e=this;return new Promise(function(t,o){var r,i=window;if(void 0===i.requestFileSystem&&(i.requestFileSystem=i.webkitRequestFileSystem),void 0===i.resolveLocalFileSystemURL&&(i.resolveLocalFileSystemURL=i.webkitResolveLocalFileSystemURL),i.LocalFileSystem={PERSISTENT:1},e.appProvider.isDesktop()){var s=n(1405),c=n(114).remote.app;if(!(r=c.getPath("documents")||c.getPath("home")))return void o("Cannot calculate base path for file system.");r=e.textUtils.concatenatePaths(r.replace(/\\/g,"/"),a.a.app_id)+"/",s.mkdir(r,function(e){!e||e&&"EEXIST"===e.code?t(r):o("Error creating base path.")})}else navigator.webkitPersistentStorage.requestQuota(524288e3,function(e){window.requestFileSystem(LocalFileSystem.PERSISTENT,e,function(e){r=e.root.toURL(),t(r)},o)},o)})},t.prototype.moveMock=function(e,t,n){var o=this;return new Promise(function(r,i){n=n.replace(/%20/g," "),e.moveTo(t,n,function(e){r(e)},function(e){o.fillErrorMessageMock(e),i(e)})})},t.prototype.moveDir=function(e,t,n,o){var r=this;return this.resolveDirectoryUrl(e).then(function(e){return r.getDirectory(e,t,{create:!1})}).then(function(e){return r.resolveDirectoryUrl(n).then(function(t){return r.moveMock(e,t,o)})})},t.prototype.moveFile=function(e,t,n,o){var r=this;return o=o||t,this.resolveDirectoryUrl(e).then(function(e){return r.getFile(e,t,{create:!1})}).then(function(e){return r.resolveDirectoryUrl(n).then(function(t){return r.moveMock(e,t,o)})})},t.prototype.readAsArrayBuffer=function(e,t){return this.readFileMock(e,t,"ArrayBuffer")},t.prototype.readAsBinaryString=function(e,t){return this.readFileMock(e,t,"BinaryString")},t.prototype.readAsDataURL=function(e,t){return this.readFileMock(e,t,"DataURL")},t.prototype.readAsText=function(e,t){return this.readFileMock(e,t,"Text")},t.prototype.readEntriesMock=function(e){var t=this;return new Promise(function(n,o){e.readEntries(function(e){n(e)},function(e){t.fillErrorMessageMock(e),o(e)})})},t.prototype.readFileMock=function(e,t,n){var o=this;return this.resolveDirectoryUrl(e).then(function(e){return o.getFile(e,t,{create:!1})}).then(function(e){var t=new FileReader;return new Promise(function(o,r){t.onloadend=function(){void 0!==t.result||null!==t.result?o(t.result):r(void 0!==t.error||null!==t.error?t.error:{code:null,message:"READER_ONLOADEND_ERR"})},e.file(function(e){t["readAs"+n].call(t,e)},function(e){r(e)})})})},t.prototype.removeMock=function(e){var t=this;return new Promise(function(n,o){e.remove(function(){n({success:!0,fileRemoved:e})},function(e){t.fillErrorMessageMock(e),o(e)})})},t.prototype.removeDir=function(e,t){var n=this;return this.resolveDirectoryUrl(e).then(function(e){return n.getDirectory(e,t,{create:!1})}).then(function(e){return n.removeMock(e)})},t.prototype.removeFile=function(e,t){var n=this;return this.resolveDirectoryUrl(e).then(function(e){return n.getFile(e,t,{create:!1})}).then(function(e){return n.removeMock(e)})},t.prototype.removeRecursively=function(e,t){var n=this;return this.resolveDirectoryUrl(e).then(function(e){return n.getDirectory(e,t,{create:!1})}).then(function(e){return n.rimrafMock(e)})},t.prototype.resolveDirectoryUrl=function(e){return this.resolveLocalFilesystemUrl(e).then(function(e){if(e.isDirectory)return e;var t=new r.FileError(13);return t.message="input is not a directory",Promise.reject(t)})},t.prototype.resolveLocalFilesystemUrl=function(e){var t=this;return new Promise(function(n,o){try{window.resolveLocalFileSystemURL(e,function(e){n(e)},function(e){t.fillErrorMessageMock(e),o(e)})}catch(e){t.fillErrorMessageMock(e),o(e)}})},t.prototype.rimrafMock=function(e){var t=this;return new Promise(function(n,o){e.removeRecursively(function(){n({success:!0,fileRemoved:e})},function(e){t.fillErrorMessageMock(e),o(e)})})},t.prototype.writeMock=function(e,t){return t instanceof Blob?this.writeFileInChunksMock(e,t):new Promise(function(n,o){e.onwriteend=function(t){e.error?o(e.error):n(t)},e.write(t)})},t.prototype.writeExistingFile=function(e,t,n){return this.writeFile(e,t,n,{replace:!0})},t.prototype.writeFile=function(e,t,n,o){var r=this;void 0===o&&(o={});var i={create:!o.append,exclusive:!o.replace};return this.resolveDirectoryUrl(e).then(function(e){return r.getFile(e,t,i)}).then(function(e){return r.writeFileEntryMock(e,n,o)})},t.prototype.writeFileEntryMock=function(e,t,n){var o=this;return this.createWriterMock(e).then(function(e){return n.append&&e.seek(e.length),n.truncate&&e.truncate(n.truncate),o.writeMock(e,t)}).then(function(){return e})},t.prototype.writeFileInChunksMock=function(e,t){var n=0,o=function(){var o=Math.min(1048576,t.size-n),r=t.slice(n,n+o);n+=o,e.write(r)};return new Promise(function(r,i){e.onerror=i,e.onwrite=function(){n<t.size?o():r()},o()})},t=u([Object(o.A)(),d("design:paramtypes",[i.a,s.a])],t)}(r.a)},,function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(319),i=n(9),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.appProvider=t,n}return s(t,e),t.prototype.appIsInstalled=function(e){return Promise.reject("appIsInstalled not supported in browser or dekstop.")},t.prototype.open=function(e,t){if(this.appProvider.isDesktop()){if(!n(114).ipcRenderer.sendSync("openItem",e))return Promise.reject("Error opening file")}else window.open(e,"_blank");return Promise.resolve()},t.prototype.uninstall=function(e){return Promise.reject("uninstall not supported in browser or dekstop.")},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(303),i=n(9),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.appProvider=t,n}return s(t,e),t.prototype.getCurrentlocale=function(){var e=navigator.userLanguage||navigator.language;try{return this.appProvider.isDesktop()?n(114).remote.app.getLocale()||e:e}catch(t){return e}},t.prototype.getLocaleName=function(){var e=this.getCurrentlocale();if(e)return Promise.resolve({value:e});var t={code:GlobalizationError.UNKNOWN_ERROR,message:"Cannot get language"};return Promise.reject(t)},t.prototype.getPreferredLanguage=function(){return this.getLocaleName()},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(221),i=n(9),s=n(27),a=n(47),c=n(1409),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o){var r=e.call(this)||this;return r.appProvider=t,r.fileProvider=n,r.urlUtils=o,r}return u(t,e),t.prototype.create=function(t,n,o){return void 0===o&&(o=""),this.appProvider.isDesktop()?new c.a(this.appProvider,this.fileProvider,this.urlUtils,t,n,o):e.prototype.create.call(this,t,n,o)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(96),r=(n.n(o),n(221)),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,o,r,i,s,a){void 0===a&&(a="");var c=e.call(this,i,s,a)||this;if(c.fileProvider=o,c.urlUtils=r,c.url=i,!t.isDesktop())return c;c.browserWindow=n(763).remote.BrowserWindow,c.screen=n(763).screen,c.isSSO=!(!i||!i.match(/\/launch\.php\?service=.+&passport=/)),c.isLinux=t.isLinux();var u,d=800,l=600,f={};if(screen&&(u=c.screen.getPrimaryDisplay())&&u.workArea&&(d=u.workArea.width||d,l=u.workArea.height||l),f.width=d,f.height=l,-1!=a.indexOf("hidden=yes")&&(f.show=!1),-1!=a.indexOf("location=no")&&(f.frame=!1),-1!=a.indexOf("fullscreen=yes")&&(f.fullscreen=!0),c.window=new c.browserWindow(f),c.window.loadURL(i),c.isLinux&&c.isSSO){c.window.webContents.setUserAgent("Mozilla/5.0 (iPad) AppleWebKit/603.3.8 (KHTML, like Gecko) Mobile/14G60")}return c}return i(t,e),t.prototype.close=function(){this.window.close()},t.prototype.executeScript=function(e){var t=this;return new Promise(function(n,o){e.code?t.window.webContents.executeJavaScript(e.code,!1,n):e.file?t.fileProvider.readFile(e.file).then(function(e){t.window.webContents.executeJavaScript(e,!1,n)}).catch(o):o("executeScript requires exactly one of code or file to be specified")})},t.prototype.getLaunchUrl=function(e){var t=this;return void 0===e&&(e=0),new Promise(function(n,o){var r=!1;t.window.webContents.executeJavaScript('var el = document.querySelector("#launchapp"); el && el.href;').then(function(e){r=!0,n(e)}),setTimeout(function(){r||(e>5?o():t.getLaunchUrl(e+1).then(n,o))},300)})},t.prototype.hide=function(){this.window.hide()},t.prototype.insertCSS=function(e){var t=this;return new Promise(function(n,o){e.code?(t.window.webContents.insertCSS(e.code),n()):e.file?t.fileProvider.readFile(e.file).then(function(e){t.window.webContents.insertCSS(e),n()}).catch(o):o("insertCSS requires exactly one of code or file to be specified")})},t.prototype.on=function(e){var t=this;return new o.Observable(function(n){var o=function(o,r){try{o.url=r||t.window.getURL(),o.type=e,n.next(o)}catch(e){}},r=function(e){t.urlUtils.removeUrlParams(t.url)==t.urlUtils.removeUrlParams(t.window.getURL())&&t.getLaunchUrl().then(function(t){t&&o(e,t)})};switch(e){case"loadstart":t.window.webContents.on("did-start-loading",o),t.isLinux&&t.isSSO&&t.window.webContents.on("did-finish-load",r);break;case"loadstop":t.window.webContents.on("did-finish-load",o);break;case"loaderror":t.window.webContents.on("did-fail-load",o);break;case"exit":t.window.on("close",o)}return function(){switch(e){case"loadstart":t.window.webContents.removeListener("did-start-loading",o),t.window.webContents.removeListener("did-finish-load",r);break;case"loadstop":t.window.webContents.removeListener("did-finish-load",o);break;case"loaderror":t.window.webContents.removeListener("did-fail-load",o);break;case"exit":t.window.removeListener("close",o)}}})},t.prototype.show=function(){this.window.show()},t}(r.b)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(224),i=n(9),s=n(11),a=n(6),c=n(30),u=n(72),d=n(5),l=(n.n(d),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o){var r=e.call(this)||this;return r.appProvider=t,r.utils=n,r.textUtils=o,r.toastTemplate='<toast><visual><binding template="ToastText02"><text id="1" hint-wrap="true">%s</text><text id="2" hint-wrap="true">%s</text></binding></visual></toast>',r.tileBindingTemplate='<text hint-style="base" hint-wrap="true">%s</text><text hint-style="captionSubtle" hint-wrap="true">%s</text>',r.tileTemplate='<tile><visual branding="nameAndLogo"><binding template="TileMedium">'+r.tileBindingTemplate+'</binding><binding template="TileWide">'+r.tileBindingTemplate+'</binding><binding template="TileLarge">'+r.tileBindingTemplate+"</binding></visual></tile>",r.DESKTOP_NOTIFS_TABLE="desktop_local_notifications",r.tableSchema={name:r.DESKTOP_NOTIFS_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"title",type:"TEXT"},{name:"text",type:"TEXT"},{name:"at",type:"INTEGER"},{name:"data",type:"TEXT"},{name:"triggered",type:"INTEGER"}]},r.scheduled={},r.triggered={},r.defaults={text:"",title:"",sound:"",badge:0,id:0,data:void 0,every:void 0,at:void 0},r.appDB=t.getDB(),r.appDB.createTableFromSchema(r.tableSchema),r.observers={schedule:[],trigger:[],click:[],update:[],clear:[],clearall:[],cancel:[],cancelall:[]},r}return l(t,e),t.prototype.cancel=function(e){var t=this,n=[];return e=Array.isArray(e)?e:[e],(e=this.convertIds(e)).forEach(function(e){t.scheduled[e]&&n.push(t.cancelNotification(e,!1,"cancel"))}),Promise.all(n)},t.prototype.cancelAll=function(){var e=this;return this.cancel(Object.keys(this.scheduled)).then(function(){e.triggerEvent("cancelall","foreground")})},t.prototype.cancelNotification=function(e,t,n){var o=this.scheduled[e].notification;clearTimeout(this.scheduled[e].timeout),clearInterval(this.scheduled[e].interval),delete this.scheduled[e],delete this.triggered[e],this.removeNotification(e),t||this.triggerEvent(n,o,"foreground")},t.prototype.clear=function(e){var t=this,n=[];return e=Array.isArray(e)?e:[e],(e=this.convertIds(e)).forEach(function(e){t.scheduled[e]&&t.scheduled[e].notification&&!t.scheduled[e].notification.every&&n.push(t.cancelNotification(e,!1,"clear"))}),Promise.all(n)},t.prototype.clearAll=function(){var e=this;return this.clear(Object.keys(this.scheduled)).then(function(){e.triggerEvent("clearall","foreground")})},t.prototype.convertIds=function(e){for(var t=[],n=0;n<e.length;n++)t.push(Number(e[n]));return t},t.prototype.convertProperties=function(e){return e.id&&(e.id=isNaN(e.id)?this.defaults.id:Number(e.id)),e.title&&(e.title=e.title.toString()),e.text&&(e.text=e.text.toString()),e.badge&&(e.badge=isNaN(e.badge)?this.defaults.badge:Number(e.badge)),e.at&&("object"==typeof e.at&&(e.at=e.at.getTime()),e.at=Math.round(e.at/1e3)),"object"==typeof e.data&&(e.data=JSON.stringify(e.data)),e},t.prototype.get=function(e){return Promise.resolve(this.getNotifications([Number(e)],!0,!0)[0])},t.prototype.getAll=function(){return Promise.resolve(this.getNotifications(void 0,!0,!0))},t.prototype.getAllIds=function(){var e=this.utils.mergeArraysWithoutDuplicates(Object.keys(this.scheduled),Object.keys(this.triggered));return e=e.map(function(e){return Number(e)}),Promise.resolve(e)},t.prototype.getAllNotifications=function(){var e=this;return this.appDB.getAllRecords(this.DESKTOP_NOTIFS_TABLE).then(function(t){return t.forEach(function(t){t.at=new Date(t.at),t.data=e.textUtils.parseJSON(t.data),t.triggered=!!t.triggered}),t})},t.prototype.getAllScheduled=function(){return Promise.resolve(this.getNotifications(void 0,!0,!1))},t.prototype.getAllTriggered=function(){return Promise.resolve(this.getNotifications(void 0,!1,!0))},t.prototype.getNotifications=function(e,t,n){var o=[];if(t)for(var r in this.scheduled)e&&-1==e.indexOf(Number(r))||o.push(this.scheduled[r].notification);if(n)for(var r in this.triggered)t&&this.scheduled[r]||e&&-1==e.indexOf(Number(r))||o.push(this.triggered[r].notification);return o},t.prototype.getScheduled=function(e){return Promise.resolve(this.getNotifications([Number(e)],!0,!1)[0])},t.prototype.getScheduledIds=function(){var e=Object.keys(this.scheduled).map(function(e){return Number(e)});return Promise.resolve(e)},t.prototype.getTriggered=function(e){return Promise.resolve(this.getNotifications([Number(e)],!1,!0)[0])},t.prototype.getTriggeredIds=function(){var e=Object.keys(this.triggered).map(function(e){return Number(e)});return Promise.resolve(e)},t.prototype.getValueFor=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];for(var o in t){var r=t[o];if(e.hasOwnProperty(r))return e[r]}},t.prototype.hasPermission=function(){return Promise.resolve(!0)},t.prototype.isPresent=function(e){return Promise.resolve(!!this.scheduled[e]||!!this.triggered[e])},t.prototype.isScheduled=function(e){return Promise.resolve(!!this.scheduled[e])},t.prototype.isTriggered=function(e){return Promise.resolve(!!this.triggered[e])},t.prototype.load=function(){var e=this;if(!this.appProvider.isDesktop())return Promise.resolve();if(this.appProvider.isWindows())try{this.winNotif=n(!function(){var e=new Error('Cannot find module "electron-windows-notifications"');throw e.code="MODULE_NOT_FOUND",e}())}catch(e){}return this.getAllNotifications().catch(function(){return[]}).then(function(t){t.forEach(function(t){t.triggered?(delete t.triggered,e.scheduled[t.id]={notification:t},e.triggered[t.id]=t):(delete t.triggered,t.at=1e3*t.at,t.at-Date.now()>1e3*-c.a.SECONDS_HOUR&&e.schedule(t))})})},t.prototype.mergeWithDefaults=function(e){e.at=this.getValueFor(e,"at","firstAt","date"),e.text=this.getValueFor(e,"text","message"),e.data=this.getValueFor(e,"data","json"),void 0!==e.at&&null!==e.at||(e.at=new Date);for(var t in this.defaults)null!==e[t]&&void 0!==e[t]||(e[t]=e.hasOwnProperty(t)&&["data","sound"].indexOf(t)>-1?void 0:this.defaults[t]);for(var t in e)this.defaults.hasOwnProperty(t)||delete e[t];return e},t.prototype.notificationClicked=function(e){this.triggerEvent("click",e,"foreground"),n(114).ipcRenderer.send("focusApp")},t.prototype.on=function(e,t){this.observers[e]&&"function"==typeof t&&this.observers[e].push(t)},t.prototype.parseInterval=function(e){var t;return(e=String(e).toLowerCase())&&"undefined"!=e?"second"==e?t=1e3:"minute"==e?t=1e3*c.a.SECONDS_MINUTE:"hour"==e?t=1e3*c.a.SECONDS_HOUR:"day"==e?t=1e3*c.a.SECONDS_DAY:"week"==e?t=7*c.a.SECONDS_DAY*1e3:"month"==e?t=31*c.a.SECONDS_DAY*1e3:"quarter"==e?t=2190*c.a.SECONDS_HOUR*1e3:"year"==e?t=1e3*c.a.SECONDS_YEAR:(t=parseInt(e,10),isNaN(t)?t=0:t*=6e4):t=0,t},t.prototype.registerPermission=function(){return Promise.resolve(!0)},t.prototype.removeNotification=function(e){return this.appDB.deleteRecords(this.DESKTOP_NOTIFS_TABLE,{id:e})},t.prototype.schedule=function(e){this.scheduleOrUpdate(e)},t.prototype.scheduleOrUpdate=function(e,t){var n=this;void 0===t&&(t="schedule"),(e=Array.isArray(e)?e:[e]).forEach(function(e){if(n.mergeWithDefaults(e),n.convertProperties(e),n.cancelNotification(e.id,!0,"cancel"),n.scheduled[e.id]={notification:e},n.storeNotification(e,!1),!(Math.abs(d().diff(1e3*e.at,"days"))>15)){var o=1e3*e.at-Date.now(),r=function(){if(n.triggerNotification(e),n.triggered[e.id]=e,n.storeNotification(e,!0),n.triggerEvent("trigger",e,"foreground"),e.every&&n.scheduled[e.id]&&!n.scheduled[e.id].interval){var t=n.parseInterval(e.every);t>0&&(n.scheduled[e.id].interval=setInterval(r,t))}};n.scheduled[e.id].timeout=setTimeout(r,o),n.triggerEvent(t,e,"foreground")}})},t.prototype.storeNotification=function(e,t){var n={id:e.id,title:e.title,text:e.text,at:e.at?e.at.getTime():0,data:e.data?JSON.stringify(e.data):"{}",triggered:t?1:0};return this.appDB.insertRecord(this.DESKTOP_NOTIFS_TABLE,n)},t.prototype.triggerEvent=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.observers[e]&&this.observers[e].forEach(function(e){e.apply(null,t)})},t.prototype.triggerNotification=function(e){var t=this;if(this.winNotif){(n=new this.winNotif.ToastNotification({appId:u.a.app_id,template:this.toastTemplate,strings:[e.title,e.text]})).on("activated",function(){t.notificationClicked(e)}),n.show();try{new this.winNotif.TileNotification({tag:e.id+"",template:this.tileTemplate,strings:[e.title,e.text,e.title,e.text,e.title,e.text],expirationTime:new Date(Date.now()+1e3*c.a.SECONDS_HOUR)}).show()}catch(e){console.warn("Error showing TileNotification. Please notice they only work with the app installed.",e)}}else{var n;(n=new Notification(e.title,{body:e.text})).onclick=function(){t.notificationClicked(e)}}},t.prototype.un=function(e,t){if(this.observers[e]&&this.observers[e].length)for(var n=0;n<this.observers[e].length;n++)if(this.observers[e][n]==t){this.observers[e].splice(n,1);break}},t.prototype.update=function(e){return this.scheduleOrUpdate(e,"update")},t=f([Object(o.A)(),p("design:paramtypes",[i.a,a.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(323),i=n(226),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this)||this;return n.captureHelper=t,n}return s(t,e),t.prototype.captureAudio=function(e){return this.captureHelper.captureMedia("audio",e)},t.prototype.captureImage=function(e){return this.captureHelper.captureMedia("captureimage",e)},t.prototype.captureVideo=function(e){return this.captureHelper.captureMedia("video",e)},t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(134),i=n(96),s=(n.n(i),this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}()),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(){var t=e.call(this)||this;return window.Connection={UNKNOWN:"unknown",ETHERNET:"ethernet",WIFI:"wifi",CELL_2G:"2g",CELL_3G:"3g",CELL_4G:"4g",CELL:"cellular",NONE:"none"},t}return s(t,e),t.prototype.onchange=function(){return i.Observable.merge(this.onConnect(),this.onDisconnect())},t.prototype.onConnect=function(){var e=new i.Subject;return window.addEventListener("online",function(t){e.next(t)},!1),e},t.prototype.onDisconnect=function(){var e=new i.Subject;return window.addEventListener("offline",function(t){e.next(t)},!1),e},t=a([Object(o.A)(),c("design:paramtypes",[])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(3),i=(n.n(r),n(326)),s=n(9),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e){this.appProvider=e}return e.prototype.init=function(e){return new l(this.appProvider)},e.prototype.hasPermission=function(){return Promise.reject("hasPermission is only supported in mobile devices")},e.prototype.createChannel=function(e){return Promise.reject("createChannel is only supported in mobile devices")},e.prototype.deleteChannel=function(e){return Promise.reject("deleteChannel is only supported in mobile devices")},e.prototype.listChannels=function(){return Promise.reject("listChannels is only supported in mobile devices")},e=c([Object(o.A)(),u("design:paramtypes",[s.a])],e)}(),l=function(e){function t(t){var n=e.call(this,{})||this;return n.appProvider=t,n}return a(t,e),t.prototype.on=function(e){return r.Observable.empty()},t.prototype.unregister=function(){return Promise.reject("unregister is only supported in mobile devices")},t.prototype.setApplicationIconBadgeNumber=function(e){if(!this.appProvider.isDesktop())return Promise.reject("setApplicationIconBadgeNumber is not supported in browser");try{return n(114).remote.app.setBadgeCount(e)?Promise.resolve():Promise.reject(null)}catch(e){return Promise.reject(e)}},t.prototype.getApplicationIconBadgeNumber=function(){if(!this.appProvider.isDesktop())return Promise.reject("getApplicationIconBadgeNumber is not supported in browser");try{var e=n(114).remote.app;return Promise.resolve(e.getBadgeCount())}catch(e){return Promise.reject(e)}},t.prototype.finish=function(e){return Promise.reject("finish is only supported in mobile devices")},t.prototype.clearAllNotifications=function(){return Promise.reject("clearAllNotifications is only supported in mobile devices")},t.prototype.subscribe=function(e){return Promise.reject("subscribe is only supported in mobile devices")},t.prototype.unsubscribe=function(e){return Promise.reject("unsubscribe is only supported in mobile devices")},t}(i.b)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(321),i=n(1415),s=(n.n(i),n(183)),a=n(11),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n){var o=e.call(this)||this;return o.file=t,o.textUtils=n,o}return c(t,e),t.prototype.createDir=function(e,t){for(var n=this,o=t.split("/"),r=Promise.resolve(),i=function(t){var i=o[t];r=r.then(function(){return n.file.createDir(e,i,!0).then(function(){e=n.textUtils.concatenatePaths(e,i)})})},s=0;s<o.length;s++)i(s);return r},t.prototype.unzip=function(e,t,n){var o=this;e=e.replace(/%20/g," "),t=t.replace(/%20/g," ");var r=e.substring(0,e.lastIndexOf("/")),s=e.substr(e.lastIndexOf("/")+1),a=new i;return this.file.readAsArrayBuffer(r,s).then(function(e){return a.loadAsync(e)}).then(function(){if(!a.files||!Object.keys(a.files).length)return 0;var n=t.substring(0,e.lastIndexOf("/")),r=t.substr(e.lastIndexOf("/")+1);return o.file.createDir(n,r,!1)}).then(function(){var e=[],r=Object.keys(a.files).length,i=0,s=function(s){var c=a.files[s],u=void 0;if(c.dir)u=o.createDir(t,s);else{var d,l=s.substring(0,s.lastIndexOf("/")),f=s.substr(s.lastIndexOf("/")+1),p=[];l&&p.push(o.createDir(t,l)),p.push(c.async("blob").then(function(e){d=e})),u=Promise.all(p).then(function(){var e=o.textUtils.concatenatePaths(t,l);return o.file.writeFile(e,f,d,{replace:!0})})}e.push(u.then(function(){i++,n&&n({loaded:i,total:r})}))};for(var c in a.files)s(c);return Promise.all(e).then(function(){return 0})}).catch(function(){return-1})},t=u([Object(o.A)(),d("design:paramtypes",[s.a,a.a])],t)}(r.a)},,,,function(e,t){},,function(e,t){},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t){},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=n(1466),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=function(){function e(){}return e=i([Object(o.I)({declarations:[r.a],imports:[],exports:[r.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(10),i=n(21),s=n(8),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n,o){this.domUtils=t,this.courseHelper=n,this.courseProvider=o,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.element.addEventListener("click",function(t){if(e.module||e.moduleId){t.preventDefault(),t.stopPropagation();var n,o=e.domUtils.showModalLoading(),r="string"==typeof e.courseId?parseInt(e.courseId,10):e.courseId;e.module?n=Promise.resolve(e.module):(e.moduleId="string"==typeof e.moduleId?parseInt(e.moduleId,10):e.moduleId,n=e.courseProvider.getModule(e.moduleId,r)),n.then(function(t){return e.courseHelper.downloadModuleAndOpenFile(t,r,e.component,e.componentId||t.id,e.files)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.errordownloading",!0)}).finally(function(){o.dismiss()})}})},a([Object(o.D)(),c("design:type",Object)],e.prototype,"module",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"moduleId",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"courseId",void 0),a([Object(o.D)(),c("design:type",String)],e.prototype,"component",void 0),a([Object(o.D)(),c("design:type",Object)],e.prototype,"componentId",void 0),a([Object(o.D)(),c("design:type",Array)],e.prototype,"files",void 0),e=a([Object(o.s)({selector:"[core-course-download-module-main-file]"}),c("design:paramtypes",[o.t,s.a,i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1468),i=n(1469),s=n(1470),a=n(1471),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=function(){function e(){}return e=c([Object(o.I)({declarations:[r.a,i.a,s.a,a.a],imports:[],exports:[r.a,i.a,s.a,a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(4),i=n(1),s=n(8),a=n(6),c=n(50),u=n(791),d=n(120),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},m=function(e){function t(t,n,o,r,i,s,a){var c=e.call(this,t,n,o,r,i)||this;return c.utils=s,c.navCtrl=a,c}return l(t,e),t.prototype.wsCallSuccess=function(e){void 0!==this.successMessage&&this.domUtils.showToast(this.successMessage||this.translate.instant("core.success")),this.utils.isTrueOrOne(this.goBackOnSuccess)?this.navCtrl.pop():this.utils.isTrueOrOne(this.refreshOnSuccess)&&this.parentContent&&this.parentContent.refreshContent(!0)},f([Object(o.D)(),p("design:type",String)],t.prototype,"successMessage",void 0),f([Object(o.D)(),p("design:type",Object)],t.prototype,"goBackOnSuccess",void 0),f([Object(o.D)(),p("design:type",Object)],t.prototype,"refreshOnSuccess",void 0),t=f([Object(o.s)({selector:"[core-site-plugins-call-ws]"}),h(4,Object(o.N)()),p("design:paramtypes",[o.t,i.c,s.a,c.a,d.a,a.a,r.q])],t)}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(4),i=n(1),s=n(8),a=n(6),c=n(50),u=n(791),d=n(120),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},m=function(e){function t(t,n,o,r,i,s,a){var c=e.call(this,t,n,o,r,i)||this;return c.utils=s,c.navCtrl=a,c}return l(t,e),t.prototype.wsCallSuccess=function(e){var t=this.args||{};this.parentContent&&(t=this.sitePluginsProvider.loadOtherDataInArgs(this.args,this.parentContent.otherData,this.useOtherData)),t=Object.assign(t,e),this.utils.isTrueOrOne(this.samePage)?this.parentContent&&this.parentContent.updateContent(t,this.component,this.method):this.navCtrl.push("CoreSitePluginsPluginPage",{title:this.title,component:this.component||this.parentContent&&this.parentContent.component,method:this.method||this.parentContent&&this.parentContent.method,args:t,initResult:this.parentContent&&this.parentContent.initResult})},f([Object(o.D)(),p("design:type",String)],t.prototype,"component",void 0),f([Object(o.D)(),p("design:type",String)],t.prototype,"method",void 0),f([Object(o.D)(),p("design:type",Object)],t.prototype,"args",void 0),f([Object(o.D)(),p("design:type",String)],t.prototype,"title",void 0),f([Object(o.D)(),p("design:type",Object)],t.prototype,"samePage",void 0),f([Object(o.D)(),p("design:type",Array)],t.prototype,"useOtherData",void 0),t=f([Object(o.s)({selector:"[core-site-plugins-call-ws-new-content]"}),h(4,Object(o.N)()),h(6,Object(o.N)()),p("design:paramtypes",[o.t,i.c,s.a,c.a,d.a,a.a,r.q])],t)}(u.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(1),i=n(8),s=n(50),a=n(792),c=n(120),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},p=function(e){function t(t,n,o,r,i){return e.call(this,t,n,o,r,i)||this}return u(t,e),t.prototype.ngOnInit=function(){e.prototype.ngOnInit.call(this),this.callWS().catch(function(){})},t=d([Object(o.s)({selector:"[core-site-plugins-call-ws-on-load]"}),f(4,Object(o.N)()),l("design:paramtypes",[o.t,r.c,i.a,s.a,c.a])],t)}(a.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(8),s=n(6),a=n(50),c=n(120),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},f=function(){function e(e,t,n,o,r,i){this.utils=t,this.navCtrl=n,this.parentContent=o,this.domUtils=r,this.sitePluginsProvider=i,this.element=e.nativeElement||e}return e.prototype.ngOnInit=function(){var e=this;this.element.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation();var n=e.args||{};e.parentContent&&(n=e.sitePluginsProvider.loadOtherDataInArgs(e.args,e.parentContent.otherData,e.useOtherData)),e.form&&document.forms[e.form]&&(n=Object.assign(n,e.domUtils.getDataFromForm(document.forms[e.form]))),e.utils.isTrueOrOne(e.samePage)?e.parentContent&&e.parentContent.updateContent(n,e.component,e.method):e.navCtrl.push("CoreSitePluginsPluginPage",{title:e.title,component:e.component||e.parentContent&&e.parentContent.component,method:e.method||e.parentContent&&e.parentContent.method,args:n,initResult:e.parentContent&&e.parentContent.initResult})})},u([Object(o.D)(),d("design:type",String)],e.prototype,"component",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"method",void 0),u([Object(o.D)(),d("design:type",Object)],e.prototype,"args",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"title",void 0),u([Object(o.D)(),d("design:type",Object)],e.prototype,"samePage",void 0),u([Object(o.D)(),d("design:type",Array)],e.prototype,"useOtherData",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"form",void 0),e=u([Object(o.s)({selector:"[core-site-plugins-new-content]"}),l(2,Object(o.N)()),l(3,Object(o.N)()),d("design:paramtypes",[o.t,s.a,r.q,c.a,i.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(2),i=n(8),s=n(10),a=n(21),c=n(36),u=n(157),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.domUtils=e,this.sitesProvider=t,this.courseProvider=n,this.courseHelper=o,this.prefetchDelegate=r,this.siteHomeProvider=i,this.items=[],this.siteHomeId=t.getCurrentSite().getSiteHomeId()}return e.prototype.ngOnInit=function(){var e=this;this.loadContent().finally(function(){e.dataLoaded=!0})},e.prototype.doRefresh=function(e){var t=this,n=[],o=this.sitesProvider.getCurrentSite();if(n.push(this.courseProvider.invalidateSections(this.siteHomeId)),n.push(o.invalidateConfig().then(function(){return o.getConfig().then(function(e){o.setConfig(e)})})),this.sectionsLoaded){var r=this.courseProvider.getSectionsModules(this.sectionsLoaded);n.push(this.prefetchDelegate.invalidateModules(r,this.siteHomeId))}Promise.all(n).finally(function(){t.loadContent().finally(function(){e.complete()})})},e.prototype.loadContent=function(){var e=this,t=!1;this.hasContent=!1;var n=this.sitesProvider.getCurrentSite().getStoredConfig()||{numsections:1};if(n.frontpageloggedin){var o=["news",!1,"categories",!1,"categories","enrolled-course-list","all-course-list","course-search"],r=n.frontpageloggedin.split(",");this.items=[],r.forEach(function(n){var r=o[parseInt(n,10)];!r||e.items.indexOf(r)>=0||("news"==r&&(t=!0),e.hasContent=!0,e.items.push(r))})}return this.courseProvider.getSections(this.siteHomeId,!1,!0).then(function(o){e.sectionsLoaded=Array.from(o),e.section=!!(n.numsections&&o.length>0)&&o.pop(),e.section&&(e.section.hasContent=e.courseHelper.sectionHasContent(e.section)),e.block=o.length>0&&o.pop(),e.block&&(e.block.hasContent=e.courseHelper.sectionHasContent(e.block)),e.hasContent=e.courseHelper.addHandlerDataForModules(e.sectionsLoaded,e.siteHomeId)||e.hasContent,e.courseProvider.logView(e.siteHomeId),t&&e.block&&e.block.modules&&e.siteHomeProvider.getNewsForum(e.siteHomeId).then(function(t){for(var n=0;n<e.block.modules.length;n++){var o=e.block.modules[n];if("forum"==o.modname&&o.instance==t.id){e.block.modules.splice(n,1);break}}}).catch(function(){})}).catch(function(t){e.domUtils.showErrorModalDefault(t,"core.course.couldnotloadsectioncontent",!0)})},e=d([Object(o.m)({selector:"core-sitehome-index",template:'<ion-content>\n    <ion-refresher [enabled]="dataLoaded" (ionRefresh)="doRefresh($event)">\n        <ion-refresher-content pullingText="{{ \'core.pulltorefresh\' | translate }}"></ion-refresher-content>\n    </ion-refresher>\n\n    <core-loading [hideUntil]="dataLoaded">\n\n        <ion-list>\n            \x3c!-- Site home main contents. --\x3e\n            <ng-container *ngIf="section && section.hasContent">\n                <ion-item text-wrap *ngIf="section.summary">\n                    <core-format-text [text]="section.summary"></core-format-text>\n                </ion-item>\n\n                <core-course-module *ngFor="let module of section.modules" [module]="module" [courseId]="siteHomeId"></core-course-module>\n            </ng-container>\n\n            \x3c!-- Site home items: news, categories, courses, etc. --\x3e\n            <ng-container *ngIf="items.length > 0">\n                <ion-item-divider color="light" *ngIf="section && section.hasContent"></ion-item-divider>\n                <ng-container *ngFor="let item of items">\n                    <core-sitehome-all-course-list class="item" *ngIf="item == \'all-course-list\'"></core-sitehome-all-course-list>\n                    <core-sitehome-categories  *ngIf="item == \'categories\'"></core-sitehome-categories>\n                    <core-sitehome-course-search *ngIf="item == \'course-search\'"></core-sitehome-course-search>\n                    <core-sitehome-enrolled-course-list *ngIf="item == \'enrolled-course-list\'"></core-sitehome-enrolled-course-list>\n                    <core-sitehome-news *ngIf="item == \'news\'"></core-sitehome-news>\n                </ng-container>\n            </ng-container>\n\n            \x3c!-- Site home block. --\x3e\n            <ng-container *ngIf="block && block.hasContent">\n                <ion-item-divider color="light" *ngIf="(section && section.hasContent) || items.length > 0"></ion-item-divider>\n                <ion-item text-wrap *ngIf="block.summary">\n                    <core-format-text [text]="block.summary"></core-format-text>\n                </ion-item>\n\n                <core-course-module *ngFor="let module of block.modules" [module]="module" [courseId]="siteHomeId"></core-course-module>\n            </ng-container>\n        </ion-list>\n\n        <core-empty-box *ngIf="!hasContent" icon="qr-scanner" [message]="\'core.course.nocontentavailable\' | translate"></core-empty-box>\n    </core-loading>\n</ion-content>\n'}),l("design:paramtypes",[i.a,r.a,s.a,a.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(41),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.show=e.isGetCoursesByFieldAvailable()}return e=i([Object(o.m)({selector:"core-sitehome-all-course-list",template:'<a *ngIf="show" ion-item text-wrap [navPush]="\'CoreCoursesAvailableCoursesPage\'">\n    <core-icon name="fa-graduation-cap" fixed-width item-start></core-icon>\n    <h2>{{ \'core.courses.availablecourses\' | translate}}</h2>\n</a>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(41),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.show=e.isGetCoursesByFieldAvailable()}return e=i([Object(o.m)({selector:"core-sitehome-categories",template:'<a *ngIf="show" ion-item text-wrap [navPush]="\'CoreCoursesCategoriesPage\'">\n    <ion-icon name="folder" item-start></ion-icon>\n    <h2>{{ \'core.courses.categories\' | translate}}</h2>\n</a>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(41),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.show=!e.isSearchCoursesDisabledInSite()}return e=i([Object(o.m)({selector:"core-sitehome-course-search",template:'<a *ngIf="show" ion-item text-wrap [navPush]="\'CoreCoursesSearchPage\'">\n    <ion-icon name="search" item-start></ion-icon>\n    <h2>{{ \'core.courses.searchcourses\' | translate}}</h2>\n</a>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(41),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.coursesProvider=e}return e.prototype.ngOnInit=function(){var e=this;this.coursesProvider.isMyCoursesDisabledInSite()?this.show=!1:this.coursesProvider.getUserCourses().then(function(t){e.show=t.length>0})},e=i([Object(o.m)({selector:"core-sitehome-enrolled-course-list",template:'<a *ngIf="show" ion-item text-wrap [navPush]="\'CoreCoursesMyCoursesPage\'">\n    <core-icon name="fa-graduation-cap" fixed-width item-start></core-icon>\n    <h2>{{ \'core.courses.mycourses\' | translate}}</h2>\n</a>\n'}),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(2),i=n(10),s=n(35),a=n(157),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){this.sitesProvider=e,this.courseProvider=t,this.moduleDelegate=n,this.siteHomeProvider=o,this.siteHomeId=e.getCurrentSite().getSiteHomeId()}return e.prototype.ngOnInit=function(){var e=this,t=this.sitesProvider.getCurrentSite();if(t.getStoredConfig("newsitems")||0){var n=t.getSiteHomeId();this.siteHomeProvider.getNewsForum(n).then(function(t){return e.courseProvider.getModuleBasicInfo(t.cmid).then(function(t){e.show=!0,e.module=t,t.handlerData=e.moduleDelegate.getModuleDataFor(t.modname,t,n,t.section)})}).catch(function(){})}},e=c([Object(o.m)({selector:"core-sitehome-news",template:'<core-course-module class="core-sitehome-news" *ngIf="show" [module]="module" [courseId]="siteHomeId"></core-course-module>'}),u("design:paramtypes",[r.a,i.a,s.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(1),i=n(7),s=n(8),a=n(6),c=n(65),u=n(38),d=n(70),l=n(73),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,r,i,s,a,c,u){this.injector=t,this.questionDelegate=n,this.utils=r,this.behaviourDelegate=i,this.questionHelper=s,this.translate=a,this.questionProvider=c,this.domUtils=u,this.data={},this.behaviourComponents=[],this.loaded=!1,e=e.getInstance("CoreQuestionComponent"),this.buttonClicked=new o.v,this.onAbort=new o.v}return e.prototype.ngOnInit=function(){var e=this;this.offlineEnabled=this.utils.isTrueOrOne(this.offlineEnabled),this.question?this.questionDelegate.getComponentForQuestion(this.injector,this.question).then(function(t){if(e.componentClass=t,t){e.data={question:e.question,component:e.component,componentId:e.componentId,attemptId:e.attemptId,offlineEnabled:e.offlineEnabled,buttonClicked:e.buttonClicked,onAbort:e.onAbort},e.questionHelper.extractQuestionScripts(e.question);var n=e.questionDelegate.getBehaviourForQuestion(e.question,e.question.preferredBehaviour);if(!e.behaviourDelegate.isBehaviourSupported(n))return e.logger.warn("Aborting question because the behaviour is not supported.",e.question.name),void e.questionHelper.showComponentError(e.onAbort,e.translate.instant("addon.mod_quiz.errorbehaviournotsupported")+" "+n);if(e.seqCheck=e.questionHelper.getQuestionSequenceCheckFromHtml(e.question.html),!e.seqCheck)return e.logger.warn("Aborting question because couldn't retrieve sequence check.",e.question.name),void e.questionHelper.showComponentError(e.onAbort);var o=void 0;e.offlineEnabled?o=e.questionProvider.getQuestionAnswers(e.component,e.attemptId,e.question.slot).then(function(t){e.question.localAnswers=e.questionProvider.convertAnswersArrayToObject(t,!0)}).catch(function(){e.question.localAnswers={}}):(e.question.localAnswers={},o=Promise.resolve()),o.then(function(){e.behaviourDelegate.handleQuestion(e.injector,e.question.preferredBehaviour,e.question).then(function(t){e.behaviourComponents=t}).finally(function(){e.question.html=e.domUtils.removeElementFromHtml(e.question.html,".im-controls"),e.loaded=!0}),e.questionHelper.extractQbehaviourRedoButton(e.question),e.question.validationError=e.questionHelper.getValidationErrorFromHtml(e.question.html),e.questionHelper.loadLocalAnswersInHtml(e.question),e.questionHelper.extractQuestionFeedback(e.question),e.questionHelper.extractQuestionComment(e.question)})}}).catch(function(){}):this.loaded=!0},f([Object(o.D)(),p("design:type",Object)],e.prototype,"question",void 0),f([Object(o.D)(),p("design:type",String)],e.prototype,"component",void 0),f([Object(o.D)(),p("design:type",Number)],e.prototype,"componentId",void 0),f([Object(o.D)(),p("design:type",Number)],e.prototype,"attemptId",void 0),f([Object(o.D)(),p("design:type",Object)],e.prototype,"offlineEnabled",void 0),f([Object(o.O)(),p("design:type",o.v)],e.prototype,"buttonClicked",void 0),f([Object(o.O)(),p("design:type",o.v)],e.prototype,"onAbort",void 0),e=f([Object(o.m)({selector:"core-question",template:'\n\x3c!-- Question contents. --\x3e\n<core-dynamic-component *ngIf="loaded" [component]="componentClass" [data]="data" class="core-question-{{question.slot}}">\n    \x3c!-- This content will only be shown if there\'s no component to render the question. --\x3e\n    <p padding>{{ \'core.question.errorquestionnotsupported\' | translate:{$a: question.type} }}</p>\n</core-dynamic-component>\n\n\x3c!-- Sequence check input. --\x3e\n<input *ngIf="seqCheck" type="hidden" name="{{seqCheck.name}}" value="{{seqCheck.value}}" >\n\n\x3c!-- Question behaviour components. --\x3e\n<core-dynamic-component *ngFor="let componentClass of behaviourComponents" [component]="componentClass" [data]="data"></core-dynamic-component>\n\n\x3c!-- Question validation error. --\x3e\n<ion-item text-wrap class="core-danger-item" *ngIf="question.validationError">\n    <p>{{ question.validationError }}</p>\n</ion-item>\n\n\x3c!-- Question behaviour buttons. --\x3e\n<ion-item text-wrap *ngFor="let button of question.behaviourButtons">\n    <button ion-button block (click)="buttonClicked.emit(button)" [disabled]="button.disabled">{{ button.value }}</button>\n</ion-item>\n\n\x3c!-- Question feedback. --\x3e\n<ion-item text-wrap class="core-question-feedback-container" *ngIf="question.feedbackHtml">\n    <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.feedbackHtml"></core-format-text></p>\n</ion-item>\n\n\x3c!-- Question comment. --\x3e\n<ion-item text-wrap class="core-question-comment" *ngIf="question.commentHtml">\n    <p><core-format-text [component]="component" [componentId]="componentId" [text]="question.commentHtml"></core-format-text></p>\n</ion-item>\n'}),p("design:paramtypes",[i.a,o.C,u.a,a.a,d.a,l.a,r.c,c.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(57),i=n(194),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.badgesProvider=e,this.name="AddonBadges",this.priority=50,this.type=r.a.TYPE_NEW_PAGE}return e.prototype.isEnabled=function(){return this.badgesProvider.isPluginEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){return!n||void 0===n.badges||n.badges},e.prototype.getDisplayData=function(e,t){return{icon:"trophy",title:"addon.badges.badges",class:"",action:function(e,t,n,o){e.preventDefault(),e.stopPropagation(),t.push("AddonBadgesUserBadgesPage",{courseId:o,userId:n.id})}}},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(71),s=n(194),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.badgesProvider=t,o.loginHelper=n,o.name="AddonBadgesMyBadgesLinkHandler",o.featureName="CoreUserDelegate_AddonBadges",o.pattern=/\/badges\/mybadges\.php/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.loginHelper.redirect("AddonBadgesUserBadgesPage",{},e)}}]},t.prototype.isEnabled=function(e,t,n,o){return this.badgesProvider.isPluginEnabled(e)},t=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(71),s=n(194),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.badgesProvider=t,o.loginHelper=n,o.name="AddonBadgesBadgeLinkHandler",o.pattern=/\/badges\/badge\.php.*([\?\&]hash=)/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.loginHelper.redirect("AddonBadgesIssuedBadgePage",{courseId:0,badgeHash:n.hash},e)}}]},t.prototype.isEnabled=function(e,t,n,o){return this.badgesProvider.isPluginEnabled(e)},t=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(249),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.calendarProvider=e,this.name="AddonCalendar",this.priority=900}return e.prototype.isEnabled=function(){return!this.calendarProvider.isCalendarDisabledInSite()},e.prototype.getDisplayData=function(){return{icon:"calendar",title:"addon.calendar.calendar",page:"AddonCalendarListPage",class:"addon-calendar-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(10),i=n(725),s=n(162),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.competencyProvider=e,this.name="AddonCompetency",this.priority=700}return e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForCourse=function(e,t,n,o){return(!t||t.type!=r.a.ACCESS_GUEST)&&(n&&void 0!==n.competencies?n.competencies:this.competencyProvider.isPluginForCourseEnabled(e).then(function(e){return!!e&&!e.canmanagecoursecompetencies}))},e.prototype.getDisplayData=function(e,t){return{title:"addon.competency.competencies",class:"addon-competency-course-handler",component:i.a}},e.prototype.invalidateEnabledForCourse=function(e,t,n){return t&&void 0!==t.competencies?Promise.resolve():this.competencyProvider.invalidateCourseCompetencies(e)},e=a([Object(o.A)(),c("design:paramtypes",[s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(162),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.competencyProvider=e,this.name="AddonCompetency",this.priority=500}return e.prototype.isEnabled=function(){return this.competencyProvider.getLearningPlans().then(function(e){return e.length>0})},e.prototype.getDisplayData=function(){return{icon:"map",title:"addon.competency.myplans",page:"AddonCompetencyPlanListPage",class:"addon-competency-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(57),i=n(2),s=n(32),a=n(12),c=n(26),u=n(162),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o){this.linkHelper=e,this.sitesProvider=t,this.competencyProvider=n,this.name="AddonCompetency:learningPlan",this.priority=900,this.type=r.a.TYPE_NEW_PAGE,this.participantsNavEnabledCache={},this.usersNavEnabledCache={},o.on(a.a.LOGOUT,this.clearUsersNavCache.bind(this)),o.on(c.a.PROFILE_REFRESHED,this.clearUsersNavCache.bind(this))}return e.prototype.clearUsersNavCache=function(){this.participantsNavEnabledCache={},this.usersNavEnabledCache={}},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForUser=function(e,t,n,o){var r=this;if(t){var i=t+"."+e.id;return void 0!==this.participantsNavEnabledCache[i]?this.participantsNavEnabledCache[i]:this.competencyProvider.getCourseCompetencies(t,e.id).then(function(e){var t=e.competencies.length>0;return r.participantsNavEnabledCache[i]=t,t}).catch(function(e){return r.participantsNavEnabledCache[i]=!1,!1})}return void 0!==this.usersNavEnabledCache[e.id]?this.usersNavEnabledCache[e.id]:this.competencyProvider.getLearningPlans(e.id).then(function(t){var n=t.length>0;return r.usersNavEnabledCache[e.id]=n,n})},e.prototype.getDisplayData=function(e,t){var n=this;return t?{icon:"ribbon",title:"addon.competency.competencies",class:"addon-competency-handler",action:function(e,t,o,r){e.preventDefault(),e.stopPropagation(),n.linkHelper.goInSite(t,"AddonCompetencyCourseCompetenciesPage",{courseId:r,userId:o.id})}}:{icon:"map",title:"addon.competency.learningplans",class:"addon-competency-handler",action:function(e,t,o,r){e.preventDefault(),e.stopPropagation(),n.linkHelper.goInSite(t,"AddonCompetencyPlanListPage",{userId:o.id})}}},e=d([Object(o.A)(),l("design:paramtypes",[s.a,i.a,u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(254),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.filesProvider=e,this.name="AddonFiles",this.priority=400}return e.prototype.isEnabled=function(){return this.filesProvider.isPluginEnabled()},e.prototype.getDisplayData=function(){return{icon:"folder",title:"addon.files.files",page:"AddonFilesListPage",class:"addon-files-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(103),i=n(2),s=n(12),a=n(9),c=n(11),u=n(6),d=n(78),l=n(252),f=n(148),p=n(186),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(){function e(e,t,n,o,i,a,c,u,d,l){var f=this;this.messagesProvider=e,this.sitesProvider=t,this.eventsProvider=n,this.appProvider=o,this.localNotificationsProvider=i,this.textUtils=a,this.pushNotificationsProvider=c,this.emulatorHelper=l,this.name="AddonMessages",this.priority=800,this.handler={icon:"chatbubbles",title:"addon.messages.messages",page:"AddonMessagesIndexPage",class:"addon-messages-handler",showBadge:!0,badge:"",loading:!0},n.on(r.a.READ_CHANGED_EVENT,function(e){f.updateBadge(e.siteId)}),n.on(r.a.READ_CRON_EVENT,function(e){f.updateBadge(e.siteId)}),n.on(s.a.LOGOUT,function(e){f.handler.badge="",f.handler.loading=!0}),d.on("receive").subscribe(function(e){u.isFalseOrZero(e.notif)&&f.sitesProvider.isCurrentSite(e.site)&&f.updateBadge(e.site)}),d.registerCounterHandler("AddonMessages")}return e.prototype.isEnabled=function(){return this.messagesProvider.isPluginEnabled()},e.prototype.getDisplayData=function(){return this.handler.loading&&this.updateBadge(),this.handler},e.prototype.updateBadge=function(e){var t=this;(e=e||this.sitesProvider.getCurrentSiteId())&&this.messagesProvider.getUnreadConversationsCount(void 0,e).then(function(n){t.handler.badge=parseInt(n,10)>0?n:"",t.pushNotificationsProvider.updateAddonCounter("AddonMessages",n,e)}).catch(function(){t.handler.badge=""}).finally(function(){t.handler.loading=!1})},e.prototype.execute=function(e){return this.sitesProvider.isCurrentSite(e)&&this.eventsProvider.trigger(r.a.READ_CRON_EVENT,{},e),this.appProvider.isDesktop()&&this.localNotificationsProvider.isAvailable()&&this.emulatorHelper.checkNewNotifications(r.a.PUSH_SIMULATION_COMPONENT,this.fetchMessages.bind(this),this.getTitleAndText.bind(this),e),Promise.resolve()},e.prototype.getInterval=function(){return this.appProvider.isDesktop()?6e4:6e5},e.prototype.isSync=function(){return!this.messagesProvider.isMessageCountEnabled()||this.appProvider.isDesktop()},e.prototype.canManualSync=function(){return!0},e.prototype.fetchMessages=function(e){return this.messagesProvider.getUnreadReceivedMessages(!0,!1,!0,e).then(function(e){return e.messages})},e.prototype.getTitleAndText=function(e){var t={title:e.userfromfullname};return this.textUtils.formatText(e.text,!0,!0).catch(function(){return e.text}).then(function(e){return t.text=e,t})},e=h([Object(o.A)(),m("design:paramtypes",[r.a,i.a,s.a,a.a,d.a,c.a,l.a,u.a,f.a,p.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(57),i=n(2),s=n(32),a=n(103),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.linkHelper=e,this.sitesProvider=t,this.messagesProvider=n,this.name="AddonMessages:sendMessage",this.priority=1e3,this.type=r.a.TYPE_COMMUNICATION}return e.prototype.isEnabled=function(){return this.messagesProvider.isPluginEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){return e.id!=this.sitesProvider.getCurrentSiteUserId()},e.prototype.getDisplayData=function(e,t){var n=this;return{icon:"send",title:"addon.messages.message",class:"addon-messages-send-message-handler",action:function(e,t,o,r){e.preventDefault(),e.stopPropagation();n.linkHelper.goInSite(t,"AddonMessagesDiscussionPage",{showKeyboard:!0,userId:o.id})}}},e=c([Object(o.A)(),u("design:paramtypes",[s.a,i.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(31),i=n(32),s=n(103),a=n(2),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this)||this;return r.linkHelper=t,r.messagesProvider=n,r.sitesProvider=o,r.name="AddonMessagesDiscussionLinkHandler",r.pattern=/\/message\/index\.php.*([\?\&](id|user1|user2)=\d+)/,r}return c(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o={userId:parseInt(n.id||n.user2,10)};r.linkHelper.goInSite(t,"AddonMessagesDiscussionPage",o,e)}}]},t.prototype.isEnabled=function(e,t,n,o){var r=this;return this.messagesProvider.isPluginEnabled(e).then(function(t){return!!t&&((void 0!==n.id||void 0!==n.user2)&&(void 0===n.user1||r.sitesProvider.getSite(e).then(function(e){return parseInt(n.user1,10)==e.getUserId()})))})},t=u([Object(o.A)(),d("design:paramtypes",[i.a,s.a,a.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(31),i=n(32),s=n(103),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.linkHelper=t,o.messagesProvider=n,o.name="AddonMessagesIndexLinkHandler",o.pattern=/\/message\/index\.php((?![\?\&](id|user1|user2)=\d+).)*$/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){r.linkHelper.goInSite(t,"AddonMessagesIndexPage",void 0,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return this.messagesProvider.isPluginEnabled(e)},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(399),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.messagesSync=e,this.name="AddonMessagesSyncCronHandler"}return e.prototype.execute=function(e){return this.messagesSync.syncAllDiscussions(e)},e.prototype.getInterval=function(){return 3e5},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(103),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.messagesProvider=e,this.name="AddonMessages",this.priority=600}return e.prototype.isEnabled=function(){return this.messagesProvider.isMessagePreferencesEnabled()},e.prototype.getDisplayData=function(){return{icon:"chatbubbles",title:"addon.messages.messagepreferences",page:"AddonMessagesSettingsPage",class:"addon-messages-settings-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(10),i=n(52),s=n(400),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.assignProvider=t,this.name="AddonModAssign",this.modName="assign"}return e.prototype.isEnabled=function(){return this.assignProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("assign"),title:e.name,class:"addon-mod_assign-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModAssignIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return s.a},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return S});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(46),c=n(2),u=n(8),d=n(11),l=n(6),f=n(76),p=n(10),h=n(21),m=n(115),g=n(26),y=n(52),v=n(108),b=n(110),_=n(102),P=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),O=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},w=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},S=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p,h,m,g){var v=e.call(this,t,n,o,r,i,s,a)||this;return v.assignProvider=c,v.textUtils=u,v.feedbackDelegate=d,v.submissionDelegate=l,v.courseHelper=f,v.groupsProvider=p,v.gradesHelper=h,v.userProvider=m,v.assignHelper=g,v.name="AddonModAssign",v.modName="assign",v.component=y.a.COMPONENT,v.updatesNames=/^configuration$|^.*files$|^submissions$|^grades$|^gradeitems$|^outcomes$|^comments$/,v}return P(t,e),t.prototype.canUseCheckUpdates=function(e,t){var n=this;return this.assignProvider.getAssignment(t,e.id).then(function(e){return n.assignProvider.getSubmissions(e.id)}).then(function(e){return!e.canviewsubmissions}).catch(function(){return!1})},t.prototype.getFiles=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.assignProvider.getAssignment(t,e.id,o).then(function(n){var i=n.introattachments||[];return i=i.concat(r.getIntroFilesFromInstance(e,n)),r.assignProvider.getSubmissions(n.id,o).then(function(e){var s=n.blindmarking&&!n.revealidentities;if(e.canviewsubmissions)return r.assignProvider.getSubmissionsUserData(e.submissions,t,n.id,s,void 0,o).then(function(e){var t=[];return e.forEach(function(e){t.push(r.getSubmissionFiles(n,e.submitid,!!e.blindid,o).then(function(e){i=i.concat(e)}))}),Promise.all(t).then(function(){return i})});var a=r.sitesProvider.getCurrentSiteUserId();return r.getSubmissionFiles(n,a,s,o).then(function(e){return i=i.concat(e)})})}).catch(function(){return[]})},t.prototype.getSubmissionFiles=function(e,t,n,o){var r=this;return this.assignProvider.getSubmissionStatus(e.id,t,n,!0,!1,o).then(function(t){var n=[];if(t.lastattempt){var i=r.assignProvider.getSubmissionObjectFromAttempt(e,t.lastattempt);i&&i.plugins&&i.plugins.forEach(function(t){n.push(r.submissionDelegate.getPluginFiles(e,i,t,o))})}return t.feedback&&t.feedback.plugins&&t.feedback.plugins.forEach(function(i){n.push(r.feedbackDelegate.getPluginFiles(e,t,i,o))}),Promise.all(n)}).then(function(e){var t=[];return e.forEach(function(e){t=t.concat(e)}),t})},t.prototype.invalidateContent=function(e,t){return this.assignProvider.invalidateContent(e,t)},t.prototype.isEnabled=function(){return this.assignProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchAssign.bind(this))},t.prototype.prefetchAssign=function(e,t,n,o){var r=this,i=this.sitesProvider.getCurrentSiteUserId(),s=[];return o=o||this.sitesProvider.getCurrentSiteId(),s.push(this.courseProvider.getModuleBasicInfo(e.id,o)),s.push(this.assignProvider.getAssignment(t,e.id,o).then(function(s){var a=[];return s.blindmarking&&!s.revealidentities&&a.push(r.assignProvider.getAssignmentUserMappings(s.id,void 0,o).catch(function(){})),a.push(r.prefetchSubmissions(s,t,e.id,i,o)),a.push(r.courseHelper.getModuleCourseIdByInstance(s.id,"assign",o)),a.push(r.getFiles(e,t,n,o).then(function(t){return r.filepoolProvider.addFilesToQueue(o,t,r.component,e.id)})),Promise.all(a)})),Promise.all(s)},t.prototype.prefetchSubmissions=function(e,t,n,o,r){var i=this;return this.assignProvider.getSubmissions(e.id,r).then(function(s){var a=[];return s.canviewsubmissions?(a.push(i.assignProvider.getSubmissionsUserData(s.submissions,t,e.id,e.blindmarking&&!e.revealidentities,void 0,r).then(function(o){var s=[];return o.forEach(function(o){s.push(i.assignProvider.getSubmissionStatus(e.id,o.submitid,!!o.blindid,!0,!1,r).then(function(s){return i.prefetchSubmission(e,t,n,s,o.submitid,r)}))}),Promise.all(s)})),a.push(i.assignHelper.getParticipants(e,r).then(function(e){e.forEach(function(e){e.profileimageurl&&i.filepoolProvider.addToQueueByUrl(r,e.profileimageurl)})}).catch(function(){}))):a.push(i.assignProvider.getSubmissionStatus(e.id,o,!1,!0,!1,r).then(function(s){return i.prefetchSubmission(e,t,n,s,o,r)})),a.push(i.groupsProvider.activityHasGroups(e.cmid)),a.push(i.groupsProvider.getActivityAllowedGroups(e.cmid,void 0,r)),Promise.all(a)})},t.prototype.prefetchSubmission=function(e,t,n,o,r,i){var s=this,a=[],c=e.blindmarking&&!e.revealidentities,u=[];if(o.lastattempt){var d=this.assignProvider.getSubmissionObjectFromAttempt(e,o.lastattempt);!c&&o.lastattempt.submissiongroupmemberswhoneedtosubmit&&(u=u.concat(o.lastattempt.submissiongroupmemberswhoneedtosubmit)),d&&d.id&&(d.plugins&&d.plugins.forEach(function(t){a.push(s.submissionDelegate.prefetch(e,d,t,i))}),d.userid&&u.push(d.userid))}return o.feedback&&(o.feedback.grade&&o.feedback.grade.grader&&u.push(o.feedback.grade.grader),r&&a.push(this.gradesHelper.getGradeModuleItems(t,n,r,void 0,i)),o.feedback.plugins&&o.feedback.plugins.forEach(function(t){a.push(s.feedbackDelegate.prefetch(e,o,t,i))})),a.push(this.userProvider.prefetchProfiles(u,t,i)),Promise.all(a)},t=O([Object(o.A)(),w("design:paramtypes",[r.c,i.a,l.a,p.a,s.a,c.a,u.a,y.a,d.a,b.a,_.a,h.a,a.a,m.a,g.a,v.a])],t)}(f.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(255),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.assignSync=e,this.name="AddonModAssignSyncCronHandler"}return e.prototype.execute=function(e){return this.assignSync.syncAllAssignments(e)},e.prototype.getInterval=function(){return this.assignSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModAssign","assign")||this;return n.name="AddonModAssignIndexLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1498),i=n(1500),s=n(1501),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=function(){function e(){}return e=a([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1499),c=n(802),u=n(102),d=n(392),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),f("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(139),i=n(802),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.commentsProvider=e,this.name="AddonModAssignSubmissionCommentsHandler",this.type="comments"}return e.prototype.canEditOffline=function(e,t,n){return!0},e.prototype.getComponent=function(e,t,n){return n?void 0:i.a},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForEdit=function(){return!0},e.prototype.prefetch=function(e,t,n,o){return this.commentsProvider.getComments("module",e.cmid,"assignsubmission_comments",t.id,"submission_comments",0,o).catch(function(){})},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(803),c=n(804),u=n(102),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),p("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1502),c=n(805),u=n(102),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),p("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(2),i=n(118),s=n(11),a=n(52),c=n(80),u=n(108),d=n(805),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i){this.sitesProvider=e,this.wsProvider=t,this.textUtils=n,this.assignProvider=o,this.assignOfflineProvider=r,this.assignHelper=i,this.name="AddonModAssignSubmissionOnlineTextHandler",this.type="onlinetext"}return e.prototype.canEditOffline=function(e,t,n){return!1},e.prototype.copySubmissionData=function(e,t,n,o,r){var i=this.assignProvider.getSubmissionPluginText(t,!0),s=this.assignProvider.getSubmissionPluginAttachments(t);return(s.length?this.assignHelper.uploadFiles(e.id,s,r):Promise.resolve(0)).then(function(e){n.onlinetext_editor={text:i,format:1,itemid:e}})},e.prototype.getComponent=function(e,t,n){return d.a},e.prototype.getPluginFiles=function(e,t,n,o){return this.assignProvider.getSubmissionPluginAttachments(n)},e.prototype.getSizeForCopy=function(e,t){var n=this,o=this.assignProvider.getSubmissionPluginText(t,!0),r=this.assignProvider.getSubmissionPluginAttachments(t),i=[],s=o.length;return r.length?(r.forEach(function(e){i.push(n.wsProvider.getRemoteFileSize(e.fileurl).then(function(e){if(-1==e)return Promise.reject(null);s+=e}))}),Promise.all(i).then(function(){return s})):s},e.prototype.getSizeForEdit=function(e,t,n,o){return this.assignProvider.getSubmissionPluginText(n,!0).length},e.prototype.getTextToSubmit=function(e,t){return this.textUtils.restorePluginfileUrls(t.onlinetext_editor_text,e.fileareas&&e.fileareas[0]?e.fileareas[0].files:[])},e.prototype.hasDataChanged=function(e,t,n,o){var r=this;return this.assignOfflineProvider.getSubmission(e.id,t.userid).catch(function(){}).then(function(e){return e&&e.plugindata&&e.plugindata.onlinetext_editor?e.plugindata.onlinetext_editor.text:n.editorfields&&n.editorfields[0]?n.editorfields[0].text:""}).then(function(e){return e!=r.getTextToSubmit(n,o)})},e.prototype.isEnabled=function(){return!0},e.prototype.isEnabledForEdit=function(){var e=this.sitesProvider.getCurrentSite();return e.isVersionGreaterEqualThan("3.1.1")||e.checkIfAppUsesLocalMobile()},e.prototype.prepareSubmissionData=function(e,t,n,o,r,i,s,a){var c=this.getTextToSubmit(n,o);c=this.textUtils.formatHtmlLines(c),r.onlinetext_editor={text:c,format:1,itemid:0}},e.prototype.prepareSyncData=function(e,t,n,o,r,i){var s=o&&o.plugindata&&o.plugindata.onlinetext_editor;s&&(r.onlinetext_editor=s)},e=l([Object(o.A)(),f("design:paramtypes",[r.a,i.a,s.a,a.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1504),i=n(1505),s=n(1507),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=function(){function e(){}return e=a([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(806),c=n(807),u=n(110),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),p("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1506),c=n(808),u=n(110),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),p("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(52),i=n(808),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.assignProvider=e,this.name="AddonModAssignFeedbackEditPdfHandler",this.type="editpdf"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getPluginFiles=function(e,t,n,o){return this.assignProvider.getSubmissionPluginAttachments(n)},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1508),c=n(809),u=n(110),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),p("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(52),i=n(809),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.assignProvider=e,this.name="AddonModAssignFeedbackFileHandler",this.type="file"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getPluginFiles=function(e,t,n,o){return this.assignProvider.getSubmissionPluginAttachments(n)},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(227),i=n(402),s=n(10),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.bookProvider=e,this.courseProvider=t,this.name="AddonModBook",this.modName="book"}return e.prototype.isEnabled=function(){return this.bookProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("book"),title:e.name,class:"addon-mod_book-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModBookIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t,n){return i.a},e=a([Object(o.A)(),c("design:paramtypes",[r.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModBook","book")||this;return n.name="AddonModBookLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModChat","chat")||this;return n.name="AddonModChatLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(403),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModChat",this.modName="chat"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("chat"),title:e.name,class:"addon-mod_chat-handler",action:function(e,t,n,o,r){t.push("AddonModChatIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(404),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModChoice",this.modName="choice"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("choice"),title:e.name,class:"addon-mod_choice-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModChoiceIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModChoice","choice")||this;return n.name="AddonModChoiceLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return v});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(26),p=n(228),h=n(230),m=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=function(e){function t(t,n,o,r,i,s,a,c,u,d){var l=e.call(this,t,n,o,r,i,s,a)||this;return l.choiceProvider=c,l.syncProvider=u,l.userProvider=d,l.name="AddonModChoice",l.modName="choice",l.component=p.a.COMPONENT,l.updatesNames=/^configuration$|^.*files$|^answers$/,l}return m(t,e),t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchChoice.bind(this))},t.prototype.prefetchChoice=function(e,t,n,o){var r=this;return this.choiceProvider.getChoice(t,e.id,o).then(function(n){var i=[];i.push(r.choiceProvider.getOptions(n.id,o)),i.push(r.choiceProvider.getResults(n.id,o).then(function(e){var n=[];return e.forEach(function(e){e.userresponses.forEach(function(e){e.userid&&n.push(r.userProvider.getProfile(e.userid,t,!1,o)),e.profileimageurl&&n.push(r.filepoolProvider.addToQueueByUrl(o,e.profileimageurl).catch(function(){}))})}),Promise.all(n)}));var s=r.getIntroFilesFromInstance(e,n);return i.push(r.filepoolProvider.addFilesToQueue(o,s,p.a.COMPONENT,e.id)),Promise.all(i)})},t.prototype.getIntroFiles=function(e,t){var n=this;return this.choiceProvider.getChoice(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.choiceProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){return this.choiceProvider.invalidateChoiceData(t)},t=g([Object(o.A)(),y("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,p.a,h.a,f.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(230),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.choiceSync=e,this.name="AddonModChoiceSyncCronHandler"}return e.prototype.execute=function(e){return this.choiceSync.syncAllChoices(e)},e.prototype.getInterval=function(){return this.choiceSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(407),i=n(10),s=n(86),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.feedbackProvider=t,this.name="AddonModFeedback",this.modName="feedback"}return e.prototype.isEnabled=function(){return this.feedbackProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("feedback"),title:e.name,class:"addon-mod_feedback-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModFeedbackIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=a([Object(o.A)(),c("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModFeedback","feedback")||this;return n.name="AddonModFeedbackLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(86),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.feedbackProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModFeedbackAnalysisLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModFeedback",i.pattern=/\/mod\/feedback\/analysis\.php.*([\&\?]id=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading();r.courseProvider.getModuleBasicInfo(n.id,e).then(function(n){return r.linkHelper.goInSite(t,"AddonModFeedbackIndexPage",{module:n,courseId:n.course,tab:"analysis"},e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return this.feedbackProvider.isPluginEnabled(e).then(function(e){return!!e&&void 0!==n.id})},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(86),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.feedbackProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModFeedbackShowEntriesLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModFeedback",i.pattern=/\/mod\/feedback\/show_entries\.php.*([\?\&](id|showcompleted)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading();r.courseProvider.getModuleBasicInfo(n.id,e).then(function(o){var i;return void 0===n.showcompleted?(i={moduleId:o.id,module:o,courseId:o.course},r.linkHelper.goInSite(t,"AddonModFeedbackRespondentsPage",i,e)):r.feedbackProvider.getAttempt(o.instance,n.showcompleted,e).then(function(n){return i={moduleId:o.id,attempt:n,attemptId:n.id,feedbackId:o.instance},r.linkHelper.goInSite(t,"AddonModFeedbackAttemptPage",i,e)})}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return this.feedbackProvider.isPluginEnabled(e).then(function(e){return!!e&&void 0!==n.id})},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(86),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.feedbackProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModFeedbackShowNonRespondentsLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModFeedback",i.pattern=/\/mod\/feedback\/show_nonrespondents\.php.*([\?\&](id)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading();r.courseProvider.getModuleBasicInfo(n.id,e).then(function(n){return r.linkHelper.goInSite(t,"AddonModFeedbackNonRespondentsPage",{module:n,moduleId:n.id,courseId:n.course},e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return this.feedbackProvider.isPluginEnabled(e).then(function(e){return!!e&&void 0!==n.id})},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(86),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.feedbackProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModFeedbackCompleteLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModFeedback",i.pattern=/\/mod\/feedback\/complete\.php.*([\?\&](id|gopage)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading();r.courseProvider.getModuleBasicInfo(n.id,e).then(function(o){var i={module:o,moduleId:o.id,courseId:o.course};return void 0===n.gopage&&(i.page=parseInt(n.gopage,10)),r.linkHelper.goInSite(t,"AddonModFeedbackFormPage",i,e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.id&&this.feedbackProvider.isPluginEnabled(e)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(86),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.feedbackProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModFeedbackPrintLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModFeedback",i.pattern=/\/mod\/feedback\/print\.php.*([\?\&](id)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading();r.courseProvider.getModuleBasicInfo(n.id,e).then(function(n){return r.linkHelper.goInSite(t,"AddonModFeedbackFormPage",{module:n,moduleId:n.id,courseId:n.course,preview:!0},e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.id&&this.feedbackProvider.isPluginEnabled(e)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(86),p=n(248),h=n(22),m=n(46),g=n(26),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,p){var h=e.call(this,t,n,o,r,i,s,a)||this;return h.feedbackProvider=c,h.userProvider=u,h.feedbackHelper=d,h.timeUtils=l,h.groupsProvider=p,h.name="AddonModFeedback",h.modName="feedback",h.component=f.a.COMPONENT,h.updatesNames=/^configuration$|^.*files$|^attemptsfinished|^attemptsunfinished$/,h}return y(t,e),t.prototype.getFiles=function(e,t,n){var o=this,r=[];return this.feedbackProvider.getFeedback(t,e.id).then(function(t){return r=t.pageaftersubmitfiles||[],r=r.concat(o.getIntroFilesFromInstance(e,t)),o.feedbackProvider.getItems(t.id)}).then(function(e){return e.items.forEach(function(e){r=r.concat(e.itemfiles)}),r}).catch(function(){return r})},t.prototype.getIntroFiles=function(e,t){var n=this;return this.feedbackProvider.getFeedback(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.feedbackProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){return this.feedbackProvider.invalidateFeedbackData(t)},t.prototype.isDownloadable=function(e,t){var n=this;return this.feedbackProvider.getFeedback(t,e.id,void 0,!0).then(function(e){var t=n.timeUtils.timestamp();return!(e.timeopen&&e.timeopen>t)&&(!(e.timeclose&&e.timeclose<t)&&n.feedbackProvider.getFeedbackAccessInformation(e.id).then(function(e){return e.isopen}))})},t.prototype.isEnabled=function(){return this.feedbackProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchFeedback.bind(this))},t.prototype.prefetchFeedback=function(e,t,n,o){var r=this;return this.feedbackProvider.getFeedback(t,e.id).then(function(n){var i=[];return i.push(r.getFiles(e,t).then(function(t){return r.filepoolProvider.addFilesToQueue(o,t,r.component,e.id)})),i.push(r.feedbackProvider.getFeedbackAccessInformation(n.id,!1,!0,o).then(function(e){var i=[];return(e.canedititems||e.canviewreports)&&(i.push(r.feedbackProvider.getAnalysis(n.id,void 0,o)),i.push(r.groupsProvider.getActivityGroupInfo(n.coursemodule,!0,void 0,o).then(function(i){var s=[],a=[];return i.groups&&0!=i.groups.length||(i.groups=[{id:0}]),i.groups.forEach(function(t){s.push(r.feedbackProvider.getAnalysis(n.id,t.id,o)),s.push(r.feedbackProvider.getAllResponsesAnalysis(n.id,t.id,o).then(function(e){e.attempts.forEach(function(e){a.push(e.userid)})})),e.isanonymous||s.push(r.feedbackProvider.getAllNonRespondents(n.id,t.id,o).then(function(e){e.users.forEach(function(e){a.push(e.userid)})}))}),Promise.all(s).then(function(){return r.userProvider.prefetchProfiles(a,t,o)})}))),i.push(r.feedbackProvider.getItems(n.id,o)),e.cancomplete&&e.cansubmit&&!e.isempty&&i.push(r.feedbackProvider.processPageOnline(n.id,0,{},void 0,o).finally(function(){var e=[];return e.push(r.feedbackProvider.getCurrentValues(n.id,!1,!0,o)),e.push(r.feedbackProvider.getResumePage(n.id,!1,!0,o)),Promise.all(e)})),Promise.all(i)})),Promise.all(i)})},t=v([Object(o.A)(),b("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,g.a,p.a,h.a,m.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(258),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.feedbackSync=e,this.name="AddonModFeedbackSyncCronHandler"}return e.prototype.execute=function(e){return this.feedbackSync.syncAllFeedbacks(e)},e.prototype.getInterval=function(){return this.feedbackSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(408),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModFolder",this.modName="folder"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("folder"),title:e.name,class:"addon-mod_folder-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModFolderIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return g});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(159),f=n(349),p=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},g=function(e){function t(t,n,o,r,i,s,a,c){var u=e.call(this,t,n,o,r,i,s,a)||this;return u.folderProvider=c,u.name="AddonModFolder",u.modName="folder",u.component=f.a.COMPONENT,u}return p(t,e),t.prototype.downloadOrPrefetch=function(t,n,o,r){var i=[];return i.push(e.prototype.downloadOrPrefetch.call(this,t,n,o)),this.folderProvider.isGetFolderWSAvailable()&&i.push(this.folderProvider.getFolder(n,t.id)),Promise.all(i)},t.prototype.invalidateContent=function(e,t){return this.folderProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.folderProvider.invalidateFolderData(t)),n.push(this.courseProvider.invalidateModule(e.id)),Promise.all(n)},t=h([Object(o.A)(),m("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModFolder","folder")||this;return n.name="AddonModFolderLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.name="AddonModFolderPluginFileHandler",this.component="mod_folder"}return e.prototype.getComponentRevisionRegExp=function(e){if("content"==e[2])return new RegExp("/mod_folder/content/([0-9]+)/")},e.prototype.getComponentRevisionReplace=function(e){return"/mod_folder/content/0/"},e=r([Object(o.A)()],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(409),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModForum",this.modName="forum"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("forum"),title:e.name,class:"addon-mod_forum-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModForumIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e.prototype.displayRefresherInSingleActivity=function(){return!1},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(196),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.forumSync=e,this.name="AddonModForumSyncCronHandler"}return e.prototype.execute=function(e){return this.forumSync.syncAllForums(e)},e.prototype.getInterval=function(){return this.forumSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(44),i=n(21),s=n(117),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t,"AddonModForum","forum")||this;return o.forumProvider=n,o.name="AddonModForumIndexLinkHandler",o}return a(t,e),t.prototype.isEnabled=function(e,t,n,o){return!0},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(8),i=n(31),s=n(32),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.domUtils=t,o.linkHelper=n,o.name="AddonModForumDiscussionLinkHandler",o.featureName="CoreCourseModuleDelegate_AddonModForum",o.pattern=/\/mod\/forum\/discuss\.php.*([\&\?]d=\d+)/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var i={courseId:o||parseInt(n.courseid,10)||parseInt(n.cid,10),discussionId:parseInt(n.d,10)};r.linkHelper.goInSite(t,"AddonModForumDiscussionPage",i,e)}}]},t.prototype.isEnabled=function(e,t,n,o){return!0},t=c([Object(o.A)(),u("design:paramtypes",[r.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(20),i=n(4),s=n(1),a=n(56),c=n(133),u=n(45),d=n(8),l=n(11),f=n(117),p=n(195),h=n(149),m=n(196),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},v=this&&this.__param||function(e,t){return function(n,o){t(n,o,e)}},b=function(){function e(e,t,n,i,s,a,c,u,d,l,f){this.navCtrl=e,this.uploaderProvider=t,this.syncProvider=n,this.domUtils=i,this.textUtils=s,this.translate=a,this.forumProvider=c,this.forumHelper=u,this.forumOffline=d,this.forumSync=l,this.svComponent=f,this.messageControl=new r.b,this.onPostChange=new o.v}return e.prototype.ngOnInit=function(){this.uniqueId=this.post.id?"reply"+this.post.id:"edit"+this.post.parent},e.prototype.openUserProfile=function(e){(this.svComponent?this.svComponent.getMasterNav():this.navCtrl).push("CoreUserProfilePage",{userId:e,courseId:this.courseId})},e.prototype.setReplyData=function(e,t,n,o,r){this.uploaderProvider.clearTmpFiles(this.replyData.files),this.replyData.replyingTo=e||0,this.replyData.isEditing=!!t,this.replyData.subject=n||this.defaultSubject||"",this.replyData.message=o||null,this.replyData.files=r||[],this.messageControl.setValue(this.replyData.message),this.originalData.subject=this.replyData.subject,this.originalData.message=this.replyData.message,this.originalData.files=this.replyData.files.slice()},e.prototype.showReply=function(){var e=this;this.replyData.isEditing?this.confirmDiscard().then(function(){e.setReplyData(e.post.id)}).catch(function(){}):this.replyData.replyingTo?(this.replyData.replyingTo=this.post.id,this.messageControl.setValue(this.replyData.message)):this.setReplyData(this.post.id)},e.prototype.editReply=function(){var e=this;this.confirmDiscard().then(function(){e.syncId=e.forumSync.getDiscussionSyncId(e.discussionId),e.syncProvider.blockOperation(f.a.COMPONENT,e.syncId),e.setReplyData(e.post.parent,!0,e.post.subject,e.post.message,e.post.attachments)}).catch(function(){})},e.prototype.onMessageChange=function(e){this.replyData.message=e},e.prototype.reply=function(){var e=this;if(this.replyData.subject)if(this.replyData.message){var t=!1,n=this.replyData.message,o=this.replyData.subject,r=this.replyData.replyingTo,i=this.replyData.files||[],s={},a=this.domUtils.showModalLoading("core.sending",!0);n=this.textUtils.formatHtmlLines(n),(i.length?this.forumHelper.uploadOrStoreReplyFiles(this.forum.id,r,i,!1).catch(function(n){return e.forum.id?(t=!0,e.forumHelper.uploadOrStoreReplyFiles(e.forum.id,r,i,!0)):Promise.reject(n)}):Promise.resolve()).then(function(a){return a&&(s.attachmentsid=a),t?e.forumOffline.replyPost(r,e.discussionId,e.forum.id,e.forum.name,e.courseId,o,n,s).then(function(){return!1}):e.forumProvider.replyPost(r,e.discussionId,e.forum.id,e.forum.name,e.courseId,o,n,s,void 0,!i.length)}).then(function(t){t&&e.forum.id&&e.forumHelper.deleteReplyStoredFiles(e.forum.id,r),e.setReplyData(),e.onPostChange.emit(),e.syncId&&e.syncProvider.unblockOperation(f.a.COMPONENT,e.syncId)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"addon.mod_forum.couldnotadd",!0)}).finally(function(){a.dismiss()})}else this.domUtils.showErrorModal("addon.mod_forum.erroremptymessage",!0);else this.domUtils.showErrorModal("addon.mod_forum.erroremptysubject",!0)},e.prototype.cancel=function(){var e=this;this.confirmDiscard().then(function(){e.setReplyData(),e.syncId&&e.syncProvider.unblockOperation(f.a.COMPONENT,e.syncId)}).catch(function(){})},e.prototype.discard=function(){var e=this;this.domUtils.showConfirm(this.translate.instant("core.areyousure")).then(function(){var t=[];return t.push(e.forumOffline.deleteReply(e.post.parent)),e.forum.id&&t.push(e.forumHelper.deleteReplyStoredFiles(e.forum.id,e.post.parent).catch(function(){})),Promise.all(t).finally(function(){e.setReplyData(),e.onPostChange.emit(),e.syncId&&e.syncProvider.unblockOperation(f.a.COMPONENT,e.syncId)})}).catch(function(){})},e.prototype.ngOnDestroy=function(){this.syncId&&this.syncProvider.unblockOperation(f.a.COMPONENT,this.syncId)},e.prototype.confirmDiscard=function(){return this.forumHelper.hasPostDataChanged(this.replyData,this.originalData)?this.domUtils.showConfirm(this.translate.instant("core.confirmloss")):Promise.resolve()},g([Object(o.D)(),y("design:type",Object)],e.prototype,"post",void 0),g([Object(o.D)(),y("design:type",Number)],e.prototype,"courseId",void 0),g([Object(o.D)(),y("design:type",Number)],e.prototype,"discussionId",void 0),g([Object(o.D)(),y("design:type",String)],e.prototype,"component",void 0),g([Object(o.D)(),y("design:type",Number)],e.prototype,"componentId",void 0),g([Object(o.D)(),y("design:type",Object)],e.prototype,"replyData",void 0),g([Object(o.D)(),y("design:type",Object)],e.prototype,"originalData",void 0),g([Object(o.D)(),y("design:type",Boolean)],e.prototype,"trackPosts",void 0),g([Object(o.D)(),y("design:type",Object)],e.prototype,"forum",void 0),g([Object(o.D)(),y("design:type",String)],e.prototype,"defaultSubject",void 0),g([Object(o.O)(),y("design:type",o.v)],e.prototype,"onPostChange",void 0),e=g([Object(o.m)({selector:"addon-mod-forum-post",template:'<ion-item text-wrap>\n    <ion-avatar item-start (click)="openUserProfile(post.userid)">\n        <img [src]="post.userpictureurl" onError="this.src=\'assets/img/user-avatar.png\'" core-external-content [alt]="\'core.pictureof\' | translate:{$a: post.userfullname}" role="presentation">\n    </ion-avatar>\n    <h2><span [class.core-bold]="post.parent == 0">{{post.subject}}</span></h2>\n    <p>\n        <ion-note float-right padding-left *ngIf="!post.modified"><ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}</ion-note>\n        <ion-note float-right padding-left *ngIf="post.modified">\n            {{post.modified | coreDateDayOrTime}}\n            <div *ngIf="unread"><ion-icon name="record"></ion-icon> {{ \'addon.mod_forum.unread\' | translate }}</div>\n        </ion-note>\n        {{post.userfullname}}\n    </p>\n</ion-item>\n<ion-card-content>\n    <core-format-text [component]="component" [componentId]="componentId" [text]="post.message"></core-format-text>\n    <div *ngFor="let attachment of post.attachments">\n        \x3c!-- Files already attached to the submission. --\x3e\n        <core-file *ngIf="!attachment.name" [file]="attachment" [component]="component" [componentId]="componentId"></core-file>\n        \x3c!-- Files stored in offline to be sent later. --\x3e\n        <core-local-file *ngIf="attachment.name" [file]="attachment"></core-local-file>\n    </div>\n</ion-card-content>\n<ion-item text-right *ngIf="post.id && post.canreply">\n    <button ion-button icon-left clear small (click)="showReply()" [attr.aria-controls]="\'addon-forum-reply-edit-form-\' + uniqueId" [attr.aria-expanded]="replyData.replyingTo === post.id">\n        <ion-icon name="undo"></ion-icon> {{ \'addon.mod_forum.reply\' | translate }}\n    </button>\n</ion-item>\n<ion-item text-right *ngIf="!post.id && (!replyData.isEditing || replyData.replyingTo != post.parent)">\n    <button ion-button icon-left clear small (click)="editReply()" [attr.aria-controls]="\'addon-forum-reply-edit-form-\' + uniqueId" [attr.aria-expanded]="replyData.replyingTo === post.parent">\n        <ion-icon name="create"></ion-icon> {{ \'addon.mod_forum.edit\' | translate }}\n    </button>\n</ion-item>\n<ion-list [id]="\'addon-forum-reply-edit-form-\' + uniqueId" *ngIf="(post.id && !replyData.isEditing && replyData.replyingTo == post.id) || (!post.id && replyData.isEditing && replyData.replyingTo == post.parent)">\n    <ion-item>\n        <ion-label stacked>{{ \'addon.mod_forum.subject\' | translate }}</ion-label>\n        <ion-input type="text" [placeholder]="\'addon.mod_forum.subject\' | translate" [(ngModel)]="replyData.subject"></ion-input>\n    </ion-item>\n    <ion-item>\n        <ion-label stacked>{{ \'addon.mod_forum.message\' | translate }}</ion-label>\n        <core-rich-text-editor item-content [control]="messageControl" (contentChanged)="onMessageChange($event)" [placeholder]="\'addon.mod_forum.message\' | translate" [name]="\'mod_forum_reply_\' + post.id" [component]="component" [componentId]="componentId"></core-rich-text-editor>\n    </ion-item>\n    <core-attachments *ngIf="forum.id && forum.maxattachments > 0" [files]="replyData.files" [maxSize]="forum.maxbytes" [maxSubmissions]="forum.maxattachments" [component]="component" [componentId]="forum.cmid" [allowOffline]="true"></core-attachments>\n    <ion-grid>\n        <ion-row>\n            <ion-col>\n                <button ion-button block (click)="reply()" [disabled]="replyData.subject == \'\' || replyData.message == null">{{ \'addon.mod_forum.posttoforum\' | translate }}</button>\n            </ion-col>\n            <ion-col>\n                <button ion-button block color="light" (click)="cancel()">{{ \'core.cancel\' | translate }}</button>\n            </ion-col>\n        </ion-row>\n        <ion-row *ngIf="replyData.isEditing">\n            <ion-col>\n                <button ion-button block color="light" (click)="discard()">{{ \'core.discard\' | translate }}</button>\n            </ion-col>\n        </ion-row>\n    </ion-grid>\n</ion-list>\n'}),v(10,Object(o.N)()),y("design:paramtypes",[i.q,a.a,u.a,d.a,l.a,s.c,f.a,p.a,h.a,m.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(411),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModGlossary",this.modName="glossary"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("glossary"),title:e.name,class:"addon-mod_glossary-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModGlossaryIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e.prototype.displayRefresherInSingleActivity=function(){return!1},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(26),p=n(137),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e){function t(t,n,o,r,i,s,a,c,u){var d=e.call(this,t,n,o,r,i,s,a)||this;return d.userProvider=c,d.glossaryProvider=u,d.name="AddonModGlossary",d.modName="glossary",d.component=p.a.COMPONENT,d.updatesNames=/^configuration$|^.*files$|^entries$/,d}return h(t,e),t.prototype.getFiles=function(e,t,n){var o=this;return this.glossaryProvider.getGlossary(t,e.id).then(function(t){return o.glossaryProvider.fetchAllEntries(o.glossaryProvider.getEntriesByLetter,[t.id,"ALL"]).then(function(n){return o.getFilesFromGlossaryAndEntries(e,t,n)})}).catch(function(){return[]})},t.prototype.getFilesFromGlossaryAndEntries=function(e,t,n){var o=this,r=this.getIntroFilesFromInstance(e,t);return n.forEach(function(e){r=(r=r.concat(o.domUtils.extractDownloadableFilesFromHtmlAsFakeFileObjects(e.definition))).concat(e.attachments)}),r},t.prototype.invalidateContent=function(e,t){return this.glossaryProvider.invalidateContent(e,t)},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchGlossary.bind(this))},t.prototype.prefetchGlossary=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.glossaryProvider.getGlossary(t,e.id,o).then(function(n){var i=[];n.browsemodes.forEach(function(e){switch(e){case"letter":break;case"cat":i.push(r.glossaryProvider.fetchAllEntries(r.glossaryProvider.getEntriesByCategory,[n.id,p.a.SHOW_ALL_CATERGORIES],!1,o));break;case"date":i.push(r.glossaryProvider.fetchAllEntries(r.glossaryProvider.getEntriesByDate,[n.id,"CREATION","DESC"],!1,o)),i.push(r.glossaryProvider.fetchAllEntries(r.glossaryProvider.getEntriesByDate,[n.id,"UPDATE","DESC"],!1,o));break;case"author":i.push(r.glossaryProvider.fetchAllEntries(r.glossaryProvider.getEntriesByAuthor,[n.id,"ALL","LASTNAME","ASC"],!1,o))}}),i.push(r.glossaryProvider.fetchAllEntries(r.glossaryProvider.getEntriesByLetter,[n.id,"ALL"],!1,o).then(function(i){var s=[],a=[];i.forEach(function(e){s.push(r.glossaryProvider.getEntry(e.id,o)),a.push(e.userid)}),s.push(r.userProvider.prefetchProfiles(a,t,o));var c=r.getFilesFromGlossaryAndEntries(e,n,i);return s.push(r.filepoolProvider.addFilesToQueue(o,c,r.component,e.id)),Promise.all(s)}))})},t=m([Object(o.A)(),g("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(350),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.glossarySync=e,this.name="AddonModGlossarySyncCronHandler"}return e.prototype.execute=function(e){return this.glossarySync.syncAllGlossaries(e)},e.prototype.getInterval=function(){return this.glossarySync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(44),i=n(21),s=n(137),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t,"AddonModGlossary","glossary")||this;return o.glossaryProvider=n,o.name="AddonModGlossaryIndexLinkHandler",o}return a(t,e),t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(8),i=n(31),s=n(32),a=n(21),c=n(137),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.domUtils=t,i.linkHelper=n,i.glossaryProvider=o,i.courseHelper=r,i.name="AddonModGlossaryEntryLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModGlossary",i.pattern=/\/mod\/glossary\/showentry\.php.*([\&\?]eid=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var i=r.domUtils.showModalLoading(),s=parseInt(n.eid,10);return(o?Promise.resolve(o):r.glossaryProvider.getEntry(s,e).catch(function(e){return r.domUtils.showErrorModalDefault(e,"addon.mod_glossary.errorloadingentry",!0),Promise.reject(null)}).then(function(t){return r.courseHelper.getModuleCourseIdByInstance(t.glossaryid,"glossary",e)})).then(function(n){r.linkHelper.goInSite(t,"AddonModGlossaryEntryPage",{courseId:n,entryId:s},e)}).finally(function(){i.dismiss()})}}]},t=d([Object(o.A)(),l("design:paramtypes",[r.a,s.a,c.a,a.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(10),i=n(412),s=n(237),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.imscpProvider=t,this.name="AddonModImscp",this.modName="imscp"}return e.prototype.isEnabled=function(){return this.imscpProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("imscp"),title:e.name,class:"addon-mod_imscp-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModImscpIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return i.a},e=a([Object(o.A)(),c("design:paramtypes",[r.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModImscp","imscp")||this;return n.name="AddonModImscpLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.name="AddonModImscpPluginFileHandler",this.component="mod_imscp"}return e.prototype.getComponentRevisionRegExp=function(e){return"content"==e[2]?new RegExp("/mod_imscp/content/([0-9]+)/"):"backup"==e[2]?new RegExp("/mod_imscp/backup/([0-9]+)/"):null},e.prototype.getComponentRevisionReplace=function(e){return"/mod_imscp/"+e[2]+"/0/"},e=r([Object(o.A)()],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(413),i=n(10),s=n(95),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.lessonProvider=t,this.name="AddonModLesson",this.modName="lesson"}return e.prototype.isEnabled=function(){return this.lessonProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("lesson"),title:e.name,class:"addon-mod_lesson-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModLessonIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=a([Object(o.A)(),c("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(259),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.lessonSync=e,this.name="AddonModLessonSyncCronHandler"}return e.prototype.execute=function(e){return this.lessonSync.syncAllLessons(e)},e.prototype.getInterval=function(){return this.lessonSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(8),i=n(44),s=n(10),a=n(21),c=n(95),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,t,"AddonModLesson","lesson")||this;return i.lessonProvider=n,i.domUtils=o,i.courseProvider=r,i.name="AddonModLessonIndexLinkHandler",i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){n.userpassword?r.navigateToModuleWithPassword(parseInt(n.id,10),o,n.userpassword,e):r.courseHelper.navigateToModule(parseInt(n.id,10),e,o)}}]},t.prototype.isEnabled=function(e,t,n,o){return this.lessonProvider.isPluginEnabled()},t.prototype.navigateToModuleWithPassword=function(e,t,n,o){var r=this,i=this.domUtils.showModalLoading();return this.courseProvider.getModuleBasicInfo(e,o).then(function(i){return t=t||i.course,r.lessonProvider.storePassword(parseInt(i.instance,10),n,o).catch(function(){}).then(function(){return r.courseHelper.navigateToModule(e,o,t,i.section)})}).catch(function(){return r.courseHelper.navigateToModule(e,o,t)}).finally(function(){i.dismiss()})},t=d([Object(o.A)(),l("design:paramtypes",[a.a,c.a,r.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(2),i=n(8),s=n(235),a=n(32),c=n(10),u=n(21),d=n(95),l=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(e){function t(t,n,o,r,i,s){var a=e.call(this,t,n,o,"AddonModLesson","lesson")||this;return a.lessonProvider=r,a.courseProvider=i,a.linkHelper=s,a.name="AddonModLessonGradeLinkHandler",a.canReview=!0,a}return l(t,e),t.prototype.goToReview=function(e,t,n,o,r){var i,s=this,a=parseInt(t.id,10),c=this.domUtils.showModalLoading();return this.courseProvider.getModuleBasicInfo(a,o).then(function(e){return i=e,n=i.course||n||t.courseid||t.cid,s.lessonProvider.getAccessInformation(i.instance)}).then(function(e){if(e.canviewreports){var c={courseId:Number(n),lessonId:i.instance,userId:parseInt(t.userid,10)};s.linkHelper.goInSite(r,"AddonModLessonUserRetakePage",c,o)}else s.courseHelper.navigateToModule(a,o,n,i.section)}).catch(function(e){s.domUtils.showErrorModalDefault(e,"core.course.errorgetmodule",!0)}).finally(function(){c.dismiss()})},t.prototype.isEnabled=function(e,t,n,o){return this.lessonProvider.isPluginEnabled()},t=f([Object(o.A)(),p("design:paramtypes",[u.a,i.a,r.a,d.a,c.a,a.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(8),i=n(31),s=n(32),a=n(10),c=n(21),u=n(95),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.domUtils=t,s.lessonProvider=n,s.courseHelper=o,s.linkHelper=r,s.courseProvider=i,s.name="AddonModLessonReportLinkHandler",s.featureName="CoreCourseModuleDelegate_AddonModLesson",s.pattern=/\/mod\/lesson\/report\.php.*([\&\?]id=\d+)/,s}return d(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){n.action&&"reportoverview"!=n.action?"reportdetail"==n.action&&r.openUserRetake(parseInt(n.id,10),parseInt(n.userid,10),o,parseInt(n.try,10),e,t):r.openReportOverview(parseInt(n.id,10),o,parseInt(n.group,10),e,t)}}]},t.prototype.isEnabled=function(e,t,n,o){return!("reportdetail"==n.action&&!n.userid)&&this.lessonProvider.isPluginEnabled()},t.prototype.openReportOverview=function(e,t,n,o,r){var i=this,s=this.domUtils.showModalLoading();return this.courseProvider.getModuleBasicInfo(e,o).then(function(e){t=t||e.course;var s={module:e,courseId:Number(t),action:"report",group:n};i.linkHelper.goInSite(r,"AddonModLessonIndexPage",s,o)}).catch(function(e){i.domUtils.showErrorModalDefault(e,"Error processing link.")}).finally(function(){s.dismiss()})},t.prototype.openUserRetake=function(e,t,n,o,r,i){var s=this,a=this.domUtils.showModalLoading();return this.courseProvider.getModuleBasicInfo(e,r).then(function(e){n=n||e.course;var a={lessonId:e.instance,courseId:Number(n),userId:t,retake:o||0};s.linkHelper.goInSite(i,"AddonModLessonUserRetakePage",a,r)}).catch(function(e){s.domUtils.showErrorModalDefault(e,"Error processing link.")}).finally(function(){a.dismiss()})},t=l([Object(o.A)(),f("design:paramtypes",[r.a,u.a,c.a,s.a,a.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(10),s=n(8),a=n(18),c=n(2),u=n(414),d=n(352),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i){this.appProvider=e,this.courseProvider=t,this.domUtils=n,this.filepoolProvider=o,this.sitesProvider=r,this.ltiProvider=i,this.name="AddonModLti",this.modName="lti"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){var o=this,r={icon:this.courseProvider.getModuleIconSrc("lti"),title:e.name,class:"addon-mod_lti-handler",action:function(e,t,n,o,r){t.push("AddonModLtiIndexPage",{module:n,courseId:o},r)},buttons:[{icon:"link",label:"addon.mod_lti.launchactivity",action:function(e,t,n,r){var i=o.domUtils.showModalLoading();o.ltiProvider.getLti(r,n.id).then(function(e){return o.ltiProvider.getLtiLaunchData(e.id).then(function(t){return o.ltiProvider.logView(e.id).then(function(){o.courseProvider.checkModuleCompletion(r,n.completionstatus)}).catch(function(){}),o.ltiProvider.launch(t.endpoint,t.parameters)})}).catch(function(e){o.domUtils.showErrorModalDefault(e,"addon.mod_lti.errorgetlti",!0)}).finally(function(){i.dismiss()})}}]};return this.ltiProvider.getLti(t,e.id).then(function(t){var n=t.secureicon||t.icon;if(n){var i=o.sitesProvider.getCurrentSiteId();o.filepoolProvider.downloadUrl(i,n,!1,d.a.COMPONENT,e.id).then(function(e){r.icon=e}).catch(function(){o.appProvider.isOnline()&&(r.icon=n)})}}).catch(function(){}),r},e.prototype.getMainComponent=function(e,t){return u.a},e=l([Object(o.A)(),f("design:paramtypes",[r.a,i.a,s.a,a.a,c.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModLti","lti")||this;return n.name="AddonModLtiLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(189),i=n(415),s=n(10),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.pageProvider=t,this.name="AddonModPage",this.modName="page"}return e.prototype.isEnabled=function(){return this.pageProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("page"),title:e.name,class:"addon-mod_page-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModPageIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return i.a},e=a([Object(o.A)(),c("design:paramtypes",[s.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModPage","page")||this;return n.name="AddonModPageLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.name="AddonModPagePluginFileHandler",this.component="mod_page"}return e.prototype.getComponentRevisionRegExp=function(e){if("content"==e[2])return new RegExp("/mod_page/content/([0-9]+)/")},e.prototype.getComponentRevisionReplace=function(e){return"/mod_page/content/0/"},e=r([Object(o.A)()],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(416),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModQuiz",this.modName="quiz"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("quiz"),title:e.name,class:"addon-mod_quiz-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModQuizIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(164),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.quizSync=e,this.name="AddonModQuizSyncCronHandler"}return e.prototype.execute=function(e){return this.quizSync.syncAllQuizzes(e)},e.prototype.getInterval=function(){return this.quizSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(44),i=n(21),s=n(92),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this,t,"AddonModQuiz","quiz")||this;return o.quizProvider=n,o.name="AddonModQuizIndexLinkHandler",o}return a(t,e),t.prototype.isEnabled=function(e,t,n,o){return this.quizProvider.isPluginEnabled()},t=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(2),i=n(8),s=n(235),a=n(21),c=n(92),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this,t,n,o,"AddonModQuiz","quiz")||this;return i.quizProvider=r,i.name="AddonModQuizGradeLinkHandler",i.canReview=!1,i}return u(t,e),t.prototype.isEnabled=function(e,t,n,o){return this.quizProvider.isPluginEnabled()},t=d([Object(o.A)(),l("design:paramtypes",[a.a,i.a,r.a,c.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(8),i=n(31),s=n(32),a=n(21),c=n(92),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.domUtils=t,i.quizProvider=n,i.courseHelper=o,i.linkHelper=r,i.name="AddonModQuizReviewLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModQuiz",i.pattern=/\/mod\/quiz\/review\.php.*([\&\?]attempt=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){var i,s=r.domUtils.showModalLoading(),a=parseInt(n.attempt,10),c=parseInt(n.page,10);r.getQuizIdByAttemptId(a).then(function(t){return i=t,o||r.courseHelper.getModuleCourseIdByInstance(i,"quiz",e)}).then(function(o){var s={quizId:i,attemptId:a,courseId:o,page:n.showall?-1:isNaN(c)?-1:c};r.linkHelper.goInSite(t,"AddonModQuizReviewPage",s,e)}).catch(function(e){r.domUtils.showErrorModalDefault(e,"An error occurred while loading the required data.")}).finally(function(){s.dismiss()})}}]},t.prototype.getQuizIdByAttemptId=function(e){return this.quizProvider.getAttemptReview(e).then(function(e){return e.attempt&&e.attempt.quiz?e.attempt.quiz:Promise.reject(null)})},t.prototype.isEnabled=function(e,t,n,o){return this.quizProvider.isPluginEnabled()},t=d([Object(o.A)(),l("design:paramtypes",[r.a,c.a,a.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1559),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModQuizAccessDelayBetweenAttempts",this.ruleName="quizaccess_delaybetweenattempts"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1561),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModQuizAccessIpAddress",this.ruleName="quizaccess_ipaddress"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1563),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModQuizAccessNumAttempts",this.ruleName="quizaccess_numattempts"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1565),c=n(828),u=n(74),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild()],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),l("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(164),i=n(828),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.quizSync=e,this.name="AddonModQuizAccessOfflineAttempts",this.ruleName="quizaccess_offlineattempts"}return e.prototype.getFixedPreflightData=function(e,t,n,o,r){t.confirmdatasaved=1},e.prototype.getPreflightComponent=function(e){return i.a},e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!n&&(!t||Date.now()-this.quizSync.syncInterval>e.syncTime)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1567),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(92),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonModQuizAccessOpenCloseDate",this.ruleName="quizaccess_openclosedate"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e.prototype.shouldShowTimeLeft=function(e,t,n){return!(e.preview&&n>t)&&n>t-r.a.QUIZ_SHOW_TIME_BEFORE_DEADLINE},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(1569),u=n(829),d=n(74),l=n(51),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n){e.registerHandler(t),n.registerSiteTableMigration({name:"mod_quiz_access_password",newName:c.a.PASSWORD_TABLE})}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[d.a,c.a,l.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(2),i=n(829),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.sitesProvider=e,this.tableSchema={name:t.PASSWORD_TABLE,columns:[{name:"id",type:"INTEGER",primaryKey:!0},{name:"password",type:"TEXT"},{name:"timemodified",type:"INTEGER"}]},this.name="AddonModQuizAccessPassword",this.ruleName="quizaccess_password",this.sitesProvider.createTableFromSchema(this.tableSchema)}return t=e,e.prototype.getFixedPreflightData=function(e,t,n,o,r){if(e&&e.id&&void 0===t.quizpassword)return this.getPasswordEntry(e.id,r).then(function(e){t.quizpassword=e.password}).catch(function(){})},e.prototype.getPasswordEntry=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().getRecord(t.PASSWORD_TABLE,{id:e})})},e.prototype.getPreflightComponent=function(e){return i.a},e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return this.getPasswordEntry(e.id,o).then(function(){return!1}).catch(function(){return!0})},e.prototype.notifyPreflightCheckPassed=function(e,t,n,o,r){if(e&&e.id&&void 0!==n.quizpassword)return this.storePassword(e.id,n.quizpassword,r)},e.prototype.notifyPreflightCheckFailed=function(e,t,n,o,r){if(e&&e.id)return this.removePassword(e.id,r)},e.prototype.removePassword=function(e,n){return this.sitesProvider.getSite(n).then(function(n){return n.getDb().deleteRecords(t.PASSWORD_TABLE,{id:e})})},e.prototype.storePassword=function(e,n,o){return this.sitesProvider.getSite(o).then(function(o){var r={id:e,password:n,timemodified:Date.now()};return o.getDb().insertRecord(t.PASSWORD_TABLE,r)})},e.PASSWORD_TABLE="addon_mod_quiz_access_password",e=t=s([Object(o.A)(),a("design:paramtypes",[r.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1571),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModQuizAccessSafeBrowser",this.ruleName="quizaccess_safebrowser"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1573),i=n(74),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModQuizAccessSecureWindow",this.ruleName="quizaccess_securewindow"}return e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!1},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1575),c=n(830),u=n(74),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[c.a],imports:[r.b,i.k,s.b.forChild()],providers:[a.a],exports:[c.a],entryComponents:[c.a]}),l("design:paramtypes",[u.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(830),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonModQuizAccessTimeLimit",this.ruleName="quizaccess_timelimit"}return e.prototype.getPreflightComponent=function(e){return r.a},e.prototype.isEnabled=function(){return!0},e.prototype.isPreflightCheckRequired=function(e,t,n,o){return!t},e.prototype.shouldShowTimeLeft=function(e,t,n){return!(e.preview&&n>t)},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(191),i=n(238),s=n(417),a=n(10),c=n(77),u=n(36),d=n(30),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r){this.resourceProvider=e,this.courseProvider=t,this.mimetypeUtils=n,this.resourceHelper=o,this.prefetchDelegate=r,this.name="AddonModResource",this.modName="resource"}return e.prototype.isEnabled=function(){return this.resourceProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){var o=this,r={icon:this.courseProvider.getModuleIconSrc("resource"),title:e.name,class:"addon-mod_resource-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModResourceIndexPage",{module:n,courseId:o},r)},updateStatus:function(t){r.buttons[0].hidden=t!==d.a.DOWNLOADED||o.resourceHelper.isDisplayedInIframe(e)}.bind(this),buttons:[{hidden:!0,icon:"document",label:"addon.mod_resource.openthefile",action:function(e,t,n,r){o.hideOpenButton(n,r).then(function(e){e||o.resourceHelper.openModuleFile(n,r)})}}]};return this.getIcon(e,t).then(function(e){r.icon=e}),this.hideOpenButton(e,t).then(function(e){r.buttons[0].hidden=e}),r},e.prototype.hideOpenButton=function(e,t){var n=this;return this.courseProvider.loadModuleContents(e,t).then(function(){return n.prefetchDelegate.getModuleStatus(e,t).then(function(t){return t!==d.a.DOWNLOADED||n.resourceHelper.isDisplayedInIframe(e)})})},e.prototype.getIcon=function(e,t){var n=this;return this.courseProvider.loadModuleContents(e,t).then(function(){if(e.contents.length){var t=e.contents[0].filename,o=n.mimetypeUtils.getFileExtension(t);if(1==e.contents.length||"html"!=o&&"htm"!=o)return n.mimetypeUtils.getFileIcon(t)}return n.courseProvider.getModuleIconSrc("resource")})},e.prototype.getMainComponent=function(e,t){return s.a},e=l([Object(o.A)(),f("design:paramtypes",[r.a,a.a,c.a,i.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModResource","resource")||this;return n.name="AddonModResourceLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=function(){function e(){this.name="AddonModResourcePluginFileHandler",this.component="mod_resource"}return e.prototype.getComponentRevisionRegExp=function(e){if("content"==e[2])return new RegExp("/mod_resource/content/([0-9]+)/")},e.prototype.getComponentRevisionReplace=function(e){return"/mod_resource/content/0/"},e=r([Object(o.A)()],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(419),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModScorm",this.modName="scorm"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("scorm"),title:e.name,class:"addon-mod_scorm-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModScormIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(260),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.scormSync=e,this.name="AddonModScormSyncCronHandler"}return e.prototype.execute=function(e){return this.scormSync.syncAllScorms(e)},e.prototype.getInterval=function(){return this.scormSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModScorm","scorm")||this;return n.name="AddonModScormIndexLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(2),i=n(8),s=n(235),a=n(21),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n,o){var r=e.call(this,t,n,o,"AddonModScorm","scorm")||this;return r.name="AddonModScormGradeLinkHandler",r.canReview=!1,r}return c(t,e),t=u([Object(o.A)(),d("design:paramtypes",[a.a,i.a,r.a])],t)}(s.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(420),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModSurvey",this.modName="survey"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("survey"),title:e.name,class:"addon-mod_survey-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModSurveyIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModSurvey","survey")||this;return n.name="AddonModSurveyLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(239),p=n(356),h=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),m=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},g=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},y=function(e){function t(t,n,o,r,i,s,a,c,u){var d=e.call(this,t,n,o,r,i,s,a)||this;return d.surveyProvider=c,d.surveyHelper=u,d.name="AddonModSurvey",d.modName="survey",d.component=f.a.COMPONENT,d.updatesNames=/^configuration$|^.*files$|^answers$/,d}return h(t,e),t.prototype.getIntroFiles=function(e,t){var n=this;return this.surveyProvider.getSurvey(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.surveyProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){return this.surveyProvider.invalidateSurveyData(t)},t.prototype.isEnabled=function(){return!0},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchSurvey.bind(this))},t.prototype.prefetchSurvey=function(e,t,n,o){var r=this;return this.surveyProvider.getSurvey(t,e.id).then(function(t){var n=[],i=r.getIntroFilesFromInstance(e,t);return n.push(r.filepoolProvider.addFilesToQueue(o,i,f.a.COMPONENT,e.id)),t.surveydone||n.push(r.surveyProvider.getQuestions(t.id)),Promise.all(n)})},t=m([Object(o.A)(),g("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(357),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.surveySync=e,this.name="AddonModSurveySyncCronHandler"}return e.prototype.execute=function(e){return this.surveySync.syncAllSurveys(e)},e.prototype.getInterval=function(){return this.surveySync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(421),i=n(10),s=n(358),a=n(359),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.courseProvider=e,this.urlProvider=t,this.urlHelper=n,this.name="AddonModUrl",this.modName="url"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){var o=this,r={icon:this.courseProvider.getModuleIconSrc("url"),title:e.name,class:"addon-mod_url-handler",showDownloadButton:!1,action:function(e,t,n,o,r){t.push("AddonModUrlIndexPage",{module:n,courseId:o},r)},buttons:[{hidden:!(e.contents&&e.contents[0]&&e.contents[0].fileurl),icon:"link",label:"core.openinbrowser",action:function(e,t,n,r){o.hideLinkButton(n,r).then(function(e){e||(o.urlProvider.logView(n.instance).then(function(){o.courseProvider.checkModuleCompletion(r,n.completionstatus)}),o.urlHelper.open(n.contents[0].fileurl))})}}]};return this.hideLinkButton(e,t).then(function(e){r.buttons[0].hidden=e}),r},e.prototype.hideLinkButton=function(e,t){return this.courseProvider.loadModuleContents(e,t).then(function(){return!(e.contents&&e.contents[0]&&e.contents[0].fileurl)})},e.prototype.getMainComponent=function(e,t){return r.a},e=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModUrl","url")||this;return n.name="AddonModUrlLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(422),i=n(10),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.courseProvider=e,this.name="AddonModWiki",this.modName="wiki"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("wiki"),title:e.name,class:"addon-mod_wiki-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModWikiIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(46),f=n(11),p=n(76),h=n(21),m=n(115),g=n(26),y=n(151),v=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),b=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},_=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},P=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f,p){var h=e.call(this,t,n,o,r,i,s,a)||this;return h.wikiProvider=c,h.userProvider=u,h.textUtils=d,h.courseHelper=l,h.groupsProvider=f,h.gradesHelper=p,h.name="AddonModWiki",h.modName="wiki",h.component=y.a.COMPONENT,h.updatesNames=/^.*files$|^pages$/,h}return v(t,e),t.prototype.getAllPages=function(e,t,n,o,r){var i=this;return r=r||this.sitesProvider.getCurrentSiteId(),this.wikiProvider.getWiki(t,e.id,n,r).then(function(e){return i.wikiProvider.getWikiPageList(e,n,o,r)}).catch(function(){return[]})},t.prototype.getDownloadSize=function(e,t,n){var o=this,r=[],i=this.sitesProvider.getCurrentSiteId();return r.push(this.getFiles(e,t,n,i).then(function(e){return o.utils.sumFileSizes(e)})),r.push(this.getAllPages(e,t,!1,!0,i).then(function(e){var t=0;return e.forEach(function(e){e.contentsize&&(t+=e.contentsize)}),{size:t,total:!0}})),Promise.all(r).then(function(e){return e.reduce(function(e,t){return{size:e.size+t.size,total:e.total&&t.total}},{size:0,total:!0})})},t.prototype.getFiles=function(e,t,n,o){var r=this;return o=o||this.sitesProvider.getCurrentSiteId(),this.wikiProvider.getWiki(t,e.id,!1,o).then(function(t){var n=r.getIntroFilesFromInstance(e,t);return r.wikiProvider.getWikiFileList(t,!1,!1,o).then(function(e){return n.concat(e)})}).catch(function(){return[]})},t.prototype.invalidateContent=function(e,t){return this.wikiProvider.invalidateContent(e,t)},t.prototype.prefetch=function(e,t,n,o){var r=this,i=this.sitesProvider.getCurrentSiteId();return this.filepoolProvider.getPackageData(i,this.component,e.id).catch(function(){}).then(function(o){var s=o&&o.downloadTime||0;return r.prefetchPackage(e,t,n,r.prefetchWiki.bind(r),i,[s])})},t.prototype.prefetchWiki=function(e,t,n,o,r){var i=this,s=this.sitesProvider.getCurrentSiteUserId();return this.getAllPages(e,t,!1,!0,o).then(function(a){var c=[];return a.forEach(function(e){e.timemodified>r&&c.push(i.wikiProvider.getPageContents(e.id,!1,!0,o))}),c.push(i.groupsProvider.getActivityGroupMode(e.id,o).then(function(t){if(t===l.a.SEPARATEGROUPS||t===l.a.VISIBLEGROUPS)return i.groupsProvider.getActivityAllowedGroups(e.id,s,o)})),c.push(i.wikiProvider.getWiki(t,e.id,!1,o).then(function(e){return i.courseHelper.getModuleCourseIdByInstance(e.id,"wiki",o)})),c.push(i.courseProvider.getModuleBasicInfo(e.id,o)),c.push(i.getFiles(e,t,n,o).then(function(t){return i.filepoolProvider.addFilesToQueue(o,t,i.component,e.id)})),Promise.all(c)})},t=b([Object(o.A)(),_("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,y.a,g.a,f.a,h.a,l.a,m.a])],t)}(p.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(261),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.wikiSync=e,this.name="AddonModWikiSyncCronHandler"}return e.prototype.execute=function(e){return this.wikiSync.syncAllWikis(e)},e.prototype.getInterval=function(){return this.wikiSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModWiki","wiki")||this;return n.name="AddonModWikiIndexLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(8),i=n(31),s=n(32),a=n(21),c=n(151),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.domUtils=t,i.wikiProvider=n,i.courseHelper=o,i.linkHelper=r,i.name="AddonModWikiPageOrMapLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModWiki",i.pattern=/\/mod\/wiki\/(view|map)\.php.*([\&\?]pageid=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,i){var s=r.domUtils.showModalLoading(),a=parseInt(n.pageid,10),c=-1!=t.indexOf("mod/wiki/map.php")?"map":"page";r.wikiProvider.getPageContents(a,!1,!1,e).then(function(t){return(o?Promise.resolve(o):r.courseHelper.getModuleCourseIdByInstance(t.wikiid,"wiki",e)).then(function(n){r.linkHelper.goInSite(i,"AddonModWikiIndexPage",{courseId:n,pageId:t.id,pageTitle:t.title,wikiId:t.wikiid,subwikiId:t.subwikiid,action:c},e)})}).catch(function(e){r.domUtils.showErrorModalDefault(e,"addon.mod_wiki.errorloadingpage",!0)}).finally(function(){s.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){var r=-1!=t.indexOf("mod/wiki/map.php");return!(n.id&&!r)&&(!r||void 0===n.option||5==n.option)},t=d([Object(o.A)(),l("design:paramtypes",[r.a,c.a,a.a,s.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(8),i=n(31),s=n(32),a=n(10),c=n(21),u=n(151),d=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(e){function t(t,n,o,r,i){var s=e.call(this)||this;return s.domUtils=t,s.wikiProvider=n,s.courseHelper=o,s.linkHelper=r,s.courseProvider=i,s.name="AddonModWikiCreateLinkHandler",s.featureName="CoreCourseModuleDelegate_AddonModWiki",s.pattern=/\/mod\/wiki\/create\.php.*([\&\?]swid=\d+)/,s}return d(t,e),t.prototype.currentStateIsSameWiki=function(e,t,n){var o=this;if(e&&"AddonModWikiIndexPage"==e.component.name){if(e.data.subwikiId==t)return Promise.resolve(!0);if(e.data.pageId)return this.wikiProvider.getPageContents(e.data.pageId,!1,!1,n).then(function(e){return e.subwikiid==t}).catch(function(){return!1});if(e.data.wikiId)return this.wikiProvider.wikiHasSubwiki(e.data.wikiId,t,!1,!1,n);if(e.data.courseId&&e.data.module){var r=e.data.module&&e.data.module.id;if(r)return this.wikiProvider.getWiki(e.data.courseId,r,!1,n).then(function(e){return o.wikiProvider.wikiHasSubwiki(e.id,t,!1,!1,n)}).catch(function(){return!1})}}return Promise.resolve(!1)},t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){var i=r.domUtils.showModalLoading(),s=parseInt(n.swid,10),a=t&&t.getActive();r.currentStateIsSameWiki(a,s,e).then(function(t){if(t){if(a&&a.data.module&&a.data.module.id)return a.data.module;if(a&&a.data.wikiId)return r.courseProvider.getModuleBasicInfoByInstance(a.data.wikiId,"wiki",e).catch(function(){})}}).then(function(i){r.linkHelper.goInSite(t,"AddonModWikiEditPage",{module:i,courseId:o||i&&i.course||a&&a.data.courseId,pageTitle:n.title,subwikiId:s},e)}).finally(function(){i.dismiss()})}}]},t=l([Object(o.A)(),f("design:paramtypes",[r.a,u.a,c.a,s.a,a.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(11),i=n(31),s=n(32),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t,n){var o=e.call(this)||this;return o.linkHelper=t,o.textUtils=n,o.name="AddonModWikiEditLinkHandler",o.featureName="CoreCourseModuleDelegate_AddonModWiki",o.pattern=/\/mod\/wiki\/edit\.php.*([\&\?]pageid=\d+)/,o}return a(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return o=o||n.courseid||n.cid,[{action:function(e,t){var i="";void 0!==n.section&&(i=r.textUtils.decodeURIComponent(n.section.replace(/\+/g," ")));var s={courseId:o,section:i,pageId:parseInt(n.pageid,10)};r.linkHelper.goInSite(t,"AddonModWikiEditPage",s,e)}}]},t=c([Object(o.A)(),u("design:paramtypes",[s.a,r.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1597),i=n(1599),s=n(1601),a=n(1603),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=function(){function e(){}return e=c([Object(o.I)({imports:[r.a,i.a,s.a,a.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(839),d=n(1598),l=n(131),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[d.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(1),i=n(115),s=n(839),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.translate=e,this.gradesHelper=t,this.name="AddonModWorkshopAssessmentStrategyAccumulative",this.strategyName="accumulative"}return e.prototype.isEnabled=function(){return!0},e.prototype.getComponent=function(e){return s.a},e.prototype.getOriginalValues=function(e,t){var n=this,o=this.translate.instant("core.choosedots"),r=[],i=[];return e.fields.forEach(function(s,a){s.dimtitle=n.translate.instant("addon.mod_workshop_assessment_accumulative.dimensionnumber",{$a:s.number});var c=parseInt(s.grade,10)<0?e.dimensionsinfo[a].scale:null;e.current[a]||(e.current[a]={}),r[a]={peercomment:e.current[a].peercomment||"",number:s.number},e.current[a].grade=e.current[a].grade?parseInt(e.current[a].grade,10):-1,i.push(n.gradesHelper.makeGradesMenu(s.grade,t,o,-1,c).then(function(t){s.grades=t,r[a].grade=e.current[a].grade}))}),Promise.all(i).then(function(){return r})},e.prototype.hasDataChanged=function(e,t){for(var n in e){if(e[n].grade!=t[n].grade)return!0;if(e[n].peercomment!=t[n].peercomment)return!0}return!1},e.prototype.prepareAssessmentData=function(e,t){var n=this,o={},r={},i=!1;return t.fields.forEach(function(s,a){var c=parseInt(e[a].grade,10);!isNaN(c)&&c>=0?o["grade__idx_"+a]=c:(r["grade_"+a]=n.translate.instant("addon.mod_workshop_assessment_accumulative.mustchoosegrade"),i=!0),e[a].peercomment&&(o["peercomment__idx_"+a]=e[a].peercomment),o["gradeid__idx_"+a]=parseInt(t.current[a].gradeid,10)||0,o["dimensionid__idx_"+a]=parseInt(s.dimensionid,10),o["weight__idx_"+a]=parseInt(s.weight,10)||0}),i?Promise.reject(r):Promise.resolve(o)},e=a([Object(o.A)(),c("design:paramtypes",[r.c,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(840),d=n(1600),l=n(131),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[d.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(840),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModWorkshopAssessmentStrategyComments",this.strategyName="comments"}return e.prototype.isEnabled=function(){return!0},e.prototype.getComponent=function(e){return i.a},e.prototype.getOriginalValues=function(e,t){var n=this,o=[];return e.fields.forEach(function(t,r){t.dimtitle=n.translate.instant("addon.mod_workshop_assessment_comments.dimensionnumber",{$a:t.number}),e.current[r]||(e.current[r]={}),o[r]={peercomment:e.current[r].peercomment||"",number:t.number}}),Promise.resolve(o)},e.prototype.hasDataChanged=function(e,t){for(var n in e)if(e[n].peercomment!=t[n].peercomment)return!0;return!1},e.prototype.prepareAssessmentData=function(e,t){var n=this,o={},r={},i=!1;return t.fields.forEach(function(s,a){e[a].peercomment?o["peercomment__idx_"+a]=e[a].peercomment:(r["peercomment_"+a]=n.translate.instant("core.err_required"),i=!0),o["gradeid__idx_"+a]=parseInt(t.current[a].gradeid,10)||0,o["dimensionid__idx_"+a]=parseInt(s.dimensionid,10)}),i?Promise.reject(r):Promise.resolve(o)},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(841),d=n(1602),l=n(131),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[d.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(841),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModWorkshopAssessmentStrategyNumErrors",this.strategyName="numerrors"}return e.prototype.isEnabled=function(){return!0},e.prototype.getComponent=function(e){return i.a},e.prototype.getOriginalValues=function(e,t){var n=this,o=[];return e.fields.forEach(function(t,r){t.dimtitle=n.translate.instant("addon.mod_workshop_assessment_numerrors.dimensionnumber",{$a:t.number}),e.current[r]||(e.current[r]={}),o[r]={peercomment:e.current[r].peercomment||"",number:t.number,grade:e.current[r].grade||""}}),Promise.resolve(o)},e.prototype.hasDataChanged=function(e,t){for(var n in e){if(e[n].grade!=t[n].grade)return!0;if(e[n].peercomment!=t[n].peercomment)return!0}return!1},e.prototype.prepareAssessmentData=function(e,t){var n=this,o={},r={},i=!1;return t.fields.forEach(function(s,a){var c=parseInt(e[a].grade);!isNaN(c)&&c>=0?o["grade__idx_"+a]=c:(r["grade_"+a]=n.translate.instant("core.required"),i=!0),e[a].peercomment&&(o["peercomment__idx_"+a]=e[a].peercomment),o["gradeid__idx_"+a]=parseInt(t.current[a].gradeid,10)||0,o["dimensionid__idx_"+a]=parseInt(s.dimensionid,10),o["weight__idx_"+a]=parseInt(s.weight,10)||0}),i?Promise.reject(r):Promise.resolve(o)},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(842),d=n(1604),l=n(131),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a],providers:[d.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[l.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(842),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModWorkshopAssessmentStrategyRubric",this.strategyName="rubric"}return e.prototype.isEnabled=function(){return!0},e.prototype.getComponent=function(e){return i.a},e.prototype.getOriginalValues=function(e,t){var n=this,o=[];return e.fields.forEach(function(t,r){t.dimtitle=n.translate.instant("addon.mod_workshop_assessment_rubric.dimensionnumber",{$a:t.number}),e.current[r]||(e.current[r]={}),o[r]={chosenlevelid:e.current[r].chosenlevelid||"",number:t.number}}),Promise.resolve(o)},e.prototype.hasDataChanged=function(e,t){for(var n in e)if(e[n].chosenlevelid!=(t[n].chosenlevelid||""))return!0;return!1},e.prototype.prepareAssessmentData=function(e,t){var n=this,o={},r={},i=!1;return t.fields.forEach(function(s,a){var c=parseInt(e[a].chosenlevelid,10);!isNaN(c)&&c>=0?o["chosenlevelid__idx_"+a]=c:(r["chosenlevelid_"+a]=n.translate.instant("addon.mod_workshop_assessment_rubric.mustchooseone"),i=!0),o["gradeid__idx_"+a]=parseInt(t.current[a].gradeid,10)||0,o["dimensionid__idx_"+a]=parseInt(s.dimensionid,10)}),i?Promise.reject(r):Promise.resolve(o)},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(2),s=n(26),a=n(106),c=n(136),u=n(116),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r){this.workshopOffline=e,this.workshopHelper=t,this.navCtrl=n,this.userProvider=o,this.component=a.a.COMPONENT,this.loaded=!1,this.offline=!1,this.viewDetails=!1,this.userId=r.getCurrentSiteUserId(),this.showGrade=this.workshopHelper.showGrade}return e.prototype.ngOnInit=function(){var e=this;this.componentId=this.module.instance,this.userId=this.submission.authorid||this.submission.userid||this.userId,this.submission.title=this.submission.title||this.submission.submissiontitle,this.submission.timemodified=this.submission.timemodified||this.submission.submissionmodified,this.submission.id=this.submission.id||this.submission.submissionid,this.workshop.phase==a.a.PHASE_ASSESSMENT&&(this.submission.reviewedby&&this.submission.reviewedby.length&&(this.submission.reviewedbycount=this.submission.reviewedby.reduce(function(e,t){return e+(t.grade?1:0)},0)),this.submission.reviewerof&&this.submission.reviewerof.length&&(this.submission.reviewerofcount=this.submission.reviewerof.reduce(function(e,t){return e+(t.grade?1:0)},0)));var t=[];this.offline=this.submission&&this.submission.offline||this.assessment&&this.assessment.offline,this.submission.id&&t.push(this.workshopOffline.getEvaluateSubmission(this.workshop.id,this.submission.id).then(function(t){e.submission.submissiongradeover=t.gradeover,e.offline=!0}).catch(function(){})),this.userId&&t.push(this.userProvider.getProfile(this.userId,this.courseId,!0).then(function(t){e.profile=t})),this.viewDetails=!this.summary&&this.workshop.phase==a.a.PHASE_CLOSED&&"AddonModWorkshopSubmissionPage"!==this.navCtrl.getActive().name,this.viewDetails&&this.submission.gradeoverby&&t.push(this.userProvider.getProfile(this.submission.gradeoverby,this.courseId,!0).then(function(t){e.evaluateByProfile=t})),Promise.all(t).finally(function(){e.loaded=!0})},e.prototype.gotoSubmission=function(){if(this.submission.timemodified){this.navCtrl.push("AddonModWorkshopSubmissionPage",{module:this.module,workshop:this.workshop,access:this.access,courseId:this.courseId,profile:this.profile,submission:this.submission,assessment:this.assessment})}},d([Object(o.D)(),l("design:type",Object)],e.prototype,"submission",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"module",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"workshop",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"access",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"courseId",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"assessment",void 0),d([Object(o.D)(),l("design:type",Boolean)],e.prototype,"summary",void 0),e=d([Object(o.m)({selector:"addon-mod-workshop-submission",template:'<core-loading [hideUntil]="loaded">\n    <div *ngIf="!summary">\n        <ion-list-header text-wrap>\n            <ion-avatar item-start>\n                <img [src]="profile && profile.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: profile && profile.fullname}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n            </ion-avatar>\n            <h2>{{submission.title}}</h2>\n            <p *ngIf="profile && profile.fullname">{{profile.fullname}}</p>\n            <p *ngIf="showGrade(submission.submissiongrade)" [class.addon-has-overriden-grade]="showGrade(submission.submissiongradeover)">\n                {{ \'addon.mod_workshop.submissiongradeof\' | translate:{$a: workshop.grade } }}: {{submission.submissiongrade}}\n            </p>\n            <p *ngIf="showGrade(submission.submissiongradeover)" class="addon-overriden-grade">\n                {{ \'addon.mod_workshop.gradeover\' | translate }}: {{submission.submissiongradeover}}\n            </p>\n            <p *ngIf="access.canviewallsubmissions && showGrade(submission.gradinggrade)">\n                {{ \'addon.mod_workshop.gradinggradeof\' | translate:{$a: workshop.gradinggrade } }}: {{submission.gradinggrade}}\n            </p>\n            <ion-note item-end *ngIf="!submission.timemodified">\n                <ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}\n            </ion-note>\n            <ion-note item-end *ngIf="submission.timemodified">\n                {{submission.timemodified | coreDateDayOrTime}}\n                <ng-container *ngIf="submission.offline"><ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}</ng-container>\n                <ng-container *ngIf="submission.deleted"><ion-icon name="trash"></ion-icon> {{ \'core.deletedoffline\' | translate }}</ng-container>\n            </ion-note>\n        </ion-list-header>\n        <ion-item text-wrap *ngIf="submission.content">\n            <core-format-text [component]="component" [componentId]="componentId" [text]="submission.content"></core-format-text>\n        </ion-item>\n        <ion-item *ngFor="let attachment of submission.attachmentfiles">\n            \x3c!-- Files already attached to the submission. --\x3e\n            <core-file *ngIf="!attachment.name" [file]="attachment" [component]="component" [componentId]="componentId"></core-file>\n            \x3c!-- Files stored in offline to be sent later. --\x3e\n            <core-local-file *ngIf="attachment.name" [file]="attachment"></core-local-file>\n        </ion-item>\n        <ion-item text-wrap *ngIf="viewDetails && submission.feedbackauthor">\n            <img [src]="evaluateByProfile && evaluateByProfile.profileimageurl" core-external-content core-user-link [courseId]="courseId" [userId]="evaluateByProfile && evaluateByProfile.id" [alt]="\'core.pictureof\' | translate:{$a: evaluateByProfile && evaluateByProfile.fullname}" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'"/>\n\n            <h2 *ngIf="evaluateByProfile && evaluateByProfile.fullname">{{ \'addon.mod_workshop.feedbackby\' | translate : {$a: evaluateByProfile.fullname} }}</h2>\n            <core-format-text [text]="submission.feedbackauthor"></core-format-text>\n        </ion-item>\n        <ion-item *ngIf="viewDetails">\n            <button ion-button block (click)="gotoSubmission()">\n                {{ \'core.showmore\' | translate }}\n                <ion-icon name="arrow-forward" item-end></ion-icon>\n            </button>\n        </ion-item>\n    </div>\n\n    <a ion-item text-wrap *ngIf="summary" [attr.detail-none]="submission.timemodified ? null : true" (click)="gotoSubmission()">\n        <ion-avatar item-start>\n            <img [src]="profile && profile.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: profile && profile.fullname}" core-user-link [courseId]="courseId" [userId]="profile && profile.id" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n        </ion-avatar>\n\n        <h2>{{submission.title}}</h2>\n        <p *ngIf="profile && profile.fullname">{{profile.fullname}}</p>\n        <p *ngIf="submission.reviewedbycount">\n            {{ \'addon.mod_workshop.receivedgrades\' | translate }}: {{submission.reviewedbycount}} / {{submission.reviewedby.length}}\n        </p>\n        <p *ngIf="submission.reviewerofcount">\n            {{ \'addon.mod_workshop.givengrades\' | translate }}: {{submission.reviewerofcount}} / {{submission.reviewerof.length}}\n        </p>\n        <p *ngIf="!showGrade(submission.submissiongradeover) && showGrade(submission.submissiongrade)">\n            {{ \'addon.mod_workshop.submissiongradeof\' | translate:{$a: workshop.grade } }}: {{submission.submissiongrade}}\n        </p>\n        <p *ngIf="showGrade(submission.submissiongradeover)" class="addon-overriden-grade">\n            {{ \'addon.mod_workshop.submissiongradeof\' | translate:{$a: workshop.grade } }}: {{submission.submissiongradeover}}\n        </p>\n        <p *ngIf="access.canviewallsubmissions && showGrade(submission.gradinggrade)">\n            {{ \'addon.mod_workshop.gradinggradeof\' | translate:{$a: workshop.gradinggrade } }}: {{submission.gradinggrade}}\n        </p>\n\n        <ion-badge *ngIf="assessment && (showGrade(assessment.grade) || assessment.offline)" color="success">{{ \'addon.mod_workshop.assessedsubmission\' | translate }}</ion-badge>\n        <ion-badge *ngIf="assessment && !showGrade(assessment.grade) && !assessment.offline" color="danger">{{ \'addon.mod_workshop.notassessed\' | translate }}</ion-badge>\n\n        <ion-note item-end *ngIf="submission.timemodified">\n            {{submission.timemodified | coreDateDayOrTime}}\n            <div *ngIf="offline"><ion-icon name="time"></ion-icon> {{ \'core.notsent\' | translate }}</div>\n            <div *ngIf="submission.deleted"><ion-icon name="trash"></ion-icon> {{ \'core.deletedoffline\' | translate }}</div>\n        </ion-note>\n    </a>\n</core-loading>\n'}),l("design:paramtypes",[u.a,c.a,r.q,s.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(2),s=n(26),a=n(8),c=n(136),u=n(116),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){this.workshopOffline=e,this.workshopHelper=t,this.navCtrl=n,this.userProvider=o,this.domUtils=r,this.canViewAssessment=!1,this.canSelfAssess=!1,this.offline=!1,this.loaded=!1,this.currentUserId=i.getCurrentSiteUserId(),this.showGrade=this.workshopHelper.showGrade}return e.prototype.ngOnInit=function(){var e=this,t=this.access&&this.access.assessingallowed,n=this.assessment.userid||this.assessment.reviewerid,o=[];this.assessmentId=this.assessment.assessmentid||this.assessment.id,this.canViewAssessment=this.assessment.grade,this.canSelfAssess=t&&n==this.currentUserId,n&&o.push(this.userProvider.getProfile(n,this.courseId,!0).then(function(t){e.profile=t}));var r;r=n==this.currentUserId?this.workshopOffline.getAssessment(this.workshop.id,this.assessmentId).then(function(t){e.offline=!0,e.assessment.weight=t.inputdata.weight}):this.workshopOffline.getEvaluateAssessment(this.workshop.id,this.assessmentId).then(function(t){e.offline=!0,e.assessment.gradinggradeover=t.gradinggradeover,e.assessment.weight=t.weight}),o.push(r.catch(function(){e.offline=!1})),Promise.all(o).finally(function(){e.loaded=!0})},e.prototype.gotoAssessment=function(){var e=this;if(!this.canSelfAssess&&this.canViewAssessment){var t={assessment:this.assessment,submission:this.submission,profile:this.profile,courseId:this.courseId,assessmentId:this.assessmentId};if(this.submission)this.navCtrl.push("AddonModWorkshopAssessmentPage",t);else{var n=this.domUtils.showModalLoading("core.sending",!0);this.workshopHelper.getSubmissionById(this.workshop.id,this.assessment.submissionid).then(function(n){t.submission=n,e.navCtrl.push("AddonModWorkshopAssessmentPage",t)}).catch(function(t){e.domUtils.showErrorModalDefault(t,"Cannot load submission")}).finally(function(){n.dismiss()})}}},e.prototype.gotoOwnAssessment=function(){if(this.canSelfAssess){this.navCtrl.push("AddonModWorkshopSubmissionPage",{module:this.module,workshop:this.workshop,access:this.access,courseId:this.courseId,profile:this.profile,submission:this.submission,assessment:this.assessment})}},d([Object(o.D)(),l("design:type",Object)],e.prototype,"assessment",void 0),d([Object(o.D)(),l("design:type",Boolean)],e.prototype,"summary",void 0),d([Object(o.D)(),l("design:type",Number)],e.prototype,"courseId",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"submission",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"module",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"workshop",void 0),d([Object(o.D)(),l("design:type",Object)],e.prototype,"access",void 0),e=d([Object(o.m)({selector:"addon-mod-workshop-assessment",template:'<core-loading [hideUntil]="loaded">\n    <a ion-item *ngIf="summary" text-wrap [attr.detail-none]="canViewAssessment && !canSelfAssess? null : true" (click)="gotoAssessment()">\n        <ion-avatar item-start>\n            <img [src]="profile && profile.profileimageurl" core-external-content [alt]="\'core.pictureof\' | translate:{$a: profile && profile.fullname}" core-user-link [courseId]="courseId" [userId]="profile && profile.id" role="presentation" onError="this.src=\'assets/img/user-avatar.png\'">\n        </ion-avatar>\n\n        <h2 *ngIf="profile && profile.fullname">{{profile.fullname}}</h2>\n        <p *ngIf="showGrade(assessment.grade)">\n            {{ \'addon.mod_workshop.submissiongradeof\' | translate:{$a: workshop.grade } }}: {{assessment.grade}}\n        </p>\n        <p *ngIf="access.canviewallsubmissions && !showGrade(assessment.gradinggradeover) && showGrade(assessment.gradinggrade)">\n            {{ \'addon.mod_workshop.gradinggradeof\' | translate:{$a: workshop.gradinggrade } }}: {{assessment.gradinggrade}}\n        </p>\n        <p *ngIf="access.canviewallsubmissions && showGrade(assessment.gradinggradeover)" class="core-overriden-grade">\n            {{ \'addon.mod_workshop.gradinggradeof\' | translate:{$a: workshop.gradinggrade } }}: {{assessment.gradinggradeover}}\n        </p>\n        <p *ngIf="assessment.weight && assessment.weight != 1">\n            {{ \'addon.mod_workshop.weightinfo\' | translate:{$a: assessment.weight } }}\n        </p>\n        <ion-badge *ngIf="!assessment.grade" color="danger">{{ \'addon.mod_workshop.notassessed\' | translate }}</ion-badge>\n        <button ion-button block *ngIf="canSelfAssess && !showGrade(assessment.grade)" (click)="gotoOwnAssessment()">{{ \'addon.mod_workshop.assess\' | translate }}</button>\n        <button ion-button block *ngIf="canSelfAssess && showGrade(assessment.grade)" (click)="gotoOwnAssessment()">{{ \'addon.mod_workshop.reassess\' | translate }}</button>\n        <ion-note item-end *ngIf="offline">\n            <ion-icon name="time"></ion-icon>{{ \'core.notsent\' | translate }}\n        </ion-note>\n    </a>\n</core-loading>\n'}),l("design:paramtypes",[u.a,c.a,r.q,s.a,a.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(423),i=n(10),s=n(106),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.workshopProvider=t,this.name="AddonModWorkshop",this.modName="workshop"}return e.prototype.isEnabled=function(){return this.workshopProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("workshop"),title:e.name,class:"addon-mod_workshop-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModWorkshopIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=a([Object(o.A)(),c("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(44),i=n(21),s=n(106),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t){var n=e.call(this,t,s.a.COMPONENT,"workshop")||this;return n.name="AddonModWorkshopLinkHandler",n}return a(t,e),t=c([Object(o.A)(),u("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return b});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(10),l=n(76),f=n(46),p=n(26),h=n(106),m=n(136),g=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),y=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},v=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},b=function(e){function t(t,n,o,r,i,s,a,c,u,d,l){var f=e.call(this,t,n,o,r,i,s,a)||this;return f.groupsProvider=c,f.userProvider=u,f.workshopProvider=d,f.workshopHelper=l,f.name="AddonModWorkshop",f.modName="workshop",f.component=h.a.COMPONENT,f.updatesNames=new RegExp("^configuration$|^.*files$|^completion|^gradeitems$|^outcomes$|^submissions$|^assessments$|^assessmentgrades$|^usersubmissions$|^userassessments$|^userassessmentgrades$|^userassessmentgrades$"),f}return g(t,e),t.prototype.getFiles=function(e,t,n){return this.getWorkshopInfoHelper(e,t,!0).then(function(e){return e.files})},t.prototype.getWorkshopInfoHelper=function(e,t,n,o,r,i){var s=this;void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===r&&(r=!1);var a,c,u=[],d=[];return this.sitesProvider.getSite(i).then(function(n){var r=n.getUserId();return s.workshopProvider.getWorkshop(t,e.id,i,o).then(function(t){return d=s.getIntroFilesFromInstance(e,t),d=d.concat(t.instructauthorsfiles).concat(t.instructreviewersfiles),a=t,s.workshopProvider.getWorkshopAccessInformation(a.id,!1,!0,i).then(function(t){if((c=t).canviewallsubmissions)return s.groupsProvider.getActivityGroupInfo(e.id,!1,void 0,i).then(function(e){e.groups&&0!=e.groups.length||(e.groups=[{id:0}]),u=e.groups})})}).then(function(){return s.workshopProvider.getUserPlanPhases(a.id,!1,!0,i).then(function(e){var t=s.workshopHelper.canSubmit(a,c,e[h.a.PHASE_SUBMISSION].tasks),n=s.workshopHelper.canAssess(a,c),o=[];return t&&o.push(s.workshopHelper.getUserSubmission(a.id,r).then(function(e){e&&(d=d.concat(e.contentfiles).concat(e.attachmentfiles))})),c.canviewallsubmissions&&a.phase>=h.a.PHASE_SUBMISSION&&o.push(s.workshopProvider.getSubmissions(a.id).then(function(e){var t=[];return e.forEach(function(e){d=d.concat(e.contentfiles).concat(e.attachmentfiles),t.push(s.workshopProvider.getSubmissionAssessments(a.id,e.id).then(function(e){e.forEach(function(e){d=d.concat(e.feedbackattachmentfiles).concat(e.feedbackcontentfiles)})}))}),Promise.all(t)})),a.phase>=h.a.PHASE_ASSESSMENT&&n&&o.push(s.workshopHelper.getReviewerAssessments(a.id).then(function(e){e.forEach(function(e){d=d.concat(e.feedbackattachmentfiles).concat(e.feedbackcontentfiles)})})),Promise.all(o)})})}).then(function(){return{workshop:a,groups:u,files:d.filter(function(e){return void 0!==e})}}).catch(function(e){return n?{workshop:a,groups:u,files:d.filter(function(e){return void 0!==e})}:Promise.reject(e)})},t.prototype.invalidateContent=function(e,t){return this.workshopProvider.invalidateContent(e,t)},t.prototype.isDownloadable=function(e,t){var n=this;return this.workshopProvider.getWorkshop(t,e.id,void 0,!0).then(function(e){return n.workshopProvider.getWorkshopAccessInformation(e.id).then(function(t){return t.canswitchphase||e.phase>h.a.PHASE_SETUP})})},t.prototype.isEnabled=function(){return this.workshopProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchWorkshop.bind(this))},t.prototype.getAllGradesReport=function(e,t,n){var o=this,r=[];return t.forEach(function(t){r.push(o.workshopProvider.fetchAllGradeReports(e,t.id,void 0,!1,!1,n))}),Promise.all(r).then(function(e){var t={};return e.forEach(function(e){e.forEach(function(e){e.submissionid&&(t[e.submissionid]=e)})}),t})},t.prototype.prefetchWorkshop=function(e,t,n,o){var r=this,i=[];return o=o||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(o).then(function(n){var s=n.getUserId();return r.getWorkshopInfoHelper(e,t,!1,!1,!0,o).then(function(t){var n=t.workshop,a=[],c=[];return a.push(r.filepoolProvider.addFilesToQueue(o,t.files,r.component,e.id)),a.push(r.workshopProvider.getWorkshopAccessInformation(n.id,!1,!0,o).then(function(e){return r.workshopProvider.getUserPlanPhases(n.id,!1,!0,o).then(function(a){var u=r.workshopHelper.canSubmit(n,e,a[h.a.PHASE_SUBMISSION].tasks),d=r.workshopHelper.canAssess(n,e),l=[];u&&(l.push(r.workshopProvider.getSubmissions(n.id)),i.push(s));var f=Promise.resolve();return e.canviewallsubmissions&&n.phase>=h.a.PHASE_SUBMISSION&&(f=r.getAllGradesReport(n.id,t.groups,o).then(function(e){e.forEach(function(e){i.push(e.userid),i.push(e.gradeoverby),e.reviewedby.forEach(function(e){i.push(e.userid),i.push(e.gradinggradeoverby),c[e.assessmentid]=e}),e.reviewerof.forEach(function(e){i.push(e.userid),i.push(e.gradinggradeoverby),c[e.assessmentid]=e})})})),n.phase>=h.a.PHASE_ASSESSMENT&&d&&(f=f.finally(function(){return r.workshopHelper.getReviewerAssessments(n.id,s,void 0,void 0,o).then(function(e){var t=Promise.resolve();return e.forEach(function(e){e.submission.authorid==s&&(t=r.workshopProvider.getAssessment(n.id,e.id)),i.push(e.reviewerid),i.push(e.gradinggradeoverby),c[e.id]=e}),t})})),c.length>0&&(f=f.finally(function(){var e=[];return c.forEach(function(t,i){e.push(r.workshopProvider.getAssessmentForm(n.id,i,void 0,void 0,void 0,o))}),Promise.all(e)})),l.push(f),n.phase==h.a.PHASE_CLOSED&&(l.push(r.workshopProvider.getGrades(n.id)),e.canviewpublishedsubmissions&&l.push(r.workshopProvider.getSubmissions(n.id))),Promise.all(l)})})),a.push(r.courseProvider.getModuleBasicInfoByInstance(n.id,"workshop",o)),a.push(r.courseProvider.getModuleBasicGradeInfo(e.id,o)),Promise.all(a)})}).then(function(){return r.userProvider.prefetchProfiles(i,t,o)})},t=y([Object(o.A)(),v("design:paramtypes",[r.c,i.a,u.a,d.a,s.a,a.a,c.a,f.a,p.a,h.a,m.a])],t)}(l.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(253),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.workshopSync=e,this.name="AddonModWorkshopSyncCronHandler"}return e.prototype.execute=function(e){return this.workshopSync.syncAllWorkshops(e)},e.prototype.getInterval=function(){return this.workshopSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(165),i=n(10),s=n(844),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.notesProvider=e,this.name="AddonNotes",this.priority=200}return e.prototype.isEnabled=function(){return this.notesProvider.isPluginEnabled()},e.prototype.isEnabledForCourse=function(e,t,n,o){return(!t||t.type!=i.a.ACCESS_GUEST)&&(n&&void 0!==n.notes?n.notes:this.notesProvider.isPluginViewNotesEnabledForCourse(e))},e.prototype.getDisplayData=function(e,t){return{title:"addon.notes.notes",class:"addon-notes-course-handler",component:s.a}},e=a([Object(o.A)(),c("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(361),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.notesSync=e,this.name="AddonNotesSyncCronHandler"}return e.prototype.execute=function(e){return this.notesSync.syncAllNotes(e)},e.prototype.getInterval=function(){return 3e5},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(12),s=n(26),a=n(57),c=n(2),u=n(165),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o){var r=this;this.modalCtrl=e,this.sitesProvider=t,this.notesProvider=n,this.name="AddonNotes:addNote",this.priority=200,this.type=a.a.TYPE_COMMUNICATION,this.addNoteEnabledCache={},o.on(i.a.LOGOUT,this.clearAddNoteCache.bind(this)),o.on(s.a.PROFILE_REFRESHED,function(e){r.clearAddNoteCache(e.courseId)})}return e.prototype.clearAddNoteCache=function(e){e?delete this.addNoteEnabledCache[e]:this.addNoteEnabledCache={}},e.prototype.isEnabled=function(){return this.notesProvider.isPluginEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){var r=this;return t&&e.id!=this.sitesProvider.getCurrentSiteUserId()?void 0!==this.addNoteEnabledCache[t]?this.addNoteEnabledCache[t]:this.notesProvider.isPluginAddNoteEnabledForCourse(t).then(function(e){return r.addNoteEnabledCache[t]=e,e}):Promise.resolve(!1)},e.prototype.getDisplayData=function(e,t){var n=this;return{icon:"list",title:"addon.notes.addnewnote",class:"addon-notes-handler",action:function(e,t,o,r){e.preventDefault(),e.stopPropagation();n.modalCtrl.create("AddonNotesAddPage",{userId:o.id,courseId:r}).present()}}},e=d([Object(o.A)(),l("design:paramtypes",[r.o,c.a,u.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(16),c=n(15),u=n(66),d=n(844),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=function(){function e(){}return e=l([Object(o.I)({declarations:[d.a],imports:[r.b,i.k,s.b.forChild(),a.a,c.a,u.a],providers:[],exports:[d.a],entryComponents:[d.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(12),i=n(2),s=n(6),a=n(197),c=n(252),u=n(148),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,i,s){var c=this;this.sitesProvider=t,this.notificationsProvider=o,this.pushNotificationsProvider=i,this.name="AddonNotifications",this.priority=700,this.handler={icon:"notifications",title:"addon.notifications.notifications",page:"AddonNotificationsListPage",class:"addon-notifications-handler",showBadge:!0,badge:"",loading:!0},e.on(a.a.READ_CHANGED_EVENT,function(e){c.updateBadge(e.siteId)}),e.on(a.a.READ_CRON_EVENT,function(e){c.updateBadge(e.siteId)}),e.on(r.a.LOGOUT,function(e){c.handler.badge="",c.handler.loading=!0}),s.on("receive").subscribe(function(e){n.isTrueOrOne(e.notif)&&c.sitesProvider.isCurrentSite(e.site)&&c.updateBadge(e.site)}),s.registerCounterHandler("AddonNotifications")}return e.prototype.isEnabled=function(){return!0},e.prototype.getDisplayData=function(){return this.handler.loading&&this.updateBadge(),this.handler},e.prototype.updateBadge=function(e){var t=this;(e=e||this.sitesProvider.getCurrentSiteId())&&this.notificationsProvider.getUnreadNotificationsCount(null,e).then(function(n){t.handler.badge=n>0?String(n):"",t.pushNotificationsProvider.updateAddonCounter("AddonNotifications",n,e)}).catch(function(){t.handler.badge=""}).finally(function(){t.handler.loading=!1})},e=d([Object(o.A)(),l("design:paramtypes",[r.a,i.a,s.a,a.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(197),i=n(9),s=n(78),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t,n){this.appProvider=e,this.localNotificationsProvider=t,this.notificationsProvider=n,this.name="AddonNotifications",this.priority=500}return e.prototype.isEnabled=function(){return this.notificationsProvider.isNotificationPreferencesEnabled()||this.localNotificationsProvider.isAvailable()&&!this.appProvider.isDesktop()},e.prototype.getDisplayData=function(){return{icon:"notifications",title:"addon.notifications.notificationpreferences",page:"AddonNotificationsSettingsPage",class:"addon-notifications-settings-handler"}},e=a([Object(o.A)(),c("design:paramtypes",[i.a,s.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(9),i=n(12),s=n(78),a=n(2),c=n(11),u=n(186),d=n(197),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t,n,o,r,i,s){this.appProvider=e,this.eventsProvider=t,this.sitesProvider=n,this.localNotifications=o,this.notificationsProvider=r,this.textUtils=i,this.emulatorHelper=s,this.name="AddonNotificationsCronHandler"}return e.prototype.getInterval=function(){return this.appProvider.isDesktop()?6e4:6e5},e.prototype.isSync=function(){return!this.notificationsProvider.isPreciseNotificationCountEnabled()||this.appProvider.isDesktop()},e.prototype.canManualSync=function(){return!0},e.prototype.execute=function(e){return this.sitesProvider.isCurrentSite(e)&&this.eventsProvider.trigger(d.a.READ_CRON_EVENT,{},this.sitesProvider.getCurrentSiteId()),this.appProvider.isDesktop()&&this.localNotifications.isAvailable()&&this.emulatorHelper.checkNewNotifications(d.a.PUSH_SIMULATION_COMPONENT,this.fetchNotifications.bind(this),this.getTitleAndText.bind(this),e),Promise.resolve(null)},e.prototype.fetchNotifications=function(e){return this.notificationsProvider.getUnreadNotifications(0,void 0,!0,!1,!0,e)},e.prototype.getTitleAndText=function(e){var t={title:e.userfromfullname,text:e.mobiletext.replace(/-{4,}/gi,"")};return t.text=this.textUtils.replaceNewLines(t.text,"<br>"),Promise.resolve(t)},e=l([Object(o.A)(),f("design:paramtypes",[r.a,i.a,a.a,s.a,d.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(144),i=n(27),s=n(18),a=n(7),c=n(2),u=n(6),d=n(30),l=n(109),f=(n.n(l),this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s}),p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i){this.sitesProvider=t,this.fileProvider=n,this.filepoolProvider=o,this.http=r,this.utils=i,this.SEPARATOR_35=/\/\*\*? *3\.5(\.0)? *styles? *\*\//i,this.stylesEls={},this.logger=e.getInstance("AddonRemoteThemesProvider")}return t=e,e.prototype.addSite=function(e){if(!e||this.stylesEls[e])return Promise.resolve();var t=document.createElement("style");return t.setAttribute("id","mobilecssurl-"+e),this.disableElement(t,!0),document.head.appendChild(t),this.stylesEls[e]={element:t,hash:""},this.load(e,!0)},e.prototype.clear=function(){var e=this;Array.from(document.querySelectorAll("style[id*=mobilecssurl]")).forEach(function(t){e.disableElement(t,!0)})},e.prototype.disableElement=function(e,t){t?(e.disabled=!0,e.setAttribute("disabled","disabled")):(e.disabled=!1,e.removeAttribute("disabled"))},e.prototype.downloadFileAndRemoveOld=function(e,n){var o=this;return this.filepoolProvider.getFileStateByUrl(e,n).then(function(e){return e!==d.a.NOT_DOWNLOADED}).catch(function(){return!0}).then(function(n){if(!n)return o.filepoolProvider.removeFilesByComponent(e,t.COMPONENT,1)}).then(function(){return o.filepoolProvider.downloadUrl(e,n,!1,t.COMPONENT,1)})},e.prototype.enable=function(e){e=e||this.sitesProvider.getCurrentSiteId(),this.stylesEls[e]&&this.disableElement(this.stylesEls[e].element,!1)},e.prototype.get=function(e){var n=this;return e=e||this.sitesProvider.getCurrentSiteId(),this.sitesProvider.getSite(e).then(function(o){var r,i=o.getInfo();if(i&&i.mobilecssurl)return r=i.mobilecssurl,(n.fileProvider.isAvailable()?n.downloadFileAndRemoveOld(e,r):Promise.resolve(r)).then(function(e){return n.logger.debug("Loading styles from: ",e),n.http.get(e).toPromise()}).then(function(e){var t=e&&e.text();return"string"==typeof t?{fileUrl:r,styles:n.get35Styles(t)}:Promise.reject(null)});i&&""===i.mobilecssurl&&n.filepoolProvider.removeFilesByComponent(e,t.COMPONENT,1)})},e.prototype.get35Styles=function(e){var t=e.search(this.SEPARATOR_35);return t>-1?e.substr(t).replace(this.SEPARATOR_35,""):e},e.prototype.load=function(e,n){var o=this;return e=e||this.sitesProvider.getCurrentSiteId(),n=!!n,this.logger.debug("Load site",e,n),e&&this.stylesEls[e]?(this.disableElement(this.stylesEls[e].element,n),this.get(e).then(function(r){if(void 0!==r){var i=l.Md5.hashAsciiStr(r.styles);o.stylesEls[e].hash!==i&&(o.stylesEls[e].element.innerHTML=r.styles,o.stylesEls[e].hash=i,n&&o.disableElement(o.stylesEls[e].element,!0)),o.filepoolProvider.treatCSSCode(e,r.fileUrl,r.styles,t.COMPONENT,2).catch(function(){})}})):Promise.reject(null)},e.prototype.loadTmpStyles=function(e){var t=this;return e?this.http.get(e).toPromise().then(function(e){var n=e&&e.text();if("string"!=typeof n)return Promise.reject(null);n=t.get35Styles(n);var o=document.createElement("style");o.setAttribute("id","mobilecssurl-tmpsite"),o.innerHTML=n,document.head.appendChild(o),t.stylesEls.tmpsite={element:o,hash:""}}):Promise.resolve()},e.prototype.preloadCurrentSite=function(){var e=this;return this.sitesProvider.getStoredCurrentSiteId().then(function(t){return e.addSite(t)},function(){})},e.prototype.preloadSites=function(){var e=this;return this.sitesProvider.getSitesIds().then(function(t){var n=[];return t.forEach(function(t){n.push(e.addSite(t))}),e.utils.allPromises(n)})},e.prototype.removeSite=function(e){e&&this.stylesEls[e]&&(document.head.removeChild(this.stylesEls[e].element),delete this.stylesEls[e])},e.prototype.unloadTmpStyles=function(){return this.removeSite("tmpsite")},e.COMPONENT="mmaRemoteStyles",e=t=f([Object(o.A)(),p("design:paramtypes",[a.a,c.a,i.a,s.a,r.a,u.a])],e);var t}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(20),i=n(59),s=n(62),a=n(156),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.injector=e,this.dataDelegate=t,this.dataProvider=n,this.gotoEntry=new o.v}return e.prototype.ngOnInit=function(){var e=this;this.field?this.dataDelegate.getComponentForField(this.injector,this.field).then(function(t){e.fieldComponent=t,t&&(e.data={mode:e.mode,field:e.field,value:e.value,database:e.database,error:e.error,gotoEntry:e.gotoEntry,form:e.form,search:e.search})}).finally(function(){e.fieldLoaded=!0}):this.fieldLoaded=!0},e.prototype.ngOnChanges=function(e){this.fieldLoaded&&this.data&&("edit"==this.mode&&e.error&&(this.data.error=e.error.currentValue),"show"!=this.mode&&"list"!=this.mode||!e.value||(this.data.value=e.value.currentValue))},c([Object(o._9)(a.a),u("design:type",a.a)],e.prototype,"dynamicComponent",void 0),c([Object(o.D)(),u("design:type",String)],e.prototype,"mode",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"field",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"value",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"database",void 0),c([Object(o.D)(),u("design:type",String)],e.prototype,"error",void 0),c([Object(o.O)(),u("design:type",o.v)],e.prototype,"gotoEntry",void 0),c([Object(o.D)(),u("design:type",r.c)],e.prototype,"form",void 0),c([Object(o.D)(),u("design:type",Object)],e.prototype,"search",void 0),e=c([Object(o.m)({selector:"addon-mod-data-field-plugin",template:'<core-dynamic-component [component]="fieldComponent" [data]="data">\n    \x3c!-- This content will be replaced by the component if found. --\x3e\n    <core-loading [hideUntil]="fieldLoaded">\n    </core-loading>\n</core-dynamic-component>'}),u("design:paramtypes",[o.C,s.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(12),i=n(59),s=n(150),a=n(2),c=n(26),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n,o,r,i){this.injector=e,this.dataProvider=t,this.dataOffline=n,this.eventsProvider=o,this.userProvider=i,this.rootUrl=r.getCurrentSite().getURL(),this.siteId=r.getCurrentSiteId()}return e.prototype.undoDelete=function(){var e=this,t=this.database.id,n=this.entry.id;return this.dataOffline.getEntry(t,n,"delete",this.siteId).then(function(){return e.dataOffline.deleteEntry(t,n,"delete",e.siteId)}).then(function(){e.eventsProvider.trigger(i.a.ENTRY_CHANGED,{dataId:t,entryId:n},e.siteId)})},e.prototype.ngOnInit=function(){var e=this;switch(this.action){case"more":this.url=this.rootUrl+"/mod/data/view.php?d= "+this.entry.dataid+"&rid="+this.entry.id;break;case"edit":this.url=this.rootUrl+"/mod/data/edit.php?d= "+this.entry.dataid+"&rid="+this.entry.id;break;case"delete":this.url=this.rootUrl+"/mod/data/view.php?d= "+this.entry.dataid+"&delete="+this.entry.id;break;case"approve":this.url=this.rootUrl+"/mod/data/view.php?d= "+this.entry.dataid+"&approve="+this.entry.id;break;case"disapprove":this.url=this.rootUrl+"/mod/data/view.php?d= "+this.entry.dataid+"&disapprove="+this.entry.id;break;case"userpicture":this.userProvider.getProfile(this.entry.userid,this.database.courseid).then(function(t){e.userPicture=t.profileimageurl})}},u([Object(o.D)(),d("design:type",String)],e.prototype,"mode",void 0),u([Object(o.D)(),d("design:type",String)],e.prototype,"action",void 0),u([Object(o.D)(),d("design:type",Object)],e.prototype,"entry",void 0),u([Object(o.D)(),d("design:type",Object)],e.prototype,"database",void 0),e=u([Object(o.m)({selector:"addon-mod-data-action",template:'<a *ngIf="action == \'more\'" ion-button icon-only clear [href]="url" core-link capture="true" [title]="\'addon.mod_data.more\' | translate">\n    <ion-icon name="search"></ion-icon>\n</a>\n\n<a *ngIf="action == \'edit\'" ion-button icon-only clear [href]="url" core-link capture="true" [title]="\'core.edit\' | translate">\n    <ion-icon name="cog"></ion-icon>\n</a>\n\n<a *ngIf="action == \'delete\' && !entry.deleted" ion-button icon-only clear [href]="url" core-link capture="true" [title]="\'core.delete\' | translate">\n    <ion-icon name="trash"></ion-icon>\n</a>\n\n<a *ngIf="action == \'delete\' && entry.deleted" ion-button icon-only clear (click)="undoDelete()" [title]="\'core.restore\' | translate">\n    <ion-icon name="undo"></ion-icon>\n</a>\n\n<a *ngIf="action == \'approve\'" ion-button icon-only clear [href]="url" core-link capture="true" [title]="\'addon.mod_data.approve\' | translate">\n    <ion-icon name="thumbs-up"></ion-icon>\n</a>\n\n<a *ngIf="action == \'disapprove\'" ion-button icon-only clear [href]="url" core-link capture="true" [title]="\'addon.mod_data.disapprove\' | translate">\n    <ion-icon name="thumbs-down"></ion-icon>\n</a>\n\n<core-comments *ngIf="action == \'comments\' && mode == \'list\'" contextLevel="module" [instanceId]="database.coursemodule" component="mod_data" [itemId]="entry.id" area="database_entry"></core-comments>\n\n<span *ngIf="action == \'timeadded\'">{{ entry.timecreated * 1000 |  coreFormatDate:"dffulldate" }}</span>\n<span *ngIf="action == \'timemodified\'">{{ entry.timemodified * 1000 |  coreFormatDate:"dffulldate" }}</span>\n\n<a *ngIf="action == \'userpicture\'" core-user-link [courseId]="database.courseid" [userId]="entry.userid" [title]="entry.fullname">\n    <img class="avatar-round" [src]="userPicture" [alt]="\'core.pictureof\' | translate:{$a: entry.fullname}" core-external-content onError="this.src=\'assets/img/user-avatar.png\'" role="presentation">\n</a>\n\n<a *ngIf="action == \'user\' && entry" core-user-link [courseId]="database.courseid" [userId]="entry.userid" [title]="entry.fullname">{{entry.fullname}}</a>\n'}),d("design:paramtypes",[o.C,i.a,s.a,r.a,a.a,c.a])],e)}()},,,,,,,,,,,,,,,,,,,function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(4),i=n(762),s=n(9),a=n(12),c=n(93),u=n(7),d=n(2),l=n(71),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t,n,o,r,i,s,a,c){this.platform=e,this.eventsProvider=o,this.loginHelper=r,this.zone=i,this.appProvider=s,this.langProvider=a,this.sitesProvider=c,this.rootPage="CoreLoginInitPage",this.lastUrls={},this.logger=n.getInstance("AppComponent"),e.ready().then(function(){e.is("android")?t.styleLightContent():t.styleDefault()})}return e.prototype.ngOnInit=function(){var e=this;this.eventsProvider.on(a.a.LOGOUT,function(){e.appProvider.getRootNavController().setRoot("CoreLoginSitesPage"),e.langProvider.clearCustomStrings()}),this.eventsProvider.on(a.a.SESSION_EXPIRED,function(t){e.loginHelper.sessionExpired(t)}),this.eventsProvider.on(a.a.PASSWORD_CHANGE_FORCED,function(t){e.loginHelper.openInAppForEdit(t.siteId,"/login/change_password.php","core.forcepasswordchangenotice",!0)}),this.eventsProvider.on(a.a.USER_NOT_FULLY_SETUP,function(t){e.loginHelper.openInAppForEdit(t.siteId,"/user/edit.php","core.usernotfullysetup")}),this.eventsProvider.on(a.a.SITE_POLICY_NOT_AGREED,function(t){e.loginHelper.sitePolicyNotAgreed(t.siteId)}),this.eventsProvider.on(a.a.IAB_LOAD_START,function(t){e.loginHelper.inAppBrowserLoadStart(t.url)}),this.eventsProvider.on(a.a.IAB_EXIT,function(){e.loginHelper.waitingForBrowser=!1,e.loginHelper.lastInAppUrl="",e.loginHelper.checkLogout()}),this.platform.resume.subscribe(function(){setTimeout(function(){e.loginHelper.waitingForBrowser=!1,e.loginHelper.checkLogout()},1e3)}),window.handleOpenURL=function(t){e.zone.run(function(){e.lastUrls[t]&&Date.now()-e.lastUrls[t]<3e3||(e.logger.debug("App launched by URL ",t),e.lastUrls[t]=Date.now(),e.eventsProvider.trigger(a.a.APP_LAUNCHED_URL,t))})},this.eventsProvider.on(a.a.APP_LAUNCHED_URL,function(t){e.loginHelper.appLaunchedByURL(t)});var t=function(){var t=e.sitesProvider.getCurrentSite(),n=t&&t.getStoredConfig("tool_mobile_customlangstrings");void 0!==n&&e.langProvider.loadCustomStrings(n)};this.eventsProvider.on(a.a.LOGIN,function(){t()}),this.eventsProvider.on(a.a.SITE_UPDATED,function(n){n==e.sitesProvider.getCurrentSiteId()&&t()})},e=f([Object(o.m)({template:'<ion-nav [root]="rootPage"></ion-nav>\n'}),p("design:paramtypes",[r.s,i.a,u.a,a.a,l.a,o.M,s.a,c.a,d.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(68),r=n(13),i=n(142),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a="opacity",c="translateX",u="show-back-button",d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return s(t,e),t.prototype.init=function(){e.prototype.init.call(this);var t=this.plt,n=t.isRTL?"-99.5%":"99.5%",i=t.isRTL?"33%":"-33%",s=this.enteringView,d=this.leavingView,l=this.opts;this.duration(Object(r.m)(l.duration)?l.duration:500),this.easing(Object(r.m)(l.easing)?l.easing:"cubic-bezier(0.36,0.66,0.04,1)");var f="back"===l.direction,p=s&&s.hasNavbar(),h=d&&d.hasNavbar();if(s){var m=s.pageRef().nativeElement,g=new o.a(t,m);if(this.add(g),f?g.fromTo(c,i,"0%",!0).fromTo(a,.8,1,!0):g.beforeClearStyles([a]).fromTo(c,n,"0%",!0),p){var y=m.querySelector("ion-navbar"),v=new o.a(t,y);this.add(v);var b=new o.a(t,y.querySelector(".back-button"));if(v.add(b),f)s.enableBack()&&b.beforeAddClass(u).fromTo(a,.01,1,!0);else if(s.enableBack()){b.beforeAddClass(u).fromTo(a,.01,1,!0);var _=new o.a(t,y.querySelector(".back-button-text"));_.fromTo(c,t.isRTL?"-100px":"100px","0px"),v.add(_)}else b.beforeRemoveClass(u)}}if(d&&d.pageRef()){var P=d.pageRef().nativeElement,O=new o.a(t,P);if(this.add(O),f?O.beforeClearStyles([a]).fromTo(c,"0%",t.isRTL?"-100%":"100%"):O.fromTo(c,"0%",i).fromTo(a,1,.8).afterClearStyles(["transform",a]),h){var w=P.querySelector("ion-navbar"),S=new o.a(t,w),R=new o.a(t,w.querySelector(".back-button"));if(S.add(R),this.add(S),R.fromTo(a,.99,0),f){var E=new o.a(t,w.querySelector(".back-button-text"));E.fromTo(c,"0%",(t.isRTL?-300:300)+"px"),S.add(E)}else R.afterClearStyles([a])}}},t}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(199),i=n(942),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=function(){function e(){}return e=s([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(50),i=n(1643),s=n(943),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=[r.a,i.a],d=function(){function e(e){}return e=a([Object(o.I)({declarations:[],imports:[s.a],providers:u}),c("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return J});var o=n(0),r=n(144),i=n(1),s=n(9),a=n(12),c=n(18),u=n(93),d=n(7),l=n(2),f=n(8),p=n(11),h=n(47),m=n(6),g=n(50),y=n(329),v=n(65),b=n(10),_=n(81),P=n(35),O=n(36),w=n(104),S=n(97),R=n(57),E=n(119),C=n(199),I=n(38),A=n(70),D=n(257),j=n(74),x=n(110),T=n(102),k=n(131),M=n(1644),N=n(1645),U=n(1646),F=n(1647),L=n(1648),H=n(1649),q=n(1650),B=n(1651),K=n(1652),G=n(1653),W=n(1654),z=n(1655),V=n(1656),Q=n(1657),Y=n(1658),$=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},X=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},J=function(){function e(e,t,n,o,r,i,s,c,u,d,l,f,p,h,m,g,y,v,b,_,P,O,w,S,R,E,C,I,A,D,j){var x=this;this.sitesProvider=t,this.domUtils=n,this.mainMenuDelegate=o,this.moduleDelegate=r,this.userDelegate=i,this.langProvider=s,this.http=c,this.sitePluginsProvider=u,this.prefetchDelegate=d,this.compileProvider=l,this.utils=f,this.urlUtils=p,this.courseOptionsDelegate=h,this.courseFormatDelegate=g,this.profileFieldDelegate=y,this.textUtils=v,this.filepoolProvider=b,this.settingsDelegate=_,this.questionDelegate=P,this.questionBehaviourDelegate=O,this.questionProvider=w,this.messageOutputDelegate=S,this.accessRulesDelegate=R,this.assignSubmissionDelegate=E,this.translate=C,this.assignFeedbackDelegate=I,this.appProvider=A,this.workshopAssessmentStrategyDelegate=D,this.courseProvider=j,this.logger=e.getInstance("CoreSitePluginsHelperProvider"),m.on(a.a.LOGIN,function(){var e=x.sitesProvider.getCurrentSiteId();x.fetchSitePlugins(e).then(function(t){e==x.sitesProvider.getCurrentSiteId()&&t.length&&x.loadSitePlugins(t).then(function(){m.trigger(a.a.SITE_PLUGINS_LOADED,{},e)})})}),m.on(a.a.LOGOUT,function(){x.sitePluginsProvider.hasSitePluginsLoaded&&window.location.reload()})}return e.prototype.downloadStyles=function(e,t,n,o){var r=this;return this.sitesProvider.getSite(o).then(function(o){var i=n.styles&&n.styles.url;i&&!r.urlUtils.isAbsoluteURL(i)&&(i=r.textUtils.concatenatePaths(o.getURL(),i));var s=r.sitePluginsProvider.getHandlerUniqueName(e,t)+"#main";return r.filepoolProvider.getFilesByComponent(o.id,g.a.COMPONENT,s).then(function(e){e.forEach(function(e){e.url!=i&&r.filepoolProvider.removeFileByUrl(o.id,e.url).catch(function(){})})}).catch(function(){}),i?r.filepoolProvider.downloadUrl(o.id,i,!1,g.a.COMPONENT,s,0,void 0,void 0,void 0,n.styles.version).then(function(e){return r.http.get(e).toPromise()}).then(function(e){var t=e&&e.text();return"string"==typeof t?t:Promise.reject(null)}):""})},e.prototype.executeHandlerInit=function(e,t){return t.init?this.executeMethodAndJS(e,t.init,!0):Promise.resolve({})},e.prototype.executeMethodAndJS=function(e,t,n){var o=this,r=this.sitesProvider.getCurrentSiteId();return this.sitePluginsProvider.getContent(e.component,t,{},{getFromCache:!1,deleteCacheIfWSError:n}).then(function(e){if(!e.javascript||o.sitesProvider.getCurrentSiteId()!=r)return e;var t={};o.compileProvider.injectLibraries(t);var n=o.sitePluginsProvider.createDataForJS(e);for(var i in n)t[i]=n[i];return e.jsResult=o.compileProvider.executeJavascript(t,e.javascript),e})},e.prototype.fetchSitePlugins=function(e){var t=this,n=[];return this.sitesProvider.getSite(e).then(function(e){return t.sitePluginsProvider.isGetContentAvailable(e)?e.read("tool_mobile_get_plugins_supporting_mobile",{},{getFromCache:!1}).then(function(o){return o.plugins.forEach(function(o){t.isSitePluginEnabled(o,e)&&n.push(o)}),n}):n})},e.prototype.getPrefixForStrings=function(e){return e?"plugin."+e+".":""},e.prototype.getPrefixedString=function(e,t){return this.getPrefixForStrings(e)+t},e.prototype.isSitePluginEnabled=function(e,t){return!(t.isFeatureDisabled("sitePlugin_"+e.component+"_"+e.addon)||!e.handlers)&&(e.parsedHandlers||(e.parsedHandlers=this.textUtils.parseJSON(e.handlers,null,this.logger.error.bind(this.logger,"Error parsing site plugin handlers"))),!(!e.parsedHandlers||!Object.keys(e.parsedHandlers).length))},e.prototype.loadLangStrings=function(e){if(e.parsedLang)for(var t in e.parsedLang){var n=this.getPrefixForStrings(e.addon);this.langProvider.addSitePluginsStrings(t,e.parsedLang[t],n)}},e.prototype.loadSitePlugin=function(e){var t=[];this.logger.debug("Load site plugin:",e),e.parsedHandlers||(e.parsedHandlers=this.textUtils.parseJSON(e.handlers,null,this.logger.error.bind(this.logger,"Error parsing site plugin handlers"))),!e.parsedLang&&e.lang&&(e.parsedLang=this.textUtils.parseJSON(e.lang,null,this.logger.error.bind(this.logger,"Error parsing site plugin lang"))),this.sitePluginsProvider.hasSitePluginsLoaded=!0,this.loadLangStrings(e);for(var n in e.parsedHandlers)t.push(this.registerHandler(e,n,e.parsedHandlers[n]));return this.utils.allPromises(t)},e.prototype.loadSitePlugins=function(e){var t=this,n=[];return e.forEach(function(e){n.push(t.loadSitePlugin(e))}),this.utils.allPromises(n)},e.prototype.loadStyles=function(e,t,n,o,r,i){i=i||this.sitesProvider.getCurrentSiteId();var s=document.createElement("style"),a=this.sitePluginsProvider.getHandlerUniqueName(e,t);s.setAttribute("id","siteplugin-"+a),s.innerHTML=o,document.head.appendChild(s),this.filepoolProvider.treatCSSCode(i,n,o,g.a.COMPONENT,a,r).catch(function(){})},e.prototype.registerHandler=function(e,t,n){var o,r,i=this,s=[],a=this.sitesProvider.getCurrentSiteId();return s.push(this.downloadStyles(e,t,n,a).then(function(e){r=e}).catch(function(e){i.logger.error("Error getting styles for plugin",t,n,e)})),s.push(this.executeHandlerInit(e,n).then(function(e){o=e})),Promise.all(s).then(function(){r&&i.loadStyles(e,t,n.styles.url,r,n.styles.version,a);var s;switch(n.delegate){case"CoreMainMenuDelegate":s=Promise.resolve(i.registerMainMenuHandler(e,t,n,o));break;case"CoreCourseModuleDelegate":s=Promise.resolve(i.registerModuleHandler(e,t,n));break;case"CoreUserDelegate":s=Promise.resolve(i.registerUserProfileHandler(e,t,n,o));break;case"CoreCourseOptionsDelegate":s=Promise.resolve(i.registerCourseOptionHandler(e,t,n,o));break;case"CoreCourseFormatDelegate":s=Promise.resolve(i.registerCourseFormatHandler(e,t,n));break;case"CoreUserProfileFieldDelegate":s=Promise.resolve(i.registerUserProfileFieldHandler(e,t,n));break;case"CoreSettingsDelegate":s=Promise.resolve(i.registerSettingsHandler(e,t,n,o));break;case"CoreQuestionDelegate":s=Promise.resolve(i.registerQuestionHandler(e,t,n));break;case"CoreQuestionBehaviourDelegate":s=Promise.resolve(i.registerQuestionBehaviourHandler(e,t,n));break;case"AddonMessageOutputDelegate":s=Promise.resolve(i.registerMessageOutputHandler(e,t,n,o));break;case"AddonModQuizAccessRuleDelegate":s=Promise.resolve(i.registerQuizAccessRuleHandler(e,t,n));break;case"AddonModAssignFeedbackDelegate":s=Promise.resolve(i.registerAssignFeedbackHandler(e,t,n));break;case"AddonModAssignSubmissionDelegate":s=Promise.resolve(i.registerAssignSubmissionHandler(e,t,n));break;case"AddonWorkshopAssessmentStrategyDelegate":s=Promise.resolve(i.registerWorkshopAssessmentStrategyHandler(e,t,n));break;default:s=Promise.resolve()}return s.then(function(r){r&&i.sitePluginsProvider.setSitePluginHandler(r,{plugin:e,handlerName:t,handlerSchema:n,initResult:o})})}).catch(function(e){i.logger.error("Error executing init method",n.init,e)})},e.prototype.registerComponentInitHandler=function(e,t,n,o,r){var i=this;if(n.method)return this.logger.debug("Register site plugin",e,n),this.executeMethodAndJS(e,n.method).then(function(s){var a=i.sitePluginsProvider.getHandlerUniqueName(e,t),c=r(a,s);if(n.methodTemplates=s.templates,n.methodJSResult=s.jsResult,s&&s.jsResult)for(var u in c)"constructor"!=u&&"function"==typeof c[u]&&"function"==typeof s.jsResult[u]&&(c[u]=s.jsResult[u].bind(c));return o.registerHandler(c),e.component}).catch(function(t){i.logger.error("Error executing main method",e.component,n.method,t)});this.logger.warn("Ignore site plugin because it doesn't provide method",e,n)},e.prototype.registerAssignFeedbackHandler=function(e,t,n){var o=this;return this.registerComponentInitHandler(e,t,n,this.assignFeedbackDelegate,function(t,n){var r=e.component.replace("assignfeedback_",""),i=o.getPrefixForStrings(e.addon);return new V.a(o.translate,t,r,i)})},e.prototype.registerAssignSubmissionHandler=function(e,t,n){var o=this;return this.registerComponentInitHandler(e,t,n,this.assignSubmissionDelegate,function(t,n){var r=e.component.replace("assignsubmission_",""),i=o.getPrefixForStrings(e.addon);return new Q.a(o.translate,t,r,i)})},e.prototype.registerCourseFormatHandler=function(e,t,n){this.logger.debug("Register site plugin in course format delegate:",e,n);var o=this.sitePluginsProvider.getHandlerUniqueName(e,t),r=e.component.replace("format_","");return this.courseFormatDelegate.registerHandler(new M.a(o,r,n)),r},e.prototype.registerCourseOptionHandler=function(e,t,n,o){if(n.displaydata){this.logger.debug("Register site plugin in course option delegate:",e,n,o);var r=this.sitePluginsProvider.getHandlerUniqueName(e,t),i=this.getPrefixedString(e.addon,n.displaydata.title);return this.courseOptionsDelegate.registerHandler(new N.a(r,i,e,n,o,this.sitePluginsProvider)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerMainMenuHandler=function(e,t,n,o){if(n.displaydata){this.logger.debug("Register site plugin in main menu delegate:",e,n,o);var r=this.sitePluginsProvider.getHandlerUniqueName(e,t),i=this.getPrefixedString(e.addon,n.displaydata.title);return this.mainMenuDelegate.registerHandler(new L.a(r,i,e,n,o)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerMessageOutputHandler=function(e,t,n,o){if(n.displaydata){this.logger.debug("Register site plugin in message output delegate:",e,n,o);var r=this.sitePluginsProvider.getHandlerUniqueName(e,t),i=this.getPrefixedString(e.addon,n.displaydata.title),s=e.component.replace("message_","");return this.messageOutputDelegate.registerHandler(new W.a(r,s,i,e,n,o)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerModuleHandler=function(e,t,n){if(n.displaydata){this.logger.debug("Register site plugin in module delegate:",e,n);var o=this.sitePluginsProvider.getHandlerUniqueName(e,t),r=e.component.replace("mod_","");return this.moduleDelegate.registerHandler(new U.a(o,r,n)),n.offlinefunctions&&Object.keys(n.offlinefunctions).length&&this.prefetchDelegate.registerHandler(new F.a(this.translate,this.appProvider,this.utils,this.courseProvider,this.filepoolProvider,this.sitesProvider,this.domUtils,this.sitePluginsProvider,e.component,o,r,n)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerQuestionHandler=function(e,t,n){return this.registerComponentInitHandler(e,t,n,this.questionDelegate,function(t,n){return new K.a(t,e.component)})},e.prototype.registerQuestionBehaviourHandler=function(e,t,n){var o=this;return this.registerComponentInitHandler(e,t,n,this.questionBehaviourDelegate,function(t,n){var r=e.component.replace("qbehaviour_","");return new G.a(o.questionProvider,t,r,n.templates.length)})},e.prototype.registerQuizAccessRuleHandler=function(e,t,n){return this.registerComponentInitHandler(e,t,n,this.accessRulesDelegate,function(t,n){return new z.a(t,e.component,n.templates.length)})},e.prototype.registerSettingsHandler=function(e,t,n,o){if(n.displaydata){this.logger.debug("Register site plugin in settings delegate:",e,n,o);var r=this.sitePluginsProvider.getHandlerUniqueName(e,t),i=this.getPrefixedString(e.addon,n.displaydata.title);return this.settingsDelegate.registerHandler(new B.a(r,i,e,n,o)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerUserProfileHandler=function(e,t,n,o){if(n.displaydata){this.logger.debug("Register site plugin in user profile delegate:",e,n,o);var r=this.sitePluginsProvider.getHandlerUniqueName(e,t),i=this.getPrefixedString(e.addon,n.displaydata.title);return this.userDelegate.registerHandler(new H.a(r,i,e,n,o,this.sitePluginsProvider)),r}this.logger.warn("Ignore site plugin because it doesn't provide displaydata",e,n)},e.prototype.registerUserProfileFieldHandler=function(e,t,n){return this.registerComponentInitHandler(e,t,n,this.profileFieldDelegate,function(t,n){var o=e.component.replace("profilefield_","");return new q.a(t,o)})},e.prototype.registerWorkshopAssessmentStrategyHandler=function(e,t,n){return this.registerComponentInitHandler(e,t,n,this.workshopAssessmentStrategyDelegate,function(t,n){var o=e.component.replace("workshopform_","");return new Y.a(t,o)})},e=$([Object(o.A)(),X("design:paramtypes",[d.a,l.a,f.a,_.a,P.a,R.a,u.a,r.a,g.a,O.a,y.a,m.a,h.a,w.a,a.a,S.a,E.a,p.a,c.a,C.a,I.a,A.a,v.a,D.a,j.a,T.a,i.c,x.a,s.a,k.a,b.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(132),r=n(340),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.format=n,r.handlerSchema=o,r}return i(t,e),t.prototype.canViewAllSections=function(e){return void 0===this.handlerSchema.canviewallsections||this.handlerSchema.canviewallsections},t.prototype.displayEnableDownload=function(e){return void 0===this.handlerSchema.displayenabledownload||this.handlerSchema.displayenabledownload},t.prototype.displaySectionSelector=function(e){return void 0===this.handlerSchema.displaysectionselector||this.handlerSchema.displaysectionselector},t.prototype.getCourseFormatComponent=function(e,t){if(this.handlerSchema.method)return r.a},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(132),r=n(339),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o,r,i,s){var a=e.call(this,t)||this;return a.title=n,a.plugin=o,a.handlerSchema=r,a.initResult=i,a.sitePluginsProvider=s,a.priority=r.priority,a}return i(t,e),t.prototype.isEnabledForCourse=function(e,t,n,o){return this.sitePluginsProvider.isHandlerEnabledForCourse(e,this.handlerSchema.restricttoenrolledcourses,this.initResult.restrict)},t.prototype.getDisplayData=function(e,t){return{title:this.title,class:this.handlerSchema.displaydata.class,component:r.a,componentData:{handlerUniqueName:this.name}}},t.prototype.prefetch=function(e){return this.sitePluginsProvider.prefetchFunctions(this.plugin.component,{courseid:e.id},this.handlerSchema,e.id,void 0,!0)},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(132),r=n(256),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o){var r=e.call(this,t)||this;return r.modName=n,r.handlerSchema=o,r}return i(t,e),t.prototype.getData=function(e,t,n){var o=!(!this.handlerSchema.offlinefunctions||!Object.keys(this.handlerSchema.offlinefunctions).length),r=this.handlerSchema.downloadbutton;return{title:e.name,icon:this.handlerSchema.displaydata.icon,class:this.handlerSchema.displaydata.class,showDownloadButton:void 0!==r?r:o,action:function(e,t,n,o,r){e.preventDefault(),e.stopPropagation(),t.push("CoreSitePluginsModuleIndexPage",{title:n.name,module:n,courseId:o},r)}}},t.prototype.getMainComponent=function(e,t,n){return r.a},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(76),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,t,n,o,r,i,s,a)||this;if(p.sitePluginsProvider=c,p.handlerSchema=f,p.ROOT_CACHE_KEY="CoreSitePluginsModulePrefetchHandler:",p.component=u,p.name=d,p.modName=l,p.isResource=f.isresource,f.updatesnames)try{p.updatesNames=new RegExp(f.updatesnames)}catch(e){}return p}return r(t,e),t.prototype.downloadOrPrefetch=function(e,t,n,o){return this.prefetchPackage(e,t,!1,this.downloadPrefetchPlugin.bind(this),void 0,n,o)},t.prototype.downloadPrefetchPlugin=function(e,t,n,o,r,i){var s=this;return this.sitesProvider.getSite(o).then(function(n){var o=[],a={courseid:t,cmid:e.id,userid:n.getUserId()};return o.push(s.downloadOrPrefetchFiles(n.id,e,t,r,i)),o.push(s.sitePluginsProvider.prefetchFunctions(s.component,a,s.handlerSchema,t,e,r,i,n)),Promise.all(o)})},t.prototype.downloadOrPrefetchFiles=function(e,t,n,o,r){var i=this;return this.loadContents(t,n,!0).then(function(){return i.getIntroFiles(t,n)}).then(function(n){var s=i.getContentDownloadableFiles(t),a=[];if(r)a.push(i.filepoolProvider.downloadOrPrefetchFiles(e,n,o,!1,i.component,t.id)),a.push(i.filepoolProvider.downloadOrPrefetchFiles(e,s,o,!1,i.component,t.id,r));else{var c=n.concat(s);a.push(i.filepoolProvider.downloadOrPrefetchFiles(e,c,o,!1,i.component,t.id))}return Promise.all(a)})},t.prototype.invalidateContent=function(e,t){var n=[],o=this.sitesProvider.getCurrentSite(),r=o.getId(),i={courseid:t,cmid:e,userid:o.getUserId()};n.push(this.filepoolProvider.invalidateFilesByComponent(r,this.component,e)),n.push(this.courseProvider.invalidateModule(e,r));for(var s in this.handlerSchema.offlinefunctions)o.wsAvailable(s)?n.push(o.invalidateWsCacheForKey(this.sitePluginsProvider.getCallWSCacheKey(s,i))):n.push(this.sitePluginsProvider.invalidateContent(this.component,s,i));return this.utils.allPromises(n)},t.prototype.isEnabled=function(){return!0},t.prototype.loadContents=function(e,t,n){return this.isResource?this.courseProvider.loadModuleContents(e,t,void 0,!1,n):Promise.resolve()},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(132),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o,r,i){var s=e.call(this,t)||this;return s.title=n,s.plugin=o,s.handlerSchema=r,s.initResult=i,s.priority=Math.min(r.priority,699),s}return r(t,e),t.prototype.getDisplayData=function(){return{title:this.title,icon:this.handlerSchema.displaydata.icon,class:this.handlerSchema.displaydata.class,page:"CoreSitePluginsPluginPage",pageParams:{title:this.title,component:this.plugin.component,method:this.handlerSchema.method,initResult:this.initResult}}},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(57),r=n(132),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,r,i,s,a){var c=e.call(this,t)||this;return c.title=n,c.plugin=r,c.handlerSchema=i,c.initResult=s,c.sitePluginsProvider=a,c.priority=i.priority,c.type=i.type!=o.a.TYPE_COMMUNICATION?o.a.TYPE_NEW_PAGE:o.a.TYPE_COMMUNICATION,c}return i(t,e),t.prototype.isEnabledForUser=function(e,t,n,o){return!!this.sitePluginsProvider.isHandlerEnabledForUser(e.id,this.handlerSchema.restricttocurrentuser,this.initResult.restrict)&&this.sitePluginsProvider.isHandlerEnabledForCourse(t,this.handlerSchema.restricttoenrolledcourses,this.initResult.restrict)},t.prototype.getDisplayData=function(e,t){var n=this;return{title:this.title,icon:this.handlerSchema.displaydata.icon,class:this.handlerSchema.displaydata.class,action:function(e,t,o,r){e.preventDefault(),e.stopPropagation(),t.push("CoreSitePluginsPluginPage",{title:n.title,component:n.plugin.component,method:n.handlerSchema.method,args:{courseid:r,userid:o.id},initResult:n.initResult})}}},t}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(132),r=n(343),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n){var o=e.call(this,t)||this;return o.type=n,o}return i(t,e),t.prototype.getComponent=function(e){return r.a},t.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;return{type:e.type||e.datatype,name:r,value:o[r]}},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(132),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o,r,i){var s=e.call(this,t)||this;return s.title=n,s.plugin=o,s.handlerSchema=r,s.initResult=i,s.priority=r.priority,s}return r(t,e),t.prototype.getDisplayData=function(){return{title:this.title,icon:this.handlerSchema.displaydata.icon,class:this.handlerSchema.displaydata.class,page:"CoreSitePluginsPluginPage",params:{title:this.title,component:this.plugin.component,method:this.handlerSchema.method,initResult:this.initResult}}},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(754),r=n(341),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n){var o=e.call(this)||this;return o.name=t,o.type=n,o}return i(t,e),t.prototype.getComponent=function(e){return r.a},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(756),r=n(342),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o,r){var i=e.call(this,t)||this;return i.name=n,i.type=o,i.hasTemplate=r,i}return i(t,e),t.prototype.handleQuestion=function(e,t){if(this.hasTemplate)return[r.a]},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return i});var o=n(132),r=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=function(e){function t(t,n,o,r,i,s){var a=e.call(this,t)||this;return a.processorName=n,a.title=o,a.plugin=r,a.handlerSchema=i,a.initResult=s,a}return r(t,e),t.prototype.getDisplayData=function(){return{priority:this.handlerSchema.priority,label:this.title,icon:this.handlerSchema.displaydata.icon,page:"CoreSitePluginsPluginPage",pageParams:{title:this.title,component:this.plugin.component,method:this.handlerSchema.method,initResult:this.initResult}}},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(344),r=function(){function e(e,t,n){this.name=e,this.ruleName=t,this.hasTemplate=n}return e.prototype.isPreflightCheckRequired=function(e,t,n,o){return this.hasTemplate},e.prototype.getFixedPreflightData=function(e,t,n,o,r){},e.prototype.getPreflightComponent=function(e){if(this.hasTemplate)return o.a},e.prototype.notifyPreflightCheckPassed=function(e,t,n,o,r){},e.prototype.notifyPreflightCheckFailed=function(e,t,n,o,r){},e.prototype.shouldShowTimeLeft=function(e,t,n){return!1},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(734),r=n(345),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o,r){var i=e.call(this,t)||this;return i.name=n,i.type=o,i.prefix=r,i}return i(t,e),t.prototype.getComponent=function(e,t,n){return r.a},t.prototype.getPluginName=function(e){var t=this.prefix+"pluginname",n=this.translate.instant(t);return t!=n?n:e.name?e.name:void 0},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(737),r=n(346),i=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),s=function(e){function t(t,n,o,r){var i=e.call(this,t)||this;return i.name=n,i.type=o,i.prefix=r,i}return i(t,e),t.prototype.getComponent=function(e,t,n){return r.a},t.prototype.getPluginName=function(e){var t=this.prefix+"pluginname",n=this.translate.instant(t);return t!=n?n:e.name?e.name:void 0},t.prototype.isEnabledForEdit=function(){return!0},t}(o.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(849),r=function(){function e(e,t){this.name=e,this.strategyName=t}return e.prototype.getComponent=function(e){return o.a},e.prototype.getOriginalValues=function(e,t){return Promise.resolve([])},e.prototype.hasDataChanged=function(e,t){return!1},e.prototype.isEnabled=function(){return!0},e.prototype.prepareAssessmentData=function(e,t){return Promise.resolve({})},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=n(329),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=function(){function e(){}return e=i([Object(o.I)({declarations:[],imports:[],providers:[r.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=n(139),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=function(){function e(){}return e=i([Object(o.I)({declarations:[],imports:[],providers:[r.a]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(889),i=n(1662),s=n(81),a=n(79),c=n(71),u=n(51),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a]}),l("design:paramtypes",[s.a,i.a,a.a,r.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(889),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.mandatoryProvider=e,this.name="AddonMandatory",this.priority=900}return e.prototype.isEnabled=function(){return!this.mandatoryProvider.isMandatoryDisabledInSite()},e.prototype.getDisplayData=function(){return{icon:"bookmarks",title:"addon.mandatory.mandatory",page:"AddonMandatoryMyMandatoryPage",class:"addon-mandatory-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(890),i=n(1664),s=n(81),a=n(79),c=n(71),u=n(51),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o,r,i){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a]}),l("design:paramtypes",[s.a,i.a,a.a,r.a,c.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(890),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.resourceProvider=e,this.name="AddonResource",this.priority=900}return e.prototype.isEnabled=function(){return!this.resourceProvider.isResourceDisabledInSite()},e.prototype.getDisplayData=function(){return{icon:"archive",title:"addon.resource.resource",page:"AddonResourceMyResourcePage",class:"addon-resource-handler"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(225),i=n(1666),s=n(1667),a=n(948),c=n(104),u=n(57),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t,n,o){e.registerHandler(t),n.registerHandler(o)}return e=d([Object(o.I)({declarations:[],imports:[a.a],providers:[r.a,i.a,s.a]}),l("design:paramtypes",[c.a,i.a,u.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(225),i=n(10),s=n(726),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e){this.courseCompletionProvider=e,this.name="AddonCourseCompletion",this.priority=200}return e.prototype.isEnabled=function(){return this.courseCompletionProvider.isPluginViewEnabled()},e.prototype.isEnabledForCourse=function(e,t,n,o){var r=this;return(!t||t.type!=i.a.ACCESS_GUEST)&&this.courseCompletionProvider.isPluginViewEnabledForCourse(e).then(function(t){return!!t&&r.courseCompletionProvider.isPluginViewEnabledForUser(e)})},e.prototype.getDisplayData=function(e,t){return{title:"addon.coursecompletion.completionmenuitem",class:"addon-coursecompletion-course-handler",component:s.a}},e.prototype.invalidateEnabledForCourse=function(e,t,n){return this.courseCompletionProvider.invalidateCourseCompletion(e)},e=a([Object(o.A)(),c("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(57),i=n(12),s=n(26),a=n(225),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){var n=this;this.courseCompletionProvider=t,this.name="AddonCourseCompletion",this.type=r.a.TYPE_NEW_PAGE,this.priority=200,this.enabledCache={},e.on(i.a.LOGOUT,function(){n.enabledCache={}}),e.on(s.a.PROFILE_REFRESHED,function(e){delete n.enabledCache[e.userId+"-"+e.courseId]})}return e.prototype.isEnabled=function(){return this.courseCompletionProvider.isPluginViewEnabled()},e.prototype.isEnabledForUser=function(e,t,n,o){var r=this;return!!t&&this.courseCompletionProvider.isPluginViewEnabledForCourse(t).then(function(n){if(!n)return!1;var o=e.id+"-"+t;return void 0!==r.enabledCache[o]?r.enabledCache[o]:r.courseCompletionProvider.isPluginViewEnabledForUser(t,e.id).then(function(e){return r.enabledCache[o]=e,e})})},e.prototype.getDisplayData=function(e,t){return{icon:"checkbox-outline",title:"addon.coursecompletion.coursecompletion",class:"addon-coursecompletion-handler",action:function(e,t,n,o){e.preventDefault(),e.stopPropagation(),t.push("AddonCourseCompletionReportPage",{courseId:o,userId:n.id})}}},e=c([Object(o.A)(),u("design:paramtypes",[i.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(1669),i=n(1671),s=n(1673),a=n(1675),c=n(1677),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=function(){function e(){}return e=u([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a,a.a,c.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(1670),a=n(119),c=n(891),u=n(16),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[c.a],imports:[r.k,i.b.forChild(),u.a],providers:[s.a],exports:[c.a],entryComponents:[c.a]}),l("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(891),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonUserProfileFieldCheckbox",this.type="checkbox"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;if(void 0!==o[r])return{type:"checkbox",name:r,value:o[r]?1:0}},e.prototype.getComponent=function(e){return r.a},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(1672),a=n(119),c=n(892),u=n(16),d=n(66),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[c.a],imports:[r.k,i.b.forChild(),u.a,d.a],providers:[s.a],exports:[c.a],entryComponents:[c.a]}),f("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(892),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonUserProfileFieldDatetime",this.type="datetime"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;if(o[r]){var i=new Date(o[r]).getTime();return{type:"datetime",name:"profile_field_"+e.shortname,value:Math.round(i/1e3)}}},e.prototype.getComponent=function(e){return r.a},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(1674),a=n(119),c=n(893),u=n(16),d=n(15),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[c.a],imports:[r.k,i.b.forChild(),u.a,d.a],providers:[s.a],exports:[c.a],entryComponents:[c.a]}),f("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(893),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonUserProfileFieldMenu",this.type="menu"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;if(o[r])return{type:"menu",name:r,value:o[r]}},e.prototype.getComponent=function(e){return r.a},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(1676),a=n(119),c=n(894),u=n(16),d=n(15),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[c.a],imports:[r.k,i.b.forChild(),u.a,d.a],providers:[s.a],exports:[c.a],entryComponents:[c.a]}),f("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(894),i=n(11),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.textUtils=e,this.name="AddonUserProfileFieldText",this.type="text"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;return{type:"text",name:r,value:this.textUtils.cleanTags(o[r])}},e.prototype.getComponent=function(e){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(1678),a=n(119),c=n(895),u=n(16),d=n(15),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[c.a],imports:[r.k,i.b.forChild(),u.a,d.a],providers:[s.a],exports:[c.a],entryComponents:[c.a]}),f("design:paramtypes",[a.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(895),i=n(11),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.textUtils=e,this.name="AddonUserProfileFieldTextarea",this.type="textarea"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n,o){var r="profile_field_"+e.shortname;if(o[r]){var i=o[r]||"";return i=this.textUtils.formatHtmlLines(i),{type:"textarea",name:r,value:JSON.stringify({text:i,format:1})}}},e.prototype.getComponent=function(e){return r.a},e=s([Object(o.A)(),a("design:paramtypes",[i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return C});var o=n(0),r=n(61),i=n(33),s=n(35),a=n(36),c=n(390),u=n(1680),d=n(59),l=n(1681),f=n(1682),p=n(1683),h=n(1684),m=n(1685),g=n(198),y=n(1686),v=n(262),b=n(1687),_=n(150),P=n(62),O=n(848),w=n(1688),S=n(51),R=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},E=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},C=function(){function e(e,t,n,o,r,i,s,a,c,u,d,l,f){e.registerHandler(t),n.registerHandler(o),r.registerHandler(i),r.registerHandler(u),r.registerHandler(d),r.registerHandler(l),r.registerHandler(f),s.register(a),c.registerSiteTableMigration({name:"mma_mod_data_entry",newName:_.a.DATA_ENTRY_TABLE,fields:[{name:"fields",type:"object"},{name:"dataAndEntry",delete:!0}]})}return e=R([Object(o.I)({declarations:[],imports:[c.a,w.a],providers:[d.a,g.a,v.a,_.a,P.a,u.a,y.a,l.a,f.a,p.a,h.a,m.a,b.a,O.a]}),E("design:paramtypes",[s.a,u.a,a.a,y.a,i.a,l.a,r.a,b.a,S.a,f.a,p.a,h.a,m.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(424),i=n(10),s=n(59),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.courseProvider=e,this.dataProvider=t,this.name="AddonModData",this.modName="data"}return e.prototype.isEnabled=function(){return this.dataProvider.isPluginEnabled()},e.prototype.getData=function(e,t,n){return{icon:this.courseProvider.getModuleIconSrc("data"),title:e.name,class:"addon-mod_data-handler",showDownloadButton:!0,action:function(e,t,n,o,r){t.push("AddonModDataIndexPage",{module:n,courseId:o},r)}}},e.prototype.getMainComponent=function(e,t){return r.a},e=a([Object(o.A)(),c("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModData","data")||this;return n.name="AddonModDataLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(59),s=n(10),a=n(8),c=n(12),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.dataProvider=t,i.courseProvider=n,i.domUtils=o,i.eventsProvider=r,i.name="AddonModDataApproveLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModData",i.pattern=/\/mod\/data\/view\.php.*([\?\&](d|approve|disapprove)=\d+)/,i}return u(t,e),t.prototype.getActivityCourseIdIfNotSet=function(e,t,n){return n?Promise.resolve(n):this.courseProvider.getModuleBasicInfoByInstance(e,"data",t).then(function(e){return e.course})},t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var s=r.domUtils.showModalLoading(),a=parseInt(n.d,10),c=parseInt(n.approve,10)||parseInt(n.disapprove,10),u=!!parseInt(n.approve,10);r.getActivityCourseIdIfNotSet(a,e,o).then(function(t){return o=t,r.dataProvider.approveEntry(a,c,u,o,e).catch(function(e){return r.domUtils.showErrorModalDefault(e,"addon.mod_data.errorapproving",!0),Promise.reject(null)})}).then(function(){var t=[];return t.push(r.dataProvider.invalidateEntryData(a,c,e)),t.push(r.dataProvider.invalidateEntriesData(a,e)),Promise.all(t)}).then(function(){r.eventsProvider.trigger(i.a.ENTRY_CHANGED,{dataId:a,entryId:c},e),r.domUtils.showToast(u?"addon.mod_data.recordapproved":"addon.mod_data.recorddisapproved",!0,3e3)}).finally(function(){s.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.d&&(void 0!==n.approve||void 0!==n.disapprove)&&this.dataProvider.isPluginEnabled(e)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(59),s=n(10),a=n(8),c=n(12),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.dataProvider=t,i.courseProvider=n,i.domUtils=o,i.eventsProvider=r,i.name="AddonModDataDeleteLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModData",i.pattern=/\/mod\/data\/view\.php.*([\?\&](d|delete)=\d+)/,i}return u(t,e),t.prototype.getActivityCourseIdIfNotSet=function(e,t,n){return n?Promise.resolve(n):this.courseProvider.getModuleBasicInfoByInstance(e,"data",t).then(function(e){return e.course})},t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var s=r.domUtils.showModalLoading(),a=parseInt(n.d,10),c=parseInt(n.delete,10);r.getActivityCourseIdIfNotSet(a,e,o).then(function(t){return o=t,r.dataProvider.deleteEntry(a,c,o,e).catch(function(e){return r.domUtils.showErrorModalDefault(e,"addon.mod_data.errordeleting",!0),Promise.reject(null)})}).then(function(){var t=[];return t.push(r.dataProvider.invalidateEntryData(a,c,e)),t.push(r.dataProvider.invalidateEntriesData(a,e)),Promise.all(t)}).then(function(){r.eventsProvider.trigger(i.a.ENTRY_CHANGED,{dataId:a,entryId:c,deleted:!0},e),r.domUtils.showToast("addon.mod_data.recorddeleted",!0,3e3)}).finally(function(){s.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.d&&void 0!==n.delete&&this.dataProvider.isPluginEnabled(e)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(59),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.dataProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModDataShowLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModData",i.pattern=/\/mod\/data\/view\.php.*([\?\&](d|rid|page|group|mode)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading(),i=parseInt(n.d,10),s=parseInt(n.rid,10)||!1,a=parseInt(n.group,10)||!1,c=parseInt(n.page,10)||!1;r.courseProvider.getModuleBasicInfoByInstance(i,"data",e).then(function(o){var i={module:o,courseId:o.course};return a&&(i.group=a),n.mode&&"single"==n.mode?i.page=c||1:s&&(i.entryId=s),r.linkHelper.goInSite(t,"AddonModDataEntryPage",i,e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.d&&(!!(n.mode&&"single"==n.mode||void 0!==n.rid)&&this.dataProvider.isPluginEnabled(e))},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(31),i=n(32),s=n(59),a=n(10),c=n(8),u=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(e){function t(t,n,o,r){var i=e.call(this)||this;return i.linkHelper=t,i.dataProvider=n,i.courseProvider=o,i.domUtils=r,i.name="AddonModDataEditLinkHandler",i.featureName="CoreCourseModuleDelegate_AddonModData",i.pattern=/\/mod\/data\/edit\.php.*([\?\&](d|rid)=\d+)/,i}return u(t,e),t.prototype.getActions=function(e,t,n,o){var r=this;return[{action:function(e,t){var o=r.domUtils.showModalLoading(),i=parseInt(n.d,10),s=parseInt(n.rid,10)||!1;r.courseProvider.getModuleBasicInfoByInstance(i,"data",e).then(function(n){var o={module:n,courseId:n.course};return s&&(o.entryId=s),r.linkHelper.goInSite(t,"AddonModDataEditPage",o,e)}).finally(function(){o.dismiss()})}}]},t.prototype.isEnabled=function(e,t,n,o){return void 0!==n.d&&this.dataProvider.isPluginEnabled(e)},t=d([Object(o.A)(),l("design:paramtypes",[i.a,s.a,a.a,c.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return _});var o=n(0),r=n(1),i=n(9),s=n(18),a=n(2),c=n(8),u=n(6),d=n(46),l=n(22),f=n(139),p=n(10),h=n(76),m=n(59),g=n(198),y=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),v=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},b=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=function(e){function t(t,n,o,r,i,s,a,c,u,d,l,f){var p=e.call(this,t,n,o,r,i,s,a)||this;return p.dataProvider=c,p.timeUtils=u,p.dataHelper=d,p.groupsProvider=l,p.commentsProvider=f,p.name="AddonModData",p.modName="data",p.component=m.a.COMPONENT,p.updatesNames=/^configuration$|^.*files$|^entries$|^gradeitems$|^outcomes$|^comments$|^ratings/,p}return y(t,e),t.prototype.getAllUniqueEntries=function(e,t,n,o,r){var i=this;void 0===n&&(n=!1),void 0===o&&(o=!1);var s=t.map(function(t){return i.dataProvider.fetchAllEntries(e,t.id,void 0,void 0,void 0,n,o,r)});return Promise.all(s).then(function(e){var t={};return e.forEach(function(e){e.forEach(function(e){t[e.id]=e})}),i.utils.objectToArray(t)})},t.prototype.getDatabaseInfoHelper=function(e,t,n,o,r,i){var s=this;void 0===n&&(n=!1),void 0===o&&(o=!1),void 0===r&&(r=!1);var a,c=[],u=[],d=[];return i=i||this.sitesProvider.getCurrentSiteId(),this.dataProvider.getDatabase(t,e.id,i,o).then(function(t){return d=s.getIntroFilesFromInstance(e,t),a=t,s.groupsProvider.getActivityGroupInfo(e.id,!1,void 0,i).then(function(e){return e.groups&&0!=e.groups.length||(e.groups=[{id:0}]),c=e.groups,s.getAllUniqueEntries(a.id,c,o,r,i)})}).then(function(e){return u=e,d=d.concat(s.getEntriesFiles(u)),{database:a,groups:c,entries:u,files:d}}).catch(function(e){return n?{database:a,groups:c,entries:u,files:d}:Promise.reject(e)})},t.prototype.getEntriesFiles=function(e){var t=[];return e.forEach(function(e){e.contents.forEach(function(e){t=t.concat(e.files)})}),t},t.prototype.getFiles=function(e,t,n){return this.getDatabaseInfoHelper(e,t,!0).then(function(e){return e.files})},t.prototype.getIntroFiles=function(e,t){var n=this;return this.dataProvider.getDatabase(t,e.id).catch(function(){}).then(function(t){return n.getIntroFilesFromInstance(e,t)})},t.prototype.invalidateContent=function(e,t){return this.dataProvider.invalidateContent(e,t)},t.prototype.invalidateModule=function(e,t){var n=[];return n.push(this.dataProvider.invalidateDatabaseData(t)),n.push(this.dataProvider.invalidateDatabaseAccessInformationData(e.instance)),Promise.all(n)},t.prototype.isDownloadable=function(e,t){var n=this;return this.dataProvider.getDatabase(t,e.id,void 0,!0).then(function(e){return n.dataProvider.getDatabaseAccessInformation(e.id).then(function(t){if(!t.timeavailable){var o=n.timeUtils.timestamp();if(e.timeavailablefrom&&o<e.timeavailablefrom)return!1;if(e.timeavailableto&&o>e.timeavailableto)return!1}return!0})})},t.prototype.isEnabled=function(){return this.dataProvider.isPluginEnabled()},t.prototype.prefetch=function(e,t,n,o){return this.prefetchPackage(e,t,n,this.prefetchDatabase.bind(this))},t.prototype.prefetchDatabase=function(e,t,n,o){var r=this;return this.getDatabaseInfoHelper(e,t,!1,!1,!0,o).then(function(t){var n=t.database,i=[];return i.push(r.dataProvider.getFields(n.id,!1,!0,o)),i.push(r.filepoolProvider.addFilesToQueue(o,t.files,r.component,e.id)),t.groups.forEach(function(e){i.push(r.dataProvider.getDatabaseAccessInformation(n.id,e.id,!1,!0,o))}),t.entries.forEach(function(e){i.push(r.dataProvider.getEntry(n.id,e.id,o)),n.comments&&i.push(r.commentsProvider.getComments("module",n.coursemodule,"mod_data",e.id,"database_entry",0,o))}),i.push(r.courseProvider.getModuleBasicInfoByInstance(n.id,"data",o)),Promise.all(i)})},t=v([Object(o.A)(),b("design:paramtypes",[r.c,i.a,u.a,p.a,s.a,a.a,c.a,m.a,l.a,g.a,d.a,f.a])],t)}(h.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(262),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.dataSync=e,this.name="AddonModDataSyncCronHandler"}return e.prototype.execute=function(e){return this.dataSync.syncAllDatabases(e)},e.prototype.getInterval=function(){return this.dataSync.syncInterval},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return y});var o=n(0),r=n(1689),i=n(1691),s=n(1693),a=n(1695),c=n(1697),u=n(1699),d=n(1701),l=n(1703),f=n(1705),p=n(1707),h=n(1708),m=n(1710),g=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},y=function(){function e(){}return e=g([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1690),c=n(62),u=n(896),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(896),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldCheckboxHandler",this.type="checkbox"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id,o="f_"+e.id+"_allreq",r=[];return!!(t[n]&&t[n].length>0)&&(r.push({name:n,value:t[n]}),t[o]&&r.push({name:o,value:!0}),r)},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;return!!(t[o]&&t[o].length>0)&&[{fieldid:e.id,value:t[o]}]},e.prototype.hasFieldDataChanged=function(e,t,n){return n=n&&n.content||"",t["f_"+e.id].join("##")!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[""]&&t[""].join("##")||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1692),c=n(62),u=n(897),d=n(16),l=n(15),f=n(66),p=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},h=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},m=function(){function e(e,t){e.registerHandler(t)}return e=p([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a,f.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),h("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(897),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldDateHandler",this.type="date"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id,o="f_"+e.id+"_z";if(t[o]&&"string"==typeof t[n]){var r=[],i=t[n].substr(0,10).split("-"),s=i[1],a=i[2];return r.push({name:n+"_y",value:i[0]}),r.push({name:n+"_m",value:s}),r.push({name:n+"_d",value:a}),r.push({name:o,value:1}),r}return!1},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;if("string"==typeof t[o]){var r=[],i=t[o].substr(0,10).split("-"),s=i[1],a=i[2];return r.push({fieldid:e.id,subfield:"year",value:i[0]}),r.push({fieldid:e.id,subfield:"month",value:s}),r.push({fieldid:e.id,subfield:"day",value:a}),r}return!1},e.prototype.hasFieldDataChanged=function(e,t,n){var o="f_"+e.id,r=t[o]&&t[o].substr(0,10)||"";return n=n&&n.content&&new Date(1e3*n.content).toISOString().substr(0,10)||"",r!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&!(t.length<2)&&t[0].value&&t[1].value&&t[2].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){var o=Date.UTC(t.year||"",t.month?t.month-1:null,t.day||null);return o=Math.floor(o/1e3),e.content=o||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1694),c=n(62),u=n(898),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(1),i=n(121),s=n(59),a=n(898),c=n(56),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n){this.translate=e,this.fileSessionprovider=t,this.fileUploaderProvider=n,this.name="AddonModDataFieldFileHandler",this.type="file"}return e.prototype.getComponent=function(e,t){return a.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o=this.getFieldEditFiles(e);return!!o.length&&[{fieldid:e.id,subfield:"file",files:o}]},e.prototype.getFieldEditFiles=function(e){return this.fileSessionprovider.getFiles(s.a.COMPONENT,e.dataid+"_"+e.id)},e.prototype.hasFieldDataChanged=function(e,t,n){var o=this.fileSessionprovider.getFiles(s.a.COMPONENT,e.dataid+"_"+e.id)||[],r=n&&n.files||[];return r.length&&(r=[r[0]]),this.fileUploaderProvider.areFileListDifferent(o,r)},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return t&&t.file&&t.file.offline>0&&n&&n.length>0?(e.content=n[0].filename,e.files=[n[0]]):t&&t.file&&t.file.online&&t.file.online.length>0&&(e.content=t.file.online[0].filename,e.files=[t.file.online[0]]),e},e.prototype.isEnabled=function(){return!0},e=u([Object(o.A)(),d("design:paramtypes",[r.c,i.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1696),c=n(62),u=n(899),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(899),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldLatlongHandler",this.type="latlong"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id,r=[];return t[o+"_0"]&&r.push({fieldid:e.id,subfield:"0",value:t[o+"_0"]}),t[o+"_1"]&&r.push({fieldid:e.id,subfield:"1",value:t[o+"_1"]}),r},e.prototype.hasFieldDataChanged=function(e,t,n){var o="f_"+e.id;return(t[o+"_0"]||"")!=(n&&n.content||"")||(t[o+"_1"]||"")!=(n&&n.content1||"")},e.prototype.getFieldsNotifications=function(e,t){var n=0;return t.forEach(function(e){void 0!==e.value&&""!=e.value&&n++}),1==n?this.translate.instant("addon.mod_data.latlongboth"):!(!e.required||0!=n)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[0]||"",e.content1=t[1]||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1698),c=n(62),u=n(900),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(900),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldMenuHandler",this.type="menu"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;return!!t[o]&&[{fieldid:e.id,value:t[o]}]},e.prototype.hasFieldDataChanged=function(e,t,n){return n=n&&n.content||"",(t["f_"+e.id]||"")!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[""]||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1700),c=n(62),u=n(901),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(901),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldMultimenuHandler",this.type="multimenu"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id,o="f_"+e.id+"_allreq";if(t[n]&&t[n].length>0){var r=[];return r.push({name:n,value:t[n]}),t[o]&&r.push({name:o,value:!0}),r}return!1},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;return!!(t[o]&&t[o].length>0)&&[{fieldid:e.id,value:t[o]}]},e.prototype.hasFieldDataChanged=function(e,t,n){return n=n&&n.content||"",t["f_"+e.id].join("##")!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[""]&&t[""].join("###")||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1702),c=n(62),u=n(903),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(1),i=n(246),s=n(903),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t){var n=e.call(this,t)||this;return n.translate=t,n.name="AddonModDataFieldNumberHandler",n.type="number",n}return a(t,e),t.prototype.getComponent=function(e,t){return s.a},t.prototype.hasFieldDataChanged=function(e,t,n){var o="f_"+e.id,r=void 0!==t[o]?parseFloat(t[o]):"";return n=n&&void 0!==n.content?parseFloat(n.content):"",r!=n},t.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&""!=t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},t=c([Object(o.A)(),u("design:paramtypes",[r.c])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1704),c=n(62),u=n(904),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(1),i=n(121),s=n(59),a=n(904),c=n(56),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(){function e(e,t,n){this.translate=e,this.fileSessionprovider=t,this.fileUploaderProvider=n,this.name="AddonModDataFieldPictureHandler",this.type="picture"}return e.prototype.getComponent=function(e,t){return a.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o=this.getFieldEditFiles(e),r=[],i="f_"+e.id+"_alttext";return o.length&&r.push({fieldid:e.id,subfield:"file",files:o}),t[i]&&r.push({fieldid:e.id,subfield:"alttext",value:t[i]}),r},e.prototype.getFieldEditFiles=function(e){return this.fileSessionprovider.getFiles(s.a.COMPONENT,e.dataid+"_"+e.id)},e.prototype.hasFieldDataChanged=function(e,t,n){var o=t["f_"+e.id+"_alttext"]||"",r=n&&n.content1||"",i=this.getFieldEditFiles(e)||[],s=n&&n.files||[];if(s.length>0){var a=n&&n.content||"",c=s.find(function(e){return e.filename==a});c&&(s=[c])}else s=[];return o!=r||this.fileUploaderProvider.areFileListDifferent(i,s)},e.prototype.getFieldsNotifications=function(e,t){if(e.required){if(!t||!t.length)return this.translate.instant("addon.mod_data.errormustsupplyvalue");if(!t.some(function(e){return void 0!==e.subfield&&"file"==e.subfield&&!!e.value}))return this.translate.instant("addon.mod_data.errormustsupplyvalue")}return!1},e.prototype.overrideData=function(e,t,n){return t&&t.file&&t.file.offline>0&&n&&n.length>0?(e.content=n[0].filename,e.files=[n[0]]):t&&t.file&&t.file.online&&t.file.online.length>0&&(e.content=t.file.online[0].filename,e.files=[t.file.online[0]]),e.content1=t.alttext||"",e},e.prototype.isEnabled=function(){return!0},e=u([Object(o.A)(),d("design:paramtypes",[r.c,i.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1706),c=n(62),u=n(905),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1),i=n(905),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.translate=e,this.name="AddonModDataFieldRadiobuttonHandler",this.type="radiobutton"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.getFieldSearchData=function(e,t){var n="f_"+e.id;return!!t[n]&&[{name:n,value:t[n]}]},e.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;return!!t[o]&&[{fieldid:e.id,value:t[o]}]},e.prototype.hasFieldDataChanged=function(e,t,n){return n=n&&n.content||"",(t["f_"+e.id]||"")!=n},e.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},e.prototype.overrideData=function(e,t,n){return e.content=t[""]||"",e},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.c])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(246),c=n(62),u=n(902),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1709),c=n(62),u=n(906),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return l});var o=n(0),r=n(1),i=n(246),s=n(906),a=n(11),c=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),u=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},d=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},l=function(e){function t(t,n){var o=e.call(this,t)||this;return o.translate=t,o.textUtils=n,o.name="AddonModDataFieldTextareaHandler",o.type="textarea",o}return c(t,e),t.prototype.getComponent=function(e,t){return s.a},t.prototype.getFieldEditData=function(e,t,n){var o="f_"+e.id;if(t[o]){var r=this.getFieldEditFiles(e,t,n),i=this.textUtils.restorePluginfileUrls(t[o],r);return i=this.textUtils.formatHtmlLines(i),[{fieldid:e.id,value:i},{fieldid:e.id,subfield:"content1",value:1},{fieldid:e.id,subfield:"itemid",files:r}]}return!1},t.prototype.getFieldEditFiles=function(e,t,n){return n&&n.files||[]},t.prototype.getFieldsNotifications=function(e,t){if(e.required){if(!t||!t.length)return this.translate.instant("addon.mod_data.errormustsupplyvalue");if(!t.some(function(e){return!e.subfield&&!!e.value}))return this.translate.instant("addon.mod_data.errormustsupplyvalue")}return!1},t.prototype.overrideData=function(e,t,n){return e.content=t[""]||"",e.content.length>0&&e.files&&e.files.length>0&&(e.content=this.textUtils.replacePluginfileUrls(e.content,e.files)),e},t=u([Object(o.A)(),d("design:paramtypes",[r.c,a.a])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return h});var o=n(0),r=n(17),i=n(4),s=n(1),a=n(1711),c=n(62),u=n(907),d=n(16),l=n(15),f=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},p=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},h=function(){function e(e,t){e.registerHandler(t)}return e=f([Object(o.I)({declarations:[u.a],imports:[r.b,i.k,s.b.forChild(),d.a,l.a],providers:[a.a],exports:[u.a],entryComponents:[u.a]}),p("design:paramtypes",[c.a,a.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(1),i=n(246),s=n(907),a=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(e){function t(t){var n=e.call(this,t)||this;return n.translate=t,n.name="AddonModDataFieldUrlHandler",n.type="url",n}return a(t,e),t.prototype.getComponent=function(e,t){return s.a},t.prototype.getFieldsNotifications=function(e,t){return!(!e.required||t&&t.length&&t[0].value)&&this.translate.instant("addon.mod_data.errormustsupplyvalue")},t=c([Object(o.A)(),u("design:paramtypes",[r.c])],t)}(i.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(1713),i=n(1714),s=n(35),a=n(33),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n,o){e.registerHandler(t),n.registerHandler(o)}return e=c([Object(o.I)({declarations:[],imports:[],providers:[r.a,i.a]}),u("design:paramtypes",[s.a,r.a,a.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return s});var o=n(0),r=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},i=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},s=function(){function e(){this.name="AddonModLabel",this.modName="label"}return e.prototype.isEnabled=function(){return!0},e.prototype.getData=function(e,t,n){var o=e.description;return e.description="",{icon:"",title:o,class:"addon-mod-label-handler"}},e.prototype.getMainComponent=function(e,t,n){},e=r([Object(o.A)(),i("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(44),i=n(21),s=this&&this.__extends||function(){var e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])};return function(t,n){function o(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(e){function t(t){var n=e.call(this,t,"AddonModLabel","label")||this;return n.name="AddonModLabelLinkHandler",n}return s(t,e),t=a([Object(o.A)(),c("design:paramtypes",[i.a])],t)}(r.a)},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(257),i=n(398),s=n(1716),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){e.registerHandler(t)}return e=a([Object(o.I)({declarations:[],imports:[],providers:[i.a,s.a]}),c("design:paramtypes",[r.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(398),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.airnotifierProvider=e,this.name="AddonMessageOutputAirnotifier",this.processorName="airnotifier"}return e.prototype.isEnabled=function(){return this.airnotifierProvider.isEnabled()},e.prototype.getDisplayData=function(e){return{priority:600,label:"addon.messageoutput_airnotifier.processorsettingsdesc",icon:"settings",page:"AddonMessageOutputAirnotifierDevicesPage"}},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return m});var o=n(0),r=n(1718),i=n(1720),s=n(1722),a=n(1724),c=n(1725),u=n(1727),d=n(1729),l=n(1731),f=n(1733),p=n(1735),h=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},m=function(){function e(){}return e=h([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a,p.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1719),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(73),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourAdaptive",this.type="adaptive"}return e.prototype.handleQuestion=function(e,t){this.questionHelper.extractQbehaviourButtons(t)},e.prototype.isEnabled=function(){return!0},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1721),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(73),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourAdaptiveNoPenalty",this.type="adaptivenopenalty"}return e.prototype.handleQuestion=function(e,t){this.questionHelper.extractQbehaviourButtons(t)},e.prototype.isEnabled=function(){return!0},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(70),a=n(15),c=n(1723),u=n(383),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(38),i=n(73),s=n(908),a=n(383),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.questionDelegate=e,this.questionHelper=t,this.deferredFeedbackHandler=n,this.name="AddonQbehaviourDeferredCBM",this.type="deferredcbm"}return e.prototype.determineNewState=function(e,t,n,o){return this.deferredFeedbackHandler.determineNewStateDeferred(e,t,n,o,this.isCompleteResponse.bind(this),this.isSameResponse.bind(this))},e.prototype.handleQuestion=function(e,t){if(this.questionHelper.extractQbehaviourCBM(t))return[a.a]},e.prototype.isCompleteResponse=function(e,t){var n=this.questionDelegate.isCompleteResponse(e,t);return n>0?t["-certainty"]?1:0:n},e.prototype.isEnabled=function(){return!0},e.prototype.isSameResponse=function(e,t,n,o,r){var i=this.questionDelegate.isSameResponse(e,n,r);return i?t["-certainty"]==o["-certainty"]:i},e=c([Object(o.A)(),u("design:paramtypes",[r.a,i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(908),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1726),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(73),i=n(383),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourImmediateCBM",this.type="immediatecbm"}return e.prototype.handleQuestion=function(e,t){if(this.questionHelper.extractQbehaviourButtons(t),this.questionHelper.extractQbehaviourCBM(t))return[i.a]},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1728),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(73),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourImmediateFeedback",this.type="immediatefeedback"}return e.prototype.handleQuestion=function(e,t){this.questionHelper.extractQbehaviourButtons(t)},e.prototype.isEnabled=function(){return!0},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(4),i=n(70),s=n(1730),a=n(909),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t){e.registerHandler(t)}return e=c([Object(o.I)({declarations:[a.a],imports:[r.k],providers:[s.a],exports:[a.a],entryComponents:[a.a]}),u("design:paramtypes",[i.a,s.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(65),i=n(73),s=n(909),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.questionHelper=e,this.questionProvider=t,this.name="AddonQbehaviourInformationItem",this.type="informationitem"}return e.prototype.determineNewState=function(e,t,n,o){return this.questionProvider.getState(n.answers["-seen"]?"complete":n.state||"todo")},e.prototype.handleQuestion=function(e,t){if(this.questionHelper.extractQbehaviourSeenInput(t))return[s.a]},e.prototype.isEnabled=function(){return!0},e=a([Object(o.A)(),c("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1732),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(73),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourInteractive",this.type="interactive"}return e.prototype.handleQuestion=function(e,t){this.questionHelper.extractQbehaviourButtons(t)},e.prototype.isEnabled=function(){return!0},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1734),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(73),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(e){this.questionHelper=e,this.name="AddonQbehaviourInteractiveCountback",this.type="interactivecountback"}return e.prototype.handleQuestion=function(e,t){this.questionHelper.extractQbehaviourButtons(t)},e.prototype.isEnabled=function(){return!0},e=i([Object(o.A)(),s("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(1736),i=n(70),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[r.a]}),a("design:paramtypes",[i.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(65),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){this.questionDelegate=e,this.questionProvider=t,this.name="AddonQbehaviourManualGraded",this.type="manualgraded"}return e.prototype.determineNewState=function(e,t,n,o){return this.determineNewStateManualGraded(e,t,n,o)},e.prototype.determineNewStateManualGraded=function(e,t,n,o,r,i){var s=this;return this.questionProvider.getQuestion(e,t,n.slot,o).catch(function(){return n}).then(function(a){var c=s.questionProvider.getState(a.state);return c.finished||!c.active?c:s.questionProvider.getQuestionAnswers(e,t,n.slot,!1,o).then(function(e){var t=s.questionProvider.getBasicAnswers(n.answers);e=s.questionProvider.convertAnswersArrayToObject(e,!0);var o=s.questionProvider.getBasicAnswers(e);if(i){if(i(n,e,o,n.answers,t))return c}else if(s.questionDelegate.isSameResponse(n,o,t))return c;var a,u;return a=r?r(n,n.answers):s.questionDelegate.isCompleteResponse(n,t),u=a<0?"unknown":a>0?"complete":"todo",s.questionProvider.getState(u)})})},e.prototype.isEnabled=function(){return!0},e=s([Object(o.A)(),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return P});var o=n(0),r=n(1738),i=n(1739),s=n(1741),a=n(1743),c=n(1746),u=n(1750),d=n(1753),l=n(1755),f=n(1757),p=n(1759),h=n(1760),m=n(1762),g=n(1763),y=n(1764),v=n(1766),b=n(1768),_=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},P=function(){function e(){}return e=_([Object(o.I)({declarations:[],imports:[r.a,i.a,s.a,a.a,c.a,u.a,d.a,l.a,f.a,p.a,h.a,m.a,g.a,y.a,v.a,b.a],providers:[],exports:[]})],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(910),u=n(385),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(1740),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[i.a]}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(912),i=n(247),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.multichoiceHandler=e,this.name="AddonQtypeCalculatedMulti",this.type="qtype_calculatedmulti"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return this.multichoiceHandler.isCompleteResponseSingle(t)},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.multichoiceHandler.isGradableResponseSingle(t)},e.prototype.isSameResponse=function(e,t,n){return this.multichoiceHandler.isSameResponseSingle(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(1742),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[i.a]}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(910),i=n(385),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.calculatedHandler=e,this.name="AddonQtypeCalculatedSimple",this.type="qtype_calculatedsimple"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return this.calculatedHandler.isCompleteResponse(e,t)},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.calculatedHandler.isGradableResponse(e,t)},e.prototype.isSameResponse=function(e,t,n){return this.calculatedHandler.isSameResponse(e,t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(16),c=n(15),u=n(1744),d=n(913),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[d.a],imports:[r.k,i.b.forChild(),a.a,c.a],providers:[u.a],exports:[d.a],entryComponents:[d.a]}),f("design:paramtypes",[s.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(65),i=n(913),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionProvider=e,this.name="AddonQtypeDdImageOrText",this.type="qtype_ddimageortext"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){for(var n in t){var o=t[n];if(!o||"0"===o)return 0}return 1},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){for(var n in t){var o=t[n];if(o&&"0"!==o)return 1}return 0},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e,t,n,o,r,i){this.domUtils=t,this.container=n,this.question=o,this.readOnly=r,this.drops=i,this.toLoad=0,this.afterImageLoadDone=!1,this.proportion=1,this.logger=e.getInstance("AddonQtypeDdImageOrTextQuestion"),this.initializer(o)}return e.prototype.calculateImgProportion=function(){var e=this.doc.bgImg();this.proportion=1,e.width!=e.naturalWidth&&(this.proportion=e.width/e.naturalWidth)},e.prototype.convertToWindowXY=function(e){var t=this.doc.bgImg(),n=this.domUtils.getElementXY(t,null,"ddarea");return e[0]*=this.proportion,e[1]*=this.proportion,[Number(e[0])+n[0]+1,Number(e[1])+n[1]+1]},e.prototype.createAllDragAndDrops=function(){this.initDrops();this.doc.dragItemsArea().classList.add("clearfix"),this.makeDragAreaClickable();for(var e=this.doc.dragItemHomes(),t=0,n=0;n<e.length;n++){var o=e[n],r=this.doc.getClassnameNumericSuffix(o,"dragitemhomes"),i=this.doc.getClassnameNumericSuffix(o,"choice"),s=this.doc.getClassnameNumericSuffix(o,"group");if("IMG"==o.tagName){var a=document.createElement("div");a.className=o.className,o.className="",o.parentNode.insertBefore(a,o),a.appendChild(o)}var c=this.doc.cloneNewDragItem(t,r);if(t++,this.readOnly||this.draggableForQuestion(c,s,i),c.classList.contains("infinite"))for(var u=this.doc.dropZoneGroup(s).length-1;u>0;){var d=this.doc.cloneNewDragItem(t,r);t++,this.readOnly||this.draggableForQuestion(d,s,i),u--}}if(this.repositionDragsForQuestion(),!this.readOnly){this.doc.dropZones().forEach(function(e){e.setAttribute("tabIndex","0")})}},e.prototype.deselectDrags=function(){this.doc.dragItems().forEach(function(e){e.classList.remove("beingdragged")}),this.selected=null},e.prototype.destroy=function(){this.stopPolling(),this.resizeFunction&&window.removeEventListener("resize",this.resizeFunction)},e.prototype.docStructure=function(e){var t=this,n=this.container.querySelector(".addon-qtype-ddimageortext-container"),o=n.querySelector("div.dragitems"),r={};return r.topNode=function(){return n},r.dragItemsArea=function(){return o},r.dragItems=function(){return Array.from(o.querySelectorAll(".drag"))},r.dropZones=function(){return Array.from(n.querySelectorAll("div.dropzones div.dropzone"))},r.dropZoneGroup=function(e){return Array.from(n.querySelectorAll("div.dropzones div.group"+e))},r.dragItemsClonedFrom=function(e){return Array.from(o.querySelectorAll(".dragitems"+e))},r.dragItem=function(e){return o.querySelector(".draginstance"+e)},r.dragItemsInGroup=function(e){return Array.from(o.querySelectorAll(".drag.group"+e))},r.dragItemHomes=function(){return Array.from(o.querySelectorAll(".draghome"))},r.bgImg=function(){return n.querySelector(".dropbackground")},r.dragItemHome=function(e){return o.querySelector(".dragitemhomes"+e)},r.getClassnameNumericSuffix=function(e,n){if(e.classList&&e.classList.length)for(var o=new RegExp("^"+n+"([0-9])+$"),r=new RegExp("([0-9])+$"),i=0;i<e.classList.length;i++)if(o.test(e.classList[i])){var s=r.exec(e.classList[i]);return Number(s[0])}t.logger.warn('Prefix "'+n+'" not found in class names.')},r.cloneNewDragItem=function(e,t){var n=r.dragItemHome(t);if(null===n)return null;var o,i=n.querySelector("img");if(i){var s=i.cloneNode(!0);(o=document.createElement("div")).appendChild(s),o.className=n.className,s.className=""}else o=n.cloneNode(!0);return o.classList.remove("dragitemhomes"+t),o.classList.remove("draghome"),o.classList.add("dragitems"+t),o.classList.add("draginstance"+e),o.classList.add("drag"),o.style.visibility="inherit",o.style.position="absolute",o.setAttribute("draginstanceno",String(e)),o.setAttribute("dragitemno",String(t)),n.parentElement.insertBefore(o,n.nextSibling),o},r},e.prototype.draggableForQuestion=function(e,t,n){var o=this;e.setAttribute("group",String(t)),e.setAttribute("choice",String(n)),e.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.classList.contains("beingdragged")?o.deselectDrags():o.selectDrag(e)})},e.prototype.dropClick=function(e){var t=this.selected;t&&(this.deselectDrags(),Number(e.getAttribute("group"))===Number(t.getAttribute("group"))&&this.placeDragInDrop(t,e))},e.prototype.getChoicesForDrop=function(e,t){return Array.from(this.doc.topNode().querySelectorAll("div.dragitemgroup"+t.getAttribute("group")+" .choice"+e+".drag"))},e.prototype.getUnplacedChoiceForDrop=function(e,t){for(var n=this.getChoicesForDrop(e,t),o=0;o<n.length;o++){var r=n[o];if(this.readOnly||!r.classList.contains("placed")&&!r.classList.contains("beingdragged"))return r}return null},e.prototype.initDrops=function(){for(var e=this,t=this.doc.topNode().querySelector("div.dropzones"),n={},o=1;o<=8;o++){var r=document.createElement("div");r.className="dropzonegroup"+o,t.appendChild(r),n[o]=r}var i=function(t){var o=s.drops[t],r="dropzone group"+o.group+" place"+t,i=o.text.replace('"','"'),a=document.createElement("div");a.setAttribute("title",i),a.className=r,n[o.group].appendChild(a),a.style.opacity="0.5",a.setAttribute("xy",o.xy),a.setAttribute("aria-label",o.text),a.setAttribute("place",t),a.setAttribute("inputid",o.fieldname.replace(":","_")),a.setAttribute("group",o.group),a.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),e.dropClick(a)})},s=this;for(var a in this.drops)i(a)},e.prototype.initializer=function(e){var t=this;if(this.doc=this.docStructure(e.slot),this.readOnly){this.doc.topNode().classList.add("readonly")}setTimeout(function(){var e=t.doc.bgImg();e.complete&&e.naturalWidth||(t.toLoad++,e.addEventListener("load",function(){t.toLoad--}));t.doc.dragItemHomes().forEach(function(e){if("IMG"==e.tagName){var n=e;n.complete&&n.naturalWidth||(t.toLoad++,n.addEventListener("load",function(){t.toLoad--}))}}),t.pollForImageLoad()}),this.resizeFunction=this.repositionDragsForQuestion.bind(this),window.addEventListener("resize",this.resizeFunction)},e.prototype.makeDragAreaClickable=function(){var e=this;if(!this.readOnly){this.doc.dragItemsArea().addEventListener("click",function(t){var n=e.selected;if(!n)return!1;e.deselectDrags(),e.removeDragFromDrop(n),t.preventDefault(),t.stopPropagation()})}},e.prototype.placeDragInDrop=function(e,t){var n=t.getAttribute("inputid"),o=this.doc.topNode().querySelector("input#"+n),r=e.getAttribute("inputid");if(r&&r!=n){this.doc.topNode().querySelector("input#"+r).setAttribute("value","")}var i=this.domUtils.getElementXY(t,null,"ddarea");e.style.left=i[0]-1+"px",e.style.top=i[1]-1+"px",e.classList.add("placed"),o.setAttribute("value",e.getAttribute("choice")),e.setAttribute("inputid",n)},e.prototype.pollForImageLoad=function(){var e=this;this.afterImageLoadDone||(this.toLoad<=0&&(this.createAllDragAndDrops(),this.afterImageLoadDone=!0,this.question.loaded=!0),setTimeout(function(){e.pollForImageLoad()},1e3))},e.prototype.removeDragFromDrop=function(e){var t=e.getAttribute("inputid");if(t){this.doc.topNode().querySelector("input#"+t).setAttribute("value","")}var n=this.doc.dragItemHome(Number(e.getAttribute("dragitemno"))),o=this.domUtils.getElementXY(n,null,"ddarea");e.style.left=o[0]+"px",e.style.top=o[1]+"px",e.classList.remove("placed"),e.setAttribute("inputid","")},e.prototype.repositionDragsForQuestion=function(){var e=this.doc.dragItems();e.forEach(function(e){e.classList.remove("placed"),e.setAttribute("inputid","")}),this.calculateImgProportion();for(var t=this.doc.dragItemHomes(),n=function(e){var n=t[e],r=n.querySelector("img");if(r&&r.naturalWidth>0){var i=[Math.round(r.naturalWidth*o.proportion),Math.round(r.naturalHeight*o.proportion)];r.style.width=i[0]+"px",r.style.height=i[1]+"px";var s=o.doc.getClassnameNumericSuffix(n,"dragitemhomes"),a=o.doc.getClassnameNumericSuffix(n,"group");Array.from(o.doc.topNode().querySelectorAll(".drag.group"+a+".dragitems"+s+"  img")).forEach(function(e){e.style.width=i[0]+"px",e.style.height=i[1]+"px"})}},o=this,r=0;r<t.length;r++)n(r);this.updatePaddingSizesAll();var i=this.doc.dropZones();for(r=0;r<i.length;r++){var s=i[r],a=s.getAttribute("xy").split(",").map(function(e){return Number(e)}),c=this.convertToWindowXY(a);s.style.left=c[0]+"px",s.style.top=c[1]+"px";var u="input#"+s.getAttribute("inputid"),d=this.doc.topNode().querySelector(u),l=Number(d.value);if(l>0){null!==(f=this.getUnplacedChoiceForDrop(l,s))&&this.placeDragInDrop(f,s)}}for(r=0;r<e.length;r++){var f;(f=e[r]).classList.contains("placed")||f.classList.contains("beingdragged")||this.removeDragFromDrop(f)}},e.prototype.selectDrag=function(e){this.deselectDrags(),this.selected=e,e.classList.add("beingdragged")},e.prototype.stopPolling=function(){this.afterImageLoadDone=!0},e.prototype.updatePaddingSizeForGroup=function(e){var t=Array.from(this.doc.topNode().querySelectorAll(".draghome.group"+e));if(0!==t.length){for(var n=0,o=0,r=0;r<t.length;r++){var i=t[r],s=i.querySelector("img");if(s)n=Math.max(n,Math.round(this.proportion*s.naturalWidth)),o=Math.max(o,Math.round(this.proportion*s.naturalHeight));else{var a=i.style.padding;i.style.padding="",n=Math.max(n,Math.round(i.clientWidth)),o=Math.max(o,Math.round(i.clientHeight)),i.style.padding=a}}if(n<=0||o<=0)return;n=Math.round(n+8*this.proportion),o=Math.round(o+8*this.proportion);var c=function(r){var i=t[r],s=i.querySelector("img"),a=void 0,c=void 0;if(s)a=Math.round(s.naturalWidth*u.proportion),c=Math.round(s.naturalHeight*u.proportion);else{var d=i.style.padding;i.style.padding="",a=Math.round(i.clientWidth),c=Math.round(i.clientHeight),i.style.padding=d}var l=Math.round((o-c)/2),f=Math.round((n-a)/2),p=n-(a+2*f),h=o-(c+2*l);i.style.padding=l+"px "+f+"px "+(l+h)+"px "+(f+p)+"px";var m=u.doc.getClassnameNumericSuffix(i,"dragitemhomes");Array.from(u.doc.topNode().querySelectorAll(".drag.group"+e+".dragitems"+m)).forEach(function(e){e.style.padding=l+"px "+f+"px "+(l+h)+"px "+(f+p)+"px"})},u=this;for(r=0;r<t.length;r++)c(r);this.doc.dropZoneGroup(e).forEach(function(e){e.style.width=n+2+"px ",e.style.height=o+2+"px "})}},e.prototype.updatePaddingSizesAll=function(){for(var e=1;e<=8;e++)this.updatePaddingSizeForGroup(e)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(16),c=n(15),u=n(1747),d=n(914),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[d.a],imports:[r.k,i.b.forChild(),a.a,c.a],providers:[u.a],exports:[d.a],entryComponents:[d.a]}),f("design:paramtypes",[s.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(65),i=n(914),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionProvider=e,this.name="AddonQtypeDdMarker",this.type="qtype_ddmarker"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){for(var n in t)if(t[n])return 1;return 0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.isCompleteResponse(e,t)},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return r});var o=n(1749),r=function(){function e(e,t,n,r,i,s,a){this.domUtils=t,this.textUtils=n,this.container=r,this.question=i,this.readOnly=s,this.dropZones=a,this.COLOURS=["#FFFFFF","#B0C4DE","#DCDCDC","#D8BFD8","#87CEFA","#DAA520","#FFD700","#F0E68C"],this.afterImageLoadDone=!1,this.nextColourIndex=0,this.proportion=1,this.shapes=[],this.logger=e.getInstance("AddonQtypeDdMarkerQuestion"),this.graphics=new o.a(this,this.domUtils),this.initializer(i)}return e.prototype.calculateImgProportion=function(){var e=this.doc.bgImg();this.proportion=1,e.width!=e.naturalWidth&&(this.proportion=e.width/e.naturalWidth)},e.prototype.cloneNewDragItem=function(e,t){e.querySelector("span.markertext").style.opacity="0.6";var n=e.cloneNode(!0);return n.classList.remove("draghome"),n.classList.add("dragitem"),n.classList.add("item"+t),e.parentElement.insertBefore(n,e.nextSibling),this.readOnly||this.draggable(n),n},e.prototype.convertToWindowXY=function(e){var t=this.doc.bgImg(),n=this.domUtils.getElementXY(t,null,"ddarea");return e[0]*=this.proportion,e[1]*=this.proportion,[Number(e[0])+n[0],Number(e[1])+n[1]]},e.prototype.coordsInImg=function(e){var t=this.doc.bgImg();return e[0]*this.proportion<=t.width&&e[1]*this.proportion<=t.height},e.prototype.deselectDrags=function(){this.doc.dragItems().forEach(function(e){e.classList.remove("beingdragged")}),this.selected=null},e.prototype.destroy=function(){this.resizeFunction&&window.removeEventListener("resize",this.resizeFunction)},e.prototype.docStructure=function(e){var t=this,n=this.container.querySelector(".addon-qtype-ddmarker-container"),o=n.querySelector("div.dragitems");return{topNode:function(){return n},bgImg:function(){return n.querySelector(".dropbackground")},dragItemsArea:function(){return o},dragItems:function(){return Array.from(o.querySelectorAll(".dragitem"))},dragItemsForChoice:function(e){return Array.from(o.querySelectorAll("span.dragitem.choice"+e))},dragItemForChoice:function(e,t){return o.querySelector("span.dragitem.choice"+e+".item"+t)},dragItemBeingDragged:function(e){return o.querySelector("span.dragitem.beingdragged.choice"+e)},dragItemHome:function(e){return o.querySelector("span.draghome.choice"+e)},dragItemHomes:function(){return Array.from(o.querySelectorAll("span.draghome"))},getClassnameNumericSuffix:function(e,n){if(e.classList&&e.classList.length)for(var o=new RegExp("^"+n+"([0-9])+$"),r=new RegExp("([0-9])+$"),i=0;i<e.classList.length;i++)if(o.test(e.classList[i])){var s=r.exec(e.classList[i]);return Number(s[0])}t.logger.warn('Prefix "'+n+'" not found in class names.')},inputsForChoices:function(){return Array.from(n.querySelectorAll("input.choices"))},inputForChoice:function(e){return n.querySelector("input.choice"+e)},markerTexts:function(){return n.querySelector("div.markertexts")}}},e.prototype.draggable=function(e){var t=this;e.addEventListener("click",function(n){n.preventDefault(),n.stopPropagation();var o=t.selected;if(o&&!e.classList.contains("unplaced")){var r=t.domUtils.getElementXY(e,null,"ddarea"),i=t.doc.bgImg(),s=t.domUtils.getElementXY(i,null,"ddarea");if(r[0]=r[0]-s[0]+n.offsetX,r[1]=r[1]-s[1]+n.offsetY,r[0]<=i.width&&r[1]<=i.height)return t.deselectDrags(),void t.dropDrag(o,r)}e.classList.contains("beingdragged")?t.deselectDrags():t.selectDrag(e)})},e.prototype.dragHomeXY=function(e){var t=this.doc.dragItemHome(e),n=this.domUtils.getElementXY(t,null,"ddarea");return[n[0],n[1]]},e.prototype.drawDropZone=function(e,t,n,o,r,i){var s,a=this,c=this.doc.markerTexts();if(s=c.querySelector(i?"span.markertext"+e+" a":"span.markertext"+e))""!==t?s.innerHTML=t:s.remove();else if(""!==t){var u="markertext markertext"+e,d=document.createElement("span");d.className=u,d.innerHTML=i?'<a href="#">'+t+"</a>":t,c.appendChild(d)}var l="drawShape"+this.textUtils.ucFirst(n);if(this[l]instanceof Function){var f=this[l](e,o,r);if(null!==f){var p=this.doc.topNode().querySelector("div.ddarea div.markertexts span.markertext"+e);if(null!==p){f[0]=(f[0]-p.offsetWidth/2)*this.proportion,f[1]=(f[1]-p.offsetHeight/2)*this.proportion,p.style.opacity="0.6",p.style.left=f[0]+"px",p.style.top=f[1]+"px";var h=p.querySelector("a");null!==h&&(h.addEventListener("click",function(t){t.preventDefault(),t.stopPropagation(),a.shapes.forEach(function(e){e.css("fill-opacity",.5)}),a.shapes[e].css("fill-opacity",1),setTimeout(function(){a.shapes[e].css("fill-opacity",.5)},2e3)}),h.setAttribute("tabIndex","0"))}}}},e.prototype.drawShapeCircle=function(e,t,n){var o=t.match(/(\d+),(\d+);(\d+)/);if(o&&4===o.length){o.shift();var r=o.map(function(e){return Number(e)});if(this.coordsInImg([r[0]-r[2],r[1]-r[2]]))return this.shapes[e]=this.graphics.addShape({type:"circle",color:n},{cx:r[0]*this.proportion,cy:r[1]*this.proportion,r:r[2]*this.proportion}),[r[0],r[1]]}return null},e.prototype.drawShapeRectangle=function(e,t,n){var o=t.match(/(\d+),(\d+);(\d+),(\d+)/);if(o&&5===o.length){o.shift();var r=o.map(function(e){return Number(e)});if(this.coordsInImg([r[0]+r[2],r[1]+r[3]]))return this.shapes[e]=this.graphics.addShape({type:"rect",color:n},{x:r[0]*this.proportion,y:r[1]*this.proportion,width:r[2]*this.proportion,height:r[3]*this.proportion}),[r[0]+r[2]/2,r[1]+r[3]/2]}return null},e.prototype.drawShapePolygon=function(e,t,n){var o=t.split(";"),r=[],i=this.doc.bgImg(),s=[0,0],a=[i.width,i.height];for(var c in o){var u=o[c].match(/^(\d+),(\d+)$/),d=u&&u.map(function(e){return Number(e)});null!==d&&this.coordsInImg([d[1],d[2]])&&(d[1]*=this.proportion,d[2]*=this.proportion,a[0]=Math.min(d[1],a[0]),a[1]=Math.min(d[2],a[1]),s[0]=Math.max(d[1],s[0]),s[1]=Math.max(d[2],s[1]),r.push(d[1]+","+d[2]))}return r.length>2?(this.shapes[e]=this.graphics.addShape({type:"polygon",color:n},{points:r.join(" ")}),[(a[0]+s[0])/2,(a[1]+s[1])/2]):null},e.prototype.dropDrag=function(e,t){var n=this.getChoiceNoForNode(e);t&&(this.proportion<1&&(t[0]=Math.round(t[0]/this.proportion)),this.proportion<1&&(t[1]=Math.round(t[1]/this.proportion))),this.saveAllXYForChoice(n,e,t),this.redrawDragsAndDrops()},e.prototype.getCoords=function(e){var t=this.getChoiceNoForNode(e),n=e.getAttribute("value"),o=e.classList.contains("infinite"),r=this.getNoOfDragsForNode(e),i=null!==this.doc.dragItemBeingDragged(t),s=[];if(""!==n&&void 0!==n&&null!==n)for(var a=n.split(";"),c=0;c<a.length;c++){var u=a[c].split(",").map(function(e){return Number(e)});s[s.length]=this.convertToWindowXY(u)}return(o||s.length+(i?1:0)<r)&&(s[s.length]=this.dragHomeXY(t)),s},e.prototype.getChoiceNoForNode=function(e){return Number(this.doc.getClassnameNumericSuffix(e,"choice"))},e.prototype.getDragXY=function(e){var t=this.domUtils.getElementXY(e,null,"ddarea"),n=this.doc.bgImg(),o=this.domUtils.getElementXY(n,null,"ddarea");return t[0]-=o[0],t[1]-=o[1],this.proportion<1&&(t[0]=Math.round(t[0]/this.proportion)),this.proportion<1&&(t[1]=Math.round(t[1]/this.proportion)),t},e.prototype.getItemNoForNode=function(e){return Number(this.doc.getClassnameNumericSuffix(e,"item"))},e.prototype.getNextColour=function(){var e=this.COLOURS[this.nextColourIndex];return this.nextColourIndex++,this.nextColourIndex===this.COLOURS.length&&(this.nextColourIndex=0),e},e.prototype.getNoOfDragsForNode=function(e){return Number(this.doc.getClassnameNumericSuffix(e,"noofdrags"))},e.prototype.initializer=function(e){var t=this;this.doc=this.docStructure(e.slot),setTimeout(function(){t.pollForImageLoad()}),this.resizeFunction=this.redrawDragsAndDrops.bind(this),window.addEventListener("resize",this.resizeFunction)},e.prototype.makeImageDropable=function(){var e=this;if(!this.readOnly){this.doc.bgImg().addEventListener("click",function(t){var n=e.selected;if(!n)return!1;var o=[t.offsetX,t.offsetY];e.deselectDrags(),e.dropDrag(n,o),t.preventDefault(),t.stopPropagation()});this.doc.dragItemsArea().addEventListener("click",function(t){var n=e.selected;return!!n&&(n.classList.contains("unplaced")?(e.deselectDrags(),!1):(e.deselectDrags(),e.dropDrag(n,null),t.preventDefault(),void t.stopPropagation()))})}},e.prototype.pollForImageLoad=function(){var e=this;if(!this.afterImageLoadDone){var t=this.doc.bgImg(),n=function(){t.removeEventListener("load",n),e.makeImageDropable(),setTimeout(function(){e.redrawDragsAndDrops()}),e.afterImageLoadDone=!0,e.question.loaded=!0};t.addEventListener("load",n),setTimeout(function(){e.pollForImageLoad()},500)}},e.prototype.redrawDragsAndDrops=function(){var e=this.doc.dragItems();e.forEach(function(e){e.classList.add("unneeded","unplaced")}),this.calculateImgProportion();for(var t=this.doc.inputsForChoices(),n=0;n<t.length;n++)for(var o=t[n],r=this.getChoiceNoForNode(o),i=this.getCoords(o),s=this.doc.dragItemHome(r),a=this.dragHomeXY(r),c=0;c<i.length;c++){var u=this.doc.dragItemForChoice(r,c);!u||u.classList.contains("beingdragged")?u=this.cloneNewDragItem(s,c):u.classList.remove("unneeded"),a[0]==i[c][0]&&a[1]==i[c][1]||u.classList.remove("unplaced"),u.style.left=i[c][0]+"px",u.style.top=i[c][1]+"px"}for(var d=0;d<e.length;d++){var l=e[d];l.classList.contains("unneeded")&&!l.classList.contains("beingdragged")&&l.remove()}if(0!==this.dropZones.length){this.graphics.clear(),this.restartColours();for(var f in this.dropZones){var p=this.getNextColour(),h=this.dropZones[f],m=Number(f);this.drawDropZone(m,h.markertext,h.shape,h.coords,p,!0)}}},e.prototype.resetDragXY=function(e){this.setFormValue(e,"")},e.prototype.restartColours=function(){this.nextColourIndex=0},e.prototype.saveAllXYForChoice=function(e,t,n){for(var o,r=[],i=this.doc.dragItemsForChoice(e),s=0;s<i.length;s++){var a=this.doc.dragItemForChoice(e,s);a&&(a.classList.remove("item"+s),o=this.getDragXY(a),a.classList.add("item"+r.length),r.push(o))}null!==n?(t.classList.remove("unplaced"),t.classList.add("item"+r.length),r.push(n)):t.classList.add("unplaced"),r.length>0?this.setFormValue(e,r.join(";")):this.resetDragXY(e)},e.prototype.setFormValue=function(e,t){this.doc.inputForChoice(e).setAttribute("value",t)},e.prototype.selectDrag=function(e){this.deselectDrags(),this.selected=e,e.classList.add("beingdragged");var t=this.getItemNoForNode(e);null!==t&&e.classList.remove("item"+t)},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e,t){this.instance=e,this.domUtils=t,this.NS="http://www.w3.org/2000/svg"}return e.prototype.addShape=function(e,t){var n=document.createElementNS(this.NS,e.type);n.setAttribute("fill",e.color),n.setAttribute("fill-opacity","0.5"),n.setAttribute("stroke","black");for(var o in t)n.setAttribute(o,String(t[o]));return this.dropZone.appendChild(n),n},e.prototype.clear=function(){var e=this.instance.doc.bgImg(),t=this.domUtils.getElementXY(e,null,"ddarea"),n=this.instance.doc.topNode().querySelector("div.ddarea div.dropzones");n.style.left=t[0]+"px",n.style.top=t[1]+"px",n.style.width=e.width+"px",n.style.height=e.height+"px";var o=this.instance.doc.markerTexts();if(o.style.left=t[0]+"px",o.style.top=t[1]+"px",o.style.width=e.width+"px",o.style.height=e.height+"px",this.dropZone)for(;this.dropZone.firstChild;)this.dropZone.removeChild(this.dropZone.firstChild);else this.dropZone=document.createElementNS(this.NS,"svg"),n.appendChild(this.dropZone);this.dropZone.style.width=e.width+"px",this.dropZone.style.height=e.height+"px",this.instance.shapes=[]},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(1751),u=n(915),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(65),i=n(915),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionProvider=e,this.name="AddonQtypeDdwtos",this.type="qtype_ddwtos"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){for(var n in t){var o=t[n];if(!o||"0"===o)return 0}return 1},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){for(var n in t){var o=t[n];if(o&&"0"!==o)return 1}return 0},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return o});var o=function(){function e(e,t,n,o,r,i){this.domUtils=t,this.container=n,this.question=o,this.readOnly=r,this.inputIds=i,this.nextDragItemNo=1,this.logger=e.getInstance("AddonQtypeDdwtosQuestion"),this.initializer(o)}return e.prototype.cloneDragItem=function(e){var t=e.cloneNode(!0);t.classList.remove("draghome"),t.classList.add("drag"),t.classList.add("no"+this.nextDragItemNo),this.nextDragItemNo++,t.style.visibility="visible",t.style.position="absolute";this.container.querySelector(this.selectors.dragContainer()).appendChild(t),this.readOnly||this.makeDraggable(t)},e.prototype.cloneDragItems=function(){for(var e=Array.from(this.container.querySelectorAll(this.selectors.dragHomes())),t=0;t<e.length;t++)this.cloneDragItemsForOneChoice(e[t])},e.prototype.cloneDragItemsForOneChoice=function(e){if(e.classList.contains("infinite"))for(var t=this.getGroup(e),n=this.container.querySelectorAll(this.selectors.dropsInGroup(t)).length,o=0;o<n;o++)this.cloneDragItem(e);else this.cloneDragItem(e)},e.prototype.cssSelectors=function(e){var t=".addon-qtype-ddwtos-container",n={};return n.topNode=function(){return t},n.dragContainer=function(){return t+" div.drags"},n.drags=function(){return n.dragContainer()+" span.drag"},n.drag=function(e){return n.drags()+".no"+e},n.dragsInGroup=function(e){return n.drags()+".group"+e},n.unplacedDragsInGroup=function(e){return n.dragsInGroup(e)+".unplaced"},n.dragsForChoiceInGroup=function(e,t){return n.dragsInGroup(t)+".choice"+e},n.unplacedDragsForChoiceInGroup=function(e,t){return n.unplacedDragsInGroup(t)+".choice"+e},n.drops=function(){return t+" span.drop"},n.dropForPlace=function(e){return n.drops()+".place"+e},n.dropsInGroup=function(e){return n.drops()+".group"+e},n.dragHomes=function(){return t+" span.draghome"},n.dragHomesGroup=function(e){return t+" .draggrouphomes"+e+" span.draghome"},n.dragHome=function(e,n){return t+" .draggrouphomes"+e+" span.draghome.choice"+n},n.dropsGroup=function(e){return t+" span.drop.group"+e},n},e.prototype.deselectDrags=function(){Array.from(this.container.querySelectorAll(this.selectors.drags())).forEach(function(e){e.classList.remove("selected")}),this.selected=null},e.prototype.destroy=function(){this.resizeFunction&&window.removeEventListener("resize",this.resizeFunction)},e.prototype.getChoice=function(e){return this.getClassnameNumericSuffix(e,"choice")},e.prototype.getClassnameNumericSuffix=function(e,t){if(e.classList&&e.classList.length)for(var n=new RegExp("^"+t+"([0-9])+$"),o=new RegExp("([0-9])+$"),r=0;r<e.classList.length;r++)if(n.test(e.classList[r])){var i=o.exec(e.classList[r]);return Number(i[0])}this.logger.warn('Prefix "'+t+'" not found in class names.')},e.prototype.getGroup=function(e){return this.getClassnameNumericSuffix(e,"group")},e.prototype.getNo=function(e){return this.getClassnameNumericSuffix(e,"no")},e.prototype.getPlace=function(e){return this.getClassnameNumericSuffix(e,"place")},e.prototype.initializer=function(e){var t=this;this.selectors=this.cssSelectors(e.slot);var n=this.container.querySelector(this.selectors.topNode());n.classList.add(this.readOnly?"readonly":"notreadonly"),this.setPaddingSizesAll(),this.cloneDragItems(),this.initialPlaceOfDragItems(),this.makeDropZones(),setTimeout(function(){t.positionDragItems()}),this.resizeFunction=this.positionDragItems.bind(this),window.addEventListener("resize",this.resizeFunction)},e.prototype.initialPlaceOfDragItems=function(){Array.from(this.container.querySelectorAll(this.selectors.drags())).forEach(function(e){e.classList.add("unplaced")}),this.placed={};for(var e in this.inputIds){var t=this.container.querySelector("input#"+this.inputIds[e]),n=Number(t.getAttribute("value"));if(0!==n){var o=this.container.querySelector(this.selectors.dropForPlace(parseInt(e,10)+1)),r=this.getGroup(o),i=this.container.querySelector(this.selectors.unplacedDragsForChoiceInGroup(n,r));this.placeDragInDrop(i,o),this.positionDragItem(i)}}},e.prototype.makeDraggable=function(e){var t=this;e.addEventListener("click",function(){e.classList.contains("selected")?t.deselectDrags():t.selectDrag(e)})},e.prototype.makeDropZone=function(e){var t=this;e.addEventListener("click",function(){var n=t.selected;if(!n)return!1;t.getGroup(n)===t.getGroup(e)&&(t.placeDragInDrop(n,e),t.deselectDrags(),t.positionDragItem(n))})},e.prototype.makeDropZones=function(){var e=this;if(!this.readOnly){Array.from(this.container.querySelectorAll(this.selectors.drops())).forEach(function(t){e.makeDropZone(t)});this.container.querySelector(this.selectors.topNode()+" .answercontainer").addEventListener("click",function(){var t=e.selected;t&&(t.classList.contains("unplaced")?e.deselectDrags():(e.removeDragFromDrop(t),e.deselectDrags(),e.positionDragItem(t)))})}},e.prototype.padToWidthHeight=function(e,t,n){e.style.width=t+"px",e.style.height=n+"px",e.style.lineHeight=n+"px"},e.prototype.placeDragInDrop=function(e,t){var n=this.getPlace(t),o=this.container.querySelector("input#"+this.inputIds[n-1]);o.setAttribute("value",null!==e?String(this.getChoice(e)):"0");for(var r in this.placed)this.placed[r]===n&&delete this.placed[r];null!==e&&(this.placed[this.getNo(e)]=n)},e.prototype.positionDragItem=function(e){var t,n=this.placed[this.getNo(e)];if(n)t=this.domUtils.getElementXY(this.container,this.selectors.dropForPlace(n),"addon-qtype-ddwtos-container"),e.classList.remove("unplaced");else{var o=this.getGroup(e),r=this.getChoice(e);t=this.domUtils.getElementXY(this.container,this.selectors.dragHome(o,r),"answercontainer"),e.classList.add("unplaced")}t&&(e.style.left=t[0]+"px",e.style.top=t[1]+"px")},e.prototype.positionDragItems=function(){var e=this;Array.from(this.container.querySelectorAll(this.selectors.drags())).forEach(function(t){e.positionDragItem(t)})},e.prototype.removeDragFromDrop=function(e){var t=this.placed[this.getNo(e)],n=this.container.querySelector(this.selectors.dropForPlace(t));this.placeDragInDrop(null,n)},e.prototype.selectDrag=function(e){this.deselectDrags(),this.selected=e,e.classList.add("selected")},e.prototype.setPaddingSizesAll=function(){for(var e=1;e<=8;e++)this.setPaddingSizeForGroup(e)},e.prototype.setPaddingSizeForGroup=function(e){var t=this,n=Array.from(this.container.querySelectorAll(this.selectors.dragHomesGroup(e)));if(0!==n.length){var o=0,r=0;n.forEach(function(e){o=Math.max(o,Math.ceil(e.offsetWidth)),r=Math.max(r,Math.ceil(e.offsetHeight))}),o+=8,r+=2,n.forEach(function(e){t.padToWidthHeight(e,o,r)});Array.from(this.container.querySelectorAll(this.selectors.dropsGroup(e))).forEach(function(e){t.padToWidthHeight(e,o+2,r+2)})}},e}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(1754),u=n(916),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return a});var o=n(0),r=n(916),i=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},s=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},a=function(){function e(){this.name="AddonQtypeDescription",this.type="qtype_description"}return e.prototype.getBehaviour=function(e,t){return"informationitem"},e.prototype.getComponent=function(e,t){return r.a},e.prototype.isEnabled=function(){return!0},e.prototype.validateSequenceCheck=function(e,t){return!0},e=i([Object(o.A)(),s("design:paramtypes",[])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return p});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(16),c=n(15),u=n(1756),d=n(917),l=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},f=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},p=function(){function e(e,t){e.registerHandler(t)}return e=l([Object(o.I)({declarations:[d.a],imports:[r.k,i.b.forChild(),a.a,c.a],providers:[u.a],exports:[d.a],entryComponents:[d.a]}),f("design:paramtypes",[s.a,u.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return d});var o=n(0),r=n(11),i=n(6),s=n(73),a=n(917),c=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},u=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},d=function(){function e(e,t,n){this.utils=e,this.questionHelper=t,this.textUtils=n,this.name="AddonQtypeEssay",this.type="qtype_essay",this.div=document.createElement("div")}return e.prototype.getBehaviour=function(e,t){return"manualgraded"},e.prototype.getComponent=function(e,t){return a.a},e.prototype.getPreventSubmitMessage=function(e){return this.div.innerHTML=e.html,this.div.querySelector("div[id*=filemanager]")?"core.question.errorattachmentsnotsupported":this.questionHelper.hasDraftFileUrls(this.div.innerHTML)?"core.question.errorinlinefilesnotsupported":void 0},e.prototype.isCompleteResponse=function(e,t){this.div.innerHTML=e.html;var n=t.answer&&""!==t.answer;return!!this.div.querySelector("div[id*=filemanager]")?-1:n?1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return 0},e.prototype.isSameResponse=function(e,t,n){return this.utils.sameAtKeyMissingIsBlank(t,n,"answer")},e.prototype.prepareAnswers=function(e,t,n,o){this.div.innerHTML=e.html;var r=this.div.querySelector("textarea[name*=_answer]");r&&void 0!==t[r.name]&&(t[r.name]=this.textUtils.formatHtmlLines(t[r.name]))},e=c([Object(o.A)(),u("design:paramtypes",[i.a,s.a,r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(1758),u=n(918),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(65),i=n(918),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.questionProvider=e,this.name="AddonQtypeGapSelect",this.type="qtype_gapselect"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){for(var n in t){var o=t[n];if(!o||"0"===o)return 0}return 1},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){for(var n in t){if(t[n])return 1}return 0},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(919),u=n(386),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(1761),u=n(920),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return u});var o=n(0),r=n(65),i=n(73),s=n(920),a=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},c=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},u=function(){function e(e,t){this.questionProvider=e,this.questionHelper=t,this.name="AddonQtypeMultiAnswer",this.type="qtype_multianswer"}return e.prototype.getBehaviour=function(e,t){return"interactive"===t?"interactivecountback":t},e.prototype.getComponent=function(e,t){return s.a},e.prototype.isCompleteResponse=function(e,t){var n=this.questionProvider.getBasicAnswers(this.questionHelper.getAllInputNamesFromHtml(e.html));for(var o in n){var r=t[o];if(!r&&!1!==r&&0!==r)return 0}return 1},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){for(var n in t){var o=t[n];if(o||!1===o)return 1}return 0},e.prototype.isSameResponse=function(e,t,n){return this.questionProvider.compareAllAnswers(t,n)},e.prototype.validateSequenceCheck=function(e,t){return e.sequencecheck==t||2==e.sequencecheck&&"todo"==e.state&&"1"==t},e=a([Object(o.A)(),c("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(912),u=n(247),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(911),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[i.a]}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(1765),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[i.a]}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(919),i=n(386),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.matchHandler=e,this.name="AddonQtypeRandomSaMatch",this.type="qtype_randomsamatch"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return this.matchHandler.isCompleteResponse(e,t)},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.matchHandler.isGradableResponse(e,t)},e.prototype.isSameResponse=function(e,t,n){return this.matchHandler.isSameResponse(e,t,n)},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return f});var o=n(0),r=n(4),i=n(1),s=n(38),a=n(15),c=n(1767),u=n(384),d=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},l=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},f=function(){function e(e,t){e.registerHandler(t)}return e=d([Object(o.I)({declarations:[u.a],imports:[r.k,i.b.forChild(),a.a],providers:[c.a],exports:[u.a],entryComponents:[u.a]}),l("design:paramtypes",[s.a,c.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(6),i=n(384),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.utils=e,this.name="AddonQtypeShortAnswer",this.type="qtype_shortanswer"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return t.answer||0===t.answer?1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.isCompleteResponse(e,t)},e.prototype.isSameResponse=function(e,t,n){return this.utils.sameAtKeyMissingIsBlank(t,n,"answer")},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(38),i=n(1769),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e,t){e.registerHandler(t)}return e=s([Object(o.I)({declarations:[],providers:[i.a]}),a("design:paramtypes",[r.a,i.a])],e)}()},function(e,t,n){"use strict";n.d(t,"a",function(){return c});var o=n(0),r=n(6),i=n(247),s=this&&this.__decorate||function(e,t,n,o){var r,i=arguments.length,s=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,o);else for(var a=e.length-1;a>=0;a--)(r=e[a])&&(s=(i<3?r(s):i>3?r(t,n,s):r(t,n))||s);return i>3&&s&&Object.defineProperty(t,n,s),s},a=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},c=function(){function e(e){this.utils=e,this.name="AddonQtypeTrueFalse",this.type="qtype_truefalse"}return e.prototype.getComponent=function(e,t){return i.a},e.prototype.isCompleteResponse=function(e,t){return t.answer?1:0},e.prototype.isEnabled=function(){return!0},e.prototype.isGradableResponse=function(e,t){return this.isCompleteResponse(e,t)},e.prototype.isSameResponse=function(e,t,n){return this.utils.sameAtKeyMissingIsBlank(t,n,"answer")},e=s([Object(o.A)(),a("design:paramtypes",[r.a])],e)}()}],[970]);